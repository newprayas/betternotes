This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
betternotes/
  .git/
    hooks/
      applypatch-msg.sample
      commit-msg.sample
      fsmonitor-watchman.sample
      post-update.sample
      pre-applypatch.sample
      pre-commit.sample
      pre-merge-commit.sample
      pre-push.sample
      pre-rebase.sample
      pre-receive.sample
      prepare-commit-msg.sample
      push-to-checkout.sample
      sendemail-validate.sample
      update.sample
    info/
      exclude
    logs/
      refs/
        heads/
          main
        remotes/
          origin/
            main
      HEAD
    objects/
      00/
        0d77d01c7593082ddf2fa0ebe1d64cc0cdc750
        4145cddf3f9db91b57b9cb596683c8eb420862
        823e8f3324c5442f558bf4ed60de981b0e33ac
        bdabadaad0dd96753cbf3a2da3d19d8489aab8
      04/
        630854ca014db41fba96c7a568ba503c0bd150
        821cb4d9723830fa054f75737ac9ee7318dbf1
      05/
        8f0dffed9108020e02dc151bfb074a9dbab905
        e726d1b4201bc8c7716d2b058279676582e8c0
      06/
        5da7c11e2d5c410c30c4e91991a5c7010110cd
      09/
        bf6678642c0ea9cccce2813c850d1c0d6fb3c4
      0d/
        05f465f762e7e10077ff7acd1bf9abfc791a79
      0e/
        f2e90b56534b38bda8060b70dfa712a26ce830
      0f/
        45484273b00b378d98c07f6738490a6ca86087
      11/
        9bc29727d24fa4c994a01009b8b9d4999ee745
      15/
        570f08cf355301bb9b2c98a05e55792a5f9e1a
        abff8d7a8cbf84ce2f41c047b3b074c352bc73
      16/
        1019f97dcd215b2731be31532abb40661ef39d
        16d4aac9a2a9fbe203e2e996d7b3ffc23c8742
      1b/
        cf629cd0a6db6e45ef2a2434fedd9d3b2ffad8
      1c/
        4cd16b3f31882a64953a48ab65629be3a372b8
        c52c647a83c089305d74e1ff60f29c5bc21aa2
      1f/
        66428af7c269aaf5726de15ff2a30e27cf7f14
        8642de228f9a950601e92737e4cffbb495de02
      20/
        b8172f8ead7c1e291972c0a5b2ae78059e01b7
      21/
        5da9426b3a5f09fbb8784f5013cfaae2269a3a
      25/
        13f6ca57f10f9646574a2af9115924b8f63079
      26/
        2082c8067c55b571aa04272d4bd15f905dfa5e
        a53f40751863695ab03811a30d6412699de7e6
        ca6da297b5fa11ae8a402908a1e2e77a4ddad8
      29/
        5f8fdf14fcfe6cccaa832133037157521b1890
        dd9d824b334de53e984d6aa85aefc1218a2701
      2a/
        08ef44edcc1f57a8c9e4599c1f2ecbe26b0fbf
      2e/
        556f04308f2bb75230f2827ae251c4a948f008
      32/
        0c596338d15f9e5c586f690570908e44f6b303
        52731125c0dce17b67b1734012b564948a295b
      33/
        8374b8c7a11c18ef170f2b82f4fd615899eed0
      35/
        7606ad8ab860c9cd37aa3c3eab70d6ac966cbd
      39/
        9a195982258eccdd4456093b54e7222c8173a0
        bee949ca428b2de44cc06733617678912653df
      3a/
        13f90a773b0facb675bf5b1a8239c8f33d36f5
      43/
        37f6ad69f968a354ccb83b0f40b18c46ec29c0
      46/
        a4f5b6d130b99f2cc3c26e742b9b6659aa1dc0
      4e/
        ec371b642b0e29b94f66287b40d046f4a1f46c
      50/
        b9e75d4b02e55e69b8198970056b3b76699266
      51/
        74b28c565c285e3e312ec5178be64fbeca8398
      52/
        b9e43aecbd5be9dc5a5f0a2bca5d7c49f0f8dd
      53/
        5d1de79bad53182fcf001641dc96cc6dba3257
      56/
        7f17b0d7c7fb662c16d4357dd74830caf2dccb
      57/
        235cda232e72c1cb9d68956e6e5ba8a2fae8c7
      58/
        0fb6e871315b2bb4596ad289c60830214d7425
      59/
        8a8a8ce573513f5ee3d109529922d03141eff8
      5d/
        cfd0c41b45a563dc94422c9f3bc7edb9e50ea2
        fff4f84b483f5ca7491fd689a5def7ddafed47
      5e/
        f6a520780202a1d6addd833d800ccb1ecac0bb
      61/
        e36849cf7cfa9f1f71b4a3964a4953e3e243d3
      65/
        19540c7b97ddb52f4201f72b72d6217807d6bf
      66/
        31d36fe42b386787b4c922124d2e23c45921db
      67/
        69eea30090c42a07efa0d74829ebd8cf0865b2
      69/
        34dae6b2790e9b0a49b471252284a4a439f7ea
        8dabadc10ce9ec89ffcf69262661c0abf8f0b9
      6b/
        072ea3fb3edf849fa21231026a46fb60cb6ed7
      6d/
        45fe59644b5c5a314bbb013e75bfffdf9e430e
      70/
        eb37ab8d59813ee5551be8f3a5edb830d216dd
      71/
        8d6fea4835ec2d246af9800eddb7ffb276240c
      76/
        39d79b261659760cd150bc7cdf893551f286ee
      77/
        053960334e2e34dc584dea8019925c3b4ccca9
        4abe80dace19a820b70c3ed08b027095e046d4
      79/
        01011110b9bd05b0ddf69c8a8e4f6863624d50
        3599eddcb1ec91174f9b9e4176201d1814059a
      7c/
        bc01fd46efddc51829d2416f5bbacb71bf01a9
      83/
        f0517cddf41be91f2017cb080caa430bc6eb30
      85/
        6baaf152906891ebd53490eff33cd45f2970b8
      87/
        6b3e4aa2322e9f151c9fadc8c7e644c5301109
      8c/
        5895b11a5cff46ea90e6171b25f7ef49b96f08
      9e/
        1fc6bf9470f96b3a97696017f95bc982d880e2
      a2/
        dc41ecee5ec435200fe7cba2bde4107f823774
      a6/
        4440706b06dfbc6011b6c9818800a3c2e100eb
        a754f1ea691efa3aaaf1db615147f1c7adec46
      a9/
        8cccdf5bdbc0c42ffd2552de1cdae57a901f98
      aa/
        ad6f9e6e9b2262b043340091540f96d909e849
        b3ac63285dd7dcf645e2939882ace9e3556c05
        e797a22c0b54ee8f60b0ff90debd4f0d56d209
      af/
        269a88d766a3f84d771f4e2356a325339649a4
      b2/
        b2a44f6ebc70c450043c05a002e7a93ba5d651
      b6/
        9a51e54993e966d268181070eb820c1dad1533
      ba/
        c48bc72dbdae2602bd375e97bf6de17a4cccf2
      c1/
        0be88a61ba2613dbcea1abb46497c3ce6a740e
      c6/
        686224993ed67f5a5ee5cf269392bc52901f6f
        7225ebc136354ae58b73ad86d7d5d0f7a164b8
        aa73e81241cba6d6c51f637a18423972b71d01
      c7/
        122784ba4cb9167314f82ce89e24b0450ff4df
      c8/
        8f389de09f418da376598c42e8788d4fb6d172
      cd/
        84047e6953a6129308794948fa9804ea4a1025
      d1/
        642a246926bdf50d49405d93c3fc0f795ea366
      d3/
        faa44da0284f26b5205c0c1d068823f5c9bae0
      da/
        ed5344d8d54bf88839ab411c23209c6c165c08
      de/
        051b0d35a8ebf4d443baba69b4f8f0f24920a2
      df/
        bf9d4377b2eb29a54ebc6eb7b0ed788d823b7c
      e1/
        4d290505dfffe4dd0c8b5d519f813523950959
      e2/
        15bc4ccf138bbc38ad58ad57e92135484b3c0f
      e3/
        14fb876ec7bf529a4810c2527e1e7ee19e38c3
      e5/
        bdfbb972b844692b7dbceb43e8e81f89423762
      e9/
        ffa3083ad279ecf95fd8eae59cb253e9a539c4
      eb/
        488d09ef94071cf635c3940704570af4e6f01a
      ed/
        e0d684607266b78b9aa8c1290079b57ac208c5
      f1/
        e5445929a8bd055eb340315f4aff5b1a25fbe6
      f6/
        eedac4f40137dbd0b3c205a1af966d6796b703
      f7/
        fa87eb875260ed98651bc419c8139b5119e554
      f9/
        35f3d64675159643019bec9ff6d425bf984edc
        bfd0fd6362fdad123bee13ef1259ac7709fd40
      fd/
        6d55aedaab083ac7202453478a69cb367ad902
    refs/
      heads/
        main
      remotes/
        origin/
          main
    COMMIT_EDITMSG
    config
    description
    FETCH_HEAD
    HEAD
    index
    ORIG_HEAD
  .sanity/
    runtime/
      app.js
      index.html
  app/
    checkout/
      page.tsx
    notes/
      [slug]/
        page.tsx
      page.tsx
    favicon.ico
    globals.css
    layout.tsx
    page.tsx
  components/
    layout/
      footer.tsx
      header.tsx
  dist/
    static/
      643ae7fc.create-schema.json
      9504b3c1.create-tools.json
      apple-touch-icon.png
      browser-vDqJ5XpU.js
      create-manifest.json
      favicon-192.png
      favicon-512.png
      favicon-96.png
      favicon.ico
      favicon.svg
      index-BaEyKr4y.js
      index2-CfQ9rhg4.js
      index3-B7WWMqYT.js
      manifest.webmanifest
      refractor-Bm_vMXvg.js
      refractor-DZZEKWBN.js
      resources-aV_Fx8NC.js
      resources-DtW-TvUT.js
      resources2-B6S5a0Tb.js
      resources3-B2B2q3bS.js
      resources4-DbN9N6zZ.js
      resources5-OezZE7EX.js
      resources6-CyZXUTJw.js
      resources7-el_Vnbtr.js
      sanity-z2y04qld.js
      SanityVision-CzEtxX32.js
      stegaEncodeSourceMap-v7OBnJPR.js
      VideoPlayer-D_FmRSM7.js
      ViteDevServerStopped-fNCvrPMG.js
    favicon.ico
    file.svg
    globe.svg
    index.html
    next.svg
    vercel.svg
    window.svg
  lib/
    sanity/
      api.ts
      client.ts
      schema.ts
    cart-context.tsx
  public/
    file.svg
    globe.svg
    next.svg
    vercel.svg
    window.svg
  types/
    index.ts
  .gitignore
  eslint.config.mjs
  fix-studio.sh
  next.config.js
  next.config.ts
  package.json
  postcss.config.mjs
  README.md
  run-dev.sh
  sanity.cli.ts
  sanity.config.ts
  setup-dev.sh
  studio.html
  tsconfig.json
  vercel.json
architecture-diagram.md
implementation-plan.md
PRD.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="betternotes/.git/hooks/applypatch-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message taken by
# applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.  The hook is
# allowed to edit the commit message file.
#
# To enable this hook, rename this file to "applypatch-msg".

. git-sh-setup
commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
:
</file>

<file path="betternotes/.git/hooks/commit-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message.
# Called by "git commit" with one argument, the name of the file
# that has the commit message.  The hook should exit with non-zero
# status after issuing an appropriate message if it wants to stop the
# commit.  The hook is allowed to edit the commit message file.
#
# To enable this hook, rename this file to "commit-msg".

# Uncomment the below to add a Signed-off-by line to the message.
# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
# hook is more suited to it.
#
# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"

# This example catches duplicate Signed-off-by lines.

test "" = "$(grep '^Signed-off-by: ' "$1" |
	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
	echo >&2 Duplicate Signed-off-by lines.
	exit 1
}
</file>

<file path="betternotes/.git/hooks/fsmonitor-watchman.sample">
#!/usr/bin/perl

use strict;
use warnings;
use IPC::Open2;

# An example hook script to integrate Watchman
# (https://facebook.github.io/watchman/) with git to speed up detecting
# new and modified files.
#
# The hook is passed a version (currently 2) and last update token
# formatted as a string and outputs to stdout a new update token and
# all files that have been modified since the update token. Paths must
# be relative to the root of the working tree and separated by a single NUL.
#
# To enable this hook, rename this file to "query-watchman" and set
# 'git config core.fsmonitor .git/hooks/query-watchman'
#
my ($version, $last_update_token) = @ARGV;

# Uncomment for debugging
# print STDERR "$0 $version $last_update_token\n";

# Check the hook interface version
if ($version ne 2) {
	die "Unsupported query-fsmonitor hook version '$version'.\n" .
	    "Falling back to scanning...\n";
}

my $git_work_tree = get_working_dir();

my $retry = 1;

my $json_pkg;
eval {
	require JSON::XS;
	$json_pkg = "JSON::XS";
	1;
} or do {
	require JSON::PP;
	$json_pkg = "JSON::PP";
};

launch_watchman();

sub launch_watchman {
	my $o = watchman_query();
	if (is_work_tree_watched($o)) {
		output_result($o->{clock}, @{$o->{files}});
	}
}

sub output_result {
	my ($clockid, @files) = @_;

	# Uncomment for debugging watchman output
	# open (my $fh, ">", ".git/watchman-output.out");
	# binmode $fh, ":utf8";
	# print $fh "$clockid\n@files\n";
	# close $fh;

	binmode STDOUT, ":utf8";
	print $clockid;
	print "\0";
	local $, = "\0";
	print @files;
}

sub watchman_clock {
	my $response = qx/watchman clock "$git_work_tree"/;
	die "Failed to get clock id on '$git_work_tree'.\n" .
		"Falling back to scanning...\n" if $? != 0;

	return $json_pkg->new->utf8->decode($response);
}

sub watchman_query {
	my $pid = open2(\*CHLD_OUT, \*CHLD_IN, 'watchman -j --no-pretty')
	or die "open2() failed: $!\n" .
	"Falling back to scanning...\n";

	# In the query expression below we're asking for names of files that
	# changed since $last_update_token but not from the .git folder.
	#
	# To accomplish this, we're using the "since" generator to use the
	# recency index to select candidate nodes and "fields" to limit the
	# output to file names only. Then we're using the "expression" term to
	# further constrain the results.
	my $last_update_line = "";
	if (substr($last_update_token, 0, 1) eq "c") {
		$last_update_token = "\"$last_update_token\"";
		$last_update_line = qq[\n"since": $last_update_token,];
	}
	my $query = <<"	END";
		["query", "$git_work_tree", {$last_update_line
			"fields": ["name"],
			"expression": ["not", ["dirname", ".git"]]
		}]
	END

	# Uncomment for debugging the watchman query
	# open (my $fh, ">", ".git/watchman-query.json");
	# print $fh $query;
	# close $fh;

	print CHLD_IN $query;
	close CHLD_IN;
	my $response = do {local $/; <CHLD_OUT>};

	# Uncomment for debugging the watch response
	# open ($fh, ">", ".git/watchman-response.json");
	# print $fh $response;
	# close $fh;

	die "Watchman: command returned no output.\n" .
	"Falling back to scanning...\n" if $response eq "";
	die "Watchman: command returned invalid output: $response\n" .
	"Falling back to scanning...\n" unless $response =~ /^\{/;

	return $json_pkg->new->utf8->decode($response);
}

sub is_work_tree_watched {
	my ($output) = @_;
	my $error = $output->{error};
	if ($retry > 0 and $error and $error =~ m/unable to resolve root .* directory (.*) is not watched/) {
		$retry--;
		my $response = qx/watchman watch "$git_work_tree"/;
		die "Failed to make watchman watch '$git_work_tree'.\n" .
		    "Falling back to scanning...\n" if $? != 0;
		$output = $json_pkg->new->utf8->decode($response);
		$error = $output->{error};
		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		# Uncomment for debugging watchman output
		# open (my $fh, ">", ".git/watchman-output.out");
		# close $fh;

		# Watchman will always return all files on the first query so
		# return the fast "everything is dirty" flag to git and do the
		# Watchman query just to get it over with now so we won't pay
		# the cost in git to look up each individual file.
		my $o = watchman_clock();
		$error = $output->{error};

		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		output_result($o->{clock}, ("/"));
		$last_update_token = $o->{clock};

		eval { launch_watchman() };
		return 0;
	}

	die "Watchman: $error.\n" .
	"Falling back to scanning...\n" if $error;

	return 1;
}

sub get_working_dir {
	my $working_dir;
	if ($^O =~ 'msys' || $^O =~ 'cygwin') {
		$working_dir = Win32::GetCwd();
		$working_dir =~ tr/\\/\//;
	} else {
		require Cwd;
		$working_dir = Cwd::cwd();
	}

	return $working_dir;
}
</file>

<file path="betternotes/.git/hooks/post-update.sample">
#!/bin/sh
#
# An example hook script to prepare a packed repository for use over
# dumb transports.
#
# To enable this hook, rename this file to "post-update".

exec git update-server-info
</file>

<file path="betternotes/.git/hooks/pre-applypatch.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed
# by applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-applypatch".

. git-sh-setup
precommit="$(git rev-parse --git-path hooks/pre-commit)"
test -x "$precommit" && exec "$precommit" ${1+"$@"}
:
</file>

<file path="betternotes/.git/hooks/pre-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-commit".

if git rev-parse --verify HEAD >/dev/null 2>&1
then
	against=HEAD
else
	# Initial commit: diff against an empty tree object
	against=$(git hash-object -t tree /dev/null)
fi

# If you want to allow non-ASCII filenames set this variable to true.
allownonascii=$(git config --type=bool hooks.allownonascii)

# Redirect output to stderr.
exec 1>&2

# Cross platform projects tend to avoid non-ASCII filenames; prevent
# them from being added to the repository. We exploit the fact that the
# printable range starts at the space character and ends with tilde.
if [ "$allownonascii" != "true" ] &&
	# Note that the use of brackets around a tr range is ok here, (it's
	# even required, for portability to Solaris 10's /usr/bin/tr), since
	# the square bracket bytes happen to fall in the designated range.
	test $(git diff-index --cached --name-only --diff-filter=A -z $against |
	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
then
	cat <<\EOF
Error: Attempt to add a non-ASCII file name.

This can cause problems if you want to work with people on other platforms.

To be portable it is advisable to rename the file.

If you know what you are doing you can disable this check using:

  git config hooks.allownonascii true
EOF
	exit 1
fi

# If there are whitespace errors, print the offending file names and fail.
exec git diff-index --check --cached $against --
</file>

<file path="betternotes/.git/hooks/pre-merge-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git merge" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message to
# stderr if it wants to stop the merge commit.
#
# To enable this hook, rename this file to "pre-merge-commit".

. git-sh-setup
test -x "$GIT_DIR/hooks/pre-commit" &&
        exec "$GIT_DIR/hooks/pre-commit"
:
</file>

<file path="betternotes/.git/hooks/pre-push.sample">
#!/bin/sh

# An example hook script to verify what is about to be pushed.  Called by "git
# push" after it has checked the remote status, but before anything has been
# pushed.  If this script exits with a non-zero status nothing will be pushed.
#
# This hook is called with the following parameters:
#
# $1 -- Name of the remote to which the push is being done
# $2 -- URL to which the push is being done
#
# If pushing without using a named remote those arguments will be equal.
#
# Information about the commits which are being pushed is supplied as lines to
# the standard input in the form:
#
#   <local ref> <local oid> <remote ref> <remote oid>
#
# This sample shows how to prevent push of commits where the log message starts
# with "WIP" (work in progress).

remote="$1"
url="$2"

zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')

while read local_ref local_oid remote_ref remote_oid
do
	if test "$local_oid" = "$zero"
	then
		# Handle delete
		:
	else
		if test "$remote_oid" = "$zero"
		then
			# New branch, examine all commits
			range="$local_oid"
		else
			# Update to existing branch, examine new commits
			range="$remote_oid..$local_oid"
		fi

		# Check for WIP commit
		commit=$(git rev-list -n 1 --grep '^WIP' "$range")
		if test -n "$commit"
		then
			echo >&2 "Found WIP commit in $local_ref, not pushing"
			exit 1
		fi
	fi
done

exit 0
</file>

<file path="betternotes/.git/hooks/pre-rebase.sample">
#!/bin/sh
#
# Copyright (c) 2006, 2008 Junio C Hamano
#
# The "pre-rebase" hook is run just before "git rebase" starts doing
# its job, and can prevent the command from running by exiting with
# non-zero status.
#
# The hook is called with the following parameters:
#
# $1 -- the upstream the series was forked from.
# $2 -- the branch being rebased (or empty when rebasing the current branch).
#
# This sample shows how to prevent topic branches that are already
# merged to 'next' branch from getting rebased, because allowing it
# would result in rebasing already published history.

publish=next
basebranch="$1"
if test "$#" = 2
then
	topic="refs/heads/$2"
else
	topic=`git symbolic-ref HEAD` ||
	exit 0 ;# we do not interrupt rebasing detached HEAD
fi

case "$topic" in
refs/heads/??/*)
	;;
*)
	exit 0 ;# we do not interrupt others.
	;;
esac

# Now we are dealing with a topic branch being rebased
# on top of master.  Is it OK to rebase it?

# Does the topic really exist?
git show-ref -q "$topic" || {
	echo >&2 "No such branch $topic"
	exit 1
}

# Is topic fully merged to master?
not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
if test -z "$not_in_master"
then
	echo >&2 "$topic is fully merged to master; better remove it."
	exit 1 ;# we could allow it, but there is no point.
fi

# Is topic ever merged to next?  If so you should not be rebasing it.
only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
only_next_2=`git rev-list ^master           ${publish} | sort`
if test "$only_next_1" = "$only_next_2"
then
	not_in_topic=`git rev-list "^$topic" master`
	if test -z "$not_in_topic"
	then
		echo >&2 "$topic is already up to date with master"
		exit 1 ;# we could allow it, but there is no point.
	else
		exit 0
	fi
else
	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
	/usr/bin/perl -e '
		my $topic = $ARGV[0];
		my $msg = "* $topic has commits already merged to public branch:\n";
		my (%not_in_next) = map {
			/^([0-9a-f]+) /;
			($1 => 1);
		} split(/\n/, $ARGV[1]);
		for my $elem (map {
				/^([0-9a-f]+) (.*)$/;
				[$1 => $2];
			} split(/\n/, $ARGV[2])) {
			if (!exists $not_in_next{$elem->[0]}) {
				if ($msg) {
					print STDERR $msg;
					undef $msg;
				}
				print STDERR " $elem->[1]\n";
			}
		}
	' "$topic" "$not_in_next" "$not_in_master"
	exit 1
fi

<<\DOC_END

This sample hook safeguards topic branches that have been
published from being rewound.

The workflow assumed here is:

 * Once a topic branch forks from "master", "master" is never
   merged into it again (either directly or indirectly).

 * Once a topic branch is fully cooked and merged into "master",
   it is deleted.  If you need to build on top of it to correct
   earlier mistakes, a new topic branch is created by forking at
   the tip of the "master".  This is not strictly necessary, but
   it makes it easier to keep your history simple.

 * Whenever you need to test or publish your changes to topic
   branches, merge them into "next" branch.

The script, being an example, hardcodes the publish branch name
to be "next", but it is trivial to make it configurable via
$GIT_DIR/config mechanism.

With this workflow, you would want to know:

(1) ... if a topic branch has ever been merged to "next".  Young
    topic branches can have stupid mistakes you would rather
    clean up before publishing, and things that have not been
    merged into other branches can be easily rebased without
    affecting other people.  But once it is published, you would
    not want to rewind it.

(2) ... if a topic branch has been fully merged to "master".
    Then you can delete it.  More importantly, you should not
    build on top of it -- other people may already want to
    change things related to the topic as patches against your
    "master", so if you need further changes, it is better to
    fork the topic (perhaps with the same name) afresh from the
    tip of "master".

Let's look at this example:

		   o---o---o---o---o---o---o---o---o---o "next"
		  /       /           /           /
		 /   a---a---b A     /           /
		/   /               /           /
	       /   /   c---c---c---c B         /
	      /   /   /             \         /
	     /   /   /   b---b C     \       /
	    /   /   /   /             \     /
    ---o---o---o---o---o---o---o---o---o---o---o "master"


A, B and C are topic branches.

 * A has one fix since it was merged up to "next".

 * B has finished.  It has been fully merged up to "master" and "next",
   and is ready to be deleted.

 * C has not merged to "next" at all.

We would want to allow C to be rebased, refuse A, and encourage
B to be deleted.

To compute (1):

	git rev-list ^master ^topic next
	git rev-list ^master        next

	if these match, topic has not merged in next at all.

To compute (2):

	git rev-list master..topic

	if this is empty, it is fully merged to "master".

DOC_END
</file>

<file path="betternotes/.git/hooks/pre-receive.sample">
#!/bin/sh
#
# An example hook script to make use of push options.
# The example simply echoes all push options that start with 'echoback='
# and rejects all pushes when the "reject" push option is used.
#
# To enable this hook, rename this file to "pre-receive".

if test -n "$GIT_PUSH_OPTION_COUNT"
then
	i=0
	while test "$i" -lt "$GIT_PUSH_OPTION_COUNT"
	do
		eval "value=\$GIT_PUSH_OPTION_$i"
		case "$value" in
		echoback=*)
			echo "echo from the pre-receive-hook: ${value#*=}" >&2
			;;
		reject)
			exit 1
		esac
		i=$((i + 1))
	done
fi
</file>

<file path="betternotes/.git/hooks/prepare-commit-msg.sample">
#!/bin/sh
#
# An example hook script to prepare the commit log message.
# Called by "git commit" with the name of the file that has the
# commit message, followed by the description of the commit
# message's source.  The hook's purpose is to edit the commit
# message file.  If the hook fails with a non-zero status,
# the commit is aborted.
#
# To enable this hook, rename this file to "prepare-commit-msg".

# This hook includes three examples. The first one removes the
# "# Please enter the commit message..." help message.
#
# The second includes the output of "git diff --name-status -r"
# into the message, just before the "git status" output.  It is
# commented because it doesn't cope with --amend or with squashed
# commits.
#
# The third example adds a Signed-off-by line to the message, that can
# still be edited.  This is rarely a good idea.

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3

/usr/bin/perl -i.bak -ne 'print unless(m/^. Please enter the commit message/..m/^#$/)' "$COMMIT_MSG_FILE"

# case "$COMMIT_SOURCE,$SHA1" in
#  ,|template,)
#    /usr/bin/perl -i.bak -pe '
#       print "\n" . `git diff --cached --name-status -r`
# 	 if /^#/ && $first++ == 0' "$COMMIT_MSG_FILE" ;;
#  *) ;;
# esac

# SOB=$(git var GIT_COMMITTER_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# git interpret-trailers --in-place --trailer "$SOB" "$COMMIT_MSG_FILE"
# if test -z "$COMMIT_SOURCE"
# then
#   /usr/bin/perl -i.bak -pe 'print "\n" if !$first_line++' "$COMMIT_MSG_FILE"
# fi
</file>

<file path="betternotes/.git/hooks/push-to-checkout.sample">
#!/bin/sh

# An example hook script to update a checked-out tree on a git push.
#
# This hook is invoked by git-receive-pack(1) when it reacts to git
# push and updates reference(s) in its repository, and when the push
# tries to update the branch that is currently checked out and the
# receive.denyCurrentBranch configuration variable is set to
# updateInstead.
#
# By default, such a push is refused if the working tree and the index
# of the remote repository has any difference from the currently
# checked out commit; when both the working tree and the index match
# the current commit, they are updated to match the newly pushed tip
# of the branch. This hook is to be used to override the default
# behaviour; however the code below reimplements the default behaviour
# as a starting point for convenient modification.
#
# The hook receives the commit with which the tip of the current
# branch is going to be updated:
commit=$1

# It can exit with a non-zero status to refuse the push (when it does
# so, it must not modify the index or the working tree).
die () {
	echo >&2 "$*"
	exit 1
}

# Or it can make any necessary changes to the working tree and to the
# index to bring them to the desired state when the tip of the current
# branch is updated to the new commit, and exit with a zero status.
#
# For example, the hook can simply run git read-tree -u -m HEAD "$1"
# in order to emulate git fetch that is run in the reverse direction
# with git push, as the two-tree form of git read-tree -u -m is
# essentially the same as git switch or git checkout that switches
# branches while keeping the local changes in the working tree that do
# not interfere with the difference between the branches.

# The below is a more-or-less exact translation to shell of the C code
# for the default behaviour for git's push-to-checkout hook defined in
# the push_to_deploy() function in builtin/receive-pack.c.
#
# Note that the hook will be executed from the repository directory,
# not from the working tree, so if you want to perform operations on
# the working tree, you will have to adapt your code accordingly, e.g.
# by adding "cd .." or using relative paths.

if ! git update-index -q --ignore-submodules --refresh
then
	die "Up-to-date check failed"
fi

if ! git diff-files --quiet --ignore-submodules --
then
	die "Working directory has unstaged changes"
fi

# This is a rough translation of:
#
#   head_has_history() ? "HEAD" : EMPTY_TREE_SHA1_HEX
if git cat-file -e HEAD 2>/dev/null
then
	head=HEAD
else
	head=$(git hash-object -t tree --stdin </dev/null)
fi

if ! git diff-index --quiet --cached --ignore-submodules $head --
then
	die "Working directory has staged changes"
fi

if ! git read-tree -u -m "$commit"
then
	die "Could not update working tree to new HEAD"
fi
</file>

<file path="betternotes/.git/hooks/sendemail-validate.sample">
#!/bin/sh

# An example hook script to validate a patch (and/or patch series) before
# sending it via email.
#
# The hook should exit with non-zero status after issuing an appropriate
# message if it wants to prevent the email(s) from being sent.
#
# To enable this hook, rename this file to "sendemail-validate".
#
# By default, it will only check that the patch(es) can be applied on top of
# the default upstream branch without conflicts in a secondary worktree. After
# validation (successful or not) of the last patch of a series, the worktree
# will be deleted.
#
# The following config variables can be set to change the default remote and
# remote ref that are used to apply the patches against:
#
#   sendemail.validateRemote (default: origin)
#   sendemail.validateRemoteRef (default: HEAD)
#
# Replace the TODO placeholders with appropriate checks according to your
# needs.

validate_cover_letter () {
	file="$1"
	# TODO: Replace with appropriate checks (e.g. spell checking).
	true
}

validate_patch () {
	file="$1"
	# Ensure that the patch applies without conflicts.
	git am -3 "$file" || return
	# TODO: Replace with appropriate checks for this patch
	# (e.g. checkpatch.pl).
	true
}

validate_series () {
	# TODO: Replace with appropriate checks for the whole series
	# (e.g. quick build, coding style checks, etc.).
	true
}

# main -------------------------------------------------------------------------

if test "$GIT_SENDEMAIL_FILE_COUNTER" = 1
then
	remote=$(git config --default origin --get sendemail.validateRemote) &&
	ref=$(git config --default HEAD --get sendemail.validateRemoteRef) &&
	worktree=$(mktemp --tmpdir -d sendemail-validate.XXXXXXX) &&
	git worktree add -fd --checkout "$worktree" "refs/remotes/$remote/$ref" &&
	git config --replace-all sendemail.validateWorktree "$worktree"
else
	worktree=$(git config --get sendemail.validateWorktree)
fi || {
	echo "sendemail-validate: error: failed to prepare worktree" >&2
	exit 1
}

unset GIT_DIR GIT_WORK_TREE
cd "$worktree" &&

if grep -q "^diff --git " "$1"
then
	validate_patch "$1"
else
	validate_cover_letter "$1"
fi &&

if test "$GIT_SENDEMAIL_FILE_COUNTER" = "$GIT_SENDEMAIL_FILE_TOTAL"
then
	git config --unset-all sendemail.validateWorktree &&
	trap 'git worktree remove -ff "$worktree"' EXIT &&
	validate_series
fi
</file>

<file path="betternotes/.git/hooks/update.sample">
#!/bin/sh
#
# An example hook script to block unannotated tags from entering.
# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
#
# To enable this hook, rename this file to "update".
#
# Config
# ------
# hooks.allowunannotated
#   This boolean sets whether unannotated tags will be allowed into the
#   repository.  By default they won't be.
# hooks.allowdeletetag
#   This boolean sets whether deleting tags will be allowed in the
#   repository.  By default they won't be.
# hooks.allowmodifytag
#   This boolean sets whether a tag may be modified after creation. By default
#   it won't be.
# hooks.allowdeletebranch
#   This boolean sets whether deleting branches will be allowed in the
#   repository.  By default they won't be.
# hooks.denycreatebranch
#   This boolean sets whether remotely creating branches will be denied
#   in the repository.  By default this is allowed.
#

# --- Command line
refname="$1"
oldrev="$2"
newrev="$3"

# --- Safety check
if [ -z "$GIT_DIR" ]; then
	echo "Don't run this script from the command line." >&2
	echo " (if you want, you could supply GIT_DIR then run" >&2
	echo "  $0 <ref> <oldrev> <newrev>)" >&2
	exit 1
fi

if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
	echo "usage: $0 <ref> <oldrev> <newrev>" >&2
	exit 1
fi

# --- Config
allowunannotated=$(git config --type=bool hooks.allowunannotated)
allowdeletebranch=$(git config --type=bool hooks.allowdeletebranch)
denycreatebranch=$(git config --type=bool hooks.denycreatebranch)
allowdeletetag=$(git config --type=bool hooks.allowdeletetag)
allowmodifytag=$(git config --type=bool hooks.allowmodifytag)

# check for no description
projectdesc=$(sed -e '1q' "$GIT_DIR/description")
case "$projectdesc" in
"Unnamed repository"* | "")
	echo "*** Project description file hasn't been set" >&2
	exit 1
	;;
esac

# --- Check types
# if $newrev is 0000...0000, it's a commit to delete a ref.
zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')
if [ "$newrev" = "$zero" ]; then
	newrev_type=delete
else
	newrev_type=$(git cat-file -t $newrev)
fi

case "$refname","$newrev_type" in
	refs/tags/*,commit)
		# un-annotated tag
		short_refname=${refname##refs/tags/}
		if [ "$allowunannotated" != "true" ]; then
			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
			exit 1
		fi
		;;
	refs/tags/*,delete)
		# delete tag
		if [ "$allowdeletetag" != "true" ]; then
			echo "*** Deleting a tag is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/tags/*,tag)
		# annotated tag
		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
		then
			echo "*** Tag '$refname' already exists." >&2
			echo "*** Modifying a tag is not allowed in this repository." >&2
			exit 1
		fi
		;;
	refs/heads/*,commit)
		# branch
		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
			echo "*** Creating a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/heads/*,delete)
		# delete branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/remotes/*,commit)
		# tracking branch
		;;
	refs/remotes/*,delete)
		# delete tracking branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a tracking branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	*)
		# Anything else (is there anything else?)
		echo "*** Update hook: unknown type of update to ref $refname of type $newrev_type" >&2
		exit 1
		;;
esac

# --- Finished
exit 0
</file>

<file path="betternotes/.git/info/exclude">
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~
</file>

<file path="betternotes/.git/logs/refs/heads/main">
0000000000000000000000000000000000000000 5dcfd0c41b45a563dc94422c9f3bc7edb9e50ea2 Prayas <157107022+newprayas@users.noreply.github.com> 1762348403 +0600	commit (initial): Initial commit from Create Next App
5dcfd0c41b45a563dc94422c9f3bc7edb9e50ea2 e14d290505dfffe4dd0c8b5d519f813523950959 Prayas <157107022+newprayas@users.noreply.github.com> 1762349166 +0600	commit: ✅ FOUNDATION
e14d290505dfffe4dd0c8b5d519f813523950959 83f0517cddf41be91f2017cb080caa430bc6eb30 Prayas <157107022+newprayas@users.noreply.github.com> 1762349655 +0600	commit: Implement Better Notes V2 website with all features
83f0517cddf41be91f2017cb080caa430bc6eb30 4337f6ad69f968a354ccb83b0f40b18c46ec29c0 Prayas <157107022+newprayas@users.noreply.github.com> 1762351054 +0600	commit: vercel
4337f6ad69f968a354ccb83b0f40b18c46ec29c0 f1e5445929a8bd055eb340315f4aff5b1a25fbe6 Prayas <157107022+newprayas@users.noreply.github.com> 1762351742 +0600	commit: Add Sanity Studio configuration
f1e5445929a8bd055eb340315f4aff5b1a25fbe6 f935f3d64675159643019bec9ff6d425bf984edc Prayas <157107022+newprayas@users.noreply.github.com> 1762356261 +0600	commit: Working
</file>

<file path="betternotes/.git/logs/refs/remotes/origin/main">
0000000000000000000000000000000000000000 e14d290505dfffe4dd0c8b5d519f813523950959 Prayas <157107022+newprayas@users.noreply.github.com> 1762349218 +0600	update by push
e14d290505dfffe4dd0c8b5d519f813523950959 83f0517cddf41be91f2017cb080caa430bc6eb30 Prayas <157107022+newprayas@users.noreply.github.com> 1762349670 +0600	update by push
83f0517cddf41be91f2017cb080caa430bc6eb30 4337f6ad69f968a354ccb83b0f40b18c46ec29c0 Prayas <157107022+newprayas@users.noreply.github.com> 1762351059 +0600	update by push
4337f6ad69f968a354ccb83b0f40b18c46ec29c0 f1e5445929a8bd055eb340315f4aff5b1a25fbe6 Prayas <157107022+newprayas@users.noreply.github.com> 1762351748 +0600	update by push
</file>

<file path="betternotes/.git/logs/HEAD">
0000000000000000000000000000000000000000 5dcfd0c41b45a563dc94422c9f3bc7edb9e50ea2 Prayas <157107022+newprayas@users.noreply.github.com> 1762348403 +0600	commit (initial): Initial commit from Create Next App
5dcfd0c41b45a563dc94422c9f3bc7edb9e50ea2 e14d290505dfffe4dd0c8b5d519f813523950959 Prayas <157107022+newprayas@users.noreply.github.com> 1762349166 +0600	commit: ✅ FOUNDATION
e14d290505dfffe4dd0c8b5d519f813523950959 83f0517cddf41be91f2017cb080caa430bc6eb30 Prayas <157107022+newprayas@users.noreply.github.com> 1762349655 +0600	commit: Implement Better Notes V2 website with all features
83f0517cddf41be91f2017cb080caa430bc6eb30 4337f6ad69f968a354ccb83b0f40b18c46ec29c0 Prayas <157107022+newprayas@users.noreply.github.com> 1762351054 +0600	commit: vercel
4337f6ad69f968a354ccb83b0f40b18c46ec29c0 f1e5445929a8bd055eb340315f4aff5b1a25fbe6 Prayas <157107022+newprayas@users.noreply.github.com> 1762351742 +0600	commit: Add Sanity Studio configuration
f1e5445929a8bd055eb340315f4aff5b1a25fbe6 f935f3d64675159643019bec9ff6d425bf984edc Prayas <157107022+newprayas@users.noreply.github.com> 1762356261 +0600	commit: Working
</file>

<file path="betternotes/.git/refs/heads/main">
f935f3d64675159643019bec9ff6d425bf984edc
</file>

<file path="betternotes/.git/refs/remotes/origin/main">
f1e5445929a8bd055eb340315f4aff5b1a25fbe6
</file>

<file path="betternotes/.git/COMMIT_EDITMSG">
Working
</file>

<file path="betternotes/.git/config">
[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
	ignorecase = true
	precomposeunicode = true
[remote "origin"]
	url = https://github.com/newprayas/better-notes-v2.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "main"]
	remote = origin
	merge = refs/heads/main
</file>

<file path="betternotes/.git/description">
Unnamed repository; edit this file 'description' to name the repository.
</file>

<file path="betternotes/.git/FETCH_HEAD">
83f0517cddf41be91f2017cb080caa430bc6eb30		branch 'main' of https://github.com/newprayas/better-notes-v2
</file>

<file path="betternotes/.git/HEAD">
ref: refs/heads/main
</file>

<file path="betternotes/.git/ORIG_HEAD">
4337f6ad69f968a354ccb83b0f40b18c46ec29c0
</file>

<file path="betternotes/.sanity/runtime/app.js">
// This file is auto-generated on 'sanity dev'
// Modifications to this file are automatically discarded
import studioConfig from "../../sanity.config.ts"
import {renderStudio} from "sanity"

renderStudio(
  document.getElementById("sanity"),
  studioConfig,
  {reactStrictMode: false, basePath: "/"}
)
</file>

<file path="betternotes/.sanity/runtime/index.html">
<!DOCTYPE html><html lang="en">
<!--
This file is auto-generated from "sanity dev".
Modifications to this file are automatically discarded.
-->
<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/><meta name="robots" content="noindex"/><meta name="referrer" content="same-origin"/><link rel="icon" href="/static/favicon.ico" sizes="any"/><link rel="icon" href="/static/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/static/apple-touch-icon.png"/><link rel="manifest" href="/static/manifest.webmanifest"/><title>Sanity Studio</title><script>
;(function () {
  // The error channel is provided so that error handling can be delegated to a view component.
  // If there is a subscriber to the error channel at the time the error happens, the error will be pushed to the subscriber instead of handled here.
  var errorChannel = (function () {
    var subscribers = Object.create(null)
    var nextId = 0
    function subscribe(subscriber) {
      var id = nextId++
      subscribers[id] = subscriber
      return function unsubscribe() {
        delete subscribers[id]
      }
    }

    function publish(event) {
      for (var id in subscribers) {
        if (Object.hasOwn(subscribers, id)) {
          subscribers[id](event)
        }
      }
    }
    return {
      subscribers,
      publish,
      subscribe
    }
  })()

  // NOTE: Store the error channel instance in the global scope so that the Studio application can
  // access it and subscribe to errors.
  window.__sanityErrorChannel = {
    subscribe: errorChannel.subscribe
  }

  function _handleError(event) {
    // If there are error channel subscribers, then we assume they will own error rendering,
    // and we defer to them (no console error).
    if (Object.keys(errorChannel.subscribers).length > 0) {
      errorChannel.publish(event)
    } else {
      _renderErrorOverlay(event)
    }
  }

  var ERROR_BOX_STYLE = [
    'background: #fff',
    'border-radius: 6px',
    'box-sizing: border-box',
    'color: #121923',
    'flex: 1',
    "font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','Liberation Sans',Helvetica,Arial,system-ui,sans-serif",
    'font-size: 16px',
    'line-height: 21px',
    'margin: 0 auto',
    'max-width: 960px',
    'max-height: 90dvh',
    'overflow: auto',
    'padding: 20px',
    'width: 100%',
  ].join(';')

  var ERROR_CODE_STYLE = [
    'color: #972E2A',
    "font-family: -apple-system-ui-monospace, 'SF Mono', Menlo, Monaco, Consolas, monospace",
    'font-size: 13px',
    'line-height: 17px',
    'margin: 0',
  ].join(';')

  function _renderErrorOverlay(event) {
    var errorElement = document.querySelector('#__sanityError') || document.createElement('div')
    var error = event.error
    var colno = event.colno
    var lineno = event.lineno
    var filename = event.filename

    errorElement.id = '__sanityError'
    errorElement.innerHTML = [
      '<div style="' + ERROR_BOX_STYLE + '">',
      '<div style="font-weight: 700;">Uncaught error: ' + error.message + '</div>',
      '<div style="color: #515E72; font-size: 13px; line-height: 17px; margin: 10px 0;">' +
        filename +
        ':' +
        lineno +
        ':' +
        colno +
        '</div>',
      '<pre style="' + ERROR_CODE_STYLE + '">' + error.stack + '</pre>',
      '</div>',
    ].join('')

    errorElement.style.position = 'fixed'
    errorElement.style.zIndex = 1000000
    errorElement.style.top = 0
    errorElement.style.left = 0
    errorElement.style.right = 0
    errorElement.style.bottom = 0
    errorElement.style.padding = '20px'
    errorElement.style.background = 'rgba(16,17,18,0.66)'
    errorElement.style.display = 'flex'
    errorElement.style.alignItems = 'center'
    errorElement.style.justifyContent = 'center'

    document.body.appendChild(errorElement)
  }

  // Error listener
  window.addEventListener('error', (event) => {
    _handleError({
      type: 'error',
      error: event.error,
      lineno: event.lineno,
      colno: event.colno,
      filename: event.filename
    })
  })

  // Error listener
  window.addEventListener('unhandledrejection', (event) => {
    _handleError({
      type: 'rejection',
      error: event.reason
    })
  })
})()
</script><style>
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Regular.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 400;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Italic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 500;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Medium.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 500;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-MediumItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 600;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-SemiBold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 600;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-SemiBoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 700;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Bold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 700;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-BoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 800;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-ExtraBold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 800;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-ExtraBoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 900;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Black.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 900;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-BlackItalic.woff2") format("woff2");
  }
  html {
    @media (prefers-color-scheme: dark) {
      background-color: #13141b;
    }
    @media (prefers-color-scheme: light) {
      background-color: #ffffff;
    }
  }
  html,
  body,
  #sanity {
    height: 100%;
  }
  body {
    margin: 0;
    -webkit-font-smoothing: antialiased;
  }
</style><script src="https://core.sanity-cdn.com/bridge.js" async type="module" data-sanity-core></script>
</head><body><div id="sanity"></div><script type="module" src="/.sanity/runtime/app.js"></script><noscript><div class="sanity-app-no-js__root"><div class="sanity-app-no-js__content"><style type="text/css">
.sanity-app-no-js__root {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  background: #fff;
}

.sanity-app-no-js__content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  font-family: helvetica, arial, sans-serif;
}
</style><h1>JavaScript disabled</h1><p>Please <a href="https://www.enable-javascript.com/">enable JavaScript</a> in your browser and reload the page to proceed.</p></div></div></noscript></body></html>
</file>

<file path="betternotes/app/checkout/page.tsx">
'use client';

import { useState } from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { 
  ArrowLeft, 
  Trash2, 
  Plus, 
  Minus, 
  Tag, 
  Send, 
  Check,
  X,
  Copy
} from 'lucide-react';
import Header from '@/components/layout/header';
import Footer from '@/components/layout/footer';
import { useCart } from '@/lib/cart-context';
import { validateDiscountCode } from '@/lib/sanity/api';

export default function CheckoutPage() {
  const { cart, removeFromCart, updateQuantity, clearCart, applyDiscountCode, removeDiscountCode } = useCart();
  const [discountCodeInput, setDiscountCodeInput] = useState('');
  const [isApplyingDiscount, setIsApplyingDiscount] = useState(false);
  const [discountError, setDiscountError] = useState('');
  const [orderPlaced, setOrderPlaced] = useState(false);
  const [copiedToClipboard, setCopiedToClipboard] = useState(false);

  const handleApplyDiscountCode = async () => {
    if (!discountCodeInput.trim()) return;
    
    setIsApplyingDiscount(true);
    setDiscountError('');
    
    try {
      // In a real app, we would validate the discount code with Sanity
      // For now, we'll simulate a discount code validation
      if (discountCodeInput.toLowerCase() === 'student10') {
        applyDiscountCode(discountCodeInput, 10);
        setDiscountCodeInput('');
      } else if (discountCodeInput.toLowerCase() === 'welcome20') {
        applyDiscountCode(discountCodeInput, 20);
        setDiscountCodeInput('');
      } else {
        setDiscountError('Invalid discount code');
      }
    } catch (error) {
      setDiscountError('Failed to apply discount code');
    } finally {
      setIsApplyingDiscount(false);
    }
  };

  const handleRemoveDiscountCode = () => {
    removeDiscountCode();
  };

  const handlePlaceOrder = () => {
    // In a real app, this would process the order
    setOrderPlaced(true);
    clearCart();
  };

  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text);
    setCopiedToClipboard(true);
    setTimeout(() => setCopiedToClipboard(false), 2000);
  };

  const telegramUsername = '@betternotes';
  const orderMessage = `Hi! I'd like to purchase the following notes:\n\n${cart.items.map(item => `${item.note.title} (x${item.quantity}) - ₹${item.note.price * item.quantity}`).join('\n')}\n\nTotal: ₹${cart.finalTotal}`;

  if (orderPlaced) {
    return (
      <div className="min-h-screen flex flex-col">
        <Header />
        
        <main className="flex-grow bg-gray-50 py-12">
          <div className="container">
            <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-sm p-8 text-center">
              <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Check className="w-8 h-8 text-green-600" />
              </div>
              
              <h1 className="text-2xl font-bold text-black mb-4">Order Placed Successfully!</h1>
              
              <p className="text-gray-700 mb-6">
                Thank you for your order! Please contact us on Telegram to complete your purchase and receive your notes.
              </p>
              
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
                <h2 className="text-lg font-semibold mb-4">Next Steps:</h2>
                <ol className="text-left space-y-2">
                  <li>1. Contact us on Telegram with your order details</li>
                  <li>2. Complete the payment through your preferred method</li>
                  <li>3. Receive your notes via Telegram or email</li>
                </ol>
              </div>
              
              <div className="bg-gray-100 rounded-lg p-4 mb-6">
                <p className="font-semibold mb-2">Telegram Contact:</p>
                <div className="flex items-center justify-center">
                  <Send className="w-5 h-5 mr-2 text-blue-500" />
                  <span className="text-lg">{telegramUsername}</span>
                  <button
                    onClick={() => copyToClipboard(telegramUsername)}
                    className="ml-2 p-1 rounded hover:bg-gray-200 transition-colors"
                    title="Copy to clipboard"
                  >
                    {copiedToClipboard ? (
                      <Check className="w-4 h-4 text-green-600" />
                    ) : (
                      <Copy className="w-4 h-4 text-gray-600" />
                    )}
                  </button>
                </div>
              </div>
              
              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <a
                  href={`https://t.me/${telegramUsername.replace('@', '')}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="btn-primary"
                >
                  <Send className="w-5 h-5 mr-2" />
                  Contact on Telegram
                </a>
                <Link href="/" className="btn-outline">
                  Continue Shopping
                </Link>
              </div>
            </div>
          </div>
        </main>
        
        <Footer />
      </div>
    );
  }

  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      
      <main className="flex-grow bg-gray-50 py-8">
        <div className="container">
          <div className="mb-6">
            <Link href="/notes" className="flex items-center text-gray-600 hover:text-black transition-colors">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Continue Shopping
            </Link>
          </div>

          {cart.items.length === 0 ? (
            <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-sm p-8 text-center">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <X className="w-8 h-8 text-gray-400" />
              </div>
              
              <h1 className="text-2xl font-bold text-black mb-4">Your Cart is Empty</h1>
              
              <p className="text-gray-700 mb-6">
                Looks like you haven't added any notes to your cart yet.
              </p>
              
              <Link href="/notes" className="btn-primary">
                Browse Notes
              </Link>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              {/* Cart Items */}
              <div className="lg:col-span-2">
                <div className="bg-white rounded-lg shadow-sm p-6">
                  <h1 className="text-xl font-bold text-black mb-6">Shopping Cart</h1>
                  
                  <div className="space-y-4">
                    {cart.items.map((item) => (
                      <div key={item.note._id} className="flex gap-4 pb-4 border-b border-gray-200 last:border-0">
                        <div className="w-20 h-20 bg-gray-200 rounded-lg flex-shrink-0 flex items-center justify-center">
                          <Image
                            src="/placeholder.svg"
                            alt={item.note.title}
                            width={80}
                            height={80}
                            className="rounded-lg"
                          />
                        </div>
                        
                        <div className="flex-grow">
                          <h3 className="font-semibold text-black mb-1">{item.note.title}</h3>
                          <p className="text-sm text-gray-600 mb-2">{item.note.subject.replace('-', ' ')}</p>
                          
                          <div className="flex items-center justify-between">
                            <div className="flex items-center">
                              <button
                                onClick={() => updateQuantity(item.note._id, item.quantity - 1)}
                                className="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 transition-colors"
                              >
                                <Minus className="w-4 h-4" />
                              </button>
                              
                              <span className="w-12 text-center">{item.quantity}</span>
                              
                              <button
                                onClick={() => updateQuantity(item.note._id, item.quantity + 1)}
                                className="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 transition-colors"
                              >
                                <Plus className="w-4 h-4" />
                              </button>
                            </div>
                            
                            <div className="text-right">
                              <p className="font-semibold">₹{item.note.price * item.quantity}</p>
                              <p className="text-sm text-gray-500">₹{item.note.price} each</p>
                            </div>
                          </div>
                        </div>
                        
                        <button
                          onClick={() => removeFromCart(item.note._id)}
                          className="p-2 rounded-full hover:bg-gray-100 transition-colors"
                        >
                          <Trash2 className="w-5 h-5 text-gray-500" />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Order Summary */}
              <div>
                <div className="bg-white rounded-lg shadow-sm p-6 mb-4">
                  <h2 className="text-xl font-bold text-black mb-6">Order Summary</h2>
                  
                  <div className="space-y-3 mb-6">
                    <div className="flex justify-between">
                      <span className="text-gray-600">Subtotal</span>
                      <span className="font-semibold">₹{cart.total}</span>
                    </div>
                    
                    {cart.discountCode && (
                      <div className="flex justify-between">
                        <span className="text-gray-600">Discount ({cart.discountCode})</span>
                        <span className="font-semibold text-green-600">-₹{cart.discountAmount}</span>
                      </div>
                    )}
                    
                    <div className="border-t border-gray-200 pt-3">
                      <div className="flex justify-between">
                        <span className="text-lg font-bold">Total</span>
                        <span className="text-lg font-bold">₹{cart.finalTotal}</span>
                      </div>
                    </div>
                  </div>

                  {/* Discount Code */}
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Discount Code
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={discountCodeInput}
                        onChange={(e) => setDiscountCodeInput(e.target.value)}
                        placeholder="Enter code"
                        className="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                      />
                      {cart.discountCode ? (
                        <button
                          onClick={handleRemoveDiscountCode}
                          className="px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded-md hover:bg-red-100 transition-colors"
                        >
                          Remove
                        </button>
                      ) : (
                        <button
                          onClick={handleApplyDiscountCode}
                          disabled={isApplyingDiscount || !discountCodeInput.trim()}
                          className="px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          {isApplyingDiscount ? 'Applying...' : 'Apply'}
                        </button>
                      )}
                    </div>
                    {discountError && (
                      <p className="mt-1 text-sm text-red-600">{discountError}</p>
                    )}
                  </div>

                  <button
                    onClick={handlePlaceOrder}
                    className="w-full btn-primary text-lg py-3"
                  >
                    Place Order
                  </button>
                  
                  <p className="text-xs text-gray-500 text-center mt-4">
                    By placing this order, you agree to contact us on Telegram to complete your purchase.
                  </p>
                </div>

                {/* Contact Information */}
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <h3 className="font-semibold text-blue-900 mb-2">How to Complete Your Order</h3>
                  <ol className="text-sm text-blue-800 space-y-1">
                    <li>1. Click "Place Order" to confirm your selection</li>
                    <li>2. Contact us on Telegram at {telegramUsername}</li>
                    <li>3. Share your order details and complete payment</li>
                    <li>4. Receive your notes instantly</li>
                  </ol>
                </div>
              </div>
            </div>
          )}
        </div>
      </main>
      
      <Footer />
    </div>
  );
}
</file>

<file path="betternotes/app/notes/[slug]/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import Image from 'next/image';
import {
  ArrowLeft,
  ShoppingCart,
  Star,
  Share2,
  Heart,
  Download,
  BookOpen,
  Calendar,
  Tag,
  Check
} from 'lucide-react';
import { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch';
import Header from '@/components/layout/header';
import Footer from '@/components/layout/footer';
import { useCart } from '@/lib/cart-context';
import { Note } from '@/types';
import { getNoteBySlug } from '@/lib/sanity/api';
import { urlFor } from '@/lib/sanity/client';

export default function NotePage() {
  const params = useParams();
  const slug = params.slug as string;
  
  const [note, setNote] = useState<Note | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [isAddedToCart, setIsAddedToCart] = useState(false);
  const [isLiked, setIsLiked] = useState(false);
  const { addToCart } = useCart();

  // Fetch the note data based on the slug
  useEffect(() => {
    async function fetchNote() {
      try {
        const noteData = await getNoteBySlug(slug);
        console.log("Fetched note data:", noteData);
        console.log("Images array:", noteData?.images);
        if (noteData?.images && noteData.images.length > 0) {
          console.log("First image:", noteData.images[0]);
          console.log("Image URL:", urlFor(noteData.images[0]).url());
        }
        setNote(noteData);
      } catch (error) {
        console.error("Failed to fetch note:", error);
      } finally {
        setIsLoading(false);
      }
    }
    fetchNote();
  }, [slug]);

  const handleAddToCart = () => {
    if (note) {
      addToCart(note);
      setIsAddedToCart(true);
      setTimeout(() => setIsAddedToCart(false), 2000);
    }
  };

  const handleShare = () => {
    if (note && navigator.share) {
      navigator.share({
        title: note.title,
        text: note.description,
        url: window.location.href,
      });
    } else {
      // Fallback for browsers that don't support Web Share API
      navigator.clipboard.writeText(window.location.href);
      alert('Link copied to clipboard!');
    }
  };

  const handleDownload = () => {
    // In a real app, this would trigger a download of the note
    alert('Download feature will be available after purchase');
  };

  const nextImage = () => {
    if (note && note.images.length > 0) {
      setCurrentImageIndex((prev) => (prev + 1) % note.images.length);
    }
  };

  const prevImage = () => {
    if (note && note.images.length > 0) {
      setCurrentImageIndex((prev) => (prev - 1 + note.images.length) % note.images.length);
    }
  };

  const formatSubject = (subject: string) => {
    return subject.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
  };

  const formatAcademicYear = (year: string) => {
    return year.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
  };


  if (isLoading) {
    return (
      <div className="min-h-screen flex flex-col">
        <Header />
        <main className="flex-grow bg-white flex items-center justify-center">
          <div className="text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-black mx-auto mb-4"></div>
            <p className="text-gray-600">Loading note details...</p>
          </div>
        </main>
        <Footer />
      </div>
    );
  }

  if (!note) {
    return (
      <div className="min-h-screen flex flex-col">
        <Header />
        <main className="flex-grow bg-white flex items-center justify-center">
          <div className="text-center">
            <BookOpen className="w-16 h-16 text-gray-300 mx-auto mb-4" />
            <h1 className="text-2xl font-bold text-gray-700 mb-2">Note Not Found</h1>
            <p className="text-gray-500 mb-4">The note you're looking for doesn't exist or has been removed.</p>
            <Link href="/notes" className="btn-primary">
              Browse All Notes
            </Link>
          </div>
        </main>
        <Footer />
      </div>
    );
  }

  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      
      <main className="flex-grow bg-white">
        <div className="container py-8">
          {/* Breadcrumb */}
          <div className="mb-6">
            <Link href="/notes" className="flex items-center text-gray-600 hover:text-black transition-colors">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Back to Notes
            </Link>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Image Gallery */}
            <div>
              {note.images && note.images.length > 0 ? (
                <div>
                  <div className="relative bg-gray-100 rounded-lg overflow-hidden" style={{ aspectRatio: '3/4' }}>
                    <TransformWrapper>
                      <TransformComponent>
                        <div className="w-full h-full flex items-center justify-center">
                          {note.images[currentImageIndex]?.asset ? (
                            <Image
                              src={urlFor(note.images[currentImageIndex]).width(800).height(600).url()}
                              alt={`${note.title} - Page ${currentImageIndex + 1}`}
                              fill
                              className="object-contain"
                              sizes="(max-width: 768px) 100vw, 50vw"
                              onError={(e) => {
                                console.error("Image failed to load:", e);
                                console.error("Image URL:", urlFor(note.images[currentImageIndex]).width(800).height(600).url());
                              }}
                              onLoad={() => {
                                console.log("Image loaded successfully");
                              }}
                            />
                          ) : (
                            <div className="text-center text-gray-500">
                              <BookOpen className="w-16 h-16 mx-auto mb-2" />
                              <p>Image not available</p>
                            </div>
                          )}
                        </div>
                      </TransformComponent>
                    </TransformWrapper>
                    
                    {/* Navigation Arrows */}
                    {note.images.length > 1 && (
                      <>
                        <button
                          onClick={prevImage}
                          className="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 rounded-full p-2 shadow-md hover:bg-opacity-100 transition-all"
                          aria-label="Previous image"
                        >
                          <ArrowLeft className="w-5 h-5" />
                        </button>
                        <button
                          onClick={nextImage}
                          className="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 rounded-full p-2 shadow-md hover:bg-opacity-100 transition-all"
                          aria-label="Next image"
                        >
                          <ArrowLeft className="w-5 h-5 rotate-180" />
                        </button>
                      </>
                    )}
                  </div>
                  
                  {/* Thumbnail Gallery */}
                  {note.images.length > 1 && (
                    <div className="flex gap-2 mt-4 overflow-x-auto">
                      {note.images.map((image, index) => (
                        <button
                          key={index}
                          onClick={() => setCurrentImageIndex(index)}
                          className={`flex-shrink-0 w-20 h-20 rounded-md overflow-hidden border-2 transition-all ${
                            index === currentImageIndex ? 'border-yellow-400' : 'border-gray-200'
                          }`}
                        >
                          <div className="relative w-full h-full">
                            {image?.asset ? (
                              <Image
                                src={urlFor(image).width(80).height(80).url()}
                                alt={`${note.title} - Page ${index + 1}`}
                                fill
                                className="object-cover"
                                sizes="80px"
                                onError={(e) => {
                                  console.error("Thumbnail failed to load:", e);
                                  console.error("Thumbnail URL:", urlFor(image).width(80).height(80).url());
                                }}
                              />
                            ) : (
                              <div className="w-full h-full bg-gray-200 flex items-center justify-center">
                                <BookOpen className="w-6 h-6 text-gray-400" />
                              </div>
                            )}
                          </div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              ) : (
                <div className="relative bg-gray-100 rounded-lg overflow-hidden" style={{ aspectRatio: '3/4' }}>
                  <div className="w-full h-full bg-gray-200 flex items-center justify-center">
                    <BookOpen className="w-24 h-24 text-gray-400" />
                  </div>
                </div>
              )}
            </div>

            {/* Note Details */}
            <div>
              {/* Badges */}
              <div className="flex flex-wrap gap-2 mb-4">
                <span className="px-3 py-1 bg-yellow-100 text-black text-sm font-semibold rounded">
                  {formatSubject(note.subject)}
                </span>
                <span className="px-3 py-1 bg-gray-100 text-gray-700 text-sm font-semibold rounded">
                  {formatAcademicYear(note.academicYear)}
                </span>
              </div>

              {/* Title */}
              <h1 className="text-2xl md:text-3xl font-bold text-black mb-4">{note.title}</h1>

              {/* Rating and Reviews */}
              <div className="flex items-center mb-6">
                <div className="flex text-yellow-400 mr-2">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="w-5 h-5 fill-current" />
                  ))}
                </div>
                <span className="text-gray-600 mr-2">4.8</span>
                <span className="text-gray-500">(124 reviews)</span>
              </div>

              {/* Description */}
              <div className="mb-6">
                <h2 className="text-lg font-semibold mb-2">Description</h2>
                <p className="text-gray-700 leading-relaxed">{note.description}</p>
              </div>

              {/* Tags */}
              {note.tags && note.tags.length > 0 && (
                <div className="mb-6">
                  <h2 className="text-lg font-semibold mb-2">Tags</h2>
                  <div className="flex flex-wrap gap-2">
                    {note.tags.map((tag, index) => (
                      <span key={index} className="flex items-center px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full">
                        <Tag className="w-3 h-3 mr-1" />
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Additional Info */}
              <div className="mb-6">
                <h2 className="text-lg font-semibold mb-2">Additional Information</h2>
                <div className="space-y-2">
                  <div className="flex items-center text-gray-700">
                    <Calendar className="w-4 h-4 mr-2 text-gray-500" />
                    Last updated: {new Date(note.updatedAt).toLocaleDateString()}
                  </div>
                  <div className="flex items-center text-gray-700">
                    <BookOpen className="w-4 h-4 mr-2 text-gray-500" />
                    Pages: 45 (estimated)
                  </div>
                  <div className="flex items-center text-gray-700">
                    <Download className="w-4 h-4 mr-2 text-gray-500" />
                    Format: PDF
                  </div>
                </div>
              </div>

              {/* Price and Actions */}
              <div className="border-t border-gray-200 pt-6">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    {note.originalPrice && (
                      <span className="text-gray-400 line-through text-lg mr-2">
                        ₹{note.originalPrice}
                      </span>
                    )}
                    <span className="text-3xl font-bold text-black">₹{note.price}</span>
                  </div>
                  {note.originalPrice && (
                    <span className="px-2 py-1 bg-red-100 text-red-700 text-sm font-semibold rounded">
                      {Math.round(((note.originalPrice - note.price) / note.originalPrice) * 100)}% OFF
                    </span>
                  )}
                </div>

                <div className="flex flex-col sm:flex-row gap-3">
                  <button
                    onClick={handleAddToCart}
                    disabled={isAddedToCart}
                    className={`flex-1 flex items-center justify-center px-6 py-3 rounded-md font-medium transition-colors ${
                      isAddedToCart
                        ? 'bg-green-500 text-white'
                        : 'bg-black text-white hover:bg-gray-800'
                    }`}
                  >
                    {isAddedToCart ? (
                      <>
                        <Check className="w-5 h-5 mr-2" />
                        Added to Cart
                      </>
                    ) : (
                      <>
                        <ShoppingCart className="w-5 h-5 mr-2" />
                        Add to Cart
                      </>
                    )}
                  </button>
                  
                  <button
                    onClick={() => setIsLiked(!isLiked)}
                    className={`px-4 py-3 rounded-md border transition-colors ${
                      isLiked
                        ? 'bg-red-50 border-red-300 text-red-600'
                        : 'bg-white border-gray-300 text-gray-700 hover:bg-gray-50'
                    }`}
                  >
                    <Heart className={`w-5 h-5 ${isLiked ? 'fill-current' : ''}`} />
                  </button>
                  
                  <button
                    onClick={handleShare}
                    className="px-4 py-3 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"
                  >
                    <Share2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      
      <Footer />
    </div>
  );
}
</file>

<file path="betternotes/app/notes/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import Image from 'next/image';
import { Search, Filter, Star, BookOpen, X } from 'lucide-react';
import Header from '@/components/layout/header';
import Footer from '@/components/layout/footer';
import { Note, NoteFilters } from '@/types';
import { getNotes, getAcademicYears, getSubjects } from '@/lib/sanity/api';
import { urlFor } from '@/lib/sanity/client';


const academicYears = [
  { value: 'first-year', label: 'First Year' },
  { value: 'second-year', label: 'Second Year' },
  { value: 'third-year', label: 'Third Year' },
  { value: 'fourth-year', label: 'Fourth Year' },
  { value: 'fifth-year', label: 'Fifth Year' },
];

const subjects = [
  { value: 'anatomy', label: 'Anatomy' },
  { value: 'physiology', label: 'Physiology' },
  { value: 'biochemistry', label: 'Biochemistry' },
  { value: 'pathology', label: 'Pathology' },
  { value: 'pharmacology', label: 'Pharmacology' },
  { value: 'microbiology', label: 'Microbiology' },
  { value: 'forensic-medicine', label: 'Forensic Medicine' },
  { value: 'community-medicine', label: 'Community Medicine' },
  { value: 'ent', label: 'ENT' },
  { value: 'ophthalmology', label: 'Ophthalmology' },
  { value: 'medicine', label: 'Medicine' },
  { value: 'surgery', label: 'Surgery' },
  { value: 'obgyn', label: 'Obstetrics & Gynecology' },
  { value: 'pediatrics', label: 'Pediatrics' },
];


export default function NotesPage() {
  const [notes, setNotes] = useState<Note[]>([]); // Start with an empty array
  const [filteredNotes, setFilteredNotes] = useState<Note[]>([]); // Start with an empty array
  const [searchTerm, setSearchTerm] = useState('');
  const [filters, setFilters] = useState<NoteFilters>({});
  const [isFilterOpen, setIsFilterOpen] = useState(false);
  const [isLoading, setIsLoading] = useState(true); // Add a loading state

  // Fetch data from Sanity when the component mounts
  useEffect(() => {
    async function fetchNotes() {
      try {
        const liveNotes = await getNotes();
        setNotes(liveNotes);
        setFilteredNotes(liveNotes);
      } catch (error) {
        console.error("Failed to fetch notes:", error);
      } finally {
        setIsLoading(false);
      }
    }
    fetchNotes();
  }, []);

  useEffect(() => {
    // Apply filters and search
    let result = [...notes];

    if (searchTerm) {
      result = result.filter(
        note =>
          note.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          note.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
          note.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
      );
    }

    if (filters.academicYear) {
      result = result.filter(note => note.academicYear === filters.academicYear);
    }

    if (filters.subject) {
      result = result.filter(note => note.subject === filters.subject);
    }


    setFilteredNotes(result);
  }, [notes, searchTerm, filters]);

  const handleFilterChange = (filterType: keyof NoteFilters, value: string) => {
    setFilters(prev => ({
      ...prev,
      [filterType]: value || undefined,
    }));
  };

  const clearFilters = () => {
    setFilters({});
    setSearchTerm('');
  };

  const activeFiltersCount = Object.values(filters).filter(Boolean).length;

  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      
      <main className="flex-grow bg-gray-50">
        <div className="container py-8">
          {/* Page Header */}
          <div className="mb-8">
            <h1 className="text-2xl md:text-3xl font-bold text-black mb-2">All Notes</h1>
            <p className="text-gray-600">Browse our comprehensive collection of medical notes</p>
          </div>

          {/* Search and Filters */}
          <div className="mb-8">
            <div className="flex flex-col md:flex-row gap-4 mb-4">
              {/* Search Bar */}
              <div className="relative flex-grow">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                <input
                  type="text"
                  placeholder="Search notes by title, subject, or tags..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                />
              </div>

              {/* Filter Toggle Button */}
              <button
                onClick={() => setIsFilterOpen(!isFilterOpen)}
                className="flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
              >
                <Filter className="w-5 h-5 mr-2" />
                Filters
                {activeFiltersCount > 0 && (
                  <span className="ml-2 px-2 py-1 bg-yellow-400 text-black text-xs font-semibold rounded-full">
                    {activeFiltersCount}
                  </span>
                )}
              </button>
            </div>

            {/* Filters Panel */}
            {isFilterOpen && (
              <div className="bg-white p-6 rounded-lg border border-gray-200 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="font-semibold text-lg">Filter Notes</h3>
                  <button
                    onClick={clearFilters}
                    className="text-sm text-gray-500 hover:text-gray-700"
                  >
                    Clear All
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {/* Academic Year Filter */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Academic Year
                    </label>
                    <select
                      value={filters.academicYear || ''}
                      onChange={(e) => handleFilterChange('academicYear', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                    >
                      <option value="">All Years</option>
                      {academicYears.map(year => (
                        <option key={year.value} value={year.value}>
                          {year.label}
                        </option>
                      ))}
                    </select>
                  </div>

                  {/* Subject Filter */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Subject
                    </label>
                    <select
                      value={filters.subject || ''}
                      onChange={(e) => handleFilterChange('subject', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                    >
                      <option value="">All Subjects</option>
                      {subjects.map(subject => (
                        <option key={subject.value} value={subject.value}>
                          {subject.label}
                        </option>
                      ))}
                    </select>
                  </div>

                </div>
              </div>
            )}

            {/* Active Filters Display */}
            {activeFiltersCount > 0 && (
              <div className="flex flex-wrap gap-2 mb-4">
                {filters.academicYear && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800">
                    Academic Year: {academicYears.find(y => y.value === filters.academicYear)?.label}
                    <button
                      onClick={() => handleFilterChange('academicYear', '')}
                      className="ml-2 text-gray-500 hover:text-gray-700"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                )}
                {filters.subject && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800">
                    Subject: {subjects.find(s => s.value === filters.subject)?.label}
                    <button
                      onClick={() => handleFilterChange('subject', '')}
                      className="ml-2 text-gray-500 hover:text-gray-700"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                )}
              </div>
            )}
          </div>

          {/* Results Count */}
          <div className="mb-6">
            <p className="text-gray-600">
              Showing {filteredNotes.length} {filteredNotes.length === 1 ? 'note' : 'notes'}
            </p>
          </div>

          {/* Notes Grid */}
          {isLoading ? (
            <div className="text-center py-12">Loading notes...</div>
          ) : filteredNotes.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {filteredNotes.map((note) => (
                <div key={note._id} className="card p-6 hover:shadow-lg transition-shadow">
                  <div className="aspect-video bg-gray-200 rounded-lg mb-4 overflow-hidden relative">
                    {note.coverImage ? (
                      <Image
                        src={urlFor(note.coverImage).url()}
                        alt={note.title}
                        fill
                        className="object-cover"
                        sizes="(max-width: 768px) 100vw, 33vw"
                      />
                    ) : (
                      <div className="w-full h-full bg-gray-200 flex items-center justify-center">
                        <BookOpen className="w-12 h-12 text-gray-400" />
                      </div>
                    )}
                  </div>
                  
                  <div className="mb-2">
                    <span className="inline-block px-2 py-1 bg-yellow-100 text-black text-xs font-semibold rounded mr-2">
                      {note.subject.replace('-', ' ')}
                    </span>
                    <span className="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded">
                      {note.academicYear.replace('-', ' ')}
                    </span>
                  </div>
                  
                  <h3 className="text-lg font-semibold mb-2">{note.title}</h3>
                  <p className="text-gray-600 text-sm mb-4 line-clamp-2">{note.description}</p>
                  
                  <div className="flex items-center mb-4">
                    <div className="flex text-yellow-400">
                      {[...Array(5)].map((_, i) => (
                        <Star key={i} className="w-4 h-4 fill-current" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-500 ml-2">(4.8)</span>
                  </div>
                  
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      {note.originalPrice && (
                        <span className="text-gray-400 line-through text-sm mr-2">
                          ₹{note.originalPrice}
                        </span>
                      )}
                      <span className="text-xl font-bold text-black">₹{note.price}</span>
                    </div>
                  </div>
                  
                  <Link href={`/notes/${note.slug}`} className="btn-primary w-full text-center">
                    View Details
                  </Link>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-12">
              <BookOpen className="w-16 h-16 text-gray-300 mx-auto mb-4" />
              <h3 className="text-xl font-semibold text-gray-700 mb-2">No notes found</h3>
              <p className="text-gray-500 mb-4">
                Try adjusting your search or filters to find what you're looking for.
              </p>
              <button
                onClick={clearFilters}
                className="btn-outline"
              >
                Clear Filters
              </button>
            </div>
          )}
        </div>
      </main>
      
      <Footer />
    </div>
  );
}
</file>

<file path="betternotes/app/globals.css">
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #000000;
  --primary: #000000;
  --accent: #FFD700; /* Gold/Yellow */
  --destructive: #FF0000; /* Red */
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  --color-accent: var(--accent);
  --color-destructive: var(--destructive);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  
  /* Mobile-first breakpoints */
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
}

/* Custom utility classes for the project */
.btn-primary {
  @apply bg-black text-white px-4 py-2 rounded-md font-medium hover:bg-gray-800 transition-colors;
}

.btn-accent {
  @apply bg-yellow-400 text-black px-4 py-2 rounded-md font-medium hover:bg-yellow-500 transition-colors;
}

.btn-outline {
  @apply border border-black text-black px-4 py-2 rounded-md font-medium hover:bg-black hover:text-white transition-colors;
}

.container {
  @apply w-full px-4 sm:px-6 lg:px-8 xl:px-12;
}

.card {
  @apply bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow;
}

.input-field {
  @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent;
}

/* Mobile-first responsive utilities */
@media (min-width: 640px) {
  .container {
    @apply max-w-screen-sm;
  }
}

@media (min-width: 768px) {
  .container {
    @apply max-w-screen-md;
  }
}

@media (min-width: 1024px) {
  .container {
    @apply max-w-screen-lg;
  }
}

@media (min-width: 1280px) {
  .container {
    @apply max-w-screen-xl;
  }
}

@media (min-width: 1536px) {
  .container {
    @apply max-w-screen-2xl;
  }
}
</file>

<file path="betternotes/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { CartProvider } from "@/lib/cart-context";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "@Better Notes V2 - Premium Medical Notes",
  description: "High-quality medical notes for MBBS students. Handwritten notes by a dedicated medical student covering all subjects and academic years.",
  keywords: "medical notes, MBBS, medical student, handwritten notes, medical education",
  authors: [{ name: "Medical Student" }],
  openGraph: {
    title: "@Better Notes V2 - Premium Medical Notes",
    description: "High-quality medical notes for MBBS students",
    type: "website",
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <CartProvider>
          {children}
        </CartProvider>
      </body>
    </html>
  );
}
</file>

<file path="betternotes/app/page.tsx">
import Link from 'next/link';
import Image from 'next/image';
import { ArrowRight, Star, BookOpen, Users, Award } from 'lucide-react';
import Header from '@/components/layout/header';
import Footer from '@/components/layout/footer';
import { getFeaturedNotes } from '@/lib/sanity/api';
import { Note } from '@/types';
import { urlFor } from '@/lib/sanity/client';

export default async function Home() {
  // We now fetch the data live from Sanity instead of using a placeholder!
  const featuredNotes: Note[] = await getFeaturedNotes();
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      
      <main className="flex-grow">
        {/* Hero Section */}
        <section className="bg-gradient-to-b from-yellow-50 to-white py-12 md:py-20">
          <div className="container">
            <div className="max-w-4xl mx-auto text-center">
              <h1 className="text-3xl md:text-5xl font-bold text-black mb-4 md:mb-6">
                Premium Medical Notes for MBBS Students
              </h1>
              <p className="text-lg md:text-xl text-gray-700 mb-6 md:mb-8 max-w-2xl mx-auto">
                High-quality, handwritten notes created by a dedicated medical student to help you excel in your studies and exams.
              </p>
              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <Link href="/notes" className="btn-primary text-lg px-6 py-3">
                  Browse All Notes
                  <ArrowRight className="ml-2 w-5 h-5" />
                </Link>
                <Link href="#featured" className="btn-outline text-lg px-6 py-3">
                  View Featured
                </Link>
              </div>
            </div>
          </div>
        </section>

        {/* Features Section */}
        <section className="py-12 md:py-16 bg-white">
          <div className="container">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div className="text-center">
                <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <BookOpen className="w-8 h-8 text-black" />
                </div>
                <h3 className="text-xl font-semibold mb-2">Comprehensive Coverage</h3>
                <p className="text-gray-600">
                  Complete notes covering all subjects and academic years for MBBS students.
                </p>
              </div>
              <div className="text-center">
                <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Users className="w-8 h-8 text-black" />
                </div>
                <h3 className="text-xl font-semibold mb-2">Student Approved</h3>
                <p className="text-gray-600">
                  Trusted by hundreds of medical students across different universities.
                </p>
              </div>
              <div className="text-center">
                <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Award className="w-8 h-8 text-black" />
                </div>
                <h3 className="text-xl font-semibold mb-2">Exam Focused</h3>
                <p className="text-gray-600">
                  Specially designed to help you score high in university and entrance exams.
                </p>
              </div>
            </div>
          </div>
        </section>

        {/* Featured Notes Section */}
        <section id="featured" className="py-12 md:py-16 bg-gray-50">
          <div className="container">
            <div className="text-center mb-8 md:mb-12">
              <h2 className="text-2xl md:text-3xl font-bold text-black mb-4">Featured Notes</h2>
              <p className="text-gray-600 max-w-2xl mx-auto">
                Handpicked selection of our most popular and comprehensive notes
              </p>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
              {featuredNotes.map((note) => (
                <div key={note._id} className="card p-6 hover:shadow-lg transition-shadow">
                  <div className="aspect-video bg-gray-200 rounded-lg mb-4 overflow-hidden relative">
                    {note.coverImage ? (
                      <Image
                        src={urlFor(note.coverImage).url()}
                        alt={note.title}
                        fill
                        className="object-cover"
                        sizes="(max-width: 768px) 100vw, 33vw"
                      />
                    ) : (
                      <div className="w-full h-full bg-gray-200 flex items-center justify-center">
                        <BookOpen className="w-12 h-12 text-gray-400" />
                      </div>
                    )}
                  </div>
                  
                  <div className="mb-2">
                    <span className="inline-block px-2 py-1 bg-yellow-100 text-black text-xs font-semibold rounded mr-2">
                      {note.subject.replace('-', ' ')}
                    </span>
                    <span className="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded">
                      {note.academicYear.replace('-', ' ')}
                    </span>
                  </div>
                  
                  <h3 className="text-lg font-semibold mb-2">{note.title}</h3>
                  <p className="text-gray-600 text-sm mb-4 line-clamp-2">{note.description}</p>
                  
                  <div className="flex items-center mb-4">
                    <div className="flex text-yellow-400">
                      {[...Array(5)].map((_, i) => (
                        <Star key={i} className="w-4 h-4 fill-current" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-500 ml-2">(4.8)</span>
                  </div>
                  
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      {note.originalPrice && (
                        <span className="text-gray-400 line-through text-sm mr-2">
                          ₹{note.originalPrice}
                        </span>
                      )}
                      <span className="text-xl font-bold text-black">₹{note.price}</span>
                    </div>
                  </div>
                  
                  <Link href={`/notes/${note.slug}`} className="btn-primary w-full text-center">
                    View Details
                  </Link>
                </div>
              ))}
            </div>
            
            <div className="text-center mt-8">
              <Link href="/notes" className="btn-outline">
                View All Notes
                <ArrowRight className="ml-2 w-4 h-4" />
              </Link>
            </div>
          </div>
        </section>

        {/* About Section */}
        <section id="about" className="py-12 md:py-16 bg-white">
          <div className="container">
            <div className="max-w-4xl mx-auto">
              <div className="text-center mb-8">
                <h2 className="text-2xl md:text-3xl font-bold text-black mb-4">About @Better Notes V2</h2>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                  <div className="aspect-square bg-gray-200 rounded-lg flex items-center justify-center">
                    <BookOpen className="w-24 h-24 text-gray-400" />
                  </div>
                </div>
                
                <div>
                  <p className="text-gray-700 mb-4">
                    Welcome to @Better Notes V2, your trusted source for high-quality medical notes. As a fellow medical student, I understand the challenges of MBBS studies and the importance of having reliable, comprehensive study materials.
                  </p>
                  <p className="text-gray-700 mb-4">
                    All notes are carefully crafted, handwritten, and designed to make complex medical concepts easier to understand. Each set of notes is updated regularly to reflect the latest curriculum and exam patterns.
                  </p>
                  <p className="text-gray-700">
                    Join hundreds of students who have already benefited from these notes and improved their academic performance. Your success is our motivation!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* CTA Section */}
        <section className="py-12 md:py-16 bg-black text-white">
          <div className="container text-center">
            <h2 className="text-2xl md:text-3xl font-bold mb-4">Ready to Excel in Your Medical Studies?</h2>
            <p className="text-gray-300 mb-6 max-w-2xl mx-auto">
              Get access to premium medical notes that will help you understand complex concepts and score high in your exams.
            </p>
            <Link href="/notes" className="btn-accent">
              Browse Notes Now
              <ArrowRight className="ml-2 w-5 h-5" />
            </Link>
          </div>
        </section>
      </main>
      
      <Footer />
    </div>
  );
}
</file>

<file path="betternotes/components/layout/footer.tsx">
import Link from 'next/link';
import { Send, Mail, Phone } from 'lucide-react';

const Footer = () => {
  return (
    <footer className="bg-black text-white">
      <div className="container py-12">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
          {/* Logo and Description */}
          <div className="col-span-1 md:col-span-2">
            <div className="flex items-center space-x-2 mb-4">
              <div className="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center">
                <span className="text-black font-bold text-sm">@</span>
              </div>
              <span className="font-bold text-xl">Better Notes V2</span>
            </div>
            <p className="text-gray-300 mb-4 max-w-md">
              High-quality, handwritten medical notes for MBBS students. Created by a dedicated medical student to help you excel in your studies.
            </p>
            <div className="flex space-x-4">
              <a
                href="https://t.me/betternotes"
                target="_blank"
                rel="noopener noreferrer"
                className="p-2 bg-gray-800 rounded-full hover:bg-yellow-400 hover:text-black transition-colors"
                aria-label="Telegram"
              >
                <Send className="w-5 h-5" />
              </a>
              <a
                href="mailto:betternotes@example.com"
                className="p-2 bg-gray-800 rounded-full hover:bg-yellow-400 hover:text-black transition-colors"
                aria-label="Email"
              >
                <Mail className="w-5 h-5" />
              </a>
              <a
                href="tel:+1234567890"
                className="p-2 bg-gray-800 rounded-full hover:bg-yellow-400 hover:text-black transition-colors"
                aria-label="Phone"
              >
                <Phone className="w-5 h-5" />
              </a>
            </div>
          </div>

          {/* Quick Links */}
          <div>
            <h3 className="font-semibold text-lg mb-4">Quick Links</h3>
            <ul className="space-y-2">
              <li>
                <Link href="/" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Home
                </Link>
              </li>
              <li>
                <Link href="/notes" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  All Notes
                </Link>
              </li>
              <li>
                <Link href="/#featured" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Featured Notes
                </Link>
              </li>
              <li>
                <Link href="/#about" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  About
                </Link>
              </li>
              <li>
                <Link href="/checkout" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Cart
                </Link>
              </li>
            </ul>
          </div>

          {/* Categories */}
          <div>
            <h3 className="font-semibold text-lg mb-4">Categories</h3>
            <ul className="space-y-2">
              <li>
                <Link href="/notes?academicYear=first-year" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  First Year
                </Link>
              </li>
              <li>
                <Link href="/notes?academicYear=second-year" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Second Year
                </Link>
              </li>
              <li>
                <Link href="/notes?academicYear=third-year" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Third Year
                </Link>
              </li>
              <li>
                <Link href="/notes?academicYear=fourth-year" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Fourth Year
                </Link>
              </li>
              <li>
                <Link href="/notes?academicYear=fifth-year" className="text-gray-300 hover:text-yellow-400 transition-colors">
                  Fifth Year
                </Link>
              </li>
            </ul>
          </div>
        </div>

        <div className="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
          <p>&copy; {new Date().getFullYear()} Better Notes V2. All rights reserved.</p>
          <p className="mt-2 text-sm">
            Made with ❤️ for medical students
          </p>
        </div>
      </div>
    </footer>
  );
};

export default Footer;
</file>

<file path="betternotes/components/layout/header.tsx">
'use client';

import Link from 'next/link';
import { useState } from 'react';
import { Menu, X, ShoppingCart, Search } from 'lucide-react';
import { useCart } from '@/lib/cart-context';

const Header = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isSearchOpen, setIsSearchOpen] = useState(false);
  const { itemCount } = useCart();

  const toggleMenu = () => {
    setIsMenuOpen(!isMenuOpen);
  };

  const toggleSearch = () => {
    setIsSearchOpen(!isSearchOpen);
  };

  return (
    <header className="bg-white shadow-sm sticky top-0 z-50">
      <div className="container">
        <div className="flex items-center justify-between h-16">
          {/* Logo */}
          <Link href="/" className="flex items-center space-x-2">
            <div className="w-8 h-8 bg-black rounded-full flex items-center justify-center">
              <span className="text-white font-bold text-sm">@</span>
            </div>
            <span className="font-bold text-xl">Better Notes V2</span>
          </Link>

          {/* Desktop Navigation */}
          <nav className="hidden md:flex items-center space-x-8">
            <Link href="/" className="text-gray-900 hover:text-yellow-500 transition-colors">
              Home
            </Link>
            <Link href="/notes" className="text-gray-900 hover:text-yellow-500 transition-colors">
              All Notes
            </Link>
            <Link href="/#featured" className="text-gray-900 hover:text-yellow-500 transition-colors">
              Featured
            </Link>
            <Link href="/#about" className="text-gray-900 hover:text-yellow-500 transition-colors">
              About
            </Link>
          </nav>

          {/* Desktop Actions */}
          <div className="hidden md:flex items-center space-x-4">
            <button
              onClick={toggleSearch}
              className="p-2 rounded-full hover:bg-gray-100 transition-colors"
              aria-label="Search"
            >
              <Search className="w-5 h-5" />
            </button>
            <Link href="/checkout" className="relative p-2 rounded-full hover:bg-gray-100 transition-colors">
              <ShoppingCart className="w-5 h-5" />
              {itemCount > 0 && (
                <span className="absolute -top-1 -right-1 bg-yellow-400 text-black text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                  {itemCount}
                </span>
              )}
            </Link>
          </div>

          {/* Mobile menu button */}
          <div className="md:hidden flex items-center space-x-2">
            <Link href="/checkout" className="relative p-2 rounded-full hover:bg-gray-100 transition-colors">
              <ShoppingCart className="w-5 h-5" />
              {itemCount > 0 && (
                <span className="absolute -top-1 -right-1 bg-yellow-400 text-black text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                  {itemCount}
                </span>
              )}
            </Link>
            <button
              onClick={toggleMenu}
              className="p-2 rounded-md hover:bg-gray-100 transition-colors"
              aria-label="Toggle menu"
            >
              {isMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
            </button>
          </div>
        </div>

        {/* Mobile Navigation */}
        {isMenuOpen && (
          <div className="md:hidden py-4 border-t border-gray-200">
            <nav className="flex flex-col space-y-4">
              <Link
                href="/"
                className="text-gray-900 hover:text-yellow-500 transition-colors"
                onClick={() => setIsMenuOpen(false)}
              >
                Home
              </Link>
              <Link
                href="/notes"
                className="text-gray-900 hover:text-yellow-500 transition-colors"
                onClick={() => setIsMenuOpen(false)}
              >
                All Notes
              </Link>
              <Link
                href="/#featured"
                className="text-gray-900 hover:text-yellow-500 transition-colors"
                onClick={() => setIsMenuOpen(false)}
              >
                Featured
              </Link>
              <Link
                href="/#about"
                className="text-gray-900 hover:text-yellow-500 transition-colors"
                onClick={() => setIsMenuOpen(false)}
              >
                About
              </Link>
              <button
                onClick={toggleSearch}
                className="text-left text-gray-900 hover:text-yellow-500 transition-colors"
              >
                Search
              </button>
            </nav>
          </div>
        )}

        {/* Search Bar */}
        {isSearchOpen && (
          <div className="py-4 border-t border-gray-200">
            <div className="relative">
              <input
                type="text"
                placeholder="Search for notes..."
                className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                autoFocus
              />
              <button
                className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                onClick={toggleSearch}
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>
        )}
      </div>
    </header>
  );
};

export default Header;
</file>

<file path="betternotes/dist/static/643ae7fc.create-schema.json">
[
  {
    "fields": [
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "title",
        "type": "string"
      },
      {
        "options": {
          "source": "title",
          "maxLength": 96
        },
        "validation": [
          {
            "rules": [
              {
                "flag": "custom"
              },
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "slug",
        "type": "slug"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "description",
        "type": "text"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              },
              {
                "flag": "min",
                "constraint": 0
              }
            ],
            "level": "error"
          }
        ],
        "name": "price",
        "type": "number"
      },
      {
        "name": "originalPrice",
        "type": "number"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              },
              {
                "flag": "min",
                "constraint": 1
              }
            ],
            "level": "error"
          }
        ],
        "of": [
          {
            "options": {
              "hotspot": true
            },
            "fields": [
              {
                "name": "alt",
                "type": "string",
                "title": "Alt Text"
              }
            ],
            "type": "image"
          }
        ],
        "name": "images",
        "type": "array"
      },
      {
        "options": {
          "list": [
            {
              "title": "First Year",
              "value": "first-year"
            },
            {
              "title": "Second Year",
              "value": "second-year"
            },
            {
              "title": "Third Year",
              "value": "third-year"
            },
            {
              "title": "Fourth Year",
              "value": "fourth-year"
            },
            {
              "title": "Fifth Year",
              "value": "fifth-year"
            }
          ]
        },
        "validation": [
          {
            "rules": [
              {
                "flag": "valid",
                "constraint": [
                  "first-year",
                  "second-year",
                  "third-year",
                  "fourth-year",
                  "fifth-year"
                ]
              },
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "academicYear",
        "type": "string"
      },
      {
        "options": {
          "list": [
            {
              "title": "Anatomy",
              "value": "anatomy"
            },
            {
              "title": "Physiology",
              "value": "physiology"
            },
            {
              "title": "Biochemistry",
              "value": "biochemistry"
            },
            {
              "title": "Pathology",
              "value": "pathology"
            },
            {
              "title": "Pharmacology",
              "value": "pharmacology"
            },
            {
              "title": "Microbiology",
              "value": "microbiology"
            },
            {
              "title": "Forensic Medicine",
              "value": "forensic-medicine"
            },
            {
              "title": "Community Medicine",
              "value": "community-medicine"
            },
            {
              "title": "ENT",
              "value": "ent"
            },
            {
              "title": "Ophthalmology",
              "value": "ophthalmology"
            },
            {
              "title": "Medicine",
              "value": "medicine"
            },
            {
              "title": "Surgery",
              "value": "surgery"
            },
            {
              "title": "Obstetrics & Gynecology",
              "value": "obgyn"
            },
            {
              "title": "Pediatrics",
              "value": "pediatrics"
            },
            {
              "title": "Orthopedics",
              "value": "orthopedics"
            },
            {
              "title": "Dermatology",
              "value": "dermatology"
            },
            {
              "title": "Psychiatry",
              "value": "psychiatry"
            },
            {
              "title": "Radiology",
              "value": "radiology"
            },
            {
              "title": "Anesthesiology",
              "value": "anesthesiology"
            }
          ]
        },
        "validation": [
          {
            "rules": [
              {
                "flag": "valid",
                "constraint": [
                  "anatomy",
                  "physiology",
                  "biochemistry",
                  "pathology",
                  "pharmacology",
                  "microbiology",
                  "forensic-medicine",
                  "community-medicine",
                  "ent",
                  "ophthalmology",
                  "medicine",
                  "surgery",
                  "obgyn",
                  "pediatrics",
                  "orthopedics",
                  "dermatology",
                  "psychiatry",
                  "radiology",
                  "anesthesiology"
                ]
              },
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "subject",
        "type": "string"
      },
      {
        "options": {
          "list": [
            {
              "title": "University Exam",
              "value": "university"
            },
            {
              "title": "Entrance Exam",
              "value": "entrance"
            },
            {
              "title": "Supplementary",
              "value": "supplementary"
            },
            {
              "title": "Revision Notes",
              "value": "revision"
            }
          ]
        },
        "validation": [
          {
            "rules": [
              {
                "flag": "valid",
                "constraint": [
                  "university",
                  "entrance",
                  "supplementary",
                  "revision"
                ]
              },
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "examType",
        "type": "string"
      },
      {
        "of": [
          {
            "type": "string"
          }
        ],
        "name": "tags",
        "type": "array"
      },
      {
        "initialValue": false,
        "name": "featured",
        "type": "boolean"
      }
    ],
    "name": "note",
    "type": "document"
  },
  {
    "fields": [
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "code",
        "type": "string"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              },
              {
                "flag": "min",
                "constraint": 1
              },
              {
                "flag": "max",
                "constraint": 100
              }
            ],
            "level": "error"
          }
        ],
        "name": "discountPercentage",
        "type": "number"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "validFrom",
        "type": "datetime"
      },
      {
        "validation": [
          {
            "rules": [
              {
                "flag": "presence",
                "constraint": "required"
              }
            ],
            "level": "error"
          }
        ],
        "name": "validUntil",
        "type": "datetime"
      },
      {
        "initialValue": true,
        "name": "isActive",
        "type": "boolean"
      },
      {
        "name": "usageLimit",
        "type": "number"
      },
      {
        "initialValue": 0,
        "name": "usedCount",
        "type": "number"
      }
    ],
    "name": "discountCode",
    "type": "document"
  }
]
</file>

<file path="betternotes/dist/static/9504b3c1.create-tools.json">
[
  {
    "title": "Structure",
    "name": "structure",
    "type": "sanity/structure",
    "icon": "<svg data-sanity-icon=\"master-detail\" width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.5 6.5V10.5M9.5 10.5V14.5M9.5 10.5H5.5M9.5 14.5V18.5M9.5 14.5H5.5M5.5 6.5H19.5V18.5H5.5V6.5Z\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linejoin=\"round\"></path></svg>"
  },
  {
    "title": "Vision",
    "name": "vision",
    "type": "sanity/vision",
    "icon": "<svg data-sanity-icon=\"eye-open\" width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.39999 12.5C9.39999 10.7879 10.7879 9.39999 12.5 9.39999C14.2121 9.39999 15.6 10.7879 15.6 12.5C15.6 14.2121 14.2121 15.6 12.5 15.6C10.7879 15.6 9.39999 14.2121 9.39999 12.5Z\" fill=\"currentColor\"></path><path d=\"M12.5 7.5C8.5 7.5 6 10 4.5 12.5C6 15 8.5 17.5 12.5 17.5C16.5 17.5 19 15 20.5 12.5C19 10 16.5 7.5 12.5 7.5Z\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linejoin=\"round\"></path></svg>"
  },
  {
    "title": "Schedules",
    "name": "schedules",
    "type": "sanity/scheduled-publishing",
    "icon": "<svg data-sanity-icon=\"calendar\" width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M5.5 18.5H19.5V6.5H5.5V18.5Z\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linejoin=\"round\"></path><path d=\"M16.5 8V4M8.5 8V4M8 12.5H10M8 15.5H10M11.5 12.5H13.5M11.5 15.5H13.5M15 12.5H17M15 15.5H17M12.5 8V4M5.5 9.5H19.5\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linejoin=\"round\"></path></svg>"
  },
  {
    "title": "Releases",
    "name": "releases",
    "type": null,
    "icon": "<style data-styled=\"true\" data-styled-version=\"6.1.19\">.legFOJ{font-family:Inter,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Liberation Sans\",Helvetica,Arial,system-ui,sans-serif;font-weight:500;font-size:13px;transform:translateY(1px);}/*!sc*/\ndata-styled.g404[id=\"sc-erobCP\"]{content:\"legFOJ,\"}/*!sc*/\n</style><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><rect width=\"32\" height=\"32\" rx=\"2\" fill=\"#a8bfff\"></rect><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" alignment-baseline=\"middle\" fill=\"hsla(224, 100%, 43%, 1)\" class=\"sc-erobCP legFOJ\">R</text></svg>"
  }
]
</file>

<file path="betternotes/dist/static/browser-vDqJ5XpU.js">
import{at as Ue}from"./sanity-z2y04qld.js";function Ge(G,K){for(var y=0;y<K.length;y++){const T=K[y];if(typeof T!="string"&&!Array.isArray(T)){for(const _ in T)if(_!=="default"&&!(_ in G)){const h=Object.getOwnPropertyDescriptor(T,_);h&&Object.defineProperty(G,_,h.get?h:{enumerable:!0,get:()=>T[_]})}}}return Object.freeze(Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}))}var Q={exports:{}};var Ve=Q.exports,Ae;function $e(){return Ae||(Ae=1,(function(G,K){(function(y){var T=y.setTimeout,_=y.clearTimeout,h=y.XMLHttpRequest,ce=y.XDomainRequest,le=y.ActiveXObject,Z=y.EventSource,I=y.document,Fe=y.Promise,J=y.fetch,ve=y.Response,Y=y.TextDecoder,he=y.TextEncoder,te=y.AbortController;if(typeof window<"u"&&typeof I<"u"&&!("readyState"in I)&&I.body==null&&(I.readyState="loading",window.addEventListener("load",function(e){I.readyState="complete"},!1)),h==null&&le!=null&&(h=function(){return new le("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Date.now||(Date.now=function(){return new Date().getTime()}),te==null){var Oe=J;J=function(e,r){var n=r.signal;return Oe(e,{headers:r.headers,credentials:r.credentials,cache:r.cache}).then(function(t){var o=t.body.getReader();return n._reader=o,n._aborted&&n._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return o}}}})},te=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function pe(){this.bitsNeeded=0,this.codePoint=0}pe.prototype.decode=function(e){function r(d,u,i){if(i===1)return d>=128>>u&&d<<u<=2047;if(i===2)return d>=2048>>u&&d<<u<=55295||d>=57344>>u&&d<<u<=65535;if(i===3)return d>=65536>>u&&d<<u<=1114111;throw new Error}function n(d,u){if(d===6)return u>>6>15?3:u>31?2:1;if(d===12)return u>15?3:2;if(d===18)return 3;throw new Error}for(var t=65533,o="",a=this.bitsNeeded,s=this.codePoint,c=0;c<e.length;c+=1){var f=e[c];a!==0&&(f<128||f>191||!r(s<<6|f&63,a-6,n(a,s)))&&(a=0,s=t,o+=String.fromCharCode(s)),a===0?(f>=0&&f<=127?(a=0,s=f):f>=192&&f<=223?(a=6,s=f&31):f>=224&&f<=239?(a=12,s=f&15):f>=240&&f<=247?(a=18,s=f&7):(a=0,s=t),a!==0&&!r(s,a,n(a,s))&&(a=0,s=t)):(a-=6,s=s<<6|f&63),a===0&&(s<=65535?o+=String.fromCharCode(s):(o+=String.fromCharCode(55296+(s-65535-1>>10)),o+=String.fromCharCode(56320+(s-65535-1&1023))))}return this.bitsNeeded=a,this.codePoint=s,o};var Ne=function(){try{return new Y().decode(new he().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(Y==null||he==null||!Ne())&&(Y=pe);var R=function(){};function j(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=R,this.onload=R,this.onerror=R,this.onreadystatechange=R,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=R}j.prototype.open=function(e,r){this._abort(!0);var n=this,t=this._xhr,o=1,a=0;this._abort=function(i){n._sendTimeout!==0&&(_(n._sendTimeout),n._sendTimeout=0),(o===1||o===2||o===3)&&(o=4,t.onload=R,t.onerror=R,t.onabort=R,t.onprogress=R,t.onreadystatechange=R,t.abort(),a!==0&&(_(a),a=0),i||(n.readyState=4,n.onabort(null),n.onreadystatechange())),o=0};var s=function(){if(o===1){var i=0,l="",D=void 0;if("contentType"in t)i=200,l="OK",D=t.contentType;else try{i=t.status,l=t.statusText,D=t.getResponseHeader("Content-Type")}catch{i=0,l="",D=void 0}i!==0&&(o=2,n.readyState=2,n.status=i,n.statusText=l,n._contentType=D,n.onreadystatechange())}},c=function(){if(s(),o===2||o===3){o=3;var i="";try{i=t.responseText}catch{}n.readyState=3,n.responseText=i,n.onprogress()}},f=function(i,l){if((l==null||l.preventDefault==null)&&(l={preventDefault:R}),c(),o===1||o===2||o===3){if(o=4,a!==0&&(_(a),a=0),n.readyState=4,i==="load")n.onload(l);else if(i==="error")n.onerror(l);else if(i==="abort")n.onabort(l);else throw new TypeError;n.onreadystatechange()}},d=function(i){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&f(t.responseText===""?"error":"load",i):t.readyState===3?"onprogress"in t||c():t.readyState===2&&s())},u=function(){a=T(function(){u()},500),t.readyState===3&&c()};"onload"in t&&(t.onload=function(i){f("load",i)}),"onerror"in t&&(t.onerror=function(i){f("error",i)}),"onabort"in t&&(t.onabort=function(i){f("abort",i)}),"onprogress"in t&&(t.onprogress=c),"onreadystatechange"in t&&(t.onreadystatechange=function(i){d(i)}),("contentType"in t||!("ontimeout"in h.prototype))&&(r+=(r.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,r,!0),"readyState"in t&&(a=T(function(){u()},0))},j.prototype.abort=function(){this._abort(!1)},j.prototype.getResponseHeader=function(e){return this._contentType},j.prototype.setRequestHeader=function(e,r){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,r)},j.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},j.prototype.send=function(){if((!("ontimeout"in h.prototype)||!("sendAsBinary"in h.prototype)&&!("mozAnon"in h.prototype))&&I!=null&&I.readyState!=null&&I.readyState!=="complete"){var e=this;e._sendTimeout=T(function(){e._sendTimeout=0,e.send()},4);return}var r=this._xhr;"withCredentials"in r&&(r.withCredentials=this.withCredentials);try{r.send(void 0)}catch(n){throw n}};function ye(e){return e.replace(/[A-Z]/g,function(r){return String.fromCharCode(r.charCodeAt(0)+32)})}function ge(e){for(var r=Object.create(null),n=e.split(`\r
`),t=0;t<n.length;t+=1){var o=n[t],a=o.split(": "),s=a.shift(),c=a.join(": ");r[ye(s)]=c}this._map=r}ge.prototype.get=function(e){return this._map[ye(e)]},h!=null&&h.HEADERS_RECEIVED==null&&(h.HEADERS_RECEIVED=2);function Ee(){}Ee.prototype.open=function(e,r,n,t,o,a,s){e.open("GET",o);var c=0;e.onprogress=function(){var d=e.responseText,u=d.slice(c);c+=u.length,n(u)},e.onerror=function(d){d.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===h.HEADERS_RECEIVED){var d=e.status,u=e.statusText,i=e.getResponseHeader("Content-Type"),l=e.getAllResponseHeaders();r(d,u,i,new ge(l))}},e.withCredentials=a;for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&e.setRequestHeader(f,s[f]);return e.send(),e};function we(e){this._headers=e}we.prototype.get=function(e){return this._headers.get(e)};function me(){}me.prototype.open=function(e,r,n,t,o,a,s){var c=null,f=new te,d=f.signal,u=new Y;return J(o,{headers:s,credentials:a?"include":"same-origin",signal:d,cache:"no-store"}).then(function(i){return c=i.body.getReader(),r(i.status,i.statusText,i.headers.get("Content-Type"),new we(i.headers)),new Fe(function(l,D){var W=function(){c.read().then(function(C){if(C.done)l(void 0);else{var E=u.decode(C.value,{stream:!0});n(E),W()}}).catch(function(C){D(C)})};W()})}).catch(function(i){if(i.name!=="AbortError")return i}).then(function(i){t(i)}),{abort:function(){c?.cancel(),f.abort()}}};function V(){this._listeners=Object.create(null)}function Te(e){T(function(){throw e},0)}V.prototype.dispatchEvent=function(e){e.target=this;var r=this._listeners[e.type];if(r!=null)for(var n=r.length,t=0;t<n;t+=1){var o=r[t];try{typeof o.handleEvent=="function"?o.handleEvent(e):o.call(this,e)}catch(a){Te(a)}}},V.prototype.addEventListener=function(e,r){e=String(e);var n=this._listeners,t=n[e];t==null&&(t=[],n[e]=t);for(var o=!1,a=0;a<t.length;a+=1)t[a]===r&&(o=!0);o||t.push(r)},V.prototype.removeEventListener=function(e,r){e=String(e);var n=this._listeners,t=n[e];if(t!=null){for(var o=[],a=0;a<t.length;a+=1)t[a]!==r&&o.push(t[a]);o.length===0?delete n[e]:n[e]=o}};function P(e){this.type=e,this.target=void 0}function Ce(e,r){P.call(this,e),this.data=r.data,this.lastEventId=r.lastEventId}Ce.prototype=Object.create(P.prototype);function re(e,r){P.call(this,e),this.status=r.status,this.statusText=r.statusText,this.headers=r.headers}re.prototype=Object.create(P.prototype);function Se(e,r){P.call(this,e),this.error=r.error}Se.prototype=Object.create(P.prototype);var ne=-1,H=0,q=1,$=2,ae=-1,L=0,oe=1,be=2,Ie=3,He=/^text\/event\-stream(;.*)?$/i,Le=1e3,je=18e6,ie=function(e,r){var n=e==null?r:parseInt(e,10);return n!==n&&(n=r),se(n)},se=function(e){return Math.min(Math.max(e,Le),je)},X=function(e,r,n){try{typeof r=="function"&&r.call(e,n)}catch(t){Te(t)}};function A(e,r){V.call(this),r=r||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,qe(this,e,r)}function Me(){return h!=null&&"withCredentials"in h.prototype||ce==null?new h:new ce}var Pe=J!=null&&ve!=null&&"body"in ve.prototype;function qe(e,r,n){r=String(r);var t=!!n.withCredentials,o=n.lastEventIdQueryParameterName||"lastEventId",a=se(1e3),s=ie(n.heartbeatTimeout,45e3),c="",f=a,d=!1,u=0,i=n.headers||{},l=n.Transport,D=Pe&&l==null?void 0:new j(l!=null?new l:Me()),W=l!=null&&typeof l!="string"?new l:D==null?new me:new Ee,C=void 0,E=0,x=ne,B="",k="",F="",ee="",w=L,fe=0,M=0,Xe=function(p,v,S,b){if(x===H)if(p===200&&S!=null&&He.test(S)){x=q,d=Date.now(),f=a,e.readyState=q;var m=new re("open",{status:p,statusText:v,headers:b});e.dispatchEvent(m),X(e,e.onopen,m)}else{var g="";p!==200?(v&&(v=v.replace(/\s+/g," ")),g="EventSource's response has a status "+p+" "+v+" that is not 200. Aborting the connection."):g="EventSource's response has a Content-Type specifying an unsupported type: "+(S==null?"-":S.replace(/\s+/g," "))+". Aborting the connection.",de();var m=new re("error",{status:p,statusText:v,headers:b});e.dispatchEvent(m),X(e,e.onerror,m),console.error(g)}},Be=function(p){if(x===q){for(var v=-1,S=0;S<p.length;S+=1){var b=p.charCodeAt(S);(b===10||b===13)&&(v=S)}var m=(v!==-1?ee:"")+p.slice(0,v+1);ee=(v===-1?ee:"")+p.slice(v+1),p!==""&&(d=Date.now(),u+=p.length);for(var g=0;g<m.length;g+=1){var b=m.charCodeAt(g);if(w===ae&&b===10)w=L;else if(w===ae&&(w=L),b===13||b===10){if(w!==L){w===oe&&(M=g+1);var O=m.slice(fe,M-1),N=m.slice(M+(M<g&&m.charCodeAt(M)===32?1:0),g);O==="data"?(B+=`
`,B+=N):O==="id"?k=N:O==="event"?F=N:O==="retry"?(a=ie(N,a),f=a):O==="heartbeatTimeout"&&(s=ie(N,s),E!==0&&(_(E),E=T(function(){z()},s)))}if(w===L){if(B!==""){c=k,F===""&&(F="message");var U=new Ce(F,{data:B.slice(1),lastEventId:k});if(e.dispatchEvent(U),F==="open"?X(e,e.onopen,U):F==="message"?X(e,e.onmessage,U):F==="error"&&X(e,e.onerror,U),x===$)return}B="",F=""}w=b===13?ae:L}else w===L&&(fe=g,w=oe),w===oe?b===58&&(M=g+1,w=be):w===be&&(w=Ie)}}},Re=function(p){if(x===q||x===H){x=ne,E!==0&&(_(E),E=0),E=T(function(){z()},f),f=se(Math.min(a*16,f*2)),e.readyState=H;var v=new Se("error",{error:p});e.dispatchEvent(v),X(e,e.onerror,v),p!=null&&console.error(p)}},de=function(){x=$,C!=null&&(C.abort(),C=void 0),E!==0&&(_(E),E=0),e.readyState=$},z=function(){if(E=0,x!==ne){if(!d&&C!=null)Re(new Error("No activity within "+s+" milliseconds. "+(x===H?"No response received.":u+" chars received.")+" Reconnecting.")),C!=null&&(C.abort(),C=void 0);else{var p=Math.max((d||Date.now())+s-Date.now(),1);d=!1,E=T(function(){z()},p)}return}d=!1,u=0,E=T(function(){z()},s),x=H,B="",F="",k=c,ee="",fe=0,M=0,w=L;var v=r;if(r.slice(0,5)!=="data:"&&r.slice(0,5)!=="blob:"&&c!==""){var S=r.indexOf("?");v=S===-1?r:r.slice(0,S+1)+r.slice(S+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(N,U){return U===o?"":N}),v+=(r.indexOf("?")===-1?"?":"&")+o+"="+encodeURIComponent(c)}var b=e.withCredentials,m={};m.Accept="text/event-stream";var g=e.headers;if(g!=null)for(var O in g)Object.prototype.hasOwnProperty.call(g,O)&&(m[O]=g[O]);try{C=W.open(D,Xe,Be,Re,v,b,m)}catch(N){throw de(),N}};e.url=r,e.readyState=H,e.withCredentials=t,e.headers=i,e._close=de,z()}A.prototype=Object.create(V.prototype),A.prototype.CONNECTING=H,A.prototype.OPEN=q,A.prototype.CLOSED=$,A.prototype.close=function(){this._close()},A.CONNECTING=H,A.OPEN=q,A.CLOSED=$,A.prototype.withCredentials=void 0;var _e=Z;h!=null&&(Z==null||!("withCredentials"in Z.prototype))&&(_e=A),(function(e){{var r=e(K);r!==void 0&&(G.exports=r)}})(function(e){e.EventSourcePolyfill=A,e.NativeEventSource=Z,e.EventSource=_e})})(typeof globalThis>"u"?typeof window<"u"?window:typeof self<"u"?self:Ve:globalThis)})(Q,Q.exports)),Q.exports}var ue,xe;function We(){return xe||(xe=1,ue=$e().EventSourcePolyfill),ue}var De=We();const ze=Ue(De),Ke=Ge({__proto__:null,default:ze},[De]);export{Ke as b};
</file>

<file path="betternotes/dist/static/create-manifest.json">
{
  "version": 2,
  "createdAt": "2025-11-05T15:12:32.098Z",
  "workspaces": [
    {
      "name": "default",
      "title": "Default",
      "basePath": "/",
      "projectId": "t1y8nndf",
      "dataset": "production",
      "icon": "<style data-styled=\"true\" data-styled-version=\"6.1.19\">.legFOJ{font-family:Inter,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Liberation Sans\",Helvetica,Arial,system-ui,sans-serif;font-weight:500;font-size:13px;transform:translateY(1px);}/*!sc*/\ndata-styled.g404[id=\"sc-erobCP\"]{content:\"legFOJ,\"}/*!sc*/\n</style><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><rect width=\"32\" height=\"32\" rx=\"2\" fill=\"#037782\"></rect><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" alignment-baseline=\"middle\" fill=\"hsla(185, 95%, 0%, 1)\" class=\"sc-erobCP legFOJ\">D</text></svg>",
      "mediaLibrary": {
        "enabled": false
      },
      "schema": "643ae7fc.create-schema.json",
      "tools": "9504b3c1.create-tools.json"
    }
  ]
}
</file>

<file path="betternotes/dist/static/favicon.svg">
<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="512" height="512" fill="#0B0B0B"/>
<rect width="256" height="256" fill="#0B0B0B"/>
<g clip-path="url(#clip0_261_6485)">
<path d="M431.519 304.966L417.597 280.733L350.26 321.759L425.051 226.504L436.358 219.867L433.56 215.662L438.697 209.096L415.097 189.445L404.295 203.215L186.253 330.829L266.869 233.849L417.024 151.513L402.758 123.926L320.972 168.755L361.246 120.336L338.174 100L247.535 209.026L157.515 258.413L226.435 167.267L269.621 144.782L255.906 116.888L130.085 182.407L164.396 136.987L140.429 117.785L68 213.678L69.1238 214.576L82.6554 242.139L162.951 200.31L89.7653 297.077L101.76 306.69L108.893 320.484L193.431 274.12L100.338 386.121L123.411 406.457L128.044 400.883L352.623 269.018L278.061 364.014L279.277 365.029L279.162 365.1L294.62 392.002L393.791 331.561L355.604 393.207L381.199 410L442 311.863L431.519 304.966Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_261_6485">
<rect width="374" height="310" fill="white" transform="translate(68 100)"/>
</clipPath>
</defs>
</svg>
</file>

<file path="betternotes/dist/static/index-BaEyKr4y.js">
import{d as I,r as H,u as v,c as A,j as u,P as G,e as R,B as T,f as w,g as L,A as V,h as K,i as W,k as _,l as q}from"./sanity-z2y04qld.js";const z=R(T)`
  position: relative;
`;function D(d){const e=I.c(3),{children:o}=d,{collapsed:s}=_();let t;return e[0]!==o||e[1]!==s?(t=u.jsx(z,{hidden:s,height:"fill",overflow:"auto",children:o}),e[0]=o,e[1]=s,e[2]=t):t=e[2],t}function F(d){const e=I.c(11),{actionHandlers:o,index:s,menuItems:t,menuItemGroups:a,title:n}=d,{features:c}=w();if(!t?.length&&!n)return null;let l;e[0]!==o||e[1]!==a||e[2]!==t?(l=u.jsx(q,{menuItems:t,menuItemGroups:a,actionHandlers:o}),e[0]=o,e[1]=a,e[2]=t,e[3]=l):l=e[3];let r;e[4]!==c.backButton||e[5]!==s?(r=c.backButton&&s>0&&u.jsx(L,{as:K,"data-as":"a",icon:V,mode:"bleed",tooltipProps:{content:"Back"}}),e[4]=c.backButton,e[5]=s,e[6]=r):r=e[6];let i;return e[7]!==l||e[8]!==r||e[9]!==n?(i=u.jsx(W,{actions:l,backButton:r,title:n}),e[7]=l,e[8]=r,e[9]=n,e[10]=i):i=e[10],i}function N(d){const e=I.c(37);let o,s,t,a;e[0]!==d?({index:o,pane:s,paneKey:t,...a}=d,e[0]=d,e[1]=o,e[2]=s,e[3]=t,e[4]=a):(o=e[1],s=e[2],t=e[3],a=e[4]);let n,c,l,r,i;if(e[5]!==s){const{child:S,component:y,menuItems:U,menuItemGroups:$,type:J,...g}=s;c=S,n=y,r=U,l=$,i=g,e[5]=s,e[6]=n,e[7]=c,e[8]=l,e[9]=r,e[10]=i}else n=e[6],c=e[7],l=e[8],r=e[9],i=e[10];const[b,C]=H.useState(null),{title:E}=v(s),k=E===void 0?"":E;let m,p;e[11]!==i||e[12]!==a?({key:p,...m}={...a,...i},e[11]=i,e[12]=a,e[13]=m,e[14]=p):(m=e[13],p=e[14]);const B=b?.actionHandlers;let x;e[15]!==o||e[16]!==l||e[17]!==r||e[18]!==B||e[19]!==k?(x=u.jsx(F,{actionHandlers:B,index:o,menuItems:r,menuItemGroups:l,title:k}),e[15]=o,e[16]=l,e[17]=r,e[18]=B,e[19]=k,e[20]=x):x=e[20];let f;e[21]!==n||e[22]!==c||e[23]!==m||e[24]!==p||e[25]!==t?(f=A.isValidElementType(n)&&u.jsx(n,{...m,ref:C,child:c,paneKey:t},p),e[21]=n,e[22]=c,e[23]=m,e[24]=p,e[25]=t,e[26]=f):f=e[26];let P;e[27]!==n?(P=H.isValidElement(n)&&n,e[27]=n,e[28]=P):P=e[28];let h;e[29]!==f||e[30]!==P?(h=u.jsxs(D,{children:[f,P]}),e[29]=f,e[30]=P,e[31]=h):h=e[31];let j;return e[32]!==t||e[33]!==a.isSelected||e[34]!==x||e[35]!==h?(j=u.jsxs(G,{id:t,minWidth:320,selected:a.isSelected,children:[x,h]}),e[32]=t,e[33]=a.isSelected,e[34]=x,e[35]=h,e[36]=j):j=e[36],j}export{N as default};
</file>

<file path="betternotes/dist/static/index2-CfQ9rhg4.js">
import{d as B,u as w,j as r,P as $,e as T,B as L,T as C,_ as G,f as H,k as W,g as E,A as F,h as O,i as R,n as q,o as z,p as K,q as M,s as U,l as X}from"./sanity-z2y04qld.js";const J=T(L)`
  display: flex;
  align-items: center;
  gap: 1rem;
  margin: 0.75rem 0 0.25rem 0;
`,k=T.hr`
  flex: 1;
  background-color: var(--card-border-color);
  height: 1px;
  margin: 0;
  border: none;
`,N=T(C)`
  padding-bottom: 0.75rem;
  padding-left: 0.5rem;
  padding-right: 0.5rem;
`;function Q(g){const e=B.c(5),{item:d}=g,{title:t}=w(d);let n;e[0]!==t?(n=r.jsx(N,{weight:"semibold",muted:!0,size:1,children:t}),e[0]=t,e[1]=n):n=e[1];let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=r.jsx(k,{}),e[2]=i):i=e[2];let a;return e[3]!==n?(a=r.jsxs(J,{children:[n,i]}),e[3]=n,e[4]=a):a=e[4],a}function V(g){const e=B.c(20),{childItemId:d,items:t,isActive:n,layout:i,showIcons:a,title:c}=g,{collapsed:y}=q();let h;e[0]!==t?(h=t?.filter(Y),e[0]=t,e[1]=h):h=e[1];const l=z(h);let o;e[2]!==t?(o=s=>t?.find((j,P)=>P===s)?.type==="divider",e[2]=t,e[3]=o):o=e[3];const u=o;let v;e[4]!==a?(v=s=>{const j=s.displayOptions?.showIcon;return typeof j<"u"?j!==!1:a!==!1},e[4]=a,e[5]=v):v=e[5];const x=v;let m;e[6]!==d||e[7]!==l||e[8]!==n||e[9]!==i||e[10]!==x?(m=(s,j)=>{const{virtualIndex:P}=j;if(s.type==="divider")return r.jsx(L,{marginBottom:1,children:s.title?r.jsx(Q,{item:s}):r.jsx(k,{})},`divider-${P}`);const A=!n&&d===s.id,D=n&&d===s.id,S=s._id&&s.schemaType?{_id:s._id,_type:s.schemaType.name,title:s.title}:void 0;return r.jsx(U,{icon:x(s)?s.icon:!1,id:s.id,layout:i,marginBottom:1,pressed:A,schemaType:s.schemaType,selected:D,title:l(s).title,value:S},s.id)},e[6]=d,e[7]=l,e[8]=n,e[9]=i,e[10]=x,e[11]=m):m=e[11];const I=m,f=y?"hidden":"auto";let p;e[12]!==u||e[13]!==t||e[14]!==I||e[15]!==c?(p=t&&t.length>0&&r.jsx(K,{activeItemDataAttr:"data-hovered",ariaLabel:c,canReceiveFocus:!0,getItemDisabled:u,itemHeight:51,items:t,onlyShowSelectionWhenActive:!0,paddingBottom:1,paddingX:3,renderItem:I,wrapAround:!1}),e[12]=u,e[13]=t,e[14]=I,e[15]=c,e[16]=p):p=e[16];let b;return e[17]!==f||e[18]!==p?(b=r.jsx(M,{overflow:f,children:p}),e[17]=f,e[18]=p,e[19]=b):b=e[19],b}function Y(g){return g.type!=="divider"}const Z=g=>{const e=B.c(11),{index:d,menuItems:t,menuItemGroups:n,title:i}=g,{features:a}=H(),{collapsed:c,isLast:y}=W(),h=y&&!c?-1:0;let l;e[0]!==n||e[1]!==t?(l=r.jsx(X,{menuItems:t,menuItemGroups:n}),e[0]=n,e[1]=t,e[2]=l):l=e[2];let o;e[3]!==a.backButton||e[4]!==d?(o=a.backButton&&d>0&&r.jsx(E,{as:O,"data-as":"a",icon:F,mode:"bleed",tooltipProps:{content:"Back"}}),e[3]=a.backButton,e[4]=d,e[5]=o):o=e[5];let u;return e[6]!==l||e[7]!==o||e[8]!==h||e[9]!==i?(u=r.jsx(R,{actions:l,backButton:o,tabIndex:h,title:i}),e[6]=l,e[7]=o,e[8]=h,e[9]=i,e[10]=u):u=e[10],u};function ee(g){const e=B.c(21),{childItemId:d,index:t,isActive:n,isSelected:i,pane:a,paneKey:c}=g,{defaultLayout:y,displayOptions:h,items:l,menuItems:o,menuItemGroups:u}=a,v=h?.showIcons!==!1,{title:x}=w(a);let m;e[0]!==a.source?(m=G,e[0]=a.source,e[1]=m):m=e[1];let I;e[2]!==t||e[3]!==u||e[4]!==o||e[5]!==x?(I=r.jsx(Z,{index:t,menuItems:o,menuItemGroups:u,title:x}),e[2]=t,e[3]=u,e[4]=o,e[5]=x,e[6]=I):I=e[6];let f;e[7]!==d||e[8]!==y||e[9]!==n||e[10]!==l||e[11]!==c||e[12]!==v||e[13]!==x?(f=r.jsx(V,{childItemId:d,isActive:n,items:l,layout:y,showIcons:v,title:x},c),e[7]=d,e[8]=y,e[9]=n,e[10]=l,e[11]=c,e[12]=v,e[13]=x,e[14]=f):f=e[14];let p;return e[15]!==i||e[16]!==c||e[17]!==m||e[18]!==I||e[19]!==f?(p=r.jsxs($,{currentMaxWidth:350,"data-testid":"structure-tool-list-pane","data-ui":"ListPane",id:c,maxWidth:640,minWidth:320,selected:i,children:[m,I,f]}),e[15]=i,e[16]=c,e[17]=m,e[18]=I,e[19]=f,e[20]=p):p=e[20],p}export{ee as default};
</file>

<file path="betternotes/dist/static/index3-B7WWMqYT.js">
import{t as ve,v as Se,d as D,w as _e,r as b,j as u,E as je,x as $e,y as ee,z as te,D as ne,F as q,S as X,T as M,G as se,B as Z,I as ue,e as pe,J as he,K as fe,f as J,L as Ee,M as me,C as U,b as ge,H as Te,g as Re,N as De,O as ke,Q as Ce,R as ye,U as Ne,V as ze,W as xe,X as Me,Y as A,Z as Le,$ as Oe,a0 as oe,a1 as W,a2 as Be,a3 as Ie,a4 as Ve,a5 as We,a6 as He,a7 as Ae,a8 as Fe,a9 as Ke,aa as Ge,ab as K,ac as Ue,ad as re,ae as Je,af as Ye,ag as qe,ah as Qe,ai as Xe,aj as Ze,ak as et,al as ie,am as tt,an as nt,ao as rt}from"./sanity-z2y04qld.js";function at(){return ve(function(t,e){var n,r=!1;t.subscribe(Se(e,function(a){var o=n;n=a,r&&e.next([o,a]),r=!0}))})}class H extends Error{constructor({message:e,context:n,helpId:r,cause:a}){super(e),this.name="PaneResolutionError",this.context=n,this.helpId=r,this.cause=a}}const le=new WeakMap;function Y(t){const e=le.get(t);if(e)return e;const n=Xe();return le.set(t,n),n}const st=t=>!!t&&typeof t?.then=="function",ot=t=>me(t)?typeof t.serialize=="function":!1,it=t=>(e,n,r)=>{try{return t(e,n,r)}catch(a){throw a instanceof H?a:new H({message:typeof a?.message=="string"?a.message:"",context:n,cause:a})}},lt=t=>(...e)=>t(...e).pipe(qe(1),Qe());function we(t){const e=it(lt(t((n,r,a)=>{if(!n)throw new H({message:"Pane returned no child",context:r,helpId:"structure-item-returned-no-child"});return st(n)||Ue(n)?Ge(n).pipe(re(o=>e(o,r,a))):ot(n)?e(n.serialize(r),r,a):typeof n=="function"?e(n(r.id,r),r,a):K(n)})));return e}const ce=new WeakMap;function Pe(t,e){const n=ce.get(t)||new Map;if(n){const o=n.get(e);if(o)return o}const r=t[e];if(typeof r!="function")throw new Error(`Expected property \`${e}\` to be a function but got ${typeof r} instead.`);const a=r.bind(t);return n.set(e,a),ce.set(t,n),a}async function ct(t){const e=new Map,n=we(s=>(i,l,d)=>{const c=i&&`${Y(i)}-${l.path.join("__")}`,p=c&&e.get(c);if(p)return p;const m=s(i,l,d);return c&&e.set(c,m),m}),r=[[{id:`__edit__${t.params.id}`,params:{...Ve(t.params,["id"]),type:t.params.type},payload:t.payload}]];async function a({currentId:s,flatIndex:i,intent:l,params:d,parent:c,path:p,payload:m,unresolvedPane:P,levelIndex:h,structureContext:g}){if(!P)return[];const{id:y,type:w,...x}=d,f=await Ie(n(P,{id:s,splitIndex:0,parent:c,path:p,index:i,params:{},payload:void 0,structureContext:g},i));return f.type==="document"&&f.id===y?[{panes:[...p.slice(0,p.length-1).map(I=>[{id:I}]),[{id:y,params:x,payload:m}]],depthIndex:p.length,levelIndex:h}]:f.canHandleIntent?.(l,d,{pane:f,index:i})||f.type==="documentList"&&f.schemaTypeName===w&&f.options.filter==="_type == $type"?[{panes:[...p.map(I=>[{id:I}]),[{id:d.id,params:x,payload:m}]],depthIndex:p.length,levelIndex:h}]:f.type==="list"&&f.child&&f.items?(await Promise.all(f.items.map((I,v)=>I.type==="divider"?Promise.resolve([]):a({currentId:I._id||I.id,flatIndex:i+1,intent:l,params:d,parent:f,path:[...p,I.id],payload:m,unresolvedPane:typeof f.child=="function"?Pe(f,"child"):f.child,levelIndex:v,structureContext:g})))).flat():[]}const o=(await a({currentId:"root",flatIndex:0,levelIndex:0,intent:t.intent,params:t.params,parent:null,path:[],payload:t.payload,unresolvedPane:t.rootPaneNode,structureContext:t.structureContext})).sort((s,i)=>s.depthIndex===i.depthIndex?s.levelIndex-i.levelIndex:s.depthIndex-i.depthIndex)[0];return o?o.panes:r}const dt=(t,e)=>{const n=t.replace(/^__edit__/,""),{params:r,payload:a,structureContext:{resolveDocumentNode:o}}=e,{type:s,template:i}=r;if(!s)throw new Error(`Document type for document with ID ${n} was not provided in the router params.`);let l=o({schemaType:s,documentId:n}).id("editor");return i&&(l=l.initialValueTemplate(i,a)),l.serialize()};function ut(t){return`contextHash(${JSON.stringify({id:t.id,parentId:parent&&Y(parent),path:t.path,index:t.index,splitIndex:t.splitIndex,serializeOptionsIndex:t.serializeOptions?.index,serializeOptionsPath:t.serializeOptions?.path})})`}const de=t=>{const e={type:t.type,id:t.routerPaneSibling.id,params:t.routerPaneSibling.params||{},payload:t.routerPaneSibling.payload||null,flatIndex:t.flatIndex,groupIndex:t.groupIndex,siblingIndex:t.siblingIndex,path:t.path,paneNode:t.type==="resolvedMeta"?Y(t.paneNode):null};return`metaHash(${JSON.stringify(e)})`};function G({unresolvedPane:t,flattenedRouterPanes:e,parent:n,path:r,resolvePane:a,structureContext:o}){const[s,...i]=e,l=i[0],d={id:s.routerPaneSibling.id,splitIndex:s.siblingIndex,parent:n,path:[...r,s.routerPaneSibling.id],index:s.flatIndex,params:s.routerPaneSibling.params||{},payload:s.routerPaneSibling.payload,structureContext:o};try{return a(t,d,s.flatIndex).pipe(re(c=>{const p={type:"resolvedMeta",...s,paneNode:c,path:d.path},m=i.map((h,g)=>({type:"loading",path:[...d.path,...i.slice(g).map((y,w)=>`[${h.flatIndex+w}]`)],paneNode:null,...h}));if(!i.length)return K([p]);let P;return l?.routerPaneSibling.id.startsWith("__edit__")?P=G({unresolvedPane:dt,flattenedRouterPanes:i,parent:n,path:d.path,resolvePane:a,structureContext:o}):s.groupIndex===l?.groupIndex?P=G({unresolvedPane:t,flattenedRouterPanes:i,parent:n,path:r,resolvePane:a,structureContext:o}):P=G({unresolvedPane:typeof c.child=="function"?Pe(c,"child"):c.child,flattenedRouterPanes:i,parent:c,path:d.path,resolvePane:a,structureContext:o}),rt(K([p,...m]),P.pipe(W(h=>[p,...h])))}))}catch(c){if(c instanceof H&&(c.context&&console.warn(`Pane resolution error at index ${c.context.index}${c.context.splitIndex>0?` for split pane index ${c.context.splitIndex}`:""}: ${c.message}${c.helpId?` - see ${ue(c.helpId)}`:""}`,c),c.helpId==="structure-item-returned-no-child"))return K([]);throw c}}function pt({routerPanesStream:t,rootPaneNode:e,initialCacheState:n={cacheKeysByFlatIndex:[],flattenedRouterPanes:[],resolvedPaneCache:new Map,resolvePane:()=>tt},structureContext:r}){return t.pipe(W(a=>[[{id:"root"}],...a]),W(a=>a.flatMap((o,s)=>o.map((i,l)=>({routerPaneSibling:i,groupIndex:s,siblingIndex:l}))).map((o,s)=>({...o,flatIndex:s}))),Ze([]),at(),W(([a,o])=>{for(let s=0;s<o.length;s++){const i=a[s],l=o[s];if(!et(i,l))return{flattenedRouterPanes:o,diffIndex:s}}return{flattenedRouterPanes:o,diffIndex:o.length}}),ie((a,o)=>{const{cacheKeysByFlatIndex:s,resolvedPaneCache:i}=a,{flattenedRouterPanes:l,diffIndex:d}=o,c=s.slice(0,d+1),p=s.slice(d+1),m=new Set(c.flatMap(h=>Array.from(h))),P=p.flatMap(h=>Array.from(h)).filter(h=>!m.has(h));for(const h of P)i.delete(h);return{flattenedRouterPanes:l,cacheKeysByFlatIndex:s,resolvedPaneCache:i,resolvePane:we(h=>(g,y,w)=>{const x=g&&`${Y(g)}-${ut(y)}`,f=x&&i.get(x);if(f)return f;const I=h(g,y,w);if(!x)return I;const v=s[w]||new Set;return v.add(x),s[w]=v,i.set(x,I),I})}},n),re(({flattenedRouterPanes:a,resolvePane:o})=>G({unresolvedPane:e,flattenedRouterPanes:a,parent:null,path:[],resolvePane:o,structureContext:r}))).pipe(ie((a,o)=>o.map((s,i)=>{const l=a[i];return!l||s.type!=="loading"?s:l.routerPaneSibling.id===s.routerPaneSibling.id?l:s}),[]),nt((a,o)=>{if(a.length!==o.length)return!1;for(let s=0;s<o.length;s++){const i=a[s],l=o[s];if(de(i)!==de(l))return!1}return!0}))}function ht(){const t=D.c(6),[e]=b.useState(mt);let n;t[0]!==e?(n=e.asObservable().pipe(W(ft)),t[0]=e,t[1]=n):n=t[1];const r=n,{state:a}=he();let o,s;return t[2]!==a||t[3]!==e?(o=()=>{e.next(a)},s=[a,e],t[2]=a,t[3]=e,t[4]=o,t[5]=s):(o=t[4],s=t[5]),b.useEffect(o,s),r}function ft(t){return t?.panes||[]}function mt(){return new We(1)}function gt(){const t=D.c(6),[e,n]=b.useState();if(e)throw e;const{structureContext:r,rootPaneNode:a}=J();let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o={paneDataItems:[],resolvedPanes:[],routerPanes:[]},t[0]=o):o=t[0];const[s,i]=b.useState(o),l=ht();let d,c;return t[1]!==a||t[2]!==l||t[3]!==r?(d=()=>{const p=pt({rootPaneNode:a,routerPanesStream:l,structureContext:r}).pipe(W(yt)).subscribe({next:m=>i(m),error:m=>n(m)});return()=>p.unsubscribe()},c=[a,l,r],t[1]=a,t[2]=l,t[3]=r,t[4]=d,t[5]=c):(d=t[4],c=t[5]),b.useEffect(d,c),s}function yt(t){const e=t.reduce(It,[]),n=e.length,r=t.map(a=>{const{groupIndex:o,flatIndex:s,siblingIndex:i,routerPaneSibling:l,path:d}=a,c=l.id,p=e[o+1];return{active:o===n-2,childItemId:p?.[0].id??null,index:s,itemId:l.id,groupIndex:o,key:`${a.type==="loading"?"unknown":a.paneNode.id}-${c}-${i}`,pane:a.type==="loading"?A:a.paneNode,params:l.params||{},path:d.join(";"),payload:l.payload,selected:s===t.length-1,siblingIndex:i}});return{paneDataItems:r,routerPanes:e,resolvedPanes:r.map(xt)}}function xt(t){return t.pane}function It(t,e){const n=t[e.groupIndex]||[];return n[e.siblingIndex]=e.routerPaneSibling,t[e.groupIndex]=n,t}async function wt(t,e,n){if(e&&n)return{id:e,type:n};if(!e&&n)return{id:Be(),type:n};if(e&&!n){const r=await Ie(t.resolveTypeForDocument(e));return{id:e,type:r}}throw new H({message:"Neither document `id` or `type` was provided when trying to resolve intent."})}const Pt={},bt=b.memo(function(){const t=D.c(7),{navigate:e}=he(),n=fe(vt),{rootPaneNode:r,structureContext:a}=J(),o=Ee(),[s,i]=b.useState(null);if(s)throw s;let l,d;return t[0]!==o||t[1]!==n||t[2]!==e||t[3]!==r||t[4]!==a?(l=()=>{if(n){const{intent:c,params:p,payload:m}=n;let P=!1;return(async function(){const{id:h,type:g}=await wt(o,typeof p.id=="string"?p.id:void 0,typeof p.type=="string"?p.type:void 0);if(P)return;const y=await ct({intent:c,params:{...p,id:h,type:g},payload:m,rootPaneNode:r,structureContext:a});P||e({panes:y},{replace:!0})})().catch(i),()=>{P=!0}}},d=[o,n,e,r,a],t[0]=o,t[1]=n,t[2]=e,t[3]=r,t[4]=a,t[5]=l,t[6]=d):(l=t[5],d=t[6]),b.useEffect(l,d),null});function vt(t){const e=typeof t.intent=="string"?t.intent:void 0;return e?{intent:e,params:me(t.params)?t.params:Pt,payload:t.payload}:void 0}const St=pe.span`
  &:not(:last-child)::after {
    content: ' ➝ ';
    opacity: 0.5;
  }
`;function _t(t){return t.replace(/\(\.\.\.\)\./g,`(...)
  .`).replace(/__WEBPACK_IMPORTED_MODULE_\d+_+/g,"").replace(/___default\./g,".").replace(new RegExp(` \\(https?:\\/\\/${window.location.host}`,"g")," (")}function jt(t){const e=D.c(74),{error:n}=t;if(!(n instanceof H))throw n;const{cause:r}=n,{t:a}=te(ne),o=r?.stack||n.stack;let s;e[0]!==r||e[1]!==n.message||e[2]!==o?(s=o&&!(r instanceof q)&&!n.message.includes("Module build failed:"),e[0]=r,e[1]=n.message,e[2]=o,e[3]=s):s=e[3];const i=s;let l,d,c,p,m,P,h,g,y,w,x,f,I,v,k,C,z,S;if(e[4]!==r||e[5]!==n.helpId||e[6]!==a){const ae=r instanceof q?r.path:[];m=r instanceof q&&r.helpId||n.helpId,p=Et,c=U,P="fill",h="auto",g=4,y="border",w="critical",d=ge;let V;e[25]!==a?(V=a("structure-error.header.text"),e[25]=a,e[26]=V):V=e[26],e[27]!==V?(S=u.jsx(Te,{as:"h2",children:V}),e[27]=V,e[28]=S):S=e[28],l=U,x=4,f=4,I=2,v="auto",k=1,C="inherit",z=ae.length>0&&u.jsxs(X,{space:2,children:[u.jsx(M,{size:1,weight:"medium",children:a("structure-error.structure-path.label")}),u.jsx(se,{children:ae.slice(1).map($t)})]}),e[4]=r,e[5]=n.helpId,e[6]=a,e[7]=l,e[8]=d,e[9]=c,e[10]=p,e[11]=m,e[12]=P,e[13]=h,e[14]=g,e[15]=y,e[16]=w,e[17]=x,e[18]=f,e[19]=I,e[20]=v,e[21]=k,e[22]=C,e[23]=z,e[24]=S}else l=e[7],d=e[8],c=e[9],p=e[10],m=e[11],P=e[12],h=e[13],g=e[14],y=e[15],w=e[16],x=e[17],f=e[18],I=e[19],v=e[20],k=e[21],C=e[22],z=e[23],S=e[24];let j;e[29]!==a?(j=a("structure-error.error.label"),e[29]=a,e[30]=j):j=e[30];let $;e[31]!==j?($=u.jsx(M,{size:1,weight:"medium",children:j}),e[31]=j,e[32]=$):$=e[32];let E;e[33]!==n.message||e[34]!==i||e[35]!==o?(E=i?_t(o):n.message,e[33]=n.message,e[34]=i,e[35]=o,e[36]=E):E=e[36];let T;e[37]!==E?(T=u.jsx(se,{children:E}),e[37]=E,e[38]=T):T=e[38];let R;e[39]!==$||e[40]!==T?(R=u.jsxs(X,{marginTop:4,space:2,children:[$,T]}),e[39]=$,e[40]=T,e[41]=R):R=e[41];let _;e[42]!==m||e[43]!==a?(_=m&&u.jsx(Z,{marginTop:4,children:u.jsx(M,{children:u.jsx("a",{href:ue(m),rel:"noopener noreferrer",target:"_blank",children:a("structure-error.docs-link.text")})})}),e[42]=m,e[43]=a,e[44]=_):_=e[44];let N;e[45]!==a?(N=a("structure-error.reload-button.text"),e[45]=a,e[46]=N):N=e[46];let L;e[47]!==p||e[48]!==N?(L=u.jsx(Z,{marginTop:4,children:u.jsx(Re,{text:N,icon:De,tone:"primary",onClick:p})}),e[47]=p,e[48]=N,e[49]=L):L=e[49];let O;e[50]!==l||e[51]!==R||e[52]!==x||e[53]!==_||e[54]!==L||e[55]!==f||e[56]!==I||e[57]!==v||e[58]!==k||e[59]!==C||e[60]!==z?(O=u.jsxs(l,{marginTop:x,padding:f,radius:I,overflow:v,shadow:k,tone:C,children:[z,R,_,L]}),e[50]=l,e[51]=R,e[52]=x,e[53]=_,e[54]=L,e[55]=f,e[56]=I,e[57]=v,e[58]=k,e[59]=C,e[60]=z,e[61]=O):O=e[61];let B;e[62]!==d||e[63]!==O||e[64]!==S?(B=u.jsxs(d,{children:[S,O]}),e[62]=d,e[63]=O,e[64]=S,e[65]=B):B=e[65];let F;return e[66]!==c||e[67]!==P||e[68]!==h||e[69]!==g||e[70]!==y||e[71]!==w||e[72]!==B?(F=u.jsx(c,{height:P,overflow:h,padding:g,sizing:y,tone:w,children:B}),e[66]=c,e[67]=P,e[68]=h,e[69]=g,e[70]=y,e[71]=w,e[72]=B,e[73]=F):F=e[73],F}function $t(t,e){return u.jsx(St,{children:t},`${t}-${e}`)}function Et(){window.location.reload()}function Tt(){const t=D.c(17),{t:e}=te(ne);let n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=u.jsx(Z,{children:u.jsx(M,{size:1,children:u.jsx(Je,{})})}),t[0]=n):n=t[0];let r;t[1]!==e?(r=e("no-document-types-screen.title"),t[1]=e,t[2]=r):r=t[2];let a;t[3]!==r?(a=u.jsx(M,{as:"h1",size:1,weight:"medium",children:r}),t[3]=r,t[4]=a):a=t[4];let o;t[5]!==e?(o=e("no-document-types-screen.subtitle"),t[5]=e,t[6]=o):o=t[6];let s;t[7]!==o?(s=u.jsx(M,{as:"p",muted:!0,size:1,children:o}),t[7]=o,t[8]=s):s=t[8];let i;t[9]!==e?(i=e("no-document-types-screen.link-text"),t[9]=e,t[10]=i):i=t[10];let l;t[11]!==i?(l=u.jsx(M,{as:"p",muted:!0,size:1,children:u.jsx("a",{href:"https://www.sanity.io/docs/create-a-schema-and-configure-sanity-studio",target:"_blank",rel:"noreferrer",children:i})}),t[11]=i,t[12]=l):l=t[12];let d;return t[13]!==a||t[14]!==s||t[15]!==l?(d=u.jsx(U,{height:"fill",children:u.jsx(oe,{align:"center",height:"fill",justify:"center",padding:4,sizing:"border",children:u.jsx(ge,{width:0,children:u.jsx(U,{padding:4,radius:2,shadow:1,tone:"caution",children:u.jsxs(oe,{children:[n,u.jsxs(X,{flex:1,marginLeft:3,space:3,children:[a,s,l]})]})})})})}),t[13]=a,t[14]=s,t[15]=l,t[16]=d):d=t[16],d}const Rt=t=>{const e=D.c(7),{documentId:n,documentType:r}=t,{selectedReleaseId:a}=He(),o=Ae(n,r,"default",a),s=ye(),{t:i}=te(ne),l=!o?.published&&!o?.draft,d=o?.version||o?.draft||o?.published,c=s.get(r),{value:p,isLoading:m}=Fe({enabled:!!d,schemaType:c,value:d}),{lastRevisionDocument:P}=Ke(n,r),h=P&&!d?"":l?i("browser-document-title.new-document",{schemaType:c?.title||c?.name}):p?.title||i("browser-document-title.untitled-document"),g=o.ready&&!m,y=be(h);let w;e[0]!==y||e[1]!==g?(w=()=>{g&&(document.title=y)},e[0]=y,e[1]=g,e[2]=w):w=e[2];let x;return e[3]!==h||e[4]!==y||e[5]!==g?(x=[h,g,y],e[3]=h,e[4]=y,e[5]=g,e[6]=x):x=e[6],b.useEffect(w,x),null},Q=t=>{const e=D.c(5),{title:n}=t,r=be(n);let a;e[0]!==r?(a=()=>{document.title=r},e[0]=r,e[1]=a):a=e[1];let o;return e[2]!==r||e[3]!==n?(o=[r,n],e[2]=r,e[3]=n,e[4]=o):o=e[4],b.useEffect(a,o),null},Dt=t=>{const e=D.c(8),{resolvedPanes:n}=t;if(!n?.length)return null;const r=n[n.length-1];if(Nt(r)){let s;return e[0]===Symbol.for("react.memo_cache_sentinel")?(s=u.jsx(Q,{}),e[0]=s):s=e[0],s}if(Ct(r)){if(r?.title){let i;return e[1]!==r.title?(i=u.jsx(Q,{title:r.title}),e[1]=r.title,e[2]=i):i=e[2],i}let s;return e[3]!==r.options.id||e[4]!==r.options.type?(s=u.jsx(Rt,{documentId:r.options.id,documentType:r.options.type}),e[3]=r.options.id,e[4]=r.options.type,e[5]=s):s=e[5],s}const a=r?.title;let o;return e[6]!==a?(o=u.jsx(Q,{title:a}),e[6]=a,e[7]=o):o=e[7],o};function be(t){const e=D.c(3),n=J().structureContext.title;let r;return e[0]!==t||e[1]!==n?(r=[t,n].filter(kt),e[0]=t,e[1]=n,e[2]=r):r=e[2],r.join(" | ")}function kt(t){return t}function Ct(t){return t!==A&&t.type==="document"}function Nt(t){return t===A}const zt=pe(Ye)`
  min-height: 100%;
  min-width: 320px;
`,Mt=ke("mod+s"),Lt=b.memo(function(t){const e=D.c(31),{onPaneChange:n}=t,{push:r}=Ce(),a=ye(),{layoutCollapsed:o,setLayoutCollapsed:s}=J(),{paneDataItems:i,resolvedPanes:l}=gt(),d=fe(Ot),{sanity:c}=Ne(),{media:p}=c,[m,P]=b.useState(null);let h;e[0]!==s?(h=()=>s(!0),e[0]=s,e[1]=h):h=e[1];const g=h;let y;e[2]!==s?(y=()=>s(!1),e[2]=s,e[3]=y):y=e[3];const w=y;let x,f;e[4]!==n||e[5]!==l?(x=()=>{l.length&&n(l)},f=[n,l],e[4]=n,e[5]=l,e[6]=x,e[7]=f):(x=e[6],f=e[7]),b.useEffect(x,f);let I,v;if(e[8]!==r?(I=()=>{const _=N=>{Mt(N)&&(N.preventDefault(),r({closable:!0,id:"auto-save-message",status:"info",title:"Your work is automatically saved!",duration:4e3}))};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},v=[r],e[8]=r,e[9]=I,e[10]=v):(I=e[9],v=e[10]),b.useEffect(I,v),!a._original?.types.some(ze)){let _;return e[11]===Symbol.for("react.memo_cache_sentinel")?(_=u.jsx(Tt,{}),e[11]=_):_=e[11],_}const k=m||null,C=o?void 0:"fill",z=p[1];let S;e[12]!==i?(S=i.map(Bt),e[12]=i,e[13]=S):S=e[13];let j;e[14]!==d||e[15]!==i.length?(j=i.length<=1&&d&&u.jsx(xe,{paneKey:"intent-resolver"}),e[14]=d,e[15]=i.length,e[16]=j):j=e[16];let $;e[17]!==g||e[18]!==w||e[19]!==p[1]||e[20]!==S||e[21]!==j||e[22]!==C?($=u.jsxs(zt,{flex:1,height:C,minWidth:z,onCollapse:g,onExpand:w,children:[S,j]}),e[17]=g,e[18]=w,e[19]=p[1],e[20]=S,e[21]=j,e[22]=C,e[23]=$):$=e[23];let E;e[24]!==l?(E=u.jsx(Dt,{resolvedPanes:l}),e[24]=l,e[25]=E):E=e[25];let T;e[26]===Symbol.for("react.memo_cache_sentinel")?(T=u.jsx("div",{"data-portal":"",ref:P}),e[26]=T):T=e[26];let R;return e[27]!==$||e[28]!==E||e[29]!==k?(R=u.jsxs(Me,{element:k,children:[$,E,T]}),e[27]=$,e[28]=E,e[29]=k,e[30]=R):R=e[30],R});function Ot(t){return typeof t.intent=="string"}function Bt(t){const{active:e,childItemId:n,groupIndex:r,itemId:a,key:o,pane:s,index:i,params:l,path:d,payload:c,siblingIndex:p,selected:m}=t;return u.jsx(b.Fragment,{children:s===A?u.jsx(xe,{paneKey:o,path:d,selected:m}):u.jsx(Le,{active:e,groupIndex:r,index:i,pane:s,childItemId:n,itemId:a,paneKey:o,params:l,payload:c,path:d,selected:m,siblingIndex:p})},`${s===A?"loading":s.type}-${i}`)}function At(t){const e=D.c(14),{tool:n}=t,{options:r}=n,{unstable_sources:a}=_e(),[o]=a;let s;e[0]!==r?(s=r||{},e[0]=r,e[1]=s):s=e[1];const{source:i,defaultDocumentNode:l,structure:d}=s;let c;e[2]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[2]=c):c=e[2],b.useEffect(Vt,c);let p;e[3]===Symbol.for("react.memo_cache_sentinel")?(p={error:null},e[3]=p):p=e[3];const[m,P]=b.useState(p),{error:h}=m;if(h){let I;return e[4]!==h?(I=u.jsx(jt,{error:h}),e[4]=h,e[5]=I):I=e[5],I}const g=i||o.name;let y,w;e[6]===Symbol.for("react.memo_cache_sentinel")?(y=u.jsx(Lt,{onPaneChange:ee}),w=u.jsx(bt,{}),e[6]=y,e[7]=w):(y=e[6],w=e[7]);let x;e[8]!==l||e[9]!==d?(x=u.jsxs(Oe,{defaultDocumentNode:l,structure:d,children:[y,w]}),e[8]=l,e[9]=d,e[10]=x):x=e[10];let f;return e[11]!==g||e[12]!==x?(f=u.jsx(je,{onCatch:P,children:u.jsx($e,{name:g,children:x})}),e[11]=g,e[12]=x,e[13]=f):f=e[13],f}function Vt(){return ee([]),Wt}function Wt(){return ee([])}export{At as default};
</file>

<file path="betternotes/dist/static/manifest.webmanifest">
{
  "icons": [
    {
      "src": "/static/favicon-96.png",
      "type": "image/png",
      "sizes": "96x96"
    },
    {
      "src": "/static/favicon-192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "/static/favicon-512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ]
}
</file>

<file path="betternotes/dist/static/refractor-Bm_vMXvg.js">
import{bl as c,j as i,bm as d}from"./sanity-z2y04qld.js";import{d as f}from"./SanityVision-CzEtxX32.js";function m(u){const e=f.c(13),{language:g,value:a}=u,t=typeof g=="string"?g:void 0;let o;e[0]!==t?(o=t?c(t):!1,e[0]=t,e[1]=o):o=e[1];const r=o;let s;e[2]!==t||e[3]!==r||e[4]!==a?(s=!(t&&r)&&i.jsx("code",{children:a}),e[2]=t,e[3]=r,e[4]=a,e[5]=s):s=e[5];let n;e[6]!==t||e[7]!==r||e[8]!==a?(n=t&&r&&i.jsx(d,{inline:!0,language:t,value:String(a)}),e[6]=t,e[7]=r,e[8]=a,e[9]=n):n=e[9];let l;return e[10]!==s||e[11]!==n?(l=i.jsxs(i.Fragment,{children:[s,n]}),e[10]=s,e[11]=n,e[12]=l):l=e[12],l}m.displayName="LazyRefractor";export{m as default};
</file>

<file path="betternotes/dist/static/refractor-DZZEKWBN.js">
import{bk as c,bl as d,j as i,bm as f}from"./sanity-z2y04qld.js";function p(u){const e=c.c(13),{language:g,value:a}=u,t=typeof g=="string"?g:void 0;let l;e[0]!==t?(l=t?d(t):!1,e[0]=t,e[1]=l):l=e[1];const r=l;let s;e[2]!==t||e[3]!==r||e[4]!==a?(s=!(t&&r)&&i.jsx("code",{children:a}),e[2]=t,e[3]=r,e[4]=a,e[5]=s):s=e[5];let n;e[6]!==t||e[7]!==r||e[8]!==a?(n=t&&r&&i.jsx(f,{inline:!0,language:t,value:String(a)}),e[6]=t,e[7]=r,e[8]=a,e[9]=n):n=e[9];let o;return e[10]!==s||e[11]!==n?(o=i.jsxs(i.Fragment,{children:[s,n]}),e[10]=s,e[11]=n,e[12]=o):o=e[12],o}p.displayName="LazyRefractor";export{p as default};
</file>

<file path="betternotes/dist/static/resources-aV_Fx8NC.js">
import{a as e}from"./sanity-z2y04qld.js";const o=e("comments",{"close-pane-button-text":"Close comments","close-pane-button-text-aria-label":"Close comments","compose.add-comment-input-placeholder":"Add comment to <strong>{{field}}</strong>","compose.add-comment-input-placeholder-upsell":"Upgrade to add comment","compose.create-comment-placeholder":"Create a new comment","compose.mention-user-aria-label":"Mention user","compose.mention-user-tooltip":"Mention user","compose.reply-placeholder":"Reply","compose.reply-placeholder-upsell":"Upgrade to reply","compose.send-comment-aria-label":"Send comment","compose.send-comment-tooltip":"Send comment","copy-link-error-message":"Unable to copy link to clipboard","delete-comment.body":"Once deleted, a comment cannot be recovered.","delete-comment.confirm":"Delete comment","delete-comment.title":"Delete this comment?","delete-dialog.error":"An error occurred while deleting the comment. Please try again.","delete-thread.body":"This comment and its replies will be deleted, and once deleted cannot be recovered.","delete-thread.confirm":"Delete thread","delete-thread.title":"Delete this comment thread?","discard.button-confirm":"Discard","discard.header":"Discard comment?","discard.text":"Do you want to discard the comment?","feature-feedback.link":"Share your feedback","feature-feedback.title":"Help improve ","feature-name":"Comments","field-button.aria-label-add":"Add comment","field-button.aria-label-open":"Open comments","field-button.content_one":"View comment","field-button.content_other":"View comments","field-button.title":"Add comment","inline-add-comment-button.disabled-overlap-title":"Comments cannot overlap","inline-add-comment-button.title":"Add comment","list-item.breadcrumb-button-go-to-field-aria-label":"Go to {{field}} field","list-item.context-menu-add-reaction":"Add reaction","list-item.context-menu-add-reaction-aria-label":"Add reaction","list-item.context-menu-add-reaction-upsell":"Upgrade to add reaction","list-item.copy-link":"Copy link to comment","list-item.delete-comment":"Delete comment","list-item.edit-comment":"Edit comment","list-item.edit-comment-upsell":"Upgrade to edit comment","list-item.go-to-field-button.aria-label":"Go to field","list-item.layout-context":"on <IntentLink>{{title}}</IntentLink>","list-item.layout-edited":"edited","list-item.layout-failed-sent":"Failed to send.","list-item.layout-posting":"Posting...","list-item.layout-retry":"Retry","list-item.missing-referenced-value-tooltip-content":"The commented text has been deleted","list-item.open-menu-aria-label":"Open comment actions menu","list-item.re-open-resolved":"Re-open","list-item.re-open-resolved-aria-label":"Re-open","list-item.resolved-tooltip-aria-label":"Mark comment as resolved","list-item.resolved-tooltip-content":"Mark as resolved","list-status.empty-state-open-text":"Open comments on this document will be shown here.","list-status.empty-state-open-title":"No open comments yet","list-status.empty-state-resolved-text":"Resolved comments on this document will be shown here.","list-status.empty-state-resolved-title":"No resolved comments yet","list-status.error":"Something went wrong","list-status.loading":"Loading comments","mentions.no-users-found":"No users found","mentions.unauthorized-user":"Unauthorized","mentions.user-list-aria-label":"List of users to mention","onboarding.body":"You can add comments to any field in a document. They'll show up here, grouped by field.","onboarding.dismiss":"Got it","onboarding.header":"Document fields now have comments","reactions.add-reaction-tooltip":"Add reaction","reactions.react-with-aria-label":"React with {{reactionName}}","reactions.user-list.unknown-user-fallback-name":"Unknown user","reactions.user-list.you":"you","reactions.user-list.you_leading":"You","reactions.users-reacted-with-reaction":"<UserList/> <Text>reacted with</Text> <ReactionName/>","status-filter.status-open":"Open","status-filter.status-open-full":"Open comments","status-filter.status-resolved":"Resolved","status-filter.status-resolved-full":"Resolved comments","status-filter.status-resolved-full-upsell":"Upgrade to see resolved comments"});export{o as default};
</file>

<file path="betternotes/dist/static/resources-DtW-TvUT.js">
import{a as e}from"./sanity-z2y04qld.js";const t=e("vision",{"action.copy-url-to-clipboard":"Copy to clipboard","action.delete":"Delete","action.edit-title":"Edit title","action.listen-cancel":"Stop","action.listen-execute":"Listen","action.load-queries":"Load queries","action.load-query":"Load query","action.query-cancel":"Cancel","action.query-execute":"Fetch","action.save-query":"Save query","action.update":"Update","label.actions":"Actions","label.edited":"Edited","label.new":"New","label.personal":"Personal","label.saved-at":"Saved at","label.saved-queries":"Saved queries","label.search-queries":"Search queries","label.share":"Share","label.team":"Team","params.error.params-invalid-json":"Parameters are not valid JSON","params.label":"Params","query.error.column":"Column","query.error.line":"Line","query.label":"Query","query.url":"Query URL","result.end-to-end-time-label":"End-to-end","result.execution-time-label":"Execution","result.label":"Result","result.save-result-as-csv.not-csv-encodable":"Result cannot be encoded as CSV","result.save-result-as-format":"Save result as <SaveResultButtons/>","result.timing-not-applicable":"n/a","save-query.already-saved":"Query already saved","save-query.error":"Error saving query","save-query.success":"Query saved","settings.api-version-label":"API version","settings.custom-api-version-label":"Custom API version","settings.dataset-label":"Dataset","settings.error.invalid-api-version":"Invalid API version","settings.other-api-version-label":"Other","settings.perspective-label":"Perspective","settings.perspective.preview-drafts-renamed-to-drafts.description":'The "<code>previewDrafts</code>" perspective has been renamed to "<code>drafts</code>" and is now deprecated. This change is effective for all versions with perspective support (>= v2021-03-25).',"settings.perspectives.action.docs-link":"Read docs","settings.perspectives.default":"No perspective (API default)","settings.perspectives.description":'Perspectives allow your query to run against different "views" of the content in your dataset',"settings.perspectives.new-default.description":'The default perspective will change from "<code>raw</code>" to "<code>published</code>" in an upcoming API version. Please consult docs for more details.',"settings.perspectives.pinned-release-label":"Pinned release","settings.perspectives.title":"Perspectives"});export{t as default};
</file>

<file path="betternotes/dist/static/resources2-B6S5a0Tb.js">
const e={"action.add-document":"Add document","action.archive":"Archive release","action.archive.tooltip":"Unschedule this release to archive it","action.archived":"Archived","action.create-revert-release":"Create a new release","action.delete-release":"Delete release","action.drafts":"Scheduled drafts","action.duplicate-release":"Duplicate release","action.edit":"Edit release","action.open":"Active","action.releases":"Releases","action.schedule":"Schedule release...","action.schedule-unpublish":"Schedule Unpublish","action.schedule-unpublish.disabled.not-published":"Document must be published to schedule unpublish","action.unpublish":"Unpublish","action.unpublish-doc-actions":"Unpublish when releasing","action.revert-unpublish-actions":"Revert unpublish when releasing","action.unschedule":"Unschedule release","action.publish-all-documents":"Run release","action.review":"Review changes","action.revert":"Revert release","actions.summary":"Summary","action.immediate-revert-release":"Revert now","action.unarchive":"Unarchive release","activity.event.add-document":"added a document version","activity.event.archive":"archived the <strong>{{releaseTitle}}</strong> release","activity.event.create":"created the <strong>{{releaseTitle}}</strong> release <ScheduleTarget>targeting </ScheduleTarget>","activity.event.discard-document":"discarded a document version","activity.event.edit":"set release time to <ScheduleTarget></ScheduleTarget>","activity.event.edit-time-asap":"immediately","activity.event.edit-time-undecided":"never","activity.event.publish":"published the <strong>{{releaseTitle}}</strong> release","activity.event.schedule":"marked as scheduled","activity.event.unarchive":"unarchived the <strong>{{releaseTitle}}</strong> release","activity.event.unschedule":"marked as unscheduled","activity.panel.loading":"Loading release activity","activity.panel.error":"An error occurred getting the release activity","activity.panel.title":"Activity","archive-dialog.confirm-archive-header":"Are you sure you want to archive this release?","archive-dialog.confirm-archive-title":"Are you sure you want to archive the <strong>'{{title}}'</strong> release?","archive-dialog.confirm-archive-description_one":"This will archive 1 document version.","archive-dialog.confirm-archive-description_other":"This will archive {{count}} document versions.","archive-dialog.confirm-archive-button":"Yes, archive release","archive-info.title":"This release is archived","archive-info.description":"Your plan supports a {{retentionDays}}-day retention period. After this period this release will be removed.","changes-published-docs.title":"Changes to published documents",created:"Created <RelativeTime/>","copy-suffix":"Copy","dashboard.details.published-asap":"Published","dashboard.details.published-on":"Published on {{date}}","dashboard.details.pin-release":"Pin release to studio","dashboard.details.unpin-release":"Unpin release from studio","dashboard.details.activity":"Activity","delete-dialog.confirm-delete.header":"Are you sure you want to delete this release?","delete-dialog.confirm-delete-description_one":"This will delete 1 document version.","delete-dialog.confirm-delete-description_other":"This will delete {{count}} document versions.","delete-dialog.confirm-delete-button":"Yes, delete release","diff.no-changes":"No changes","diff.list-empty":"Changes list is empty, see document","discard-version-dialog.description-draft":"This will permanently remove all changes made to this document. This action cannot be undone.","discard-version-dialog.description-release":"This will permanently remove all changes made to this document within the '<strong>{{releaseTitle}}</strong>' release. This action cannot be undone.","discard-version-dialog.header-draft":"Discard draft?","discard-version-dialog.header-release":"Remove document from the '<strong>{{releaseTitle}}</strong>' release?","discard-version-dialog.title-draft":"Discard draft","discard-version-dialog.title-release":"Remove from release","document-validation.error_other":"{{count}} validation errors","document-validation.error_one":"{{count}} validation error","deleted-release":"The '<strong>{{title}}</strong>' release has been deleted","duplicate-dialog.confirm-duplicate-header":"Are you sure you want to duplicate this release?","duplicate-dialog.confirm-duplicate-description_one":"This will duplicate the release and the 1 document version.","duplicate-dialog.confirm-duplicate-description_other":"This will duplicate the release and the {{count}} document versions.","duplicate-dialog.confirm-duplicate-button":"Yes, duplicate release","error-details-title":"Error details","failed-edit-title":"Failed to save changes","failed-publish-title":"Failed to publish","failed-schedule-title":"Failed to schedule","footer.status.archived":"Archived","footer.status.created":"Created","footer.status.edited":"Edited","footer.status.published":"Published","footer.status.unarchived":"Unarchived","loading-release":"Loading release","loading-release-documents":"Loading documents","loading-release-documents.error.title":"Something went wrong","loading-release-documents.error.description":"We're unable to load the documents for this release. Please try again later.","menu.label":"Release menu","menu.tooltip":"Actions","menu.group.when-releasing":"When releasing","no-archived-release":"No archived releases","no-releases":"No Releases","not-found":"Release not found: {{releaseId}}","overview.action.documentation":"Documentation","overview.calendar.tooltip":"View calendar","overview.description":"Releases are collections of document changes which can be managed, scheduled, and rolled back together.","overview.search-releases-placeholder":"Search releases","overview.title":"Releases","permissions.error.discard-version":"You do not have permission to discard this version","permissions.error.unpublish":"You do not have permission to unpublish this document","permission-missing-title":"Limited access","permission-missing-description":"Your role currently limits what you can see in this release. You may not publish nor schedule this release.","permissions.error.archive":"You do not have permission to archive this release","permissions.error.delete":"You do not have permission to delete this release","permissions.error.duplicate":"You do not have permission to duplicate this release","permissions.error.unarchive":"You do not have permission to unarchive this release","presence.tooltip.one":'{{displayName}} is editing this document in the "{{releaseTitle}}" release right now',"presence.tooltip.other":"{{count}} people are editing this document right now","publish-action.validation.no-documents":"There are no documents to publish","publish-dialog.confirm-publish.title":"Are you sure you want to publish the release and all document versions?","publish-dialog.confirm-publish-description_one":"The '<strong>{{title}}</strong>' release and its document will be published.","publish-dialog.confirm-publish-description_other":"The '<strong>{{title}}</strong>' release and its {{releaseDocumentsLength}} documents will be published.","publish-dialog.validation.no-permission":"You do not have permission to publish","publish-dialog.validation.loading":"Validating documents...","publish-dialog.validation.error":"Some documents have validation errors","publish-info.title":"This release is published","release-placeholder.title":"Untitled","review.description":"Add documents to this release to review changes","review.edited":"Edited <RelativeTime/>","revert-dialog.confirm-revert-description_one":"This will revert {{releaseDocumentsLength}} document version.","revert-dialog.confirm-revert-description_other":"This will revert {{releaseDocumentsLength}} document versions.","revert-dialog.confirm-revert.title":"Are you sure you want to revert the '{{title}}' release?","revert-dialog.confirm-revert.stage-revert-checkbox-label":"Immediately revert the release","revert-dialog.confirm-revert.warning-card":"Changes were made to documents in this release after they were published. Reverting will overwrite these changes.","revert-release.title":'Reverting "{{title}}"',"revert-release.description":'Revert changes to document versions in "{{title}}".',"schedule-button.tooltip":"Are you sure you want to unschedule the release?","schedule-action.validation.no-documents":"There are no documents to schedule","schedule-button-tooltip.validation.no-permission":"You do not have permission to schedule","schedule-button-tooltip.validation.loading":"Validating documents...","schedule-button-tooltip.validation.error":"Some documents have validation errors","schedule-button-tooltip.already-scheduled":"This release is already scheduled","schedule-dialog.confirm-title":"Schedule the release","schedule-dialog.confirm-description_one":"The '<strong>{{title}}</strong>' release and its document will be published on the selected date.","schedule-dialog.confirm-description_other":"The <strong>{{title}}</strong> release and its {{count}} document versions will be scheduled.","schedule-dialog.confirm-button":"Yes, schedule","schedule-dialog.select-publish-date-label":"Schedule on","unschedule-dialog.confirm-title":"Are you sure you want to unschedule the release?","unschedule-dialog.confirm-description":"The release will no longer be published on the scheduled date","schedule-dialog.publish-date-in-past-warning":"Schedule this release for a future time and date.","schedule-unpublish-dialog.header":"Schedule draft for Unpublish","schedule-unpublish-dialog.description":"Select when this document should be unpublished.","schedule-unpublish-dialog.confirm":"Schedule Unpublish","search-documents-placeholder":"Search documents","summary.created":"Created <RelativeTime/>","summary.published":"Published <RelativeTime/>","summary.not-published":"Not published","summary.no-documents":"No documents","summary.document-count_one":"{{count}} document","summary.document-count_other":"{{count}} documents","summary.validating-documents":"Validating documents: {{validatedCount}} of {{totalCount}}","summary.validated-documents":"{{validatedCount}} of {{totalCount}} documents validated","summary.all-documents-validated":"All documents validated, no conflicts found","summary.all-documents-errors-found":"All documents validated, conflicts found","summary.errors-found":"In order to publish or schedule the release, please resolve the conflicts found in the documents","table-body.action.add":"Add","table-body.action.change":"Change","table-body.action.unpublish":"Unpublish","table-header.archivedAt":"Archived","table-header.contributors":"Contributors","table-header.created-by":"Created by","table-header.document":"Document","table-header.documents":"Documents","table-header.edited":"Edited","table-header.published-at":"Published","table-header.publishedAt":"Published","table-header.scheduled-draft.published-at":"Published at","table-header.scheduled-for":"Scheduled for","table-header.time":"Time","table-header.title":"Release","table-header.type":"Type","table-header.action":"Action","toast.archive.error":"Failed to archive '<strong>{{title}}</strong>': {{error}}","toast.create-version.error":"Failed to add document to release: {{error}}","toast.delete.error":"Failed to delete '<strong>{{title}}</strong>': {{error}}","toast.delete.success":"The '<strong>{{title}}</strong>' release was successfully deleted","toast.duplicate.error":"Failed to duplicate '<strong>{{title}}</strong>': {{error}}","toast.duplicate.success":"The '<strong>{{title}}</strong>' release was duplicated. <Link/>","toast.duplicate.success-link":"View duplicated release","toast.publish.error":"Failed to publish '<strong>{{title}}</strong>': {{error}}","toast.schedule.error":"Failed to schedule '<strong>{{title}}</strong>': {{error}}","toast.schedule.success":"The '<strong>{{title}}</strong>' release was scheduled.","toast.unschedule.error":"Failed to unscheduled '<strong>{{title}}</strong>': {{error}}","toast.unarchive.error":"Failed to unarchive '<strong>{{title}}</strong>': {{error}}","type-picker.tooltip.scheduled":"The release is scheduled, unschedule it to change type","toast.revert.error":"Failed to revert release: {{error}}","toast.immediate-revert.success":"The '{{title}}' release was successfully reverted","toast.revert-stage.success":"Revert release for '{{title}}' was successfully created. <Link/>","toast.revert-stage.success-link":"View revert release","unpublish.already-unpublished":"This document is already unpublished.","unpublish.no-published-version":"There is no published version of this document.","unpublish-dialog.header":"Are you sure you want to unpublish this document when releasing?","unpublish-dialog.action.cancel":"Cancel","unpublish-dialog.action.unpublish":"Yes, unpublish when releasing","unpublish-dialog.description.to-draft":"This will unpublish the document as part of the <Label>{{title}}</Label> release, and create a draft if no draft exists at the time of release.","unpublish-dialog.description.lost-changes":"Any changes made to this document version will be lost.","banner.scheduled-drafts-disabled":"Scheduled drafts has been disabled but there are still scheduled drafts to be published.","banner.drafts-mode-disabled":"Drafts mode has been disabled but there are still scheduled drafts to be published.","no-scheduled-drafts":"No Scheduled Drafts","banner.confirm-active-scheduled-drafts_one":"There is {{count}} Scheduled Draft that requires scheduling confirmation","banner.confirm-active-scheduled-drafts_other":"There are {{count}} Scheduled Drafts that require scheduling confirmation","banner.confirm-active-scheduled-drafts.button":"Confirm scheduling","confirm-active-scheduled-drafts-dialog.title":"Confirm Scheduled Drafts","confirm-active-scheduled-drafts-dialog.description":"These drafts require confirmation to schedule their publishing.","confirm-active-scheduled-drafts-dialog.past-dates-warning":"Some of these Scheduled Drafts are scheduled for past dates. Confirming schedules will immediately publish those versions of documents.","confirm-active-scheduled-drafts-dialog.confirm-button":"Confirm Schedules","toast.confirm-active-scheduled-drafts.error":"Failed to schedule drafts: {{error}}"};export{e as default};
</file>

<file path="betternotes/dist/static/resources3-B2B2q3bS.js">
import{a as t}from"./sanity-z2y04qld.js";const s=t("tasks",{"actions.create.text":"Create new task","actions.open.text":"Tasks","buttons.create.text":"Create Task","buttons.discard.text":"Discard","buttons.draft.text":"Draft","buttons.new.text":"New task","buttons.new.upsell-tooltip":"Upgrade to create tasks","buttons.next.tooltip":"Go to next task","buttons.previous.tooltip":"Go to previous task","dialog.remove-task.body":"Once deleted, a task cannot be recovered.","dialog.remove-task.buttons.cancel.text":"Cancel","dialog.remove-task.buttons.confirm.text":"Delete","dialog.remove-task.title":"Delete this task?","document.footer.open-tasks.placeholder_one":"Open task","document.footer.open-tasks.placeholder_other":"Open tasks","document.footer.open-tasks.text_one":"{{count}} open task","document.footer.open-tasks.text_other":"{{count}} open tasks","empty-state.list.assigned.heading":"You haven't been assigned any tasks","empty-state.list.assigned.text":"Once you're assigned tasks they'll show up here","empty-state.list.create-new":"Create new task","empty-state.list.document.heading":"This document doesn't have any tasks yet","empty-state.list.document.text":"Once a document has connected tasks, they will be shown here.","empty-state.list.no-active-document.heading":"Open a document to see its task","empty-state.list.no-active-document.text":"Tasks on your active document will be shown here.","empty-state.list.subscribed.heading":"You haven't subscribed to any tasks","empty-state.list.subscribed.text":"When you create, modify, or comment on a task you will be subscribed automatically","empty-state.status.list.closed.assigned.heading":"No completed tasks","empty-state.status.list.closed.assigned.text":"Your tasks marked done will show up here","empty-state.status.list.closed.document.heading":"No completed tasks","empty-state.status.list.closed.subscribed.heading":"No completed tasks","empty-state.status.list.closed.subscribed.text":"Tasks you subscribe to marked done will show up here","empty-state.status.list.open.assigned.heading":"You're all caught up","empty-state.status.list.open.assigned.text":"New tasks assigned to you will show up here","empty-state.status.list.open.document.heading":"No tasks on this document","empty-state.status.list.open.subscribed.heading":"No subscribed tasks","empty-state.status.list.open.subscribed.text":"Tasks you subscribe to will show up here","form.input.assignee.no-user-assigned.text":"Unassigned","form.input.assignee.no-user-assigned.tooltip":"Set assignee","form.input.assignee.search.no-users.text":"No users found","form.input.assignee.search.placeholder":"Select assignee","form.input.assignee.unauthorized.text":"Unauthorized","form.input.assignee.user-assigned.tooltip":"Change assignee","form.input.assignee.user-not-found.text":"User not found","form.input.create-more.text":"Create more","form.input.date.buttons.empty.tooltip":"Set due date","form.input.date.buttons.remove.text":"Remove","form.input.date.buttons.tooltip":"Change due date","form.input.description.placeholder":"Add description","form.input.status.button.tooltip":"Change status","form.input.target.buttons.remove.text":"Remove target content","form.input.target.error.schema-not-found":"Schema not found","form.input.target.search.placeholder":"Select target document","form.input.title.placeholder":"Task title","form.status.error.title-required":"Title is required","form.status.success":"Task created","list.empty.text":"No tasks","list.feedback.text":"Help us improve, <Link>share feedback on Tasks</Link> ","menuitem.copylink.text":"Copy link to task","menuitem.delete.text":"Delete task","menuitem.duplicate.text":"Duplicate task","menuitem.duplicate.upsell-tooltip":"Upgrade to duplicate tasks","panel.activity.created-fragment":"created this task","panel.activity.title":"Activity","panel.activity.unknown-user":"Unknown user","panel.close.tooltip":"Close sidebar","panel.comment.placeholder":"Add a comment...","panel.comment.placeholder.upsell":"Upgrade to comment on tasks","panel.create.title":"Create","panel.drafts.title":"Drafts","panel.navigation.tooltip":"Open tasks","panel.title":"Tasks","tab.assigned.label":"Assigned","tab.document.label":"Active Document","tab.subscribed.label":"Subscribed","toolbar.tooltip":"Tasks"});export{s as default};
</file>

<file path="betternotes/dist/static/resources4-DbN9N6zZ.js">
import{a as n}from"./sanity-z2y04qld.js";const i=n("canvas",{"action.link-document":"Link to Canvas","action.link-document-disabled.not-in-dashboard":"Open this document in Dashboard to link to Canvas","action.link-document-disabled.missing-permissions":"You don't have permissions to link this document to Canvas","action.link-document-disabled.version-document":"Version documents are not yet supported in Canvas","action.link-document-disabled.initial-value-not-resolved":"Please wait until the document initial values are resolved","action.unlink-document":"Unlink from Canvas","action.edit-document":"Edit in Canvas","banner.linked-to-canvas":"This document is linked to Canvas","banner.edit-document-in-canvas":"Edit in Canvas","dialog.confirm-document-changes.title":"Confirm document changes","dialog.confirm-document-changes.description":`This document needs to be updated to be compatible with Canvas.
 Existing content may be edited or removed as part of this process.`,"dialog.confirm-document-changes.confirm":"Accept and continue","dialog.confirm-document-changes.cancel":"Cancel","dialog.confirm-document-changes.footer-description":"You can unlink from Canvas at any time","dialog.link-to-canvas.title":"Link to Canvas","dialog.link-to-canvas.validating":"Validating","dialog.link-to-canvas.redirecting":"Taking you to Canvas to complete linking...","dialog.link-to-canvas.error":"Failed to link to Canvas","dialog.unlink-from-canvas.title":"Unlink from Canvas","dialog.unlink-from-canvas.unlinking":"You're unlinking  <strong>“{{documentTitle}}”</strong> from Canvas.","dialog.unlink-from-canvas.cancel":"Cancel","dialog.unlink-from-canvas.unlink-action":"Unlink now","dialog.unlink-from-canvas.description":"Once unlinked, it will be editable here and future edits in Canvas will no longer automatically map to this document.","dialog.unlink-from-canvas.success":"Unlinked from Canvas","dialog.unlink-from-canvas.error":"Failed to unlink from Canvas","navigate-to-canvas-doc.error.missing-permissions":"Missing permissions to navigate to Canvas"});export{i as default};
</file>

<file path="betternotes/dist/static/resources5-OezZE7EX.js">
import{a as e}from"./sanity-z2y04qld.js";const n=e("create",{"start-in-create-dialog.cta.learn-more":"Learn more.","studio-create-link-banner.text":"This document is linked to Sanity Create","create-link-info.tooltip":"Learn more","create-link-info-popover.eyebrow-title":"Sanity Create","create-link-info-popover.eyebrow-badge":"Early access","create-link-info-popover.header":"Idea-first authoring","create-link-info-popover.text":"Write naturally in an AI-powered editor. Your content automatically maps to Studio fields as you type.","edit-in-create-button.text":"Edit with Sanity Create","unlink-from-create-button.text":"Unlink","unlink-from-create-dialog.header":"Switch editing to Studio?","unlink-from-create-dialog.first-paragraph":"You’re unlinking “<strong>{{title}}</strong>” from Sanity Create so it can be edited here.","unlink-from-create-dialog.second-paragraph":"You’ll keep your content in both places. Any new changes in Sanity Create will stop syncing to this Studio.","unlink-from-create-dialog.cancel.text":"Cancel","unlink-from-create-dialog.document.untitled.text":"Untitled","unlink-from-create-dialog.unlink.text":"Unlink now"});export{n as default};
</file>

<file path="betternotes/dist/static/resources6-CyZXUTJw.js">
const e={"action.schedule-publish":"Schedule Publish","action.schedule-publish-success":"Document scheduled for publishing","action.schedule-publish-success-description":"Publishing scheduled for {{publishAt}}","action.schedule-publish-error":"Failed to schedule publishing","action.schedule-publish.disabled.validation-issues":"Cannot Schedule Draft due to validation errors in the current draft.","action.schedule-publish.disabled.cardinality-one":"A Scheduled Draft for this document already exists.","empty-state.title":"Scheduled drafts","empty-state.description":"Schedule and lock draft documents for publishing at a future date and time.","empty-state.action.documentation":"Learn about scheduling"};export{e as default};
</file>

<file path="betternotes/dist/static/resources7-el_Vnbtr.js">
import{a as e}from"./sanity-z2y04qld.js";const n=e("structure",{"action.copy-document-url.label":"Copy Document URL","action.delete.disabled.not-ready":"Operation not ready","action.delete.disabled.nothing-to-delete":"This document doesn't yet exist or is already deleted","action.delete.label":"Delete","action.delete.running.label":"Deleting…","action.disabled-by-canvas.tooltip":"Some document actions are disabled for documents linked to Canvas","action.discard-changes.confirm-dialog.confirm-discard-changes":"Are you sure you want to discard all changes since last published?","action.discard-changes.disabled.no-change":"This document has no unpublished changes","action.discard-changes.disabled.not-published":"This document is not published","action.discard-changes.disabled.not-ready":"Operation not ready","action.discard-changes.label":"Discard changes","action.duplicate.disabled.not-ready":"Operation not ready","action.duplicate.disabled.nothing-to-duplicate":"This document doesn't yet exist so there's nothing to duplicate","action.duplicate.label":"Duplicate","action.duplicate.running.label":"Duplicating…","action.publish.already-published.no-time-ago.tooltip":"Already published","action.publish.already-published.tooltip":"Published {{timeSincePublished}}","action.publish.disabled.not-ready":"Operation not ready","action.publish.draft.label":"Publish","action.publish.label":"Publish","action.publish.live-edit.label":"Publish","action.publish.live-edit.publish-disabled":"Cannot publish since Live Edit is enabled for this document type","action.publish.live-edit.tooltip":"Live Edit is enabled for this content type and publishing happens automatically as you make changes","action.publish.no-changes.tooltip":"No unpublished changes","action.publish.published.label":"Published","action.publish.running.label":"Publishing…","action.publish.validation-issues.tooltip":"There are validation errors that need to be fixed before this document can be published","action.publish.waiting":"Waiting for tasks to finish before publishing","action.restore.confirm.message":"Are you sure you want to restore this document?","action.restore.disabled.cannot-restore-initial":"You can't restore to the initial revision","action.restore.label":"Revert to revision","action.restore.tooltip":"Restore to this revision","action.unpublish.disabled.not-published":"This document is not published","action.unpublish.disabled.not-ready":"Operation not ready","action.unpublish.label":"Unpublish","action.unpublish.live-edit.disabled":"This document has live edit enabled and cannot be unpublished","banners.archived-release.description":"This document version belongs to the archived <VersionBadge>{{title}}</VersionBadge> release","banners.archived-scheduled-draft.description":"This scheduled draft is archived","banners.choose-new-document-destination.cannot-create-draft-document":"Cannot create a draft document.","banners.choose-new-document-destination.cannot-create-published-document":"Cannot create a published document.","banners.choose-new-document-destination.choose-destination":"Choose a destination for this document:","banners.choose-new-document-destination.release-inactive":"The <VersionBadge>{{title}}</VersionBadge> release is not active.","banners.deleted-document-banner.restore-button.text":"Restore most recent revision","banners.deleted-document-banner.text":"This document has been deleted.","banners.deprecated-document-type-banner.text":"This document type has been deprecated.","banners.live-edit-draft-banner.discard.tooltip":"Discard draft to continue editing.","banners.live-edit-draft-banner.publish.tooltip":"Publish draft to continue editing.","banners.live-edit-draft-banner.text":"The type <strong>{{schemaType}}</strong> has <code>liveEdit</code> enabled, but a draft version of this document exists. Publish or discard the draft in order to continue live editing it.","banners.obsolete-draft.actions.compare-draft.text":"Compare draft","banners.obsolete-draft.actions.discard-draft.text":"Discard draft","banners.obsolete-draft.actions.publish-draft.text":"Publish draft","banners.obsolete-draft.draft-model-inactive.text":"The workspace does not have drafts enabled, but a draft version of this document exists.","banners.permission-check-banner.missing-permission_create_one":"Your role <Roles/> does not have permission to publish this document.","banners.permission-check-banner.missing-permission_create_other":"Your roles <Roles/> do not have permission to publish this document.","banners.permission-check-banner.missing-permission_update_one":"Your role <Roles/> does not have permission to edit this document.","banners.permission-check-banner.missing-permission_update_other":"Your roles <Roles/> do not have permission to edit this document.","banners.permission-check-banner.request-permission-button.sent":"Editor request sent","banners.permission-check-banner.request-permission-button.text":"Ask to edit","banners.published-release.description":"You are viewing a read-only document that was published as part of <VersionBadge>{{title}}</VersionBadge>. It can't be edited","banners.reference-changed-banner.reason-changed.reload-button.text":"Reload reference","banners.reference-changed-banner.reason-changed.text":"This reference has changed since you opened it.","banners.reference-changed-banner.reason-removed.close-button.text":"Close reference","banners.reference-changed-banner.reason-removed.text":"This reference has been removed since you opened it.","banners.release.action.add-to-release":"Add to release","banners.release.action.open-to-edit":"Open release to edit","banners.release.error.description":"An error occurred when adding document to the release: {{message}}","banners.release.error.title":"Error adding document to release","banners.release.navigate-to-edit-description":"The document only exists in the","banners.release.navigate-to-edit-description-end_one":"release","banners.release.navigate-to-edit-description-end_other":"releases","banners.release.navigate-to-edit-description-multiple_one":"This document is part of the <VersionBadge/> release and {{count}} more release.","banners.release.navigate-to-edit-description-multiple_other":"This document is part of the <VersionBadge/> release and {{count}} more releases","banners.release.navigate-to-edit-description-single":"This document is part of the <VersionBadge/> release","banners.release.not-in-release":"Not in the <VersionBadge>{{title}}</VersionBadge> release.","banners.release.waiting.description":"Please hold tight while the document is added to the release. It should not take longer than a few seconds.","banners.release.waiting.title":"Adding document to release…","banners.revision-not-found.description":"We couldn't find the document revision selected, please select another entry from the history list.","banners.scheduled-draft-override-banner.text":"A scheduled draft for this document exists. If you publish changes now they will be overwritten when the schedule runs.","banners.unpublished-release-banner.text":"This document will be unpublished as part of the <VersionBadge>{{title}}</VersionBadge> release.","banners.unpublished-release-banner.text-with-published":"Showing the current <strong>published</strong> version:","browser-document-title.new-document":"New {{schemaType}}","browser-document-title.untitled-document":"Untitled","buttons.action-menu-button.aria-label":"Open document actions","buttons.action-menu-button.tooltip":"Document actions","buttons.split-pane-button.aria-label":"Split pane right","buttons.split-pane-button.tooltip":"Split pane right","buttons.split-pane-close-button.title":"Close split pane","buttons.split-pane-close-group-button.title":"Close pane group","canvas.banner.edit-in-canvas-action":"Edit in Canvas","canvas.banner.linked-text.draft":"This draft document is linked to Canvas","canvas.banner.linked-text.published":"This live document is linked to Canvas","canvas.banner.linked-text.version":"This version document is linked to Canvas","canvas.banner.popover-button-text":"Learn more","canvas.banner.popover-description":"Canvas lets you author in a free-form editor that automatically maps back to the Studio as structured content - as you type.","canvas.banner.popover-heading":"Idea first authoring","changes.banner.description":"Showing the history for the <strong>{{perspective}}</strong> version of this document.","changes.banner.tooltip":"This view shows the changes that occurred in a specific version of this document. Select a different version to see its changes","changes.from.label":"From","changes.tab.history":"History","changes.tab.review-changes":"Review changes","changes.to.label":"To","compare-version.error.invalidModeParam":'"{{input}}" is not a supported document comparison mode.',"compare-version.error.invalidNextDocumentParam":"The next document parameter is invalid.","compare-version.error.invalidParams.title":"Unable to compare documents","compare-version.error.invalidPreviousDocumentParam":"The previous document parameter is invalid.","compare-versions.menu-item.disabled-reason":"There are no other versions of this document to compare.","compare-versions.menu-item.title":"Compare versions","compare-versions.status.draft":"Draft","compare-versions.status.published":"Published","compare-versions.title":"Compare versions","confirm-delete-dialog.cancel-button.text":"Cancel","confirm-delete-dialog.cdr-summary.document-count_one":"1 document","confirm-delete-dialog.cdr-summary.document-count_other":"{{count}} documents","confirm-delete-dialog.cdr-summary.subtitle_one":"Dataset: {{datasets}}","confirm-delete-dialog.cdr-summary.subtitle_other":"Datasets: {{datasets}}","confirm-delete-dialog.cdr-summary.subtitle_unavailable_one":"Unavailable dataset","confirm-delete-dialog.cdr-summary.subtitle_unavailable_other":"Unavailable datasets","confirm-delete-dialog.cdr-summary.title_one":"{{documentCount}} in another dataset","confirm-delete-dialog.cdr-summary.title_other":"{{documentCount}} in {{count}} datasets","confirm-delete-dialog.cdr-table.copy-id-button.tooltip":"Copy ID to clipboard","confirm-delete-dialog.cdr-table.dataset.label":"Dataset","confirm-delete-dialog.cdr-table.document-id.label":"Document ID","confirm-delete-dialog.cdr-table.id-copied-toast.title-failed":"Failed to copy document ID","confirm-delete-dialog.cdr-table.project-id.label":"Project ID","confirm-delete-dialog.confirm-anyway-button.text_delete":"Delete anyway","confirm-delete-dialog.confirm-anyway-button.text_unpublish":"Unpublish anyway","confirm-delete-dialog.confirm-button.text_delete":"Delete now","confirm-delete-dialog.confirm-button.text_unpublish":"Unpublish now","confirm-delete-dialog.confirmation.text_delete":"Are you sure you want to delete “<DocumentTitle/>”?","confirm-delete-dialog.confirmation.text_unpublish":"Are you sure you want to unpublish “<DocumentTitle/>”?","confirm-delete-dialog.error.message.text":"An error occurred while loading referencing documents.","confirm-delete-dialog.error.retry-button.text":"Retry","confirm-delete-dialog.error.title.text":"Error","confirm-delete-dialog.header.text_delete":"Delete document?","confirm-delete-dialog.header.text_unpublish":"Unpublish document?","confirm-delete-dialog.loading.text":"Looking for referring documents…","confirm-delete-dialog.other-reference-count.title_one":"1 other reference not show","confirm-delete-dialog.other-reference-count.title_other":"{{count}} other references not shown","confirm-delete-dialog.other-reference-count.tooltip":"We can't display metadata for these references due to a missing access token for the related datasets.","confirm-delete-dialog.preview-item.preview-unavailable.subtitle":"ID: {{documentId}}","confirm-delete-dialog.preview-item.preview-unavailable.title":"Preview unavailable","confirm-delete-dialog.referential-integrity-disclaimer.text_delete":"If you delete this document, documents that refer to it will no longer be able to access it.","confirm-delete-dialog.referential-integrity-disclaimer.text_unpublish":"If you unpublish this document, documents that refer to it will no longer be able to access it.","confirm-delete-dialog.referring-document-count.text_one":"1 document refers to “<DocumentTitle/>”","confirm-delete-dialog.referring-document-count.text_other":"{{count}} documents refer to “<DocumentTitle/>”","confirm-delete-dialog.referring-documents-descriptor.text_delete":"You may not be able to delete “<DocumentTitle/>” because the following documents refer to it:","confirm-delete-dialog.referring-documents-descriptor.text_unpublish":"You may not be able to unpublish “<DocumentTitle/>” because the following documents refer to it:","confirm-dialog.cancel-button.fallback-text":"Cancel","confirm-dialog.confirm-button.fallback-text":"Confirm","default-definition.content-title":"Content","doc-title.error.text":"Error: {{errorMessage}}","doc-title.fallback.text":"Untitled","doc-title.unknown-schema-type.text":"Unknown schema type: {{schemaType}}","document-inspector.close-button.tooltip":"Close","document-inspector.dialog.title":"Inspecting <DocumentTitle/>","document-inspector.dialog.title-no-value":"No value","document-inspector.menu-item.title":"Inspect","document-inspector.search.placeholder":"Search","document-inspector.view-mode.parsed":"Parsed","document-inspector.view-mode.raw-json":"Raw JSON","document-view.form-view.form-hidden":"This form is hidden","document-view.form-view.form-title-fallback":"Untitled","document-view.form-view.loading":"Loading document…","document-view.form-view.sync-lock-toast.description":"Please hold tight while the document is synced. This usually happens right after the document has been published, and it should not take more than a few seconds","document-view.form-view.sync-lock-toast.title":"Syncing document…","document.favorites.add-to-favorites":"Add to favorites","document.favorites.remove-from-favorites":"Remove from favorites","events.compare-with-published.description":"We're unable to load the changes for this document, probably due to history retention policy of your plan, this shows you how the <strong>{{version}}</strong> version compares to the <strong>published</strong> version.","events.compare-with-published.title":"Comparing with published","events.inspect.release":"Inspect <VersionBadge>{{releaseTitle}}</VersionBadge> document","events.open.draft":"Open <VersionBadge>draft</VersionBadge> document","events.open.release":"Open <VersionBadge>{{releaseTitle}}</VersionBadge> release","insufficient-permissions-message-tooltip.loading-text":"Loading…","menu-item-groups.actions-group":"Actions","menu-item-groups.layout-group":"Layout","menu-item-groups.sorting-group":"Sort","menu-items.layout.compact-view":"Compact view","menu-items.layout.detailed-view":"Detailed view","menu-items.sort-by.created":"Sort by Created","menu-items.sort-by.last-edited":"Sort by Last Edited","no-document-types-screen.link-text":"Learn how to add a document type →","no-document-types-screen.subtitle":"Please define at least one document type in your schema.","no-document-types-screen.title":"No document types","pane-header.back-button.text":"Back","pane-header.context-menu-button.tooltip":"Show menu","pane-header.create-menu.label":"Create","pane-header.create-new-button.tooltip":"Create new document","pane-header.disabled-created-button.aria-label":"Insufficient permissions","pane-item.draft-status.has-draft.tooltip":"Edited <RelativeTime/>","pane-item.draft-status.no-draft.tooltip":"No unpublished edits","pane-item.missing-schema-type.subtitle":"Document: <Code>{{documentId}}</Code>","pane-item.missing-schema-type.title":"No schema found for type <Code>{{documentType}}</Code>","pane-item.published-status.has-published.tooltip":"Published <RelativeTime/>","pane-item.published-status.no-published.tooltip":"No unpublished edits","panes.document-header-title.error.text":"Error: {{error}}","panes.document-header-title.new.text":"New {{schemaType}}","panes.document-header-title.untitled.text":"Untitled","panes.document-list-pane.error.max-retries-attempted":"Not automatically retrying after {{count}} unsuccessful attempts.","panes.document-list-pane.error.retrying":"Retrying…","panes.document-list-pane.error.text":"Encountered an error while fetching documents.","panes.document-list-pane.error.text.dev":"Error: <Code>{{error}}</Code>","panes.document-list-pane.error.text.offline":"The Internet connection appears to be offline.","panes.document-list-pane.error.title":"Could not fetch list items","panes.document-list-pane.error.will-retry-automatically_one":"Retrying…","panes.document-list-pane.error.will-retry-automatically_other":"Retrying… (#{{count}}).","panes.document-list-pane.max-items.text":"Displaying a maximum of {{limit}} documents","panes.document-list-pane.no-documents-of-type.text":"No documents of this type","panes.document-list-pane.no-documents.text":"No results found","panes.document-list-pane.no-matching-documents.text":"No matching documents","panes.document-list-pane.reconnecting":"Trying to connect…","panes.document-list-pane.search-input.aria-label":"Search list","panes.document-list-pane.search-input.placeholder":"Search list","panes.document-operation-results.error.summary.title":"Details","panes.document-operation-results.operation-error":"An error occurred during {{context}}","panes.document-operation-results.operation-error_delete":"An error occurred while attempting to delete this document. This usually means that there are other documents that refers to it.","panes.document-operation-results.operation-error_unpublish":"An error occurred while attempting to unpublish this document. This usually means that there are other documents that refers to it.","panes.document-operation-results.operation-success":"Successfully performed {{op}} on document","panes.document-operation-results.operation-success_copy-url":"Document URL copied to clipboard","panes.document-operation-results.operation-success_createVersion":"<Strong>{{title}}</Strong> was added to the release","panes.document-operation-results.operation-success_delete":"The document was successfully deleted","panes.document-operation-results.operation-success_discardChanges":"All changes since last publish has now been discarded. The discarded draft can still be recovered from history","panes.document-operation-results.operation-success_duplicate":"The document was successfully duplicated","panes.document-operation-results.operation-success_publish":"<Strong>{{title}}</Strong> was published","panes.document-operation-results.operation-success_restore":"<Strong>{{title}}</Strong> was restored","panes.document-operation-results.operation-success_unpublish":"<Strong>{{title}}</Strong> was unpublished. A draft has been created from the latest published revision.","panes.document-operation-results.operation-undefined-title":"Untitled","panes.document-pane.document-not-found.loading":"Loading document…","panes.document-pane.document-not-found.text":"The document type is not defined, and a document with the <Code>{{id}}</Code> identifier could not be found.","panes.document-pane.document-not-found.title":"The document was not found","panes.document-pane.document-unknown-type.text":"This document has the schema type <Code>{{documentType}}</Code>, which is not defined as a type in the local content studio schema.","panes.document-pane.document-unknown-type.title":"Unknown document type: <Code>{{documentType}}</Code>","panes.document-pane.document-unknown-type.without-schema.text":"This document does not exist, and no schema type was specified for it.","panes.resolving.default-message":"Loading…","panes.resolving.slow-resolve-message":"Still loading…","panes.unknown-pane-type.missing-type.text":"Structure item is missing required <Code>type</Code> property.","panes.unknown-pane-type.title":"Unknown pane type","panes.unknown-pane-type.unknown-type.text":"Structure item of type <Code>{{type}}</Code> is not a known entity.","production-preview.menu-item.title":"Open preview","request-permission-dialog.confirm-button.text":"Send request","request-permission-dialog.description.text":"Your request will be sent to the project administrator(s). If you'd like, you can also include a note","request-permission-dialog.header.text":"Ask for edit access","request-permission-dialog.note-input.description.text":"If you'd like, you can add a note","request-permission-dialog.note-input.placeholder.text":"Add note...","request-permission-dialog.warning.denied.text":"Your request to access this project has been declined.","request-permission-dialog.warning.limit-reached.text":"You've reached the limit for role requests across all projects. Please wait before submitting more requests or contact an administrator for assistance.","status-bar.document-status-pulse.status.saved.text":"Saved","status-bar.document-status-pulse.status.syncing.text":"Saving...","status-bar.publish-status-button.last-published-time.aria-label":"Last published {{relativeTime}}","status-bar.publish-status-button.last-published-time.tooltip":"Last published <RelativeTime/>","status-bar.publish-status-button.last-updated-time.aria-label":"Last updated {{relativeTime}}","status-bar.publish-status-button.last-updated-time.tooltip":"Last updated <RelativeTime/>","status-bar.review-changes-button.aria-label":"Review changes","status-bar.review-changes-button.status.saved.text":"Saved!","status-bar.review-changes-button.status.syncing.text":"Saving...","status-bar.review-changes-button.tooltip.changes-saved":"Changes saved","status-bar.review-changes-button.tooltip.text":"Review changes","structure-error.docs-link.text":"View documentation","structure-error.error.label":"Error","structure-error.header.text":"Encountered an error while reading structure","structure-error.reload-button.text":"Reload","structure-error.structure-path.label":"Structure path","timeline-item.menu-button.aria-label":"Open action menu","timeline-item.menu-button.tooltip":"Actions","timeline-item.menu.action-collapse":"Collapse","timeline-item.menu.action-expand":"Expand","timeline-item.not-found-release.tooltip":'Release with id "{{releaseId}}" not found',"toggle-inline-changes.menu-item.title":"Inline changes"});export{n as default};
</file>

<file path="betternotes/dist/static/SanityVision-CzEtxX32.js">
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/refractor-Bm_vMXvg.js","static/sanity-z2y04qld.js"])))=>i.map(i=>d[i]);
import{ap as Ps,aq as C1,ar as D1,as as $1,at as Q1,r as C,j as y,e as G,au as Yp,av as Re,aw as qp,ax as Yu,ay as ul,az as Rr,aA as P1,aB as Vp,aC as A1,aD as Gp,aE as Up,aF as Hp,aG as Kp,aH as Jp,aI as eg,aJ as tg,aK as E1,aL as T1,aM as R1,aN as _1,aO as M1,aP as B1,aQ as ig,aR as F1,aS as Z1,aT as z1,d as Pt,aU as qu,ab as ng,a1 as rg,aV as j1,aW as I1,z as tr,aX as ir,a6 as sg,aY as L1,aZ as Uh,a_ as Hh,a$ as X1,b0 as N1,O as Kh,b1 as W1,b2 as Y1,b3 as q1,b4 as V1,ak as Ms,b5 as G1,b6 as U1,b7 as Jh,b8 as H1,b9 as K1,ba as J1,aj as eb,a2 as tb,bb as ib,bc as nb,bd as rb,be as sb,bf as og,bg as ag,bh as ob}from"./sanity-z2y04qld.js";var _l={exports:{}},rt={};var ed;function ab(){if(ed)return rt;ed=1;var i=typeof Symbol=="function"&&Symbol.for,t=i?Symbol.for("react.element"):60103,e=i?Symbol.for("react.portal"):60106,n=i?Symbol.for("react.fragment"):60107,r=i?Symbol.for("react.strict_mode"):60108,s=i?Symbol.for("react.profiler"):60114,o=i?Symbol.for("react.provider"):60109,a=i?Symbol.for("react.context"):60110,l=i?Symbol.for("react.async_mode"):60111,u=i?Symbol.for("react.concurrent_mode"):60111,c=i?Symbol.for("react.forward_ref"):60112,h=i?Symbol.for("react.suspense"):60113,d=i?Symbol.for("react.suspense_list"):60120,f=i?Symbol.for("react.memo"):60115,p=i?Symbol.for("react.lazy"):60116,g=i?Symbol.for("react.block"):60121,m=i?Symbol.for("react.fundamental"):60117,O=i?Symbol.for("react.responder"):60118,b=i?Symbol.for("react.scope"):60119;function x(w){if(typeof w=="object"&&w!==null){var v=w.$$typeof;switch(v){case t:switch(w=w.type,w){case l:case u:case n:case s:case r:case h:return w;default:switch(w=w&&w.$$typeof,w){case a:case c:case p:case f:case o:return w;default:return v}}case e:return v}}}function S(w){return x(w)===u}return rt.AsyncMode=l,rt.ConcurrentMode=u,rt.ContextConsumer=a,rt.ContextProvider=o,rt.Element=t,rt.ForwardRef=c,rt.Fragment=n,rt.Lazy=p,rt.Memo=f,rt.Portal=e,rt.Profiler=s,rt.StrictMode=r,rt.Suspense=h,rt.isAsyncMode=function(w){return S(w)||x(w)===l},rt.isConcurrentMode=S,rt.isContextConsumer=function(w){return x(w)===a},rt.isContextProvider=function(w){return x(w)===o},rt.isElement=function(w){return typeof w=="object"&&w!==null&&w.$$typeof===t},rt.isForwardRef=function(w){return x(w)===c},rt.isFragment=function(w){return x(w)===n},rt.isLazy=function(w){return x(w)===p},rt.isMemo=function(w){return x(w)===f},rt.isPortal=function(w){return x(w)===e},rt.isProfiler=function(w){return x(w)===s},rt.isStrictMode=function(w){return x(w)===r},rt.isSuspense=function(w){return x(w)===h},rt.isValidElementType=function(w){return typeof w=="string"||typeof w=="function"||w===n||w===u||w===s||w===r||w===h||w===d||typeof w=="object"&&w!==null&&(w.$$typeof===p||w.$$typeof===f||w.$$typeof===o||w.$$typeof===a||w.$$typeof===c||w.$$typeof===m||w.$$typeof===O||w.$$typeof===b||w.$$typeof===g)},rt.typeOf=x,rt}var td;function lb(){return td||(td=1,_l.exports=ab()),_l.exports}const ot={avatar:{sizes:[{distance:-4,size:19},{distance:-4,size:25},{distance:-8,size:33},{distance:-12,size:49}],focusRing:{offset:1,width:1}},button:{textWeight:"medium",border:{width:1},focusRing:{offset:-1,width:1}},card:{border:{width:1},focusRing:{offset:-1,width:1},shadow:{outline:.5}},container:[320,640,960,1280,1600,1920],media:[360,600,900,1200,1800,2400],layer:{dialog:{zOffset:600},popover:{zOffset:400},tooltip:{zOffset:200}},radius:[0,1,3,6,9,12,21],shadow:[null,{umbra:[0,0,0,0],penumbra:[0,0,0,0],ambient:[0,0,0,0]},{umbra:[0,3,5,-2],penumbra:[0,6,10,0],ambient:[0,1,18,1]},{umbra:[0,7,8,-4],penumbra:[0,12,17,2],ambient:[0,5,22,4]},{umbra:[0,9,11,-5],penumbra:[0,18,28,2],ambient:[0,7,34,6]},{umbra:[0,11,15,-7],penumbra:[0,24,38,3],ambient:[0,9,46,8]}],space:[0,4,8,12,20,32,52,84,136,220],input:{border:{width:1},checkbox:{size:17,focusRing:{offset:-1,width:1}},radio:{size:17,markSize:9,focusRing:{offset:-1,width:1}},switch:{width:25,height:17,padding:5,transitionDurationMs:150,transitionTimingFunction:"ease-out",focusRing:{offset:1,width:1}},select:{focusRing:{offset:-1,width:1}},text:{focusRing:{offset:-1,width:1}}},style:{button:{root:{transition:"background-color 100ms,border-color 100ms,color 100ms"}}}},cb={code:{family:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace",weights:{regular:400,medium:500,semibold:600,bold:700},sizes:[{ascenderHeight:4,descenderHeight:4,fontSize:10,iconSize:17,lineHeight:15,letterSpacing:0},{ascenderHeight:5,descenderHeight:5,fontSize:13,iconSize:21,lineHeight:19,letterSpacing:0},{ascenderHeight:6,descenderHeight:6,fontSize:16,iconSize:25,lineHeight:23,letterSpacing:0},{ascenderHeight:7,descenderHeight:7,fontSize:19,iconSize:29,lineHeight:27,letterSpacing:0},{ascenderHeight:8,descenderHeight:8,fontSize:22,iconSize:33,lineHeight:31,letterSpacing:0}]},heading:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Liberation Sans", Helvetica, Arial, system-ui, sans-serif',weights:{regular:700,medium:800,semibold:900,bold:900},sizes:[{ascenderHeight:5,descenderHeight:5,fontSize:13,iconSize:17,lineHeight:19,letterSpacing:0},{ascenderHeight:6,descenderHeight:6,fontSize:16,iconSize:25,lineHeight:23,letterSpacing:0},{ascenderHeight:7,descenderHeight:7,fontSize:21,iconSize:33,lineHeight:29,letterSpacing:0},{ascenderHeight:8,descenderHeight:8,fontSize:27,iconSize:41,lineHeight:35,letterSpacing:0},{ascenderHeight:9.5,descenderHeight:8.5,fontSize:33,iconSize:49,lineHeight:41,letterSpacing:0},{ascenderHeight:10.5,descenderHeight:9.5,fontSize:38,iconSize:53,lineHeight:47,letterSpacing:0}]},label:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Liberation Sans", system-ui, sans-serif',weights:{regular:600,medium:700,semibold:800,bold:900},sizes:[{ascenderHeight:2,descenderHeight:2,fontSize:8.1,iconSize:13,lineHeight:10,letterSpacing:.5},{ascenderHeight:2,descenderHeight:2,fontSize:9.5,iconSize:15,lineHeight:11,letterSpacing:.5},{ascenderHeight:2,descenderHeight:2,fontSize:10.8,iconSize:17,lineHeight:12,letterSpacing:.5},{ascenderHeight:2,descenderHeight:2,fontSize:12.25,iconSize:19,lineHeight:13,letterSpacing:.5},{ascenderHeight:2,descenderHeight:2,fontSize:13.6,iconSize:21,lineHeight:14,letterSpacing:.5},{ascenderHeight:2,descenderHeight:2,fontSize:15,iconSize:23,lineHeight:15,letterSpacing:.5}]},text:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Liberation Sans", Helvetica, Arial, system-ui, sans-serif',weights:{regular:400,medium:500,semibold:600,bold:700},sizes:[{ascenderHeight:4,descenderHeight:4,fontSize:10,iconSize:17,lineHeight:15,letterSpacing:0},{ascenderHeight:5,descenderHeight:5,fontSize:13,iconSize:21,lineHeight:19,letterSpacing:0},{ascenderHeight:6,descenderHeight:6,fontSize:15,iconSize:25,lineHeight:23,letterSpacing:0},{ascenderHeight:7,descenderHeight:7,fontSize:18,iconSize:29,lineHeight:27,letterSpacing:0},{ascenderHeight:8,descenderHeight:8,fontSize:21,iconSize:33,lineHeight:31,letterSpacing:0}]}},id=new WeakMap;function ui(i){const t=id.get(i);if(t)return t;const e=We(i,i.card.enabled),n={_blend:i._blend||(i.dark?"screen":"multiply"),_dark:i.dark,accent:e.accent,avatar:e.avatar,backdrop:i.base.shadow.ambient,badge:e.badge,bg:i.base.bg,border:i.base.border,button:{default:Xo(i,i.button.default),ghost:Xo(i,i.button.ghost),bleed:Xo(i,i.button.bleed)},code:e.code,fg:i.base.fg,focusRing:i.base.focusRing,icon:e.muted.fg,input:{default:nd(i.input.default),invalid:nd(i.input.invalid)},kbd:e.kbd,link:e.link,muted:{...e.muted,bg:i.selectable?.default.enabled.bg2||i.base.bg},selectable:Xo(i,i.selectable||i.muted),shadow:i.base.shadow,skeleton:{from:i.skeleton?.from||i.base.border,to:i.skeleton?.to||i.base.border},syntax:i.syntax};return id.set(i,n),n}function Xo(i,t){return{default:{enabled:We(i,t.default.enabled),hovered:We(i,t.default.hovered),pressed:We(i,t.default.pressed),selected:We(i,t.default.selected),disabled:We(i,t.default.disabled)},neutral:{enabled:We(i,t.default.enabled),hovered:We(i,t.default.hovered),pressed:We(i,t.default.pressed),selected:We(i,t.default.selected),disabled:We(i,t.default.disabled)},primary:{enabled:We(i,t.primary.enabled),hovered:We(i,t.primary.hovered),pressed:We(i,t.primary.pressed),selected:We(i,t.primary.selected),disabled:We(i,t.primary.disabled)},suggest:{enabled:We(i,t.primary.enabled),hovered:We(i,t.primary.hovered),pressed:We(i,t.primary.pressed),selected:We(i,t.primary.selected),disabled:We(i,t.primary.disabled)},positive:{enabled:We(i,t.positive.enabled),hovered:We(i,t.positive.hovered),pressed:We(i,t.positive.pressed),selected:We(i,t.positive.selected),disabled:We(i,t.positive.disabled)},caution:{enabled:We(i,t.caution.enabled),hovered:We(i,t.caution.hovered),pressed:We(i,t.caution.pressed),selected:We(i,t.caution.selected),disabled:We(i,t.caution.disabled)},critical:{enabled:We(i,t.critical.enabled),hovered:We(i,t.critical.hovered),pressed:We(i,t.critical.pressed),selected:We(i,t.critical.selected),disabled:We(i,t.critical.disabled)}}}function We(i,t){return{...t,avatar:{gray:{bg:i.spot.gray,fg:i.base.bg},blue:{bg:i.spot.blue,fg:i.base.bg},purple:{bg:i.spot.purple,fg:i.base.bg},magenta:{bg:i.spot.magenta,fg:i.base.bg},red:{bg:i.spot.red,fg:i.base.bg},orange:{bg:i.spot.orange,fg:i.base.bg},yellow:{bg:i.spot.yellow,fg:i.base.bg},green:{bg:i.spot.green,fg:i.base.bg},cyan:{bg:i.spot.cyan,fg:i.base.bg}},badge:{default:{bg:i.muted.default.enabled.bg,fg:i.muted.default.enabled.fg,dot:i.muted.default.enabled.muted.fg,icon:i.muted.default.enabled.muted.fg},neutral:{bg:i.muted.transparent.enabled.bg,fg:i.muted.transparent.enabled.fg,dot:i.muted.transparent.enabled.muted.fg,icon:i.muted.transparent.enabled.muted.fg},primary:{bg:i.muted.primary.enabled.bg,fg:i.muted.primary.enabled.fg,dot:i.muted.primary.enabled.muted.fg,icon:i.muted.primary.enabled.muted.fg},suggest:{bg:i.muted.primary.enabled.bg,fg:i.muted.primary.enabled.fg,dot:i.muted.primary.enabled.muted.fg,icon:i.muted.primary.enabled.muted.fg},positive:{bg:i.muted.positive.enabled.bg,fg:i.muted.positive.enabled.fg,dot:i.muted.positive.enabled.muted.fg,icon:i.muted.positive.enabled.muted.fg},caution:{bg:i.muted.caution.enabled.bg,fg:i.muted.caution.enabled.fg,dot:i.muted.caution.enabled.muted.fg,icon:i.muted.caution.enabled.muted.fg},critical:{bg:i.muted.critical.enabled.bg,fg:i.muted.critical.enabled.fg,dot:i.muted.critical.enabled.muted.fg,icon:i.muted.critical.enabled.muted.fg}},kbd:{bg:i.muted.default.enabled.bg,fg:i.muted.default.enabled.fg,border:i.muted.default.enabled.border},muted:{...i.muted.default.enabled.muted,bg:t.bg2||t.bg},skeleton:{from:t.skeleton?.from||t.border,to:t.skeleton?.to||t.border}}}function nd(i){return{enabled:No(i.enabled),disabled:No(i.disabled),readOnly:No(i.readOnly),hovered:No(i.hovered)}}function No(i){return{bg:i.bg,border:i.border,fg:i.fg,muted:{bg:i.bg2},placeholder:i.placeholder}}const rd=new WeakMap;function fe(i){if(i.sanity.v2?._resolved)return i.sanity.v2;const t=rd.get(i);if(t)return t;const e={_version:2,_resolved:!0,avatar:{...ot.avatar,...i.sanity.avatar},button:{...ot.button,...i.sanity.button},card:ot.card,color:ui(i.sanity.color),container:i.sanity.container,font:i.sanity.fonts,input:{...ot.input,...i.sanity.input,checkbox:{...ot.input.checkbox,...i.sanity.input.checkbox},radio:{...ot.input.radio,...i.sanity.input.radio},switch:{...ot.input.switch,...i.sanity.input.switch}},layer:i.sanity.layer??ot.layer,media:i.sanity.media,radius:i.sanity.radius,shadow:i.sanity.shadows,space:i.sanity.space,style:i.sanity.styles};return rd.set(i,e),e}function sd(i){return i._version===2}const od=new WeakMap;function ub(i){if(i.v2)return i.v2;const t=od.get(i);if(t)return t;const{avatar:e,button:n,color:r,container:s,fonts:o,input:a,layer:l,media:u,radius:c,shadows:h,space:d,styles:f}=i,p={_version:2,avatar:{...ot.avatar,...e},button:{...ot.button,...n},card:ot.card,color:{light:{transparent:ui(r.light.transparent),default:ui(r.light.default),neutral:ui(r.light.transparent),primary:ui(r.light.primary),suggest:ui(r.light.primary),positive:ui(r.light.positive),caution:ui(r.light.caution),critical:ui(r.light.critical)},dark:{transparent:ui(r.dark.transparent),default:ui(r.dark.default),neutral:ui(r.dark.transparent),primary:ui(r.dark.primary),suggest:ui(r.dark.primary),positive:ui(r.dark.positive),caution:ui(r.dark.caution),critical:ui(r.dark.critical)}},container:s,font:o,input:{...ot.input,...a,checkbox:{...ot.input.checkbox,...a.checkbox},radio:{...ot.input.radio,...a.radio},switch:{...ot.input.switch,...a.switch}},layer:l??ot.layer,media:u,radius:c,shadow:h,space:d,style:f};return od.set(i,p),p}const hb=new WeakMap;function lg(i){const t=hb.get(i);if(t)return t;const{avatar:e,button:n,color:r,container:s,font:o,input:a,media:l,radius:u,shadow:c,space:h,style:d}=i;return{_version:0,avatar:e,button:n,container:s,color:{light:{transparent:nn(r.light.transparent),default:nn(r.light.default),primary:nn(r.light.primary),positive:nn(r.light.positive),caution:nn(r.light.caution),critical:nn(r.light.critical)},dark:{transparent:nn(r.dark.transparent),default:nn(r.dark.default),primary:nn(r.dark.primary),positive:nn(r.dark.positive),caution:nn(r.dark.caution),critical:nn(r.dark.critical)}},focusRing:a.text.focusRing,fonts:o,input:a,media:l,radius:u,shadows:c,space:h,styles:d,v2:i}}function nn(i){return{base:{bg:i.bg,fg:i.fg,border:i.border,focusRing:i.focusRing,shadow:i.shadow},button:i.button,card:i.selectable.default,dark:i._dark,input:{default:ad(i.input.default),invalid:ad(i.input.invalid)},muted:{...i.button.ghost,transparent:i.button.ghost.default},solid:{...i.button.default,transparent:i.button.default.default},selectable:i.selectable,spot:{gray:i.avatar.gray.bg,blue:i.avatar.blue.bg,purple:i.avatar.purple.bg,magenta:i.avatar.magenta.bg,red:i.avatar.red.bg,orange:i.avatar.orange.bg,yellow:i.avatar.yellow.bg,green:i.avatar.green.bg,cyan:i.avatar.cyan.bg},syntax:i.syntax}}function ad(i){return{enabled:Wo(i.enabled),disabled:Wo(i.disabled),readOnly:Wo(i.readOnly),hovered:Wo(i.hovered)}}function Wo(i){return{bg:i.bg,bg2:i.muted.bg,border:i.border,fg:i.fg,placeholder:i.placeholder}}const db=["multiply","screen"],Vu=["transparent","default","neutral","primary","suggest","positive","caution","critical"],dn=["default","neutral","primary","suggest","positive","caution","critical"],ko=["enabled","hovered","pressed","selected","disabled"],cg=["default","ghost","bleed"],ug=["default","invalid"],hg=["enabled","hovered","readOnly","disabled"],fb=Ps;function pb(i){return db.includes(i)}function gb(i){return Ps.includes(i)}function ld(i){return C1.includes(i)}[...fb];[...Vu];[...dn];[...ko];[...ug];[...hg];function Ml(i){return/^\d+%$/.test(i)}function dg(i){const t=i.split("/");let e=t.shift()||"";const[n,r]=e.split(" ");if(ld(n)){const s=n,o=t.shift()||"";if(Ml(r)){const a=Number(r.slice(0,-1))/100;return{type:"color",tint:s,mix:a}}if(Bl(o)){const a=Number(o);return{type:"color",tint:s,opacity:a}}return{type:"color",tint:s}}if(mb(n)){const s=n,o=t.shift()||"";if(Ml(r)){const a=Number(r.slice(0,-1))/100;return{type:"color",key:s,mix:a}}if(Bl(o)){const a=Number(o);return{type:"color",key:s,opacity:a}}return{type:"color",key:s}}if(gb(n)){const s=n;e=t.shift()||"";const[o,a]=e.split(" ");if(ld(o)){const l=o,u=t.shift()||"";if(Ml(a)){const c=Number(a.slice(0,-1))/100;return{type:"color",hue:s,tint:l,mix:c}}if(Bl(u)){const c=Number(u);return{type:"color",hue:s,tint:l,opacity:c}}return{type:"color",hue:s,tint:l}}return{type:"hue",value:s}}if(pb(n))return{type:"blendMode",value:n}}function mb(i){return i==="black"||i==="white"}function Bl(i){return i==="0"||/^0\.[0-9]+$/.test(i)||i==="1"}function Ob(i){let t="";return i.key==="black"||i.key==="white"?t=i.key:t=`${i.hue}/${i.tint}`,i.mix!==void 0?`${t} ${i.mix*100}%`:(i.opacity!==void 0&&(t+=`/${i.opacity}`),t)}const bb=["500","500"];function te(i,t=bb){const{hue:e,scheme:n}=i,r=dg(t[n==="light"?0:1]);if(!r||r.type!=="color")throw new Error(`Invalid color token: ${t[0]}`);return Ob({...r,hue:r.hue||e})}const yb={base:{"*":{_blend:["multiply","screen"],accent:{fg:["purple/600","purple/400"]},avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},backdrop:["gray/200/0.5","black/0.5"],badge:{"*":{bg:["100","900"],fg:["600","400"],icon:["500","500"],dot:["500","500"]},positive:{bg:["200 50%","900"],fg:["600","500"]},caution:{bg:["200 50%","900"],fg:["600","500"]}},bg:["50","950"],border:["200","800"],code:{bg:["50","950"],fg:["600","400"]},fg:["800","200"],focusRing:["blue/500","blue/500"],icon:["600","400"],kbd:{bg:["white","black"],fg:["600","400"],border:["200","800"]},link:{fg:["blue/600","blue/300"]},muted:{bg:["50","950"],fg:["700 75%","300 75%"]},shadow:{outline:["500/0.3","500/0.4"],umbra:["gray/500/0.1","black/0.2"],penumbra:["gray/500/0.07","black/0.14"],ambient:["gray/500/0.06","black/0.12"]},skeleton:{from:["100","900"],to:["100 50%","900 50%"]}},transparent:{bg:["50","black"]},default:{bg:["white","950"],fg:["800","200"],muted:{fg:["600","400"]}},primary:{_hue:"blue"},suggest:{_hue:"purple"},positive:{_hue:"green",shadow:{outline:["500/0.4","500/0.4"]}},caution:{_hue:"yellow",shadow:{outline:["600/0.3","500/0.4"]}},critical:{_hue:"red"}},button:{default:{"*":{"*":{_blend:["screen","multiply"],accent:{fg:["purple/300","purple/700"]},avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},badge:{"*":{bg:["900","100"],fg:["400","600"],dot:["500","500"],icon:["500","500"]}},bg:["500","400"],border:["500/0","400/0"],code:{bg:["500 20%","400 20%"],fg:["200","600"]},fg:["white","black"],icon:["100 70%","900 70%"],kbd:{bg:["black","white"],fg:["200","600"],border:["800","200"]},link:{fg:["blue/200","blue/600"]},muted:{bg:["950","50"],fg:["100 70%","900 70%"]},skeleton:{from:["900","100"],to:["900 50%","100 50%"]}},hovered:{bg:["600","300"],border:["700/0","300/0"]},pressed:{bg:["700","300"]},selected:{bg:["700","300"]},disabled:{_hue:"gray",accent:{fg:["100 70%","900 70%"]},avatar:{"*":{_blend:["screen","multiply"],bg:["gray/500","gray/400"],fg:["white","black"]}},badge:{"*":{bg:["gray/700","gray/300"],fg:["white","black"],dot:["white","black"],icon:["white","black"]}},bg:["300","600"],code:{bg:["950","50"],fg:["300","600"]},fg:["300","600"],muted:{bg:["950","50"],fg:["300","600"]},kbd:{bg:["black","white"],fg:["white","black"],border:["700","300"]},link:{fg:["100 70%","900 70%"]}}},default:{"*":{avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},bg:["800","200"],muted:{bg:["950","50"],fg:["400","600"]}},hovered:{bg:["900","100"]},pressed:{bg:["black","white"]},selected:{bg:["black","white"]}}},ghost:{"*":{"*":{_blend:["multiply","screen"],accent:{fg:["purple/700 60%","purple/300 70%"]},avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},badge:{"*":{bg:["100","900"],fg:["600","400"],dot:["500","500"],icon:["500","500"]}},bg:["50","950"],border:["100","900"],code:{bg:["500 10%","400 10%"],fg:["700 60%","400 60%"]},fg:["600","400"],icon:["700 60%","300 60%"],kbd:{bg:["white","black"],fg:["600","400"],border:["200","800"]},link:{fg:["blue/700 60%","blue/300 60%"]},muted:{bg:["100","950"],fg:["700 60%","300 60%"]},skeleton:{from:["100","900"],to:["100 50%","900 50%"]}},hovered:{bg:["100","900"],fg:["700","300"]},pressed:{bg:["200","800"],fg:["800","200"]},selected:{bg:["200","800"],fg:["800","200"]},disabled:{_hue:"gray",accent:{fg:["200","800"]},avatar:{"*":{_blend:["screen","multiply"],bg:["gray/100","gray/900"],fg:["white","black"]}},badge:{"*":{_hue:"gray",bg:["50","950"],fg:["gray/200","gray/800"],dot:["gray/200","gray/800"],icon:["gray/200","gray/800"]}},border:["100","900"],code:{bg:["50","950"],fg:["200","800"]},fg:["400","600"],icon:["300","700"],muted:{fg:["300","700"]},kbd:{bg:["white","black"],fg:["200","800"],border:["100","900"]},link:{fg:["200","800"]}}},positive:{"*":{border:["600 20%","800"]}},caution:{"*":{border:["600 20%","800"]}}},bleed:{"*":{"*":{_blend:["multiply","screen"],accent:{fg:["purple/700 70%","purple/300 70%"]},avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},badge:{"*":{bg:["100","900"],fg:["600","400"],dot:["500","500"],icon:["500","500"]}},bg:["white","black"],border:["white/0","black/0"],code:{bg:["50","950"],fg:["700 75%","300 75%"]},fg:["700","300"],icon:["700 75%","300 75%"],kbd:{bg:["white","black"],fg:["700","300"],border:["200","800"]},link:{fg:["blue/700 70%","blue/300 70%"]},muted:{bg:["100","950"],fg:["700 75%","300 75%"]},skeleton:{from:["100","900"],to:["100 50%","900 50%"]}},hovered:{bg:["50","900"],fg:["800","200"],icon:["800 70%","300 70%"]},pressed:{bg:["100","800"],fg:["800","200"],icon:["800 70%","200 70%"]},selected:{bg:["100","900"],fg:["800","200"],icon:["800 60%","200 60%"]},disabled:{_hue:"gray",accent:{fg:["200","800"]},avatar:{"*":{_blend:["screen","multiply"],bg:["gray/100","gray/900"],fg:["white","black"]}},badge:{"*":{_hue:"gray",bg:["50","950"],fg:["gray/200","gray/800"],dot:["gray/200","gray/800"],icon:["gray/200","gray/800"]}},code:{bg:["50","950"],fg:["200","800"]},fg:["400","600"],icon:["300","700"],muted:{fg:["400","600"]},kbd:{bg:["white","black"],fg:["200","800"],border:["100","900"]},link:{fg:["200","800"]}}}}},input:{"*":{"*":{_blend:["multiply","screen"],bg:["white","black"],border:["200","700"],fg:["black","200"],muted:{bg:["50","950"]},placeholder:["400","600"]},hovered:{border:["300","700"]},readOnly:{bg:["50","950"],border:["200","800"],fg:["800","200"]},disabled:{bg:["50","950"],fg:["400","600"],border:["100","900"],placeholder:["200","800 50%"]}},invalid:{"*":{_hue:"red",bg:["100","950"]}}},selectable:{"*":{"*":{_blend:["multiply","screen"],accent:{fg:["purple/700 70%","purple/300 70%"]},avatar:{"*":{_blend:["screen","multiply"],bg:["500","400"],fg:["white","black"]}},badge:{"*":{bg:["100","900"],fg:["600","400"],dot:["500","500"],icon:["500","500"]}},bg:["white","black"],border:["200","800"],code:{bg:["50","950"],fg:["600","400"]},fg:["700","300"],icon:["700 75%","300 75%"],kbd:{bg:["white","black"],fg:["600","400"],border:["200","800"]},link:{fg:["blue/700 70%","blue/300 70%"]},muted:{bg:["50","950"],fg:["700 75%","300 75%"]},skeleton:{from:["100","900"],to:["100 50%","900 50%"]}},hovered:{bg:["50","950"]},pressed:{bg:["100","900"]},selected:{_blend:["screen","multiply"],accent:{fg:["purple/300","purple/700"]},avatar:{"*":{_blend:["multiply","screen"],bg:["white","black"],fg:["black","white"]}},badge:{"*":{bg:["900","100"],fg:["400","600"],dot:["500","500"],icon:["500","500"]}},bg:["500","400"],border:["500 20%","400 20%"],code:{bg:["500 20%","400 20%"],fg:["200","600"]},fg:["white","black"],icon:["100 70%","900 70%"],kbd:{bg:["black","white"],fg:["200","600"],border:["800","200"]},link:{fg:["blue/200","blue/600"]},muted:{bg:["500 10%","400 10%"],fg:["100 70%","900 70%"]},skeleton:{from:["900","100"],to:["900 50%","100 50%"]}},disabled:{_hue:"gray",accent:{fg:["200","800"]},avatar:{"*":{_blend:["screen","multiply"],bg:["gray/100","gray/900"],fg:["white","black"]}},badge:{"*":{_hue:"gray",bg:["50","950"],fg:["gray/200","gray/800"],dot:["gray/200","gray/800"],icon:["gray/200","gray/800"]}},border:["100","900"],code:{bg:["50","950"],fg:["200","800"]},fg:["200","800"],icon:["200","800"],kbd:{bg:["white","black"],fg:["200","800"],border:["100","900"]},link:{fg:["200","800"]},muted:{bg:["50 50%","950 50%"],fg:["200","800"]}}},default:{selected:{_hue:"blue"}},critical:{disabled:{bg:["50 50%","950 50%"]}}},syntax:{atrule:["purple/600","purple/400"],attrName:["green/600","green/400"],attrValue:["yellow/600","yellow/400"],attribute:["yellow/600","yellow/400"],boolean:["purple/600","purple/400"],builtin:["purple/600","purple/400"],cdata:["yellow/600","yellow/400"],char:["yellow/600","yellow/400"],class:["orange/600","orange/400"],className:["cyan/600","cyan/400"],comment:["gray/400","gray/600"],constant:["purple/600","purple/400"],deleted:["red/600","red/400"],entity:["red/600","red/400"],function:["green/600","green/400"],hexcode:["blue/600","blue/400"],id:["purple/600","purple/400"],important:["purple/600","purple/400"],inserted:["yellow/600","yellow/400"],keyword:["magenta/600","magenta/400"],number:["purple/600","purple/400"],operator:["magenta/600","magenta/400"],property:["blue/600","blue/400"],pseudoClass:["yellow/600","yellow/400"],pseudoElement:["yellow/600","yellow/400"],punctuation:["gray/600","gray/400"],regex:["blue/600","blue/400"],selector:["red/600","red/400"],string:["yellow/600","yellow/400"],symbol:["purple/600","purple/400"],tag:["red/600","red/400"],unit:["orange/600","orange/400"],url:["red/600","red/400"],variable:["red/600","red/400"]}};function cd(i){return!!(i&&typeof i=="object"&&!Array.isArray(i))}function Hn(...i){const t=i.filter(Boolean);return t.length===0?{}:t.reduce(xb,{})}function xb(i,t){for(const e of Object.keys(t)){const n=i[e],r=t[e];cd(n)&&cd(r)?i[e]=Hn(n,r):i[e]=r}return i}function wb(i){const t=Hn(yb,i);return{base:Sb(t),button:kb(t),input:Qb(t),selectable:Eb(t),syntax:t.syntax}}function Sb(i){const t={};for(const e of Vu)t[e]=vb(i,e);return t}function vb(i,t){const e=Hn(i?.base?.["*"],i?.base?.[t]),n=e._hue||i?.base?.[t]?._hue||"gray";return{...e,_hue:n,avatar:Ps.reduce((r,s)=>({...r,[s]:Hn({_hue:s},e.avatar?.["*"],e.avatar?.[s])}),{}),badge:dn.reduce((r,s)=>({...r,[s]:{_hue:i?.base?.[s]?._hue||n,...e.badge?.["*"],...e.badge?.[s]}}),{})}}function kb(i){const t={};for(const e of cg)t[e]=Cb(i,e);return t}function Cb(i,t){const e={};for(const n of dn)e[n]=Db(i,t,n);return e}function Db(i,t,e){const n={};for(const r of ko)n[r]=$b(i,e,t,r);return n}function $b(i,t,e,n){const r=Hn(i?.button?.[e]?.["*"]?.["*"],i?.button?.[e]?.[t]?.["*"],i?.button?.[e]?.["*"]?.[n],i?.button?.[e]?.[t]?.[n]),s=r._hue||i?.base?.[t]?._hue;return{...r,_hue:s,avatar:Ps.reduce((o,a)=>({...o,[a]:Hn({_hue:a},r.avatar?.["*"],r.avatar?.[a])}),{}),badge:dn.reduce((o,a)=>({...o,[a]:{_hue:i?.base?.[a]?._hue||s,...r.badge?.["*"],...r.badge?.[a]}}),{})}}function Qb(i){const t={};for(const e of ug)t[e]=Pb(i,e);return t}function Pb(i,t){const e={};for(const n of hg)e[n]=Ab(i,t,n);return e}function Ab(i,t,e){const n=Hn(i?.input?.["*"]?.["*"],i?.input?.[t]?.["*"],i?.input?.["*"]?.[e],i?.input?.[t]?.[e]),r=n._hue||i?.input?.[t]?._hue;return{...n,_hue:r}}function Eb(i){const t={};for(const e of dn)t[e]=Tb(i,e);return t}function Tb(i,t){const e={_hue:i?.selectable?.[t]?._hue||i?.base?.[t]?._hue};for(const n of ko)e[n]=Rb(i,t,n);return e}function Rb(i,t,e){const n=Hn(i?.selectable?.["*"]?.["*"],i?.selectable?.[t]?.["*"],i?.selectable?.["*"]?.[e],i?.selectable?.[t]?.[e]),r=n._hue||i?.base?.[t]?._hue;return{...n,_hue:r,avatar:Ps.reduce((s,o)=>({...s,[o]:Hn({_hue:o},n.avatar?.["*"],n.avatar?.[o])}),{}),badge:dn.reduce((s,o)=>({...s,[o]:{_hue:i?.base?.[o]?._hue||r,...n.badge?.["*"],...n.badge?.[o]}}),{})}}function _b(i){const t={color:wb(i?.color)};return{light:ud({scheme:"light"},t),dark:ud({scheme:"dark"},t)}}function ud(i,t){const{scheme:e}=i,n={};for(const r of Vu)n[r]=Mb({scheme:e,tone:r},t);return n}function Mb(i,t){const{scheme:e,tone:n}=i,r=t?.color?.base?.[n],s={hue:r?._hue||"gray",scheme:e};return{_blend:(r?._blend||["multiply","screen"])[e==="light"?0:1],_dark:e==="dark",accent:{fg:te(s,r?.accent?.fg)},avatar:Gu({scheme:e},r),backdrop:te(s,r?.backdrop),badge:Uu(r?.badge,{scheme:e},t),bg:te(s,r?.bg),border:te(s,r?.border),button:Zb({scheme:e,tone:n},t),code:{bg:te(s,r?.code?.bg),fg:te(s,r?.code?.fg)},fg:te(s,r?.fg),focusRing:te(s,r?.focusRing),icon:te(s,r?.icon),input:Lb({scheme:e,tone:n},t),kbd:{bg:te(s,r?.kbd?.bg),fg:te(s,r?.kbd?.fg),border:te(s,r?.kbd?.border)},link:{fg:te(s,r?.link?.fg)},muted:{bg:te(s,r?.muted?.bg),fg:te(s,r?.muted?.fg)},selectable:Xb({scheme:e,tone:n},t),shadow:Bb({scheme:e,tone:n},t),skeleton:{from:te(s,r?.skeleton?.from),to:te(s,r?.skeleton?.to)},syntax:Yb({scheme:e},t)}}function Bb(i,t){const{scheme:e,tone:n}=i,r=t?.color?.base?.[n],s={hue:r?._hue||"gray",scheme:e};return{outline:te(s,r?.shadow?.outline),umbra:te(s,r?.shadow?.umbra),penumbra:te(s,r?.shadow?.penumbra),ambient:te(s,r?.shadow?.ambient)}}function Gu(i,t){const{scheme:e}=i;return{gray:jn({color:"gray",scheme:e},t),blue:jn({color:"blue",scheme:e},t),purple:jn({color:"purple",scheme:e},t),magenta:jn({color:"magenta",scheme:e},t),red:jn({color:"red",scheme:e},t),orange:jn({color:"orange",scheme:e},t),yellow:jn({color:"yellow",scheme:e},t),green:jn({color:"green",scheme:e},t),cyan:jn({color:"cyan",scheme:e},t)}}function jn(i,t){const{color:e,scheme:n}=i,r=t?.avatar?.[e],s={hue:r?._hue||"gray",scheme:n};return{_blend:(r?._blend||["screen","multiply"])[n==="light"?0:1],bg:te(s,r?.bg),fg:te(s,r?.fg)}}function Uu(i,t,e){const{scheme:n}=t,r={};for(const s of dn)r[s]=Fb(i,{scheme:n,tone:s},e);return r}function Fb(i,t,e){const{scheme:n,tone:r}=t,s=i?.[r],o={hue:s?._hue||e?.color?.base?.[r]?._hue||"gray",scheme:n};return{bg:te(o,s?.bg),fg:te(o,s?.fg),dot:te(o,s?.dot),icon:te(o,s?.icon)}}function Zb(i,t){const{scheme:e,tone:n}=i,r={};for(const s of cg)r[s]=zb({cardTone:n,scheme:e,mode:s},t);return r}function zb(i,t){const{cardTone:e,mode:n,scheme:r}=i,s={};for(const o of dn)s[o]=jb({cardTone:e,mode:n,scheme:r,tone:o},t);return s}function jb(i,t){const{cardTone:e,mode:n,scheme:r,tone:s}=i,o={};for(const a of ko)o[a]=Ib({cardTone:e,mode:n,tone:s,scheme:r,state:a},t);return o}function Ib(i,t){const{cardTone:e,mode:n,tone:r,scheme:s,state:o}=i,a=t?.color?.base?.[e],l=t?.color?.button?.[n]?.[r]?.[o],u=l?._hue||a?._hue||"gray",c=l?._blend||["screen","multiply"],h={hue:u,scheme:s};return{_blend:c[s==="light"?0:1],accent:{fg:te(h,l?.accent?.fg)},avatar:Gu({scheme:s},l),badge:Uu(l?.badge,{scheme:s},t),bg:te(h,l?.bg),border:te(h,l?.border),code:{bg:te(h,l?.code?.bg),fg:te(h,l?.code?.fg)},fg:te(h,l?.fg),icon:te(h,l?.icon),muted:{bg:te(h,l?.muted?.bg),fg:te(h,l?.muted?.fg)},kbd:{bg:te(h,l?.kbd?.bg),fg:te(h,l?.kbd?.fg),border:te(h,l?.kbd?.border)},link:{fg:te(h,l?.link?.fg)},skeleton:{from:te(h,l?.skeleton?.from),to:te(h,l?.skeleton?.to)}}}function Lb(i,t){const{scheme:e,tone:n}=i;return{default:hd({mode:"default",scheme:e,tone:n},t),invalid:hd({mode:"invalid",scheme:e,tone:n},t)}}function hd(i,t){const{mode:e,scheme:n,tone:r}=i;return{enabled:Yo({mode:e,scheme:n,state:"enabled",cardTone:r},t),hovered:Yo({mode:e,scheme:n,state:"hovered",cardTone:r},t),readOnly:Yo({mode:e,scheme:n,state:"readOnly",cardTone:r},t),disabled:Yo({mode:e,scheme:n,state:"disabled",cardTone:r},t)}}function Yo(i,t){const{cardTone:e,mode:n,scheme:r,state:s}=i,o=t?.color?.base?.[e],a=t?.color?.input?.[n]?.[s],l=a?._hue||o?._hue||"gray",u=a?._blend||["screen","multiply"],c={hue:l,scheme:r};return{_blend:u[r==="light"?0:1],bg:te(c,a?.bg),border:te(c,a?.border),fg:te(c,a?.fg),muted:{bg:te(c,a?.muted?.bg)},placeholder:te(c,a?.placeholder)}}function Xb(i,t){const{scheme:e,tone:n}=i,r={};for(const s of dn)r[s]=Nb({cardTone:n,scheme:e,tone:s},t);return r}function Nb(i,t){const{cardTone:e,scheme:n,tone:r}=i,s={};for(const o of ko)s[o]=Wb({cardTone:e,tone:r,scheme:n,state:o},t);return s}function Wb(i,t){const{cardTone:e,scheme:n,state:r,tone:s}=i,o=t?.color?.base?.[e],a=t?.color?.selectable?.[s]?.[r],l=a?._hue||o?._hue||"gray",u=a?._blend||["screen","multiply"],c={hue:l,scheme:n};return{_blend:u[n==="light"?0:1],accent:{fg:te(c,a?.accent?.fg)},avatar:Gu({scheme:n},a),badge:Uu(a?.badge,{scheme:n},t),bg:te(c,a?.bg),border:te(c,a?.border),code:{bg:te(c,a?.code?.bg),fg:te(c,a?.code?.fg)},fg:te(c,a?.fg),icon:te(c,a?.icon),muted:{bg:te(c,a?.muted?.bg),fg:te(c,a?.muted?.fg)},kbd:{bg:te(c,a?.kbd?.bg),fg:te(c,a?.kbd?.fg),border:te(c,a?.kbd?.border)},link:{fg:te(c,a?.link?.fg)},skeleton:{from:te(c,a?.skeleton?.from),to:te(c,a?.skeleton?.to)}}}function Yb(i,t){const{scheme:e}=i,n=t?.color?.syntax,r={hue:"gray",scheme:e};return{atrule:te(r,n?.atrule),attrName:te(r,n?.attrName),attrValue:te(r,n?.attrValue),attribute:te(r,n?.attribute),boolean:te(r,n?.boolean),builtin:te(r,n?.builtin),cdata:te(r,n?.cdata),char:te(r,n?.char),class:te(r,n?.class),className:te(r,n?.className),comment:te(r,n?.comment),constant:te(r,n?.constant),deleted:te(r,n?.deleted),doctype:te(r,n?.doctype),entity:te(r,n?.entity),function:te(r,n?.function),hexcode:te(r,n?.hexcode),id:te(r,n?.id),important:te(r,n?.important),inserted:te(r,n?.inserted),keyword:te(r,n?.keyword),number:te(r,n?.number),operator:te(r,n?.operator),prolog:te(r,n?.prolog),property:te(r,n?.property),pseudoClass:te(r,n?.pseudoClass),pseudoElement:te(r,n?.pseudoElement),punctuation:te(r,n?.punctuation),regex:te(r,n?.regex),selector:te(r,n?.selector),string:te(r,n?.string),symbol:te(r,n?.symbol),tag:te(r,n?.tag),unit:te(r,n?.unit),url:te(r,n?.url),variable:te(r,n?.variable)}}const qb=D1;function Fl(i,t,e){const n=(t-i)*e;return i+n}function Vb(i,t,e){return{r:Fl(i.r,t.r,e),g:Fl(i.g,t.g,e),b:Fl(i.b,t.b,e)}}function Zl(i,t){return i*t}function Gb(i,t){return{r:Zl(i.r/255,t.r/255)*255,g:Zl(i.g/255,t.g/255)*255,b:Zl(i.b/255,t.b/255)*255}}function zl(i,t){return i+t-i*t}function Ub(i,t){return{r:zl(i.r/255,t.r/255)*255,g:zl(i.g/255,t.g/255)*255,b:zl(i.b/255,t.b/255)*255}}function Hb(i,t,e){return i*(1-e)+t*e}function Kb(i,t,e){return Vi((e-i)/(t-i))}function Vi(i,t=0,e=1){return Math.min(e,Math.max(t,i))}function In(i,t,e,n,r){return Hb(e,n,Kb(i,t,r))}function jl(i){return Math.round(i)}function Rc(i){if(i.length===4){const t=i.slice(1,2),e=i.slice(2,3),n=i.slice(3,4);return{r:parseInt(t+t,16),g:parseInt(e+e,16),b:parseInt(n+n,16)}}return{r:parseInt(i.slice(1,3),16),g:parseInt(i.slice(3,5),16),b:parseInt(i.slice(5,7),16)}}function Jb(i){const t=i.replace(/rgba\(|\)/g,"").split(",");return{r:parseInt(t[0]),g:parseInt(t[1]),b:parseInt(t[2]),a:parseFloat(t[3])}}function fg(i){const t=jl(Vi(Math.round(i.r),0,255)),e=jl(Vi(Math.round(i.g),0,255)),n=jl(Vi(Math.round(i.b),0,255));return"a"in i?`rgba(${t},${e},${n},${i.a})`:"#"+((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1)}function ey(i){const t=i.s/100,e=i.l/100,n=(1-Math.abs(2*e-1))*t,r=n*(1-Math.abs(i.h/60%2-1)),s=e-n/2;let o=0,a=0,l=0;return 0<=i.h&&i.h<60?(o=n,a=r,l=0):60<=i.h&&i.h<120?(o=r,a=n,l=0):120<=i.h&&i.h<180?(o=0,a=n,l=r):180<=i.h&&i.h<240?(o=0,a=r,l=n):240<=i.h&&i.h<300?(o=r,a=0,l=n):300<=i.h&&i.h<360&&(o=n,a=0,l=r),{r:Math.round((o+s)*255),g:Math.round((a+s)*255),b:Math.round((l+s)*255)}}const ty="0123456789ABCDEFabcdef",iy=/hsl\(\s*(\d+)\s*,\s*((\d+(?:\.\d+)?)%)\s*,\s*((\d+(?:\.\d+)?)%)\s*\)/i;function ny(i){for(const t of i)if(ty.indexOf(t)===-1)return!1;return!0}function ry(i){return i[0]!=="#"||!(i.length===4||i.length===7)?!1:ny(i.slice(1))}function sy(i){const t=iy.exec(i);if(!t)throw new Error(`parseHsl: string is not a HSL color: "${i}"`);return{h:parseInt(t[1]),s:parseFloat(t[3]),l:parseFloat(t[5])}}function Xs(i){if(!i)return{r:0,g:0,b:0};if(typeof i!="string")throw new Error("parseColor: expected a string");if(ry(i))return Rc(i);if(i.startsWith("hsl("))return ey(sy(i));if(i.startsWith("rgba("))return Jb(i);throw new Error(`parseColor: unexpected color format: "${i}"`)}function oy(i,t){const e=Xs(i);return`rgba(${e.r},${e.g},${e.b},${t})`}const Qi=[0,255];function ay(i,t){const{blendMode:e}=t,n=Xs(i),r=Xs(t.black),s=Xs(t.white),o=t.bg?Xs(t.bg):e==="multiply"?s:r,a={r:[r.r,s.r],g:[r.g,s.g],b:[r.b,s.b]},l={r:Vi(In(...a.r,...Qi,o.r),...Qi),g:Vi(In(...a.g,...Qi,o.g),...Qi),b:Vi(In(...a.b,...Qi,o.b),...Qi)},u={r:Vi(In(...a.r,...Qi,n.r),...Qi),g:Vi(In(...a.g,...Qi,n.g),...Qi),b:Vi(In(...a.b,...Qi,n.b),...Qi)},c=e==="multiply"?Gb(l,u):Ub(l,u),h={r:Vi(In(...Qi,...a.r,c.r),...a.r),g:Vi(In(...Qi,...a.g,c.g),...a.g),b:Vi(In(...Qi,...a.b,c.b),...a.b)};return fg(h)}function ie(i,t){const{bg:e,blendMode:n,colorPalette:r}=t;if(e==="white")throw new Error("Cannot blend with white background");const s=dg(i);if(!s||s.type!=="color")throw new Error(`Invalid color token value: ${i}`);let o="";if(s.key==="black"&&(o=Bs(r.black)),s.key==="white"&&(o=Bs(r.white)),s.hue&&s.tint&&(o=Bs(r[s.hue][s.tint])),!o)throw new Error(`Invalid color token value: ${i}`);const a=o,l={blendMode:n,bg:e,black:Bs(r.black),white:Bs(r.white)};try{if(o=ay(o,l),e&&s.mix!==void 0){const u=Rc(e),c=Rc(o);o=fg(Vb(u,c,s.mix))}}catch(u){throw console.warn("could not blend",o,l),u}return o==="#aN"&&(console.warn(`invalid color token value: ${i}`),o=a),s.opacity!==void 0&&(o=oy(o,s.opacity)),o}function Bs(i){return typeof i=="string"?i:i.hex}function ly(i,t){const e=qb;return{light:dd(e,i.light),dark:dd(e,i.dark)}}function dd(i,t){const e=Object.entries(t),[,n]=e.find(([l])=>l==="transparent"),[,r]=e.find(([l])=>l==="default"),s=Il(n,{colorPalette:i}),o=Il(r,{colorPalette:i}),a=o.bg;if(a==="white")throw new Error("Cannot blend with white background");return Object.fromEntries([["transparent",s],["default",o],...e.filter(([l])=>l!=="default"&&l!=="transparent").map(([l,u])=>[l,Il(u,{bg:a,colorPalette:i})])])}function Il(i,t){const{colorPalette:e,bg:n}=t,r=i._blend||"multiply",s=ie(i.bg,{colorPalette:e,bg:n,blendMode:r}),o={colorPalette:e,bg:s,blendMode:r},a=dy(i.button,{baseBg:s,blendMode:r,colorPalette:e}),l=gy(i.selectable,{colorPalette:e,baseBg:s,blendMode:r}),u={outline:ie(i.shadow.outline,o),umbra:ie(i.shadow.umbra,{...o,bg:void 0,colorPalette:{...e,black:"#000000"}}),penumbra:ie(i.shadow.penumbra,{...o,bg:void 0,colorPalette:{...e,black:"#000000"}}),ambient:ie(i.shadow.ambient,{...o,bg:void 0,colorPalette:{...e,black:"#000000"}})};return{_blend:r,_dark:i._dark,accent:{fg:ie(i.accent.fg,o)},avatar:pg(i.avatar,{baseBg:s,colorPalette:e,blendMode:r}),backdrop:ie(i.backdrop,o),badge:gg(i.badge,{baseBg:s,colorPalette:e,blendMode:r}),bg:s,border:ie(i.border,o),button:a,code:{bg:ie(i.code.bg,o),fg:ie(i.code.fg,o)},fg:ie(i.fg,o),focusRing:ie(i.focusRing,o),icon:ie(i.icon,o),input:py(i.input,{baseBg:s,colorPalette:e,blendMode:r}),kbd:cy(i.kbd,{baseBg:s,colorPalette:e,blendMode:r}),link:{fg:ie(i.link.fg,o)},muted:{bg:ie(i.muted.bg,o),fg:ie(i.muted.fg,o)},shadow:u,skeleton:{from:ie(i.skeleton.from,o),to:ie(i.skeleton.to,o)},syntax:Oy(i.syntax,{baseBg:s,colorPalette:e,blendMode:r}),selectable:l}}function cy(i,t){const{baseBg:e,blendMode:n,colorPalette:r}=t,s={bg:e,blendMode:n,colorPalette:r},o=ie(i.bg,s),a={bg:o,blendMode:n,colorPalette:r};return{bg:o,fg:ie(i.fg,a),border:ie(i.border,a)}}function pg(i,t){const e={};for(const n of Ps)e[n]=uy(i[n],t);return e}function uy(i,t){const{baseBg:e,blendMode:n,colorPalette:r}=t,s=i._blend||"multiply",o={bg:e,blendMode:n,colorPalette:r},a=ie(i.bg,o),l={bg:a,blendMode:s,colorPalette:r};return{_blend:s,bg:a,fg:ie(i.fg,l)}}function gg(i,t){const e={};for(const n of dn)e[n]=hy(i[n],t);return e}function hy(i,t){const{baseBg:e,blendMode:n,colorPalette:r}=t,s=n,o={bg:e,blendMode:n,colorPalette:r},a=ie(i.bg,o),l={bg:a,blendMode:s,colorPalette:r};return{bg:a,dot:ie(i.dot,l),fg:ie(i.fg,l),icon:ie(i.icon,l)}}function dy(i,t){return{default:Ll(i.default,t),ghost:Ll(i.ghost,t),bleed:Ll(i.bleed,t)}}function Ll(i,t){const e={};for(const n of dn)e[n]=fy(i[n],t);return e}function fy(i,t){return{enabled:An(i.enabled,t),hovered:An(i.hovered,t),pressed:An(i.pressed,t),selected:An(i.selected,t),disabled:An(i.disabled,t)}}function An(i,t){const{baseBg:e,blendMode:n,colorPalette:r}=t,s=i._blend||"multiply",o={bg:e,blendMode:n,colorPalette:r},a=ie(i.bg,o),l={bg:a,blendMode:s,colorPalette:r};return{_blend:s,accent:{fg:ie(i.accent.fg,l)},avatar:pg(i.avatar,{baseBg:a,colorPalette:r,blendMode:s}),badge:gg(i.badge,{baseBg:a,colorPalette:r,blendMode:s}),bg:a,border:ie(i.border,l),code:{bg:ie(i.code.bg,l),fg:ie(i.code.fg,l)},fg:ie(i.fg,l),icon:ie(i.icon,l),link:{fg:ie(i.link.fg,l)},muted:{bg:ie(i.muted.bg,l),fg:ie(i.muted.fg,l)},kbd:{bg:ie(i.kbd.bg,l),fg:ie(i.kbd.fg,l),border:ie(i.kbd.border,l)},skeleton:{from:ie(i.skeleton?.from,l),to:ie(i.skeleton?.to,l)}}}function py(i,t){return{default:fd(i.default,t),invalid:fd(i.invalid,t)}}function fd(i,t){return{enabled:qo(i.enabled,t),hovered:qo(i.hovered,t),readOnly:qo(i.readOnly,t),disabled:qo(i.disabled,t)}}function qo(i,t){const{baseBg:e,blendMode:n,colorPalette:r}=t,s=i._blend||"multiply",o={colorPalette:r,bg:e,blendMode:n},a=ie(i.bg,o),l={colorPalette:r,bg:a,blendMode:s};return{_blend:s,bg:a,border:ie(i.border,l),fg:ie(i.fg,l),muted:{bg:ie(i.muted.bg,l)},placeholder:ie(i.placeholder,l)}}function gy(i,t){const e={};for(const n of dn)e[n]=my(i[n],t);return e}function my(i,t){return{enabled:An(i.enabled,t),hovered:An(i.hovered,t),pressed:An(i.pressed,t),selected:An(i.selected,t),disabled:An(i.disabled,t)}}function Oy(i,t){const{colorPalette:e,baseBg:n,blendMode:r}=t,s={colorPalette:e,bg:n,blendMode:r};return{atrule:ie(i.atrule,s),attrName:ie(i.attrName,s),attrValue:ie(i.attrValue,s),attribute:ie(i.attribute,s),boolean:ie(i.boolean,s),builtin:ie(i.builtin,s),cdata:ie(i.cdata,s),char:ie(i.char,s),class:ie(i.class,s),className:ie(i.className,s),comment:ie(i.comment,s),constant:ie(i.constant,s),deleted:ie(i.deleted,s),doctype:ie(i.doctype,s),entity:ie(i.entity,s),function:ie(i.function,s),hexcode:ie(i.hexcode,s),id:ie(i.id,s),important:ie(i.important,s),inserted:ie(i.inserted,s),keyword:ie(i.keyword,s),number:ie(i.number,s),operator:ie(i.operator,s),prolog:ie(i.prolog,s),property:ie(i.property,s),pseudoClass:ie(i.pseudoClass,s),pseudoElement:ie(i.pseudoElement,s),punctuation:ie(i.punctuation,s),regex:ie(i.regex,s),selector:ie(i.selector,s),string:ie(i.string,s),symbol:ie(i.symbol,s),tag:ie(i.tag,s),unit:ie(i.unit,s),url:ie(i.url,s),variable:ie(i.variable,s)}}function by(i){const t=_b(i),e={_version:2,avatar:ot.avatar,button:ot.button,card:ot.card,color:ly(t),container:ot.container,font:cb,input:ot.input,layer:ot.layer,media:ot.media,radius:ot.radius,shadow:ot.shadow,space:ot.space,style:ot.style};return lg(e)}function yy(i){if("neutral"in i.badge)return i;const t=i;return{...t,badge:{...t.badge,neutral:t.badge.default,suggest:t.badge.primary},button:{bleed:{...t.button.bleed,neutral:t.button.bleed.default,suggest:t.button.bleed.primary},default:{...t.button.default,neutral:t.button.default.default,suggest:t.button.default.primary},ghost:{...t.button.ghost,neutral:t.button.ghost.default,suggest:t.button.ghost.primary}},selectable:{...t.selectable,neutral:t.selectable.default,suggest:t.selectable.primary}}}const ya=new Map;function xy(i,t,e){const n=wy(i,t,e);if(n)return n;const r=sd(i)?lg(i):i,s=sd(i)?i:ub(i),o=r.color[t]||r.color.light,a=o[e]||o.default,l=r.layer||ot.layer,u=s.color[t]||s.color.light,c=u[e]||u.default,h=yy(c),d=s.layer||ot.layer,f={sanity:{...r,color:a,layer:l,v2:{...s,_resolved:!0,color:h,layer:d}}};return Sy(i,t,e,f),f}function wy(i,t,e){const n=ya.get(t);if(!n)return;const r=n.get(e);if(r)return r.get(i)}function Sy(i,t,e,n){ya.has(t)||ya.set(t,new Map);const r=ya.get(t);r.has(e)||r.set(e,new WeakMap),r.get(e).set(i,n)}var Xl,pd;function vy(){if(pd)return Xl;pd=1;var i=Object.create,t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,o=(F,_)=>{for(var j in _)t(F,j,{get:_[j],enumerable:!0})},a=(F,_,j,q)=>{if(_&&typeof _=="object"||typeof _=="function")for(let E of n(_))!s.call(F,E)&&E!==j&&t(F,E,{get:()=>_[E],enumerable:!(q=e(_,E))||q.enumerable});return F},l=(F,_,j)=>(j=F!=null?i(r(F)):{},a(!F||!F.__esModule?t(j,"default",{value:F,enumerable:!0}):j,F)),u=F=>a(t({},"__esModule",{value:!0}),F),c={};o(c,{$dispatcherGuard:()=>R,$makeReadOnly:()=>k,$reset:()=>$,$structuralCheck:()=>X,c:()=>x,clearRenderCounterRegistry:()=>P,renderCounterRegistry:()=>A,useRenderCounter:()=>B}),Xl=u(c);var h=l($1()),{useRef:d,useEffect:f,isValidElement:p}=h,g,m=(g=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE)!=null?g:h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.memo_cache_sentinel"),b,x=typeof((b=h.__COMPILER_RUNTIME)==null?void 0:b.c)=="function"?h.__COMPILER_RUNTIME.c:function(_){return h.useMemo(()=>{const j=new Array(_);for(let q=0;q<_;q++)j[q]=O;return j[O]=!0,j},[])},S={};["readContext","useCallback","useContext","useEffect","useImperativeHandle","useInsertionEffect","useLayoutEffect","useMemo","useReducer","useRef","useState","useDebugValue","useDeferredValue","useTransition","useMutableSource","useSyncExternalStore","useId","unstable_isNewReconciler","getCacheSignal","getCacheForType","useCacheRefresh"].forEach(F=>{S[F]=()=>{throw new Error(`[React] Unexpected React hook call (${F}) from a React compiled function. Check that all hooks are called directly and named according to convention ('use[A-Z]') `)}});var w=null;S.useMemoCache=F=>{if(w==null)throw new Error("React Compiler internal invariant violation: unexpected null dispatcher");return w.useMemoCache(F)};function v(F){return m.ReactCurrentDispatcher.current=F,m.ReactCurrentDispatcher.current}var D=[];function R(F){const _=m.ReactCurrentDispatcher.current;if(F===0){if(D.push(_),D.length===1&&(w=_),_===S)throw new Error("[React] Unexpected call to custom hook or component from a React compiled function. Check that (1) all hooks are called directly and named according to convention ('use[A-Z]') and (2) components are returned as JSX instead of being directly invoked.");v(S)}else if(F===1){const j=D.pop();if(j==null)throw new Error("React Compiler internal error: unexpected null in guard stack");D.length===0&&(w=null),v(j)}else if(F===2)D.push(_),v(w);else if(F===3){const j=D.pop();if(j==null)throw new Error("React Compiler internal error: unexpected null in guard stack");v(j)}else throw new Error("React Compiler internal error: unreachable block"+F)}function $(F){for(let _=0;_<F.length;_++)F[_]=O}function k(){throw new Error("TODO: implement $makeReadOnly in react-compiler-runtime")}var A=new Map;function P(){for(const F of A.values())F.forEach(_=>{_.count=0})}function Q(F,_){let j=A.get(F);j==null&&(j=new Set,A.set(F,j)),j.add(_)}function M(F,_){const j=A.get(F);j?.delete(_)}function B(F){const _=d(null);_.current!=null&&(_.current.count+=1),f(()=>{if(_.current==null){const j={count:0};Q(F,j),_.current=j}return()=>{_.current!==null&&M(F,_.current)}})}var W=new Set;function X(F,_,j,q,E,Z){function L(z,I,V,J){const re=`${q}:${Z} [${E}] ${j}${V} changed from ${z} to ${I} at depth ${J}`;W.has(re)||(W.add(re),console.error(re))}const Y=2;function N(z,I,V,J){if(!(J>Y)){if(z===I)return;if(typeof z!=typeof I)L(`type ${typeof z}`,`type ${typeof I}`,V,J);else if(typeof z=="object"){const re=Array.isArray(z),ee=Array.isArray(I);if(z===null&&I!==null)L("null",`type ${typeof I}`,V,J);else if(I===null)L(`type ${typeof z}`,"null",V,J);else if(z instanceof Map)if(!(I instanceof Map))L("Map instance","other value",V,J);else if(z.size!==I.size)L(`Map instance with size ${z.size}`,`Map instance with size ${I.size}`,V,J);else for(const[se,Oe]of z)I.has(se)?N(Oe,I.get(se),`${V}.get(${se})`,J+1):L(`Map instance with key ${se}`,`Map instance without key ${se}`,V,J);else if(I instanceof Map)L("other value","Map instance",V,J);else if(z instanceof Set)if(!(I instanceof Set))L("Set instance","other value",V,J);else if(z.size!==I.size)L(`Set instance with size ${z.size}`,`Set instance with size ${I.size}`,V,J);else for(const se of I)z.has(se)||L(`Set instance without element ${se}`,`Set instance with element ${se}`,V,J);else if(I instanceof Set)L("other value","Set instance",V,J);else if(re||ee)if(re!==ee)L(`type ${re?"array":"object"}`,`type ${ee?"array":"object"}`,V,J);else if(z.length!==I.length)L(`array with length ${z.length}`,`array with length ${I.length}`,V,J);else for(let se=0;se<z.length;se++)N(z[se],I[se],`${V}[${se}]`,J+1);else if(p(z)||p(I))p(z)!==p(I)?L(`type ${p(z)?"React element":"object"}`,`type ${p(I)?"React element":"object"}`,V,J):z.type!==I.type?L(`React element of type ${z.type}`,`React element of type ${I.type}`,V,J):N(z.props,I.props,`[props of ${V}]`,J+1);else{for(const se in I)se in z||L(`object without key ${se}`,`object with key ${se}`,V,J);for(const se in z)se in I?N(z[se],I[se],`${V}.${se}`,J+1):L(`object with key ${se}`,`object without key ${se}`,V,J)}}else{if(typeof z=="function")return;isNaN(z)||isNaN(I)?isNaN(z)!==isNaN(I)&&L(`${isNaN(z)?"NaN":"non-NaN value"}`,`${isNaN(I)?"NaN":"non-NaN value"}`,V,J):z!==I&&L(z,I,V,J)}}}N(F,_,"",0)}return Xl}var ce=vy(),Dr=lb();const ky=Q1(Dr);by();const Co=[],kr={},as={card:{initial:{scale:.97,willChange:"transform"},hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",duration:.1}},scaleIn:{scale:1},scaleOut:{scale:.97}},children:{hidden:{opacity:0},visible:{opacity:1}},transition:{type:"spring",visualDuration:.2,bounce:.25}};function Cy(i){return Hu(i)||Ku(i)}function nr(i){return i instanceof Node&&i.nodeType===Node.ELEMENT_NODE}function Hu(i){return nr(i)&&i.nodeName==="A"}function Dy(i){return nr(i)&&i.nodeName==="INPUT"}function Ku(i){return nr(i)&&i.nodeName==="BUTTON"}function $y(i){return nr(i)&&i.nodeName==="SELECT"}function Qy(i){return nr(i)&&i.nodeName==="TEXTAREA"}function _c(i,t){return i.contains(t)||i===t}function Py(i){if(!(i instanceof Element))return!1;const t=window.getComputedStyle(i);return t.overflowX.includes("auto")||t.overflowX.includes("scroll")||t.overflowY.includes("auto")||t.overflowY.includes("scroll")}function Ay(i,t){return i.reduce((e,n)=>(e[n]=t,e),{})}function he(i){return i===0?0:`${i/16}rem`}function Me(i,t,e){return(t?.map(e)||[]).map((n,r)=>r===0?n:{[`@media screen and (min-width: ${i[r-1]}px)`]:n})}function K(i,t){return i===void 0?t||Co:Array.isArray(i)?i:[i]}function Bi(i,t,e=Co){if(!Array.isArray(e))throw new Error("the property must be array of numbers");if(e.length===0)return null;const{media:n,space:r}=fe(i);return Me(n,e,s=>Ay(t,he(r[s])))}function bs(i,t){const{$size:e,$weight:n}=t,{font:r,media:s}=fe(t.theme),{family:o,sizes:a,weights:l}=r[i],u=n&&l[n]||l.regular,c=a[2],h={position:"relative",fontFamily:o,fontWeight:`${u}`,padding:"1px 0",margin:0,"&:before":{content:'""',display:"block",height:0},"&:after":{content:'""',display:"block",height:0},"& > code, & > span":{display:"block"},"&:not([hidden])":{display:"block"}};if(!e)return bs.warned||(console.warn("No size specified for responsive font",{fontKey:i,$size:e,props:t,base:h}),bs.warned=!0),[h];const d=Me(s,e,f=>Ey(a[f]||c));return[h,...d]}function Ey(i){const{ascenderHeight:t,descenderHeight:e,fontSize:n,iconSize:r,letterSpacing:s,lineHeight:o}=i,a=t+e,l=o-a,u=(l-r)/2,c=Math.floor(n*1.125/2)*2+1,h=(l-c)/2;return{fontSize:he(n),lineHeight:`calc(${o} / ${n})`,letterSpacing:he(s),transform:`translateY(${he(e)})`,"&:before":{marginTop:`calc(${he(0-a)} - 1px)`},"&:after":{marginBottom:"-1px"},"& svg:not([data-sanity-icon])":{fontSize:`calc(${c} / 16 * 1rem)`,margin:he(h)},"& [data-sanity-icon]":{fontSize:`calc(${r} / 16 * 1rem)`,margin:he(u)}}}function Ty(i){return bs("code",i)}function Ry(i){return bs("heading",i)}function _y(i){return bs("label",i)}function Ju(i){const{media:t}=fe(i.theme);return Me(t,i.$align,e=>({textAlign:e}))}function My(i){return bs("text",i)}function By(){if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof global<"u")return global;throw new Error("@sanity/ui: could not locate global scope")}const Wn=By();function rr(i,t){const e=Symbol.for(i);if(typeof document>"u"){const n=C.createContext(t);return n.displayName=i,n}return Wn[e]=Wn[e]||C.createContext(t),Wn[e]}const Mc=rr("@sanity/ui/context/theme",null);function mg(i){const t=ce.c(15),e=C.useContext(Mc),{children:n}=i,r=i.scheme??(e?.scheme||"light"),s=i.theme??(e?.theme||null),o=i.tone??(e?.tone||"default");let a;e:{if(!s){a=null;break e}let f;t[0]!==s||t[1]!==r||t[2]!==o?(f={version:0,theme:s,scheme:r,tone:o},t[0]=s,t[1]=r,t[2]=o,t[3]=f):f=t[3],a=f}const l=a;let u;e:{if(!s){u=null;break e}let f;t[4]!==s||t[5]!==r||t[6]!==o?(f=xy(s,r,o),t[4]=s,t[5]=r,t[6]=o,t[7]=f):f=t[7],u=f}const c=u;if(!c){let f;return t[8]===Symbol.for("react.memo_cache_sentinel")?(f=y.jsx("pre",{children:'ThemeProvider: no "theme" property provided'}),t[8]=f):f=t[8],f}let h;t[9]!==n||t[10]!==c?(h=y.jsx(P1,{theme:c,children:n}),t[9]=n,t[10]=c,t[11]=h):h=t[11];let d;return t[12]!==h||t[13]!==l?(d=y.jsx(Mc.Provider,{value:l,children:h}),t[12]=h,t[13]=l,t[14]=d):d=t[14],d}mg.displayName="ThemeProvider";function Do(){const i=C.useContext(Mc);if(!i)throw new Error("useRootTheme(): missing context value");return i}function Og(i){const t=ce.c(5),{children:e,scheme:n,tone:r}=i,s=Do(),o=n||s.scheme;let a;return t[0]!==e||t[1]!==s.theme||t[2]!==o||t[3]!==r?(a=y.jsx(mg,{scheme:o,theme:s.theme,tone:r,children:e}),t[0]=e,t[1]=s.theme,t[2]=o,t[3]=r,t[4]=a):a=t[4],a}Og.displayName="ThemeColorProvider";function Fy(){return Yp()}function sr(){const i=ce.c(2),t=Yp();let e;return i[0]!==t?(e=fe(t),i[0]=t,i[1]=e):e=i[1],e}function Zy(){return[zy,jy,Iy,Ly,Xy]}function zy(i){const{card:t,media:e}=fe(i.theme),n=`${t.border?.width??1}px solid var(--card-border-color)`;return Me(e,i.$border,r=>r?{"&&":{border:n}}:{"&&":{border:0}})}function jy(i){const{card:t,media:e}=fe(i.theme),n=`${t.border?.width??1}px solid var(--card-border-color)`;return Me(e,i.$borderTop,r=>r?{"&&":{borderTop:n}}:{"&&":{borderTop:0}})}function Iy(i){const{card:t,media:e}=fe(i.theme),n=`${t.border?.width??1}px solid var(--card-border-color)`;return Me(e,i.$borderRight,r=>r?{"&&":{borderRight:n}}:{"&&":{borderRight:0}})}function Ly(i){const{card:t,media:e}=fe(i.theme),n=`${t.border?.width??1}px solid var(--card-border-color)`;return Me(e,i.$borderBottom,r=>r?{"&&":{borderBottom:n}}:{"&&":{borderBottom:0}})}function Xy(i){const{card:t,media:e}=fe(i.theme),n=`${t.border?.width??1}px solid var(--card-border-color)`;return Me(e,i.$borderLeft,r=>r?{"&&":{borderLeft:n}}:{"&&":{borderLeft:0}})}const Ny={'&[data-as="ul"],&[data-as="ol"]':{listStyle:"none"}},Wy={content:"content-box",border:"border-box"},Yy={stretch:"stretch",fill:"100%"};function qy(){return Ny}function Vy(){return[Uy,Hy,Ky,Gy]}function Gy(i){const{media:t}=fe(i.theme);return Me(t,i.$display,e=>({"&:not([hidden])":{display:e}}))}function Uy(i){const{media:t}=fe(i.theme);return Me(t,i.$sizing,e=>({boxSizing:Wy[e]}))}function Hy(i){const{media:t}=fe(i.theme);return Me(t,i.$height,e=>({height:Yy[e]}))}function Ky(i){const{media:t}=fe(i.theme);return Me(t,i.$overflow,e=>({overflow:e}))}const Jy={minWidth:0,minHeight:0};function bg(){return[Jy,e2]}function e2(i){const{media:t}=fe(i.theme);return i.$flex?Me(t,i.$flex,e=>({flex:`${e}`})):Co}const t2={"&&:not([hidden])":{display:"flex"}};function i2(){return[t2,n2,r2,s2,o2,a2]}function n2(i){const{media:t}=fe(i.theme);return Me(t,i.$align,e=>({alignItems:e}))}function r2(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$gap,n=>({gap:n?he(e[n]):void 0}))}function s2(i){const{media:t}=fe(i.theme);return Me(t,i.$wrap,e=>({flexWrap:e}))}function o2(i){const{media:t}=fe(i.theme);return Me(t,i.$justify,e=>({justifyContent:e}))}function a2(i){const{media:t}=fe(i.theme);return Me(t,i.$direction,e=>({flexDirection:e}))}function wt(i){return`inset 0 0 0 ${i.width}px ${i.color}`}function ln(i){const{base:t,border:e,focusRing:n}=i,r=n.offset+n.width,s=0-n.offset,o=t?t.bg:"var(--card-bg-color)";return[s>0&&`inset 0 0 0 ${s}px var(--card-focus-ring-color)`,e&&wt(e),s<0&&`0 0 0 ${0-s}px ${o}`,r>0&&`0 0 0 ${r}px var(--card-focus-ring-color)`].filter(Boolean).join(",")}function l2(){return[h2,d2,f2,p2,g2,m2]}const c2={auto:"auto",full:"1 / -1"},u2={auto:"auto",full:"1 / -1"};function h2(i){const{media:t}=fe(i.theme);return Me(t,i.$row,e=>typeof e=="number"?{gridRow:`span ${e} / span ${e}`}:{gridRow:c2[e]})}function d2(i){const{media:t}=fe(i.theme);return Me(t,i.$rowStart,e=>({gridRowStart:`${e}`}))}function f2(i){const{media:t}=fe(i.theme);return Me(t,i.$rowEnd,e=>({gridRowEnd:`${e}`}))}function p2(i){const{media:t}=fe(i.theme);return Me(t,i.$column,e=>typeof e=="number"?{gridColumn:`span ${e} / span ${e}`}:{gridColumn:u2[e]})}function g2(i){const{media:t}=fe(i.theme);return Me(t,i.$columnStart,e=>({gridColumnStart:`${e}`}))}function m2(i){const{media:t}=fe(i.theme);return Me(t,i.$columnEnd,e=>({gridColumnEnd:`${e}`}))}const O2={"&&:not([hidden])":{display:"grid"},'&[data-as="ul"],&[data-as="ol"]':{listStyle:"none"}},b2={auto:"auto",min:"min-content",max:"max-content",fr:"minmax(0, 1fr)"},y2={auto:"auto",min:"min-content",max:"max-content",fr:"minmax(0, 1fr)"};function x2(){return[O2,w2,S2,v2,k2,C2,D2,$2,Q2]}function w2(i){const{media:t}=fe(i.theme);return Me(t,i.$autoFlow,e=>({gridAutoFlow:e}))}function S2(i){const{media:t}=fe(i.theme);return Me(t,i.$autoRows,e=>({gridAutoRows:e&&y2[e]}))}function v2(i){const{media:t}=fe(i.theme);return Me(t,i.$autoCols,e=>({gridAutoColumns:e&&b2[e]}))}function k2(i){const{media:t}=fe(i.theme);return Me(t,i.$columns,e=>({gridTemplateColumns:e&&`repeat(${e},minmax(0,1fr));`}))}function C2(i){const{media:t}=fe(i.theme);return Me(t,i.$rows,e=>({gridTemplateRows:e&&`repeat(${e},minmax(0,1fr));`}))}function D2(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$gap,n=>({gridGap:n?he(e[n]):void 0}))}function $2(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$gapX,n=>({columnGap:n?he(e[n]):void 0}))}function Q2(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$gapY,n=>({rowGap:n?he(e[n]):void 0}))}function eh(i){const{$fontSize:t,$iconLeft:e,$iconRight:n,$padding:r,$space:s}=i,{font:o,media:a,space:l}=fe(i.theme),u=Math.max(r.length,s.length,t.length),c=[],h=[],d=[];for(let f=0;f<u;f+=1)d[f]=t[f]===void 0?d[f-1]:t[f],c[f]=r[f]===void 0?c[f-1]:r[f],h[f]=s[f]===void 0?h[f-1]:s[f];return Me(a,c,(f,p)=>{const g=o.text.sizes[d[p]]||o.text.sizes[2],m=g.lineHeight-g.ascenderHeight-g.descenderHeight,O=l[c[p]],b=l[h[p]],x={paddingTop:he(O-g.ascenderHeight),paddingRight:he(O),paddingBottom:he(O-g.descenderHeight),paddingLeft:he(O)};return n&&(x.paddingRight=he(O+m+b)),e&&(x.paddingLeft=he(O+m+b)),x})}function P2(i){return eh({...i,$iconRight:!0})}const A2=Re`
  &:not([hidden]) {
    display: flex;
  }

  align-items: center;
`;function yg(){return A2}function xg(i){const{$scheme:t,$tone:e,$weight:n}=i,{color:r,font:s}=fe(i.theme);return Re`
    appearance: none;
    background: none;
    border: 0;
    border-radius: 0;
    outline: none;
    width: 100%;
    box-sizing: border-box;
    font-family: ${s.text.family};
    font-weight: ${n&&s.text.weights[n]||s.text.weights.regular};
    margin: 0;
    position: relative;
    z-index: 1;
    display: block;

    /* NOTE: This is a hack to disable Chrome’s autofill styles */
    &:-webkit-autofill,
    &:-webkit-autofill:hover,
    &:-webkit-autofill:focus,
    &:-webkit-autofill:active {
      -webkit-text-fill-color: var(--input-fg-color) !important;
      transition: background-color 5000s;
      transition-delay: 86400s /* 24h */;
    }

    /* &:is(textarea) */
    &[data-as='textarea'] {
      resize: none;
    }

    color: var(--input-fg-color);

    &::placeholder {
      color: var(--input-placeholder-color);
    }

    &[data-scheme='${t}'][data-tone='${e}'] {
      --input-fg-color: ${r.input.default.enabled.fg};
      --input-placeholder-color: ${r.input.default.enabled.placeholder};

      /* enabled */
      &:not(:invalid):not(:disabled):not(:read-only) {
        --input-fg-color: ${r.input.default.enabled.fg};
        --input-placeholder-color: ${r.input.default.enabled.placeholder};
      }

      /* disabled */
      &:not(:invalid):disabled {
        --input-fg-color: ${r.input.default.disabled.fg};
        --input-placeholder-color: ${r.input.default.disabled.placeholder};
      }

      /* invalid */
      &:invalid {
        --input-fg-color: ${r.input.invalid.enabled.fg};
        --input-placeholder-color: ${r.input.invalid.enabled.placeholder};
      }

      /* readOnly */
      &:read-only {
        --input-fg-color: ${r.input.default.readOnly.fg};
        --input-placeholder-color: ${r.input.default.readOnly.placeholder};
      }
    }
  `}function wg(i){const{font:t,media:e}=fe(i.theme);return Me(e,i.$fontSize,n=>{const r=t.text.sizes[n]||t.text.sizes[2];return{fontSize:he(r.fontSize),lineHeight:`${r.lineHeight/r.fontSize}`}})}function Sg(i){const{$hasPrefix:t,$hasSuffix:e,$scheme:n,$tone:r,$unstableDisableFocusRing:s}=i,{color:o,input:a}=fe(i.theme);return Re`
    --input-box-shadow: none;

    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: block;
    pointer-events: none;
    z-index: 0;

    background-color: var(--card-bg-color);
    box-shadow: var(--input-box-shadow);

    border-top-left-radius: ${t?0:void 0};
    border-bottom-left-radius: ${t?0:void 0};
    border-top-right-radius: ${e?0:void 0};
    border-bottom-right-radius: ${e?0:void 0};

    &[data-scheme='${n}'][data-tone='${r}'] {
      --card-bg-color: ${o.input.default.enabled.bg};
      --card-fg-color: ${o.input.default.enabled.fg};

      /* enabled */
      *:not(:disabled) + &[data-border] {
        --input-box-shadow: ${wt({color:o.input.default.enabled.border,width:a.border.width})};
      }

      /* invalid */
      *:not(:disabled):invalid + & {
        --card-bg-color: ${o.input.invalid.enabled.bg};
        --card-fg-color: ${o.input.invalid.enabled.fg};

        &[data-border] {
          --input-box-shadow: ${wt({color:o.input.invalid.enabled.border,width:a.border.width})};
        }
      }

      /* focused */
      *:not(:disabled):focus + & {
        &[data-border] {
          --input-box-shadow: ${s?void 0:ln({border:{color:o.input.default.enabled.border,width:a.border.width},focusRing:a.text.focusRing})};
        }

        &:not([data-border]) {
          --input-box-shadow: ${s?void 0:ln({focusRing:a.text.focusRing})};
        }
      }

      /* disabled */
      *:not(:invalid):disabled + & {
        --card-bg-color: ${o.input.default.disabled.bg} !important;
        --card-fg-color: ${o.input.default.disabled.fg} !important;
        --card-icon-color: ${o.input.default.disabled.fg} !important;

        &[data-border] {
          --input-box-shadow: ${wt({color:o.input.default.disabled.border,width:a.border.width})};
        }
      }

      *:invalid:disabled + & {
        --card-bg-color: ${o.input.invalid.disabled.bg} !important;
        --card-fg-color: ${o.input.invalid.disabled.fg} !important;
        --card-icon-color: ${o.input.invalid.disabled.fg} !important;

        &[data-border] {
          --input-box-shadow: ${wt({color:o.input.invalid.disabled.border,width:a.border.width})};
        }
      }

      /* readOnly */
      *:not(:invalid):read-only + & {
        --card-bg-color: ${o.input.default.readOnly.bg} !important;
        --card-fg-color: ${o.input.default.readOnly.fg} !important;
      }

      *:invalid:read-only + & {
        --card-bg-color: ${o.input.invalid.readOnly.bg} !important;
        --card-fg-color: ${o.input.invalid.readOnly.fg} !important;
      }

      /* hovered */
      @media (hover: hover) {
        *:not(:disabled):not(:read-only):not(:invalid):hover + & {
          --card-bg-color: ${o.input.default.hovered.bg};
          --card-fg-color: ${o.input.default.hovered.fg};
        }

        *:invalid:not(:disabled):not(:read-only):hover + & {
          --card-bg-color: ${o.input.invalid.hovered.bg};
          --card-fg-color: ${o.input.invalid.hovered.fg};
        }

        *:not(:disabled):not(:read-only):not(:invalid):not(:focus):hover + &[data-border] {
          --input-box-shadow: ${wt({color:o.input.default.hovered.border,width:a.border.width})};
        }

        *:invalid:not(:disabled):not(:read-only):not(:focus):hover + &[data-border] {
          --input-box-shadow: ${wt({color:o.input.invalid.hovered.border,width:a.border.width})};
        }
      }
    }
  `}function E2(i){const{theme:t}=i;return[Bi(t,["margin"],i.$margin),Bi(t,["marginLeft","marginRight"],i.$marginX),Bi(t,["marginTop","marginBottom"],i.$marginY),Bi(t,["marginTop"],i.$marginTop),Bi(t,["marginRight"],i.$marginRight),Bi(t,["marginBottom"],i.$marginBottom),Bi(t,["marginLeft"],i.$marginLeft)].filter(Boolean)}function vg(i){const{theme:t}=i;return[Bi(t,["padding"],i.$padding),Bi(t,["paddingLeft","paddingRight"],i.$paddingX),Bi(t,["paddingTop","paddingBottom"],i.$paddingY),Bi(t,["paddingTop"],i.$paddingTop),Bi(t,["paddingRight"],i.$paddingRight),Bi(t,["paddingBottom"],i.$paddingBottom),Bi(t,["paddingLeft"],i.$paddingLeft)].filter(Boolean)}function or(i){const{media:t,radius:e}=fe(i.theme);return Me(t,i.$radius,n=>{let r=0;return typeof n=="number"&&(r=he(e[n])),n==="full"&&(r="9999px"),{borderRadius:r}})}function Nl(i,t){return`${i.map(he).join(" ")} ${t}`}function T2(i,t=1){if(!i)return kr;const e=`0 0 0 ${he(t)} var(--card-shadow-outline-color)`,n=Nl(i.umbra,"var(--card-shadow-umbra-color)"),r=Nl(i.penumbra,"var(--card-shadow-penumbra-color)"),s=Nl(i.ambient,"var(--card-shadow-ambient-color)");return{boxShadow:`${e}, ${n}, ${r}, ${s}`}}function R2(i){const{card:t,media:e,shadow:n}=fe(i.theme);return Me(e,i.$shadow,r=>T2(n[r],t.shadow.outline))}const th=G.span.withConfig({displayName:"SpanWithTextOverflow",componentId:"sc-ol2i3b-0"})`display:block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;overflow:clip;`;function _2(i){const{$accent:t,$muted:e}=i,{font:n}=fe(i.theme);return Re`
    text-transform: uppercase;

    ${t&&Re`
      color: var(--card-accent-fg-color);
    `}

    ${e&&Re`
      color: var(--card-muted-fg-color);
    `}

    & code {
      font-family: ${n.code.family};
      border-radius: 1px;
    }

    & a {
      text-decoration: none;
      border-radius: 1px;
    }

    & svg {
      /* Certain popular CSS libraries changes the defaults for SVG display */
      /* Make sure SVGs are rendered as inline elements */
      display: inline;
    }

    & [data-sanity-icon] {
      vertical-align: baseline;
    }
  `}const M2=G.div.withConfig({displayName:"StyledLabel",componentId:"sc-1luap7z-0"})(_y,Ju,_2),hl=C.forwardRef(function(i,t){const e=ce.c(26);let n,r,s,o,a,l,u,c;e[0]!==i?({accent:n,align:r,children:s,muted:a,size:l,textOverflow:u,weight:c,...o}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8]);const h=a===void 0?!1:a,d=l===void 0?2:l;let f=s;if(u==="ellipsis"){let O;e[9]!==f?(O=y.jsx(th,{children:f}),e[9]=f,e[10]=O):O=e[10],f=O}else{let O;e[11]!==f?(O=y.jsx("span",{children:f}),e[11]=f,e[12]=O):O=e[12],f=O}let p;e[13]!==r?(p=K(r),e[13]=r,e[14]=p):p=e[14];let g;e[15]!==d?(g=K(d),e[15]=d,e[16]=g):g=e[16];let m;return e[17]!==n||e[18]!==f||e[19]!==h||e[20]!==t||e[21]!==o||e[22]!==p||e[23]!==g||e[24]!==c?(m=y.jsx(M2,{"data-ui":"Label",...o,$accent:n,$align:p,$muted:h,$size:g,$weight:c,ref:t,children:f}),e[17]=n,e[18]=f,e[19]=h,e[20]=t,e[21]=o,e[22]=p,e[23]=g,e[24]=c,e[25]=m):m=e[25],m});hl.displayName="ForwardRef(Label)";const As={root:F2,arrow:B2,bgStroke:I2,stroke:L2,initials:j2,image:z2};function B2(){return{position:"absolute",boxSizing:"border-box",zIndex:"0",opacity:"0",transition:"all 0.2s linear",transform:"rotate(-90deg) translate3d(0, 6px, 0)",left:0,right:0,top:0,bottom:0,"& > svg":{width:"11px",height:"7px",position:"absolute",top:"-5px",left:"50%",transform:"translateX(-6px)","&:not([hidden])":{display:"block"}},"[data-arrow-position='inside'] > &":{transform:"rotate(-90deg) translate3d(0, 6px, 0)",opacity:"0"},"[data-arrow-position='top'] > &":{opacity:"1",transform:"rotate(0deg)"},"[data-arrow-position='bottom'] > &":{opacity:"1",transform:"rotate(-180deg)"}}}function F2(i){const{$color:t}=i,{avatar:e}=fe(i.theme);return{"--avatar-bg-color":`var(--card-avatar-${t}-bg-color)`,"--avatar-fg-color":`var(--card-avatar-${t}-fg-color)`,backgroundColor:"var(--avatar-bg-color)",position:"relative",boxSizing:"border-box",userSelect:"none",boxShadow:"0 0 0 1px var(--card-bg-color)",'&[data-status="inactive"]':{opacity:"0.5"},"&>svg":{"&:not([hidden])":{display:"block"}},'&[data-as="button"]':{WebkitFontSmoothing:"inherit",appearance:"none",margin:0,padding:0,border:0,font:"inherit",color:"inherit",outline:"none","&:focus":{boxShadow:ln({focusRing:e.focusRing})},"&:focus:not(:focus-visible)":{boxShadow:"none"}}}}function Z2(i){const{avatar:t,media:e}=fe(i.theme);return Me(e,i.$size,n=>{const r=t.sizes[n]||t.sizes[0];return{width:he(r.size),height:he(r.size),borderRadius:he(r.size/2),"&>svg":{width:he(r.size),height:he(r.size),borderRadius:he(r.size/2)}}})}function z2(){return{position:"relative"}}function j2(){return{width:"100%",height:"100%",color:"var(--avatar-fg-color)",alignItems:"center",justifyContent:"center",textTransform:"uppercase",textAlign:"center",borderRadius:"50%","&:not([hidden])":{display:"flex"}}}function I2(){return{strokeWidth:"4px",stroke:"var(--card-bg-color)"}}function L2(){return{strokeWidth:"2px",stroke:"var(--avatar-bg-color)",'[data-status="editing"] &':{strokeDasharray:"2 4",strokeLinecap:"round"}}}const X2=G.div.withConfig({displayName:"StyledAvatar",componentId:"sc-1rj7kl0-0"})(Z2,As.root),N2=G.div.withConfig({displayName:"Arrow",componentId:"sc-1rj7kl0-1"})(As.arrow),W2=G.ellipse.withConfig({displayName:"BgStroke",componentId:"sc-1rj7kl0-2"})(As.bgStroke),Y2=G.ellipse.withConfig({displayName:"Stroke",componentId:"sc-1rj7kl0-3"})(As.stroke),q2=G.div.withConfig({displayName:"Initials",componentId:"sc-1rj7kl0-4"})(As.initials),V2=G(hl).withConfig({displayName:"InitialsLabel",componentId:"sc-1rj7kl0-5"})({color:"inherit"}),G2=G.svg.withConfig({displayName:"AvatarImage",componentId:"sc-1rj7kl0-6"})(As.image),U2=C.forwardRef(function(i,t){const e=ce.c(46);let n,r,s,o,a,l,u,c,h,d,f,p;e[0]!==i?({__unstable_hideInnerStroke:n,as:o,color:h,src:c,title:p,initials:a,onImageLoadError:l,arrowPosition:s,animateArrowFrom:r,status:d,size:f,...u}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12]);const g=h===void 0?"gray":h,m=d===void 0?"online":d,O=f===void 0?1:f,{avatar:b}=sr(),x=ky.isValidElementType(o)?o:"div",S=K(O),w=(b.sizes[S[0]]||b.sizes[0]).size,v=w/2,D=C.useId(),[R,$]=C.useState(r||s||"inside"),[k,A]=C.useState(!1),P=`avatar-image-${D}`;let Q,M;e[13]!==R||e[14]!==s?(Q=()=>{if(R===s)return;const N=requestAnimationFrame(()=>$(s));return()=>cancelAnimationFrame(N)},M=[R,s],e[13]=R,e[14]=s,e[15]=Q,e[16]=M):(Q=e[15],M=e[16]),C.useEffect(Q,M);let B,W;e[17]!==c?(B=()=>{c&&A(!1)},W=[c],e[17]=c,e[18]=B,e[19]=W):(B=e[18],W=e[19]),C.useEffect(B,W);let X;e[20]!==l?(X=()=>{A(!0),l&&l(new Error("Avatar: the image failed to load"))},e[20]=l,e[21]=X):X=e[21];const F=X,_=X2,j=typeof x=="string"?x:void 0,q="Avatar";let E;e[22]!==g?(E=y.jsx(N2,{children:y.jsx("svg",{width:"11",height:"7",viewBox:"0 0 11 7",fill:"none",children:y.jsx("path",{d:"M6.67948 1.50115L11 7L0 7L4.32052 1.50115C4.92109 0.736796 6.07891 0.736795 6.67948 1.50115Z",fill:g})})}),e[22]=g,e[23]=E):E=e[23];let Z;e[24]!==n||e[25]!==v||e[26]!==w||e[27]!==F||e[28]!==k||e[29]!==P||e[30]!==c?(Z=!k&&c&&y.jsxs(G2,{viewBox:`0 0 ${w} ${w}`,fill:"none",children:[y.jsx("defs",{children:y.jsx("pattern",{id:P,patternContentUnits:"objectBoundingBox",width:"1",height:"1",children:y.jsx("image",{href:c,width:"1",height:"1",onError:F})})}),y.jsx("circle",{cx:v,cy:v,r:v,fill:`url(#${P})`}),!n&&y.jsx(W2,{cx:v,cy:v,rx:v,ry:v,vectorEffect:"non-scaling-stroke"}),y.jsx(Y2,{cx:v,cy:v,rx:v,ry:v,vectorEffect:"non-scaling-stroke"})]}),e[24]=n,e[25]=v,e[26]=w,e[27]=F,e[28]=k,e[29]=P,e[30]=c,e[31]=Z):Z=e[31];const L=(k||!c)&&a&&y.jsx(y.Fragment,{children:y.jsx(q2,{children:y.jsx(V2,{forwardedAs:"span",size:S.map(H2),weight:"medium",children:a})})});let Y;return e[32]!==_||e[33]!==R||e[34]!==x||e[35]!==g||e[36]!==t||e[37]!==u||e[38]!==S||e[39]!==m||e[40]!==E||e[41]!==Z||e[42]!==L||e[43]!==j||e[44]!==p?(Y=y.jsxs(_,{as:x,"data-as":j,"data-ui":q,...u,$color:g,$size:S,"aria-label":p,"data-arrow-position":R,"data-status":m,ref:t,title:p,children:[E,Z,L]}),e[32]=_,e[33]=R,e[34]=x,e[35]=g,e[36]=t,e[37]=u,e[38]=S,e[39]=m,e[40]=E,e[41]=Z,e[42]=L,e[43]=j,e[44]=p,e[45]=Y):Y=e[45],Y});U2.displayName="ForwardRef(Avatar)";function H2(i){return i===1?1:i===2?3:i===3?5:0}function K2(i){const{avatar:t,media:e}=fe(i.theme);return Me(e,i.$size,n=>{const r=t.sizes[n];return r?{borderRadius:he(r.size/2),minWidth:he(r.size),height:he(r.size)}:kr})}function J2(i){const{space:t}=fe(i.theme);return Re`
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    user-select: none;
    color: inherit;
    color: var(--card-fg-color);
    background: var(--card-bg-color);
    box-shadow:
      0 0 0 1px var(--card-bg-color),
      inset 0 0 0 1px var(--card-hairline-hard-color);
    padding: 0 ${he(t[2])};

    &:not([hidden]) {
      display: flex;
    }
  `}const ex=G.div.withConfig({displayName:"StyledAvatarCounter",componentId:"sc-1ydx86y-0"})(K2,J2),Bc=C.forwardRef(function(i,t){const e=ce.c(20),{count:n,size:r}=i,s=r===void 0?1:r;let o,a,l,u,c,h,d;if(e[0]!==t||e[1]!==s){const g=K(s);a=ex,c=g,h="AvatarCounter",d=t,o=hl,l="span",u=g.map(tx),e[0]=t,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=u,e[6]=c,e[7]=h,e[8]=d}else o=e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=e[8];let f;e[9]!==o||e[10]!==n||e[11]!==l||e[12]!==u?(f=y.jsx(o,{as:l,size:u,weight:"medium",children:n}),e[9]=o,e[10]=n,e[11]=l,e[12]=u,e[13]=f):f=e[13];let p;return e[14]!==a||e[15]!==c||e[16]!==h||e[17]!==d||e[18]!==f?(p=y.jsx(a,{$size:c,"data-ui":h,ref:d,children:f}),e[14]=a,e[15]=c,e[16]=h,e[17]=d,e[18]=f,e[19]=p):p=e[19],p});Bc.displayName="ForwardRef(AvatarCounter)";function tx(i){return i===1?1:i===2?3:i===3?5:0}const ix=Re`
  white-space: nowrap;

  & > div {
    vertical-align: top;

    &:not([hidden]) {
      display: inline-block;
    }
  }
`;function nx(){return ix}function rx(i){const{avatar:t,media:e}=fe(i.theme);return Me(e,i.$size,n=>{const r=t.sizes[n];return r?{"& > div + div":{marginLeft:he(r.distance)}}:kr})}const sx=G.div.withConfig({displayName:"StyledAvatarStack",componentId:"sc-cysmbb-0"})(rx,nx),ox=C.forwardRef(function(i,t){const e=ce.c(38);let n,r,s,o;e[0]!==i?({children:n,maxLength:s,size:o,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o):(n=e[1],r=e[2],s=e[3],o=e[4]);const a=s===void 0?4:s,l=o===void 0?1:o;let u,c,h,d,f,p,g,m;if(e[5]!==n||e[6]!==a||e[7]!==t||e[8]!==r||e[9]!==l){const b=C.Children.toArray(n).filter(C.isValidElement),x=Math.max(a,0);let S;e[18]!==l?(S=K(l),e[18]=l,e[19]=S):S=e[19];const w=S,v=b.length,D=x-1,R=v-D,$=R>1?b.slice(R,v):b;u=sx,c="AvatarStack",h=r,d=t,f=w,e[20]!==v||e[21]!==w?(p=v===0&&y.jsx("div",{children:y.jsx(Bc,{count:v,size:w})}),e[20]=v,e[21]=w,e[22]=p):p=e[22],e[23]!==R||e[24]!==v||e[25]!==w?(g=v!==0&&R>1&&y.jsx("div",{children:y.jsx(Bc,{count:R,size:w})}),e[23]=R,e[24]=v,e[25]=w,e[26]=g):g=e[26];let k;e[27]!==w?(k=(A,P)=>y.jsx("div",{children:C.cloneElement(A,{size:w})},String(P)),e[27]=w,e[28]=k):k=e[28],m=$.map(k),e[5]=n,e[6]=a,e[7]=t,e[8]=r,e[9]=l,e[10]=u,e[11]=c,e[12]=h,e[13]=d,e[14]=f,e[15]=p,e[16]=g,e[17]=m}else u=e[10],c=e[11],h=e[12],d=e[13],f=e[14],p=e[15],g=e[16],m=e[17];let O;return e[29]!==u||e[30]!==c||e[31]!==h||e[32]!==d||e[33]!==f||e[34]!==p||e[35]!==g||e[36]!==m?(O=y.jsxs(u,{"data-ui":c,...h,ref:d,$size:f,children:[p,g,m]}),e[29]=u,e[30]=c,e[31]=h,e[32]=d,e[33]=f,e[34]=p,e[35]=g,e[36]=m,e[37]=O):O=e[37],O});ox.displayName="ForwardRef(AvatarStack)";const ax=G.div.withConfig({displayName:"StyledBox",componentId:"sc-1hhky9f-0"})(qy,bg,Vy,l2,E2,vg),me=C.forwardRef(function(i,t){const e=ce.c(109);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R,$,k,A,P,Q;e[0]!==i?({as:k,column:n,columnStart:s,columnEnd:r,display:A,flex:o,height:a,margin:P,marginX:d,marginY:f,marginTop:h,marginRight:c,marginBottom:l,marginLeft:u,overflow:p,padding:Q,paddingX:x,paddingY:S,paddingTop:b,paddingRight:O,paddingBottom:g,paddingLeft:m,row:v,rowStart:R,rowEnd:D,sizing:$,...w}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S,e[19]=w,e[20]=v,e[21]=D,e[22]=R,e[23]=$,e[24]=k,e[25]=A,e[26]=P,e[27]=Q):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18],w=e[19],v=e[20],D=e[21],R=e[22],$=e[23],k=e[24],A=e[25],P=e[26],Q=e[27]);const M=k===void 0?"div":k,B=A===void 0?"block":A,W=P===void 0?0:P,X=Q===void 0?0:Q,F=typeof M=="string"?M:void 0;let _;e[28]!==n?(_=K(n),e[28]=n,e[29]=_):_=e[29];let j;e[30]!==s?(j=K(s),e[30]=s,e[31]=j):j=e[31];let q;e[32]!==r?(q=K(r),e[32]=r,e[33]=q):q=e[33];let E;e[34]!==B?(E=K(B),e[34]=B,e[35]=E):E=e[35];let Z;e[36]!==o?(Z=K(o),e[36]=o,e[37]=Z):Z=e[37];let L;e[38]!==a?(L=K(a),e[38]=a,e[39]=L):L=e[39];let Y;e[40]!==W?(Y=K(W),e[40]=W,e[41]=Y):Y=e[41];let N;e[42]!==d?(N=K(d),e[42]=d,e[43]=N):N=e[43];let z;e[44]!==f?(z=K(f),e[44]=f,e[45]=z):z=e[45];let I;e[46]!==h?(I=K(h),e[46]=h,e[47]=I):I=e[47];let V;e[48]!==c?(V=K(c),e[48]=c,e[49]=V):V=e[49];let J;e[50]!==l?(J=K(l),e[50]=l,e[51]=J):J=e[51];let re;e[52]!==u?(re=K(u),e[52]=u,e[53]=re):re=e[53];let ee;e[54]!==p?(ee=K(p),e[54]=p,e[55]=ee):ee=e[55];let se;e[56]!==X?(se=K(X),e[56]=X,e[57]=se):se=e[57];let Oe;e[58]!==x?(Oe=K(x),e[58]=x,e[59]=Oe):Oe=e[59];let be;e[60]!==S?(be=K(S),e[60]=S,e[61]=be):be=e[61];let ne;e[62]!==b?(ne=K(b),e[62]=b,e[63]=ne):ne=e[63];let ke;e[64]!==O?(ke=K(O),e[64]=O,e[65]=ke):ke=e[65];let Qe;e[66]!==g?(Qe=K(g),e[66]=g,e[67]=Qe):Qe=e[67];let Pe;e[68]!==m?(Pe=K(m),e[68]=m,e[69]=Pe):Pe=e[69];let ye;e[70]!==v?(ye=K(v),e[70]=v,e[71]=ye):ye=e[71];let we;e[72]!==R?(we=K(R),e[72]=R,e[73]=we):we=e[73];let Ce;e[74]!==D?(Ce=K(D),e[74]=D,e[75]=Ce):Ce=e[75];let Ee;e[76]!==$?(Ee=K($),e[76]=$,e[77]=Ee):Ee=e[77];let De;return e[78]!==M||e[79]!==i.children||e[80]!==t||e[81]!==w||e[82]!==L||e[83]!==Y||e[84]!==N||e[85]!==z||e[86]!==I||e[87]!==V||e[88]!==J||e[89]!==re||e[90]!==ee||e[91]!==se||e[92]!==Oe||e[93]!==be||e[94]!==ne||e[95]!==ke||e[96]!==Qe||e[97]!==Pe||e[98]!==ye||e[99]!==we||e[100]!==Ce||e[101]!==Ee||e[102]!==F||e[103]!==_||e[104]!==j||e[105]!==q||e[106]!==E||e[107]!==Z?(De=y.jsx(ax,{"data-as":F,"data-ui":"Box",...w,$column:_,$columnStart:j,$columnEnd:q,$display:E,$flex:Z,$height:L,$margin:Y,$marginX:N,$marginY:z,$marginTop:I,$marginRight:V,$marginBottom:J,$marginLeft:re,$overflow:ee,$padding:se,$paddingX:Oe,$paddingY:be,$paddingTop:ne,$paddingRight:ke,$paddingBottom:Qe,$paddingLeft:Pe,$row:ye,$rowStart:we,$rowEnd:Ce,$sizing:Ee,as:M,ref:t,children:i.children}),e[78]=M,e[79]=i.children,e[80]=t,e[81]=w,e[82]=L,e[83]=Y,e[84]=N,e[85]=z,e[86]=I,e[87]=V,e[88]=J,e[89]=re,e[90]=ee,e[91]=se,e[92]=Oe,e[93]=be,e[94]=ne,e[95]=ke,e[96]=Qe,e[97]=Pe,e[98]=ye,e[99]=we,e[100]=Ce,e[101]=Ee,e[102]=F,e[103]=_,e[104]=j,e[105]=q,e[106]=E,e[107]=Z,e[108]=De):De=e[108],De});me.displayName="ForwardRef(Box)";function lx(i){const{$accent:t,$muted:e}=i,{font:n}=fe(i.theme);return Re`
    color: var(--card-fg-color);

    ${t&&Re`
      color: var(--card-accent-fg-color);
    `}

    ${e&&Re`
      color: var(--card-muted-fg-color);
    `}

    & code {
      font-family: ${n.code.family};
      border-radius: 1px;
      background-color: var(--card-code-bg-color);
      color: var(--card-code-fg-color);
    }

    & a {
      text-decoration: none;
      border-radius: 1px;
      color: var(--card-link-color);
      outline: none;

      @media (hover: hover) {
        &:hover {
          text-decoration: underline;
        }
      }

      &:focus {
        box-shadow:
          0 0 0 1px var(--card-bg-color),
          0 0 0 3px var(--card-focus-ring-color);
      }

      &:focus:not(:focus-visible) {
        box-shadow: none;
      }
    }

    & strong {
      font-weight: ${n.text.weights.bold};
    }

    & svg {
      /* Certain popular CSS libraries changes the defaults for SVG display */
      /* Make sure SVGs are rendered as inline elements */
      display: inline;
    }

    & [data-sanity-icon] {
      vertical-align: baseline;
      color: var(--card-icon-color);

      & path {
        vector-effect: non-scaling-stroke !important;
      }
    }
  `}const cx=G.div.withConfig({displayName:"StyledText",componentId:"sc-11ov82j-0"})(My,Ju,lx),et=C.forwardRef(function(i,t){const e=ce.c(26);let n,r,s,o,a,l,u,c;e[0]!==i?({accent:o,align:n,children:r,muted:a,size:l,textOverflow:u,weight:c,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8]);const h=o===void 0?!1:o,d=a===void 0?!1:a,f=l===void 0?2:l;let p=r;if(u==="ellipsis"){let x;e[9]!==p?(x=y.jsx(th,{children:p}),e[9]=p,e[10]=x):x=e[10],p=x}let g;e[11]!==n?(g=K(n),e[11]=n,e[12]=g):g=e[12];let m;e[13]!==f?(m=K(f),e[13]=f,e[14]=m):m=e[14];let O;e[15]!==p?(O=y.jsx("span",{children:p}),e[15]=p,e[16]=O):O=e[16];let b;return e[17]!==h||e[18]!==d||e[19]!==t||e[20]!==s||e[21]!==g||e[22]!==m||e[23]!==O||e[24]!==c?(b=y.jsx(cx,{"data-ui":"Text",...s,$accent:h,$align:g,$muted:d,ref:t,$size:m,$weight:c,children:O}),e[17]=h,e[18]=d,e[19]=t,e[20]=s,e[21]=g,e[22]=m,e[23]=O,e[24]=c,e[25]=b):b=e[25],b});et.displayName="ForwardRef(Text)";function ux(i){const{$tone:t}=i;return{"--card-bg-color":`var(--card-badge-${t}-bg-color)`,"--card-fg-color":`var(--card-badge-${t}-fg-color)`,backgroundColor:"var(--card-bg-color)",cursor:"default","&:not([hidden])":{display:"inline-block",verticalAlign:"top"}}}const hx=G(me).withConfig({displayName:"StyledBadge",componentId:"sc-5u140l-0"})(or,ux),kg=C.forwardRef(function(i,t){const e=ce.c(21);let n,r,s,o,a,l;if(e[0]!==i){const{children:O,fontSize:b,mode:x,padding:S,radius:w,tone:v,...D}=i;n=O,s=b,o=S,a=w,l=v,r=D,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l}else n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6];const u=s===void 0?1:s,c=o===void 0?1:o,h=a===void 0?"full":a,d=l===void 0?"default":l;let f;e[7]!==h?(f=K(h),e[7]=h,e[8]=f):f=e[8];let p;e[9]!==c?(p=K(c),e[9]=c,e[10]=p):p=e[10];let g;e[11]!==n||e[12]!==u?(g=y.jsx(et,{size:u,children:n}),e[11]=n,e[12]=u,e[13]=g):g=e[13];let m;return e[14]!==t||e[15]!==r||e[16]!==f||e[17]!==p||e[18]!==g||e[19]!==d?(m=y.jsx(hx,{"data-ui":"Badge",...r,$tone:d,$radius:f,padding:p,ref:t,children:g}),e[14]=t,e[15]=r,e[16]=f,e[17]=p,e[18]=g,e[19]=d,e[20]=m):m=e[20],m});kg.displayName="ForwardRef(Badge)";const dx=G(me).withConfig({displayName:"StyledFlex",componentId:"sc-oxesg3-0"})(bg,i2),St=C.forwardRef(function(i,t){const e=ce.c(27);let n,r,s,o,a,l,u;e[0]!==i?({align:n,as:r,direction:l,gap:s,justify:o,wrap:u,...a}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7]);const c=l===void 0?"row":l;let h;e[8]!==n?(h=K(n),e[8]=n,e[9]=h):h=e[9];let d;e[10]!==c?(d=K(c),e[10]=c,e[11]=d):d=e[11];let f;e[12]!==s?(f=K(s),e[12]=s,e[13]=f):f=e[13];let p;e[14]!==o?(p=K(o),e[14]=o,e[15]=p):p=e[15];let g;e[16]!==u?(g=K(u),e[16]=u,e[17]=g):g=e[17];let m;return e[18]!==r||e[19]!==t||e[20]!==a||e[21]!==h||e[22]!==d||e[23]!==f||e[24]!==p||e[25]!==g?(m=y.jsx(dx,{"data-ui":"Flex",...a,$align:h,$direction:d,$gap:f,$justify:p,$wrap:g,forwardedAs:r,ref:t}),e[18]=r,e[19]=t,e[20]=a,e[21]=h,e[22]=d,e[23]=f,e[24]=p,e[25]=g,e[26]=m):m=e[26],m});St.displayName="ForwardRef(Flex)";const fx=Yu`
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
`,px=G(et).withConfig({displayName:"StyledSpinner",componentId:"sc-124hnd0-0"})`& > span > svg{animation:${fx} 500ms linear infinite;}`,ih=C.forwardRef(function(i,t){const e=ce.c(4);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=y.jsx(Vp,{}),e[0]=n):n=e[0];let r;return e[1]!==i||e[2]!==t?(r=y.jsx(px,{"data-ui":"Spinner",...i,ref:t,children:n}),e[1]=i,e[2]=t,e[3]=r):r=e[3],r});ih.displayName="ForwardRef(Spinner)";function at(i,t,e=!1){return{"--card-backdrop-color":i.backdrop,"--card-focus-ring-color":i.focusRing,"--card-shadow-outline-color":i.shadow.outline,"--card-shadow-umbra-color":i.shadow.umbra,"--card-shadow-penumbra-color":i.shadow.penumbra,"--card-shadow-ambient-color":i.shadow.ambient,"--card-accent-fg-color":t.accent.fg,"--card-avatar-gray-bg-color":t.avatar.gray.bg,"--card-avatar-gray-fg-color":t.avatar.gray.fg,"--card-avatar-blue-bg-color":t.avatar.blue.bg,"--card-avatar-blue-fg-color":t.avatar.blue.fg,"--card-avatar-purple-bg-color":t.avatar.purple.bg,"--card-avatar-purple-fg-color":t.avatar.purple.fg,"--card-avatar-magenta-bg-color":t.avatar.magenta.bg,"--card-avatar-magenta-fg-color":t.avatar.magenta.fg,"--card-avatar-red-bg-color":t.avatar.red.bg,"--card-avatar-red-fg-color":t.avatar.red.fg,"--card-avatar-orange-bg-color":t.avatar.orange.bg,"--card-avatar-orange-fg-color":t.avatar.orange.fg,"--card-avatar-yellow-bg-color":t.avatar.yellow.bg,"--card-avatar-yellow-fg-color":t.avatar.yellow.fg,"--card-avatar-green-bg-color":t.avatar.green.bg,"--card-avatar-green-fg-color":t.avatar.green.fg,"--card-avatar-cyan-bg-color":t.avatar.cyan.bg,"--card-avatar-cyan-fg-color":t.avatar.cyan.fg,"--card-bg-color":t.bg,"--card-bg-image":e?`repeating-conic-gradient(${t.bg} 0% 25%, ${t.muted.bg} 0% 50%)`:void 0,"--card-border-color":t.border,"--card-badge-default-bg-color":t.badge.default.bg,"--card-badge-default-dot-color":t.badge.default.dot,"--card-badge-default-fg-color":t.badge.default.fg,"--card-badge-default-icon-color":t.badge.default.icon,"--card-badge-neutral-bg-color":t.badge.neutral?.bg,"--card-badge-neutral-dot-color":t.badge.neutral?.dot,"--card-badge-neutral-fg-color":t.badge.neutral?.fg,"--card-badge-neutral-icon-color":t.badge.neutral?.icon,"--card-badge-primary-bg-color":t.badge.primary.bg,"--card-badge-primary-dot-color":t.badge.primary.dot,"--card-badge-primary-fg-color":t.badge.primary.fg,"--card-badge-primary-icon-color":t.badge.primary.icon,"--card-badge-suggest-bg-color":t.badge.suggest?.bg,"--card-badge-suggest-dot-color":t.badge.suggest?.dot,"--card-badge-suggest-fg-color":t.badge.suggest?.fg,"--card-badge-suggest-icon-color":t.badge.suggest?.icon,"--card-badge-positive-bg-color":t.badge.positive.bg,"--card-badge-positive-dot-color":t.badge.positive.dot,"--card-badge-positive-fg-color":t.badge.positive.fg,"--card-badge-positive-icon-color":t.badge.positive.icon,"--card-badge-caution-bg-color":t.badge.caution.bg,"--card-badge-caution-dot-color":t.badge.caution.dot,"--card-badge-caution-fg-color":t.badge.caution.fg,"--card-badge-caution-icon-color":t.badge.caution.icon,"--card-badge-critical-bg-color":t.badge.critical.bg,"--card-badge-critical-dot-color":t.badge.critical.dot,"--card-badge-critical-fg-color":t.badge.critical.fg,"--card-badge-critical-icon-color":t.badge.critical.icon,"--card-code-bg-color":t.code.bg,"--card-code-fg-color":t.code.fg,"--card-fg-color":t.fg,"--card-icon-color":t.icon,"--card-kbd-bg-color":t.kbd.bg,"--card-kbd-border-color":t.kbd.border,"--card-kbd-fg-color":t.kbd.fg,"--card-link-fg-color":t.link.fg,"--card-muted-bg-color":t.muted.bg,"--card-muted-fg-color":t.muted.fg,"--card-skeleton-color-from":t.skeleton.from,"--card-skeleton-color-to":t.skeleton.to,"--card-bg2-color":t.muted.bg,"--card-link-color":t.link.fg,"--card-hairline-soft-color":t.border,"--card-hairline-hard-color":t.border}}function gx(i){const{$width:t}=i,{style:e}=fe(i.theme);return Re`
    ${e?.button};

    -webkit-font-smoothing: inherit;
    appearance: none;
    display: inline-flex;
    align-items: center;
    font: inherit;
    border: 0;
    outline: none;
    user-select: none;
    text-decoration: none;
    border: 0;
    box-sizing: border-box;
    padding: 0;
    margin: 0;
    white-space: nowrap;
    text-align: left;
    position: relative;
    vertical-align: top;

    ${t==="fill"&&Re`
      width: -moz-available;
      width: -webkit-fill-available;
      width: stretch;
    `}

    & > span {
      display: block;
      flex: 1;
      min-width: 0;
      border-radius: inherit;
    }

    &::-moz-focus-inner {
      border: 0;
      padding: 0;
    }
  `}function gd(...i){return i.filter(Boolean).join(",")}function mx(i){const{$mode:t}=i,{button:e,color:n,style:r}=fe(i.theme),s=i.$mode==="ghost",o=n.button[t]||n.button.default,a=o[i.$tone]||o.default,l={width:e.border.width,color:"var(--card-border-color)"},u=void 0;return[at(n,a.enabled),{backgroundColor:"var(--card-bg-color)",color:"var(--card-fg-color)",boxShadow:wt(l),'&:disabled, &[data-disabled="true"]':at(n,a.disabled),"&:not([data-disabled='true'])":{boxShadow:gd(wt(l),s?u:void 0),"&:focus":{boxShadow:ln({base:n,border:{width:2,color:n.bg},focusRing:e.focusRing})},"&:focus:not(:focus-visible)":{boxShadow:gd(wt(l),s?u:void 0)},"@media (hover: hover)":{"&:hover":at(n,a.hovered),"&:active":at(n,a.pressed),"&[data-hovered]":at(n,a.hovered)},"&[data-selected]":at(n,a.pressed)}},r?.button?.root].filter(Boolean)}const Ox=G.button.withConfig({displayName:"StyledButton",componentId:"sc-aaekt4-0"})(or,gx,mx),bx=G.div.withConfig({displayName:"LoadingBox",componentId:"sc-aaekt4-1"})`position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background-color:var(--card-bg-color);border-radius:inherit;z-index:1;box-shadow:inherit;`,wi=C.forwardRef(function(i,t){const e=ce.c(86);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R,$,k,A,P;e[0]!==i?({children:s,disabled:o,fontSize:m,icon:n,iconRight:r,justify:O,loading:a,mode:b,padding:x,paddingX:d,paddingY:f,paddingTop:h,paddingBottom:l,paddingLeft:u,paddingRight:c,radius:S,selected:g,space:w,text:$,textAlign:k,textWeight:A,tone:v,type:D,muted:R,width:P,...p}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S,e[19]=w,e[20]=v,e[21]=D,e[22]=R,e[23]=$,e[24]=k,e[25]=A,e[26]=P):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18],w=e[19],v=e[20],D=e[21],R=e[22],$=e[23],k=e[24],A=e[25],P=e[26]);const Q=m===void 0?1:m,M=O===void 0?"center":O,B=b===void 0?"default":b,W=x===void 0?3:x,X=S===void 0?2:S,F=w===void 0?3:w,_=v===void 0?"default":v,j=D===void 0?"button":D,q=R===void 0?!1:R,{button:E}=sr();let Z;e[27]!==M?(Z=K(M),e[27]=M,e[28]=Z):Z=e[28];const L=Z;let Y;e[29]!==W?(Y=K(W),e[29]=W,e[30]=Y):Y=e[30];const N=Y;let z;e[31]!==d?(z=K(d),e[31]=d,e[32]=z):z=e[32];const I=z;let V;e[33]!==f?(V=K(f),e[33]=f,e[34]=V):V=e[34];const J=V;let re;e[35]!==h?(re=K(h),e[35]=h,e[36]=re):re=e[36];const ee=re;let se;e[37]!==l?(se=K(l),e[37]=l,e[38]=se):se=e[38];const Oe=se;let be;e[39]!==u?(be=K(u),e[39]=u,e[40]=be):be=e[40];const ne=be;let ke;e[41]!==c?(ke=K(c),e[41]=c,e[42]=ke):ke=e[42];const Qe=ke;let Pe;e[43]!==X?(Pe=K(X),e[43]=X,e[44]=Pe):Pe=e[44];const ye=Pe;let we;e[45]!==F?(we=K(F),e[45]=F,e[46]=we):we=e[46];const Ce=we;let Ee;e[47]!==N||e[48]!==Oe||e[49]!==ne||e[50]!==Qe||e[51]!==ee||e[52]!==I||e[53]!==J?(Ee={padding:N,paddingX:I,paddingY:J,paddingTop:ee,paddingBottom:Oe,paddingLeft:ne,paddingRight:Qe},e[47]=N,e[48]=Oe,e[49]=ne,e[50]=Qe,e[51]=ee,e[52]=I,e[53]=J,e[54]=Ee):Ee=e[54];const De=Ee,xe=!!(a||o),ue=g?"":void 0,ve=!!(a||o);let Be;e[55]!==a?(Be=!!a&&y.jsx(bx,{children:y.jsx(ih,{})}),e[55]=a,e[56]=Be):Be=e[56];let je;e[57]!==n||e[58]!==r||e[59]!==De||e[60]!==E||e[61]!==Q||e[62]!==L||e[63]!==q||e[64]!==Ce||e[65]!==$||e[66]!==k||e[67]!==A?(je=(n||$||r)&&y.jsx(me,{as:"span",...De,children:y.jsxs(St,{as:"span",justify:L,gap:Ce,children:[n&&y.jsxs(et,{size:Q,children:[C.isValidElement(n)&&n,Dr.isValidElementType(n)&&y.jsx(n,{})]}),$&&y.jsx(me,{children:y.jsx(et,{muted:q,align:k,size:Q,textOverflow:"ellipsis",weight:A??E.textWeight,children:$})}),r&&y.jsxs(et,{size:Q,children:[C.isValidElement(r)&&r,Dr.isValidElementType(r)&&y.jsx(r,{})]})]})}),e[57]=n,e[58]=r,e[59]=De,e[60]=E,e[61]=Q,e[62]=L,e[63]=q,e[64]=Ce,e[65]=$,e[66]=k,e[67]=A,e[68]=je):je=e[68];let Le;e[69]!==De||e[70]!==s?(Le=s&&y.jsx(me,{as:"span",...De,children:s}),e[69]=De,e[70]=s,e[71]=Le):Le=e[71];let Xe;return e[72]!==B||e[73]!==ye||e[74]!==t||e[75]!==p||e[76]!==xe||e[77]!==ue||e[78]!==ve||e[79]!==Be||e[80]!==je||e[81]!==Le||e[82]!==_||e[83]!==j||e[84]!==P?(Xe=y.jsxs(Ox,{"data-ui":"Button",...p,$mode:B,$radius:ye,$tone:_,"data-disabled":xe,"data-selected":ue,disabled:ve,ref:t,type:j,$width:P,children:[Be,je,Le]}),e[72]=B,e[73]=ye,e[74]=t,e[75]=p,e[76]=xe,e[77]=ue,e[78]=ve,e[79]=Be,e[80]=je,e[81]=Le,e[82]=_,e[83]=j,e[84]=P,e[85]=Xe):Xe=e[85],Xe});wi.displayName="ForwardRef(Button)";function yx(i){return[xx(i),wx(i)]}function xx(i){const{$checkered:t}=i,{space:e}=fe(i.theme);return Re`
    ${t&&Re`
      background-size: ${e[3]}px ${e[3]}px;
      background-position: 50% 50%;
      background-image: var(--card-bg-image);
    `}

    &[data-as='button'] {
      -webkit-font-smoothing: inherit;
      appearance: none;
      outline: none;
      font: inherit;
      text-align: inherit;
      border: 0;
      width: -moz-available;
      width: -webkit-fill-available;
      width: stretch;
    }

    /* &:is(a) */
    &[data-as='a'] {
      outline: none;
      text-decoration: none;
    }

    /* &:is(pre) */
    &[data-as='pre'] {
      font: inherit;
    }
  `}function wx(i){const{$checkered:t,$focusRing:e,$muted:n}=i,{card:r,color:s,style:o}=fe(i.theme),a={width:r.border.width,color:"var(--card-border-color)"};return Re`
    color-scheme: ${s._dark?"dark":"light"};

    ${at(s,s,t)}

    background-color: ${n?"var(--card-muted-bg-color)":"var(--card-bg-color)"};
    color: var(--card-fg-color);

    /* &:is(button) */
    &[data-as='button'] {
      --card-focus-ring-box-shadow: none;

      cursor: default;
      box-shadow: var(--card-focus-ring-box-shadow);

      &:disabled {
        ${at(s,s.selectable.default.disabled,t)}
      }

      &:not(:disabled) {
        &[data-pressed] {
          ${at(s,s.selectable.default.pressed,t)}
        }

        &[data-selected] {
          ${at(s,s.selectable.default.selected,t)}
        }

        @media (hover: hover) {
          &:not([data-pressed]):not([data-selected]) {
            &[data-hovered],
            &:hover {
              ${at(s,s.selectable.default.hovered,t)}
            }

            &:active {
              ${at(s,s.selectable.default.pressed,t)}
            }
          }
        }

        &:focus-visible {
          --card-focus-ring-box-shadow: ${e?ln({base:s,border:a,focusRing:r.focusRing}):void 0};
        }
      }
    }

    /* &:is(a) */
    &[data-as='a'] {
      cursor: pointer;
      box-shadow: var(--card-focus-ring-box-shadow);

      &[data-disabled] {
        ${at(s,s.selectable.default.disabled,t)}
      }

      &:not([data-disabled]) {
        &[data-pressed] {
          ${at(s,s.selectable.default.pressed,t)}
        }

        &[data-selected] {
          ${at(s,s.selectable.default.selected,t)}
        }

        @media (hover: hover) {
          &:not([data-pressed]):not([data-selected]) {
            &[data-hovered],
            &:hover {
              ${at(s,s.selectable.default.hovered,t)}
            }

            &:active {
              ${at(s,s.selectable.default.pressed,t)}
            }
          }
        }

        &:focus-visible {
          --card-focus-ring-box-shadow: ${e?ln({base:s,border:a,focusRing:r.focusRing}):void 0};
        }
      }
    }

    ${o?.card?.root}
  `}const Sx=G(me).withConfig({displayName:"StyledCard",componentId:"sc-osnro2-0"})(Zy,or,R2,yx),He=C.forwardRef(function(i,t){const e=ce.c(56);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b;e[0]!==i?({__unstable_checkered:g,__unstable_focusRing:m,as:n,border:r,borderTop:l,borderRight:a,borderBottom:s,borderLeft:o,muted:u,pressed:c,radius:O,scheme:d,selected:f,shadow:p,tone:b,...h}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16]);const x=g===void 0?!1:g,S=m===void 0?!1:m,w=O===void 0?0:O,v=b===void 0?"default":b,D=Dr.isValidElementType(n)?n:"div",R=Do(),$=v==="inherit"?R.tone:v,k=typeof D=="string"?D:void 0,A=R.scheme;let P;e[17]!==r?(P=K(r),e[17]=r,e[18]=P):P=e[18];let Q;e[19]!==l?(Q=K(l),e[19]=l,e[20]=Q):Q=e[20];let M;e[21]!==a?(M=K(a),e[21]=a,e[22]=M):M=e[22];let B;e[23]!==s?(B=K(s),e[23]=s,e[24]=B):B=e[24];let W;e[25]!==o?(W=K(o),e[25]=o,e[26]=W):W=e[26];let X;e[27]!==w?(X=K(w),e[27]=w,e[28]=X):X=e[28];let F;e[29]!==p?(F=K(p),e[29]=p,e[30]=F):F=e[30];const _=x?"":void 0,j=c?"":void 0,q=f?"":void 0;let E;e[31]!==D||e[32]!==x||e[33]!==S||e[34]!==u||e[35]!==t||e[36]!==h||e[37]!==R.scheme||e[38]!==f||e[39]!==W||e[40]!==X||e[41]!==F||e[42]!==_||e[43]!==j||e[44]!==q||e[45]!==k||e[46]!==P||e[47]!==Q||e[48]!==M||e[49]!==B||e[50]!==$?(E=y.jsx(Sx,{"data-as":k,"data-scheme":A,"data-ui":"Card","data-tone":$,...h,$border:P,$borderTop:Q,$borderRight:M,$borderBottom:B,$borderLeft:W,$checkered:x,$focusRing:S,$muted:u,$radius:X,$shadow:F,$tone:$,"data-checkered":_,"data-pressed":j,"data-selected":q,forwardedAs:D,ref:t,selected:f}),e[31]=D,e[32]=x,e[33]=S,e[34]=u,e[35]=t,e[36]=h,e[37]=R.scheme,e[38]=f,e[39]=W,e[40]=X,e[41]=F,e[42]=_,e[43]=j,e[44]=q,e[45]=k,e[46]=P,e[47]=Q,e[48]=M,e[49]=B,e[50]=$,e[51]=E):E=e[51];let Z;return e[52]!==d||e[53]!==E||e[54]!==$?(Z=y.jsx(Og,{scheme:d,tone:$,children:E}),e[52]=d,e[53]=E,e[54]=$,e[55]=Z):Z=e[55],Z});He.displayName="ForwardRef(Card)";function dl(i,t,e){const n=ce.c(9),r=t===void 0?vx:t;let s;n[0]!==e||n[1]!==r||n[2]!==i?(s=c=>{if(!i)return;const h=c.target;if(!(h instanceof Node))return;const d=r().flat();for(const f of d)if(f&&(h===f||f.contains(h)))return;i(c)},n[0]=e,n[1]=r,n[2]=i,n[3]=s):s=n[3];const o=ul(s),a=!!i;let l;n[4]!==a||n[5]!==o?(l=()=>{if(!a)return;const c=h=>o(h);return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},n[4]=a,n[5]=o,n[6]=l):l=n[6];let u;n[7]!==a?(u=[a],n[7]=a,n[8]=u):u=n[8],C.useEffect(l,u),C.useDebugValue(i?"MouseDown On":"MouseDown Off")}function vx(){return Co}function $o(i,t){const e=ce.c(4);let n,r;e[0]!==t||e[1]!==i?(n=()=>{i.current?.setCustomValidity(t||"")},r=[t,i],e[0]=t,e[1]=i,e[2]=n,e[3]=r):(n=e[2],r=e[3]),C.useEffect(n,r)}const Cg=typeof document<"u"&&typeof window<"u"&&window.ResizeObserver?window.ResizeObserver:_1,kx=Dx();function Cx(){return{subscribe(i,t){const e=new Cg(([n])=>{t({_contentRect:n.contentRect,border:{width:n.borderBoxSize[0].inlineSize,height:n.borderBoxSize[0].blockSize},content:{width:n.contentRect.width,height:n.contentRect.height}})});return e.observe(i),()=>{e.unobserve(i),e.disconnect()}}}}function Dx(){const i=new WeakMap,t=new WeakMap;return{subscribe(e,n){const r=t.get(e)||[];let s=i.get(e);return t.has(e)||(t.set(e,r),s=Cx().subscribe(e,o=>{for(const a of r)a(o)})),r.push(n),()=>{const o=r.indexOf(n);o>-1&&r.splice(o,1),r.length===0&&s&&s()}}}}function Dg(i){const t=ce.c(3),[e,n]=C.useState(null);let r,s;return t[0]!==i?(r=()=>{if(i)return kx.subscribe(i,n)},s=[i],t[0]=i,t[1]=r,t[2]=s):(r=t[1],s=t[2]),C.useEffect(r,s),e}function $g(i,t){const e=ce.c(7);let n;e[0]!==i?(n=a=>i(a),e[0]=i,e[1]=n):n=e[1];const r=ul(n);let s;e[2]!==r||e[3]!==t?(s=()=>{const a=l=>r(l);return window.addEventListener("keydown",a,t),()=>window.removeEventListener("keydown",a,t)},e[2]=r,e[3]=t,e[4]=s):s=e[4];let o;e[5]!==t?(o=[t],e[5]=t,e[6]=o):o=e[6],C.useEffect(s,o)}function $x(i,t){const e=ce.c(4);C.useDebugValue(i);let n;e[0]!==i?(n=s=>{const o=window.matchMedia(i);return o.addEventListener("change",s),()=>o.removeEventListener("change",s)},e[0]=i,e[1]=n):n=e[1];let r;return e[2]!==i?(r=()=>window.matchMedia(i).matches,e[2]=i,e[3]=r):r=e[3],C.useSyncExternalStore(n,r,t)}function Qx(i,t){return t===0?`screen and (max-width: ${i[t]-1}px)`:t===i.length?`screen and (min-width: ${i[t-1]}px)`:`screen and (min-width: ${i[t-1]}px) and (max-width: ${i[t]-1}px)`}function Px(i){const t=i.length;let e;const n=()=>{if(!e){e=[];for(let r=t;r>-1;r-=1){const s=Qx(i,r);e.push({index:r,mq:window.matchMedia(s)})}}return e};return{getSnapshot:()=>{for(const{index:r,mq:s}of n())if(s.matches)return r;return 0},subscribe:r=>{const s=[];for(const{mq:o}of n()){const a=()=>{o.matches&&r()};o.addEventListener("change",a),s.push(()=>o.removeEventListener("change",a))}return()=>{for(const o of s)o()}}}}function Ax(){return 0}function Qg(){const i=ce.c(2),{media:t}=sr();let e;i[0]!==t?(e=Px(t),i[0]=t,i[1]=e):e=i[1];const n=e;return C.useSyncExternalStore(n.subscribe,n.getSnapshot,Ax)}function nh(i){return $x("(prefers-reduced-motion: reduce)",Ex)}function Ex(){return!1}function Tx(){return Re`
    position: relative;
    display: inline-block;
  `}function Rx(i){const{color:t,input:e,radius:n}=fe(i.theme),{focusRing:r}=e.checkbox;return Re`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    outline: none;
    opacity: 0;
    z-index: 1;
    padding: 0;
    margin: 0;

    & + span {
      position: relative;
      display: block;
      height: ${he(e.checkbox.size)};
      width: ${he(e.checkbox.size)};
      box-sizing: border-box;
      box-shadow: ${wt({color:t.input.default.enabled.border,width:e.border.width})};
      border-radius: ${he(n[2])};
      line-height: 1;
      background-color: ${t.input.default.enabled.bg};

      & > svg {
        display: block;
        position: absolute;
        opacity: 0;
        height: 100%;
        width: 100%;

        & > path {
          vector-effect: non-scaling-stroke;
          stroke-width: 1.5px !important;
        }
      }
    }

    &:checked + span {
      background: ${t.input.default.enabled.fg};
      box-shadow: ${wt({color:t.input.default.enabled.fg,width:e.border.width})};
      color: ${t.input.default.enabled.bg};
    }

    /* focus */
    &:not(:disabled):focus:focus-visible + span {
      box-shadow: ${ln({focusRing:r})};
    }

    /* focus when checked - uses a different offset */
    &:not(:disabled):focus:focus-visible&:checked + span {
      box-shadow: ${ln({focusRing:{width:1,offset:1}})};
    }

    &[data-error] + span {
      background-color: ${t.input.invalid.enabled.border};
      box-shadow: ${wt({width:e.border.width,color:t.input.invalid.enabled.muted.bg})};
      color: ${t.input.default.disabled.fg};
    }
    &[data-error]&:checked + span {
      background-color: ${t.input.invalid.enabled.muted.bg};
      color: ${t.input.default.enabled.bg};
    }
    &[data-error]&:checked&:not(:disabled):focus:focus-visible + span {
      box-shadow: ${ln({border:{width:e.border.width,color:t.input.invalid.readOnly.muted.bg},focusRing:{width:1,offset:1}})};
    }

    &:disabled + span {
      background-color: ${t.input.default.disabled.bg};
      box-shadow: ${wt({width:e.border.width,color:t.input.default.disabled.border})};
      color: ${t.input.default.disabled.fg};
    }
    &:disabled&:checked + span {
      background-color: ${t.input.default.disabled.muted.bg};
    }

    &[data-read-only] + span {
      background-color: ${t.input.default.readOnly.bg};
      box-shadow: ${wt({width:e.border.width,color:t.input.default.readOnly.border})};
      color: ${t.input.default.readOnly.fg};
    }

    &[data-read-only]&:checked + span {
      background-color: ${t.input.default.readOnly.muted.bg};
    }

    &:checked + span > svg:first-child {
      opacity: 1;
    }
    &:indeterminate + span > svg:last-child {
      opacity: 1;
    }
  `}const _x=G.div.withConfig({displayName:"StyledCheckbox",componentId:"sc-1l5mt2l-0"})(Tx),Mx=G.input.withConfig({displayName:"Input",componentId:"sc-1l5mt2l-1"})(Rx),Bx=C.forwardRef(function(i,t){const e=ce.c(25);let n,r,s,o,a,l,u,c;e[0]!==i?({checked:n,className:r,disabled:o,indeterminate:a,customValidity:s,readOnly:l,style:c,...u}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8]);const h=C.useRef(null);let d;e[9]===Symbol.for("react.memo_cache_sentinel")?(d=()=>h.current,e[9]=d):d=e[9],C.useImperativeHandle(t,d);let f,p;e[10]!==a?(f=()=>{h.current&&(h.current.indeterminate=a||!1)},p=[a],e[10]=a,e[11]=f,e[12]=p):(f=e[11],p=e[12]),C.useEffect(f,p),$o(h,s);const g=!o&&l?"":void 0,m=s?"":void 0,O=o||l;let b;e[13]!==n||e[14]!==l||e[15]!==u||e[16]!==g||e[17]!==m||e[18]!==O?(b=y.jsx(Mx,{"data-read-only":g,"data-error":m,...u,checked:n,disabled:O,type:"checkbox",readOnly:l,ref:h}),e[13]=n,e[14]=l,e[15]=u,e[16]=g,e[17]=m,e[18]=O,e[19]=b):b=e[19];let x;e[20]===Symbol.for("react.memo_cache_sentinel")?(x=y.jsxs("span",{children:[y.jsx(E1,{}),y.jsx(T1,{})]}),e[20]=x):x=e[20];let S;return e[21]!==r||e[22]!==c||e[23]!==b?(S=y.jsxs(_x,{className:r,"data-ui":"Checkbox",style:c,children:[b,x]}),e[21]=r,e[22]=c,e[23]=b,e[24]=S):S=e[24],S});Bx.displayName="ForwardRef(Checkbox)";function Fx({theme:i}){const{color:{syntax:t}}=fe(i);return{"&.atrule":{color:t.atrule},"&.attr-name":{color:t.attrName},"&.attr-value":{color:t.attrValue},"&.attribute":{color:t.attribute},"&.boolean":{color:t.boolean},"&.builtin":{color:t.builtin},"&.cdata":{color:t.cdata},"&.char":{color:t.char},"&.class":{color:t.class},"&.class-name":{color:t.className},"&.comment":{color:t.comment},"&.constant":{color:t.constant},"&.deleted":{color:t.deleted},"&.doctype":{color:t.doctype},"&.entity":{color:t.entity},"&.function":{color:t.function},"&.hexcode":{color:t.hexcode},"&.id":{color:t.id},"&.important":{color:t.important},"&.inserted":{color:t.inserted},"&.keyword":{color:t.keyword},"&.number":{color:t.number},"&.operator":{color:t.operator},"&.prolog":{color:t.prolog},"&.property":{color:t.property},"&.pseudo-class":{color:t.pseudoClass},"&.pseudo-element":{color:t.pseudoElement},"&.punctuation":{color:t.punctuation},"&.regex":{color:t.regex},"&.selector":{color:t.selector},"&.string":{color:t.string},"&.symbol":{color:t.symbol},"&.tag":{color:t.tag},"&.unit":{color:t.unit},"&.url":{color:t.url},"&.variable":{color:t.variable}}}function Zx(){return Re`
    color: var(--card-code-fg-color);

    & code {
      font-family: inherit;

      &.refractor .token {
        ${Fx}
      }
    }

    & a {
      color: inherit;
      text-decoration: underline;
      border-radius: 1px;
    }

    & svg {
      /* Certain popular CSS libraries changes the defaults for SVG display */
      /* Make sure SVGs are rendered as inline elements */
      display: inline;
    }

    & [data-sanity-icon] {
      vertical-align: baseline;
    }
  `}const zx=C.lazy(()=>A1(()=>import("./refractor-Bm_vMXvg.js"),__vite__mapDeps([0,1]))),jx=G.pre.withConfig({displayName:"StyledCode",componentId:"sc-4dymyn-0"})(Zx,Ty),Qo=C.forwardRef(function(i,t){const e=ce.c(22);let n,r,s,o,a;e[0]!==i?({children:n,language:r,size:o,weight:a,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5]);const l=o===void 0?2:o;let u;e[6]!==l?(u=K(l),e[6]=l,e[7]=u):u=e[7];let c;e[8]!==n?(c=y.jsx("code",{children:n}),e[8]=n,e[9]=c):c=e[9];let h;e[10]!==n||e[11]!==r?(h=y.jsx(zx,{language:r,value:n}),e[10]=n,e[11]=r,e[12]=h):h=e[12];let d;e[13]!==c||e[14]!==h?(d=y.jsx(C.Suspense,{fallback:c,children:h}),e[13]=c,e[14]=h,e[15]=d):d=e[15];let f;return e[16]!==t||e[17]!==s||e[18]!==u||e[19]!==d||e[20]!==a?(f=y.jsx(jx,{"data-ui":"Code",...s,$size:u,$weight:a,ref:t,children:d}),e[16]=t,e[17]=s,e[18]=u,e[19]=d,e[20]=a,e[21]=f):f=e[21],f});Qo.displayName="ForwardRef(Code)";const Ix={width:"100%",margin:"0 auto"};function Lx(){return Ix}function Xx(i){const{container:t,media:e}=fe(i.theme);return Me(e,i.$width,n=>({maxWidth:n==="auto"?"none":he(t[n])}))}const Nx=G(me).withConfig({displayName:"StyledContainer",componentId:"sc-wyroop-0"})(Lx,Xx),rh=C.forwardRef(function(i,t){const e=ce.c(11);let n,r,s;e[0]!==i?({as:n,width:s,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s):(n=e[1],r=e[2],s=e[3]);const o=s===void 0?2:s;let a;e[4]!==o?(a=K(o),e[4]=o,e[5]=a):a=e[5];let l;return e[6]!==n||e[7]!==t||e[8]!==r||e[9]!==a?(l=y.jsx(Nx,{"data-ui":"Container",...r,$width:a,forwardedAs:n,ref:t}),e[6]=n,e[7]=t,e[8]=r,e[9]=a,e[10]=l):l=e[10],l});rh.displayName="ForwardRef(Container)";const Wx=G(me).withConfig({displayName:"StyledGrid",componentId:"sc-v8t8oz-0"})(x2),sh=C.forwardRef(function(i,t){const e=ce.c(42);let n,r,s,o,a,l,u,c,h,d,f;e[0]!==i?({as:n,autoRows:o,autoCols:r,autoFlow:s,columns:l,gap:u,gapX:c,gapY:h,rows:f,children:a,...d}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11]);const p=typeof n=="string"?n:void 0;let g;e[12]!==o?(g=K(o),e[12]=o,e[13]=g):g=e[13];let m;e[14]!==r?(m=K(r),e[14]=r,e[15]=m):m=e[15];let O;e[16]!==s?(O=K(s),e[16]=s,e[17]=O):O=e[17];let b;e[18]!==l?(b=K(l),e[18]=l,e[19]=b):b=e[19];let x;e[20]!==u?(x=K(u),e[20]=u,e[21]=x):x=e[21];let S;e[22]!==c?(S=K(c),e[22]=c,e[23]=S):S=e[23];let w;e[24]!==h?(w=K(h),e[24]=h,e[25]=w):w=e[25];let v;e[26]!==f?(v=K(f),e[26]=f,e[27]=v):v=e[27];let D;return e[28]!==n||e[29]!==a||e[30]!==t||e[31]!==d||e[32]!==p||e[33]!==g||e[34]!==m||e[35]!==O||e[36]!==b||e[37]!==x||e[38]!==S||e[39]!==w||e[40]!==v?(D=y.jsx(Wx,{"data-as":p,"data-ui":"Grid",...d,$autoRows:g,$autoCols:m,$autoFlow:O,$columns:b,$gap:x,$gapX:S,$gapY:w,$rows:v,forwardedAs:n,ref:t,children:a}),e[28]=n,e[29]=a,e[30]=t,e[31]=d,e[32]=p,e[33]=g,e[34]=m,e[35]=O,e[36]=b,e[37]=x,e[38]=S,e[39]=w,e[40]=v,e[41]=D):D=e[41],D});sh.displayName="ForwardRef(Grid)";function Yx(i){const{$accent:t,$muted:e}=i,{font:n}=fe(i.theme);return Re`
    ${t&&Re`
      color: var(--card-accent-fg-color);
    `}

    ${e&&Re`
      color: var(--card-muted-fg-color);
    `}

    & code {
      font-family: ${n.code.family};
      border-radius: 1px;
    }

    & a {
      text-decoration: none;
      border-radius: 1px;
      color: var(--card-link-color);
      outline: none;

      @media (hover: hover) {
        &:hover {
          text-decoration: underline;
        }
      }

      &:focus {
        box-shadow:
          0 0 0 1px var(--card-bg-color),
          0 0 0 3px var(--card-focus-ring-color);
      }

      &:focus:not(:focus-visible) {
        box-shadow: none;
      }
    }

    & strong {
      font-weight: ${n.heading.weights.bold};
    }

    & svg {
      /* Certain popular CSS libraries changes the defaults for SVG display */
      /* Make sure SVGs are rendered as inline elements */
      display: inline;
    }

    & [data-sanity-icon] {
      vertical-align: baseline;
    }
  `}const qx=G.div.withConfig({displayName:"StyledHeading",componentId:"sc-137lwim-0"})(Yx,Ju,Ry),Pg=C.forwardRef(function(i,t){const e=ce.c(26);let n,r,s,o,a,l,u,c;e[0]!==i?({accent:o,align:n,children:r,muted:a,size:l,textOverflow:u,weight:c,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8]);const h=o===void 0?!1:o,d=a===void 0?!1:a,f=l===void 0?2:l;let p=r;if(u==="ellipsis"){let x;e[9]!==p?(x=y.jsx(th,{children:p}),e[9]=p,e[10]=x):x=e[10],p=x}let g;e[11]!==n?(g=K(n),e[11]=n,e[12]=g):g=e[12];let m;e[13]!==f?(m=K(f),e[13]=f,e[14]=m):m=e[14];let O;e[15]!==p?(O=y.jsx("span",{children:p}),e[15]=p,e[16]=O):O=e[16];let b;return e[17]!==h||e[18]!==d||e[19]!==t||e[20]!==s||e[21]!==g||e[22]!==m||e[23]!==O||e[24]!==c?(b=y.jsx(qx,{"data-ui":"Heading",...s,$accent:h,$align:g,$muted:d,$size:m,$weight:c,ref:t,children:O}),e[17]=h,e[18]=d,e[19]=t,e[20]=s,e[21]=g,e[22]=m,e[23]=O,e[24]=c,e[25]=b):b=e[25],b});Pg.displayName="ForwardRef(Heading)";function Vx(){return{lineHeight:"0","&&:not([hidden])":{display:"block"},"& > div":{display:"inline-block",verticalAlign:"middle"}}}function Gx(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$space,n=>{const r=he(n===.5?e[1]/2:e[n]);return{margin:`-${r} 0 0 -${r}`,"& > div":{padding:`${r} 0 0 ${r}`}}})}const Ux=G(me).withConfig({displayName:"StyledInline",componentId:"sc-1pkiy6j-0"})(Vx,Gx),Po=C.forwardRef(function(i,t){const e=ce.c(15);let n,r,s,o;e[0]!==i?({as:n,children:r,space:o,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o):(n=e[1],r=e[2],s=e[3],o=e[4]);let a;e[5]!==r?(a=C.Children.map(r,Hx),e[5]=r,e[6]=a):a=e[6];const l=a;let u;e[7]!==o?(u=K(o),e[7]=o,e[8]=u):u=e[8];const c=t;let h;return e[9]!==n||e[10]!==l||e[11]!==s||e[12]!==u||e[13]!==c?(h=y.jsx(Ux,{"data-ui":"Inline",...s,$space:u,forwardedAs:n,ref:c,children:l}),e[9]=n,e[10]=l,e[11]=s,e[12]=u,e[13]=c,e[14]=h):h=e[14],h});Po.displayName="ForwardRef(Inline)";function Hx(i){return i&&y.jsx("div",{children:i})}function Kx(){return Re`
    --card-bg-color: var(--card-kbd-bg-color);
    --card-border-color: var(--card-kbd-border-color);
    --card-fg-color: var(--card-kbd-fg-color);

    box-shadow: inset 0 0 0 1px var(--card-border-color);
    background: var(--card-bg-color);
    font: inherit;

    vertical-align: top;

    &:not([hidden]) {
      display: inline-block;
    }
  `}const Jx=G.kbd.withConfig({displayName:"StyledKBD",componentId:"sc-1w7yd8w-0"})(or,Kx),Ag=C.forwardRef(function(i,t){const e=ce.c(19);let n,r,s,o,a;e[0]!==i?({children:n,fontSize:s,padding:o,radius:a,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5]);const l=s===void 0?0:s,u=o===void 0?1:o,c=a===void 0?2:a;let h;e[6]!==c?(h=K(c),e[6]=c,e[7]=h):h=e[7];let d;e[8]!==n||e[9]!==l?(d=y.jsx(et,{as:"span",size:l,weight:"semibold",children:n}),e[8]=n,e[9]=l,e[10]=d):d=e[10];let f;e[11]!==u||e[12]!==d?(f=y.jsx(me,{as:"span",padding:u,children:d}),e[11]=u,e[12]=d,e[13]=f):f=e[13];let p;return e[14]!==t||e[15]!==r||e[16]!==h||e[17]!==f?(p=y.jsx(Jx,{"data-ui":"KBD",...r,$radius:h,ref:t,children:f}),e[14]=t,e[15]=r,e[16]=h,e[17]=f,e[18]=p):p=e[18],p});Ag.displayName="ForwardRef(KBD)";const Eg={name:"@sanity/ui/origin",fn({middlewareData:i,placement:t,rects:e}){const[n]=t.split("-"),r=e.floating.width,s=e.floating.height,o=i.shift?.x||0,a=i.shift?.y||0;if(r<=0||s<=0)return{};const l=["bottom","top"].includes(n),{originX:u,originY:c}=l?{originX:md(.5-o/r,0,1),originY:n==="bottom"?0:1}:{originX:n==="left"?1:0,originY:md(.5-a/s,0,1)};return{data:{originX:u,originY:c}}}};function md(i,t,e){return Math.min(Math.max(i,t),e)}function Od(i,t,e){const n=t.x-i.x,r=t.y-i.y,s=Math.sqrt(n*n+r*r);return Fc(i,t,Math.min(1,e/s))}function Fc(i,t,e){return{x:i.x+(t.x-i.x)*e,y:i.y+(t.y-i.y)*e}}function ew(i){const t=i.length,e=[];for(let n=0;n<t;n+=1){const r=i[n],s=i[n-1],o=i[n+1];if(s&&r.radius){const a=Od(r,s,r.radius),l=Od(r,o,r.radius),u=Fc(a,r,.5),c=Fc(r,l,.5);e.push({type:"point",...a}),e.push({type:"curve",curveEnd:l,startControl:u,endControl:c})}else e.push({type:"point",...r})}return e}function tw(i){return i.map((t,e)=>t.type==="point"?`${e===0?"M":"L"} ${t.x} ${t.y}`:t.type==="curve"?`C ${t.startControl.x} ${t.startControl.y} ${t.endControl.x} ${t.endControl.y} ${t.curveEnd.x} ${t.curveEnd.y}`:"").join(" ")}const iw=G.div.withConfig({displayName:"StyledArrow",componentId:"sc-12vzy6c-0"})(({$w:i})=>Re`
    position: absolute;
    width: ${i}px;
    height: ${i}px;

    :empty + & {
      display: none;
    }

    & > svg {
      display: block;
      line-height: 0;
      transform-origin: ${i/2}px ${i/2}px;
    }

    [data-placement^='top'] > & {
      bottom: -${i}px;

      & > svg {
        transform: rotate(0);
      }
    }

    [data-placement^='right'] > & {
      left: -${i}px;

      & > svg {
        transform: rotate(90deg);
      }
    }

    [data-placement^='left'] > & {
      right: -${i}px;

      & > svg {
        transform: rotate(-90deg);
      }
    }

    [data-placement^='bottom'] > & {
      top: -${i}px;

      & > svg {
        transform: rotate(180deg);
      }
    }
  `),nw=G.path.withConfig({displayName:"StrokePath",componentId:"sc-12vzy6c-1"})`stroke:var(--card-shadow-outline-color);`,rw=G.path.withConfig({displayName:"ShapePath",componentId:"sc-12vzy6c-2"})`fill:var(--card-bg-color);`,oh=C.forwardRef(function(i,t){const e=ce.c(29);let n,r,s,o;e[0]!==i?({width:o,height:n,radius:s,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o):(n=e[1],r=e[2],s=e[3],o=e[4]);const a=s===void 0?0:s,{card:l}=sr(),u=l.shadow.outline,c=o/2;let h;if(e[5]!==c||e[6]!==n||e[7]!==a||e[8]!==o){const v=[{x:0,y:0},{x:a,y:0,radius:a},{x:c,y:n-1,radius:a},{x:o-a,y:0,radius:a},{x:o,y:0}],D=ew(v);h=tw(D),e[5]=c,e[6]=n,e[7]=a,e[8]=o,e[9]=h}else h=e[9];const d=h,f=`${d}`,p=`${d} M ${o} -1 M 0 -1 Z`,g=`0 0 ${o} ${o}`;let m;e[10]!==u||e[11]!==o?(m=y.jsx("mask",{id:"stroke-mask",children:y.jsx("rect",{x:0,y:u,width:o,height:o,fill:"white"})}),e[10]=u,e[11]=o,e[12]=m):m=e[12];const O=u*2;let b;e[13]!==f||e[14]!==O?(b=y.jsx(nw,{d:f,mask:"url(#stroke-mask)",strokeWidth:O}),e[13]=f,e[14]=O,e[15]=b):b=e[15];let x;e[16]!==p?(x=y.jsx(rw,{d:p}),e[16]=p,e[17]=x):x=e[17];let S;e[18]!==g||e[19]!==m||e[20]!==b||e[21]!==x||e[22]!==o?(S=y.jsxs("svg",{width:o,height:o,viewBox:g,children:[m,b,x]}),e[18]=g,e[19]=m,e[20]=b,e[21]=x,e[22]=o,e[23]=S):S=e[23];let w;return e[24]!==t||e[25]!==r||e[26]!==S||e[27]!==o?(w=y.jsx(iw,{...r,$w:o,ref:t,children:S}),e[24]=t,e[25]=r,e[26]=S,e[27]=o,e[28]=w):w=e[28],w});oh.displayName="ForwardRef(Arrow)";const sw=rr("@sanity/ui/context/boundaryElement",null);function Ao(i){return!!(i&&typeof i=="object"&&!Array.isArray(i))}const ow={version:0,element:null};function fl(){const i=C.useContext(sw);if(i&&(!Ao(i)||i.version!==0))throw new Error("useBoundaryElement(): the context value is not compatible");return i||ow}function aw(i,t){const e=[];for(let n=0;n<i.length;n+=1)i[n]>t&&e.push(n);return e}function lw(i,t){const e=[];for(let n=0;n<i.length;n+=1)i[n]<=t&&e.push(n);return e}const cw=C.forwardRef(function(i,t){const e=ce.c(18),n=sr();let r,s,o;e[0]!==i?({children:s,media:r,...o}=i,e[0]=i,e[1]=r,e[2]=s,e[3]=o):(r=e[1],s=e[2],o=e[3]);const a=r??n.media,[l,u]=C.useState(null),c=Dg(l)?.border.width??window.innerWidth;let h;if(e[4]!==a||e[5]!==c){const b=aw(a,c);h=b.length?b.join(" "):void 0,e[4]=a,e[5]=c,e[6]=h}else h=e[6];const d=h;let f;if(e[7]!==a||e[8]!==c){const b=lw(a,c);f=b.length?b.join(" "):void 0,e[7]=a,e[8]=c,e[9]=f}else f=e[9];const p=f;let g,m;e[10]!==l?(g=()=>l,m=[l],e[10]=l,e[11]=g,e[12]=m):(g=e[11],m=e[12]),C.useImperativeHandle(t,g,m);let O;return e[13]!==s||e[14]!==d||e[15]!==p||e[16]!==o?(O=y.jsx("div",{"data-ui":"ElementQuery",...o,"data-eq-max":d,"data-eq-min":p,ref:u,children:s}),e[13]=s,e[14]=d,e[15]=p,e[16]=o,e[17]=O):O=e[17],O});cw.displayName="ForwardRef(ElementQuery)";function Tg(i){if(!Ao(i)||i.version!==0)throw new Error("the context value is not compatible");if(!i)throw new Error("components using `useLayer()` should be wrapped in a <LayerProvider>.");if(i.version===0)return i;throw new Error("could not get layer context")}const Zc=rr("@sanity/ui/context/layer",null);function ah(i){const t=ce.c(21),{children:e,zOffset:n}=i,r=n===void 0?0:n,s=C.useContext(Zc);let o;t[0]!==s?(o=s&&Tg(s),t[0]=s,t[1]=o):o=t[1];const a=o,l=a?.registerChild,u=(a?.level??0)+1;let c;t[2]!==r?(c=K(r),t[2]=r,t[3]=c):c=t[3];const h=c,d=h.length-1,f=Math.min(Qg(),d),p=a?a.zIndex+h[f]:h[f];let g;t[4]===Symbol.for("react.memo_cache_sentinel")?(g={},t[4]=g):g=t[4];const[,m]=C.useState(g),[O,b]=C.useState(0),x=O===0;let S;t[5]!==l||t[6]!==m?(S=A=>{const P=l?.(A);return A!==void 0?m(Q=>{const M=Q[A]??0,B={...Q,[A]:M+1};return b(Object.keys(B).length),B}):b(hw),()=>{A!==void 0?m(Q=>{const M={...Q};return M[A]===1?(delete M[A],b(Object.keys(M).length)):M[A]=M[A]-1,M}):b(uw),P?.()}},t[5]=l,t[6]=m,t[7]=S):S=t[7];const w=S;let v,D;t[8]!==u||t[9]!==l?(v=()=>l?.(u),D=[u,l],t[8]=u,t[9]=l,t[10]=v,t[11]=D):(v=t[10],D=t[11]),C.useEffect(v,D);let R;t[12]!==x||t[13]!==u||t[14]!==w||t[15]!==O||t[16]!==p?(R={version:0,isTopLayer:x,level:u,registerChild:w,size:O,zIndex:p},t[12]=x,t[13]=u,t[14]=w,t[15]=O,t[16]=p,t[17]=R):R=t[17];const $=R;let k;return t[18]!==e||t[19]!==$?(k=y.jsx(Zc.Provider,{value:$,children:e}),t[18]=e,t[19]=$,t[20]=k):k=t[20],k}function uw(i){return i-1}function hw(i){return i+1}ah.displayName="LayerProvider";function Eo(){const i=ce.c(2),t=C.useContext(Zc);if(!t)throw new Error("useLayer(): missing context value");try{let e;return i[0]!==t?(e=Tg(t),i[0]=t,i[1]=e):e=i[1],e}catch(e){const n=e;throw n instanceof Error?new Error(`useLayer(): ${n.message}`):new Error(`useLayer(): ${n}`)}}const dw=G.div.withConfig({displayName:"StyledLayer",componentId:"sc-16kojrv-0"})({position:"relative"}),fw=C.forwardRef(function(i,t){const e=ce.c(22);let n,r,s,o,a;e[0]!==i?({children:n,onActivate:r,onFocus:s,style:a,...o}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5]);const l=a===void 0?kr:a,{zIndex:u,isTopLayer:c}=Eo(),h=C.useRef(null),d=C.useRef(null),f=C.useRef(c);let p;e[6]===Symbol.for("react.memo_cache_sentinel")?(p=()=>d.current,e[6]=p):p=e[6],C.useImperativeHandle(t,p);let g,m;e[7]!==c||e[8]!==r?(g=()=>{f.current!==c&&c&&r?.({activeElement:h.current}),f.current=c},m=[c,r],e[7]=c,e[8]=r,e[9]=g,e[10]=m):(g=e[9],m=e[10]),C.useEffect(g,m);let O;e[11]!==c||e[12]!==s?(O=w=>{s?.(w);const v=d.current,D=document.activeElement;!c||!v||!D||nr(D)&&_c(v,D)&&(h.current=D)},e[11]=c,e[12]=s,e[13]=O):O=e[13];const b=O;let x;e[14]!==l||e[15]!==u?(x={...l,zIndex:u},e[14]=l,e[15]=u,e[16]=x):x=e[16];let S;return e[17]!==n||e[18]!==b||e[19]!==o||e[20]!==x?(S=y.jsx(dw,{...o,"data-ui":"Layer",onFocus:b,ref:d,style:x,children:n}),e[17]=n,e[18]=b,e[19]=o,e[20]=x,e[21]=S):S=e[21],S}),lh=C.forwardRef(function(i,t){const e=ce.c(11);let n,r,s;e[0]!==i?({children:n,zOffset:s,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s):(n=e[1],r=e[2],s=e[3]);const o=s===void 0?1:s;let a;e[4]!==n||e[5]!==t||e[6]!==r?(a=y.jsx(fw,{...r,ref:t,children:n}),e[4]=n,e[5]=t,e[6]=r,e[7]=a):a=e[7];let l;return e[8]!==a||e[9]!==o?(l=y.jsx(ah,{zOffset:o,children:a}),e[8]=a,e[9]=o,e[10]=l):l=e[10],l});lh.displayName="ForwardRef(Layer)";const Rg="@sanity/ui/context/portal",ns=Symbol.for(`${Rg}/element`);Wn[ns]=null;const pw={version:0,boundaryElement:null,get element(){return typeof document>"u"?null:(Wn[ns]||(Wn[ns]=document.createElement("div"),Wn[ns].setAttribute("data-portal",""),document.body.appendChild(Wn[ns])),Wn[ns])}},gw=rr(Rg,pw);function pl(){const i=C.useContext(gw);if(!i)throw new Error("usePortal(): missing context value");if(!Ao(i)||i.version!==0)throw new Error("usePortal(): the context value is not compatible");return i}function gl(i){const t=ce.c(3),{children:e,__unstable_name:n}=i,r=pl(),s=(n?r.elements&&r.elements[n]:r.element)||r.elements?.default;if(!s)return null;let o;return t[0]!==e||t[1]!==s?(o=R1.createPortal(e,s),t[0]=e,t[1]=s,t[2]=o):o=t[2],o}gl.displayName="Portal";const mw=G.div.withConfig({displayName:"StyledSrOnly",componentId:"sc-mubr0c-0"})`display:block;width:0;height:0;position:absolute;overflow:hidden;overflow:clip;`,Ow=C.forwardRef(function(i,t){const e=ce.c(4),{as:n,children:r}=i;let s;return e[0]!==n||e[1]!==r||e[2]!==t?(s=y.jsx(mw,{"aria-hidden":!0,as:n,"data-ui":"SrOnly",ref:t,children:r}),e[0]=n,e[1]=r,e[2]=t,e[3]=s):s=e[3],s});Ow.displayName="ForwardRef(SrOnly)";const bw=G.div.withConfig({displayName:"StyledVirtualList",componentId:"sc-dlqsj4-0"})`position:relative;`,bd=G.div.withConfig({displayName:"ItemWrapper",componentId:"sc-dlqsj4-1"})`position:absolute;left:0;right:0;`,yw=C.forwardRef(function(i,t){const e=ce.c(44);let n,r,s,o,a,l,u;e[0]!==i?({as:a,gap:l,getItemKey:n,items:u,onChange:r,renderItem:s,...o}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7]);const c=a===void 0?"div":a,h=l===void 0?0:l;let d;e[8]!==u?(d=u===void 0?[]:u,e[8]=u,e[9]=d):d=e[9];const f=d,{space:p}=sr(),g=C.useRef(null),m=C.useRef(null),[O,b]=C.useState(0),[x,S]=C.useState(0),[w,v]=C.useState(-1);let D;e[10]===Symbol.for("react.memo_cache_sentinel")?(D=()=>g.current,e[10]=D):D=e[10],C.useImperativeHandle(t,D);let R;e[11]===Symbol.for("react.memo_cache_sentinel")?(R=()=>{if(!m.current)return;const Z=m.current.firstChild;Z instanceof HTMLElement&&v(Z.offsetHeight)},e[11]=R):R=e[11];let $;e[12]!==s?($=[s],e[12]=s,e[13]=$):$=e[13],C.useEffect(R,$);let k,A;e[14]===Symbol.for("react.memo_cache_sentinel")?(k=()=>{if(!g.current)return;const Z=ww(g.current.parentNode);if(Z){if(!(Z instanceof HTMLElement))return;const N=()=>{b(Z.scrollTop)};Z.addEventListener("scroll",N,{passive:!0});const z=new Cg(I=>{S(I[0].contentRect.height)});return z.observe(Z),N(),()=>{Z.removeEventListener("scroll",N),z.unobserve(Z),z.disconnect()}}const L=()=>{b(window.scrollY)},Y=()=>{S(window.innerHeight)};return window.addEventListener("scroll",L,{passive:!0}),window.addEventListener("resize",Y),S(window.innerHeight),L(),()=>{window.removeEventListener("scroll",L),window.removeEventListener("resize",Y)}},A=[],e[14]=k,e[15]=A):(k=e[14],A=e[15]),C.useEffect(k,A);const P=f.length,Q=w?P*(w+p[h])-p[h]:0,M=Q?Math.max(Math.floor(O/Q*P)-2,0):0,B=Q?Math.ceil((O+x)/Q*P)+1:0;let W,X;e[16]!==M||e[17]!==h||e[18]!==w||e[19]!==r||e[20]!==x||e[21]!==O||e[22]!==p||e[23]!==B?(X=()=>{r&&r({fromIndex:M,gap:p[h],itemHeight:w,scrollHeight:x,scrollTop:O,toIndex:B})},W=[M,h,w,r,x,O,p,B],e[16]=M,e[17]=h,e[18]=w,e[19]=r,e[20]=x,e[21]=O,e[22]=p,e[23]=B,e[24]=W,e[25]=X):(W=e[24],X=e[25]),C.useEffect(X,W);let F;e[26]!==M||e[27]!==h||e[28]!==n||e[29]!==w||e[30]!==f||e[31]!==s||e[32]!==p||e[33]!==B?(F={fromIndex:M,gap:h,itemHeight:w,space:p,toIndex:B,getItemKey:n,items:f,renderItem:s},e[26]=M,e[27]=h,e[28]=n,e[29]=w,e[30]=f,e[31]=s,e[32]=p,e[33]=B,e[34]=F):F=e[34];const _=xw(F);let j;e[35]!==Q?(j={height:Q},e[35]=Q,e[36]=j):j=e[36];let q;e[37]!==_||e[38]!==j?(q=y.jsx("div",{ref:m,style:j,children:_}),e[37]=_,e[38]=j,e[39]=q):q=e[39];let E;return e[40]!==c||e[41]!==o||e[42]!==q?(E=y.jsx(bw,{as:c,"data-ui":"VirtualList",...o,ref:g,children:q}),e[40]=c,e[41]=o,e[42]=q,e[43]=E):E=e[43],E});yw.displayName="ForwardRef(VirtualList)";function xw(i){const t=ce.c(21),{fromIndex:e,gap:n,getItemKey:r,itemHeight:s,items:o,renderItem:a,space:l,toIndex:u}=i;if(!a||o.length===0)return null;if(s===-1){let h;t[0]!==o[0]||t[1]!==a?(h=a(o[0]),t[0]=o[0],t[1]=a,t[2]=h):h=t[2];let d;return t[3]!==h?(d=[y.jsx(bd,{children:h},0)],t[3]=h,t[4]=d):d=t[4],d}let c;if(t[5]!==e||t[6]!==n||t[7]!==r||t[8]!==s||t[9]!==o||t[10]!==a||t[11]!==l||t[12]!==u){let h;t[14]!==e||t[15]!==n||t[16]!==r||t[17]!==s||t[18]!==a||t[19]!==l?(h=(d,f)=>{const p=e+f,g=a(d),m=r?r(d,p):p;return y.jsx(bd,{style:{top:p*(s+l[n])},children:g},m)},t[14]=e,t[15]=n,t[16]=r,t[17]=s,t[18]=a,t[19]=l,t[20]=h):h=t[20],c=o.slice(e,u).map(h),t[5]=e,t[6]=n,t[7]=r,t[8]=s,t[9]=o,t[10]=a,t[11]=l,t[12]=u,t[13]=c}else c=t[13];return c}function ww(i){let t=i;for(;t&&!Py(t);)t=t.parentNode;return t}function _g(i){let t=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?i.ref:(t=Object.getOwnPropertyDescriptor(i,"ref")?.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?i.props.ref:i.props.ref||i.ref)}const Sw=4,rs=4,vw=19,kw=8,Cw=2,Mg=[0,0,0,0],Dw={top:["bottom","left","right"],"top-start":["bottom-start","left-start","right-start"],"top-end":["bottom-end","left-end","right-end"],bottom:["top","left","right"],"bottom-start":["top-start","left-start","right-start"],"bottom-end":["top-end","left-end","right-end"],left:["right","top","bottom"],"left-start":["right-start","top-start","bottom-start"],"left-end":["right-end","top-end","bottom-end"],right:["left","top","bottom"],"right-start":["left-start","top-start","bottom-start"],"right-end":["left-end","top-end","bottom-end"]};function $w(i){const{constrainSize:t,margins:e,matchReferenceWidth:n,maxWidthRef:r,padding:s=0,referenceWidthRef:o,setReferenceWidth:a,widthRef:l}=i;return{name:"@sanity/ui/size",async fn(u){const{elements:c,placement:h,platform:d,rects:f}=u,{floating:p,reference:g}=f,m=await F1(u,{altBoundary:!0,boundary:i.boundaryElement||void 0,elementContext:"floating",padding:s,rootBoundary:"viewport"});let O=1/0,b=1/0;const x=p.width,S=p.height;h.includes("top")&&(O=x-(m.left+m.right),b=S-m.top),h.includes("right")&&(O=x-m.right,b=S-(m.top+m.bottom)),h.includes("bottom")&&(O=x-(m.left+m.right),b=S-m.bottom),h.includes("left")&&(O=x-m.left,b=S-(m.top+m.bottom));const w=O-e[1]-e[3],v=b-e[0]-e[2],D=g.width-e[1]-e[3];o.current=D,a(D),n?c.floating.style.width=`${D}px`:l.current!==void 0&&(c.floating.style.width=`${l.current}px`),t&&(c.floating.style.maxWidth=`${Math.min(w,r.current??1/0)}px`,c.floating.style.maxHeight=`${v}px`);const R=await d.getDimensions(c.floating),$=R.height,k=R.width;return x!==k||S!==$?{reset:{rects:!0}}:{}}}}function Qw(i){const{container:t,mediaIndex:e,width:n}=i,r=n[e],s=r===void 0?n[n.length-1]:r;return typeof s=="number"?t[s]:void 0}function Pw(i){const{boundaryWidth:t,currentWidth:e}=i;if(!(e===void 0&&t===void 0))return Math.min(e??1/0,(t||1/0)-rs*2)}const Aw=G(Rr.create(He)).withConfig({displayName:"MotionCard",componentId:"sc-ihg31s-0"})`&:not([hidden]){display:flex;}flex-direction:column;width:max-content;min-width:min-content;will-change:transform;`,Ew=G(Rr.create(St)).withConfig({displayName:"MotionFlex",componentId:"sc-ihg31s-1"})`will-change:opacity;`,Bg=C.forwardRef(function(i,t){const e=ce.c(66);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R;e[0]!==i?({__unstable_margins:u,animate:n,arrow:r,arrowRef:s,arrowX:o,arrowY:a,children:l,padding:f,placement:p,originX:c,originY:h,overflow:d,radius:g,scheme:O,shadow:b,strategy:x,style:S,tone:w,width:v,x:D,y:R,...m}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S,e[19]=w,e[20]=v,e[21]=D,e[22]=R):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18],w=e[19],v=e[20],D=e[21],R=e[22]);const{zIndex:$}=Eo(),k=u||Mg,A=(D??0)+k[3],P=(R??0)+k[0],Q=n?"transform":void 0;let M;e[23]!==c||e[24]!==h||e[25]!==x||e[26]!==S||e[27]!==Q||e[28]!==v||e[29]!==A||e[30]!==P||e[31]!==$?(M={left:A,originX:c,originY:h,position:x,top:P,width:v,zIndex:$,willChange:Q,...S},e[23]=c,e[24]=h,e[25]=x,e[26]=S,e[27]=Q,e[28]=v,e[29]=A,e[30]=P,e[31]=$,e[32]=M):M=e[32];const B=M,W=o!==null?o:void 0,X=a!==null?a:void 0;let F;e[33]!==W||e[34]!==X?(F={left:W,top:X,right:void 0,bottom:void 0},e[33]=W,e[34]=X,e[35]=F):F=e[35];const _=F,j=m;let q;e[36]!==n?(q=n?["hidden","initial"]:void 0,e[36]=n,e[37]=q):q=e[37];let E;e[38]!==n?(E=n?["visible","scaleIn"]:void 0,e[38]=n,e[39]=E):E=e[39];let Z;e[40]!==n?(Z=n?["hidden","scaleOut"]:void 0,e[40]=n,e[41]=Z):Z=e[41];let L;e[42]!==l||e[43]!==f?(L=y.jsx(St,{direction:"column",flex:1,padding:f,children:l}),e[42]=l,e[43]=f,e[44]=L):L=e[44];let Y;e[45]!==d||e[46]!==L?(Y=y.jsx(Ew,{"data-ui":"Popover__wrapper",direction:"column",flex:1,overflow:d,variants:as.children,transition:as.transition,children:L}),e[45]=d,e[46]=L,e[47]=Y):Y=e[47];let N;e[48]!==r||e[49]!==s||e[50]!==_?(N=r&&y.jsx(oh,{ref:s,style:_,width:vw,height:kw,radius:Cw}),e[48]=r,e[49]=s,e[50]=_,e[51]=N):N=e[51];let z;return e[52]!==p||e[53]!==g||e[54]!==t||e[55]!==B||e[56]!==O||e[57]!==b||e[58]!==Y||e[59]!==N||e[60]!==j||e[61]!==q||e[62]!==E||e[63]!==Z||e[64]!==w?(z=y.jsxs(Aw,{"data-ui":"Popover",...j,"data-placement":p,radius:g,ref:t,scheme:O,shadow:b,sizing:"border",style:B,tone:w,variants:as.card,transition:as.transition,initial:q,animate:E,exit:Z,children:[Y,N]}),e[52]=p,e[53]=g,e[54]=t,e[55]=B,e[56]=O,e[57]=b,e[58]=Y,e[59]=N,e[60]=j,e[61]=q,e[62]=E,e[63]=Z,e[64]=w,e[65]=z):z=e[65],z});Bg.displayName="ForwardRef(PopoverCard)";const Tw=()=>{const i=ce.c(2),{zIndex:t}=Eo();let e;return i[0]!==t?(e=y.jsx("div",{style:{height:"100vh",inset:0,position:"fixed",width:"100vw",zIndex:t}}),i[0]=t,i[1]=e):e=i[1],e},To=C.forwardRef(function(i,t){const e=ce.c(126),{container:n,layer:r}=sr(),s=fl();let o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R,$,k,A,P,Q,M,B,W,X,F;if(e[0]!==i){const{__unstable_margins:it,animate:kn,arrow:Mr,boundaryElement:Ki,children:lr,constrainSize:Ji,content:en,disabled:tn,fallbackPlacements:Di,matchReferenceWidth:Wi,floatingBoundary:de,modal:Ne,onActivate:st,open:nt,overflow:Bt,padding:bi,placement:Cn,placementStrategy:cr,portal:es,preventOverflow:ur,radius:hr,referenceBoundary:dr,referenceElement:fr,scheme:pr,shadow:gr,tone:ts,width:ge,zOffset:$e,updateRef:$i,...mr}=i;v=it,D=kn,k=Mr,o=Ki,h=lr,A=Ji,d=en,f=tn,a=Di,p=Wi,l=de,g=Ne,m=nt,P=Bt,O=bi,Q=Cn,M=cr,b=es,B=ur,W=hr,u=dr,x=fr,w=pr,X=gr,R=ts,$=ge,c=$e,F=$i,S=mr,e[0]=i,e[1]=o,e[2]=a,e[3]=l,e[4]=u,e[5]=c,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=g,e[11]=m,e[12]=O,e[13]=b,e[14]=x,e[15]=S,e[16]=w,e[17]=v,e[18]=D,e[19]=R,e[20]=$,e[21]=k,e[22]=A,e[23]=P,e[24]=Q,e[25]=M,e[26]=B,e[27]=W,e[28]=X,e[29]=F}else o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7],f=e[8],p=e[9],g=e[10],m=e[11],O=e[12],b=e[13],x=e[14],S=e[15],w=e[16],v=e[17],D=e[18],R=e[19],$=e[20],k=e[21],A=e[22],P=e[23],Q=e[24],M=e[25],B=e[26],W=e[27],X=e[28],F=e[29];const _=v===void 0?Mg:v,j=D===void 0?!1:D,q=k===void 0?!1:k,E=A===void 0?!1:A,Z=P===void 0?"hidden":P,L=Q===void 0?"bottom":Q,Y=M===void 0?"flip":M,N=B===void 0?!0:B,z=W===void 0?3:W,I=X===void 0?3:X,V=R===void 0?"inherit":R,J=$===void 0?"auto":$,re=o??s?.element,ee=a??Dw[i.placement??"bottom"],se=l??i.boundaryElement??s.element,Oe=u??i.boundaryElement??s.element,be=c??r.popover.zOffset,ne=nh()?!1:j,ke=Dg(re)?.border;let Qe;e[30]!==O?(Qe=K(O),e[30]=O,e[31]=Qe):Qe=e[31];const Pe=Qe;let ye;e[32]!==z?(ye=K(z),e[32]=z,e[33]=ye):ye=e[33];const we=ye;let Ce;e[34]!==I?(Ce=K(I),e[34]=I,e[35]=Ce):Ce=e[35];const Ee=Ce,De=K(J);let xe;e[36]!==be?(xe=K(be),e[36]=be,e[37]=xe):xe=e[37];const ue=xe,ve=C.useRef(null),Be=C.useRef(null);let je;e[38]===Symbol.for("react.memo_cache_sentinel")?(je=()=>ve.current,e[38]=je):je=e[38],C.useImperativeHandle(t,je);const Le=Qg(),Xe=E||N?ke?.width:void 0,tt=Qw({container:n,mediaIndex:Le,width:De}),Te=C.useRef(tt);let At,li;e[39]!==tt?(At=()=>{Te.current=tt},li=[tt],e[39]=tt,e[40]=At,e[41]=li):(At=e[40],li=e[41]),C.useEffect(At,li);let ht;e[42]!==Xe||e[43]!==tt?(ht=Pw({boundaryWidth:Xe,currentWidth:tt}),e[42]=Xe,e[43]=tt,e[44]=ht):ht=e[44];const Ke=ht,Je=C.useRef(Ke);let xt,Ut;e[45]!==Ke?(xt=()=>{Je.current=Ke},Ut=[Ke],e[45]=Ke,e[46]=xt,e[47]=Ut):(xt=e[46],Ut=e[47]),C.useEffect(xt,Ut);const Ot=C.useRef(void 0);let zt,Ve;e[48]!==p||e[49]!==Ke||e[50]!==m||e[51]!==tt?(zt=()=>{const it=ve.current;if(!m||!it)return;const kn=Ot.current;p?kn!==void 0&&(it.style.width=`${kn}px`):tt!==void 0&&(it.style.width=`${tt}px`),typeof Ke=="number"&&(it.style.maxWidth=`${Ke}px`)},Ve=[tt,p,Ke,m],e[48]=p,e[49]=Ke,e[50]=m,e[51]=tt,e[52]=zt,e[53]=Ve):(zt=e[52],Ve=e[53]),C.useEffect(zt,Ve);const[gi,mi]=C.useState(void 0);let jt;e[54]!==ne||e[55]!==q||e[56]!==E||e[57]!==ee||e[58]!==se||e[59]!==_||e[60]!==p||e[61]!==L||e[62]!==Y||e[63]!==N||e[64]!==Oe?(jt={animate:ne,arrowProp:q,arrowRef:Be,constrainSize:E,fallbackPlacements:ee,floatingBoundary:se,margins:_,matchReferenceWidth:p,maxWidthRef:Je,placementProp:L,placementStrategy:Y,preventOverflow:N,referenceBoundary:Oe,referenceWidthRef:Ot,rootBoundary:"viewport",setReferenceWidth:mi,widthRef:Te},e[54]=ne,e[55]=q,e[56]=E,e[57]=ee,e[58]=se,e[59]=_,e[60]=p,e[61]=L,e[62]=Y,e[63]=N,e[64]=Oe,e[65]=jt):jt=e[65];const Ht=Rw(jt);let vt;e[66]!==x?(vt=x?{reference:x}:void 0,e[66]=x,e[67]=vt):vt=e[67];let ci;e[68]!==Ht||e[69]!==L||e[70]!==vt?(ci={middleware:Ht,placement:L,whileElementsMounted:Up,elements:vt},e[68]=Ht,e[69]=L,e[70]=vt,e[71]=ci):ci=e[71];const{x:Kt,y:Oi,middlewareData:Et,placement:It,refs:bt,strategy:_i,update:Jt}=qp(ci),Lt=Et.hide?.referenceHidden,Tt=Et.arrow?.x,ei=Et.arrow?.y,Xt=Et["@sanity/ui/origin"]?.originX,Nt=Et["@sanity/ui/origin"]?.originY;let Wt;e[72]===Symbol.for("react.memo_cache_sentinel")?(Wt=it=>{Be.current=it},e[72]=Wt):Wt=e[72];const ki=Wt;let ti;e[73]!==bt?(ti=it=>{ve.current=it,bt.setFloating(it)},e[73]=bt,e[74]=ti):ti=e[74];const kt=ti;let Ct;e[75]!==h?(Ct=h?_g(h):null,e[75]=h,e[76]=Ct):Ct=e[76];let Rt;e[77]!==bt.reference.current?(Rt=()=>bt.reference.current,e[77]=bt.reference.current,e[78]=Rt):Rt=e[78],C.useImperativeHandle(Ct,Rt);let Yt;e:{if(x){Yt=h;break e}if(!h){Yt=null;break e}let it;e[79]!==h||e[80]!==bt.setReference?(it=C.cloneElement(h,{ref:bt.setReference}),e[79]=h,e[80]=bt.setReference,e[81]=it):it=e[81],Yt=it}const ii=Yt;let ni,_t;if(e[82]!==Jt?(ni=()=>Jt,_t=[Jt],e[82]=Jt,e[83]=ni,e[84]=_t):(ni=e[83],_t=e[84]),C.useImperativeHandle(F,ni,_t),f){let it;return e[85]!==h?(it=h||y.jsx(y.Fragment,{}),e[85]=h,e[86]=it):it=e[86],it}let Mt;e[87]!==g?(Mt=g&&y.jsx(Tw,{}),e[87]=g,e[88]=Mt):Mt=e[88];const Ae=p?gi:tt;let dt;e[89]!==ne||e[90]!==q||e[91]!==Tt||e[92]!==ei||e[93]!==d||e[94]!==_||e[95]!==Xt||e[96]!==Nt||e[97]!==Z||e[98]!==Pe||e[99]!==It||e[100]!==we||e[101]!==Lt||e[102]!==S||e[103]!==w||e[104]!==kt||e[105]!==Ee||e[106]!==_i||e[107]!==Ae||e[108]!==V||e[109]!==Kt||e[110]!==Oi?(dt=y.jsx(Bg,{...S,__unstable_margins:_,animate:ne,arrow:q,arrowRef:ki,arrowX:Tt,arrowY:ei,hidden:Lt,overflow:Z,padding:Pe,placement:It,radius:we,ref:kt,scheme:w,shadow:Ee,originX:Xt,originY:Nt,strategy:_i,tone:V,width:Ae,x:Kt,y:Oi,children:d}),e[89]=ne,e[90]=q,e[91]=Tt,e[92]=ei,e[93]=d,e[94]=_,e[95]=Xt,e[96]=Nt,e[97]=Z,e[98]=Pe,e[99]=It,e[100]=we,e[101]=Lt,e[102]=S,e[103]=w,e[104]=kt,e[105]=Ee,e[106]=_i,e[107]=Ae,e[108]=V,e[109]=Kt,e[110]=Oi,e[111]=dt):dt=e[111];let qt;e[112]!==Mt||e[113]!==dt||e[114]!==ue?(qt=y.jsxs(ah,{zOffset:ue,children:[Mt,dt]}),e[112]=Mt,e[113]=dt,e[114]=ue,e[115]=qt):qt=e[115];const Li=qt;let Xi;e[116]!==m||e[117]!==Li||e[118]!==b?(Xi=m&&(b?y.jsx(gl,{__unstable_name:typeof b=="string"?b:void 0,children:Li}):Li),e[116]=m,e[117]=Li,e[118]=b,e[119]=Xi):Xi=e[119];const Ni=Xi;let Ci;e[120]!==ne||e[121]!==Ni?(Ci=ne?y.jsx(Hp,{children:Ni}):Ni,e[120]=ne,e[121]=Ni,e[122]=Ci):Ci=e[122];let Hi;return e[123]!==ii||e[124]!==Ci?(Hi=y.jsxs(y.Fragment,{children:[Ci,ii]}),e[123]=ii,e[124]=Ci,e[125]=Hi):Hi=e[125],Hi});To.displayName="ForwardRef(Popover)";function Rw(i){const t=ce.c(42),{animate:e,arrowProp:n,arrowRef:r,constrainSize:s,fallbackPlacements:o,floatingBoundary:a,margins:l,matchReferenceWidth:u,maxWidthRef:c,placementProp:h,placementStrategy:d,preventOverflow:f,referenceBoundary:p,referenceWidthRef:g,rootBoundary:m,setReferenceWidth:O,widthRef:b}=i;let x;if(t[0]!==e||t[1]!==n||t[2]!==r||t[3]!==s||t[4]!==o||t[5]!==a||t[6]!==l||t[7]!==u||t[8]!==c||t[9]!==h||t[10]!==d||t[11]!==f||t[12]!==p||t[13]!==g||t[14]!==m||t[15]!==O||t[16]!==b){if(x=[],s||f)if(d==="autoPlacement"){let D;t[18]!==o||t[19]!==h?(D=M1({allowedPlacements:[h].concat(o)}),t[18]=o,t[19]=h,t[20]=D):D=t[20],x.push(D)}else{const D=a||void 0;let R;t[21]!==o||t[22]!==m||t[23]!==D?(R=Kp({boundary:D,fallbackPlacements:o,padding:rs,rootBoundary:m}),t[21]=o,t[22]=m,t[23]=D,t[24]=R):R=t[24],x.push(R)}let S;if(t[25]===Symbol.for("react.memo_cache_sentinel")?(S=Jp({mainAxis:Sw}),t[25]=S):S=t[25],x.push(S),s||u){const D=a||void 0;let R;t[26]!==s||t[27]!==l||t[28]!==u||t[29]!==c||t[30]!==g||t[31]!==O||t[32]!==D||t[33]!==b?(R=$w({boundaryElement:D,constrainSize:s,margins:l,matchReferenceWidth:u,maxWidthRef:c,padding:rs,referenceWidthRef:g,setReferenceWidth:O,widthRef:b}),t[26]=s,t[27]=l,t[28]=u,t[29]=c,t[30]=g,t[31]=O,t[32]=D,t[33]=b,t[34]=R):R=t[34],x.push(R)}if(f){const D=a||void 0;let R;t[35]!==m||t[36]!==D?(R=eg({boundary:D,rootBoundary:m,padding:rs}),t[35]=m,t[36]=D,t[37]=R):R=t[37],x.push(R)}if(n){let D;t[38]!==r?(D=tg({element:r,padding:rs}),t[38]=r,t[39]=D):D=t[39],x.push(D)}e&&x.push(Eg);const w=p||void 0;let v;t[40]!==w?(v=B1({boundary:w,padding:rs,strategy:"referenceHidden"}),t[40]=w,t[41]=v):v=t[41],x.push(v),t[0]=e,t[1]=n,t[2]=r,t[3]=s,t[4]=o,t[5]=a,t[6]=l,t[7]=u,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=p,t[13]=g,t[14]=m,t[15]=O,t[16]=b,t[17]=x}else x=t[17];return x}function _w(){return Re`
    position: relative;

    &:not([hidden]) {
      display: inline-block;
    }

    &[data-read-only] {
      outline: 1px solid red;
    }
  `}function Mw(i){const{color:t,input:e}=fe(i.theme),n=(e.radio.size-e.radio.markSize)/2;return Re`
    appearance: none;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    height: 100%;
    width: 100%;
    outline: none;
    z-index: 1;
    padding: 0;
    margin: 0;
    border-radius: ${he(e.radio.size/2)};
    border: none;

    /* enabled */
    & + span {
      display: block;
      position: relative;
      height: ${he(e.radio.size)};
      width: ${he(e.radio.size)};
      border-radius: ${he(e.radio.size/2)};
      background: ${t.input.default.enabled.bg};
      box-shadow: ${wt({color:t.input.default.enabled.border,width:e.border.width})};

      &::after {
        content: '';
        position: absolute;
        top: ${he(n)};
        left: ${he(n)};
        height: ${he(e.radio.markSize)};
        width: ${he(e.radio.markSize)};
        border-radius: ${he(e.radio.markSize/2)};
        background: ${t.input.default.enabled.fg};
        opacity: 0;
      }
    }

    /* focused */
    &:not(:disabled):focus + span {
      box-shadow: ${ln({border:{width:e.border.width,color:t.input.default.enabled.border},focusRing:e.radio.focusRing})};
    }

    &:not(:disabled):focus:not(:focus-visible) + span {
      box-shadow: ${wt({color:t.input.default.enabled.border,width:e.border.width})};
    }

    &:checked + span::after {
      opacity: 1;
    }

    /* customValidity */
    &[data-error] + span {
      background-color: ${t.input.invalid.enabled.border};
      box-shadow: ${wt({width:e.border.width,color:t.input.invalid.enabled.muted.bg})};
      &::after {
        background: ${t.input.invalid.enabled.muted.bg};
      }
    }

    /* read only */
    &[data-read-only] + span {
      box-shadow: 0 0 0 1px ${t.input.default.readOnly.border};
      background: ${t.input.default.readOnly.bg};

      &::after {
        background: ${t.input.default.readOnly.border};
      }
    }

    /* disabled */
    &:not([data-read-only]):disabled + span {
      box-shadow: 0 0 0 1px ${t.input.default.disabled.border};
      background: ${t.input.default.disabled.bg};

      &::after {
        background: ${t.input.default.disabled.border};
      }
    }
  `}const Bw=G.div.withConfig({displayName:"StyledRadio",componentId:"sc-ccrwkf-0"})(_w),Fw=G.input.withConfig({displayName:"Input",componentId:"sc-ccrwkf-1"})(Mw),Zw=C.forwardRef(function(i,t){const e=ce.c(19);let n,r,s,o,a,l;e[0]!==i?({className:n,disabled:s,style:l,customValidity:r,readOnly:o,...a}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6]);const u=C.useRef(null);let c;e[7]===Symbol.for("react.memo_cache_sentinel")?(c=()=>u.current,e[7]=c):c=e[7],C.useImperativeHandle(t,c),$o(u,r);const h=!s&&o?"":void 0,d=r?"":void 0,f=s||o;let p;e[8]!==o||e[9]!==a||e[10]!==h||e[11]!==d||e[12]!==f?(p=y.jsx(Fw,{"data-read-only":h,"data-error":d,...a,disabled:f,readOnly:o,ref:u,type:"radio"}),e[8]=o,e[9]=a,e[10]=h,e[11]=d,e[12]=f,e[13]=p):p=e[13];let g;e[14]===Symbol.for("react.memo_cache_sentinel")?(g=y.jsx("span",{}),e[14]=g):g=e[14];let m;return e[15]!==n||e[16]!==l||e[17]!==p?(m=y.jsxs(Bw,{className:n,"data-ui":"Radio",style:l,children:[p,g]}),e[15]=n,e[16]=l,e[17]=p,e[18]=m):m=e[18],m});Zw.displayName="ForwardRef(Radio)";function zw(){return Re`
    position: relative;
    width: -moz-available;
    width: -webkit-fill-available;
    width: stretch;

    &:not([hidden]) {
      display: inline-block;
    }
  `}function jw(i){const{font:t}=fe(i.theme);return Re`
    -webkit-font-smoothing: antialiased;
    appearance: none;
    border: 0;
    font-family: ${t.text.family};
    color: inherit;
    width: 100%;
    outline: none;
    margin: 0;

    &:disabled {
      opacity: 1;
    }
  `}function Iw(i){const{color:t,input:e}=fe(i.theme);return Re`
    /* enabled */
    background-color: ${t.input.default.enabled.bg};
    color: ${t.input.default.enabled.fg};
    box-shadow: ${wt({color:t.input.default.enabled.border,width:e.border.width})};

    /* hovered */
    @media (hover: hover) {
      &:not(:disabled):hover {
        background-color: ${t.input.default.hovered.bg};
        color: ${t.input.default.hovered.fg};
        box-shadow: ${wt({color:t.input.default.hovered.border,width:e.border.width})};
      }
    }

    /* focused */
    &:not(:disabled):focus {
      box-shadow: ${ln({border:{width:e.border.width,color:t.input.default.enabled.border},focusRing:e.select.focusRing})};
    }

    /* read-only */
    &[data-read-only] {
      background-color: ${t.input.default.readOnly.bg};
      color: ${t.input.default.readOnly.fg};
      box-shadow: ${wt({color:t.input.default.readOnly.border,width:e.border.width})};
    }

    /* disabled */
    &:not([data-read-only]):disabled {
      background-color: ${t.input.default.disabled.bg};
      color: ${t.input.default.disabled.fg};
      box-shadow: ${wt({color:t.input.default.disabled.border,width:e.border.width})};
    }
  `}function Lw(i){return{fontSize:he(i.fontSize),lineHeight:`${he(i.lineHeight)}`}}function Xw(i){const{$fontSize:t}=i,{font:e,media:n}=fe(i.theme);return Me(n,t,r=>Lw(e.text.sizes[r]||e.text.sizes[2]))}function Nw(){return[or,jw,Iw,Xw,P2]}function Ww(i){const{color:t}=fe(i.theme);return Re`
    pointer-events: none;
    position: absolute;
    top: 0;
    right: 0;

    /* enabled */
    --card-fg-color: ${t.input.default.enabled.fg};

    /* hover */
    @media (hover: hover) {
      select:not(disabled):not(:read-only):hover + && {
        --card-fg-color: ${t.input.default.hovered.fg};
      }
    }

    /* disabled */
    select:disabled + && {
      --card-fg-color: ${t.input.default.disabled.fg};
    }

    /* read-only */
    select[data-read-only] + && {
      --card-fg-color: ${t.input.default.readOnly.fg};
    }
  `}const ch={root:zw,input:Nw,iconBox:Ww},Yw=G.div.withConfig({displayName:"StyledSelect",componentId:"sc-5mxno7-0"})(ch.root),qw=G.select.withConfig({displayName:"Input",componentId:"sc-5mxno7-1"})(ch.input),Vw=G(me).withConfig({displayName:"IconBox",componentId:"sc-5mxno7-2"})(ch.iconBox),xa=C.forwardRef(function(i,t){const e=ce.c(37);let n,r,s,o,a,l,u,c,h;e[0]!==i?({children:n,customValidity:r,disabled:s,fontSize:l,padding:u,radius:c,readOnly:o,space:h,...a}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9]);const d=l===void 0?2:l,f=u===void 0?3:u,p=c===void 0?2:c,g=h===void 0?3:h,m=C.useRef(null);let O;e[10]===Symbol.for("react.memo_cache_sentinel")?(O=()=>m.current,e[10]=O):O=e[10],C.useImperativeHandle(t,O),$o(m,r);const b=!s&&o?"":void 0;let x;e[11]!==d?(x=K(d),e[11]=d,e[12]=x):x=e[12];let S;e[13]!==f?(S=K(f),e[13]=f,e[14]=S):S=e[14];let w;e[15]!==p?(w=K(p),e[15]=p,e[16]=w):w=e[16];let v;e[17]!==g?(v=K(g),e[17]=g,e[18]=v):v=e[18];const D=s||o;let R;e[19]!==n||e[20]!==a||e[21]!==D||e[22]!==b||e[23]!==x||e[24]!==S||e[25]!==w||e[26]!==v?(R=y.jsx(qw,{"data-read-only":b,"data-ui":"Select",...a,$fontSize:x,$padding:S,$radius:w,$space:v,disabled:D,ref:m,children:n}),e[19]=n,e[20]=a,e[21]=D,e[22]=b,e[23]=x,e[24]=S,e[25]=w,e[26]=v,e[27]=R):R=e[27];let $;e[28]===Symbol.for("react.memo_cache_sentinel")?($=y.jsx(ig,{}),e[28]=$):$=e[28];let k;e[29]!==d?(k=y.jsx(et,{size:d,children:$}),e[29]=d,e[30]=k):k=e[30];let A;e[31]!==f||e[32]!==k?(A=y.jsx(Vw,{padding:f,children:k}),e[31]=f,e[32]=k,e[33]=A):A=e[33];let P;return e[34]!==R||e[35]!==A?(P=y.jsxs(Yw,{"data-ui":"Select",children:[R,A]}),e[34]=R,e[35]=A,e[36]=P):P=e[36],P});xa.displayName="ForwardRef(Select)";const Gw={"&&:not([hidden])":{display:"grid"},'&[data-as="ul"],&[data-as="ol"]':{listStyle:"none"},gridTemplateColumns:"minmax(0, 1fr)",gridAutoRows:"min-content"};function Uw(){return Gw}function Hw(i){const{media:t,space:e}=fe(i.theme);return Me(t,i.$space,n=>({gridGap:he(e[n])}))}const Kw=G(me).withConfig({displayName:"StyledStack",componentId:"sc-8dpfq2-0"})(Uw,Hw),oi=C.forwardRef(function(i,t){const e=ce.c(12);let n,r,s;e[0]!==i?({as:n,space:s,...r}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s):(n=e[1],r=e[2],s=e[3]);const o=typeof n=="string"?n:void 0;let a;e[4]!==s?(a=K(s),e[4]=s,e[5]=a):a=e[5];let l;return e[6]!==n||e[7]!==t||e[8]!==r||e[9]!==o||e[10]!==a?(l=y.jsx(Kw,{"data-as":o,"data-ui":"Stack",...r,$space:a,forwardedAs:n,ref:t}),e[6]=n,e[7]=t,e[8]=r,e[9]=o,e[10]=a,e[11]=l):l=e[11],l});oi.displayName="ForwardRef(Stack)";function Jw(){return Re`
    position: relative;
    &:not([hidden]) {
      display: inline-block;
    }
  `}function eS(){return Re`
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    opacity: 0;
    height: 100%;
    width: 100%;
    outline: none;
    padding: 0;
    margin: 0;

    /* Place the input element above the representation element */
    z-index: 1;
  `}function tS(i){const{color:t,input:e}=fe(i.theme);return Re`
    --switch-bg-color: ${t.input.default.enabled.border};
    --switch-fg-color: ${t.input.default.enabled.bg};
    --switch-box-shadow: none;

    &:not([hidden]) {
      display: block;
    }
    position: relative;
    width: ${he(e.switch.width)};
    height: ${he(e.switch.height)};
    border-radius: ${he(e.switch.height/2)};

    /* Make sure it’s not possible to interact with the wrapper element */
    pointer-events: none;

    &:after {
      content: '';
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
      box-shadow: var(--switch-box-shadow);
      border-radius: inherit;
    }

    /* Focus styles */
    input:focus + && {
      --switch-box-shadow: ${ln({focusRing:e.switch.focusRing})};
    }

    input:focus:not(:focus-visible) + && {
      --switch-box-shadow: none;
    }

    input:checked + && {
      --switch-bg-color: ${t.input.default.enabled.fg};
      --switch-fg-color: ${t.input.default.enabled.bg};
    }

    @media (hover: hover) {
      input:not(:disabled):hover + && {
        --switch-bg-color: ${t.input.default.hovered.border};
        --switch-fg-color: ${t.input.default.hovered.bg};
      }

      input:not(:disabled):checked:hover + && {
        --switch-bg-color: ${t.input.default.enabled.fg};
        --switch-fg-color: ${t.input.default.enabled.bg};
      }
    }

    input:not([data-read-only]):disabled + && {
      --switch-bg-color: ${t.input.default.disabled.border};
      --switch-fg-color: ${t.input.default.disabled.bg};
    }

    input[data-read-only]:disabled + && {
      --switch-bg-color: ${t.input.default.readOnly.border};
      --switch-fg-color: ${t.input.default.readOnly.bg};
    }

    input:checked[data-read-only]:disabled + && {
      --switch-bg-color: ${t.input.default.readOnly.fg};
      --switch-fg-color: ${t.input.default.readOnly.bg};
    }
  `}function iS(i){const{input:t}=fe(i.theme);return Re`
    &:not([hidden]) {
      display: block;
    }
    background-color: var(--switch-bg-color);
    position: absolute;
    left: 0;
    top: 0;
    width: ${he(t.switch.width)};
    height: ${he(t.switch.height)};
    border-radius: ${he(t.switch.height/2)};
  `}function nS(i){const{$indeterminate:t}=i,{input:e}=fe(i.theme),n=e.switch.width,r=e.switch.height,s=e.switch.padding,o=r-e.switch.padding*2,a=n-s*2-o,l=n/2-o/2-s,u=t!==!0&&i.$checked===!0;return Re`
    &:not([hidden]) {
      display: block;
    }
    position: absolute;
    left: ${he(s)};
    top: ${he(s)};
    height: ${he(o)};
    width: ${he(o)};
    border-radius: ${he(o/2)};
    transition-property: transform;
    transition-duration: ${e.switch.transitionDurationMs}ms;
    transition-timing-function: ${e.switch.transitionTimingFunction};
    background: var(--switch-fg-color);
    transform: translate3d(0, 0, 0);
    box-shadow: 0px 1px 0px 0px rgba(0, 0, 0, 0.05);

    ${u&&Re`
      transform: translate3d(${a}px, 0, 0);
    `}

    ${t&&Re`
      transform: translate3d(${l}px, 0, 0);
    `}
  `}const rS=G.span.withConfig({displayName:"StyledSwitch",componentId:"sc-dw1foe-0"})(Jw),sS=G.input.withConfig({displayName:"Input",componentId:"sc-dw1foe-1"})(eS),oS=G.span.withConfig({displayName:"Representation",componentId:"sc-dw1foe-2"})(tS),aS=G.span.withConfig({displayName:"Track",componentId:"sc-dw1foe-3"})(iS),lS=G.span.withConfig({displayName:"Thumb",componentId:"sc-dw1foe-4"})(nS),cS=C.forwardRef(function(i,t){const e=ce.c(26);let n,r,s,o,a,l,u;e[0]!==i?({checked:n,className:r,disabled:s,indeterminate:o,readOnly:a,style:u,...l}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7]);const c=C.useRef(null);let h;e[8]===Symbol.for("react.memo_cache_sentinel")?(h=()=>c.current,e[8]=h):h=e[8],C.useImperativeHandle(t,h);let d,f;e[9]!==o?(d=()=>{c.current&&(c.current.indeterminate=o||!1)},f=[o],e[9]=o,e[10]=d,e[11]=f):(d=e[10],f=e[11]),C.useEffect(d,f);const p=!s&&a?"":void 0,g=o!==!0&&n,m=s||a;let O;e[12]!==l||e[13]!==p||e[14]!==g||e[15]!==m?(O=y.jsx(sS,{"data-read-only":p,...l,checked:g,disabled:m,type:"checkbox",ref:c}),e[12]=l,e[13]=p,e[14]=g,e[15]=m,e[16]=O):O=e[16];let b;e[17]===Symbol.for("react.memo_cache_sentinel")?(b=y.jsx(aS,{}),e[17]=b):b=e[17];let x;e[18]!==n||e[19]!==o?(x=y.jsxs(oS,{"aria-hidden":!0,"data-name":"representation",children:[b,y.jsx(lS,{$checked:n,$indeterminate:o})]}),e[18]=n,e[19]=o,e[20]=x):x=e[20];let S;return e[21]!==r||e[22]!==u||e[23]!==O||e[24]!==x?(S=y.jsxs(rS,{className:r,"data-ui":"Switch",style:u,children:[O,x]}),e[21]=r,e[22]=u,e[23]=O,e[24]=x,e[25]=S):S=e[25],S});cS.displayName="ForwardRef(Switch)";const uS=G.span.withConfig({displayName:"StyledTextArea",componentId:"sc-1d6h1o8-0"})(yg),hS=G.span.withConfig({displayName:"InputRoot",componentId:"sc-1d6h1o8-1"})`flex:1;min-width:0;display:block;position:relative;`,dS=G.textarea.withConfig({displayName:"Input",componentId:"sc-1d6h1o8-2"})(eh,xg,wg),fS=G.div.withConfig({displayName:"Presentation",componentId:"sc-1d6h1o8-3"})(or,Sg),pS=C.forwardRef(function(i,t){const e=ce.c(35);let n,r,s,o,a,l,u,c,h;e[0]!==i?({border:o,customValidity:r,disabled:a,fontSize:l,padding:u,radius:c,weight:h,__unstable_disableFocusRing:n,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9]);const d=o===void 0?!0:o,f=a===void 0?!1:a,p=l===void 0?2:l,g=u===void 0?3:u,m=c===void 0?2:c,O=C.useRef(null),b=Do();let x;e[10]===Symbol.for("react.memo_cache_sentinel")?(x=()=>O.current,e[10]=x):x=e[10],C.useImperativeHandle(t,x),$o(O,r);const S=b.scheme,w=b.tone;let v;e[11]!==p?(v=K(p),e[11]=p,e[12]=v):v=e[12];let D;e[13]!==g?(D=K(g),e[13]=g,e[14]=D):D=e[14];const R=b.scheme;let $;e[15]===Symbol.for("react.memo_cache_sentinel")?($=K(0),e[15]=$):$=e[15];let k;e[16]!==f||e[17]!==s||e[18]!==b.scheme||e[19]!==b.tone||e[20]!==v||e[21]!==D||e[22]!==h?(k=y.jsx(dS,{"data-as":"textarea","data-scheme":S,"data-tone":w,...s,$fontSize:v,$padding:D,$scheme:R,$space:$,$tone:b.tone,$weight:h,disabled:f,ref:O}),e[16]=f,e[17]=s,e[18]=b.scheme,e[19]=b.tone,e[20]=v,e[21]=D,e[22]=h,e[23]=k):k=e[23];let A;e[24]!==m?(A=K(m),e[24]=m,e[25]=A):A=e[25];const P=d?"":void 0;let Q;e[26]!==n||e[27]!==b.scheme||e[28]!==b.tone||e[29]!==A||e[30]!==P?(Q=y.jsx(fS,{$radius:A,$unstableDisableFocusRing:n,$scheme:b.scheme,$tone:b.tone,"data-border":P,"data-scheme":b.scheme,"data-tone":b.tone}),e[26]=n,e[27]=b.scheme,e[28]=b.tone,e[29]=A,e[30]=P,e[31]=Q):Q=e[31];let M;return e[32]!==k||e[33]!==Q?(M=y.jsx(uS,{"data-ui":"TextArea",children:y.jsxs(hS,{children:[k,Q]})}),e[32]=k,e[33]=Q,e[34]=M):M=e[34],M});pS.displayName="ForwardRef(TextArea)";const gS={zIndex:2},mS=G(He).attrs({forwardedAs:"span"}).withConfig({displayName:"StyledTextInput",componentId:"sc-h62wco-0"})(yg),OS=G.span.withConfig({displayName:"InputRoot",componentId:"sc-h62wco-1"})`flex:1;min-width:0;display:block;position:relative;`,bS=G(He).attrs({forwardedAs:"span"}).withConfig({displayName:"Prefix",componentId:"sc-h62wco-2"})`border-top-right-radius:0;border-bottom-right-radius:0;& > span{display:block;margin:-1px;}`,yS=G(He).attrs({forwardedAs:"span"}).withConfig({displayName:"Suffix",componentId:"sc-h62wco-3"})`border-top-left-radius:0;border-bottom-left-radius:0;& > span{display:block;margin:-1px;}`,xS=G.input.withConfig({displayName:"Input",componentId:"sc-h62wco-4"})(eh,xg,wg),wS=G.span.withConfig({displayName:"Presentation",componentId:"sc-h62wco-5"})(or,Sg),SS=G(me).withConfig({displayName:"LeftBox",componentId:"sc-h62wco-6"})`position:absolute;top:0;left:0;`,vS=G(me).withConfig({displayName:"RightBox",componentId:"sc-h62wco-7"})`position:absolute;top:0;right:0;`,kS=G(He).withConfig({displayName:"RightCard",componentId:"sc-h62wco-8"})`background-color:transparent;position:absolute;top:0;right:0;`,CS=G(wi).withConfig({displayName:"TextInputClearButton",componentId:"sc-h62wco-9"})({"&:not([hidden])":{display:"block"}}),ys=C.forwardRef(function(i,t){const e=ce.c(92);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S;e[0]!==i?({__unstable_disableFocusRing:s,border:f,clearButton:o,disabled:p,fontSize:g,icon:n,iconRight:r,onClear:l,padding:m,prefix:u,radius:O,readOnly:c,space:b,suffix:d,customValidity:a,type:x,weight:S,...h}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18]);const w=f===void 0?!0:f,v=p===void 0?!1:p,D=g===void 0?2:g,R=m===void 0?3:m,$=O===void 0?2:O,k=b===void 0?3:b,A=x===void 0?"text":x,P=C.useRef(null),Q=Do();let M;e[19]!==D?(M=K(D),e[19]=D,e[20]=M):M=e[20];const B=M;let W;e[21]!==R?(W=K(R),e[21]=R,e[22]=W):W=e[22];const X=W;let F;e[23]!==$?(F=K($),e[23]=$,e[24]=F):F=e[24];const _=F;let j;e[25]!==k?(j=K(k),e[25]=k,e[26]=j):j=e[26];const q=j,E=!!o,Z=!!n,L=!!r,Y=!!d,N=!!u;let z;e[27]===Symbol.for("react.memo_cache_sentinel")?(z=()=>P.current,e[27]=z):z=e[27],C.useImperativeHandle(t,z),$o(P,a);const I=DS;let V;e[28]!==l?(V=Xe=>{Xe.preventDefault(),Xe.stopPropagation(),l&&l(),P.current?.focus()},e[28]=l,e[29]=V):V=e[29];const J=V;let re;e[30]!==u||e[31]!==_?(re=u&&y.jsx(bS,{borderTop:!0,borderLeft:!0,borderBottom:!0,radius:_,sizing:"border",tone:"inherit",children:y.jsx("span",{children:u})}),e[30]=u,e[31]=_,e[32]=re):re=e[32];const ee=re,se=w?"":void 0;let Oe;e[33]!==n||e[34]!==B||e[35]!==X?(Oe=n&&y.jsx(SS,{padding:X,children:y.jsxs(et,{size:B,children:[C.isValidElement(n)&&n,Dr.isValidElementType(n)&&y.jsx(n,{})]})}),e[33]=n,e[34]=B,e[35]=X,e[36]=Oe):Oe=e[36];let be;e[37]!==E||e[38]!==r||e[39]!==B||e[40]!==X?(be=!E&&r&&y.jsx(vS,{padding:X,children:y.jsxs(et,{size:B,children:[C.isValidElement(r)&&r,Dr.isValidElementType(r)&&y.jsx(r,{})]})}),e[37]=E,e[38]=r,e[39]=B,e[40]=X,e[41]=be):be=e[41];let ne;e[42]!==N||e[43]!==Y||e[44]!==s||e[45]!==_||e[46]!==Q.scheme||e[47]!==Q.tone||e[48]!==se||e[49]!==Oe||e[50]!==be?(ne=y.jsxs(wS,{$hasPrefix:N,$unstableDisableFocusRing:s,$hasSuffix:Y,$radius:_,$scheme:Q.scheme,$tone:Q.tone,"data-border":se,"data-scheme":Q.scheme,"data-tone":Q.tone,children:[Oe,be]}),e[42]=N,e[43]=Y,e[44]=s,e[45]=_,e[46]=Q.scheme,e[47]=Q.tone,e[48]=se,e[49]=Oe,e[50]=be,e[51]=ne):ne=e[51];const ke=ne;let Qe;e[52]!==X?(Qe=X.map($S),e[52]=X,e[53]=Qe):Qe=e[53];const Pe=Qe;let ye;e[54]!==X?(ye=X.map(QS),e[54]=X,e[55]=ye):ye=e[55];const we=ye,Ce=typeof o=="object"?o:kr;let Ee;e[56]!==o||e[57]!==Pe||e[58]!==we||e[59]!==Ce||e[60]!==a||e[61]!==v||e[62]!==B||e[63]!==J||e[64]!==_||e[65]!==c?(Ee=!v&&!c&&o&&y.jsx(kS,{forwardedAs:"span",padding:Pe,style:gS,tone:a?"critical":"inherit",children:y.jsx(CS,{"aria-label":"Clear","data-qa":"clear-button",fontSize:B,icon:Gp,mode:"bleed",padding:we,radius:_,...Ce,onClick:J,onMouseDown:I})}),e[56]=o,e[57]=Pe,e[58]=we,e[59]=Ce,e[60]=a,e[61]=v,e[62]=B,e[63]=J,e[64]=_,e[65]=c,e[66]=Ee):Ee=e[66];const De=Ee;let xe;e[67]!==_||e[68]!==d?(xe=d&&y.jsx(yS,{borderTop:!0,borderRight:!0,borderBottom:!0,radius:_,sizing:"border",tone:"inherit",children:y.jsx("span",{children:d})}),e[67]=_,e[68]=d,e[69]=xe):xe=e[69];const ue=xe,ve=L||E;let Be;e[70]!==Z||e[71]!==v||e[72]!==B||e[73]!==X||e[74]!==c||e[75]!==h||e[76]!==Q.scheme||e[77]!==Q.tone||e[78]!==q||e[79]!==ve||e[80]!==A||e[81]!==S?(Be=y.jsx(xS,{"data-as":"input","data-scheme":Q.scheme,"data-tone":Q.tone,...h,$fontSize:B,$iconLeft:Z,$iconRight:ve,$padding:X,$scheme:Q.scheme,$space:q,$tone:Q.tone,$weight:S,disabled:v,readOnly:c,ref:P,type:A}),e[70]=Z,e[71]=v,e[72]=B,e[73]=X,e[74]=c,e[75]=h,e[76]=Q.scheme,e[77]=Q.tone,e[78]=q,e[79]=ve,e[80]=A,e[81]=S,e[82]=Be):Be=e[82];let je;e[83]!==De||e[84]!==ke||e[85]!==Be?(je=y.jsxs(OS,{children:[Be,ke,De]}),e[83]=De,e[84]=ke,e[85]=Be,e[86]=je):je=e[86];let Le;return e[87]!==ee||e[88]!==Q.tone||e[89]!==ue||e[90]!==je?(Le=y.jsxs(mS,{"data-ui":"TextInput",tone:Q.tone,children:[ee,je,ue]}),e[87]=ee,e[88]=Q.tone,e[89]=ue,e[90]=je,e[91]=Le):Le=e[91],Le});ys.displayName="ForwardRef(TextInput)";function DS(i){i.preventDefault(),i.stopPropagation()}function $S(i){return i===0?0:i===1||i===2?1:i-2}function QS(i){return i===0||i===1?0:i===2?1:i-1}function PS(i){const t=ce.c(3),[e,n]=C.useState(i),r=C.useRef(void 0);let s;t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(l,u)=>{const c=()=>{n(l)};if(r.current&&(clearTimeout(r.current),r.current=void 0),!u)return c();r.current=setTimeout(c,u)},t[0]=s):s=t[0];const o=s;let a;return t[1]!==e?(a=[e,o],t[1]=e,t[2]=a):a=t[2],a}const AS=15,ES=6,TS=2,RS=4,wa=4,_S={top:["top-end","top-start","bottom","left","right"],"top-start":["top","top-end","bottom-start","left-start","right-start"],"top-end":["top","top-start","bottom-end","left-end","right-end"],bottom:["bottom-end","bottom-start","top","left","right"],"bottom-start":["bottom","bottom-end","top-start","left-start","right-start"],"bottom-end":["bottom","bottom-start","top-end","left-end","right-end"],left:["left-end","left-start","right","top","bottom"],"left-start":["left","left-end","right-start","top-start","bottom-start"],"left-end":["left","left-start","right-end","top-end","bottom-end"],right:["right-end","right-start","left","top","bottom"],"right-start":["right","right-end","left-start","top-start","bottom-start"],"right-end":["right","right-start","left-end","top-end","bottom-end"]},MS=G(Rr.create(He)).withConfig({displayName:"MotionCard",componentId:"sc-1xn138w-0"})`will-change:transform;`,Fg=C.forwardRef(function(i,t){const e=ce.c(48);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O;e[0]!==i?({animate:n,arrow:r,arrowRef:s,arrowX:o,arrowY:a,children:l,originX:u,originY:c,padding:h,placement:d,radius:f,scheme:g,shadow:m,style:O,...p}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15]);const b=n?"transform":void 0;let x;e[16]!==u||e[17]!==c||e[18]!==O||e[19]!==b?(x={originX:u,originY:c,willChange:b,...O},e[16]=u,e[17]=c,e[18]=O,e[19]=b,e[20]=x):x=e[20];const S=x,w=o!==null?o:void 0,v=a!==null?a:void 0;let D;e[21]!==w||e[22]!==v?(D={left:w,top:v,right:void 0,bottom:void 0},e[21]=w,e[22]=v,e[23]=D):D=e[23];const R=D,$=p;let k;e[24]!==n?(k=n?["hidden","initial"]:void 0,e[24]=n,e[25]=k):k=e[25];let A;e[26]!==n?(A=n?["visible","scaleIn"]:void 0,e[26]=n,e[27]=A):A=e[27];let P;e[28]!==n?(P=n?["hidden","scaleOut"]:void 0,e[28]=n,e[29]=P):P=e[29];let Q;e[30]!==r||e[31]!==s||e[32]!==R?(Q=r&&y.jsx(oh,{ref:s,style:R,width:AS,height:ES,radius:TS}),e[30]=r,e[31]=s,e[32]=R,e[33]=Q):Q=e[33];let M;return e[34]!==l||e[35]!==h||e[36]!==d||e[37]!==f||e[38]!==t||e[39]!==S||e[40]!==g||e[41]!==m||e[42]!==$||e[43]!==k||e[44]!==A||e[45]!==P||e[46]!==Q?(M=y.jsxs(MS,{"data-ui":"Tooltip__card",...$,"data-placement":d,padding:h,radius:f,ref:t,scheme:g,shadow:m,style:S,variants:as.card,transition:as.transition,initial:k,animate:A,exit:P,children:[l,Q]}),e[34]=l,e[35]=h,e[36]=d,e[37]=f,e[38]=t,e[39]=S,e[40]=g,e[41]=m,e[42]=$,e[43]=k,e[44]=A,e[45]=P,e[46]=Q,e[47]=M):M=e[47],M});Fg.displayName="ForwardRef(TooltipCard)";const BS=rr("@sanity/ui/context/tooltipDelayGroup",null);function FS(){return C.useContext(BS)}const ZS=G(lh).withConfig({displayName:"StyledTooltip",componentId:"sc-13f2zvh-0"})`pointer-events:none;`,xs=C.forwardRef(function(i,t){const e=ce.c(137),n=fl(),{layer:r}=sr();let s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S;e[0]!==i?({animate:g,arrow:m,boundaryElement:s,children:l,content:u,disabled:h,fallbackPlacements:o,padding:O,placement:b,portal:d,radius:x,scheme:p,shadow:S,zOffset:a,delay:c,...f}=i,e[0]=i,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=u,e[6]=c,e[7]=h,e[8]=d,e[9]=f,e[10]=p,e[11]=g,e[12]=m,e[13]=O,e[14]=b,e[15]=x,e[16]=S):(s=e[1],o=e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=e[8],f=e[9],p=e[10],g=e[11],m=e[12],O=e[13],b=e[14],x=e[15],S=e[16]);const w=g===void 0?!1:g,v=m===void 0?!1:m,D=O===void 0?2:O,R=b===void 0?"bottom":b,$=x===void 0?2:x,k=S===void 0?2:S,A=s??n?.element,P=o??_S[i.placement??"bottom"],Q=a??r.tooltip.zOffset,M=nh()?!1:w;let B;e[17]!==P?(B=K(P),e[17]=P,e[18]=B):B=e[18];const W=B,X=C.useRef(null),[F,_]=C.useState(null),j=C.useRef(null),[q,E]=C.useState(0);let Z;e[19]===Symbol.for("react.memo_cache_sentinel")?(Z=()=>X.current,e[19]=Z):Z=e[19],C.useImperativeHandle(t,Z);const L=pl(),Y=typeof d=="string"?L.elements?.[d]||null:L.element;let N;e[20]!==M||e[21]!==v||e[22]!==A||e[23]!==W?(N={animate:M,arrowProp:v,arrowRef:j,boundaryElement:A,fallbackPlacements:W,rootBoundary:"viewport"},e[20]=M,e[21]=v,e[22]=A,e[23]=W,e[24]=N):N=e[24];const z=zS(N);let I;e[25]!==F?(I={reference:F},e[25]=F,e[26]=I):I=e[26];let V;e[27]!==z||e[28]!==R||e[29]!==I?(V={middleware:z,placement:R,whileElementsMounted:Up,elements:I},e[27]=z,e[28]=R,e[29]=I,e[30]=V):V=e[30];const{floatingStyles:J,placement:re,middlewareData:ee,refs:se,update:Oe}=qp(V),be=ee.arrow?.x,ne=ee.arrow?.y,ke=ee["@sanity/ui/origin"]?.originX,Qe=ee["@sanity/ui/origin"]?.originY,Pe=C.useId(),[ye,we]=PS(!1),Ce=FS();let Ee;e[31]!==Ce?(Ee=Ce||{},e[31]=Ce,e[32]=Ee):Ee=e[32];const{setIsGroupActive:De,setOpenTooltipId:xe}=Ee,ue=ye||Ce?.openTooltipId===Pe,ve=Ce!==null,Be=typeof c=="number"?c:c?.open||0,je=typeof c=="number"?c:c?.close||0,Le=ve?Ce.openDelay:Be,Xe=ve?Ce.closeDelay:je;let tt;e[33]!==Xe||e[34]!==ve||e[35]!==Le||e[36]!==De||e[37]!==we||e[38]!==xe||e[39]!==Pe?(tt=(Ae,dt)=>{if(ve)if(Ae){const qt=dt?0:Le;De?.(Ae,qt),xe?.(Pe,qt)}else{const qt=Xe>200?Xe:200;De?.(Ae,qt),xe?.(null,dt?0:Xe)}else we(Ae,dt?0:Ae?Le:Xe)},e[33]=Xe,e[34]=ve,e[35]=Le,e[36]=De,e[37]=we,e[38]=xe,e[39]=Pe,e[40]=tt):tt=e[40];const Te=tt;let At;e[41]!==l?.props||e[42]!==Te?(At=Ae=>{Te(!1),l?.props?.onBlur?.(Ae)},e[41]=l?.props,e[42]=Te,e[43]=At):At=e[43];const li=At;let ht;e[44]!==l?.props||e[45]!==Te?(ht=Ae=>{Te(!1,!0),l?.props.onClick?.(Ae)},e[44]=l?.props,e[45]=Te,e[46]=ht):ht=e[46];const Ke=ht;let Je;e[47]!==l?.props||e[48]!==Te?(Je=Ae=>{Te(!1,!0),l?.props.onContextMenu?.(Ae)},e[47]=l?.props,e[48]=Te,e[49]=Je):Je=e[49];const xt=Je;let Ut;e[50]!==l?.props||e[51]!==Te?(Ut=Ae=>{Te(!0),l?.props?.onFocus?.(Ae)},e[50]=l?.props,e[51]=Te,e[52]=Ut):Ut=e[52];const Ot=Ut;let zt;e[53]!==l?.props||e[54]!==Te?(zt=Ae=>{Te(!0),l?.props?.onMouseEnter?.(Ae)},e[53]=l?.props,e[54]=Te,e[55]=zt):zt=e[55];const Ve=zt;let gi;e[56]!==l?.props||e[57]!==Te?(gi=Ae=>{Te(!1),l?.props?.onMouseLeave?.(Ae)},e[56]=l?.props,e[57]=Te,e[58]=gi):gi=e[58];const mi=gi;let jt;e[59]!==Te||e[60]!==ve||e[61]!==F||e[62]!==ue?(jt={handleIsOpenChange:Te,referenceElement:F,showTooltip:ue,isInsideGroup:ve},e[59]=Te,e[60]=ve,e[61]=F,e[62]=ue,e[63]=jt):jt=e[63],jS(jt);let Ht,vt;e[64]!==h||e[65]!==Te||e[66]!==ue?(Ht=()=>{h&&ue&&Te(!1)},vt=[h,Te,ue],e[64]=h,e[65]=Te,e[66]=ue,e[67]=Ht,e[68]=vt):(Ht=e[67],vt=e[68]),C.useEffect(Ht,vt);let ci,Kt;e[69]!==u||e[70]!==Te||e[71]!==ue?(ci=()=>{!u&&ue&&Te(!1)},Kt=[u,Te,ue],e[69]=u,e[70]=Te,e[71]=ue,e[72]=ci,e[73]=Kt):(ci=e[72],Kt=e[73]),C.useEffect(ci,Kt);let Oi,Et;e[74]!==Te||e[75]!==ue?(Oi=()=>{if(!ue)return;const Ae=function(dt){dt.key==="Escape"&&Te(!1,!0)};return window.addEventListener("keydown",Ae),()=>{window.removeEventListener("keydown",Ae)}},Et=[Te,ue],e[74]=Te,e[75]=ue,e[76]=Oi,e[77]=Et):(Oi=e[76],Et=e[77]),C.useEffect(Oi,Et);let It;e[78]!==A||e[79]!==Y?.offsetWidth?(It=()=>{const Ae=[...A?[A.offsetWidth]:[],Y?.offsetWidth||document.body.offsetWidth];E(Math.min(...Ae)-wa*2)},e[78]=A,e[79]=Y?.offsetWidth,e[80]=It):It=e[80];let bt;e[81]!==A||e[82]!==Y?(bt=[A,Y],e[81]=A,e[82]=Y,e[83]=bt):bt=e[83],C.useLayoutEffect(It,bt);let _i;e[84]!==Oe?(_i=Ae=>{j.current=Ae,Oe()},e[84]=Oe,e[85]=_i):_i=e[85];const Jt=_i;let Lt;e[86]!==se?(Lt=Ae=>{X.current=Ae,se.setFloating(Ae)},e[86]=se,e[87]=Lt):Lt=e[87];const Tt=Lt;let ei;e:{if(!l){ei=null;break e}let Ae;e[88]!==l||e[89]!==li||e[90]!==Ke||e[91]!==xt||e[92]!==Ot||e[93]!==Ve||e[94]!==mi?(Ae=C.cloneElement(l,{onBlur:li,onFocus:Ot,onMouseEnter:Ve,onMouseLeave:mi,onClick:Ke,onContextMenu:xt,ref:_}),e[88]=l,e[89]=li,e[90]=Ke,e[91]=xt,e[92]=Ot,e[93]=Ve,e[94]=mi,e[95]=Ae):Ae=e[95],ei=Ae}const Xt=ei;let Nt;e[96]!==l?(Nt=l?_g(l):null,e[96]=l,e[97]=Nt):Nt=e[97];let Wt,ki;if(e[98]!==F?(Wt=()=>F,ki=[F],e[98]=F,e[99]=Wt,e[100]=ki):(Wt=e[99],ki=e[100]),C.useImperativeHandle(Nt,Wt,ki),!Xt){let Ae;return e[101]===Symbol.for("react.memo_cache_sentinel")?(Ae=y.jsx(y.Fragment,{}),e[101]=Ae):Ae=e[101],Ae}if(h)return Xt;const ti=q>0?`${q}px`:void 0;let kt;e[102]!==J||e[103]!==ti?(kt={...J,maxWidth:ti},e[102]=J,e[103]=ti,e[104]=kt):kt=e[104];let Ct;e[105]!==M||e[106]!==v||e[107]!==be||e[108]!==ne||e[109]!==u||e[110]!==ke||e[111]!==Qe||e[112]!==D||e[113]!==re||e[114]!==$||e[115]!==f||e[116]!==p||e[117]!==Jt||e[118]!==Tt||e[119]!==k?(Ct=y.jsx(Fg,{...f,animate:M,arrow:v,arrowRef:Jt,arrowX:be,arrowY:ne,originX:ke,originY:Qe,padding:D,placement:re,radius:$,ref:Tt,scheme:p,shadow:k,children:u}),e[105]=M,e[106]=v,e[107]=be,e[108]=ne,e[109]=u,e[110]=ke,e[111]=Qe,e[112]=D,e[113]=re,e[114]=$,e[115]=f,e[116]=p,e[117]=Jt,e[118]=Tt,e[119]=k,e[120]=Ct):Ct=e[120];let Rt;e[121]!==f||e[122]!==Tt||e[123]!==kt||e[124]!==Ct||e[125]!==Q?(Rt=y.jsx(ZS,{"data-ui":"Tooltip",...f,ref:Tt,style:kt,zOffset:Q,children:Ct}),e[121]=f,e[122]=Tt,e[123]=kt,e[124]=Ct,e[125]=Q,e[126]=Rt):Rt=e[126];const Yt=Rt;let ii;e[127]!==d||e[128]!==ue||e[129]!==Yt?(ii=ue&&(d?y.jsx(gl,{__unstable_name:typeof d=="string"?d:void 0,children:Yt}):Yt),e[127]=d,e[128]=ue,e[129]=Yt,e[130]=ii):ii=e[130];const ni=ii;let _t;e[131]!==M||e[132]!==ni?(_t=M?y.jsx(Hp,{children:ni}):ni,e[131]=M,e[132]=ni,e[133]=_t):_t=e[133];let Mt;return e[134]!==Xt||e[135]!==_t?(Mt=y.jsxs(y.Fragment,{children:[_t,Xt]}),e[134]=Xt,e[135]=_t,e[136]=Mt):Mt=e[136],Mt});xs.displayName="ForwardRef(Tooltip)";function zS(i){const t=ce.c(17),{animate:e,arrowProp:n,arrowRef:r,boundaryElement:s,fallbackPlacements:o,rootBoundary:a}=i;let l;if(t[0]!==e||t[1]!==n||t[2]!==r||t[3]!==s||t[4]!==o||t[5]!==a){l=[];const u=s||void 0;let c;t[7]!==o||t[8]!==a||t[9]!==u?(c=Kp({boundary:u,fallbackPlacements:o,padding:wa,rootBoundary:a}),t[7]=o,t[8]=a,t[9]=u,t[10]=c):c=t[10],l.push(c);let h;t[11]===Symbol.for("react.memo_cache_sentinel")?(h=Jp({mainAxis:RS}),t[11]=h):h=t[11],l.push(h);const d=s||void 0;let f;if(t[12]!==a||t[13]!==d?(f=eg({boundary:d,rootBoundary:a,padding:wa}),t[12]=a,t[13]=d,t[14]=f):f=t[14],l.push(f),n){let p;t[15]!==r?(p=tg({element:r,padding:wa}),t[15]=r,t[16]=p):p=t[16],l.push(p)}e&&l.push(Eg),t[0]=e,t[1]=n,t[2]=r,t[3]=s,t[4]=o,t[5]=a,t[6]=l}else l=t[6];return l}function jS(i){const t=ce.c(10),{handleIsOpenChange:e,referenceElement:n,showTooltip:r,isInsideGroup:s}=i;let o;t[0]!==e||t[1]!==n?(o=(c,h)=>{n&&(n===c||c instanceof Node&&n.contains(c)||(e(!1),h()))},t[0]=e,t[1]=n,t[2]=o):o=t[2];const a=ul(o);let l;t[3]!==s||t[4]!==a||t[5]!==r?(l=()=>{if(!r||s)return;const c=h=>{a(h.target,()=>window.removeEventListener("mousemove",c))};return window.addEventListener("mousemove",c),()=>window.removeEventListener("mousemove",c)},t[3]=s,t[4]=a,t[5]=r,t[6]=l):l=t[6];let u;t[7]!==s||t[8]!==r?(u=[s,r],t[7]=s,t[8]=r,t[9]=u):u=t[9],C.useEffect(l,u)}const IS=G.kbd.withConfig({displayName:"StyledHotkeys",componentId:"sc-b37mge-0"})`font:inherit;padding:1px;&:not([hidden]){display:block;}`,LS=G(Ag).withConfig({displayName:"Key",componentId:"sc-b37mge-1"})`&:not([hidden]){display:block;}`,uh=C.forwardRef(function(i,t){const e=ce.c(26);let n,r,s,o,a,l;e[0]!==i?({fontSize:n,keys:r,padding:s,radius:o,space:l,...a}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6]);const u=l===void 0?.5:l;let c;e[7]!==u?(c=K(u),e[7]=u,e[8]=c):c=e[8];const h=c;if(!r||r.length===0){let g;return e[9]===Symbol.for("react.memo_cache_sentinel")?(g=y.jsx(y.Fragment,{}),e[9]=g):g=e[9],g}let d;if(e[10]!==n||e[11]!==r||e[12]!==s||e[13]!==o){let g;e[15]!==n||e[16]!==s||e[17]!==o?(g=(m,O)=>y.jsx(LS,{fontSize:n,padding:s,radius:o,children:m},O),e[15]=n,e[16]=s,e[17]=o,e[18]=g):g=e[18],d=r.map(g),e[10]=n,e[11]=r,e[12]=s,e[13]=o,e[14]=d}else d=e[14];let f;e[19]!==h||e[20]!==d?(f=y.jsx(Po,{as:"span",space:h,children:d}),e[19]=h,e[20]=d,e[21]=f):f=e[21];let p;return e[22]!==t||e[23]!==a||e[24]!==f?(p=y.jsx(IS,{"data-ui":"Hotkeys",...a,ref:t,children:f}),e[22]=t,e[23]=a,e[24]=f,e[25]=p):p=e[25],p});uh.displayName="ForwardRef(Hotkeys)";const Zg=rr("@sanity/ui/context/menu",null);function XS(i){return Hu(i)&&i.getAttribute("data-disabled")!=="true"||Ku(i)&&!i.disabled}function is(i){return i.filter(XS)}function NS(i,t){const e=[];let n=t;for(;n!==i;){const r=n.parentElement;if(!r)return e;const s=Array.from(r.childNodes).indexOf(n);if(e.unshift(s),r===i)return e;n=r}return e}const yd=[];function WS(i,t){if(!i)return;const e=new WeakMap;for(const r of t)e.set(r,NS(i,r));const n=(r,s)=>{const o=e.get(r)||yd,a=e.get(s)||yd,l=Math.max(o.length,a.length);for(let u=0;u<l;u+=1){const c=o[u]||-1,h=a[u]||-1;if(c!==h)return c-h}return 0};t.sort(n)}function YS(i){const t=ce.c(21),{onKeyDown:e,originElement:n,shouldFocus:r,rootElementRef:s}=i;let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=[],t[0]=o):o=t[0];const a=C.useRef(o),[l,u]=C.useState(-1),c=C.useRef(l),[h,d]=C.useState(null);let f;t[1]===Symbol.for("react.memo_cache_sentinel")?(f=k=>{u(k),c.current=k,d(a.current[k]||null)},t[1]=f):f=t[1];const p=f;let g;t[2]!==s?(g=(k,A)=>{if(!k)return qS;if(a.current.indexOf(k)===-1&&(a.current.push(k),WS(s.current,a.current)),A){const P=a.current.indexOf(k);p(P)}return()=>{const P=a.current.indexOf(k);P>-1&&a.current.splice(P,1)}},t[2]=s,t[3]=g):g=t[3];const m=g;let O;t[4]!==e||t[5]!==n?(O=k=>{if(k.key==="Tab"){n&&n.focus();return}if(k.key==="Home"){k.preventDefault(),k.stopPropagation();const A=is(a.current)[0];if(!A)return;const P=a.current.indexOf(A);p(P);return}if(k.key==="End"){k.preventDefault(),k.stopPropagation();const A=is(a.current),P=A[A.length-1];if(!P)return;const Q=a.current.indexOf(P);p(Q);return}if(k.key==="ArrowUp"){k.preventDefault(),k.stopPropagation();const A=is(a.current),P=A.length;if(P===0)return;const Q=a.current[c.current];let M=A.indexOf(Q);M=(M-1+P)%P;const B=A[M],W=a.current.indexOf(B);p(W);return}if(k.key==="ArrowDown"){k.preventDefault(),k.stopPropagation();const A=is(a.current),P=A.length;if(P===0)return;const Q=a.current[c.current];let M=A.indexOf(Q);M=(M+1)%P;const B=A[M],W=a.current.indexOf(B);p(W);return}e&&e(k)},t[4]=e,t[5]=n,t[6]=O):O=t[6];const b=O;let x;t[7]===Symbol.for("react.memo_cache_sentinel")?(x=k=>{const A=k.currentTarget,P=a.current.indexOf(A);p(P)},t[7]=x):x=t[7];const S=x;let w;t[8]!==s?(w=()=>{p(-2),s.current?.focus()},t[8]=s,t[9]=w):w=t[9];const v=w;let D,R;t[10]!==l||t[11]!==s||t[12]!==r?(D=()=>{if(!s.current)return;const k=requestAnimationFrame(()=>{if(l===-1){if(r==="first"){const A=is(a.current)[0];if(A){const P=a.current.indexOf(A);p(P)}}if(r==="last"){const A=is(a.current),P=A[A.length-1];if(P){const Q=a.current.indexOf(P);p(Q)}}return}(a.current[l]||null)?.focus()});return()=>cancelAnimationFrame(k)},R=[l,s,p,r],t[10]=l,t[11]=s,t[12]=r,t[13]=D,t[14]=R):(D=t[13],R=t[14]),C.useEffect(D,R);let $;return t[15]!==h||t[16]!==l||t[17]!==v||t[18]!==b||t[19]!==m?($={activeElement:h,activeIndex:l,handleItemMouseEnter:S,handleItemMouseLeave:v,handleKeyDown:b,mount:m},t[15]=h,t[16]=l,t[17]=v,t[18]=b,t[19]=m,t[20]=$):$=t[20],$}function qS(){}const VS=G(me).withConfig({displayName:"StyledMenu",componentId:"sc-xt0tnv-0"})`outline:none;overflow:auto;`,zg=C.forwardRef(function(i,t){const e=ce.c(49);let n,r,s,o,a,l,u,c,h,d,f,p;if(e[0]!==i){const{children:L,focusFirst:Y,focusLast:N,onClickOutside:z,onEscape:I,onItemClick:V,onItemSelect:J,onKeyDown:re,originElement:ee,padding:se,registerElement:Oe,shouldFocus:be,space:ne,...ke}=i;r=L,s=z,o=I,a=V,l=J,u=re,c=ee,f=se,h=Oe,n=be,p=ne,d=ke,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p}else n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12];const g=f===void 0?1:f,m=p===void 0?1:p,O=n??(i.focusFirst&&"first"||i.focusLast&&"last"||null),b=C.useRef(null);let x;e[13]===Symbol.for("react.memo_cache_sentinel")?(x=()=>b.current,e[13]=x):x=e[13],C.useImperativeHandle(t,x);const{isTopLayer:S}=Eo();let w;e[14]!==u||e[15]!==c||e[16]!==O?(w={onKeyDown:u,originElement:c,shouldFocus:O,rootElementRef:b},e[14]=u,e[15]=c,e[16]=O,e[17]=w):w=e[17];const{activeElement:v,activeIndex:D,handleItemMouseEnter:R,handleItemMouseLeave:$,handleKeyDown:k,mount:A}=YS(w),P=C.useRef(null);let Q;e[18]!==h?(Q=L=>{P.current&&(P.current(),P.current=null),b.current=L,b.current&&h&&(P.current=h(b.current))},e[18]=h,e[19]=Q):Q=e[19];const M=Q;let B,W;e[20]!==D||e[21]!==l?(B=()=>{l&&l(D)},W=[D,l],e[20]=D,e[21]=l,e[22]=B,e[23]=W):(B=e[22],W=e[23]),C.useEffect(B,W);let X;e[24]===Symbol.for("react.memo_cache_sentinel")?(X=()=>[b.current],e[24]=X):X=e[24],dl(S&&s,X);let F;e[25]!==S||e[26]!==o?(F=L=>{S&&L.key==="Escape"&&(L.stopPropagation(),o&&o())},e[25]=S,e[26]=o,e[27]=F):F=e[27],$g(F);let _;e[28]!==v||e[29]!==R||e[30]!==$||e[31]!==A||e[32]!==s||e[33]!==o||e[34]!==a||e[35]!==h?(_={version:2,activeElement:v,mount:A,onClickOutside:s,onEscape:o,onItemClick:a,onItemMouseEnter:R,onItemMouseLeave:$,registerElement:h},e[28]=v,e[29]=R,e[30]=$,e[31]=A,e[32]=s,e[33]=o,e[34]=a,e[35]=h,e[36]=_):_=e[36];const j=_;let q;e[37]!==r||e[38]!==m?(q=y.jsx(oi,{space:m,children:r}),e[37]=r,e[38]=m,e[39]=q):q=e[39];let E;e[40]!==k||e[41]!==M||e[42]!==g||e[43]!==d||e[44]!==q?(E=y.jsx(VS,{"data-ui":"Menu",...d,onKeyDown:k,padding:g,ref:M,role:"menu",tabIndex:-1,children:q}),e[40]=k,e[41]=M,e[42]=g,e[43]=d,e[44]=q,e[45]=E):E=e[45];let Z;return e[46]!==E||e[47]!==j?(Z=y.jsx(Zg.Provider,{value:j,children:E}),e[46]=E,e[47]=j,e[48]=Z):Z=e[48],Z});zg.displayName="ForwardRef(Menu)";const GS=G.hr.withConfig({displayName:"MenuDivider",componentId:"sc-uhoxwu-0"})`height:1px;border:0;background:var(--card-hairline-soft-color);margin:0;`;GS.displayName="MenuDivider";function US(){return Re`
    background-color: inherit;
    color: inherit;

    &[data-as='button'] {
      -webkit-font-smoothing: inherit;
      appearance: none;
      outline: none;
      font: inherit;
      text-align: inherit;
      border: 0;
      width: -moz-available;
      width: -webkit-fill-available;
      width: stretch;
    }

    /* &:is(a) */
    &[data-as='a'] {
      text-decoration: none;
    }
  `}function HS(i){const{$tone:t}=i,{color:e,style:n}=fe(i.theme),r=e.selectable[t];return Re`
    ${at(e,r.enabled)}

    background-color: var(--card-bg-color);
    color: var(--card-fg-color);
    outline: none;

    /* &:is(button) */
    &[data-as='button'] {
      &:disabled {
        ${at(e,r.disabled)}
      }

      &:not(:disabled) {
        &[aria-pressed='true'] {
          ${at(e,r.pressed)}
        }

        &[data-selected],
        &[aria-selected='true'] > & {
          ${at(e,r.selected)}
        }

        @media (hover: hover) {
          &:not([data-selected]) {
            &[data-hovered],
            &:hover {
              ${at(e,r.hovered)}
            }

            &:active {
              ${at(e,r.pressed)}
            }
          }
        }
      }
    }

    /* &:is(a) */
    &[data-as='a'] {
      &[data-disabled] {
        ${at(e,r.disabled)}
      }

      &:not([data-disabled]) {
        &[data-pressed] {
          ${at(e,r.pressed)}
        }

        &[data-selected] {
          ${at(e,r.selected)}
        }

        @media (hover: hover) {
          &:not([data-selected]) {
            &[data-hovered],
            &:hover {
              ${at(e,r.hovered)}
            }
            &:active {
              ${at(e,r.pressed)}
            }
          }
        }
      }
    }

    ${n?.card?.root}
  `}const jg=G(me).withConfig({displayName:"Selectable",componentId:"sc-1w01ang-0"})(or,US,HS);jg.displayName="Selectable";function KS(){const i=C.useContext(Zg);if(!i)throw new Error("useMenu(): missing context value");if(!Ao(i)||i.version!==2)throw new Error("useMenu(): the context value is not compatible");return i}const Ig=C.forwardRef(function(i,t){const e=ce.c(75);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R;e[0]!==i?({as:b,children:s,disabled:o,fontSize:x,hotkeys:a,icon:n,iconRight:r,onClick:l,padding:S,paddingX:f,paddingY:p,paddingTop:d,paddingRight:h,paddingBottom:u,paddingLeft:c,pressed:g,radius:w,selected:O,space:v,text:R,tone:D,...m}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S,e[19]=w,e[20]=v,e[21]=D,e[22]=R):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18],w=e[19],v=e[20],D=e[21],R=e[22]);const $=b===void 0?"button":b,k=x===void 0?1:x,A=S===void 0?3:S,P=w===void 0?2:w,Q=v===void 0?3:v,M=D===void 0?"default":D,{scheme:B}=Do(),W=KS(),{activeElement:X,mount:F,onItemClick:_,onItemMouseEnter:j,onItemMouseLeave:q}=W,E=j??W.onItemMouseEnter,Z=q??W.onItemMouseLeave,[L,Y]=C.useState(null),N=!!X&&X===L,z=C.useRef(null);let I;e[23]===Symbol.for("react.memo_cache_sentinel")?(I=()=>z.current,e[23]=I):I=e[23],C.useImperativeHandle(t,I);let V,J;e[24]!==F||e[25]!==L||e[26]!==O?(V=()=>F(L,O),J=[F,L,O],e[24]=F,e[25]=L,e[26]=O,e[27]=V,e[28]=J):(V=e[27],J=e[28]),C.useEffect(V,J);let re;e[29]!==o||e[30]!==l||e[31]!==_?(re=je=>{o||(l&&l(je),_&&_())},e[29]=o,e[30]=l,e[31]=_,e[32]=re):re=e[32];const ee=re;let se;e[33]!==A||e[34]!==u||e[35]!==c||e[36]!==h||e[37]!==d||e[38]!==f||e[39]!==p?(se={padding:A,paddingX:f,paddingY:p,paddingTop:d,paddingRight:h,paddingBottom:u,paddingLeft:c},e[33]=A,e[34]=u,e[35]=c,e[36]=h,e[37]=d,e[38]=f,e[39]=p,e[40]=se):se=e[40];const Oe=se;let be;e[41]!==k?(be=K(k).map(JS),e[41]=k,e[42]=be):be=e[42];const ne=be;let ke;e[43]===Symbol.for("react.memo_cache_sentinel")?(ke=je=>{z.current=je,Y(je)},e[43]=ke):ke=e[43];const Qe=ke,Pe=$!=="button"&&g?"":void 0,ye=N?"":void 0,we=o?"":void 0;let Ce;e[44]!==P?(Ce=K(P),e[44]=P,e[45]=Ce):Ce=e[45];let Ee;e[46]===Symbol.for("react.memo_cache_sentinel")?(Ee=K(0),e[46]=Ee):Ee=e[46];const De=o?"default":M,xe=$==="button"?"button":void 0;let ue;e[47]!==n||e[48]!==r||e[49]!==k||e[50]!==a||e[51]!==ne||e[52]!==Oe||e[53]!==Q||e[54]!==R?(ue=(n||R||r)&&y.jsxs(St,{as:"span",gap:Q,align:"center",...Oe,children:[n&&y.jsxs(et,{size:k,children:[C.isValidElement(n)&&n,Dr.isValidElementType(n)&&y.jsx(n,{})]}),R&&y.jsx(me,{flex:1,children:y.jsx(et,{size:k,textOverflow:"ellipsis",weight:"medium",children:R})}),a&&y.jsx(uh,{fontSize:ne,keys:a,style:{marginTop:-4,marginBottom:-4}}),r&&y.jsxs(et,{size:k,children:[C.isValidElement(r)&&r,Dr.isValidElementType(r)&&y.jsx(r,{})]})]}),e[47]=n,e[48]=r,e[49]=k,e[50]=a,e[51]=ne,e[52]=Oe,e[53]=Q,e[54]=R,e[55]=ue):ue=e[55];let ve;e[56]!==s||e[57]!==Oe?(ve=s&&y.jsx(me,{as:"span",...Oe,children:s}),e[56]=s,e[57]=Oe,e[58]=ve):ve=e[58];let Be;return e[59]!==$||e[60]!==o||e[61]!==ee||e[62]!==E||e[63]!==Z||e[64]!==m||e[65]!==B||e[66]!==Pe||e[67]!==ye||e[68]!==we||e[69]!==Ce||e[70]!==De||e[71]!==xe||e[72]!==ue||e[73]!==ve?(Be=y.jsxs(jg,{"data-ui":"MenuItem",role:"menuitem",...m,"data-pressed":Pe,"data-selected":ye,"data-disabled":we,forwardedAs:$,$radius:Ce,$padding:Ee,$tone:De,$scheme:B,disabled:o,onClick:ee,onMouseEnter:E,onMouseLeave:Z,ref:Qe,tabIndex:-1,type:xe,children:[ue,ve]}),e[59]=$,e[60]=o,e[61]=ee,e[62]=E,e[63]=Z,e[64]=m,e[65]=B,e[66]=Pe,e[67]=ye,e[68]=we,e[69]=Ce,e[70]=De,e[71]=xe,e[72]=ue,e[73]=ve,e[74]=Be):Be=e[74],Be});Ig.displayName="ForwardRef(MenuItem)";function JS(i){return i-1}const ev=G(wi).withConfig({displayName:"CustomButton",componentId:"sc-1kns779-0"})`max-width:100%;`,tv=C.forwardRef(function(i,t){const e=ce.c(30);let n,r,s,o,a,l,u,c,h,d;e[0]!==i?({icon:r,id:s,focused:n,fontSize:h,label:o,onClick:a,onFocus:l,padding:d,selected:c,...u}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10]);const f=h===void 0?1:h,p=d===void 0?2:d,g=C.useRef(null),m=C.useRef(!1);let O;e[11]===Symbol.for("react.memo_cache_sentinel")?(O=()=>g.current,e[11]=O):O=e[11],C.useImperativeHandle(t,O);let b;e[12]===Symbol.for("react.memo_cache_sentinel")?(b=()=>{m.current=!1},e[12]=b):b=e[12];const x=b;let S;e[13]!==l?(S=A=>{m.current=!0,l&&l(A)},e[13]=l,e[14]=S):S=e[14];const w=S;let v,D;e[15]!==n?(v=()=>{n&&!m.current&&(g.current&&g.current.focus(),m.current=!0)},D=[n],e[15]=n,e[16]=v,e[17]=D):(v=e[16],D=e[17]),C.useEffect(v,D);const R=c?"true":"false",$=c?0:-1;let k;return e[18]!==f||e[19]!==w||e[20]!==r||e[21]!==s||e[22]!==o||e[23]!==a||e[24]!==p||e[25]!==u||e[26]!==c||e[27]!==R||e[28]!==$?(k=y.jsx(ev,{"data-ui":"Tab",...u,"aria-selected":R,fontSize:f,icon:r,id:s,mode:"bleed",onClick:a,onBlur:x,onFocus:w,padding:p,ref:g,role:"tab",selected:c,tabIndex:$,text:o,type:"button"}),e[18]=f,e[19]=w,e[20]=r,e[21]=s,e[22]=o,e[23]=a,e[24]=p,e[25]=u,e[26]=c,e[27]=R,e[28]=$,e[29]=k):k=e[29],k});tv.displayName="ForwardRef(Tab)";const iv=G(Po).withConfig({displayName:"CustomInline",componentId:"sc-5cm04m-0"})`& > div{display:inline-block;vertical-align:middle;max-width:100%;box-sizing:border-box;}`,nv=C.forwardRef(function(i,t){const e=ce.c(15);let n,r;e[0]!==i?({children:n,...r}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const[s,o]=C.useState(-1);let a;if(e[3]!==n||e[4]!==s){const f=C.Children.toArray(n).filter(C.isValidElement);let p;e[6]!==s?(p=(g,m)=>C.cloneElement(g,{focused:s===m,key:m,onFocus:()=>o(m)}),e[6]=s,e[7]=p):p=e[7],a=f.map(p),e[3]=n,e[4]=s,e[5]=a}else a=e[5];const l=a,u=l.length;let c;e[8]!==u?(c=f=>{f.key==="ArrowLeft"&&o(p=>(p+u-1)%u),f.key==="ArrowRight"&&o(p=>(p+1)%u)},e[8]=u,e[9]=c):c=e[9];const h=c;let d;return e[10]!==h||e[11]!==t||e[12]!==r||e[13]!==l?(d=y.jsx(iv,{"data-ui":"TabList",...r,onKeyDown:h,ref:t,role:"tablist",children:l}),e[10]=h,e[11]=t,e[12]=r,e[13]=l,e[14]=d):d=e[14],d});nv.displayName="ForwardRef(TabList)";function rv(i){const t=requestAnimationFrame(i);return()=>{cancelAnimationFrame(t)}}function sv(i){return!!document.activeElement&&i.contains(document.activeElement)}function ov(i){return i.tabIndex>0||i.tabIndex===0&&i.getAttribute("tabIndex")!==null?!0:Hu(i)?!!i.href&&i.rel!=="ignore":Dy(i)?i.type!=="hidden"&&i.type!=="file"&&!i.disabled:Ku(i)||$y(i)||Qy(i)?!i.disabled:!1}function Lg(i){if(!ov(i))return!1;try{i.focus()}catch{}return document.activeElement===i}function oo(i){for(let t=0;t<i.childNodes.length;t++){const e=i.childNodes[t];if(nr(e)&&(Lg(e)||oo(e)))return!0}return!1}function Xg(i){for(let t=i.childNodes.length-1;t>=0;t--){const e=i.childNodes[t];if(nr(e)&&(Lg(e)||Xg(e)))return!0}return!1}const av=G.div.withConfig({displayName:"StyledAutocomplete",componentId:"sc-1igauft-0"})`line-height:0;`,lv=G(me).withConfig({displayName:"ListBox",componentId:"sc-1igauft-1"})`& > ul{list-style:none;padding:0;margin:0;}`,cv=Yu`
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
`,uv=G(Vp).withConfig({displayName:"AnimatedSpinnerIcon",componentId:"sc-1igauft-2"})`animation:${cv} 500ms linear infinite;`;function hv(i){const t=ce.c(11),{children:e,id:n,onSelect:r,selected:s,value:o}=i;let a;t[0]!==r||t[1]!==o?(a=()=>{setTimeout(()=>{r(o)},0)},t[0]=r,t[1]=o,t[2]=a):a=t[2];const l=a;let u;t[3]!==l?(u=d=>{d.key==="Enter"&&!Cy(d.currentTarget)&&l()},t[3]=l,t[4]=u):u=t[4];const c=u;let h;return t[5]!==e||t[6]!==l||t[7]!==c||t[8]!==n||t[9]!==s?(h=y.jsx("li",{"aria-selected":s,"data-ui":"AutocompleteOption",id:n,role:"option",onClick:l,onKeyDown:c,children:e}),t[5]=e,t[6]=l,t[7]=c,t[8]=n,t[9]=s,t[10]=h):h=t[10],h}function dv(i,t){return t.type==="input/change"?{...i,activeValue:null,focused:!0,query:t.query}:t.type==="input/focus"?{...i,focused:!0}:t.type==="root/blur"?{...i,focused:!1,query:null}:t.type==="root/clear"?{...i,activeValue:null,query:null,value:null}:t.type==="root/escape"?{...i,focused:!1,query:null}:t.type==="root/open"?{...i,query:i.query||t.query}:t.type==="root/setActiveValue"?{...i,activeValue:t.value,listFocused:t.listFocused||i.listFocused}:t.type==="root/setListFocused"?{...i,listFocused:t.listFocused}:t.type==="value/change"?{...i,activeValue:t.value,query:null,value:t.value}:i}const fv=["Control","Shift","Alt","Enter","Home","End","PageUp","PageDown","Meta","Tab","CapsLock"],pv="bottom-start",gv=["bottom-start","top-start"],mv=(i,t)=>t?t.value:i,Ov=(i,t)=>t.value.toLowerCase().indexOf(i.toLowerCase())>-1,bv=C.forwardRef(function(i,t){const e=ce.c(181);let n,r,s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R,$,k,A,P,Q,M,B;e[0]!==i?({border:R,customValidity:n,disabled:r,filterOption:s,fontSize:$,icon:o,id:a,listBox:k,loading:l,onBlur:u,onChange:c,onFocus:h,onQueryChange:d,onSelect:f,openButton:p,openOnFocus:g,options:m,padding:A,popover:P,prefix:O,radius:Q,readOnly:b,relatedElements:x,renderOption:S,renderPopover:w,renderValue:M,suffix:D,value:B,...v}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a,e[6]=l,e[7]=u,e[8]=c,e[9]=h,e[10]=d,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=O,e[16]=b,e[17]=x,e[18]=S,e[19]=w,e[20]=v,e[21]=D,e[22]=R,e[23]=$,e[24]=k,e[25]=A,e[26]=P,e[27]=Q,e[28]=M,e[29]=B):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],O=e[15],b=e[16],x=e[17],S=e[18],w=e[19],v=e[20],D=e[21],R=e[22],$=e[23],k=e[24],A=e[25],P=e[26],Q=e[27],M=e[28],B=e[29]);const W=R===void 0?!0:R,X=$===void 0?2:$,F=k===void 0?kr:k,_=A===void 0?3:A,j=P===void 0?kr:P,q=Q===void 0?2:Q,E=M===void 0?mv:M,Z=B||null,L=B||null;let Y;e[30]!==Z||e[31]!==L?(Y={activeValue:Z,focused:!1,listFocused:!1,query:null,value:L},e[30]=Z,e[31]=L,e[32]=Y):Y=e[32];const[N,z]=C.useReducer(dv,Y),{activeValue:I,focused:V,listFocused:J,query:re,value:ee}=N;let se;e[33]!==X||e[34]!==_?(se=de=>{const{value:Ne}=de;return y.jsx(He,{"data-as":"button",padding:_,radius:2,tone:"inherit",children:y.jsx(et,{size:X,textOverflow:"ellipsis",children:Ne})})},e[33]=X,e[34]=_,e[35]=se):se=e[35];const Oe=typeof S=="function"?S:se,be=typeof s=="function"?s:Ov,ne=C.useRef(null),ke=C.useRef(null),Qe=C.useRef(null),Pe=C.useRef(null),[ye,we]=C.useState(null);let Ce;e[36]===Symbol.for("react.memo_cache_sentinel")?(Ce=de=>{C.startTransition(()=>we(de))},e[36]=Ce):Ce=e[36];const Ee=Ce,De=C.useRef(!1),xe=C.useRef(ee),ue=C.useRef(B),ve=C.useRef(!1);let Be,je;e[37]!==ye?(Be=()=>ye,je=[ye],e[37]=ye,e[38]=Be,e[39]=je):(Be=e[38],je=e[39]),C.useImperativeHandle(Qe,Be,je);let Le,Xe;e[40]!==ye?(Le=()=>ye,Xe=[ye],e[40]=ye,e[41]=Le,e[42]=Xe):(Le=e[41],Xe=e[42]),C.useImperativeHandle(t,Le,Xe);const tt=`${a}-listbox`,Te=Array.isArray(m)?m:Co,At=K(_);let li;e[43]!==Te||e[44]!==ee?(li=ee!==null?Te.find(de=>de.value===ee):void 0,e[43]=Te,e[44]=ee,e[45]=li):li=e[45];const ht=li;let Ke;if(e[46]!==be||e[47]!==Te||e[48]!==re){let de;e[50]!==be||e[51]!==re?(de=Ne=>re?be(re,Ne):!0,e[50]=be,e[51]=re,e[52]=de):de=e[52],Ke=Te.filter(de),e[46]=be,e[47]=Te,e[48]=re,e[49]=Ke}else Ke=e[49];const Je=Ke,xt=Je.length,Ut=I?`${a}-option-${I}`:void 0,Ot=re!==null&&l||V&&re!==null;let zt;e[53]!==u||e[54]!==d||e[55]!==x?(zt=de=>{setTimeout(()=>{if(ve.current)return;const Ne=(x||[]).concat(ne.current?[ne.current]:[],ke.current?[ke.current]:[]);let st=!1;if(document.activeElement){for(const nt of Ne)if(nt===document.activeElement||nt.contains(document.activeElement)){st=!0;break}}st===!1&&(z({type:"root/blur"}),ve.current=!1,d&&d(null),u&&u(de))},0)},e[53]=u,e[54]=d,e[55]=x,e[56]=zt):zt=e[56];const Ve=zt;let gi;e[57]===Symbol.for("react.memo_cache_sentinel")?(gi=de=>{const Ne=Pe.current,st=de.target instanceof HTMLElement?de.target:null,nt=Ne?.contains(st)||!1;nt!==De.current&&(De.current=nt,z({type:"root/setListFocused",listFocused:nt}))},e[57]=gi):gi=e[57];const mi=gi;let jt;e[58]!==c||e[59]!==d||e[60]!==f?(jt=de=>{z({type:"value/change",value:de}),ve.current=!1,f&&f(de),xe.current=de,c&&c(de),d&&d(null),Qe.current?.focus()},e[58]=c,e[59]=d,e[60]=f,e[61]=jt):jt=e[61];const Ht=jt;let vt;e[62]!==I||e[63]!==Je||e[64]!==xt||e[65]!==d?(vt=de=>{if(de.key==="ArrowDown"){if(de.preventDefault(),!xt)return;const nt=Je.find(Cn=>Cn.value===I),Bt=nt?Je.indexOf(nt):-1,bi=Je[(Bt+1)%xt];bi&&z({type:"root/setActiveValue",value:bi.value,listFocused:!0});return}if(de.key==="ArrowUp"){if(de.preventDefault(),!xt)return;const nt=Je.find(Cn=>Cn.value===I),Bt=nt?Je.indexOf(nt):-1,bi=Je[Bt===-1?xt-1:(xt+Bt-1)%xt];bi&&z({type:"root/setActiveValue",value:bi.value,listFocused:!0});return}if(de.key==="Escape"){z({type:"root/escape"}),ve.current=!1,d&&d(null),Qe.current?.focus();return}const Ne=de.target,st=Pe.current;if((st===Ne||st?.contains(Ne))&&!fv.includes(de.key)){Qe.current?.focus();return}},e[62]=I,e[63]=Je,e[64]=xt,e[65]=d,e[66]=vt):vt=e[66];const ci=vt;let Kt;e[67]!==d?(Kt=de=>{const Ne=de.currentTarget.value;z({type:"input/change",query:Ne}),d&&d(Ne)},e[67]=d,e[68]=Kt):Kt=e[68];const Oi=Kt;let Et;e[69]!==ht||e[70]!==E||e[71]!==ee?(Et=()=>{z({type:"root/open",query:ee?E(ee,ht):""})},e[69]=ht,e[70]=E,e[71]=ee,e[72]=Et):Et=e[72];const It=Et;let bt;e[73]!==It||e[74]!==V||e[75]!==h||e[76]!==g?(bt=de=>{V||(z({type:"input/focus"}),h&&h(de),g&&It())},e[73]=It,e[74]=V,e[75]=h,e[76]=g,e[77]=bt):bt=e[77];const _i=bt;let Jt;e[78]===Symbol.for("react.memo_cache_sentinel")?(Jt=()=>{ve.current=!0},e[78]=Jt):Jt=e[78];const Lt=Jt;let Tt;e[79]===Symbol.for("react.memo_cache_sentinel")?(Tt=()=>{ve.current=!1},e[79]=Tt):Tt=e[79];const ei=Tt;let Xt;e[80]!==c||e[81]!==d?(Xt=()=>{z({type:"root/clear"}),xe.current="",c&&c(""),d&&d(null),Qe.current?.focus()},e[80]=c,e[81]=d,e[82]=Xt):Xt=e[82];const Nt=Xt;let Wt;e[83]===Symbol.for("react.memo_cache_sentinel")?(Wt=()=>{z({type:"input/focus"})},e[83]=Wt):Wt=e[83];const ki=Wt;let ti,kt;e[84]!==B?(ti=()=>{if(B!==ue.current){ue.current=B,B!==void 0&&(z({type:"value/change",value:B}),xe.current=B);return}B!==xe.current&&(xe.current=B||null,z({type:"value/change",value:B||null}))},kt=[B],e[84]=B,e[85]=ti,e[86]=kt):(ti=e[85],kt=e[86]),C.useEffect(ti,kt);let Ct,Rt;e[87]!==V?(Ct=()=>{!V&&xe.current&&z({type:"root/setActiveValue",value:xe.current})},Rt=[V],e[87]=V,e[88]=Ct,e[89]=Rt):(Ct=e[88],Rt=e[89]),C.useEffect(Ct,Rt);let Yt,ii;e[90]!==I||e[91]!==Je?(Yt=()=>{const de=Pe.current;if(!de)return;const Ne=Je.find(st=>st.value===I);if(Ne){const st=Je.indexOf(Ne),nt=de.childNodes[st];if(nt){if(sv(nt))return;oo(nt)}}},ii=[I,Je],e[90]=I,e[91]=Je,e[92]=Yt,e[93]=ii):(Yt=e[92],ii=e[93]),C.useEffect(Yt,ii);let ni;e:{if(!l&&!r&&ee){let de;e[94]===Symbol.for("react.memo_cache_sentinel")?(de={"aria-label":"Clear",onFocus:ki},e[94]=de):de=e[94],ni=de;break e}ni=void 0}const _t=ni,Mt=At.map(xv),Ae=At.map(wv),dt=typeof p=="object"?p:kr;let qt;e[95]!==It||e[96]!==dt?(qt=de=>{It(),dt.onClick&&dt.onClick(de),rv(()=>Qe.current?.focus())},e[95]=It,e[96]=dt,e[97]=qt):qt=e[97];const Li=qt;let Xi;e[98]!==r||e[99]!==Ot||e[100]!==X||e[101]!==Li||e[102]!==p||e[103]!==Mt||e[104]!==Ae||e[105]!==dt||e[106]!==b?(Xi=!r&&!b&&p?y.jsx(me,{"aria-hidden":Ot,padding:Mt,children:y.jsx(wi,{"aria-label":"Open",disabled:Ot,fontSize:X,icon:ig,mode:"bleed",padding:Ae,...dt,onClick:Li})}):void 0,e[98]=r,e[99]=Ot,e[100]=X,e[101]=Li,e[102]=p,e[103]=Mt,e[104]=Ae,e[105]=dt,e[106]=b,e[107]=Xi):Xi=e[107];const Ni=Xi;let Ci;e:{if(re===null){if(ee!==null){let de;e[108]!==ht||e[109]!==E||e[110]!==ee?(de=E(ee,ht),e[108]=ht,e[109]=E,e[110]=ee,e[111]=de):de=e[111],Ci=de;break e}Ci="";break e}Ci=re}const Hi=Ci;let it;e[112]!==J?(it=de=>{de.key==="Tab"&&J&&Qe.current?.focus()},e[112]=J,e[113]=it):it=e[113];const kn=it;let Mr;e:{if(Je.length===0){Mr=null;break e}let de;if(e[114]!==I||e[115]!==ht||e[116]!==Je||e[117]!==Ht||e[118]!==a||e[119]!==J||e[120]!==l||e[121]!==Oe){let nt;e[123]!==I||e[124]!==ht||e[125]!==Ht||e[126]!==a||e[127]!==J||e[128]!==l||e[129]!==Oe?(nt=Bt=>{const bi=I!==null?Bt.value===I:ht===Bt;return y.jsx(hv,{id:`${a}-option-${Bt.value}`,onSelect:Ht,selected:bi,value:Bt.value,children:C.cloneElement(Oe(Bt),{disabled:l,selected:bi,tabIndex:J&&bi?0:-1})},Bt.value)},e[123]=I,e[124]=ht,e[125]=Ht,e[126]=a,e[127]=J,e[128]=l,e[129]=Oe,e[130]=nt):nt=e[130],de=Je.map(nt),e[114]=I,e[115]=ht,e[116]=Je,e[117]=Ht,e[118]=a,e[119]=J,e[120]=l,e[121]=Oe,e[122]=de}else de=e[122];let Ne;e[131]!==tt||e[132]!==de?(Ne=y.jsx(oi,{as:"ul","aria-multiselectable":!1,"data-ui":"AutoComplete__resultsList",id:tt,ref:Pe,role:"listbox",space:1,children:de}),e[131]=tt,e[132]=de,e[133]=Ne):Ne=e[133];let st;e[134]!==kn||e[135]!==F||e[136]!==Ne?(st=y.jsx(lv,{"data-ui":"AutoComplete__results",onKeyDown:kn,padding:1,...F,tabIndex:-1,children:Ne}),e[134]=kn,e[135]=F,e[136]=Ne,e[137]=st):st=e[137],Mr=st}const Ki=Mr;let lr;e:{if(w){const Ne=!Ot;let st;e[138]!==Ki||e[139]!==Lt||e[140]!==ei||e[141]!==ye||e[142]!==w||e[143]!==Ne?(st=y.jsx(yv,{content:Ki,hidden:Ne,inputElement:ye,onMouseEnter:Lt,onMouseLeave:ei,resultsPopoverElementRef:ke,renderPopover:w}),e[138]=Ki,e[139]=Lt,e[140]=ei,e[141]=ye,e[142]=w,e[143]=Ne,e[144]=st):st=e[144],lr=st;break e}if(xt===0){lr=null;break e}let de;e[145]!==Ki||e[146]!==Ot||e[147]!==Lt||e[148]!==ei||e[149]!==ye||e[150]!==j||e[151]!==q?(de=y.jsx(To,{arrow:!1,constrainSize:!0,content:Ki,fallbackPlacements:gv,matchReferenceWidth:!0,onMouseEnter:Lt,onMouseLeave:ei,open:Ot,overflow:"auto",placement:pv,portal:!0,radius:q,ref:ke,referenceElement:ye,...j}),e[145]=Ki,e[146]=Ot,e[147]=Lt,e[148]=ei,e[149]=ye,e[150]=j,e[151]=q,e[152]=de):de=e[152],lr=de}const Ji=lr,en=l&&uv,tn=D||Ni;let Di;e[153]!==Ut||e[154]!==W||e[155]!==_t||e[156]!==n||e[157]!==r||e[158]!==Ot||e[159]!==X||e[160]!==Nt||e[161]!==Oi||e[162]!==_i||e[163]!==o||e[164]!==a||e[165]!==Hi||e[166]!==tt||e[167]!==At||e[168]!==O||e[169]!==q||e[170]!==b||e[171]!==v||e[172]!==en||e[173]!==tn?(Di=y.jsx(ys,{...v,"aria-activedescendant":Ut,"aria-autocomplete":"list","aria-expanded":Ot,"aria-owns":tt,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",border:W,clearButton:_t,customValidity:n,disabled:r,fontSize:X,icon:o,iconRight:en,id:a,inputMode:"search",onChange:Oi,onClear:Nt,onFocus:_i,padding:At,prefix:O,radius:q,readOnly:b,ref:Ee,role:"combobox",spellCheck:!1,suffix:tn,value:Hi}),e[153]=Ut,e[154]=W,e[155]=_t,e[156]=n,e[157]=r,e[158]=Ot,e[159]=X,e[160]=Nt,e[161]=Oi,e[162]=_i,e[163]=o,e[164]=a,e[165]=Hi,e[166]=tt,e[167]=At,e[168]=O,e[169]=q,e[170]=b,e[171]=v,e[172]=en,e[173]=tn,e[174]=Di):Di=e[174];let Wi;return e[175]!==Ve||e[176]!==mi||e[177]!==ci||e[178]!==Ji||e[179]!==Di?(Wi=y.jsxs(av,{"data-ui":"Autocomplete",onBlur:Ve,onFocus:mi,onKeyDown:ci,ref:ne,children:[Di,Ji]}),e[175]=Ve,e[176]=mi,e[177]=ci,e[178]=Ji,e[179]=Di,e[180]=Wi):Wi=e[180],Wi});function yv({renderPopover:i,content:t,hidden:e,inputElement:n,onMouseEnter:r,onMouseLeave:s,resultsPopoverElementRef:o}){return i({content:t,hidden:e,inputElement:n,onMouseEnter:r,onMouseLeave:s},o)}bv.displayName="ForwardRef(Autocomplete)";function xv(i){return i===0?0:i===1||i===2?1:i-2}function wv(i){return Math.max(i-1,0)}const Sv=G.ol.withConfig({displayName:"StyledBreadcrumbs",componentId:"sc-1es8h8q-0"})`margin:0;padding:0;display:flex;list-style:none;align-items:center;white-space:nowrap;line-height:0;`,vv=G(wi).withConfig({displayName:"ExpandButton",componentId:"sc-1es8h8q-1"})`appearance:none;margin:-4px;`,kv=C.forwardRef(function(i,t){const e=ce.c(29);let n,r,s,o,a;e[0]!==i?({children:n,maxLength:r,separator:o,space:a,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o,e[5]=a):(n=e[1],r=e[2],s=e[3],o=e[4],a=e[5]);const l=a===void 0?2:a;let u;e[6]!==l?(u=K(l),e[6]=l,e[7]=u):u=e[7];const c=u,[h,d]=C.useState(!1),f=C.useRef(null),p=C.useRef(null);let g;e[8]===Symbol.for("react.memo_cache_sentinel")?(g=()=>d(!1),e[8]=g):g=e[8];const m=g;let O;e[9]===Symbol.for("react.memo_cache_sentinel")?(O=()=>d(!0),e[9]=O):O=e[9];const b=O;let x;e[10]===Symbol.for("react.memo_cache_sentinel")?(x=()=>[f.current,p.current],e[10]=x):x=e[10],dl(m,x);let S;e[11]!==n?(S=C.Children.toArray(n).filter(C.isValidElement),e[11]=n,e[12]=S):S=e[12];const w=S;let v;e[13]!==r||e[14]!==h||e[15]!==w||e[16]!==c?(v={collapse:m,expand:b,expandElementRef:f,maxLength:r,open:h,popoverElementRef:p,rawItems:w,space:c},e[13]=r,e[14]=h,e[15]=w,e[16]=c,e[17]=v):v=e[17];const D=Cv(v);let R;if(e[18]!==D||e[19]!==o||e[20]!==c){let k;e[22]!==o||e[23]!==c?(k=(A,P)=>y.jsxs(C.Fragment,{children:[P>0&&y.jsx(me,{"aria-hidden":!0,as:"li",paddingX:c,children:o||y.jsx(et,{muted:!0,children:"/"})}),y.jsx(me,{as:"li",children:A})]},P),e[22]=o,e[23]=c,e[24]=k):k=e[24],R=D.map(k),e[18]=D,e[19]=o,e[20]=c,e[21]=R}else R=e[21];let $;return e[25]!==t||e[26]!==s||e[27]!==R?($=y.jsx(Sv,{"data-ui":"Breadcrumbs",...s,ref:t,children:R}),e[25]=t,e[26]=s,e[27]=R,e[28]=$):$=e[28],$});kv.displayName="ForwardRef(Breadcrumbs)";function Cv(i){const t=ce.c(28),{collapse:e,expand:n,expandElementRef:r,maxLength:s,open:o,popoverElementRef:a,rawItems:l,space:u}=i,c=l.length;if(s&&c>s){const h=Math.ceil(s/2),d=Math.floor(s/2);let f;if(t[0]!==d||t[1]!==h||t[2]!==e||t[3]!==n||t[4]!==r||t[5]!==c||t[6]!==o||t[7]!==a||t[8]!==l||t[9]!==u){const p=l.slice(0,h-1);let g;t[11]!==d||t[12]!==h||t[13]!==c||t[14]!==l?(g=l.slice(h-1,c-d),t[11]=d,t[12]=h,t[13]=c,t[14]=l,t[15]=g):g=t[15];let m;t[16]!==u||t[17]!==g?(m=y.jsx(oi,{as:"ol",overflow:"auto",padding:u,space:u,children:g}),t[16]=u,t[17]=g,t[18]=m):m=t[18];const O=o?e:n;let b;t[19]!==r||t[20]!==o||t[21]!==O?(b=y.jsx(vv,{fontSize:1,mode:"bleed",onClick:O,padding:1,ref:r,selected:o,text:"…"}),t[19]=r,t[20]=o,t[21]=O,t[22]=b):b=t[22];let x;t[23]!==o||t[24]!==a||t[25]!==m||t[26]!==b?(x=y.jsx(To,{constrainSize:!0,content:m,open:o,placement:"top",portal:!0,ref:a,children:b},"button"),t[23]=o,t[24]=a,t[25]=m,t[26]=b,t[27]=x):x=t[27],f=[...p,x,...l.slice(c-d)],t[0]=d,t[1]=h,t[2]=e,t[3]=n,t[4]=r,t[5]=c,t[6]=o,t[7]=a,t[8]=l,t[9]=u,t[10]=f}else f=t[10];return f}return l}function Dv({theme:i}){const{color:t}=fe(i);return{"&:not([hidden])":{display:"flex"},top:0,left:0,right:0,bottom:0,alignItems:"center",justifyContent:"center",outline:"none",background:t.backdrop}}function $v(i){const{media:t}=fe(i.theme);return Me(t,i.$position,e=>({"&&":{position:e}}))}function Qv(i){return i.$animate?Re`
    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    animation: fadeIn 200ms ease-out;
    // Animates the dialog card.
    & > [data-ui='DialogCard'] {
      animation: zoomIn 200ms ease-out;
    }
  `:Re``}const Pv=rr("@sanity/ui/context/dialog",{version:0});function Av(){return C.useContext(Pv)}function zc(i,t,e){return!i||!t?!0:_c(i,e)||_c(t,e)}const Ev=G(lh).withConfig({displayName:"StyledDialog",componentId:"sc-4n4xb3-0"})(vg,Dv,$v,Qv),Tv=G(rh).withConfig({displayName:"DialogContainer",componentId:"sc-4n4xb3-1"})`&:not([hidden]){display:flex;}width:100%;height:100%;flex-direction:column;align-items:center;justify-content:center;`,Rv=G(He).withConfig({displayName:"DialogCardRoot",componentId:"sc-4n4xb3-2"})`&:not([hidden]){display:flex;}width:100%;min-height:0;max-height:100%;overflow:hidden;overflow:clip;`,_v=G(St).withConfig({displayName:"DialogLayout",componentId:"sc-4n4xb3-3"})`flex:1;min-height:0;width:100%;`,Mv=G(me).withConfig({displayName:"DialogHeader",componentId:"sc-4n4xb3-4"})`position:relative;z-index:2;`,Bv=G(me).withConfig({displayName:"DialogContent",componentId:"sc-4n4xb3-5"})`position:relative;z-index:1;overflow:auto;outline:none;`,Fv=G(me).withConfig({displayName:"DialogFooter",componentId:"sc-4n4xb3-6"})`position:relative;z-index:3;`,Ng=C.forwardRef(function(i,t){const e=ce.c(44),{__unstable_autoFocus:n,__unstable_hideCloseButton:r,children:s,contentRef:o,footer:a,header:l,id:u,onClickOutside:c,onClose:h,portal:d,radius:f,scheme:p,shadow:g,width:m}=i,O=pl(),b=d?O.elements?.[d]||null:O.element,x=fl().element;let S;e[0]!==f?(S=K(f),e[0]=f,e[1]=S):S=e[1];const w=S;let v;e[2]!==g?(v=K(g),e[2]=g,e[3]=v):v=e[3];const D=v;let R;e[4]!==m?(R=K(m),e[4]=m,e[5]=R):R=e[5];const $=R,k=C.useRef(null),A=C.useRef(null),P=Eo(),{isTopLayer:Q}=P,M=`${u}_label`,B=!!h&&r===!1,W=!!l||B;let X;e[6]===Symbol.for("react.memo_cache_sentinel")?(X=()=>k.current,e[6]=X):X=e[6],C.useImperativeHandle(t,X);let F;e[7]===Symbol.for("react.memo_cache_sentinel")?(F=()=>A.current,e[7]=F):F=e[7],C.useImperativeHandle(o,F);let _,j;e[8]!==n?(_=()=>{n&&k.current&&oo(k.current)},j=[n,k],e[8]=n,e[9]=_,e[10]=j):(_=e[9],j=e[10]),C.useEffect(_,j);let q;e[11]!==x||e[12]!==Q||e[13]!==h||e[14]!==b?(q=J=>{if(!Q||!h)return;const re=document.activeElement;re&&!zc(x,b,re)||J.key==="Escape"&&(J.preventDefault(),J.stopPropagation(),h())},e[11]=x,e[12]=Q,e[13]=h,e[14]=b,e[15]=q):q=e[15],$g(q);let E;e[16]!==x||e[17]!==Q||e[18]!==c||e[19]!==b?(E=Q&&c&&(J=>{const re=J.target;re&&!zc(x,b,re)||c()}),e[16]=x,e[17]=Q,e[18]=c,e[19]=b,e[20]=E):E=e[20];let Z;e[21]===Symbol.for("react.memo_cache_sentinel")?(Z=()=>[k.current],e[21]=Z):Z=e[21],dl(E,Z);let L;e[22]!==l||e[23]!==M||e[24]!==h||e[25]!==B||e[26]!==W?(L=W&&y.jsx(Mv,{children:y.jsxs(St,{align:"flex-start",padding:3,children:[y.jsx(me,{flex:1,padding:2,children:l&&y.jsx(et,{id:M,size:1,weight:"semibold",children:l})}),B&&y.jsx(me,{flex:"none",children:y.jsx(wi,{"aria-label":"Close dialog",disabled:!h,icon:Gp,mode:"bleed",onClick:h,padding:2})})]})}),e[22]=l,e[23]=M,e[24]=h,e[25]=B,e[26]=W,e[27]=L):L=e[27];let Y;e[28]!==s?(Y=y.jsx(Bv,{flex:1,ref:A,tabIndex:-1,children:s}),e[28]=s,e[29]=Y):Y=e[29];let N;e[30]!==a?(N=a&&y.jsx(Fv,{children:a}),e[30]=a,e[31]=N):N=e[31];let z;e[32]!==L||e[33]!==Y||e[34]!==N?(z=y.jsxs(_v,{direction:"column",children:[L,Y,N]}),e[32]=L,e[33]=Y,e[34]=N,e[35]=z):z=e[35];let I;e[36]!==w||e[37]!==p||e[38]!==D||e[39]!==z?(I=y.jsx(Rv,{radius:w,ref:k,scheme:p,shadow:D,children:z}),e[36]=w,e[37]=p,e[38]=D,e[39]=z,e[40]=I):I=e[40];let V;return e[41]!==I||e[42]!==$?(V=y.jsx(Tv,{"data-ui":"DialogCard",width:$,children:I}),e[41]=I,e[42]=$,e[43]=V):V=e[43],V});Ng.displayName="ForwardRef(DialogCard)";const Zv=C.forwardRef(function(i,t){const e=ce.c(70),n=Av(),{layer:r}=sr();let s,o,a,l,u,c,h,d,f,p,g,m,O,b,x,S,w,v,D,R,$;e[0]!==i?({__unstable_autoFocus:x,__unstable_hideCloseButton:S,cardRadius:w,cardShadow:v,children:a,contentRef:l,footer:u,header:c,id:h,onActivate:d,onClickOutside:f,onClose:p,onFocus:g,padding:D,portal:m,position:s,scheme:b,width:R,zOffset:o,animate:$,...O}=i,e[0]=i,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=u,e[6]=c,e[7]=h,e[8]=d,e[9]=f,e[10]=p,e[11]=g,e[12]=m,e[13]=O,e[14]=b,e[15]=x,e[16]=S,e[17]=w,e[18]=v,e[19]=D,e[20]=R,e[21]=$):(s=e[1],o=e[2],a=e[3],l=e[4],u=e[5],c=e[6],h=e[7],d=e[8],f=e[9],p=e[10],g=e[11],m=e[12],O=e[13],b=e[14],x=e[15],S=e[16],w=e[17],v=e[18],D=e[19],R=e[20],$=e[21]);const k=x===void 0?!0:x,A=S===void 0?!1:S,P=w===void 0?4:w,Q=v===void 0?3:v,M=D===void 0?3:D,B=R===void 0?0:R,W=$===void 0?!1:$,X=s??(n.position||"fixed"),F=o??(n.zOffset||r.dialog.zOffset),_=nh()?!1:W,j=pl(),q=m?j.elements?.[m]||null:j.element,E=fl().element;let Z;e[22]!==P?(Z=K(P),e[22]=P,e[23]=Z):Z=e[23];const L=Z;let Y;e[24]!==M?(Y=K(M),e[24]=M,e[25]=Y):Y=e[25];const N=Y;let z;e[26]!==X?(z=K(X),e[26]=X,e[27]=z):z=e[27];const I=z;let V;e[28]!==B?(V=K(B),e[28]=B,e[29]=V):V=e[29];const J=V;let re;e[30]!==F?(re=K(F),e[30]=F,e[31]=re):re=e[31];const ee=re,se=C.useRef(null),Oe=C.useRef(null),be=C.useRef(null),ne=C.useRef(null);let ke;e[32]!==g?(ke=Be=>{g?.(Be);const je=Be.target,Le=be.current;if(Le&&je===se.current){Xg(Le);return}if(Le&&je===Oe.current){oo(Le);return}nr(Be.target)&&(ne.current=Be.target)},e[32]=g,e[33]=ke):ke=e[33];const Qe=ke,Pe=`${h}_label`,ye=C.useRef(void 0);let we;e[34]!==E||e[35]!==q?(we=()=>{ye.current&&clearTimeout(ye.current),ye.current=setTimeout(()=>{const Be=document.activeElement;if(Be&&!zc(E,q,Be)){const je=ne.current;if(!je||!document.body.contains(je)){const Le=be.current;Le&&oo(Le);return}je.focus()}},0)},e[34]=E,e[35]=q,e[36]=we):we=e[36];const Ce=we;let Ee;e[37]===Symbol.for("react.memo_cache_sentinel")?(Ee=y.jsx("div",{ref:se,tabIndex:0}),e[37]=Ee):Ee=e[37];let De;e[38]!==k||e[39]!==L||e[40]!==Q||e[41]!==a||e[42]!==l||e[43]!==u||e[44]!==c||e[45]!==A||e[46]!==h||e[47]!==f||e[48]!==p||e[49]!==m||e[50]!==b||e[51]!==J?(De=y.jsx(Ng,{__unstable_autoFocus:k,__unstable_hideCloseButton:A,contentRef:l,footer:u,header:c,id:h,onClickOutside:f,onClose:p,portal:m,radius:L,ref:be,scheme:b,shadow:Q,width:J,children:a}),e[38]=k,e[39]=L,e[40]=Q,e[41]=a,e[42]=l,e[43]=u,e[44]=c,e[45]=A,e[46]=h,e[47]=f,e[48]=p,e[49]=m,e[50]=b,e[51]=J,e[52]=De):De=e[52];let xe;e[53]===Symbol.for("react.memo_cache_sentinel")?(xe=y.jsx("div",{ref:Oe,tabIndex:0}),e[53]=xe):xe=e[53];let ue;e[54]!==_||e[55]!==Qe||e[56]!==Ce||e[57]!==h||e[58]!==Pe||e[59]!==d||e[60]!==N||e[61]!==I||e[62]!==t||e[63]!==O||e[64]!==De||e[65]!==ee?(ue=y.jsxs(Ev,{...O,$animate:_,$padding:N,$position:I,"aria-labelledby":Pe,"aria-modal":!0,"data-ui":"Dialog",id:h,onActivate:d,onClick:Ce,onFocus:Qe,ref:t,role:"dialog",zOffset:ee,children:[Ee,De,xe]}),e[54]=_,e[55]=Qe,e[56]=Ce,e[57]=h,e[58]=Pe,e[59]=d,e[60]=N,e[61]=I,e[62]=t,e[63]=O,e[64]=De,e[65]=ee,e[66]=ue):ue=e[66];let ve;return e[67]!==m||e[68]!==ue?(ve=y.jsx(gl,{__unstable_name:m,children:ue}),e[67]=m,e[68]=ue,e[69]=ve):ve=e[69],ve});Zv.displayName="ForwardRef(Dialog)";const Wg=C.forwardRef(function(i,t){const e=ce.c(62),{__unstable_disableRestoreFocusOnClose:n,boundaryElement:r,button:s,id:o,menu:a,onClose:l,onOpen:u,placement:c,popoverScheme:h,portal:d,popover:f,popoverRadius:p,preventOverflow:g}=i,m=n===void 0?!1:n,O=d===void 0?!0:d,[b,x]=C.useState(!1),[S,w]=C.useState(null),[v,D]=C.useState(null);let R;e[0]===Symbol.for("react.memo_cache_sentinel")?(R=[],e[0]=R):R=e[0];const[$,k]=C.useState(R),A=C.useRef(b);let P,Q;e[1]!==u||e[2]!==b?(P=()=>{u&&b&&!A.current&&u()},Q=[u,b],e[1]=u,e[2]=b,e[3]=P,e[4]=Q):(P=e[3],Q=e[4]),C.useEffect(P,Q);let M,B;e[5]!==l||e[6]!==b?(M=()=>{l&&!b&&A.current&&l()},B=[l,b],e[5]=l,e[6]=b,e[7]=M,e[8]=B):(M=e[7],B=e[8]),C.useEffect(M,B);let W,X;e[9]!==b?(W=()=>{A.current=b},X=[b],e[9]=b,e[10]=W,e[11]=X):(W=e[10],X=e[11]),C.useEffect(W,X);let F;e[12]===Symbol.for("react.memo_cache_sentinel")?(F=()=>{x(zv),w(null)},e[12]=F):F=e[12];const _=F;let j;e[13]!==b?(j=xe=>{b&&xe.preventDefault()},e[13]=b,e[14]=j):j=e[14];const q=j;let E;e[15]===Symbol.for("react.memo_cache_sentinel")?(E=xe=>{if(xe.key==="ArrowDown"||xe.key==="Enter"||xe.key===" "){xe.preventDefault(),x(!0),w("first");return}if(xe.key==="ArrowUp"){xe.preventDefault(),x(!0),w("last");return}},e[15]=E):E=e[15];const Z=E;let L;e[16]!==v||e[17]!==$?(L=xe=>{const ue=xe.target;if(ue instanceof Node&&!(v&&(ue===v||v.contains(ue)))){for(const ve of $)if(ue===ve||ve.contains(ue))return;x(!1)}},e[16]=v,e[17]=$,e[18]=L):L=e[18];const Y=L;let N;e[19]!==v||e[20]!==m?(N=()=>{x(!1),!m&&v&&v.focus()},e[19]=v,e[20]=m,e[21]=N):N=e[21];const z=N;let I;e[22]!==$?(I=xe=>{const ue=xe.relatedTarget;if(ue instanceof Node){for(const ve of $)if(ve===ue||ve.contains(ue))return;x(!1)}},e[22]=$,e[23]=I):I=e[23];const V=I;let J;e[24]!==v||e[25]!==m?(J=()=>{x(!1),!m&&v&&v.focus()},e[24]=v,e[25]=m,e[26]=J):J=e[26];const re=J;let ee;e[27]===Symbol.for("react.memo_cache_sentinel")?(ee=xe=>(k(ue=>ue.concat([xe])),()=>k(ue=>ue.filter(ve=>ve!==xe))),e[27]=ee):ee=e[27];const se=ee;let Oe;e[28]!==v||e[29]!==V||e[30]!==re||e[31]!==Y||e[32]!==z||e[33]!==o||e[34]!==a||e[35]!==S?(Oe=a&&C.cloneElement(a,{"aria-labelledby":o,onBlurCapture:V,onClickOutside:Y,onEscape:z,onItemClick:re,originElement:v,registerElement:se,shouldFocus:S}),e[28]=v,e[29]=V,e[30]=re,e[31]=Y,e[32]=z,e[33]=o,e[34]=a,e[35]=S,e[36]=Oe):Oe=e[36];const be=Oe;let ne;e[37]!==s||e[38]!==q||e[39]!==o||e[40]!==b?(ne=s&&C.cloneElement(s,{"data-ui":"MenuButton",id:o,onClick:_,onKeyDown:Z,onMouseDown:q,"aria-haspopup":!0,"aria-expanded":b,ref:D,selected:s.props.selected??b}),e[37]=s,e[38]=q,e[39]=o,e[40]=b,e[41]=ne):ne=e[41];const ke=ne;let Qe,Pe;e[42]!==v?(Qe=()=>v,Pe=[v],e[42]=v,e[43]=Qe,e[44]=Pe):(Qe=e[43],Pe=e[44]),C.useImperativeHandle(t,Qe,Pe);let ye;e[45]!==f?(ye=f||{},e[45]=f,e[46]=ye):ye=e[46];let we;e[47]!==r||e[48]!==c||e[49]!==p||e[50]!==h||e[51]!==O||e[52]!==g||e[53]!==ye?(we={boundaryElement:r,overflow:"auto",placement:c,portal:O,preventOverflow:g,radius:p,scheme:h,...ye},e[47]=r,e[48]=c,e[49]=p,e[50]=h,e[51]=O,e[52]=g,e[53]=ye,e[54]=we):we=e[54];const Ce=we;let Ee;e[55]!==ke?(Ee=ke||y.jsx(y.Fragment,{}),e[55]=ke,e[56]=Ee):Ee=e[56];let De;return e[57]!==be||e[58]!==b||e[59]!==Ce||e[60]!==Ee?(De=y.jsx(To,{"data-ui":"MenuButton__popover",...Ce,content:be,open:b,children:Ee}),e[57]=be,e[58]=b,e[59]=Ce,e[60]=Ee,e[61]=De):De=e[61],De});Wg.displayName="ForwardRef(MenuButton)";function zv(i){return!i}const jv=Yu`
  0% {
    background-position: 100%;
  }
  100% {
    background-position: -100%;
  }
`,Iv=Re`
  background-image: linear-gradient(
    to right,
    var(--card-skeleton-color-from),
    var(--card-skeleton-color-to),
    var(--card-skeleton-color-from),
    var(--card-skeleton-color-from),
    var(--card-skeleton-color-from)
  );
  background-position: 100%;
  background-size: 200% 100%;
  background-attachment: fixed;
  animation-name: ${jv};
  animation-timing-function: ease-in-out;
  animation-iteration-count: infinite;
  animation-duration: 2000ms;
`,Lv=Re`
  opacity: ${({$visible:i})=>i?1:0};
  transition: opacity 200ms ease-in;

  @media screen and (prefers-reduced-motion: no-preference) {
    ${({$animated:i})=>i?Iv:Re`
            background-color: var(--card-skeleton-color-from);
          `}
  }

  @media screen and (prefers-reduced-motion: reduce) {
    background-color: var(--card-skeleton-color-from);
  }
`,Xv=G(me).withConfig({displayName:"StyledSkeleton",componentId:"sc-ebtpni-0"})(or,Lv),Yg=C.forwardRef(function(i,t){const e=ce.c(16);let n,r,s,o;e[0]!==i?({animated:o,delay:n,radius:r,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o):(n=e[1],r=e[2],s=e[3],o=e[4]);const a=o===void 0?!1:o,[l,u]=C.useState(!n);let c,h;e[5]!==n?(c=()=>{if(!n)return;const g=setTimeout(()=>{u(!0)},n);return()=>{clearTimeout(g)}},h=[n],e[5]=n,e[6]=c,e[7]=h):(c=e[6],h=e[7]),C.useEffect(c,h);let d;e[8]!==r?(d=K(r),e[8]=r,e[9]=d):d=e[9];const f=n?l:!0;let p;return e[10]!==a||e[11]!==t||e[12]!==s||e[13]!==d||e[14]!==f?(p=y.jsx(Xv,{...s,$animated:a,$radius:d,$visible:f,ref:t}),e[10]=a,e[11]=t,e[12]=s,e[13]=d,e[14]=f,e[15]=p):p=e[15],p});Yg.displayName="ForwardRef(Skeleton)";const ml=G(Yg).withConfig({displayName:"StyledSkeleton",componentId:"sc-2p7a1v-0"})(i=>{const{$size:t,$style:e}=i,{font:n,media:r}=fe(i.theme),s=n[e];return Me(r,t,o=>{const a=s.sizes[o];return{height:a.lineHeight-a.ascenderHeight-a.descenderHeight}})}),Nv=C.forwardRef(function(i,t){const e=ce.c(9);let n,r;e[0]!==i?({size:r,...n}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const s=r===void 0?2:r;let o;e[3]!==s?(o=K(s),e[3]=s,e[4]=o):o=e[4];const a=o;let l;return e[5]!==a||e[6]!==t||e[7]!==n?(l=y.jsx(ml,{...n,$size:a,ref:t,$style:"text"}),e[5]=a,e[6]=t,e[7]=n,e[8]=l):l=e[8],l});Nv.displayName="ForwardRef(TextSkeleton)";const Wv=C.forwardRef(function(i,t){const e=ce.c(9);let n,r;e[0]!==i?({size:r,...n}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const s=r===void 0?2:r;let o;e[3]!==s?(o=K(s),e[3]=s,e[4]=o):o=e[4];const a=o;let l;return e[5]!==a||e[6]!==t||e[7]!==n?(l=y.jsx(ml,{...n,$size:a,ref:t,$style:"label"}),e[5]=a,e[6]=t,e[7]=n,e[8]=l):l=e[8],l});Wv.displayName="ForwardRef(LabelSkeleton)";const Yv=C.forwardRef(function(i,t){const e=ce.c(9);let n,r;e[0]!==i?({size:r,...n}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const s=r===void 0?2:r;let o;e[3]!==s?(o=K(s),e[3]=s,e[4]=o):o=e[4];const a=o;let l;return e[5]!==a||e[6]!==t||e[7]!==n?(l=y.jsx(ml,{...n,$size:a,ref:t,$style:"heading"}),e[5]=a,e[6]=t,e[7]=n,e[8]=l):l=e[8],l});Yv.displayName="ForwardRef(HeadingSkeleton)";const qv=C.forwardRef(function(i,t){const e=ce.c(9);let n,r;e[0]!==i?({size:r,...n}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const s=r===void 0?2:r;let o;e[3]!==s?(o=K(s),e[3]=s,e[4]=o):o=e[4];const a=o;let l;return e[5]!==a||e[6]!==t||e[7]!==n?(l=y.jsx(ml,{...n,$size:a,ref:t,$style:"code"}),e[5]=a,e[6]=t,e[7]=n,e[8]=l):l=e[8],l});qv.displayName="ForwardRef(CodeSkeleton)";const Vv=C.forwardRef(function(i,t){const e=ce.c(9);let n,r;e[0]!==i?({flex:n,...r}=i,e[0]=i,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const s=i.tabIndex===void 0?0:i.tabIndex;let o;return e[3]!==n||e[4]!==i.children||e[5]!==t||e[6]!==r||e[7]!==s?(o=y.jsx(me,{"data-ui":"TabPanel",...r,flex:n,ref:t,role:"tabpanel",tabIndex:s,children:i.children}),e[3]=n,e[4]=i.children,e[5]=t,e[6]=r,e[7]=s,e[8]=o):o=e[8],o});Vv.displayName="ForwardRef(TabPanel)";const Sa=2;G(St).withConfig({displayName:"TextBox",componentId:"sc-1rr7rxo-0"})`overflow-x:auto;`;const Gv=G(He).withConfig({displayName:"StyledToast",componentId:"sc-1rr7rxo-1"})`pointer-events:all;width:100%;position:relative;overflow:hidden;overflow:clip;&[data-has-duration]{padding-bottom:calc(${Sa}px / 2);}`,Uv=G.div.withConfig({displayName:"LoadingBar",componentId:"sc-1rr7rxo-2"})`display:flex;position:absolute;bottom:0px;top:0px;left:0px;right:0px;pointer-events:none;z-index:-1;overflow:hidden;overflow:clip;background:transparent;align-items:flex-end;will-change:opacity;`;G(He).withConfig({displayName:"LoadingBarMask",componentId:"sc-1rr7rxo-3"})`position:absolute;top:0;left:-${Sa}px;right:-${Sa}px;bottom:${Sa}px;z-index:1;`;const Hv=G(He).withConfig({displayName:"LoadingBarProgress",componentId:"sc-1rr7rxo-4"})`display:block;height:100%;width:100%;transform-origin:0% 50%;background-color:${i=>{const{color:t}=fe(i.theme);return t.button.default[i.tone].enabled.bg}};`;Rr.create(Gv);Rr.create(St);Rr.create(et);Rr.create(Uv);Rr.create(Hv);const Kv=rr("@sanity/ui/context/toast",null);G(sh).withConfig({displayName:"StyledLayer",componentId:"sc-1tbwn58-0"})`box-sizing:border-box;position:fixed;right:0;bottom:0;list-style:none;pointer-events:none;max-width:420px;width:100%;`;function qg(){const i=C.useContext(Kv);if(!i)throw new Error("useToast(): missing context value");if(!Ao(i)||i.version!==0)throw new Error("useToast(): the context value is not compatible");return i}function Jv(i,t,e){const n=t.indexOf(e),r=t.slice(0,n),s=r.length;for(let o=s-1;o>=0;o-=1){const a=r[o].getAttribute("data-tree-key");if(!a)continue;const l=a.split("/");l.pop();const u=[];let c=!0;for(let h=0;h<l.length;h+=1){u.push(l[h]);const d=u.join("/");if(!i[d]?.expanded){c=!1;break}}if(c)return r[o]}return null}function ek(i,t,e){const n=t.indexOf(e),r=t.slice(n),s=t.length;for(let o=1;o<s;o+=1){if(!r[o])continue;const a=r[o].getAttribute("data-tree-key");if(!a)continue;const l=a.split("/");l.pop();const u=[];let c=!0;for(let h=0;h<l.length;h+=1){u.push(l[h]);const d=u.join("/");if(!i[d]?.expanded){c=!1;break}}if(c)return r[o]}return null}function xd(i){if(i.getAttribute("role")==="treeitem"&&i.focus(),i.getAttribute("role")==="none"){const t=i.firstChild;t&&t instanceof HTMLElement&&t.focus()}}const tk=rr("@sanity/ui/context/tree",null),ik=C.forwardRef(function(i,t){const e=ce.c(37);let n,r,s,o;e[0]!==i?({children:n,space:o,onFocus:r,...s}=i,e[0]=i,e[1]=n,e[2]=r,e[3]=s,e[4]=o):(n=e[1],r=e[2],s=e[3],o=e[4]);const a=o===void 0?1:o,l=C.useRef(null),[u,c]=C.useState(null),h=C.useRef(u);let d;e[5]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[5]=d):d=e[5];const f=d;let p;e[6]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[6]=p):p=e[6];const[g,m]=C.useState(p);let O;e[7]===Symbol.for("react.memo_cache_sentinel")?(O={},e[7]=O):O=e[7];const[b,x]=C.useState(O),S=C.useRef(b);let w;e[8]===Symbol.for("react.memo_cache_sentinel")?(w=()=>l.current,e[8]=w):w=e[8],C.useImperativeHandle(t,w);let v,D;e[9]!==u?(v=()=>{h.current=u},D=[u],e[9]=u,e[10]=v,e[11]=D):(v=e[10],D=e[11]),C.useEffect(v,D);let R,$;e[12]!==b?(R=()=>{S.current=b},$=[b],e[12]=b,e[13]=R,e[14]=$):(R=e[13],$=e[14]),C.useEffect(R,$);let k;e[15]===Symbol.for("react.memo_cache_sentinel")?(k=(Y,N,z,I)=>(x(V=>({...V,[N]:{element:Y,expanded:z}})),I&&c(Y),()=>{x(V=>{const J={...V};return delete J[N],J})}),e[15]=k):k=e[15];const A=k;let P;e[16]===Symbol.for("react.memo_cache_sentinel")?(P=(Y,N)=>{x(z=>{const I=z[Y];return I?{...z,[Y]:{...I,expanded:N}}:z})},e[16]=P):P=e[16];const Q=P,M=u||g[0]||null;let B;e[17]!==a||e[18]!==b||e[19]!==M?(B={version:0,focusedElement:M,level:0,path:f,registerItem:A,setExpanded:Q,setFocusedElement:c,space:a,state:b},e[17]=a,e[18]=b,e[19]=M,e[20]=B):B=e[20];const W=B;let X;e[21]!==g?(X=Y=>{if(h.current){if(Y.key==="ArrowDown"){Y.preventDefault();const N=ek(S.current,g,h.current);N&&(xd(N),c(N));return}if(Y.key==="ArrowUp"){Y.preventDefault();const N=Jv(S.current,g,h.current);N&&(xd(N),c(N));return}if(Y.key==="ArrowLeft"){Y.preventDefault();const N=h.current.getAttribute("data-tree-key");if(!N)return;const z=S.current[N];if(!z)return;if(z.expanded)x(I=>{const V=I[N];return V?{...I,[N]:{...V,expanded:!1}}:I});else{const I=N.split("/");I.pop();const V=I.join("/"),J=V&&S.current[V];J&&(J.element.focus(),c(J.element))}return}if(Y.key==="ArrowRight"){Y.preventDefault();const N=h.current.getAttribute("data-tree-key");if(!N)return;S.current[N]?.expanded||x(z=>{const I=z[N];return I?{...z,[N]:{...I,expanded:!0}}:z});return}}},e[21]=g,e[22]=X):X=e[22];const F=X;let _;e[23]!==r?(_=Y=>{c(Y.target),r?.(Y)},e[23]=r,e[24]=_):_=e[24];const j=_;let q;e[25]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{if(!l.current)return;const Y=Array.from(l.current.querySelectorAll('[data-ui="TreeItem"]'));m(Y)},e[25]=q):q=e[25];let E;e[26]!==n?(E=[n],e[26]=n,e[27]=E):E=e[27],C.useEffect(q,E);let Z;e[28]!==n||e[29]!==j||e[30]!==F||e[31]!==s||e[32]!==a?(Z=y.jsx(oi,{as:"ul","data-ui":"Tree",...s,onFocus:j,onKeyDown:F,ref:l,role:"tree",space:a,children:n}),e[28]=n,e[29]=j,e[30]=F,e[31]=s,e[32]=a,e[33]=Z):Z=e[33];let L;return e[34]!==W||e[35]!==Z?(L=y.jsx(tk.Provider,{value:W,children:Z}),e[34]=W,e[35]=Z,e[36]=L):L=e[36],L});ik.displayName="ForwardRef(Tree)";G(et).withConfig({displayName:"ToggleArrowText",componentId:"sc-iiskig-2"})`& > svg{transition:transform 100ms;}`;var nk=Object.defineProperty,wd=Object.getOwnPropertySymbols,rk=Object.prototype.hasOwnProperty,sk=Object.prototype.propertyIsEnumerable,Sd=(i,t,e)=>t in i?nk(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,vd=(i,t)=>{for(var e in t||(t={}))rk.call(t,e)&&Sd(i,e,t[e]);if(wd)for(var e of wd(t))sk.call(t,e)&&Sd(i,e,t[e]);return i};const kd=function(i){const{children:t,className:e,split:n,style:r,size:s,eleRef:o}=i;let a={flex:1,position:"relative",outline:"none"};s!==void 0&&(n==="vertical"?a.width=s:(a.height=s,a.display="flex"),a.flex="none"),a=vd(vd({},a),r);const l=["Pane",n,e].filter(Boolean).join(" ");return y.jsx("div",{role:"region",ref:o,className:l,style:a,children:t})},jc="Resizer",ok=function(i){const{className:t=jc,onClick:e,onDoubleClick:n,onMouseDown:r,onTouchEnd:s,onTouchStart:o,resizerClassName:a,split:l,style:u}=i,c=[a,l,t].filter(Boolean).join(" ");return y.jsx("span",{role:"separator",className:c,style:u,onMouseDown:h=>r(h.nativeEvent),onTouchStart:h=>{h.preventDefault(),o(h.nativeEvent)},onTouchEnd:h=>{h.preventDefault(),s(h.nativeEvent)},onClick:h=>{e&&(h.preventDefault(),e(h.nativeEvent))},onDoubleClick:h=>{n&&(h.preventDefault(),n(h.nativeEvent))}})};var ak=Object.defineProperty,lk=Object.defineProperties,ck=Object.getOwnPropertyDescriptors,Cd=Object.getOwnPropertySymbols,uk=Object.prototype.hasOwnProperty,hk=Object.prototype.propertyIsEnumerable,Ic=(i,t,e)=>t in i?ak(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,rn=(i,t)=>{for(var e in t||(t={}))uk.call(t,e)&&Ic(i,e,t[e]);if(Cd)for(var e of Cd(t))hk.call(t,e)&&Ic(i,e,t[e]);return i},Ma=(i,t)=>lk(i,ck(t)),va=(i,t,e)=>Ic(i,typeof t!="symbol"?t+"":t,e);const Vg={display:"flex",flex:1,height:"100%",position:"absolute",outline:"none",overflow:"hidden",MozUserSelect:"text",WebkitUserSelect:"text",msUserSelect:"text",userSelect:"text"},dk=Ma(rn({},Vg),{flexDirection:"row",left:0,right:0}),fk=Ma(rn({},Vg),{bottom:0,flexDirection:"column",minHeight:"100%",top:0,width:"100%"}),Wl={},Gg=class Ns extends C.Component{constructor(t){super(t),va(this,"pane1",null),va(this,"pane2",null),va(this,"splitPane",null),this.onMouseDown=this.onMouseDown.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this);const{size:e,defaultSize:n,minSize:r,maxSize:s,primary:o}=t,a=e!==void 0?e:$d(n,r,s,void 0);this.state={active:!1,resized:!1,pane1Size:o==="first"?a:void 0,pane2Size:o==="second"?a:void 0,instanceProps:{size:e}}}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove),this.setState(Ns.getSizeUpdate(this.props,this.state))}static getDerivedStateFromProps(t,e){return Ns.getSizeUpdate(t,e)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove)}onMouseDown(t){this.onTouchStart(Ma(rn({},t),{touches:[{clientX:t.clientX,clientY:t.clientY}]}))}onTouchStart(t){const{allowResize:e,onDragStarted:n,split:r}=this.props;if(e){Dd(document,window);const s=r==="vertical"?t.touches[0].clientX:t.touches[0].clientY;typeof n=="function"&&n(),this.setState({active:!0,position:s})}}onMouseMove(t){const e=Object.assign({},t,{touches:[{clientX:t.clientX,clientY:t.clientY}]});this.onTouchMove(e)}onTouchMove(t){if(!this.state.active||!this.props.allowResize)return;const{position:e=0}=this.state,{maxSize:n,minSize:r=Ns.defaultProps.minSize,onChange:s,split:o=Ns.defaultProps.split,step:a}=this.props;Dd(document,window);const l=this.props.primary==="first",u=l?this.pane1:this.pane2,c=l?this.pane2:this.pane1;if(!u||!c||!u.getBoundingClientRect)return;const h=u,d=c,f=h.getBoundingClientRect().width,p=h.getBoundingClientRect().height,g=o==="vertical"?t.touches[0].clientX:t.touches[0].clientY,m=o==="vertical"?f:p;let O=e-g;if(a){if(Math.abs(O)<a)return;O=~~(O/a)*a}let b=l?O:-O;const x=parseInt(window.getComputedStyle(h).order),S=parseInt(window.getComputedStyle(d).order);x>S&&(b=-b);let w=n;this.splitPane&&n!==void 0&&n<=0&&(o==="vertical"?w=this.splitPane.getBoundingClientRect().width+n:w=this.splitPane.getBoundingClientRect().height+n);let v=m-b;const D=e-O;r&&v<r?v=r:w!==void 0&&v>w?v=w:this.setState({position:D,resized:!0}),s&&s(v);const R=l?{pane1Size:v,pane2Size:void 0}:{pane2Size:v,pane1Size:void 0};this.setState(rn({draggedSize:v},R))}onMouseUp(){if(!this.state.active||!this.props.allowResize)return;const{onDragFinished:t}=this.props,{draggedSize:e}=this.state;typeof e<"u"&&typeof t=="function"&&t(e),this.setState({active:!1})}static getSizeUpdate(t,e){const{instanceProps:n}=e;if(n.size===t.size&&t.size!==void 0)return{};const r=t.size!==void 0?t.size:$d(t.defaultSize,t.minSize,t.maxSize,e.draggedSize),s=t.primary==="first"?{pane1Size:r,pane2Size:void 0}:{pane2Size:r,pane1Size:void 0};return Ma(rn(rn({},s),typeof t.size>"u"?{}:{draggedSize:r}),{instanceProps:{size:t.size}})}render(){const{allowResize:t,children:e,className:n,onResizerClick:r,onResizerDoubleClick:s,paneClassName:o,pane1ClassName:a,pane2ClassName:l,paneStyle:u,pane1Style:c,pane2Style:h,resizerClassName:d=jc,resizerStyle:f,split:p,style:g}=this.props,{pane1Size:m,pane2Size:O}=this.state,b=t?"":"disabled",x=d&&`${d} ${jc}`,S=pk(e),w=p==="vertical"?dk:fk,v=g?rn(rn({},w),g):w,D=["SplitPane",n,p,b].filter(Boolean).join(" "),R=Qd(rn(rn({},u),c),Wl),$=Qd(rn(rn({},u),h),Wl),k=["Pane1",o,a].join(" "),A=["Pane2",o,l].join(" ");return y.jsxs("div",{"data-testid":"split-pane",className:D,style:v,ref:P=>{this.splitPane=P},children:[y.jsx(kd,{className:k,eleRef:P=>{this.pane1=P},size:m,split:p,style:R,children:S[0]},"pane1"),y.jsx(ok,{className:b,onClick:r,onDoubleClick:s,onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onTouchEnd:this.onMouseUp,resizerClassName:x,split:p||"vertical",style:f||Wl},"resizer"),y.jsx(kd,{className:A,eleRef:P=>{this.pane2=P},size:O,split:p,style:$,children:S[1]},"pane2")]})}};va(Gg,"defaultProps",{allowResize:!0,minSize:50,primary:"first",split:"vertical",paneClassName:"",pane1ClassName:"",pane2ClassName:""});let Yl=Gg;function Dd(i,t){var e;if("selection"in i&&typeof i.selection=="object"&&i.selection&&"empty"in i.selection&&typeof i.selection.empty=="function")try{i.selection.empty()}catch{}else if(typeof t<"u"&&typeof t.getSelection=="function")try{(e=t.getSelection())==null||e.removeAllRanges()}catch{}}function $d(i,t,e,n){if(typeof n=="number"){const r=typeof t=="number"?t:0,s=typeof e=="number"&&e>=0?e:1/0;return Math.max(r,Math.min(s,n))}return i!==void 0?i:t}function pk(i){return C.Children.toArray(i).filter(t=>t)}function gk(i){return i===null||typeof i>"u"||Object.keys(i).length===0}function Qd(i,t){return gk(i)?t:i}let Lc=[],Ug=[];(()=>{let i="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=0,e=0;t<i.length;t++)(t%2?Ug:Lc).push(e=e+i[t])})();function mk(i){if(i<768)return!1;for(let t=0,e=Lc.length;;){let n=t+e>>1;if(i<Lc[n])e=n;else if(i>=Ug[n])t=n+1;else return!0;if(t==e)return!1}}function Pd(i){return i>=127462&&i<=127487}const Ad=8205;function Ok(i,t,e=!0,n=!0){return(e?Hg:bk)(i,t,n)}function Hg(i,t,e){if(t==i.length)return t;t&&Kg(i.charCodeAt(t))&&Jg(i.charCodeAt(t-1))&&t--;let n=ql(i,t);for(t+=Ed(n);t<i.length;){let r=ql(i,t);if(n==Ad||r==Ad||e&&mk(r))t+=Ed(r),n=r;else if(Pd(r)){let s=0,o=t-2;for(;o>=0&&Pd(ql(i,o));)s++,o-=2;if(s%2==0)break;t+=2}else break}return t}function bk(i,t,e){for(;t>0;){let n=Hg(i,t-2,e);if(n<t)return n;t--}return 0}function ql(i,t){let e=i.charCodeAt(t);if(!Jg(e)||t+1==i.length)return e;let n=i.charCodeAt(t+1);return Kg(n)?(e-55296<<10)+(n-56320)+65536:e}function Kg(i){return i>=56320&&i<57344}function Jg(i){return i>=55296&&i<56320}function Ed(i){return i<65536?1:2}class Ue{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,n){[t,e]=ws(this,t,e);let r=[];return this.decompose(0,t,r,2),n.length&&n.decompose(0,n.length,r,3),this.decompose(e,this.length,r,1),En.from(r,this.length-(e-t)+n.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=ws(this,t,e);let n=[];return this.decompose(t,e,n,0),En.from(n,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),n=this.length-this.scanIdentical(t,-1),r=new Hs(this),s=new Hs(t);for(let o=e,a=e;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(a+=r.value.length,r.done||a>=n)return!0}}iter(t=1){return new Hs(this,t)}iterRange(t,e=this.length){return new em(this,t,e)}iterLines(t,e){let n;if(t==null)n=this.iter();else{e==null&&(e=this.lines+1);let r=this.line(t).from;n=this.iterRange(r,Math.max(r,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new tm(n)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?Ue.empty:t.length<=32?new $t(t):En.from($t.split(t,[]))}}class $t extends Ue{constructor(t,e=yk(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,n,r){for(let s=0;;s++){let o=this.text[s],a=r+o.length;if((e?n:a)>=t)return new xk(r,a,n,o);r=a+1,n++}}decompose(t,e,n,r){let s=t<=0&&e>=this.length?this:new $t(Td(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(r&1){let o=n.pop(),a=ka(s.text,o.text.slice(),0,s.length);if(a.length<=32)n.push(new $t(a,o.length+s.length));else{let l=a.length>>1;n.push(new $t(a.slice(0,l)),new $t(a.slice(l)))}}else n.push(s)}replace(t,e,n){if(!(n instanceof $t))return super.replace(t,e,n);[t,e]=ws(this,t,e);let r=ka(this.text,ka(n.text,Td(this.text,0,t)),e),s=this.length+n.length-(e-t);return r.length<=32?new $t(r,s):En.from($t.split(r,[]),s)}sliceString(t,e=this.length,n=`
`){[t,e]=ws(this,t,e);let r="";for(let s=0,o=0;s<=e&&o<this.text.length;o++){let a=this.text[o],l=s+a.length;s>t&&o&&(r+=n),t<l&&e>s&&(r+=a.slice(Math.max(0,t-s),e-s)),s=l+1}return r}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let n=[],r=-1;for(let s of t)n.push(s),r+=s.length+1,n.length==32&&(e.push(new $t(n,r)),n=[],r=-1);return r>-1&&e.push(new $t(n,r)),e}}class En extends Ue{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let n of t)this.lines+=n.lines}lineInner(t,e,n,r){for(let s=0;;s++){let o=this.children[s],a=r+o.length,l=n+o.lines-1;if((e?l:a)>=t)return o.lineInner(t,e,n,r);r=a+1,n=l+1}}decompose(t,e,n,r){for(let s=0,o=0;o<=e&&s<this.children.length;s++){let a=this.children[s],l=o+a.length;if(t<=l&&e>=o){let u=r&((o<=t?1:0)|(l>=e?2:0));o>=t&&l<=e&&!u?n.push(a):a.decompose(t-o,e-o,n,u)}o=l+1}}replace(t,e,n){if([t,e]=ws(this,t,e),n.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.length;if(t>=s&&e<=a){let l=o.replace(t-s,e-s,n),u=this.lines-o.lines+l.lines;if(l.lines<u>>4&&l.lines>u>>6){let c=this.children.slice();return c[r]=l,new En(c,this.length-(e-t)+n.length)}return super.replace(s,a,l)}s=a+1}return super.replace(t,e,n)}sliceString(t,e=this.length,n=`
`){[t,e]=ws(this,t,e);let r="";for(let s=0,o=0;s<this.children.length&&o<=e;s++){let a=this.children[s],l=o+a.length;o>t&&s&&(r+=n),t<l&&e>o&&(r+=a.sliceString(t-o,e-o,n)),o=l+1}return r}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof En))return 0;let n=0,[r,s,o,a]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;r+=e,s+=e){if(r==o||s==a)return n;let l=this.children[r],u=t.children[s];if(l!=u)return n+l.scanIdentical(u,e);n+=l.length+1}}static from(t,e=t.reduce((n,r)=>n+r.length+1,-1)){let n=0;for(let f of t)n+=f.lines;if(n<32){let f=[];for(let p of t)p.flatten(f);return new $t(f,e)}let r=Math.max(32,n>>5),s=r<<1,o=r>>1,a=[],l=0,u=-1,c=[];function h(f){let p;if(f.lines>s&&f instanceof En)for(let g of f.children)h(g);else f.lines>o&&(l>o||!l)?(d(),a.push(f)):f instanceof $t&&l&&(p=c[c.length-1])instanceof $t&&f.lines+p.lines<=32?(l+=f.lines,u+=f.length+1,c[c.length-1]=new $t(p.text.concat(f.text),p.length+1+f.length)):(l+f.lines>r&&d(),l+=f.lines,u+=f.length+1,c.push(f))}function d(){l!=0&&(a.push(c.length==1?c[0]:En.from(c,u)),u=-1,l=c.length=0)}for(let f of t)h(f);return d(),a.length==1?a[0]:new En(a,e)}}Ue.empty=new $t([""],0);function yk(i){let t=-1;for(let e of i)t+=e.length+1;return t}function ka(i,t,e=0,n=1e9){for(let r=0,s=0,o=!0;s<i.length&&r<=n;s++){let a=i[s],l=r+a.length;l>=e&&(l>n&&(a=a.slice(0,n-r)),r<e&&(a=a.slice(e-r)),o?(t[t.length-1]+=a,o=!1):t.push(a)),r=l+1}return t}function Td(i,t,e){return ka(i,[""],t,e)}class Hs{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof $t?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,r=this.nodes[n],s=this.offsets[n],o=s>>1,a=r instanceof $t?r.text.length:r.children.length;if(o==(e>0?a:0)){if(n==0)return this.done=!0,this.value="",this;e>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(e>0?0:1)){if(this.offsets[n]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(r instanceof $t){let l=r.text[o+(e<0?-1:0)];if(this.offsets[n]+=e,l.length>Math.max(0,t))return this.value=t==0?l:e>0?l.slice(t):l.slice(0,l.length-t),this;t-=l.length}else{let l=r.children[o+(e<0?-1:0)];t>l.length?(t-=l.length,this.offsets[n]+=e):(e<0&&this.offsets[n]--,this.nodes.push(l),this.offsets.push(e>0?1:(l instanceof $t?l.text.length:l.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class em{constructor(t,e,n){this.value="",this.done=!1,this.cursor=new Hs(t,e>n?-1:1),this.pos=e>n?t.length:0,this.from=Math.min(e,n),this.to=Math.max(e,n)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let n=e<0?this.pos-this.from:this.to-this.pos;t>n&&(t=n),n-=t;let{value:r}=this.cursor.next(t);return this.pos+=(r.length+t)*e,this.value=r.length<=n?r:e<0?r.slice(r.length-n):r.slice(0,n),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class tm{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:n,value:r}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Ue.prototype[Symbol.iterator]=function(){return this.iter()},Hs.prototype[Symbol.iterator]=em.prototype[Symbol.iterator]=tm.prototype[Symbol.iterator]=function(){return this});class xk{constructor(t,e,n,r){this.from=t,this.to=e,this.number=n,this.text=r}get length(){return this.to-this.from}}function ws(i,t,e){return t=Math.max(0,Math.min(i.length,t)),[t,Math.max(t,Math.min(i.length,e))]}function fi(i,t,e=!0,n=!0){return Ok(i,t,e,n)}function wk(i){return i>=56320&&i<57344}function Sk(i){return i>=55296&&i<56320}function Fi(i,t){let e=i.charCodeAt(t);if(!Sk(e)||t+1==i.length)return e;let n=i.charCodeAt(t+1);return wk(n)?(e-55296<<10)+(n-56320)+65536:e}function hh(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}function Tn(i){return i<65536?1:2}const Xc=/\r\n?|\n/;var Ai=(function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i})(Ai||(Ai={}));class Bn{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let n=this.sections[e+1];t+=n<0?this.sections[e]:n}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,n=0,r=0;e<this.sections.length;){let s=this.sections[e++],o=this.sections[e++];o<0?(t(n,r,s),r+=s):r+=o,n+=s}}iterChangedRanges(t,e=!1){Nc(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];r<0?t.push(n,r):t.push(r,n)}return new Bn(t)}composeDesc(t){return this.empty?t:t.empty?this:im(this,t)}mapDesc(t,e=!1){return t.empty?this:Wc(this,t,e)}mapPos(t,e=-1,n=Ai.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],u=r+a;if(l<0){if(u>t)return s+(t-r);s+=a}else{if(n!=Ai.Simple&&u>=t&&(n==Ai.TrackDel&&r<t&&u>t||n==Ai.TrackBefore&&r<t||n==Ai.TrackAfter&&u>t))return null;if(u>t||u==t&&e<0&&!a)return t==r||e<0?s:s+l;s+=l}r=u}if(t>r)throw new RangeError(`Position ${t} is out of range for changeset of length ${r}`);return s}touchesRange(t,e=t){for(let n=0,r=0;n<this.sections.length&&r<=e;){let s=this.sections[n++],o=this.sections[n++],a=r+s;if(o>=0&&r<=e&&a>=t)return r<t&&a>e?"cover":!0;r=a}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let n=this.sections[e++],r=this.sections[e++];t+=(t?" ":"")+n+(r>=0?":"+r:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Bn(t)}static create(t){return new Bn(t)}}class Vt extends Bn{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Nc(this,(e,n,r,s,o)=>t=t.replace(r,r+(n-e),o),!1),t}mapDesc(t,e=!1){return Wc(this,t,e,!0)}invert(t){let e=this.sections.slice(),n=[];for(let r=0,s=0;r<e.length;r+=2){let o=e[r],a=e[r+1];if(a>=0){e[r]=a,e[r+1]=o;let l=r>>1;for(;n.length<l;)n.push(Ue.empty);n.push(o?t.slice(s,s+o):Ue.empty)}s+=o}return new Vt(e,n)}compose(t){return this.empty?t:t.empty?this:im(this,t,!0)}map(t,e=!1){return t.empty?this:Wc(this,t,e,!0)}iterChanges(t,e=!1){Nc(this,t,e)}get desc(){return Bn.create(this.sections)}filter(t){let e=[],n=[],r=[],s=new ao(this);e:for(let o=0,a=0;;){let l=o==t.length?1e9:t[o++];for(;a<l||a==l&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,l-a);yi(r,c,-1);let h=s.ins==-1?-1:s.off==0?s.ins:0;yi(e,c,h),h>0&&xr(n,e,s.text),s.forward(c),a+=c}let u=t[o++];for(;a<u;){if(s.done)break e;let c=Math.min(s.len,u-a);yi(e,c,-1),yi(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),a+=c}}return{changes:new Vt(e,n),filtered:Bn.create(r)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let n=this.sections[e],r=this.sections[e+1];r<0?t.push(n):r==0?t.push([n]):t.push([n].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,n){let r=[],s=[],o=0,a=null;function l(c=!1){if(!c&&!r.length)return;o<e&&yi(r,e-o,-1);let h=new Vt(r,s);a=a?a.compose(h.map(a)):h,r=[],s=[],o=0}function u(c){if(Array.isArray(c))for(let h of c)u(h);else if(c instanceof Vt){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);l(),a=a?a.compose(c.map(a)):c}else{let{from:h,to:d=h,insert:f}=c;if(h>d||h<0||d>e)throw new RangeError(`Invalid change range ${h} to ${d} (in doc of length ${e})`);let p=f?typeof f=="string"?Ue.of(f.split(n||Xc)):f:Ue.empty,g=p.length;if(h==d&&g==0)return;h<o&&l(),h>o&&yi(r,h-o,-1),yi(r,d-h,g),xr(s,r,p),o=d}}return u(t),l(!a),a}static empty(t){return new Vt(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],n=[];for(let r=0;r<t.length;r++){let s=t[r];if(typeof s=="number")e.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)e.push(s[0],0);else{for(;n.length<r;)n.push(Ue.empty);n[r]=Ue.of(s.slice(1)),e.push(s[0],n[r].length)}}}return new Vt(e,n)}static createSet(t,e){return new Vt(t,e)}}function yi(i,t,e,n=!1){if(t==0&&e<=0)return;let r=i.length-2;r>=0&&e<=0&&e==i[r+1]?i[r]+=t:r>=0&&t==0&&i[r]==0?i[r+1]+=e:n?(i[r]+=t,i[r+1]+=e):i.push(t,e)}function xr(i,t,e){if(e.length==0)return;let n=t.length-2>>1;if(n<i.length)i[i.length-1]=i[i.length-1].append(e);else{for(;i.length<n;)i.push(Ue.empty);i.push(e)}}function Nc(i,t,e){let n=i.inserted;for(let r=0,s=0,o=0;o<i.sections.length;){let a=i.sections[o++],l=i.sections[o++];if(l<0)r+=a,s+=a;else{let u=r,c=s,h=Ue.empty;for(;u+=a,c+=l,l&&n&&(h=h.append(n[o-2>>1])),!(e||o==i.sections.length||i.sections[o+1]<0);)a=i.sections[o++],l=i.sections[o++];t(r,u,s,c,h),r=u,s=c}}}function Wc(i,t,e,n=!1){let r=[],s=n?[]:null,o=new ao(i),a=new ao(t);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let u=Math.min(o.len,a.len);yi(r,u,-1),o.forward(u),a.forward(u)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!e))){let u=a.len;for(yi(r,a.ins,-1);u;){let c=Math.min(o.len,u);o.ins>=0&&l<o.i&&o.len<=c&&(yi(r,0,o.ins),s&&xr(s,r,o.text),l=o.i),o.forward(c),u-=c}a.next()}else if(o.ins>=0){let u=0,c=o.len;for(;c;)if(a.ins==-1){let h=Math.min(c,a.len);u+=h,c-=h,a.forward(h)}else if(a.ins==0&&a.len<c)c-=a.len,a.next();else break;yi(r,u,l<o.i?o.ins:0),s&&l<o.i&&xr(s,r,o.text),l=o.i,o.forward(o.len-c)}else{if(o.done&&a.done)return s?Vt.createSet(r,s):Bn.create(r);throw new Error("Mismatched change set lengths")}}}function im(i,t,e=!1){let n=[],r=e?[]:null,s=new ao(i),o=new ao(t);for(let a=!1;;){if(s.done&&o.done)return r?Vt.createSet(n,r):Bn.create(n);if(s.ins==0)yi(n,s.len,0,a),s.next();else if(o.len==0&&!o.done)yi(n,0,o.ins,a),r&&xr(r,n,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(s.len2,o.len),u=n.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;yi(n,l,c,a),r&&c&&xr(r,n,o.text)}else o.ins==-1?(yi(n,s.off?0:s.len,l,a),r&&xr(r,n,s.textBit(l))):(yi(n,s.off?0:s.len,o.off?0:o.ins,a),r&&!o.off&&xr(r,n,o.text));a=(s.ins>l||o.ins>=0&&o.len>l)&&(a||n.length>u),s.forward2(l),o.forward(l)}}}}class ao{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?Ue.empty:t[e]}textBit(t){let{inserted:e}=this.set,n=this.i-2>>1;return n>=e.length&&!t?Ue.empty:e[n].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class Nr{constructor(t,e,n){this.from=t,this.to=e,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,e=-1){let n,r;return this.empty?n=r=t.mapPos(this.from,e):(n=t.mapPos(this.from,1),r=t.mapPos(this.to,-1)),n==this.from&&r==this.to?this:new Nr(n,r,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return U.range(t,e);let n=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return U.range(this.anchor,n)}eq(t,e=!1){return this.anchor==t.anchor&&this.head==t.head&&(!e||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return U.range(t.anchor,t.head)}static create(t,e,n){return new Nr(t,e,n)}}class U{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:U.create(this.ranges.map(n=>n.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(t.ranges[n],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new U([this.main],0)}addRange(t,e=!0){return U.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let n=this.ranges.slice();return n[e]=t,U.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new U(t.ranges.map(e=>Nr.fromJSON(e)),t.main)}static single(t,e=t){return new U([U.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,r=0;r<t.length;r++){let s=t[r];if(s.empty?s.from<=n:s.from<n)return U.normalized(t.slice(),e);n=s.to}return new U(t,e)}static cursor(t,e=0,n,r){return Nr.create(t,t,(e==0?0:e<0?8:16)|(n==null?7:Math.min(6,n))|(r??16777215)<<6)}static range(t,e,n,r){let s=(n??16777215)<<6|(r==null?7:Math.min(6,r));return e<t?Nr.create(e,t,48|s):Nr.create(t,e,(e>t?8:0)|s)}static normalized(t,e=0){let n=t[e];t.sort((r,s)=>r.from-s.from),e=t.indexOf(n);for(let r=1;r<t.length;r++){let s=t[r],o=t[r-1];if(s.empty?s.from<=o.to:s.from<o.to){let a=o.from,l=Math.max(s.to,o.to);r<=e&&e--,t.splice(--r,2,s.anchor>s.head?U.range(l,a):U.range(a,l))}}return new U(t,e)}}function nm(i,t){for(let e of i.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let dh=0;class pe{constructor(t,e,n,r,s){this.combine=t,this.compareInput=e,this.compare=n,this.isStatic=r,this.id=dh++,this.default=t([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(t={}){return new pe(t.combine||(e=>e),t.compareInput||((e,n)=>e===n),t.compare||(t.combine?(e,n)=>e===n:fh),!!t.static,t.enables)}of(t){return new Ca([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Ca(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Ca(t,this,2,e)}from(t,e){return e||(e=n=>n),this.compute([t],n=>e(n.field(t)))}}function fh(i,t){return i==t||i.length==t.length&&i.every((e,n)=>e===t[n])}class Ca{constructor(t,e,n,r){this.dependencies=t,this.facet=e,this.type=n,this.value=r,this.id=dh++}dynamicSlot(t){var e;let n=this.value,r=this.facet.compareInput,s=this.id,o=t[s]>>1,a=this.type==2,l=!1,u=!1,c=[];for(let h of this.dependencies)h=="doc"?l=!0:h=="selection"?u=!0:(((e=t[h.id])!==null&&e!==void 0?e:1)&1)==0&&c.push(t[h.id]);return{create(h){return h.values[o]=n(h),1},update(h,d){if(l&&d.docChanged||u&&(d.docChanged||d.selection)||Yc(h,c)){let f=n(h);if(a?!Rd(f,h.values[o],r):!r(f,h.values[o]))return h.values[o]=f,1}return 0},reconfigure:(h,d)=>{let f,p=d.config.address[s];if(p!=null){let g=Fa(d,p);if(this.dependencies.every(m=>m instanceof pe?d.facet(m)===h.facet(m):m instanceof pi?d.field(m,!1)==h.field(m,!1):!0)||(a?Rd(f=n(h),g,r):r(f=n(h),g)))return h.values[o]=g,0}else f=n(h);return h.values[o]=f,1}}}}function Rd(i,t,e){if(i.length!=t.length)return!1;for(let n=0;n<i.length;n++)if(!e(i[n],t[n]))return!1;return!0}function Yc(i,t){let e=!1;for(let n of t)Ks(i,n)&1&&(e=!0);return e}function vk(i,t,e){let n=e.map(l=>i[l.id]),r=e.map(l=>l.type),s=n.filter(l=>!(l&1)),o=i[t.id]>>1;function a(l){let u=[];for(let c=0;c<n.length;c++){let h=Fa(l,n[c]);if(r[c]==2)for(let d of h)u.push(d);else u.push(h)}return t.combine(u)}return{create(l){for(let u of n)Ks(l,u);return l.values[o]=a(l),1},update(l,u){if(!Yc(l,s))return 0;let c=a(l);return t.compare(c,l.values[o])?0:(l.values[o]=c,1)},reconfigure(l,u){let c=Yc(l,n),h=u.config.facets[t.id],d=u.facet(t);if(h&&!c&&fh(e,h))return l.values[o]=d,0;let f=a(l);return t.compare(f,d)?(l.values[o]=d,0):(l.values[o]=f,1)}}}const Vo=pe.define({static:!0});class pi{constructor(t,e,n,r,s){this.id=t,this.createF=e,this.updateF=n,this.compareF=r,this.spec=s,this.provides=void 0}static define(t){let e=new pi(dh++,t.create,t.update,t.compare||((n,r)=>n===r),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Vo).find(n=>n.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:n=>(n.values[e]=this.create(n),1),update:(n,r)=>{let s=n.values[e],o=this.updateF(s,r);return this.compareF(s,o)?0:(n.values[e]=o,1)},reconfigure:(n,r)=>{let s=n.facet(Vo),o=r.facet(Vo),a;return(a=s.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(n.values[e]=a.create(n),1):r.config.address[this.id]!=null?(n.values[e]=r.field(this),0):(n.values[e]=this.create(n),1)}}}init(t){return[this,Vo.of({field:this,create:t})]}get extension(){return this}}const Lr={lowest:4,low:3,default:2,high:1,highest:0};function Fs(i){return t=>new rm(t,i)}const Jr={highest:Fs(Lr.highest),high:Fs(Lr.high),default:Fs(Lr.default),low:Fs(Lr.low),lowest:Fs(Lr.lowest)};class rm{constructor(t,e){this.inner=t,this.prec=e}}class Ol{of(t){return new qc(this,t)}reconfigure(t){return Ol.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class qc{constructor(t,e){this.compartment=t,this.inner=e}}class Ba{constructor(t,e,n,r,s,o){for(this.base=t,this.compartments=e,this.dynamicSlots=n,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,n){let r=[],s=Object.create(null),o=new Map;for(let d of kk(t,e,o))d instanceof pi?r.push(d):(s[d.facet.id]||(s[d.facet.id]=[])).push(d);let a=Object.create(null),l=[],u=[];for(let d of r)a[d.id]=u.length<<1,u.push(f=>d.slot(f));let c=n?.config.facets;for(let d in s){let f=s[d],p=f[0].facet,g=c&&c[d]||[];if(f.every(m=>m.type==0))if(a[p.id]=l.length<<1|1,fh(g,f))l.push(n.facet(p));else{let m=p.combine(f.map(O=>O.value));l.push(n&&p.compare(m,n.facet(p))?n.facet(p):m)}else{for(let m of f)m.type==0?(a[m.id]=l.length<<1|1,l.push(m.value)):(a[m.id]=u.length<<1,u.push(O=>m.dynamicSlot(O)));a[p.id]=u.length<<1,u.push(m=>vk(m,p,f))}}let h=u.map(d=>d(a));return new Ba(t,o,h,a,l,s)}}function kk(i,t,e){let n=[[],[],[],[],[]],r=new Map;function s(o,a){let l=r.get(o);if(l!=null){if(l<=a)return;let u=n[l].indexOf(o);u>-1&&n[l].splice(u,1),o instanceof qc&&e.delete(o.compartment)}if(r.set(o,a),Array.isArray(o))for(let u of o)s(u,a);else if(o instanceof qc){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=t.get(o.compartment)||o.inner;e.set(o.compartment,u),s(u,a)}else if(o instanceof rm)s(o.inner,o.prec);else if(o instanceof pi)n[a].push(o),o.provides&&s(o.provides,a);else if(o instanceof Ca)n[a].push(o),o.facet.extensions&&s(o.facet.extensions,Lr.default);else{let u=o.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(u,a)}}return s(i,Lr.default),n.reduce((o,a)=>o.concat(a))}function Ks(i,t){if(t&1)return 2;let e=t>>1,n=i.status[e];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;i.status[e]=4;let r=i.computeSlot(i,i.config.dynamicSlots[e]);return i.status[e]=2|r}function Fa(i,t){return t&1?i.config.staticValues[t>>1]:i.values[t>>1]}const sm=pe.define(),Vc=pe.define({combine:i=>i.some(t=>t),static:!0}),om=pe.define({combine:i=>i.length?i[0]:void 0,static:!0}),am=pe.define(),lm=pe.define(),cm=pe.define(),um=pe.define({combine:i=>i.length?i[0]:!1});class Zn{constructor(t,e){this.type=t,this.value=e}static define(){return new Ck}}class Ck{of(t){return new Zn(this,t)}}class Dk{constructor(t){this.map=t}of(t){return new Ze(this,t)}}class Ze{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new Ze(this.type,e)}is(t){return this.type==t}static define(t={}){return new Dk(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let n=[];for(let r of t){let s=r.map(e);s&&n.push(s)}return n}}Ze.reconfigure=Ze.define();Ze.appendConfig=Ze.define();class Gt{constructor(t,e,n,r,s,o){this.startState=t,this.changes=e,this.selection=n,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,n&&nm(n,e.newLength),s.some(a=>a.type==Gt.time)||(this.annotations=s.concat(Gt.time.of(Date.now())))}static create(t,e,n,r,s,o){return new Gt(t,e,n,r,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(Gt.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}Gt.time=Zn.define();Gt.userEvent=Zn.define();Gt.addToHistory=Zn.define();Gt.remote=Zn.define();function $k(i,t){let e=[];for(let n=0,r=0;;){let s,o;if(n<i.length&&(r==t.length||t[r]>=i[n]))s=i[n++],o=i[n++];else if(r<t.length)s=t[r++],o=t[r++];else return e;!e.length||e[e.length-1]<s?e.push(s,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function hm(i,t,e){var n;let r,s,o;return e?(r=t.changes,s=Vt.empty(t.changes.length),o=i.changes.compose(t.changes)):(r=t.changes.map(i.changes),s=i.changes.mapDesc(t.changes,!0),o=i.changes.compose(r)),{changes:o,selection:t.selection?t.selection.map(s):(n=i.selection)===null||n===void 0?void 0:n.map(r),effects:Ze.mapEffects(i.effects,r).concat(Ze.mapEffects(t.effects,s)),annotations:i.annotations.length?i.annotations.concat(t.annotations):t.annotations,scrollIntoView:i.scrollIntoView||t.scrollIntoView}}function Gc(i,t,e){let n=t.selection,r=ds(t.annotations);return t.userEvent&&(r=r.concat(Gt.userEvent.of(t.userEvent))),{changes:t.changes instanceof Vt?t.changes:Vt.of(t.changes||[],e,i.facet(om)),selection:n&&(n instanceof U?n:U.single(n.anchor,n.head)),effects:ds(t.effects),annotations:r,scrollIntoView:!!t.scrollIntoView}}function dm(i,t,e){let n=Gc(i,t.length?t[0]:{},i.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let s=1;s<t.length;s++){t[s].filter===!1&&(e=!1);let o=!!t[s].sequential;n=hm(n,Gc(i,t[s],o?n.changes.newLength:i.doc.length),o)}let r=Gt.create(i,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return Pk(e?Qk(r):r)}function Qk(i){let t=i.startState,e=!0;for(let r of t.facet(am)){let s=r(i);if(s===!1){e=!1;break}Array.isArray(s)&&(e=e===!0?s:$k(e,s))}if(e!==!0){let r,s;if(e===!1)s=i.changes.invertedDesc,r=Vt.empty(t.doc.length);else{let o=i.changes.filter(e);r=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}i=Gt.create(t,r,i.selection&&i.selection.map(s),Ze.mapEffects(i.effects,s),i.annotations,i.scrollIntoView)}let n=t.facet(lm);for(let r=n.length-1;r>=0;r--){let s=n[r](i);s instanceof Gt?i=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Gt?i=s[0]:i=dm(t,ds(s),!1)}return i}function Pk(i){let t=i.startState,e=t.facet(cm),n=i;for(let r=e.length-1;r>=0;r--){let s=e[r](i);s&&Object.keys(s).length&&(n=hm(n,Gc(t,s,i.changes.newLength),!0))}return n==i?i:Gt.create(t,i.changes,i.selection,n.effects,n.annotations,n.scrollIntoView)}const Ak=[];function ds(i){return i==null?Ak:Array.isArray(i)?i:[i]}var yt=(function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i})(yt||(yt={}));const Ek=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Uc;try{Uc=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Tk(i){if(Uc)return Uc.test(i);for(let t=0;t<i.length;t++){let e=i[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Ek.test(e)))return!0}return!1}function Rk(i){return t=>{if(!/\S/.test(t))return yt.Space;if(Tk(t))return yt.Word;for(let e=0;e<i.length;e++)if(t.indexOf(i[e])>-1)return yt.Word;return yt.Other}}class qe{constructor(t,e,n,r,s,o){this.config=t,this.doc=e,this.selection=n,this.values=r,this.status=t.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)Ks(this,a<<1);this.computeSlot=null}field(t,e=!0){let n=this.config.address[t.id];if(n==null){if(e)throw new RangeError("Field is not present in this state");return}return Ks(this,n),Fa(this,n)}update(...t){return dm(this,t,!0)}applyTransaction(t){let e=this.config,{base:n,compartments:r}=e;for(let a of t.effects)a.is(Ol.reconfigure)?(e&&(r=new Map,e.compartments.forEach((l,u)=>r.set(u,l)),e=null),r.set(a.value.compartment,a.value.extension)):a.is(Ze.reconfigure)?(e=null,n=a.value):a.is(Ze.appendConfig)&&(e=null,n=ds(n).concat(a.value));let s;e?s=t.startState.values.slice():(e=Ba.resolve(n,r,this),s=new qe(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,u)=>u.reconfigure(l,this),null).values);let o=t.startState.facet(Vc)?t.newSelection:t.newSelection.asSingle();new qe(e,t.newDoc,o,s,(a,l)=>l.update(a,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:U.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,n=t(e.ranges[0]),r=this.changes(n.changes),s=[n.range],o=ds(n.effects);for(let a=1;a<e.ranges.length;a++){let l=t(e.ranges[a]),u=this.changes(l.changes),c=u.map(r);for(let d=0;d<a;d++)s[d]=s[d].map(c);let h=r.mapDesc(u,!0);s.push(l.range.map(h)),r=r.compose(c),o=Ze.mapEffects(o,c).concat(Ze.mapEffects(ds(l.effects),h))}return{changes:r,selection:U.create(s,e.mainIndex),effects:o}}changes(t=[]){return t instanceof Vt?t:Vt.of(t,this.doc.length,this.facet(qe.lineSeparator))}toText(t){return Ue.of(t.split(this.facet(qe.lineSeparator)||Xc))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(Ks(this,e),Fa(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let n in t){let r=t[n];r instanceof pi&&this.config.address[r.id]!=null&&(e[n]=r.spec.toJSON(this.field(t[n]),this))}return e}static fromJSON(t,e={},n){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(n){for(let s in n)if(Object.prototype.hasOwnProperty.call(t,s)){let o=n[s],a=t[s];r.push(o.init(l=>o.spec.fromJSON(a,l)))}}return qe.create({doc:t.doc,selection:U.fromJSON(t.selection),extensions:e.extensions?r.concat([e.extensions]):r})}static create(t={}){let e=Ba.resolve(t.extensions||[],new Map),n=t.doc instanceof Ue?t.doc:Ue.of((t.doc||"").split(e.staticFacet(qe.lineSeparator)||Xc)),r=t.selection?t.selection instanceof U?t.selection:U.single(t.selection.anchor,t.selection.head):U.single(0);return nm(r,n.length),e.staticFacet(Vc)||(r=r.asSingle()),new qe(e,n,r,e.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(qe.tabSize)}get lineBreak(){return this.facet(qe.lineSeparator)||`
`}get readOnly(){return this.facet(um)}phrase(t,...e){for(let n of this.facet(qe.phrases))if(Object.prototype.hasOwnProperty.call(n,t)){t=n[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(n,r)=>{if(r=="$")return"$";let s=+(r||1);return!s||s>e.length?n:e[s-1]})),t}languageDataAt(t,e,n=-1){let r=[];for(let s of this.facet(sm))for(let o of s(this,e,n))Object.prototype.hasOwnProperty.call(o,t)&&r.push(o[t]);return r}charCategorizer(t){return Rk(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:n,length:r}=this.doc.lineAt(t),s=this.charCategorizer(t),o=t-n,a=t-n;for(;o>0;){let l=fi(e,o,!1);if(s(e.slice(l,o))!=yt.Word)break;o=l}for(;a<r;){let l=fi(e,a);if(s(e.slice(a,l))!=yt.Word)break;a=l}return o==a?null:U.range(o+n,a+n)}}qe.allowMultipleSelections=Vc;qe.tabSize=pe.define({combine:i=>i.length?i[0]:4});qe.lineSeparator=om;qe.readOnly=um;qe.phrases=pe.define({compare(i,t){let e=Object.keys(i),n=Object.keys(t);return e.length==n.length&&e.every(r=>i[r]==t[r])}});qe.languageData=sm;qe.changeFilter=am;qe.transactionFilter=lm;qe.transactionExtender=cm;Ol.reconfigure=Ze.define();function zn(i,t,e={}){let n={};for(let r of i)for(let s of Object.keys(r)){let o=r[s],a=n[s];if(a===void 0)n[s]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(e,s))n[s]=e[s](a,o);else throw new Error("Config merge conflict for field "+s)}for(let r in t)n[r]===void 0&&(n[r]=t[r]);return n}class Vr{eq(t){return this==t}range(t,e=t){return Hc.create(t,e,this)}}Vr.prototype.startSide=Vr.prototype.endSide=0;Vr.prototype.point=!1;Vr.prototype.mapMode=Ai.TrackDel;let Hc=class fm{constructor(t,e,n){this.from=t,this.to=e,this.value=n}static create(t,e,n){return new fm(t,e,n)}};function Kc(i,t){return i.from-t.from||i.value.startSide-t.value.startSide}class ph{constructor(t,e,n,r){this.from=t,this.to=e,this.value=n,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(t,e,n,r=0){let s=n?this.to:this.from;for(let o=r,a=s.length;;){if(o==a)return o;let l=o+a>>1,u=s[l]-t||(n?this.value[l].endSide:this.value[l].startSide)-e;if(l==o)return u>=0?o:a;u>=0?a=l:o=l+1}}between(t,e,n,r){for(let s=this.findIndex(e,-1e9,!0),o=this.findIndex(n,1e9,!1,s);s<o;s++)if(r(this.from[s]+t,this.to[s]+t,this.value[s])===!1)return!1}map(t,e){let n=[],r=[],s=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let u=this.value[l],c=this.from[l]+t,h=this.to[l]+t,d,f;if(c==h){let p=e.mapPos(c,u.startSide,u.mapMode);if(p==null||(d=f=p,u.startSide!=u.endSide&&(f=e.mapPos(c,u.endSide),f<d)))continue}else if(d=e.mapPos(c,u.startSide),f=e.mapPos(h,u.endSide),d>f||d==f&&u.startSide>0&&u.endSide<=0)continue;(f-d||u.endSide-u.startSide)<0||(o<0&&(o=d),u.point&&(a=Math.max(a,f-d)),n.push(u),r.push(d-o),s.push(f-o))}return{mapped:n.length?new ph(r,s,n,a):null,pos:o}}}class Ge{constructor(t,e,n,r){this.chunkPos=t,this.chunk=e,this.nextLayer=n,this.maxPoint=r}static create(t,e,n,r){return new Ge(t,e,n,r)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:n=!1,filterFrom:r=0,filterTo:s=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(n&&(e=e.slice().sort(Kc)),this.isEmpty)return e.length?Ge.of(e):this;let a=new pm(this,null,-1).goto(0),l=0,u=[],c=new Kn;for(;a.value||l<e.length;)if(l<e.length&&(a.from-e[l].from||a.startSide-e[l].value.startSide)>=0){let h=e[l++];c.addInner(h.from,h.to,h.value)||u.push(h)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==e.length||this.chunkEnd(a.chunkIndex)<e[l].from)&&(!o||r>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&c.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||r>a.to||s<a.from||o(a.from,a.to,a.value))&&(c.addInner(a.from,a.to,a.value)||u.push(Hc.create(a.from,a.to,a.value))),a.next());return c.finishInner(this.nextLayer.isEmpty&&!u.length?Ge.empty:this.nextLayer.update({add:u,filter:o,filterFrom:r,filterTo:s}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],n=[],r=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],u=t.touchesRange(a,a+l.length);if(u===!1)r=Math.max(r,l.maxPoint),e.push(l),n.push(t.mapPos(a));else if(u===!0){let{mapped:c,pos:h}=l.map(a,t);c&&(r=Math.max(r,c.maxPoint),e.push(c),n.push(h))}}let s=this.nextLayer.map(t);return e.length==0?s:new Ge(n,e,s||Ge.empty,r)}between(t,e,n){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(e>=s&&t<=s+o.length&&o.between(s,t-s,e-s,n)===!1)return}this.nextLayer.between(t,e,n)}}iter(t=0){return lo.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return lo.from(t).goto(e)}static compare(t,e,n,r,s=-1){let o=t.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),a=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),l=_d(o,a,n),u=new Zs(o,l,s),c=new Zs(a,l,s);n.iterGaps((h,d,f)=>Md(u,h,c,d,f,r)),n.empty&&n.length==0&&Md(u,0,c,0,0,r)}static eq(t,e,n=0,r){r==null&&(r=999999999);let s=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let a=_d(s,o),l=new Zs(s,a,0).goto(n),u=new Zs(o,a,0).goto(n);for(;;){if(l.to!=u.to||!Jc(l.active,u.active)||l.point&&(!u.point||!l.point.eq(u.point)))return!1;if(l.to>r)return!0;l.next(),u.next()}}static spans(t,e,n,r,s=-1){let o=new Zs(t,null,s).goto(e),a=e,l=o.openStart;for(;;){let u=Math.min(o.to,n);if(o.point){let c=o.activeForPoint(o.to),h=o.pointFrom<e?c.length+1:o.point.startSide<0?c.length:Math.min(c.length,l);r.point(a,u,o.point,c,h,o.pointRank),l=Math.min(o.openEnd(u),c.length)}else u>a&&(r.span(a,u,o.active,l),l=o.openEnd(u));if(o.to>n)return l+(o.point&&o.to>n?1:0);a=o.to,o.next()}}static of(t,e=!1){let n=new Kn;for(let r of t instanceof Hc?[t]:e?_k(t):t)n.add(r.from,r.to,r.value);return n.finish()}static join(t){if(!t.length)return Ge.empty;let e=t[t.length-1];for(let n=t.length-2;n>=0;n--)for(let r=t[n];r!=Ge.empty;r=r.nextLayer)e=new Ge(r.chunkPos,r.chunk,e,Math.max(r.maxPoint,e.maxPoint));return e}}Ge.empty=new Ge([],[],null,-1);function _k(i){if(i.length>1)for(let t=i[0],e=1;e<i.length;e++){let n=i[e];if(Kc(t,n)>0)return i.slice().sort(Kc);t=n}return i}Ge.empty.nextLayer=Ge.empty;class Kn{finishChunk(t){this.chunks.push(new ph(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,n){this.addInner(t,e,n)||(this.nextLayer||(this.nextLayer=new Kn)).add(t,e,n)}addInner(t,e,n){let r=t-this.lastTo||n.startSide-this.last.endSide;if(r<=0&&(t-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=n,this.lastFrom=t,this.lastTo=e,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let n=e.value.length-1;return this.last=e.value[n],this.lastFrom=e.from[n]+t,this.lastTo=e.to[n]+t,!0}finish(){return this.finishInner(Ge.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=Ge.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function _d(i,t,e){let n=new Map;for(let s of i)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&n.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of t)for(let o=0;o<s.chunk.length;o++){let a=n.get(s.chunk[o]);a!=null&&(e?e.mapPos(a):a)==s.chunkPos[o]&&!e?.touchesRange(a,a+s.chunk[o].length)&&r.add(s.chunk[o])}return r}class pm{constructor(t,e,n,r=0){this.layer=t,this.skip=e,this.minPoint=n,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,n){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<t||r.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!n||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],n=t+e.from[this.rangeIndex];if(this.from=n,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class lo{constructor(t){this.heap=t}static from(t,e=null,n=-1){let r=[];for(let s=0;s<t.length;s++)for(let o=t[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=n&&r.push(new pm(o,e,n,s));return r.length==1?r[0]:new lo(r)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let n of this.heap)n.goto(t,e);for(let n=this.heap.length>>1;n>=0;n--)Vl(this.heap,n);return this.next(),this}forward(t,e){for(let n of this.heap)n.forward(t,e);for(let n=this.heap.length>>1;n>=0;n--)Vl(this.heap,n);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Vl(this.heap,0)}}}function Vl(i,t){for(let e=i[t];;){let n=(t<<1)+1;if(n>=i.length)break;let r=i[n];if(n+1<i.length&&r.compare(i[n+1])>=0&&(r=i[n+1],n++),e.compare(r)<0)break;i[n]=e,i[t]=r,t=n}}class Zs{constructor(t,e,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=lo.from(t,e,n)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Go(this.active,t),Go(this.activeTo,t),Go(this.activeRank,t),this.minActive=Bd(this.active,this.activeTo)}addActive(t){let e=0,{value:n,to:r,rank:s}=this.cursor;for(;e<this.activeRank.length&&(s-this.activeRank[e]||r-this.activeTo[e])>0;)e++;Uo(this.active,e,n),Uo(this.activeTo,e,r),Uo(this.activeRank,e,s),t&&Uo(t,e,this.cursor.from),this.minActive=Bd(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>t){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),n&&Go(n,r)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(n),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let r=n.length-1;r>=0&&n[r]<t;r--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>t||this.activeTo[n]==t&&this.active[n].endSide>=this.point.endSide)&&e.push(this.active[n]);return e.reverse()}openEnd(t){let e=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>t;n--)e++;return e}}function Md(i,t,e,n,r,s){i.goto(t),e.goto(n);let o=n+r,a=n,l=n-t;for(;;){let u=i.to+l-e.to,c=u||i.endSide-e.endSide,h=c<0?i.to+l:e.to,d=Math.min(h,o);if(i.point||e.point?i.point&&e.point&&(i.point==e.point||i.point.eq(e.point))&&Jc(i.activeForPoint(i.to),e.activeForPoint(e.to))||s.comparePoint(a,d,i.point,e.point):d>a&&!Jc(i.active,e.active)&&s.compareRange(a,d,i.active,e.active),h>o)break;(u||i.openEnd!=e.openEnd)&&s.boundChange&&s.boundChange(h),a=h,c<=0&&i.next(),c>=0&&e.next()}}function Jc(i,t){if(i.length!=t.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!=t[e]&&!i[e].eq(t[e]))return!1;return!0}function Go(i,t){for(let e=t,n=i.length-1;e<n;e++)i[e]=i[e+1];i.pop()}function Uo(i,t,e){for(let n=i.length-1;n>=t;n--)i[n+1]=i[n];i[t]=e}function Bd(i,t){let e=-1,n=1e9;for(let r=0;r<t.length;r++)(t[r]-n||i[r].endSide-i[e].endSide)<0&&(e=r,n=t[r]);return e}function Es(i,t,e=i.length){let n=0;for(let r=0;r<e&&r<i.length;)i.charCodeAt(r)==9?(n+=t-n%t,r++):(n++,r=fi(i,r));return n}function eu(i,t,e,n){for(let r=0,s=0;;){if(s>=t)return r;if(r==i.length)break;s+=i.charCodeAt(r)==9?e-s%e:1,r=fi(i,r)}return n===!0?-1:i.length}const tu="ͼ",Fd=typeof Symbol>"u"?"__"+tu:Symbol.for(tu),iu=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class $r{constructor(t,e){this.rules=[];let{finish:n}=e||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,a,l,u){let c=[],h=/^@(\w+)\b/.exec(o[0]),d=h&&h[1]=="keyframes";if(h&&a==null)return l.push(o[0]+";");for(let f in a){let p=a[f];if(/&/.test(f))s(f.split(/,\s*/).map(g=>o.map(m=>g.replace(/&/,m))).reduce((g,m)=>g.concat(m)),p,l);else if(p&&typeof p=="object"){if(!h)throw new RangeError("The value of a property ("+f+") should be a primitive value.");s(r(f),p,c,d)}else p!=null&&c.push(f.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+p+";")}(c.length||d)&&l.push((n&&!h&&!u?o.map(n):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in t)s(r(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=Zd[Fd]||1;return Zd[Fd]=t+1,tu+t.toString(36)}static mount(t,e,n){let r=t[iu],s=n&&n.nonce;r?s&&r.setNonce(s):r=new Mk(t,s),r.mount(Array.isArray(e)?e:[e],t)}}let zd=new Map;class Mk{constructor(t,e){let n=t.ownerDocument||t,r=n.defaultView;if(!t.head&&t.adoptedStyleSheets&&r.CSSStyleSheet){let s=zd.get(n);if(s)return t[iu]=s;this.sheet=new r.CSSStyleSheet,zd.set(n,this)}else this.styleTag=n.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[iu]=this}mount(t,e){let n=this.sheet,r=0,s=0;for(let o=0;o<t.length;o++){let a=t[o],l=this.modules.indexOf(a);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,a),n)for(let u=0;u<a.rules.length;u++)n.insertRule(a.rules[u],r++)}else{for(;s<l;)r+=this.modules[s++].rules.length;r+=a.rules.length,s++}}if(n)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=e.head||e;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}var Qr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},co={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Bk=typeof navigator<"u"&&/Mac/.test(navigator.platform),Fk=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var di=0;di<10;di++)Qr[48+di]=Qr[96+di]=String(di);for(var di=1;di<=24;di++)Qr[di+111]="F"+di;for(var di=65;di<=90;di++)Qr[di]=String.fromCharCode(di+32),co[di]=String.fromCharCode(di);for(var Gl in Qr)co.hasOwnProperty(Gl)||(co[Gl]=Qr[Gl]);function Zk(i){var t=Bk&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||Fk&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",e=!t&&i.key||(i.shiftKey?co:Qr)[i.keyCode]||i.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}function ct(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var t=1,e=arguments[1];if(e&&typeof e=="object"&&e.nodeType==null&&!Array.isArray(e)){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];typeof r=="string"?i.setAttribute(n,r):r!=null&&(i[n]=r)}t++}for(;t<arguments.length;t++)gm(i,arguments[t]);return i}function gm(i,t){if(typeof t=="string")i.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)i.appendChild(t);else if(Array.isArray(t))for(var e=0;e<t.length;e++)gm(i,t[e]);else throw new RangeError("Unsupported child node: "+t)}let Pi=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},nu=typeof document<"u"?document:{documentElement:{style:{}}};const ru=/Edge\/(\d+)/.exec(Pi.userAgent),mm=/MSIE \d/.test(Pi.userAgent),su=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Pi.userAgent),bl=!!(mm||su||ru),jd=!bl&&/gecko\/(\d+)/i.test(Pi.userAgent),Ul=!bl&&/Chrome\/(\d+)/.exec(Pi.userAgent),zk="webkitFontSmoothing"in nu.documentElement.style,ou=!bl&&/Apple Computer/.test(Pi.vendor),Id=ou&&(/Mobile\/\w+/.test(Pi.userAgent)||Pi.maxTouchPoints>2);var le={mac:Id||/Mac/.test(Pi.platform),windows:/Win/.test(Pi.platform),linux:/Linux|X11/.test(Pi.platform),ie:bl,ie_version:mm?nu.documentMode||6:su?+su[1]:ru?+ru[1]:0,gecko:jd,gecko_version:jd?+(/Firefox\/(\d+)/.exec(Pi.userAgent)||[0,0])[1]:0,chrome:!!Ul,chrome_version:Ul?+Ul[1]:0,ios:Id,android:/Android\b/.test(Pi.userAgent),webkit_version:zk?+(/\bAppleWebKit\/(\d+)/.exec(Pi.userAgent)||[0,0])[1]:0,safari:ou,safari_version:ou?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Pi.userAgent)||[0,0])[1]:0,tabSize:nu.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function uo(i){let t;return i.nodeType==11?t=i.getSelection?i:i.ownerDocument:t=i,t.getSelection()}function au(i,t){return t?i==t||i.contains(t.nodeType!=1?t.parentNode:t):!1}function Da(i,t){if(!t.anchorNode)return!1;try{return au(i,t.anchorNode)}catch{return!1}}function Ss(i){return i.nodeType==3?Ur(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function Js(i,t,e,n){return e?Ld(i,t,e,n,-1)||Ld(i,t,e,n,1):!1}function Gr(i){for(var t=0;;t++)if(i=i.previousSibling,!i)return t}function Za(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}function Ld(i,t,e,n,r){for(;;){if(i==e&&t==n)return!0;if(t==(r<0?0:Fn(i))){if(i.nodeName=="DIV")return!1;let s=i.parentNode;if(!s||s.nodeType!=1)return!1;t=Gr(i)+(r<0?0:1),i=s}else if(i.nodeType==1){if(i=i.childNodes[t+(r<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;t=r<0?Fn(i):0}else return!1}}function Fn(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Ro(i,t){let e=t?i.left:i.right;return{left:e,right:e,top:i.top,bottom:i.bottom}}function jk(i){let t=i.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function Om(i,t){let e=t.width/i.offsetWidth,n=t.height/i.offsetHeight;return(e>.995&&e<1.005||!isFinite(e)||Math.abs(t.width-i.offsetWidth)<1)&&(e=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(t.height-i.offsetHeight)<1)&&(n=1),{scaleX:e,scaleY:n}}function Ik(i,t,e,n,r,s,o,a){let l=i.ownerDocument,u=l.defaultView||window;for(let c=i,h=!1;c&&!h;)if(c.nodeType==1){let d,f=c==l.body,p=1,g=1;if(f)d=jk(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(h=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let b=c.getBoundingClientRect();({scaleX:p,scaleY:g}=Om(c,b)),d={left:b.left,right:b.left+c.clientWidth*p,top:b.top,bottom:b.top+c.clientHeight*g}}let m=0,O=0;if(r=="nearest")t.top<d.top?(O=t.top-(d.top+o),e>0&&t.bottom>d.bottom+O&&(O=t.bottom-d.bottom+o)):t.bottom>d.bottom&&(O=t.bottom-d.bottom+o,e<0&&t.top-O<d.top&&(O=t.top-(d.top+o)));else{let b=t.bottom-t.top,x=d.bottom-d.top;O=(r=="center"&&b<=x?t.top+b/2-x/2:r=="start"||r=="center"&&e<0?t.top-o:t.bottom-x+o)-d.top}if(n=="nearest"?t.left<d.left?(m=t.left-(d.left+s),e>0&&t.right>d.right+m&&(m=t.right-d.right+s)):t.right>d.right&&(m=t.right-d.right+s,e<0&&t.left<d.left+m&&(m=t.left-(d.left+s))):m=(n=="center"?t.left+(t.right-t.left)/2-(d.right-d.left)/2:n=="start"==a?t.left-s:t.right-(d.right-d.left)+s)-d.left,m||O)if(f)u.scrollBy(m,O);else{let b=0,x=0;if(O){let S=c.scrollTop;c.scrollTop+=O/g,x=(c.scrollTop-S)*g}if(m){let S=c.scrollLeft;c.scrollLeft+=m/p,b=(c.scrollLeft-S)*p}t={left:t.left-b,top:t.top-x,right:t.right-b,bottom:t.bottom-x},b&&Math.abs(b-m)<1&&(n="nearest"),x&&Math.abs(x-O)<1&&(r="nearest")}if(f)break;(t.top<d.top||t.bottom>d.bottom||t.left<d.left||t.right>d.right)&&(t={left:Math.max(t.left,d.left),right:Math.min(t.right,d.right),top:Math.max(t.top,d.top),bottom:Math.min(t.bottom,d.bottom)}),c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function Lk(i){let t=i.ownerDocument,e,n;for(let r=i.parentNode;r&&!(r==t.body||e&&n);)if(r.nodeType==1)!n&&r.scrollHeight>r.clientHeight&&(n=r),!e&&r.scrollWidth>r.clientWidth&&(e=r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;return{x:e,y:n}}class Xk{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:e,focusNode:n}=t;this.set(e,Math.min(t.anchorOffset,e?Fn(e):0),n,Math.min(t.focusOffset,n?Fn(n):0))}set(t,e,n,r){this.anchorNode=t,this.anchorOffset=e,this.focusNode=n,this.focusOffset=r}}let Ir=null;le.safari&&le.safari_version>=26&&(Ir=!1);function bm(i){if(i.setActive)return i.setActive();if(Ir)return i.focus(Ir);let t=[];for(let e=i;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(i.focus(Ir==null?{get preventScroll(){return Ir={preventScroll:!0},!0}}:void 0),!Ir){Ir=!1;for(let e=0;e<t.length;){let n=t[e++],r=t[e++],s=t[e++];n.scrollTop!=r&&(n.scrollTop=r),n.scrollLeft!=s&&(n.scrollLeft=s)}}}let Xd;function Ur(i,t,e=t){let n=Xd||(Xd=document.createRange());return n.setEnd(i,e),n.setStart(i,t),n}function fs(i,t,e,n){let r={key:t,code:t,keyCode:e,which:e,cancelable:!0};n&&({altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey}=n);let s=new KeyboardEvent("keydown",r);s.synthetic=!0,i.dispatchEvent(s);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,i.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function Nk(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function ym(i){for(;i.attributes.length;)i.removeAttributeNode(i.attributes[0])}function Wk(i,t){let e=t.focusNode,n=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=n)return!1;for(n=Math.min(n,Fn(e));;)if(n){if(e.nodeType!=1)return!1;let r=e.childNodes[n-1];r.contentEditable=="false"?n--:(e=r,n=Fn(e))}else{if(e==i)return!0;n=Gr(e),e=e.parentNode}}function xm(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}function wm(i,t){for(let e=i,n=t;;){if(e.nodeType==3&&n>0)return{node:e,offset:n};if(e.nodeType==1&&n>0){if(e.contentEditable=="false")return null;e=e.childNodes[n-1],n=Fn(e)}else if(e.parentNode&&!Za(e))n=Gr(e),e=e.parentNode;else return null}}function Sm(i,t){for(let e=i,n=t;;){if(e.nodeType==3&&n<e.nodeValue.length)return{node:e,offset:n};if(e.nodeType==1&&n<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[n],n=0}else if(e.parentNode&&!Za(e))n=Gr(e)+1,e=e.parentNode;else return null}}class xi{constructor(t,e,n=!0){this.node=t,this.offset=e,this.precise=n}static before(t,e){return new xi(t.parentNode,Gr(t),e)}static after(t,e){return new xi(t.parentNode,Gr(t)+1,e)}}const gh=[];class lt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let n of this.children){if(n==t)return e;e+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(t,e){if(this.flags&2){let n=this.dom,r=null,s;for(let o of this.children){if(o.flags&7){if(!o.dom&&(s=r?r.nextSibling:n.firstChild)){let a=lt.get(s);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(t,e),o.flags&=-8}if(s=r?r.nextSibling:n.firstChild,e&&!e.written&&e.node==n&&s!=o.dom&&(e.written=!0),o.dom.parentNode==n)for(;s&&s!=o.dom;)s=Nd(s);else n.insertBefore(o.dom,s);r=o.dom}for(s=r?r.nextSibling:n.firstChild,s&&e&&e.node==n&&(e.written=!0);s;)s=Nd(s)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(t,e),n.flags&=-8)}reuseDOM(t){}localPosFromDOM(t,e){let n;if(t==this.dom)n=this.dom.childNodes[e];else{let r=Fn(t)==0?0:e==0?-1:1;for(;;){let s=t.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(t==s.firstChild?r=-1:r=1),t=s}r<0?n=t:n=t.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!lt.get(n);)n=n.nextSibling;if(!n)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==n)return s;s+=o.length+o.breakAfter}}domBoundsAround(t,e,n=0){let r=-1,s=-1,o=-1,a=-1;for(let l=0,u=n,c=n;l<this.children.length;l++){let h=this.children[l],d=u+h.length;if(u<t&&d>e)return h.domBoundsAround(t,e,u);if(d>=t&&r==-1&&(r=l,s=u),u>e&&h.dom.parentNode==this.dom){o=l,a=c;break}c=d,u=d+h.breakAfter}return{from:s,to:a<0?n+this.length:a,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.flags|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.flags|=2),e.flags&1)return;e.flags|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.flags&7&&this.markParentsDirty(!0))}setDOM(t){this.dom!=t&&(this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this)}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,n=gh){this.markDirty();for(let r=t;r<e;r++){let s=this.children[r];s.parent==this&&n.indexOf(s)<0&&s.destroy()}n.length<250?this.children.splice(t,e-t,...n):this.children=[].concat(this.children.slice(0,t),n,this.children.slice(e));for(let r=0;r<n.length;r++)n[r].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new vm(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,e,n,r,s,o){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor&&!((this.flags|t.flags)&8)}getSide(){return 0}destroy(){for(let t of this.children)t.parent==this&&t.destroy();this.parent=null}}lt.prototype.breakAfter=0;function Nd(i){let t=i.nextSibling;return i.parentNode.removeChild(i),t}class vm{constructor(t,e,n){this.children=t,this.pos=e,this.i=n,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function km(i,t,e,n,r,s,o,a,l){let{children:u}=i,c=u.length?u[t]:null,h=s.length?s[s.length-1]:null,d=h?h.breakAfter:o;if(!(t==n&&c&&!o&&!d&&s.length<2&&c.merge(e,r,s.length?h:null,e==0,a,l))){if(n<u.length){let f=u[n];f&&(r<f.length||f.breakAfter&&h?.breakAfter)?(t==n&&(f=f.split(r),r=0),!d&&h&&f.merge(0,r,h,!0,0,l)?s[s.length-1]=f:((r||f.children.length&&!f.children[0].length)&&f.merge(0,r,null,!1,0,l),s.push(f))):f?.breakAfter&&(h?h.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,e>0&&(!o&&s.length&&c.merge(e,c.length,s[0],!1,a,0)?c.breakAfter=s.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,a,0),t++));t<n&&s.length;)if(u[n-1].become(s[s.length-1]))n--,s.pop(),l=s.length?0:a;else if(u[t].become(s[0]))t++,s.shift(),a=s.length?0:l;else break;!s.length&&t&&n<u.length&&!u[t-1].breakAfter&&u[n].merge(0,0,u[t-1],!1,a,l)&&t--,(t<n||s.length)&&i.replaceChildren(t,n,s)}}function Cm(i,t,e,n,r,s){let o=i.childCursor(),{i:a,off:l}=o.findPos(e,1),{i:u,off:c}=o.findPos(t,-1),h=t-e;for(let d of n)h+=d.length;i.length+=h,km(i,u,c,a,l,n,0,r,s)}const Yk=256;class xn extends lt{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,n){return this.flags&8||n&&(!(n instanceof xn)||this.length-(e-t)+n.length>Yk||n.flags&8)?!1:(this.text=this.text.slice(0,t)+(n?n.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new xn(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e.flags|=this.flags&8,e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new xi(this.dom,t)}domBoundsAround(t,e,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return qk(this.dom,t,e)}}class Jn extends lt{constructor(t,e=[],n=0){super(),this.mark=t,this.children=e,this.length=n;for(let r of e)r.setParent(this)}setAttrs(t){if(ym(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}canReuseDOM(t){return super.canReuseDOM(t)&&!((this.flags|t.flags)&8)}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.flags|=6)}sync(t,e){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,e)}merge(t,e,n,r,s,o){return n&&(!(n instanceof Jn&&n.mark.eq(this.mark))||t&&s<=0||e<this.length&&o<=0)?!1:(Cm(this,t,e,n?n.children.slice():[],s-1,o-1),this.markDirty(),!0)}split(t){let e=[],n=0,r=-1,s=0;for(let a of this.children){let l=n+a.length;l>t&&e.push(n<t?a.split(t-n):a),r<0&&n>=t&&(r=s),n=l,s++}let o=this.length-t;return this.length=t,r>-1&&(this.children.length=r,this.markDirty()),new Jn(this.mark,e,o)}domAtPos(t){return Dm(this,t)}coordsAt(t,e){return Qm(this,t,e)}}function qk(i,t,e){let n=i.nodeValue.length;t>n&&(t=n);let r=t,s=t,o=0;t==0&&e<0||t==n&&e>=0?le.chrome||le.gecko||(t?(r--,o=1):s<n&&(s++,o=-1)):e<0?r--:s<n&&s++;let a=Ur(i,r,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:e>=0)?0:a.length-1];return le.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,u=>u.width)||l),o?Ro(l,o<0):l||null}class wr extends lt{static create(t,e,n){return new wr(t,e,n)}constructor(t,e,n){super(),this.widget=t,this.length=e,this.side=n,this.prevWidget=null}split(t){let e=wr.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,e,n,r,s,o){return n&&(!(n instanceof wr)||!this.widget.compare(n.widget)||t>0&&s<=0||e<this.length&&o<=0)?!1:(this.length=t+(n?n.length:0)+(this.length-e),!0)}become(t){return t instanceof wr&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return Ue.empty;let t=this;for(;t.parent;)t=t.parent;let{view:e}=t,n=e&&e.state.doc,r=this.posAtStart;return n?n.slice(r,r+this.length):Ue.empty}domAtPos(t){return(this.length?t==0:this.side>0)?xi.before(this.dom):xi.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let n=this.widget.coordsAt(this.dom,t,e);if(n)return n;let r=this.dom.getClientRects(),s=null;if(!r.length)return null;let o=this.side?this.side<0:t>0;for(let a=o?r.length-1:0;s=r[a],!(t>0?a==0:a==r.length-1||s.top<s.bottom);a+=o?-1:1);return Ro(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class vs extends lt{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof vs&&t.side==this.side}split(){return new vs(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return this.side>0?xi.before(this.dom):xi.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Ue.empty}get isHidden(){return!0}}xn.prototype.children=wr.prototype.children=vs.prototype.children=gh;function Dm(i,t){let e=i.dom,{children:n}=i,r=0;for(let s=0;r<n.length;r++){let o=n[r],a=s+o.length;if(!(a==s&&o.getSide()<=0)){if(t>s&&t<a&&o.dom.parentNode==e)return o.domAtPos(t-s);if(t<=s)break;s=a}}for(let s=r;s>0;s--){let o=n[s-1];if(o.dom.parentNode==e)return o.domAtPos(o.length)}for(let s=r;s<n.length;s++){let o=n[s];if(o.dom.parentNode==e)return o.domAtPos(0)}return new xi(e,0)}function $m(i,t,e){let n,{children:r}=i;e>0&&t instanceof Jn&&r.length&&(n=r[r.length-1])instanceof Jn&&n.mark.eq(t.mark)?$m(n,t.children[0],e-1):(r.push(t),t.setParent(i)),i.length+=t.length}function Qm(i,t,e){let n=null,r=-1,s=null,o=-1;function a(u,c){for(let h=0,d=0;h<u.children.length&&d<=c;h++){let f=u.children[h],p=d+f.length;p>=c&&(f.children.length?a(f,c-d):(!s||s.isHidden&&(e>0||Gk(s,f)))&&(p>c||d==p&&f.getSide()>0)?(s=f,o=c-d):(d<c||d==p&&f.getSide()<0&&!f.isHidden)&&(n=f,r=c-d)),d=p}}a(i,t);let l=(e<0?n:s)||n||s;return l?l.coordsAt(Math.max(0,l==n?r:o),e):Vk(i)}function Vk(i){let t=i.dom.lastChild;if(!t)return i.dom.getBoundingClientRect();let e=Ss(t);return e[e.length-1]||null}function Gk(i,t){let e=i.coordsAt(0,1),n=t.coordsAt(0,1);return e&&n&&n.top<e.bottom}function lu(i,t){for(let e in i)e=="class"&&t.class?t.class+=" "+i.class:e=="style"&&t.style?t.style+=";"+i.style:t[e]=i[e];return t}const Wd=Object.create(null);function za(i,t,e){if(i==t)return!0;i||(i=Wd),t||(t=Wd);let n=Object.keys(i),r=Object.keys(t);if(n.length-(e&&n.indexOf(e)>-1?1:0)!=r.length-(e&&r.indexOf(e)>-1?1:0))return!1;for(let s of n)if(s!=e&&(r.indexOf(s)==-1||i[s]!==t[s]))return!1;return!0}function cu(i,t,e){let n=!1;if(t)for(let r in t)e&&r in e||(n=!0,r=="style"?i.style.cssText="":i.removeAttribute(r));if(e)for(let r in e)t&&t[r]==e[r]||(n=!0,r=="style"?i.style.cssText=e[r]:i.setAttribute(r,e[r]));return n}function Uk(i){let t=Object.create(null);for(let e=0;e<i.attributes.length;e++){let n=i.attributes[e];t[n.name]=n.value}return t}class ar{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,e,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var Ti=(function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i})(Ti||(Ti={}));class Se extends Vr{constructor(t,e,n,r){super(),this.startSide=t,this.endSide=e,this.widget=n,this.spec=r}get heightRelevant(){return!1}static mark(t){return new _o(t)}static widget(t){let e=Math.max(-1e4,Math.min(1e4,t.side||0)),n=!!t.block;return e+=n&&!t.inlineOrder?e>0?3e8:-4e8:e>0?1e8:-1e8,new Pr(t,e,e,n,t.widget||null,!1)}static replace(t){let e=!!t.block,n,r;if(t.isBlockGap)n=-5e8,r=4e8;else{let{start:s,end:o}=Pm(t,e);n=(s?e?-3e8:-1:5e8)-1,r=(o?e?2e8:1:-6e8)+1}return new Pr(t,n,r,e,t.widget||null,!0)}static line(t){return new Mo(t)}static set(t,e=!1){return Ge.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Se.none=Ge.empty;class _o extends Se{constructor(t){let{start:e,end:n}=Pm(t);super(e?-1:5e8,n?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){var e,n;return this==t||t instanceof _o&&this.tagName==t.tagName&&(this.class||((e=this.attrs)===null||e===void 0?void 0:e.class))==(t.class||((n=t.attrs)===null||n===void 0?void 0:n.class))&&za(this.attrs,t.attrs,"class")}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}_o.prototype.point=!1;class Mo extends Se{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Mo&&this.spec.class==t.spec.class&&za(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Mo.prototype.mapMode=Ai.TrackBefore;Mo.prototype.point=!0;class Pr extends Se{constructor(t,e,n,r,s,o){super(e,n,s,t),this.block=r,this.isReplace=o,this.mapMode=r?e<=0?Ai.TrackBefore:Ai.TrackAfter:Ai.TrackDel}get type(){return this.startSide!=this.endSide?Ti.WidgetRange:this.startSide<=0?Ti.WidgetBefore:Ti.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof Pr&&Hk(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}Pr.prototype.point=!0;function Pm(i,t=!1){let{inclusiveStart:e,inclusiveEnd:n}=i;return e==null&&(e=i.inclusive),n==null&&(n=i.inclusive),{start:e??t,end:n??t}}function Hk(i,t){return i==t||!!(i&&t&&i.compare(t))}function $a(i,t,e,n=0){let r=e.length-1;r>=0&&e[r]+n>=i?e[r]=Math.max(e[r],t):e.push(i,t)}class Ft extends lt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,n,r,s,o){if(n){if(!(n instanceof Ft))return!1;this.dom||n.transferDOM(this)}return r&&this.setDeco(n?n.attrs:null),Cm(this,t,e,n?n.children.slice():[],s,o),!0}split(t){let e=new Ft;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i:n,off:r}=this.childPos(t);r&&(e.append(this.children[n].split(r),0),this.children[n].merge(r,this.children[n].length,null,!1,0,0),n++);for(let s=n;s<this.children.length;s++)e.append(this.children[s],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){za(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){$m(this,t,e)}addLineDeco(t){let e=t.spec.attributes,n=t.spec.class;e&&(this.attrs=lu(e,this.attrs||{})),n&&(this.attrs=lu({class:n},this.attrs||{}))}domAtPos(t){return Dm(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.flags|=6)}sync(t,e){var n;this.dom?this.flags&4&&(ym(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(cu(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,e);let r=this.dom.lastChild;for(;r&&lt.get(r)instanceof Jn;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&((n=lt.get(r))===null||n===void 0?void 0:n.isEditable)==!1&&(!le.ios||!this.children.some(s=>s instanceof xn))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0,e;for(let n of this.children){if(!(n instanceof xn)||/[^ -~]/.test(n.text))return null;let r=Ss(n.dom);if(r.length!=1)return null;t+=r[0].width,e=r[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(t,e){let n=Qm(this,t,e);if(!this.children.length&&n&&this.parent){let{heightOracle:r}=this.parent.view.viewState,s=n.bottom-n.top;if(Math.abs(s-r.lineHeight)<2&&r.textHeight<s){let o=(s-r.textHeight)/2;return{top:n.top+o,bottom:n.bottom-o,left:n.left,right:n.left}}}return n}become(t){return t instanceof Ft&&this.children.length==0&&t.children.length==0&&za(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,e){for(let n=0,r=0;n<t.children.length;n++){let s=t.children[n],o=r+s.length;if(o>=e){if(s instanceof Ft)return s;if(o>e)break}r=o+s.breakAfter}return null}}class Gn extends lt{constructor(t,e,n){super(),this.widget=t,this.length=e,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(t,e,n,r,s,o){return n&&(!(n instanceof Gn)||!this.widget.compare(n.widget)||t>0&&s<=0||e<this.length&&o<=0)?!1:(this.length=t+(n?n.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?xi.before(this.dom):xi.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let n=new Gn(this.widget,e,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return gh}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Ue.empty}domBoundsAround(){return null}become(t){return t instanceof Gn&&t.widget.constructor==this.widget.constructor?(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,e){let n=this.widget.coordsAt(this.dom,t,e);return n||(this.widget instanceof uu?null:Ro(this.dom.getBoundingClientRect(),this.length?t==0:e<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(t){let{startSide:e,endSide:n}=this.deco;return e==n?!1:t<0?e<0:n>0}}class uu extends ar{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class eo{constructor(t,e,n,r){this.doc=t,this.pos=e,this.end=n,this.disallowBlockEffectsFor=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Gn&&t.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ft),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Ho(new vs(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(t&&this.content.length&&this.content[this.content.length-1]instanceof Gn)&&this.getLine()}buildText(t,e,n){for(;t>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:a,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}else this.text=o,this.textOff=0}let r=Math.min(this.text.length-this.textOff,t),s=Math.min(r,512);this.flushBuffer(e.slice(e.length-n)),this.getLine().append(Ho(new xn(this.text.slice(this.textOff,this.textOff+s)),e),n),this.atCursorPos=!0,this.textOff+=s,t-=s,n=r<=s?0:e.length}}span(t,e,n,r){this.buildText(e-t,n,r),this.pos=e,this.openStart<0&&(this.openStart=r)}point(t,e,n,r,s,o){if(this.disallowBlockEffectsFor[o]&&n instanceof Pr){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=e-t;if(n instanceof Pr)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Gn(n.widget||ks.block,a,n));else{let l=wr.create(n.widget||ks.inline,a,a?0:n.startSide),u=this.atCursorPos&&!l.isEditable&&s<=r.length&&(t<e||n.startSide>0),c=!l.isEditable&&(t<e||s>r.length||n.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!u&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(r),u&&(h.append(Ho(new vs(1),r),s),s=r.length+Math.max(0,s-r.length)),h.append(Ho(l,r),s),this.atCursorPos=c,this.pendingBuffer=c?t<e||s>r.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=r.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=s)}static build(t,e,n,r,s){let o=new eo(t,e,n,s);return o.openEnd=Ge.spans(r,e,n,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Ho(i,t){for(let e of t)i=new Jn(e,[i],i.length);return i}class ks extends ar{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}ks.inline=new ks("span");ks.block=new ks("div");var mt=(function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i})(mt||(mt={}));const Hr=mt.LTR,mh=mt.RTL;function Am(i){let t=[];for(let e=0;e<i.length;e++)t.push(1<<+i[e]);return t}const Kk=Am("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Jk=Am("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),hu=Object.create(null),Dn=[];for(let i of["()","[]","{}"]){let t=i.charCodeAt(0),e=i.charCodeAt(1);hu[t]=e,hu[e]=-t}function Em(i){return i<=247?Kk[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?Jk[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8204?256:64336<=i&&i<=65023?4:1}const eC=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Sr{get dir(){return this.level%2?mh:Hr}constructor(t,e,n){this.from=t,this.to=e,this.level=n}side(t,e){return this.dir==e==t?this.to:this.from}forward(t,e){return t==(this.dir==e)}static find(t,e,n,r){let s=-1;for(let o=0;o<t.length;o++){let a=t[o];if(a.from<=e&&a.to>=e){if(a.level==n)return o;(s<0||(r!=0?r<0?a.from<e:a.to>e:t[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function Tm(i,t){if(i.length!=t.length)return!1;for(let e=0;e<i.length;e++){let n=i[e],r=t[e];if(n.from!=r.from||n.to!=r.to||n.direction!=r.direction||!Tm(n.inner,r.inner))return!1}return!0}const ut=[];function tC(i,t,e,n,r){for(let s=0;s<=n.length;s++){let o=s?n[s-1].to:t,a=s<n.length?n[s].from:e,l=s?256:r;for(let u=o,c=l,h=l;u<a;u++){let d=Em(i.charCodeAt(u));d==512?d=c:d==8&&h==4&&(d=16),ut[u]=d==4?2:d,d&7&&(h=d),c=d}for(let u=o,c=l,h=l;u<a;u++){let d=ut[u];if(d==128)u<a-1&&c==ut[u+1]&&c&24?d=ut[u]=c:ut[u]=256;else if(d==64){let f=u+1;for(;f<a&&ut[f]==64;)f++;let p=u&&c==8||f<e&&ut[f]==8?h==1?1:8:256;for(let g=u;g<f;g++)ut[g]=p;u=f-1}else d==8&&h==1&&(ut[u]=1);c=d,d&7&&(h=d)}}}function iC(i,t,e,n,r){let s=r==1?2:1;for(let o=0,a=0,l=0;o<=n.length;o++){let u=o?n[o-1].to:t,c=o<n.length?n[o].from:e;for(let h=u,d,f,p;h<c;h++)if(f=hu[d=i.charCodeAt(h)])if(f<0){for(let g=a-3;g>=0;g-=3)if(Dn[g+1]==-f){let m=Dn[g+2],O=m&2?r:m&4?m&1?s:r:0;O&&(ut[h]=ut[Dn[g]]=O),a=g;break}}else{if(Dn.length==189)break;Dn[a++]=h,Dn[a++]=d,Dn[a++]=l}else if((p=ut[h])==2||p==1){let g=p==r;l=g?0:1;for(let m=a-3;m>=0;m-=3){let O=Dn[m+2];if(O&2)break;if(g)Dn[m+2]|=2;else{if(O&4)break;Dn[m+2]|=4}}}}}function nC(i,t,e,n){for(let r=0,s=n;r<=e.length;r++){let o=r?e[r-1].to:i,a=r<e.length?e[r].from:t;for(let l=o;l<a;){let u=ut[l];if(u==256){let c=l+1;for(;;)if(c==a){if(r==e.length)break;c=e[r++].to,a=r<e.length?e[r].from:t}else if(ut[c]==256)c++;else break;let h=s==1,d=(c<t?ut[c]:n)==1,f=h==d?h?1:2:n;for(let p=c,g=r,m=g?e[g-1].to:i;p>l;)p==m&&(p=e[--g].from,m=g?e[g-1].to:i),ut[--p]=f;l=c}else s=u,l++}}}function du(i,t,e,n,r,s,o){let a=n%2?2:1;if(n%2==r%2)for(let l=t,u=0;l<e;){let c=!0,h=!1;if(u==s.length||l<s[u].from){let g=ut[l];g!=a&&(c=!1,h=g==16)}let d=!c&&a==1?[]:null,f=c?n:n+1,p=l;e:for(;;)if(u<s.length&&p==s[u].from){if(h)break e;let g=s[u];if(!c)for(let m=g.to,O=u+1;;){if(m==e)break e;if(O<s.length&&s[O].from==m)m=s[O++].to;else{if(ut[m]==a)break e;break}}if(u++,d)d.push(g);else{g.from>l&&o.push(new Sr(l,g.from,f));let m=g.direction==Hr!=!(f%2);fu(i,m?n+1:n,r,g.inner,g.from,g.to,o),l=g.to}p=g.to}else{if(p==e||(c?ut[p]!=a:ut[p]==a))break;p++}d?du(i,l,p,n+1,r,d,o):l<p&&o.push(new Sr(l,p,f)),l=p}else for(let l=e,u=s.length;l>t;){let c=!0,h=!1;if(!u||l>s[u-1].to){let g=ut[l-1];g!=a&&(c=!1,h=g==16)}let d=!c&&a==1?[]:null,f=c?n:n+1,p=l;e:for(;;)if(u&&p==s[u-1].to){if(h)break e;let g=s[--u];if(!c)for(let m=g.from,O=u;;){if(m==t)break e;if(O&&s[O-1].to==m)m=s[--O].from;else{if(ut[m-1]==a)break e;break}}if(d)d.push(g);else{g.to<l&&o.push(new Sr(g.to,l,f));let m=g.direction==Hr!=!(f%2);fu(i,m?n+1:n,r,g.inner,g.from,g.to,o),l=g.from}p=g.from}else{if(p==t||(c?ut[p-1]!=a:ut[p-1]==a))break;p--}d?du(i,p,l,n+1,r,d,o):p<l&&o.push(new Sr(p,l,f)),l=p}}function fu(i,t,e,n,r,s,o){let a=t%2?2:1;tC(i,r,s,n,a),iC(i,r,s,n,a),nC(r,s,n,a),du(i,r,s,t,e,n,o)}function rC(i,t,e){if(!i)return[new Sr(0,0,t==mh?1:0)];if(t==Hr&&!e.length&&!eC.test(i))return Rm(i.length);if(e.length)for(;i.length>ut.length;)ut[ut.length]=256;let n=[],r=t==Hr?0:1;return fu(i,r,r,e,0,i.length,n),n}function Rm(i){return[new Sr(0,i,0)]}let _m="";function sC(i,t,e,n,r){var s;let o=n.head-i.from,a=Sr.find(t,o,(s=n.bidiLevel)!==null&&s!==void 0?s:-1,n.assoc),l=t[a],u=l.side(r,e);if(o==u){let d=a+=r?1:-1;if(d<0||d>=t.length)return null;l=t[a=d],o=l.side(!r,e),u=l.side(r,e)}let c=fi(i.text,o,l.forward(r,e));(c<l.from||c>l.to)&&(c=u),_m=i.text.slice(Math.min(o,c),Math.max(o,c));let h=a==(r?t.length-1:0)?null:t[a+(r?1:-1)];return h&&c==u&&h.level+(r?0:1)<l.level?U.cursor(h.side(!r,e)+i.from,h.forward(r,e)?1:-1,h.level):U.cursor(c+i.from,l.forward(r,e)?-1:1,l.level)}function oC(i,t,e){for(let n=t;n<e;n++){let r=Em(i.charCodeAt(n));if(r==1)return Hr;if(r==2||r==4)return mh}return Hr}const Mm=pe.define(),Bm=pe.define(),Fm=pe.define(),Zm=pe.define(),pu=pe.define(),zm=pe.define(),jm=pe.define(),Oh=pe.define(),bh=pe.define(),Im=pe.define({combine:i=>i.some(t=>t)}),Lm=pe.define({combine:i=>i.some(t=>t)}),Xm=pe.define();class ps{constructor(t,e="nearest",n="nearest",r=5,s=5,o=!1){this.range=t,this.y=e,this.x=n,this.yMargin=r,this.xMargin=s,this.isSnapshot=o}map(t){return t.empty?this:new ps(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new ps(U.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Ko=Ze.define({map:(i,t)=>i.map(t)}),Nm=Ze.define();function zi(i,t,e){let n=i.facet(Zm);n.length?n[0](t):window.onerror&&window.onerror(String(t),e,void 0,void 0,t)||(e?console.error(e+":",t):console.error(t))}const Yn=pe.define({combine:i=>i.length?i[0]:!0});let aC=0;const ls=pe.define({combine(i){return i.filter((t,e)=>{for(let n=0;n<e;n++)if(i[n].plugin==t.plugin)return!1;return!0})}});class Qt{constructor(t,e,n,r,s){this.id=t,this.create=e,this.domEventHandlers=n,this.domEventObservers=r,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(ls.of({plugin:this,arg:void 0}))}of(t){return this.baseExtensions.concat(ls.of({plugin:this,arg:t}))}static define(t,e){const{eventHandlers:n,eventObservers:r,provide:s,decorations:o}=e||{};return new Qt(aC++,t,n,r,a=>{let l=[];return o&&l.push(ho.of(u=>{let c=u.plugin(a);return c?o(c):Se.none})),s&&l.push(s(a)),l})}static fromClass(t,e){return Qt.define((n,r)=>new t(n,r),e)}}class Hl{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(n){if(zi(e.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(t,this.spec.arg)}catch(e){zi(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(n){zi(t.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Wm=pe.define(),yh=pe.define(),ho=pe.define(),Ym=pe.define(),Bo=pe.define(),qm=pe.define();function Yd(i,t){let e=i.state.facet(qm);if(!e.length)return e;let n=e.map(s=>s instanceof Function?s(i):s),r=[];return Ge.spans(n,t.from,t.to,{point(){},span(s,o,a,l){let u=s-t.from,c=o-t.from,h=r;for(let d=a.length-1;d>=0;d--,l--){let f=a[d].spec.bidiIsolate,p;if(f==null&&(f=oC(t.text,u,c)),l>0&&h.length&&(p=h[h.length-1]).to==u&&p.direction==f)p.to=c,h=p.inner;else{let g={from:u,to:c,direction:f,inner:[]};h.push(g),h=g.inner}}}}),r}const Vm=pe.define();function xh(i){let t=0,e=0,n=0,r=0;for(let s of i.state.facet(Vm)){let o=s(i);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(e=Math.max(e,o.right)),o.top!=null&&(n=Math.max(n,o.top)),o.bottom!=null&&(r=Math.max(r,o.bottom)))}return{left:t,right:e,top:n,bottom:r}}const Ws=pe.define();class cn{constructor(t,e,n,r){this.fromA=t,this.toA=e,this.fromB=n,this.toB=r}join(t){return new cn(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,n=this;for(;e>0;e--){let r=t[e-1];if(!(r.fromA>n.toA)){if(r.toA<n.fromA)break;n=n.join(r),t.splice(e-1,1)}}return t.splice(e,0,n),t}static extendWithRanges(t,e){if(e.length==0)return t;let n=[];for(let r=0,s=0,o=0,a=0;;r++){let l=r==t.length?null:t[r],u=o-a,c=l?l.fromB:1e9;for(;s<e.length&&e[s]<c;){let h=e[s],d=e[s+1],f=Math.max(a,h),p=Math.min(c,d);if(f<=p&&new cn(f+u,p+u,f,p).addToSet(n),d>c)break;s+=2}if(!l)return n;new cn(l.fromA,l.toA,l.fromB,l.toB).addToSet(n),o=l.toA,a=l.toB}}}class ja{constructor(t,e,n){this.view=t,this.state=e,this.transactions=n,this.flags=0,this.startState=t.state,this.changes=Vt.empty(this.startState.doc.length);for(let s of n)this.changes=this.changes.compose(s.changes);let r=[];this.changes.iterChangedRanges((s,o,a,l)=>r.push(new cn(s,o,a,l))),this.changedRanges=r}static create(t,e,n){return new ja(t,e,n)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class qd extends lt{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Se.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new Ft],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new cn(0,0,0,t.state.doc.length)],0,null)}update(t){var e;let n=t.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:u,toA:c})=>c<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let r=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((e=this.domChanged)===null||e===void 0)&&e.newSel?r=this.domChanged.newSel.head:!pC(t.changes,this.hasComposition)&&!t.selectionSet&&(r=t.state.selection.main.head));let s=r>-1?cC(this.view,t.changes,r):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:u,to:c}=this.hasComposition;n=new cn(u,c,t.changes.mapPos(u,-1),t.changes.mapPos(c,1)).addToSet(n.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(le.ie||le.chrome)&&!s&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=dC(o,a,t.changes);return n=cn.extendWithRanges(n,l),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,t.startState.doc.length,s),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e,n);let{observer:r}=this.view;r.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=le.chrome||le.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||r.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Gn&&o.widget instanceof uu&&s.push(o.dom);r.updateGaps(s)}updateChildren(t,e,n){let r=n?n.range.addToSet(t.slice()):t,s=this.childCursor(e);for(let o=r.length-1;;o--){let a=o>=0?r[o]:null;if(!a)break;let{fromA:l,toA:u,fromB:c,toB:h}=a,d,f,p,g;if(n&&n.range.fromB<h&&n.range.toB>c){let S=eo.build(this.view.state.doc,c,n.range.fromB,this.decorations,this.dynamicDecorationMap),w=eo.build(this.view.state.doc,n.range.toB,h,this.decorations,this.dynamicDecorationMap);f=S.breakAtStart,p=S.openStart,g=w.openEnd;let v=this.compositionView(n);w.breakAtStart?v.breakAfter=1:w.content.length&&v.merge(v.length,v.length,w.content[0],!1,w.openStart,0)&&(v.breakAfter=w.content[0].breakAfter,w.content.shift()),S.content.length&&v.merge(0,0,S.content[S.content.length-1],!0,0,S.openEnd)&&S.content.pop(),d=S.content.concat(v).concat(w.content)}else({content:d,breakAtStart:f,openStart:p,openEnd:g}=eo.build(this.view.state.doc,c,h,this.decorations,this.dynamicDecorationMap));let{i:m,off:O}=s.findPos(u,1),{i:b,off:x}=s.findPos(l,-1);km(this,b,x,m,O,d,f,p,g)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let e of t.transactions)for(let n of e.effects)n.is(Nm)&&(this.editContextFormatting=n.value)}compositionView(t){let e=new xn(t.text.nodeValue);e.flags|=8;for(let{deco:r}of t.marks)e=new Jn(r,[e],e.length);let n=new Ft;return n.append(e,0),n}fixCompositionDOM(t){let e=(s,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=lt.get(s);a&&a!=o&&(a.dom=null),o.setDOM(s)},n=this.childPos(t.range.fromB,1),r=this.children[n.i];e(t.line,r);for(let s=t.marks.length-1;s>=-1;s--)n=r.childPos(n.off,1),r=r.children[n.i],e(s>=0?t.marks[s].node:t.text,r)}updateSelection(t=!1,e=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,r=n==this.dom,s=!r&&!(this.view.state.facet(Yn)||this.dom.tabIndex>-1)&&Da(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(r||e||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),u=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(le.gecko&&a.empty&&!this.hasComposition&&lC(l)){let h=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(h,l.node.childNodes[l.offset]||null)),l=u=new xi(h,0),o=!0}let c=this.view.observer.selectionRange;(o||!c.focusNode||(!Js(l.node,l.offset,c.anchorNode,c.anchorOffset)||!Js(u.node,u.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,a))&&(this.view.observer.ignore(()=>{le.android&&le.chrome&&this.dom.contains(c.focusNode)&&fC(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=uo(this.view.root);if(h)if(a.empty){if(le.gecko){let d=uC(l.node,l.offset);if(d&&d!=3){let f=(d==1?wm:Sm)(l.node,l.offset);f&&(l=new xi(f.node,f.offset))}}h.collapse(l.node,l.offset),a.bidiLevel!=null&&h.caretBidiLevel!==void 0&&(h.caretBidiLevel=a.bidiLevel)}else if(h.extend){h.collapse(l.node,l.offset);try{h.extend(u.node,u.offset)}catch{}}else{let d=document.createRange();a.anchor>a.head&&([l,u]=[u,l]),d.setEnd(u.node,u.offset),d.setStart(l.node,l.offset),h.removeAllRanges(),h.addRange(d)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(l,u)),this.impreciseAnchor=l.precise?null:new xi(c.anchorNode,c.anchorOffset),this.impreciseHead=u.precise?null:new xi(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(t,e){return this.hasComposition&&e.empty&&Js(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==e.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,e=t.state.selection.main,n=uo(t.root),{anchorNode:r,anchorOffset:s}=t.observer.selectionRange;if(!n||!e.empty||!e.assoc||!n.modify)return;let o=Ft.find(this,e.head);if(!o)return;let a=o.posAtStart;if(e.head==a||e.head==a+o.length)return;let l=this.coordsAt(e.head,-1),u=this.coordsAt(e.head,1);if(!l||!u||l.bottom>u.top)return;let c=this.domAtPos(e.head+e.assoc);n.collapse(c.node,c.offset),n.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let h=t.observer.selectionRange;t.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=e.from&&n.collapse(r,s)}moveToLine(t){let e=this.dom,n;if(t.node!=e)return t;for(let r=t.offset;!n&&r<e.childNodes.length;r++){let s=lt.get(e.childNodes[r]);s instanceof Ft&&(n=s.domAtPos(0))}for(let r=t.offset-1;!n&&r>=0;r--){let s=lt.get(e.childNodes[r]);s instanceof Ft&&(n=s.domAtPos(s.length))}return n?new xi(n.node,n.offset,!0):t}nearest(t){for(let e=t;e;){let n=lt.get(e);if(n&&n.rootView==this)return n;e=e.parentNode}return null}posFromDOM(t,e){let n=this.nearest(t);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(t,e)+n.posAtStart}domAtPos(t){let{i:e,off:n}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let r=this.children[e];if(n<r.length||r instanceof Ft)break;e++,n=0}return this.children[e].domAtPos(n)}coordsAt(t,e){let n=null,r=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=s-a.breakAfter,u=l-a.length;if(l<t)break;if(u<=t&&(u<t||a.covers(-1))&&(l>t||a.covers(1))&&(!n||a instanceof Ft&&!(n instanceof Ft&&e>=0)))n=a,r=u;else if(n&&u==t&&l==t&&a instanceof Gn&&Math.abs(e)<2){if(a.deco.startSide<0)break;o&&(n=null)}s=u}return n?n.coordsAt(t-r,e):null}coordsForChar(t){let{i:e,off:n}=this.childPos(t,1),r=this.children[e];if(!(r instanceof Ft))return null;for(;r.children.length;){let{i:a,off:l}=r.childPos(n,1);for(;;a++){if(a==r.children.length)return null;if((r=r.children[a]).length)break}n=l}if(!(r instanceof xn))return null;let s=fi(r.text,n);if(s==n)return null;let o=Ur(r.dom,n,s).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(t){let e=[],{from:n,to:r}=t,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==mt.LTR;for(let u=0,c=0;c<this.children.length;c++){let h=this.children[c],d=u+h.length;if(d>r)break;if(u>=n){let f=h.dom.getBoundingClientRect();if(e.push(f.height),o){let p=h.dom.lastChild,g=p?Ss(p):[];if(g.length){let m=g[g.length-1],O=l?m.right-f.left:f.right-m.left;O>a&&(a=O,this.minWidth=s,this.minWidthFrom=u,this.minWidthTo=d)}}}u=d+h.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?mt.RTL:mt.LTR}measureTextSize(){for(let s of this.children)if(s instanceof Ft){let o=s.measureTextSize();if(o)return o}let t=document.createElement("div"),e,n,r;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let s=Ss(t.firstChild)[0];e=t.getBoundingClientRect().height,n=s?s.width/27:7,r=s?s.height:e,t.remove()}),{lineHeight:e,charWidth:n,textHeight:r}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new vm(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let n=0,r=0;;r++){let s=r==e.viewports.length?null:e.viewports[r],o=s?s.from-1:this.length;if(o>n){let a=(e.lineBlockAt(o).bottom-e.lineBlockAt(n).top)/this.view.scaleY;t.push(Se.replace({widget:new uu(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,o))}if(!s)break;n=s.to+1}return Se.set(t)}updateDeco(){let t=1,e=this.view.state.facet(ho).map(s=>(this.dynamicDecorationMap[t++]=typeof s=="function")?s(this.view):s),n=!1,r=this.view.state.facet(Ym).map((s,o)=>{let a=typeof s=="function";return a&&(n=!0),a?s(this.view):s});for(r.length&&(this.dynamicDecorationMap[t++]=n,e.push(Ge.join(r))),this.decorations=[this.editContextFormatting,...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;return this.decorations}scrollIntoView(t){if(t.isSnapshot){let u=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=u.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let u of this.view.state.facet(Xm))try{if(u(this.view,t.range,t))return!0}catch(c){zi(this.view.state,c,"scroll handler")}let{range:e}=t,n=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),r;if(!n)return;!e.empty&&(r=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(n={left:Math.min(n.left,r.left),top:Math.min(n.top,r.top),right:Math.max(n.right,r.right),bottom:Math.max(n.bottom,r.bottom)});let s=xh(this.view),o={left:n.left-s.left,top:n.top-s.top,right:n.right+s.right,bottom:n.bottom+s.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;Ik(this.view.scrollDOM,o,e.head<e.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,a),-a),Math.max(Math.min(t.yMargin,l),-l),this.view.textDirection==mt.LTR)}}function lC(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}function Gm(i,t){let e=i.observer.selectionRange;if(!e.focusNode)return null;let n=wm(e.focusNode,e.focusOffset),r=Sm(e.focusNode,e.focusOffset),s=n||r;if(r&&n&&r.node!=n.node){let a=lt.get(r.node);if(!a||a instanceof xn&&a.text!=r.node.nodeValue)s=r;else if(i.docView.lastCompositionAfterCursor){let l=lt.get(n.node);!l||l instanceof xn&&l.text!=n.node.nodeValue||(s=r)}}if(i.docView.lastCompositionAfterCursor=s!=n,!s)return null;let o=t-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function cC(i,t,e){let n=Gm(i,e);if(!n)return null;let{node:r,from:s,to:o}=n,a=r.nodeValue;if(/[\n\r]/.test(a)||i.state.doc.sliceString(n.from,n.to)!=a)return null;let l=t.invertedDesc,u=new cn(l.mapPos(s),l.mapPos(o),s,o),c=[];for(let h=r.parentNode;;h=h.parentNode){let d=lt.get(h);if(d instanceof Jn)c.push({node:h,deco:d.mark});else{if(d instanceof Ft||h.nodeName=="DIV"&&h.parentNode==i.contentDOM)return{range:u,text:r,marks:c,line:h};if(h!=i.contentDOM)c.push({node:h,deco:new _o({inclusive:!0,attributes:Uk(h),tagName:h.tagName.toLowerCase()})});else return null}}}function uC(i,t){return i.nodeType!=1?0:(t&&i.childNodes[t-1].contentEditable=="false"?1:0)|(t<i.childNodes.length&&i.childNodes[t].contentEditable=="false"?2:0)}let hC=class{constructor(){this.changes=[]}compareRange(t,e){$a(t,e,this.changes)}comparePoint(t,e){$a(t,e,this.changes)}boundChange(t){$a(t,t,this.changes)}};function dC(i,t,e){let n=new hC;return Ge.compare(i,t,e,n),n.changes}function fC(i,t){for(let e=i;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function pC(i,t){let e=!1;return t&&i.iterChangedRanges((n,r)=>{n<t.to&&r>t.from&&(e=!0)}),e}function gC(i,t,e=1){let n=i.charCategorizer(t),r=i.doc.lineAt(t),s=t-r.from;if(r.length==0)return U.cursor(t);s==0?e=1:s==r.length&&(e=-1);let o=s,a=s;e<0?o=fi(r.text,s,!1):a=fi(r.text,s);let l=n(r.text.slice(o,a));for(;o>0;){let u=fi(r.text,o,!1);if(n(r.text.slice(u,o))!=l)break;o=u}for(;a<r.length;){let u=fi(r.text,a);if(n(r.text.slice(a,u))!=l)break;a=u}return U.range(o+r.from,a+r.from)}function mC(i,t){return t.left>i?t.left-i:Math.max(0,i-t.right)}function OC(i,t){return t.top>i?t.top-i:Math.max(0,i-t.bottom)}function Kl(i,t){return i.top<t.bottom-1&&i.bottom>t.top+1}function Vd(i,t){return t<i.top?{top:t,left:i.left,right:i.right,bottom:i.bottom}:i}function Gd(i,t){return t>i.bottom?{top:i.top,left:i.left,right:i.right,bottom:t}:i}function gu(i,t,e){let n,r,s,o,a=!1,l,u,c,h;for(let p=i.firstChild;p;p=p.nextSibling){let g=Ss(p);for(let m=0;m<g.length;m++){let O=g[m];r&&Kl(r,O)&&(O=Vd(Gd(O,r.bottom),r.top));let b=mC(t,O),x=OC(e,O);if(b==0&&x==0)return p.nodeType==3?Ud(p,t,e):gu(p,t,e);(!n||o>x||o==x&&s>b)&&(n=p,r=O,s=b,o=x,a=b?t<O.left?m>0:m<g.length-1:!0),b==0?e>O.bottom&&(!c||c.bottom<O.bottom)?(l=p,c=O):e<O.top&&(!h||h.top>O.top)&&(u=p,h=O):c&&Kl(c,O)?c=Gd(c,O.bottom):h&&Kl(h,O)&&(h=Vd(h,O.top))}}if(c&&c.bottom>=e?(n=l,r=c):h&&h.top<=e&&(n=u,r=h),!n)return{node:i,offset:0};let d=Math.max(r.left,Math.min(r.right,t));if(n.nodeType==3)return Ud(n,d,e);if(a&&n.contentEditable!="false")return gu(n,d,e);let f=Array.prototype.indexOf.call(i.childNodes,n)+(t>=(r.left+r.right)/2?1:0);return{node:i,offset:f}}function Ud(i,t,e){let n=i.nodeValue.length,r=-1,s=1e9,o=0;for(let a=0;a<n;a++){let l=Ur(i,a,a+1).getClientRects();for(let u=0;u<l.length;u++){let c=l[u];if(c.top==c.bottom)continue;o||(o=t-c.left);let h=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&h<s){let d=t>=(c.left+c.right)/2,f=d;if((le.chrome||le.gecko)&&Ur(i,a).getBoundingClientRect().left==c.right&&(f=!d),h<=0)return{node:i,offset:a+(f?1:0)};r=a+(f?1:0),s=h}}}return{node:i,offset:r>-1?r:o>0?i.nodeValue.length:0}}function Um(i,t,e,n=-1){var r,s;let o=i.contentDOM.getBoundingClientRect(),a=o.top+i.viewState.paddingTop,l,{docHeight:u}=i.viewState,{x:c,y:h}=t,d=h-a;if(d<0)return 0;if(d>u)return i.state.doc.length;for(let S=i.viewState.heightOracle.textHeight/2,w=!1;l=i.elementAtHeight(d),l.type!=Ti.Text;)for(;d=n>0?l.bottom+S:l.top-S,!(d>=0&&d<=u);){if(w)return e?null:0;w=!0,n=-n}h=a+d;let f=l.from;if(f<i.viewport.from)return i.viewport.from==0?0:e?null:Hd(i,o,l,c,h);if(f>i.viewport.to)return i.viewport.to==i.state.doc.length?i.state.doc.length:e?null:Hd(i,o,l,c,h);let p=i.dom.ownerDocument,g=i.root.elementFromPoint?i.root:p,m=g.elementFromPoint(c,h);m&&!i.contentDOM.contains(m)&&(m=null),m||(c=Math.max(o.left+1,Math.min(o.right-1,c)),m=g.elementFromPoint(c,h),m&&!i.contentDOM.contains(m)&&(m=null));let O,b=-1;if(m&&((r=i.docView.nearest(m))===null||r===void 0?void 0:r.isEditable)!=!1){if(p.caretPositionFromPoint){let S=p.caretPositionFromPoint(c,h);S&&({offsetNode:O,offset:b}=S)}else if(p.caretRangeFromPoint){let S=p.caretRangeFromPoint(c,h);S&&({startContainer:O,startOffset:b}=S)}O&&(!i.contentDOM.contains(O)||le.safari&&bC(O,b,c)||le.chrome&&yC(O,b,c))&&(O=void 0),O&&(b=Math.min(Fn(O),b))}if(!O||!i.docView.dom.contains(O)){let S=Ft.find(i.docView,f);if(!S)return d>l.top+l.height/2?l.to:l.from;({node:O,offset:b}=gu(S.dom,c,h))}let x=i.docView.nearest(O);if(!x)return null;if(x.isWidget&&((s=x.dom)===null||s===void 0?void 0:s.nodeType)==1){let S=x.dom.getBoundingClientRect();return t.y<S.top||t.y<=S.bottom&&t.x<=(S.left+S.right)/2?x.posAtStart:x.posAtEnd}else return x.localPosFromDOM(O,b)+x.posAtStart}function Hd(i,t,e,n,r){let s=Math.round((n-t.left)*i.defaultCharacterWidth);if(i.lineWrapping&&e.height>i.defaultLineHeight*1.5){let a=i.viewState.heightOracle.textHeight,l=Math.floor((r-e.top-(i.defaultLineHeight-a)*.5)/a);s+=l*i.viewState.heightOracle.lineLength}let o=i.state.sliceDoc(e.from,e.to);return e.from+eu(o,s,i.state.tabSize)}function Hm(i,t,e){let n,r=i;if(i.nodeType!=3||t!=(n=i.nodeValue.length))return!1;for(;;){let s=r.nextSibling;if(s){if(s.nodeName=="BR")break;return!1}else{let o=r.parentNode;if(!o||o.nodeName=="DIV")break;r=o}}return Ur(i,n-1,n).getBoundingClientRect().right>e}function bC(i,t,e){return Hm(i,t,e)}function yC(i,t,e){if(t!=0)return Hm(i,t,e);for(let r=i;;){let s=r.parentNode;if(!s||s.nodeType!=1||s.firstChild!=r)return!1;if(s.classList.contains("cm-line"))break;r=s}let n=i.nodeType==1?i.getBoundingClientRect():Ur(i,0,Math.max(i.nodeValue.length,1)).getBoundingClientRect();return e-n.left>5}function mu(i,t,e){let n=i.lineBlockAt(t);if(Array.isArray(n.type)){let r;for(let s of n.type){if(s.from>t)break;if(!(s.to<t)){if(s.from<t&&s.to>t)return s;(!r||s.type==Ti.Text&&(r.type!=s.type||(e<0?s.from<t:s.to>t)))&&(r=s)}}return r||n}return n}function xC(i,t,e,n){let r=mu(i,t.head,t.assoc||-1),s=!n||r.type!=Ti.Text||!(i.lineWrapping||r.widgetLineBreaks)?null:i.coordsAtPos(t.assoc<0&&t.head>r.from?t.head-1:t.head);if(s){let o=i.dom.getBoundingClientRect(),a=i.textDirectionAt(r.from),l=i.posAtCoords({x:e==(a==mt.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(l!=null)return U.cursor(l,e?-1:1)}return U.cursor(e?r.to:r.from,e?-1:1)}function Kd(i,t,e,n){let r=i.state.doc.lineAt(t.head),s=i.bidiSpans(r),o=i.textDirectionAt(r.from);for(let a=t,l=null;;){let u=sC(r,s,o,a,e),c=_m;if(!u){if(r.number==(e?i.state.doc.lines:1))return a;c=`
`,r=i.state.doc.line(r.number+(e?1:-1)),s=i.bidiSpans(r),u=i.visualLineSide(r,!e)}if(l){if(!l(c))return a}else{if(!n)return u;l=n(c)}a=u}}function wC(i,t,e){let n=i.state.charCategorizer(t),r=n(e);return s=>{let o=n(s);return r==yt.Space&&(r=o),r==o}}function SC(i,t,e,n){let r=t.head,s=e?1:-1;if(r==(e?i.state.doc.length:0))return U.cursor(r,t.assoc);let o=t.goalColumn,a,l=i.contentDOM.getBoundingClientRect(),u=i.coordsAtPos(r,t.assoc||-1),c=i.documentTop;if(u)o==null&&(o=u.left-l.left),a=s<0?u.top:u.bottom;else{let f=i.viewState.lineBlockAt(r);o==null&&(o=Math.min(l.right-l.left,i.defaultCharacterWidth*(r-f.from))),a=(s<0?f.top:f.bottom)+c}let h=l.left+o,d=n??i.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let p=a+(d+f)*s,g=Um(i,{x:h,y:p},!1,s);if(p<l.top||p>l.bottom||(s<0?g<r:g>r)){let m=i.docView.coordsForChar(g),O=!m||p<m.top?-1:1;return U.cursor(g,O,void 0,o)}}}function to(i,t,e){for(;;){let n=0;for(let r of i)r.between(t-1,t+1,(s,o,a)=>{if(t>s&&t<o){let l=n||e||(t-s<o-t?-1:1);t=l<0?s:o,n=l}});if(!n)return t}}function Km(i,t){let e=null;for(let n=0;n<t.ranges.length;n++){let r=t.ranges[n],s=null;if(r.empty){let o=to(i,r.from,0);o!=r.from&&(s=U.cursor(o,-1))}else{let o=to(i,r.from,-1),a=to(i,r.to,1);(o!=r.from||a!=r.to)&&(s=U.range(r.from==r.anchor?o:a,r.from==r.head?o:a))}s&&(e||(e=t.ranges.slice()),e[n]=s)}return e?U.create(e,t.mainIndex):t}function Jl(i,t,e){let n=to(i.state.facet(Bo).map(r=>r(i)),e.from,t.head>e.from?-1:1);return n==e.from?e:U.cursor(n,n<e.from?1:-1)}const Ys="￿";class vC{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(qe.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Ys}readRange(t,e){if(!t)return this;let n=t.parentNode;for(let r=t;;){this.findPointBefore(n,r);let s=this.text.length;this.readNode(r);let o=r.nextSibling;if(o==e)break;let a=lt.get(r),l=lt.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:Za(r))||Za(o)&&(r.nodeName!="BR"||r.cmIgnore)&&this.text.length>s)&&!CC(o,e)&&this.lineBreak(),r=o}return this.findPointBefore(n,e),this}readTextNode(t){let e=t.nodeValue;for(let n of this.points)n.node==t&&(n.pos=this.text.length+Math.min(n.offset,e.length));for(let n=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,a;if(this.lineSeparator?(s=e.indexOf(this.lineSeparator,n),o=this.lineSeparator.length):(a=r.exec(e))&&(s=a.index,o=a[0].length),this.append(e.slice(n,s<0?e.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==t&&l.pos>this.text.length&&(l.pos-=o-1);n=s+o}}readNode(t){if(t.cmIgnore)return;let e=lt.get(t),n=e&&e.overrideDOMText;if(n!=null){this.findPointInside(t,n.length);for(let r=n.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let n of this.points)n.node==t&&t.childNodes[n.offset]==e&&(n.pos=this.text.length)}findPointInside(t,e){for(let n of this.points)(t.nodeType==3?n.node==t:t.contains(n.node))&&(n.pos=this.text.length+(kC(t,n.node,n.offset)?e:0))}}function kC(i,t,e){for(;;){if(!t||e<Fn(t))return!1;if(t==i)return!0;e=Gr(t)+1,t=t.parentNode}}function CC(i,t){let e;for(;!(i==t||!i);i=i.nextSibling){let n=lt.get(i);if(!(n?.isWidget||i.cmIgnore))return!1;n&&(e||(e=[])).push(n)}if(e)for(let n of e){let r=n.overrideDOMText;if(r?.length)return!1}return!0}class Jd{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class DC{constructor(t,e,n,r){this.typeOver=r,this.bounds=null,this.text="",this.domChanged=e>-1;let{impreciseHead:s,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=t.docView.domBoundsAround(e,n,0))){let a=s||o?[]:QC(t),l=new vC(a,t.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=PC(a,this.bounds.from)}else{let a=t.observer.selectionRange,l=s&&s.node==a.focusNode&&s.offset==a.focusOffset||!au(t.contentDOM,a.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(a.focusNode,a.focusOffset),u=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!au(t.contentDOM,a.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(a.anchorNode,a.anchorOffset),c=t.viewport;if((le.ios||le.chrome)&&t.state.selection.main.empty&&l!=u&&(c.from>0||c.to<t.state.doc.length)){let h=Math.min(l,u),d=Math.max(l,u),f=c.from-h,p=c.to-d;(f==0||f==1||h==0)&&(p==0||p==-1||d==t.state.doc.length)&&(l=0,u=t.state.doc.length)}this.newSel=U.single(u,l)}}}function Jm(i,t){let e,{newSel:n}=t,r=i.state.selection.main,s=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:a}=t.bounds,l=r.from,u=null;(s===8||le.android&&t.text.length<a-o)&&(l=r.to,u="end");let c=e0(i.state.doc.sliceString(o,a,Ys),t.text,l-o,u);c&&(le.chrome&&s==13&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==Ys+Ys&&c.toB--,e={from:o+c.from,to:o+c.toA,insert:Ue.of(t.text.slice(c.from,c.toB).split(Ys))})}else n&&(!i.hasFocus&&i.state.facet(Yn)||n.main.eq(r))&&(n=null);if(!e&&!n)return!1;if(!e&&t.typeOver&&!r.empty&&n&&n.main.empty?e={from:r.from,to:r.to,insert:i.state.doc.slice(r.from,r.to)}:(le.mac||le.android)&&e&&e.from==e.to&&e.from==r.head-1&&/^\. ?$/.test(e.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(n&&e.insert.length==2&&(n=U.single(n.main.anchor-1,n.main.head-1)),e={from:e.from,to:e.to,insert:Ue.of([e.insert.toString().replace("."," ")])}):e&&e.from>=r.from&&e.to<=r.to&&(e.from!=r.from||e.to!=r.to)&&r.to-r.from-(e.to-e.from)<=4?e={from:r.from,to:r.to,insert:i.state.doc.slice(r.from,e.from).append(e.insert).append(i.state.doc.slice(e.to,r.to))}:le.chrome&&e&&e.from==e.to&&e.from==r.head&&e.insert.toString()==`
 `&&i.lineWrapping&&(n&&(n=U.single(n.main.anchor-1,n.main.head-1)),e={from:r.from,to:r.to,insert:Ue.of([" "])}),e)return wh(i,e,n,s);if(n&&!n.main.eq(r)){let o=!1,a="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(o=!0),a=i.inputState.lastSelectionOrigin,a=="select.pointer"&&(n=Km(i.state.facet(Bo).map(l=>l(i)),n))),i.dispatch({selection:n,scrollIntoView:o,userEvent:a}),!0}else return!1}function wh(i,t,e,n=-1){if(le.ios&&i.inputState.flushIOSKey(t))return!0;let r=i.state.selection.main;if(le.android&&(t.to==r.to&&(t.from==r.from||t.from==r.from-1&&i.state.sliceDoc(t.from,r.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&fs(i.contentDOM,"Enter",13)||(t.from==r.from-1&&t.to==r.to&&t.insert.length==0||n==8&&t.insert.length<t.to-t.from&&t.to>r.head)&&fs(i.contentDOM,"Backspace",8)||t.from==r.from&&t.to==r.to+1&&t.insert.length==0&&fs(i.contentDOM,"Delete",46)))return!0;let s=t.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let o,a=()=>o||(o=$C(i,t,e));return i.state.facet(zm).some(l=>l(i,t.from,t.to,s,a))||i.dispatch(a()),!0}function $C(i,t,e){let n,r=i.state,s=r.selection.main,o=-1;if(t.from==t.to&&t.from<s.from||t.from>s.to){let l=t.from<s.from?-1:1,u=l<0?s.from:s.to,c=to(r.facet(Bo).map(h=>h(i)),u,l);t.from==c&&(o=c)}if(o>-1)n={changes:t,selection:U.cursor(t.from+t.insert.length,-1)};else if(t.from>=s.from&&t.to<=s.to&&t.to-t.from>=(s.to-s.from)/3&&(!e||e.main.empty&&e.main.from==t.from+t.insert.length)&&i.inputState.composing<0){let l=s.from<t.from?r.sliceDoc(s.from,t.from):"",u=s.to>t.to?r.sliceDoc(t.to,s.to):"";n=r.replaceSelection(i.state.toText(l+t.insert.sliceString(0,void 0,i.state.lineBreak)+u))}else{let l=r.changes(t),u=e&&e.main.to<=l.newLength?e.main:void 0;if(r.selection.ranges.length>1&&i.inputState.composing>=0&&t.to<=s.to&&t.to>=s.to-10){let c=i.state.sliceDoc(t.from,t.to),h,d=e&&Gm(i,e.main.head);if(d){let g=t.insert.length-(t.to-t.from);h={from:d.from,to:d.to-g}}else h=i.state.doc.lineAt(s.head);let f=s.to-t.to,p=s.to-s.from;n=r.changeByRange(g=>{if(g.from==s.from&&g.to==s.to)return{changes:l,range:u||g.map(l)};let m=g.to-f,O=m-c.length;if(g.to-g.from!=p||i.state.sliceDoc(O,m)!=c||g.to>=h.from&&g.from<=h.to)return{range:g};let b=r.changes({from:O,to:m,insert:t.insert}),x=g.to-s.to;return{changes:b,range:u?U.range(Math.max(0,u.anchor+x),Math.max(0,u.head+x)):g.map(b)}})}else n={changes:l,selection:u&&r.selection.replaceRange(u)}}let a="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,a+=".compose",i.inputState.compositionFirstChange&&(a+=".start",i.inputState.compositionFirstChange=!1)),r.update(n,{userEvent:a,scrollIntoView:!0})}function e0(i,t,e,n){let r=Math.min(i.length,t.length),s=0;for(;s<r&&i.charCodeAt(s)==t.charCodeAt(s);)s++;if(s==r&&i.length==t.length)return null;let o=i.length,a=t.length;for(;o>0&&a>0&&i.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if(n=="end"){let l=Math.max(0,s-Math.min(o,a));e-=o+l-s}if(o<s&&i.length<t.length){let l=e<=s&&e>=o?s-e:0;s-=l,a=s+(a-o),o=s}else if(a<s){let l=e<=s&&e>=a?s-e:0;s-=l,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function QC(i){let t=[];if(i.root.activeElement!=i.contentDOM)return t;let{anchorNode:e,anchorOffset:n,focusNode:r,focusOffset:s}=i.observer.selectionRange;return e&&(t.push(new Jd(e,n)),(r!=e||s!=n)&&t.push(new Jd(r,s))),t}function PC(i,t){if(i.length==0)return null;let e=i[0].pos,n=i.length==2?i[1].pos:e;return e>-1&&n>-1?U.single(e+t,n+t):null}class AC{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,le.safari&&t.contentDOM.addEventListener("input",()=>null),le.gecko&&YC(t.contentDOM.ownerDocument)}handleEvent(t){!ZC(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(t.type,t)):this.runHandlers(t.type,t))}runHandlers(t,e){let n=this.handlers[t];if(n){for(let r of n.observers)r(this.view,e);for(let r of n.handlers){if(e.defaultPrevented)break;if(r(this.view,e)){e.preventDefault();break}}}}ensureHandlers(t){let e=EC(t),n=this.handlers,r=this.view.contentDOM;for(let s in e)if(s!="scroll"){let o=!e[s].handlers.length,a=n[s];a&&o!=!a.handlers.length&&(r.removeEventListener(s,this.handleEvent),a=null),a||r.addEventListener(s,this.handleEvent,{passive:o})}for(let s in n)s!="scroll"&&!e[s]&&r.removeEventListener(s,this.handleEvent);this.handlers=e}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&i0.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),le.android&&le.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let e;return le.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((e=t0.find(n=>n.keyCode==t.keyCode))&&!t.ctrlKey||TC.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=e||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let e=this.pendingIOSKey;return!e||e.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,fs(this.view.contentDOM,e.key,e.keyCode,e instanceof KeyboardEvent?e:void 0))}ignoreDuringComposition(t){return!/^key/.test(t.type)||t.synthetic?!1:this.composing>0?!0:le.safari&&!le.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function ef(i,t){return(e,n)=>{try{return t.call(i,n,e)}catch(r){zi(e.state,r)}}}function EC(i){let t=Object.create(null);function e(n){return t[n]||(t[n]={observers:[],handlers:[]})}for(let n of i){let r=n.spec,s=r&&r.plugin.domEventHandlers,o=r&&r.plugin.domEventObservers;if(s)for(let a in s){let l=s[a];l&&e(a).handlers.push(ef(n.value,l))}if(o)for(let a in o){let l=o[a];l&&e(a).observers.push(ef(n.value,l))}}for(let n in wn)e(n).handlers.push(wn[n]);for(let n in hn)e(n).observers.push(hn[n]);return t}const t0=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],TC="dthko",i0=[16,17,18,20,91,92,224,225],Jo=6;function ea(i){return Math.max(0,i)*.7+8}function RC(i,t){return Math.max(Math.abs(i.clientX-t.clientX),Math.abs(i.clientY-t.clientY))}class _C{constructor(t,e,n,r){this.view=t,this.startEvent=e,this.style=n,this.mustSelect=r,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=e,this.scrollParents=Lk(t.contentDOM),this.atoms=t.state.facet(Bo).map(o=>o(t));let s=t.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(qe.allowMultipleSelections)&&MC(t,e),this.dragging=FC(t,e)&&s0(e)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&RC(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let e=0,n=0,r=0,s=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:r,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=xh(this.view);t.clientX-l.left<=r+Jo?e=-ea(r-t.clientX):t.clientX+l.right>=o-Jo&&(e=ea(t.clientX-o)),t.clientY-l.top<=s+Jo?n=-ea(s-t.clientY):t.clientY+l.bottom>=a-Jo&&(n=ea(t.clientY-a)),this.setScrollSpeed(e,n)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:e}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),e&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=e,e=0),(t||e)&&this.view.win.scrollBy(t,e),this.dragging===!1&&this.select(this.lastEvent)}select(t){let{view:e}=this,n=Km(this.atoms,this.style.get(t,this.extend,this.multiple));(this.mustSelect||!n.eq(e.state.selection,this.dragging===!1))&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function MC(i,t){let e=i.state.facet(Mm);return e.length?e[0](t):le.mac?t.metaKey:t.ctrlKey}function BC(i,t){let e=i.state.facet(Bm);return e.length?e[0](t):le.mac?!t.altKey:!t.ctrlKey}function FC(i,t){let{main:e}=i.state.selection;if(e.empty)return!1;let n=uo(i.root);if(!n||n.rangeCount==0)return!0;let r=n.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function ZC(i,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,n;e!=i.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(n=lt.get(e))&&n.ignoreEvent(t))return!1;return!0}const wn=Object.create(null),hn=Object.create(null),n0=le.ie&&le.ie_version<15||le.ios&&le.webkit_version<604;function zC(i){let t=i.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{i.focus(),e.remove(),r0(i,e.value)},50)}function yl(i,t,e){for(let n of i.facet(t))e=n(e,i);return e}function r0(i,t){t=yl(i.state,Oh,t);let{state:e}=i,n,r=1,s=e.toText(t),o=s.lines==e.selection.ranges.length;if(Ou!=null&&e.selection.ranges.every(l=>l.empty)&&Ou==s.toString()){let l=-1;n=e.changeByRange(u=>{let c=e.doc.lineAt(u.from);if(c.from==l)return{range:u};l=c.from;let h=e.toText((o?s.line(r++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:h},range:U.cursor(u.from+h.length)}})}else o?n=e.changeByRange(l=>{let u=s.line(r++);return{changes:{from:l.from,to:l.to,insert:u.text},range:U.cursor(l.from+u.length)}}):n=e.replaceSelection(s);i.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}hn.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};wn.keydown=(i,t)=>(i.inputState.setSelectionOrigin("select"),t.keyCode==27&&i.inputState.tabFocusMode!=0&&(i.inputState.tabFocusMode=Date.now()+2e3),!1);hn.touchstart=(i,t)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};hn.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};wn.mousedown=(i,t)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let e=null;for(let n of i.state.facet(Fm))if(e=n(i,t),e)break;if(!e&&t.button==0&&(e=LC(i,t)),e){let n=!i.hasFocus;i.inputState.startMouseSelection(new _C(i,t,e,n)),n&&i.observer.ignore(()=>{bm(i.contentDOM);let s=i.root.activeElement;s&&!s.contains(i.contentDOM)&&s.blur()});let r=i.inputState.mouseSelection;if(r)return r.start(t),r.dragging===!1}else i.inputState.setSelectionOrigin("select.pointer");return!1};function tf(i,t,e,n){if(n==1)return U.cursor(t,e);if(n==2)return gC(i.state,t,e);{let r=Ft.find(i.docView,t),s=i.state.doc.lineAt(r?r.posAtEnd:t),o=r?r.posAtStart:s.from,a=r?r.posAtEnd:s.to;return a<i.state.doc.length&&a==s.to&&a++,U.range(o,a)}}let nf=(i,t,e)=>t>=e.top&&t<=e.bottom&&i>=e.left&&i<=e.right;function jC(i,t,e,n){let r=Ft.find(i.docView,t);if(!r)return 1;let s=t-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&nf(e,n,o))return-1;let a=r.coordsAt(s,1);return a&&nf(e,n,a)?1:o&&o.bottom>=n?-1:1}function rf(i,t){let e=i.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:jC(i,e,t.clientX,t.clientY)}}const IC=le.ie&&le.ie_version<=11;let sf=null,of=0,af=0;function s0(i){if(!IC)return i.detail;let t=sf,e=af;return sf=i,af=Date.now(),of=!t||e>Date.now()-400&&Math.abs(t.clientX-i.clientX)<2&&Math.abs(t.clientY-i.clientY)<2?(of+1)%3:1}function LC(i,t){let e=rf(i,t),n=s0(t),r=i.state.selection;return{update(s){s.docChanged&&(e.pos=s.changes.mapPos(e.pos),r=r.map(s.changes))},get(s,o,a){let l=rf(i,s),u,c=tf(i,l.pos,l.bias,n);if(e.pos!=l.pos&&!o){let h=tf(i,e.pos,e.bias,n),d=Math.min(h.from,c.from),f=Math.max(h.to,c.to);c=d<c.from?U.range(d,f):U.range(f,d)}return o?r.replaceRange(r.main.extend(c.from,c.to)):a&&n==1&&r.ranges.length>1&&(u=XC(r,l.pos))?u:a?r.addRange(c):U.create([c])}}}function XC(i,t){for(let e=0;e<i.ranges.length;e++){let{from:n,to:r}=i.ranges[e];if(n<=t&&r>=t)return U.create(i.ranges.slice(0,e).concat(i.ranges.slice(e+1)),i.mainIndex==e?0:i.mainIndex-(i.mainIndex>e?1:0))}return null}wn.dragstart=(i,t)=>{let{selection:{main:e}}=i.state;if(t.target.draggable){let r=i.docView.nearest(t.target);if(r&&r.isWidget){let s=r.posAtStart,o=s+r.length;(s>=e.to||o<=e.from)&&(e=U.range(s,o))}}let{inputState:n}=i;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=e,t.dataTransfer&&(t.dataTransfer.setData("Text",yl(i.state,bh,i.state.sliceDoc(e.from,e.to))),t.dataTransfer.effectAllowed="copyMove"),!1};wn.dragend=i=>(i.inputState.draggedContent=null,!1);function lf(i,t,e,n){if(e=yl(i.state,Oh,e),!e)return;let r=i.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:s}=i.inputState,o=n&&s&&BC(i,t)?{from:s.from,to:s.to}:null,a={from:r,insert:e},l=i.state.changes(o?[o,a]:a);i.focus(),i.dispatch({changes:l,selection:{anchor:l.mapPos(r,-1),head:l.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"}),i.inputState.draggedContent=null}wn.drop=(i,t)=>{if(!t.dataTransfer)return!1;if(i.state.readOnly)return!0;let e=t.dataTransfer.files;if(e&&e.length){let n=Array(e.length),r=0,s=()=>{++r==e.length&&lf(i,t,n.filter(o=>o!=null).join(i.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let a=new FileReader;a.onerror=s,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[o]=a.result),s()},a.readAsText(e[o])}return!0}else{let n=t.dataTransfer.getData("Text");if(n)return lf(i,t,n,!0),!0}return!1};wn.paste=(i,t)=>{if(i.state.readOnly)return!0;i.observer.flush();let e=n0?null:t.clipboardData;return e?(r0(i,e.getData("text/plain")||e.getData("text/uri-list")),!0):(zC(i),!1)};function NC(i,t){let e=i.dom.parentNode;if(!e)return;let n=e.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout(()=>{n.remove(),i.focus()},50)}function WC(i){let t=[],e=[],n=!1;for(let r of i.selection.ranges)r.empty||(t.push(i.sliceDoc(r.from,r.to)),e.push(r));if(!t.length){let r=-1;for(let{from:s}of i.selection.ranges){let o=i.doc.lineAt(s);o.number>r&&(t.push(o.text),e.push({from:o.from,to:Math.min(i.doc.length,o.to+1)})),r=o.number}n=!0}return{text:yl(i,bh,t.join(i.lineBreak)),ranges:e,linewise:n}}let Ou=null;wn.copy=wn.cut=(i,t)=>{let{text:e,ranges:n,linewise:r}=WC(i.state);if(!e&&!r)return!1;Ou=r?e:null,t.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let s=n0?null:t.clipboardData;return s?(s.clearData(),s.setData("text/plain",e),!0):(NC(i,e),!1)};const o0=Zn.define();function a0(i,t){let e=[];for(let n of i.facet(jm)){let r=n(i,t);r&&e.push(r)}return e.length?i.update({effects:e,annotations:o0.of(!0)}):null}function l0(i){setTimeout(()=>{let t=i.hasFocus;if(t!=i.inputState.notifiedFocused){let e=a0(i.state,t);e?i.dispatch(e):i.update([])}},10)}hn.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),l0(i)};hn.blur=i=>{i.observer.clearSelectionRange(),l0(i)};hn.compositionstart=hn.compositionupdate=i=>{i.observer.editContext||(i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0))};hn.compositionend=i=>{i.observer.editContext||(i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,le.chrome&&le.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50))};hn.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};wn.beforeinput=(i,t)=>{var e,n;if(t.inputType=="insertReplacementText"&&i.observer.editContext){let s=(e=t.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain"),o=t.getTargetRanges();if(s&&o.length){let a=o[0],l=i.posAtDOM(a.startContainer,a.startOffset),u=i.posAtDOM(a.endContainer,a.endOffset);return wh(i,{from:l,to:u,insert:i.state.toText(s)},null),!0}}let r;if(le.chrome&&le.android&&(r=t0.find(s=>s.inputType==t.inputType))&&(i.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let s=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return le.ios&&t.inputType=="deleteContentForward"&&i.observer.flushSoon(),le.safari&&t.inputType=="insertText"&&i.inputState.composing>=0&&setTimeout(()=>hn.compositionend(i,t),20),!1};const cf=new Set;function YC(i){cf.has(i)||(cf.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}const uf=["pre-wrap","normal","pre-line","break-spaces"];let Cs=!1;function hf(){Cs=!1}class qC{constructor(t){this.lineWrapping=t,this.doc=Ue.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(t,e){let n=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((e-t-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return uf.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let n=0;n<t.length;n++){let r=t[n];r<0?n++:this.heightSamples[Math.floor(r*10)]||(e=!0,this.heightSamples[Math.floor(r*10)]=!0)}return e}refresh(t,e,n,r,s,o){let a=uf.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=e,this.charWidth=n,this.textHeight=r,this.lineLength=s,l){this.heightSamples={};for(let u=0;u<o.length;u++){let c=o[u];c<0?u++:this.heightSamples[Math.floor(c*10)]=!0}}return l}}class VC{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class Rn{constructor(t,e,n,r,s){this.from=t,this.length=e,this.top=n,this.height=r,this._content=s}get type(){return typeof this._content=="number"?Ti.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Pr?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let e=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new Rn(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var gt=(function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i})(gt||(gt={}));const Qa=.001;class Ri{constructor(t,e,n=2){this.length=t,this.height=e,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t){this.height!=t&&(Math.abs(this.height-t)>Qa&&(Cs=!0),this.height=t)}replace(t,e,n){return Ri.of(n)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,n,r){let s=this,o=n.doc;for(let a=r.length-1;a>=0;a--){let{fromA:l,toA:u,fromB:c,toB:h}=r[a],d=s.lineAt(l,gt.ByPosNoHeight,n.setDoc(e),0,0),f=d.to>=u?d:s.lineAt(u,gt.ByPosNoHeight,n,0,0);for(h+=f.to-u,u=f.to;a>0&&d.from<=r[a-1].toA;)l=r[a-1].fromA,c=r[a-1].fromB,a--,l<d.from&&(d=s.lineAt(l,gt.ByPosNoHeight,n,0,0));c+=d.from-l,l=d.from;let p=Sh.build(n.setDoc(o),t,c,h);s=Ia(s,s.replace(l,u,p))}return s.updateHeight(n,0)}static empty(){return new Gi(0,0)}static of(t){if(t.length==1)return t[0];let e=0,n=t.length,r=0,s=0;for(;;)if(e==n)if(r>s*2){let a=t[e-1];a.break?t.splice(--e,1,a.left,null,a.right):t.splice(--e,1,a.left,a.right),n+=1+a.break,r-=a.size}else if(s>r*2){let a=t[n];a.break?t.splice(n,1,a.left,null,a.right):t.splice(n,1,a.left,a.right),n+=2+a.break,s-=a.size}else break;else if(r<s){let a=t[e++];a&&(r+=a.size)}else{let a=t[--n];a&&(s+=a.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,n++),new GC(Ri.of(t.slice(0,e)),o,Ri.of(t.slice(n)))}}function Ia(i,t){return i==t?i:(i.constructor!=t.constructor&&(Cs=!0),t)}Ri.prototype.size=1;class c0 extends Ri{constructor(t,e,n){super(t,e),this.deco=n}blockAt(t,e,n,r){return new Rn(r,this.length,n,this.height,this.deco||0)}lineAt(t,e,n,r,s){return this.blockAt(0,n,r,s)}forEachLine(t,e,n,r,s,o){t<=s+this.length&&e>=s&&o(this.blockAt(0,n,r,s))}updateHeight(t,e=0,n=!1,r){return r&&r.from<=e&&r.more&&this.setHeight(r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Gi extends c0{constructor(t,e){super(t,e,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(t,e,n,r){return new Rn(r,this.length,n,this.height,this.breaks)}replace(t,e,n){let r=n[0];return n.length==1&&(r instanceof Gi||r instanceof hi&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof hi?r=new Gi(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Ri.of(n)}updateHeight(t,e=0,n=!1,r){return r&&r.from<=e&&r.more?this.setHeight(r.heights[r.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class hi extends Ri{constructor(t){super(t,0)}heightMetrics(t,e){let n=t.doc.lineAt(e).number,r=t.doc.lineAt(e+this.length).number,s=r-n+1,o,a=0;if(t.lineWrapping){let l=Math.min(this.height,t.lineHeight*s);o=l/s,this.length>s+1&&(a=(this.height-l)/(this.length-s-1))}else o=this.height/s;return{firstLine:n,lastLine:r,perLine:o,perChar:a}}blockAt(t,e,n,r){let{firstLine:s,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(e,r);if(e.lineWrapping){let u=r+(t<e.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-n)/this.height))*this.length)),c=e.doc.lineAt(u),h=a+c.length*l,d=Math.max(n,t-h/2);return new Rn(c.from,c.length,d,h,0)}else{let u=Math.max(0,Math.min(o-s,Math.floor((t-n)/a))),{from:c,length:h}=e.doc.line(s+u);return new Rn(c,h,n+a*u,a,0)}}lineAt(t,e,n,r,s){if(e==gt.ByHeight)return this.blockAt(t,n,r,s);if(e==gt.ByPosNoHeight){let{from:f,to:p}=n.doc.lineAt(t);return new Rn(f,p-f,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(n,s),u=n.doc.lineAt(t),c=a+u.length*l,h=u.number-o,d=r+a*h+l*(u.from-s-h);return new Rn(u.from,u.length,Math.max(r,Math.min(d,r+this.height-c)),c,0)}forEachLine(t,e,n,r,s,o){t=Math.max(t,s),e=Math.min(e,s+this.length);let{firstLine:a,perLine:l,perChar:u}=this.heightMetrics(n,s);for(let c=t,h=r;c<=e;){let d=n.doc.lineAt(c);if(c==t){let p=d.number-a;h+=l*p+u*(t-s-p)}let f=l+u*d.length;o(new Rn(d.from,d.length,h,f,0)),h+=f,c=d.to+1}}replace(t,e,n){let r=this.length-e;if(r>0){let s=n[n.length-1];s instanceof hi?n[n.length-1]=new hi(s.length+r):n.push(null,new hi(r-1))}if(t>0){let s=n[0];s instanceof hi?n[0]=new hi(t+s.length):n.unshift(new hi(t-1),null)}return Ri.of(n)}decomposeLeft(t,e){e.push(new hi(t-1),null)}decomposeRight(t,e){e.push(null,new hi(this.length-t-1))}updateHeight(t,e=0,n=!1,r){let s=e+this.length;if(r&&r.from<=e+this.length&&r.more){let o=[],a=Math.max(e,r.from),l=-1;for(r.from>e&&o.push(new hi(r.from-e-1).updateHeight(t,e));a<=s&&r.more;){let c=t.doc.lineAt(a).length;o.length&&o.push(null);let h=r.heights[r.index++];l==-1?l=h:Math.abs(h-l)>=Qa&&(l=-2);let d=new Gi(c,h);d.outdated=!1,o.push(d),a+=c+1}a<=s&&o.push(null,new hi(s-a).updateHeight(t,a));let u=Ri.of(o);return(l<0||Math.abs(u.height-this.height)>=Qa||Math.abs(l-this.heightMetrics(t,e).perLine)>=Qa)&&(Cs=!0),Ia(this,u)}else(n||this.outdated)&&(this.setHeight(t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class GC extends Ri{constructor(t,e,n){super(t.length+e+n.length,t.height+n.height,e|(t.outdated||n.outdated?2:0)),this.left=t,this.right=n,this.size=t.size+n.size}get break(){return this.flags&1}blockAt(t,e,n,r){let s=n+this.left.height;return t<s?this.left.blockAt(t,e,n,r):this.right.blockAt(t,e,s,r+this.left.length+this.break)}lineAt(t,e,n,r,s){let o=r+this.left.height,a=s+this.left.length+this.break,l=e==gt.ByHeight?t<o:t<a,u=l?this.left.lineAt(t,e,n,r,s):this.right.lineAt(t,e,n,o,a);if(this.break||(l?u.to<a:u.from>a))return u;let c=e==gt.ByPosNoHeight?gt.ByPosNoHeight:gt.ByPos;return l?u.join(this.right.lineAt(a,c,n,o,a)):this.left.lineAt(a,c,n,r,s).join(u)}forEachLine(t,e,n,r,s,o){let a=r+this.left.height,l=s+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,n,r,s,o),e>=l&&this.right.forEachLine(t,e,n,a,l,o);else{let u=this.lineAt(l,gt.ByPos,n,r,s);t<u.from&&this.left.forEachLine(t,u.from-1,n,r,s,o),u.to>=t&&u.from<=e&&o(u),e>u.to&&this.right.forEachLine(u.to+1,e,n,a,l,o)}}replace(t,e,n){let r=this.left.length+this.break;if(e<r)return this.balanced(this.left.replace(t,e,n),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-r,e-r,n));let s=[];t>0&&this.decomposeLeft(t,s);let o=s.length;for(let a of n)s.push(a);if(t>0&&df(s,o-1),e<this.length){let a=s.length;this.decomposeRight(e,s),df(s,a)}return Ri.of(s)}decomposeLeft(t,e){let n=this.left.length;if(t<=n)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(n++,t>=n&&e.push(null)),t>n&&this.right.decomposeLeft(t-n,e)}decomposeRight(t,e){let n=this.left.length,r=n+this.break;if(t>=r)return this.right.decomposeRight(t-r,e);t<n&&this.left.decomposeRight(t,e),this.break&&t<r&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?Ri.of(this.break?[t,null,e]:[t,e]):(this.left=Ia(this.left,t),this.right=Ia(this.right,e),this.setHeight(t.height+e.height),this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,n=!1,r){let{left:s,right:o}=this,a=e+s.length+this.break,l=null;return r&&r.from<=e+s.length&&r.more?l=s=s.updateHeight(t,e,n,r):s.updateHeight(t,e,n),r&&r.from<=a+o.length&&r.more?l=o=o.updateHeight(t,a,n,r):o.updateHeight(t,a,n),l?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function df(i,t){let e,n;i[t]==null&&(e=i[t-1])instanceof hi&&(n=i[t+1])instanceof hi&&i.splice(t-1,3,new hi(e.length+1+n.length))}const UC=5;class Sh{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let n=Math.min(e,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof Gi?r.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new Gi(n-this.pos,-1)),this.writtenTo=n,e>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,n){if(t<e||n.heightRelevant){let r=n.widget?n.widget.estimatedHeight:0,s=n.widget?n.widget.lineBreaks:0;r<0&&(r=this.oracle.lineHeight);let o=e-t;n.block?this.addBlock(new c0(o,r,n)):(o||s||r>=UC)&&this.addLineDeco(r,s,o)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Gi(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let n=new hi(e-t);return this.oracle.doc.lineAt(t).to==e&&(n.flags|=4),n}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Gi)return t;let e=new Gi(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine();let e=t.deco;e&&e.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e&&e.endSide>0&&(this.covering=t)}addLineDeco(t,e,n){let r=this.ensureLine();r.length+=n,r.collapsed+=n,r.widgetHeight=Math.max(r.widgetHeight,t),r.breaks+=e,this.writtenTo=this.pos=this.pos+n}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Gi)&&!this.isCovered?this.nodes.push(new Gi(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=t;for(let r of this.nodes)r instanceof Gi&&r.updateHeight(this.oracle,n),n+=r?r.length:1;return this.nodes}static build(t,e,n,r){let s=new Sh(n,t);return Ge.spans(e,n,r,s,0),s.finish(n)}}function HC(i,t,e){let n=new KC;return Ge.compare(i,t,e,n,0),n.changes}class KC{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,n,r){(t<e||n&&n.heightRelevant||r&&r.heightRelevant)&&$a(t,e,this.changes,5)}}function JC(i,t){let e=i.getBoundingClientRect(),n=i.ownerDocument,r=n.defaultView||window,s=Math.max(0,e.left),o=Math.min(r.innerWidth,e.right),a=Math.max(0,e.top),l=Math.min(r.innerHeight,e.bottom);for(let u=i.parentNode;u&&u!=n.body;)if(u.nodeType==1){let c=u,h=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&h.overflow!="visible"){let d=c.getBoundingClientRect();s=Math.max(s,d.left),o=Math.min(o,d.right),a=Math.max(a,d.top),l=Math.min(u==i.parentNode?r.innerHeight:l,d.bottom)}u=h.position=="absolute"||h.position=="fixed"?c.offsetParent:c.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:s-e.left,right:Math.max(s,o)-e.left,top:a-(e.top+t),bottom:Math.max(a,l)-(e.top+t)}}function eD(i){let t=i.getBoundingClientRect(),e=i.ownerDocument.defaultView||window;return t.left<e.innerWidth&&t.right>0&&t.top<e.innerHeight&&t.bottom>0}function tD(i,t){let e=i.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class ec{constructor(t,e,n,r){this.from=t,this.to=e,this.size=n,this.displaySize=r}static same(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++){let r=t[n],s=e[n];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(t,e){return Se.replace({widget:new iD(this.displaySize*(e?t.scaleY:t.scaleX),e)}).range(this.from,this.to)}}class iD extends ar{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class ff{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=pf,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=mt.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(yh).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new qC(e),this.stateDeco=t.facet(ho).filter(n=>typeof n!="function"),this.heightMap=Ri.empty().applyChanges(this.stateDeco,Ue.empty,this.heightOracle.setDoc(t.doc),[new cn(0,0,0,t.doc.length)]);for(let n=0;n<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());n++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Se.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let n=0;n<=1;n++){let r=n?e.head:e.anchor;if(!t.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);t.push(new ta(s,o))}}return this.viewports=t.sort((n,r)=>n.from-r.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?pf:new vh(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(qs(t,this.scaler))})}update(t,e=null){this.state=t.state;let n=this.stateDeco;this.stateDeco=this.state.facet(ho).filter(c=>typeof c!="function");let r=t.changedRanges,s=cn.extendWithRanges(r,HC(n,this.stateDeco,t?t.changes:Vt.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);hf(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||Cs)&&(t.flags|=2),a?(this.scrollAnchorPos=t.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let l=s.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let u=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,t.flags|=this.updateForViewport(),(u||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(t.changes),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(Lm)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,n=window.getComputedStyle(e),r=this.heightOracle,s=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?mt.RTL:mt.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=e.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let u=0,c=0;if(a.width&&a.height){let{scaleX:S,scaleY:w}=Om(e,a);(S>.005&&Math.abs(this.scaleX-S)>.005||w>.005&&Math.abs(this.scaleY-w)>.005)&&(this.scaleX=S,this.scaleY=w,u|=16,o=l=!0)}let h=(parseInt(n.paddingTop)||0)*this.scaleY,d=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=d)&&(this.paddingTop=h,this.paddingBottom=d,u|=18),this.editorWidth!=t.scrollDOM.clientWidth&&(r.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,u|=16);let f=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=xm(t.scrollDOM);let p=(this.printing?tD:JC)(e,this.paddingTop),g=p.top-this.pixelViewport.top,m=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let O=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(O!=this.inView&&(this.inView=O,O&&(l=!0)),!this.inView&&!this.scrollTarget&&!eD(t.dom))return 0;let b=a.width;if((this.contentDOMWidth!=b||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=t.scrollDOM.clientHeight,u|=16),l){let S=t.docView.measureVisibleLineHeights(this.viewport);if(r.mustRefreshForHeights(S)&&(o=!0),o||r.lineWrapping&&Math.abs(b-this.contentDOMWidth)>r.charWidth){let{lineHeight:w,charWidth:v,textHeight:D}=t.docView.measureTextSize();o=w>0&&r.refresh(s,w,v,D,Math.max(5,b/v),S),o&&(t.docView.minWidth=0,u|=16)}g>0&&m>0?c=Math.max(g,m):g<0&&m<0&&(c=Math.min(g,m)),hf();for(let w of this.viewports){let v=w.from==this.viewport.from?S:t.docView.measureVisibleLineHeights(w);this.heightMap=(o?Ri.empty().applyChanges(this.stateDeco,Ue.empty,this.heightOracle,[new cn(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(r,0,o,new VC(w.from,v))}Cs&&(u|=2)}let x=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return x&&(u&2&&(u|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),u|=this.updateForViewport()),(u&2||x)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let n=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),r=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new ta(r.lineAt(o-n*1e3,gt.ByHeight,s,0,0).from,r.lineAt(a+(1-n)*1e3,gt.ByHeight,s,0,0).to);if(e){let{head:u}=e.range;if(u<l.from||u>l.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=r.lineAt(u,gt.ByPos,s,0,0),d;e.y=="center"?d=(h.top+h.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&u<l.from?d=h.top:d=h.bottom-c,l=new ta(r.lineAt(d-1e3/2,gt.ByHeight,s,0,0).from,r.lineAt(d+c+1e3/2,gt.ByHeight,s,0,0).to)}}return l}mapViewport(t,e){let n=e.mapPos(t.from,-1),r=e.mapPos(t.to,1);return new ta(this.heightMap.lineAt(n,gt.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(r,gt.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},n=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(t,gt.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(e,gt.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(t==0||r<=o-Math.max(10,Math.min(-n,250)))&&(e==this.state.doc.length||s>=a+Math.max(10,Math.min(n,250)))&&r>o-2*1e3&&s<a+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let n=[];for(let r of t)e.touchesRange(r.from,r.to)||n.push(new ec(e.mapPos(r.from),e.mapPos(r.to),r.size,r.displaySize));return n}ensureLineGaps(t,e){let n=this.heightOracle.lineWrapping,r=n?1e4:2e3,s=r>>1,o=r<<1;if(this.defaultTextDirection!=mt.LTR&&!n)return[];let a=[],l=(c,h,d,f)=>{if(h-c<s)return;let p=this.state.selection.main,g=[p.from];p.empty||g.push(p.to);for(let O of g)if(O>c&&O<h){l(c,O-10,d,f),l(O+10,h,d,f);return}let m=rD(t,O=>O.from>=d.from&&O.to<=d.to&&Math.abs(O.from-c)<s&&Math.abs(O.to-h)<s&&!g.some(b=>O.from<b&&O.to>b));if(!m){if(h<d.to&&e&&n&&e.visibleRanges.some(x=>x.from<=h&&x.to>=h)){let x=e.moveToLineBoundary(U.cursor(h),!1,!0).head;x>c&&(h=x)}let O=this.gapSize(d,c,h,f),b=n||O<2e6?O:2e6;m=new ec(c,h,O,b)}a.push(m)},u=c=>{if(c.length<o||c.type!=Ti.Text)return;let h=nD(c.from,c.to,this.stateDeco);if(h.total<o)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,f,p;if(n){let g=r/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,O;if(d!=null){let b=na(h,d),x=((this.visibleBottom-this.visibleTop)/2+g)/c.height;m=b-x,O=b+x}else m=(this.visibleTop-c.top-g)/c.height,O=(this.visibleBottom-c.top+g)/c.height;f=ia(h,m),p=ia(h,O)}else{let g=h.total*this.heightOracle.charWidth,m=r*this.heightOracle.charWidth,O=0;if(g>2e6)for(let v of t)v.from>=c.from&&v.from<c.to&&v.size!=v.displaySize&&v.from*this.heightOracle.charWidth+O<this.pixelViewport.left&&(O=v.size-v.displaySize);let b=this.pixelViewport.left+O,x=this.pixelViewport.right+O,S,w;if(d!=null){let v=na(h,d),D=((x-b)/2+m)/g;S=v-D,w=v+D}else S=(b-m)/g,w=(x+m)/g;f=ia(h,S),p=ia(h,w)}f>c.from&&l(c.from,f,c,h),p<c.to&&l(p,c.to,c,h)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(u):u(c);return a}gapSize(t,e,n,r){let s=na(r,n)-na(r,e);return this.heightOracle.lineWrapping?t.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(t){ec.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=Se.set(t.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(t){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let n=[];Ge.spans(e,this.viewport.from,this.viewport.to,{span(s,o){n.push({from:s,to:o})},point(){}},20);let r=0;if(n.length!=this.visibleRanges.length)r=12;else for(let s=0;s<n.length&&!(r&8);s++){let o=this.visibleRanges[s],a=n[s];(o.from!=a.from||o.to!=a.to)&&(r|=4,t&&t.mapPos(o.from,-1)==a.from&&t.mapPos(o.to,1)==a.to||(r|=8))}return this.visibleRanges=n,r}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||qs(this.heightMap.lineAt(t,gt.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(e=>e.top<=t&&e.bottom>=t)||qs(this.heightMap.lineAt(this.scaler.fromDOM(t),gt.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let e=this.lineBlockAtHeight(t+8);return e.from>=this.viewport.from||this.viewportLines[0].top-t>200?e:this.viewportLines[0]}elementAtHeight(t){return qs(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ta{constructor(t,e){this.from=t,this.to=e}}function nD(i,t,e){let n=[],r=i,s=0;return Ge.spans(e,i,t,{span(){},point(o,a){o>r&&(n.push({from:r,to:o}),s+=o-r),r=a}},20),r<t&&(n.push({from:r,to:t}),s+=t-r),{total:s,ranges:n}}function ia({total:i,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let n=Math.floor(i*e);for(let r=0;;r++){let{from:s,to:o}=t[r],a=o-s;if(n<=a)return s+n;n-=a}}function na(i,t){let e=0;for(let{from:n,to:r}of i.ranges){if(t<=r){e+=t-n;break}e+=r-n}return e/i.total}function rD(i,t){for(let e of i)if(t(e))return e}const pf={toDOM(i){return i},fromDOM(i){return i},scale:1,eq(i){return i==this}};class vh{constructor(t,e,n){let r=0,s=0,o=0;this.viewports=n.map(({from:a,to:l})=>{let u=e.lineAt(a,gt.ByPos,t,0,0).top,c=e.lineAt(l,gt.ByPos,t,0,0).bottom;return r+=c-u,{from:a,to:l,top:u,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(e.height-r);for(let a of this.viewports)a.domTop=o+(a.top-s)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),s=a.bottom}toDOM(t){for(let e=0,n=0,r=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.top)return r+(t-n)*this.scale;if(t<=s.bottom)return s.domTop+(t-s.top);n=s.bottom,r=s.domBottom}}fromDOM(t){for(let e=0,n=0,r=0;;e++){let s=e<this.viewports.length?this.viewports[e]:null;if(!s||t<s.domTop)return n+(t-r)/this.scale;if(t<=s.domBottom)return s.top+(t-s.domTop);n=s.bottom,r=s.domBottom}}eq(t){return t instanceof vh?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,n)=>e.from==t.viewports[n].from&&e.to==t.viewports[n].to):!1}}function qs(i,t){if(t.scale==1)return i;let e=t.toDOM(i.top),n=t.toDOM(i.bottom);return new Rn(i.from,i.length,e,n-e,Array.isArray(i._content)?i._content.map(r=>qs(r,t)):i._content)}const ra=pe.define({combine:i=>i.join(" ")}),bu=pe.define({combine:i=>i.indexOf(!0)>-1}),yu=$r.newName(),u0=$r.newName(),h0=$r.newName(),d0={"&light":"."+u0,"&dark":"."+h0};function xu(i,t,e){return new $r(t,{finish(n){return/&/.test(n)?n.replace(/&\w*/,r=>{if(r=="&")return i;if(!e||!e[r])throw new RangeError(`Unsupported selector: ${r}`);return e[r]}):i+" "+n}})}const sD=xu("."+yu,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},d0),oD={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},tc=le.ie&&le.ie_version<=11;class aD{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new Xk,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(e=>{for(let n of e)this.queue.push(n);(le.ie&&le.ie_version<=11||le.ios&&t.composing)&&e.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&le.android&&t.constructor.EDIT_CONTEXT!==!1&&!(le.chrome&&le.chrome_version<126)&&(this.editContext=new cD(t),t.state.facet(Yn)&&(t.contentDOM.editContext=this.editContext.editContext)),tc&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var e;((e=this.view.docView)===null||e===void 0?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){(t.type=="change"||!t.type)&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,n)=>e!=t[n]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,r=this.selectionRange;if(n.state.facet(Yn)?n.root.activeElement!=this.dom:!Da(this.dom,r))return;let s=r.anchorNode&&n.docView.nearest(r.anchorNode);if(s&&s.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(le.ie&&le.ie_version<=11||le.android&&le.chrome)&&!n.state.selection.main.empty&&r.focusNode&&Js(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=uo(t.root);if(!e)return!1;let n=le.safari&&t.root.nodeType==11&&t.root.activeElement==this.dom&&lD(this.view,e)||e;if(!n||this.selectionRange.eq(n))return!1;let r=Da(this.dom,n);return r&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&Wk(this.dom,n)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(n),r&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let n=this.dom;n;)if(n.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==n?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=e)n.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,oD),tc&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),tc&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var n;if(!this.delayedAndroidKey){let r=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&fs(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(r)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let e=-1,n=-1,r=!1;for(let s of t){let o=this.readMutation(s);o&&(o.typeOver&&(r=!0),e==-1?{from:e,to:n}=o:(e=Math.min(o.from,e),n=Math.max(o.to,n)))}return{from:e,to:n,typeOver:r}}readChange(){let{from:t,to:e,typeOver:n}=this.processRecords(),r=this.selectionChanged&&Da(this.dom,this.selectionRange);if(t<0&&!r)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new DC(this.view,t,e,n);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return this.view.requestMeasure(),!1;let n=this.view.state,r=Jm(this.view,e);return this.view.state==n&&(e.domChanged||e.newSel&&!e.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),r}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.flags|=4),t.type=="childList"){let n=gf(e,t.previousSibling||t.target.previousSibling,-1),r=gf(e,t.nextSibling||t.target.nextSibling,1);return{from:n?e.posAfter(n):e.posAtStart,to:r?e.posBefore(r):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(Yn)!=t.state.facet(Yn)&&(t.view.contentDOM.editContext=t.state.facet(Yn)?this.editContext.editContext:null))}destroy(){var t,e,n;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function gf(i,t,e){for(;t;){let n=lt.get(t);if(n&&n.parent==i)return n;let r=t.parentNode;t=r!=i.dom?r:e>0?t.nextSibling:t.previousSibling}return null}function mf(i,t){let e=t.startContainer,n=t.startOffset,r=t.endContainer,s=t.endOffset,o=i.docView.domAtPos(i.state.selection.main.anchor);return Js(o.node,o.offset,r,s)&&([e,n,r,s]=[r,s,e,n]),{anchorNode:e,anchorOffset:n,focusNode:r,focusOffset:s}}function lD(i,t){if(t.getComposedRanges){let r=t.getComposedRanges(i.root)[0];if(r)return mf(i,r)}let e=null;function n(r){r.preventDefault(),r.stopImmediatePropagation(),e=r.getTargetRanges()[0]}return i.contentDOM.addEventListener("beforeinput",n,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",n,!0),e?mf(i,e):null}class cD{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(t.state);let e=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=n=>{let r=t.state.selection.main,{anchor:s,head:o}=r,a=this.toEditorPos(n.updateRangeStart),l=this.toEditorPos(n.updateRangeEnd);t.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:n.updateRangeStart,editorBase:a,drifted:!1});let u=l-a>n.text.length;a==this.from&&s<this.from?a=s:l==this.to&&s>this.to&&(l=s);let c=e0(t.state.sliceDoc(a,l),n.text,(u?r.from:r.to)-a,u?"end":null);if(!c){let d=U.single(this.toEditorPos(n.selectionStart),this.toEditorPos(n.selectionEnd));d.main.eq(r)||t.dispatch({selection:d,userEvent:"select"});return}let h={from:c.from+a,to:c.toA+a,insert:Ue.of(n.text.slice(c.from,c.toB).split(`
`))};if((le.mac||le.android)&&h.from==o-1&&/^\. ?$/.test(n.text)&&t.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:a,to:l,insert:Ue.of([n.text.replace("."," ")])}),this.pendingContextChange=h,!t.state.readOnly){let d=this.to-this.from+(h.to-h.from+h.insert.length);wh(t,h,U.single(this.toEditorPos(n.selectionStart,d),this.toEditorPos(n.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state)),h.from<h.to&&!h.insert.length&&t.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(e.text.slice(Math.max(0,n.updateRangeStart-1),Math.min(e.text.length,n.updateRangeStart+1)))&&this.handlers.compositionend(n)},this.handlers.characterboundsupdate=n=>{let r=[],s=null;for(let o=this.toEditorPos(n.rangeStart),a=this.toEditorPos(n.rangeEnd);o<a;o++){let l=t.coordsForChar(o);s=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||s||new DOMRect,r.push(s)}e.updateCharacterBounds(n.rangeStart,r)},this.handlers.textformatupdate=n=>{let r=[];for(let s of n.getTextFormats()){let o=s.underlineStyle,a=s.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(a)){let l=this.toEditorPos(s.rangeStart),u=this.toEditorPos(s.rangeEnd);if(l<u){let c=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(a)?1:2}px`;r.push(Se.mark({attributes:{style:c}}).range(l,u))}}}t.dispatch({effects:Nm.of(Se.set(r))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(t.inputState.composing=-1,t.inputState.compositionFirstChange=null,this.composing){let{drifted:n}=this.composing;this.composing=null,n&&this.reset(t.state)}};for(let n in this.handlers)e.addEventListener(n,this.handlers[n]);this.measureReq={read:n=>{this.editContext.updateControlBounds(n.contentDOM.getBoundingClientRect());let r=uo(n.root);r&&r.rangeCount&&this.editContext.updateSelectionBounds(r.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let e=0,n=!1,r=this.pendingContextChange;return t.changes.iterChanges((s,o,a,l,u)=>{if(n)return;let c=u.length-(o-s);if(r&&o>=r.to)if(r.from==s&&r.to==o&&r.insert.eq(u)){r=this.pendingContextChange=null,e+=c,this.to+=c;return}else r=null,this.revertPending(t.state);if(s+=e,o+=e,o<=this.from)this.from+=c,this.to+=c;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+u.length>3e4){n=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),u.toString()),this.to+=c}e+=c}),r&&!n&&this.revertPending(t.state),!n}update(t){let e=this.pendingContextChange,n=t.startState.selection.main;this.composing&&(this.composing.drifted||!t.changes.touchesRange(n.from,n.to)&&t.transactions.some(r=>!r.isUserEvent("input.type")&&r.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=t.changes.mapPos(this.composing.editorBase)):!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.reset(t.state)):(t.docChanged||t.selectionSet||e)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:e}=t.selection.main;this.from=Math.max(0,e-1e4),this.to=Math.min(t.doc.length,e+1e4)}reset(t){this.resetRange(t),this.editContext.updateText(0,this.editContext.text.length,t.doc.sliceString(this.from,this.to)),this.setSelection(t)}revertPending(t){let e=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(e.from),this.toContextPos(e.from+e.insert.length),t.doc.sliceString(e.from,e.to))}setSelection(t){let{main:e}=t.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,e.anchor))),r=this.toContextPos(e.head);(this.editContext.selectionStart!=n||this.editContext.selectionEnd!=r)&&this.editContext.updateSelection(n,r)}rangeIsValid(t){let{head:e}=t.selection.main;return!(this.from>0&&e-this.from<500||this.to<t.doc.length&&this.to-e<500||this.to-this.from>1e4*3)}toEditorPos(t,e=this.to-this.from){t=Math.min(t,e);let n=this.composing;return n&&n.drifted?n.editorBase+(t-n.contextBase):t+this.from}toContextPos(t){let e=this.composing;return e&&e.drifted?e.contextBase+(t-e.editorBase):t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class ae{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){var e;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:n}=t;this.dispatchTransactions=t.dispatchTransactions||n&&(r=>r.forEach(s=>n(s,this)))||(r=>this.update(r)),this.dispatch=this.dispatch.bind(this),this._root=t.root||Nk(t.parent)||document,this.viewState=new ff(t.state||qe.create(t)),t.scrollTo&&t.scrollTo.is(Ko)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ls).map(r=>new Hl(r));for(let r of this.plugins)r.update(this);this.observer=new aD(this),this.inputState=new AC(this),this.inputState.ensureHandlers(this.plugins),this.docView=new qd(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((e=document.fonts)===null||e===void 0)&&e.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...t){let e=t.length==1&&t[0]instanceof Gt?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(e,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,n=!1,r,s=this.state;for(let d of t){if(d.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=d.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,a=0,l=null;t.some(d=>d.annotation(o0))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=a0(s,o),l||(a=1));let u=this.observer.delayedAndroidKey,c=null;if(u?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(c=null)):this.observer.clear(),s.facet(qe.phrases)!=this.state.facet(qe.phrases))return this.setState(s);r=ja.create(this,s,t),r.flags|=a;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let d of t){if(h&&(h=h.map(d.changes)),d.scrollIntoView){let{main:f}=d.state.selection;h=new ps(f.empty?f:U.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of d.effects)f.is(Ko)&&(h=f.value.clip(this.state))}this.viewState.update(r,h),this.bidiCache=La.update(this.bidiCache,r.changes),r.empty||(this.updatePlugins(r),this.inputState.update(r)),e=this.docView.update(r),this.state.facet(Ws)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(r.startState.facet(ra)!=r.state.facet(ra)&&(this.viewState.mustMeasureContent=!0),(e||n||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!r.empty)for(let d of this.state.facet(pu))try{d(r)}catch(f){zi(this.state,f,"update listener")}(l||c)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),c&&!Jm(this,c)&&u.force&&fs(this.contentDOM,u.key,u.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new ff(t),this.plugins=t.facet(ls).map(n=>new Hl(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new qd(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(ls),n=t.state.facet(ls);if(e!=n){let r=[];for(let s of n){let o=e.indexOf(s);if(o<0)r.push(new Hl(s));else{let a=this.plugins[o];a.mustUpdate=t,r.push(a)}}for(let s of this.plugins)s.mustUpdate!=t&&s.destroy(this);this.plugins=r,this.pluginMap.clear()}else for(let r of this.plugins)r.mustUpdate=t;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this);e!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let e=t.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(n){zi(this.state,n,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,n=this.scrollDOM,r=n.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(r-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(xm(n))s=-1,o=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(r);s=f.from,o=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];l&4||([this.measureRequests,u]=[u,this.measureRequests]);let c=u.map(f=>{try{return f.read(this)}catch(p){return zi(this.state,p),Of}}),h=ja.create(this,this.state,[]),d=!1;h.flags|=l,e?e.flags|=l:e=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),d=this.docView.update(h),d&&this.docViewUpdate());for(let f=0;f<u.length;f++)if(c[f]!=Of)try{let p=u[f];p.write&&p.write(c[f],this)}catch(p){zi(this.state,p)}if(d&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let p=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(p>1||p<-1){r=r+p,n.scrollTop=r/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let a of this.state.facet(pu))a(e)}get themeClasses(){return yu+" "+(this.state.facet(bu)?h0:u0)+" "+this.state.facet(ra)}updateAttrs(){let t=bf(this,Wm,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(Yn)?"true":"false",class:"cm-content",style:`${le.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),bf(this,yh,e);let n=this.observer.ignore(()=>{let r=cu(this.contentDOM,this.contentAttrs,e),s=cu(this.dom,this.editorAttrs,t);return r||s});return this.editorAttrs=t,this.contentAttrs=e,n}showAnnouncements(t){let e=!0;for(let n of t)for(let r of n.effects)if(r.is(ae.announce)){e&&(this.announceDOM.textContent=""),e=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(Ws);let t=this.state.facet(ae.cspNonce);$r.mount(this.root,this.styleModules.concat(sD).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.plugin!=t)&&this.pluginMap.set(t,e=this.plugins.find(n=>n.plugin==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,n){return Jl(this,t,Kd(this,t,e,n))}moveByGroup(t,e){return Jl(this,t,Kd(this,t,e,n=>wC(this,t.head,n)))}visualLineSide(t,e){let n=this.bidiSpans(t),r=this.textDirectionAt(t.from),s=n[e?n.length-1:0];return U.cursor(s.side(e,r)+t.from,s.forward(!e,r)?1:-1)}moveToLineBoundary(t,e,n=!0){return xC(this,t,e,n)}moveVertically(t,e,n){return Jl(this,t,SC(this,t,e,n))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),Um(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let n=this.docView.coordsAt(t,e);if(!n||n.left==n.right)return n;let r=this.state.doc.lineAt(t),s=this.bidiSpans(r),o=s[Sr.find(s,t-r.from,-1,e)];return Ro(n,o.dir==mt.LTR==e>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(Im)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>uD)return Rm(t.length);let e=this.textDirectionAt(t.from),n;for(let s of this.bidiCache)if(s.from==t.from&&s.dir==e&&(s.fresh||Tm(s.isolates,n=Yd(this,t))))return s.order;n||(n=Yd(this,t));let r=rC(t.text,e,n);return this.bidiCache.push(new La(t.from,t.to,e,n,!0,r)),r}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||le.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{bm(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return Ko.of(new ps(typeof t=="number"?U.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:e}=this.scrollDOM,n=this.viewState.scrollAnchorAt(t);return Ko.of(new ps(U.cursor(n.from),"start","start",n.top-t,e,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return Qt.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return Qt.define(()=>({}),{eventObservers:t})}static theme(t,e){let n=$r.newName(),r=[ra.of(n),Ws.of(xu(`.${n}`,t))];return e&&e.dark&&r.push(bu.of(!0)),r}static baseTheme(t){return Jr.lowest(Ws.of(xu("."+yu,t,d0)))}static findFromDOM(t){var e;let n=t.querySelector(".cm-content"),r=n&&lt.get(n)||lt.get(t);return((e=r?.rootView)===null||e===void 0?void 0:e.view)||null}}ae.styleModule=Ws;ae.inputHandler=zm;ae.clipboardInputFilter=Oh;ae.clipboardOutputFilter=bh;ae.scrollHandler=Xm;ae.focusChangeEffect=jm;ae.perLineTextDirection=Im;ae.exceptionSink=Zm;ae.updateListener=pu;ae.editable=Yn;ae.mouseSelectionStyle=Fm;ae.dragMovesSelection=Bm;ae.clickAddsSelectionRange=Mm;ae.decorations=ho;ae.outerDecorations=Ym;ae.atomicRanges=Bo;ae.bidiIsolatedRanges=qm;ae.scrollMargins=Vm;ae.darkTheme=bu;ae.cspNonce=pe.define({combine:i=>i.length?i[0]:""});ae.contentAttributes=yh;ae.editorAttributes=Wm;ae.lineWrapping=ae.contentAttributes.of({class:"cm-lineWrapping"});ae.announce=Ze.define();const uD=4096,Of={};class La{constructor(t,e,n,r,s,o){this.from=t,this.to=e,this.dir=n,this.isolates=r,this.fresh=s,this.order=o}static update(t,e){if(e.empty&&!t.some(s=>s.fresh))return t;let n=[],r=t.length?t[t.length-1].dir:mt.LTR;for(let s=Math.max(0,t.length-10);s<t.length;s++){let o=t[s];o.dir==r&&!e.touchesRange(o.from,o.to)&&n.push(new La(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return n}}function bf(i,t,e){for(let n=i.state.facet(t),r=n.length-1;r>=0;r--){let s=n[r],o=typeof s=="function"?s(i):s;o&&lu(o,e)}return e}const hD=le.mac?"mac":le.windows?"win":le.linux?"linux":"key";function dD(i,t){const e=i.split(/-(?!$)/);let n=e[e.length-1];n=="Space"&&(n=" ");let r,s,o,a;for(let l=0;l<e.length-1;++l){const u=e[l];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))r=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))t=="mac"?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+u)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),a&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function sa(i,t,e){return t.altKey&&(i="Alt-"+i),t.ctrlKey&&(i="Ctrl-"+i),t.metaKey&&(i="Meta-"+i),e!==!1&&t.shiftKey&&(i="Shift-"+i),i}const fD=Jr.default(ae.domEventHandlers({keydown(i,t){return p0(f0(t.state),i,t,"editor")}})),Fo=pe.define({enables:fD}),yf=new WeakMap;function f0(i){let t=i.facet(Fo),e=yf.get(t);return e||yf.set(t,e=mD(t.reduce((n,r)=>n.concat(r),[]))),e}function pD(i,t,e){return p0(f0(i.state),t,i,e)}let yr=null;const gD=4e3;function mD(i,t=hD){let e=Object.create(null),n=Object.create(null),r=(o,a)=>{let l=n[o];if(l==null)n[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,a,l,u,c)=>{var h,d;let f=e[o]||(e[o]=Object.create(null)),p=a.split(/ (?!$)/).map(O=>dD(O,t));for(let O=1;O<p.length;O++){let b=p.slice(0,O).join(" ");r(b,!0),f[b]||(f[b]={preventDefault:!0,stopPropagation:!1,run:[x=>{let S=yr={view:x,prefix:b,scope:o};return setTimeout(()=>{yr==S&&(yr=null)},gD),!0}]})}let g=p.join(" ");r(g,!1);let m=f[g]||(f[g]={preventDefault:!1,stopPropagation:!1,run:((d=(h=f._any)===null||h===void 0?void 0:h.run)===null||d===void 0?void 0:d.slice())||[]});l&&m.run.push(l),u&&(m.preventDefault=!0),c&&(m.stopPropagation=!0)};for(let o of i){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let u of a){let c=e[u]||(e[u]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=o;for(let d in c)c[d].run.push(f=>h(f,wu))}let l=o[t]||o.key;if(l)for(let u of a)s(u,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(u,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return e}let wu=null;function p0(i,t,e,n){wu=t;let r=Zk(t),s=Fi(r,0),o=Tn(s)==r.length&&r!=" ",a="",l=!1,u=!1,c=!1;yr&&yr.view==e&&yr.scope==n&&(a=yr.prefix+" ",i0.indexOf(t.keyCode)<0&&(u=!0,yr=null));let h=new Set,d=m=>{if(m){for(let O of m.run)if(!h.has(O)&&(h.add(O),O(e)))return m.stopPropagation&&(c=!0),!0;m.preventDefault&&(m.stopPropagation&&(c=!0),u=!0)}return!1},f=i[n],p,g;return f&&(d(f[a+sa(r,t,!o)])?l=!0:o&&(t.altKey||t.metaKey||t.ctrlKey)&&!(le.windows&&t.ctrlKey&&t.altKey)&&!(le.mac&&t.altKey&&!(t.ctrlKey||t.metaKey))&&(p=Qr[t.keyCode])&&p!=r?(d(f[a+sa(p,t,!0)])||t.shiftKey&&(g=co[t.keyCode])!=r&&g!=p&&d(f[a+sa(g,t,!1)]))&&(l=!0):o&&t.shiftKey&&d(f[a+sa(r,t,!0)])&&(l=!0),!l&&d(f._any)&&(l=!0)),u&&(l=!0),l&&c&&t.stopPropagation(),wu=null,l}class Zo{constructor(t,e,n,r,s){this.className=t,this.left=e,this.top=n,this.width=r,this.height=s}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,e){return e.className!=this.className?!1:(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width!=null&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}static forRange(t,e,n){if(n.empty){let r=t.coordsAtPos(n.head,n.assoc||1);if(!r)return[];let s=g0(t);return[new Zo(e,r.left-s.left,r.top-s.top,null,r.bottom-r.top)]}else return OD(t,e,n)}}function g0(i){let t=i.scrollDOM.getBoundingClientRect();return{left:(i.textDirection==mt.LTR?t.left:t.right-i.scrollDOM.clientWidth*i.scaleX)-i.scrollDOM.scrollLeft*i.scaleX,top:t.top-i.scrollDOM.scrollTop*i.scaleY}}function xf(i,t,e,n){let r=i.coordsAtPos(t,e*2);if(!r)return n;let s=i.dom.getBoundingClientRect(),o=(r.top+r.bottom)/2,a=i.posAtCoords({x:s.left+1,y:o}),l=i.posAtCoords({x:s.right-1,y:o});return a==null||l==null?n:{from:Math.max(n.from,Math.min(a,l)),to:Math.min(n.to,Math.max(a,l))}}function OD(i,t,e){if(e.to<=i.viewport.from||e.from>=i.viewport.to)return[];let n=Math.max(e.from,i.viewport.from),r=Math.min(e.to,i.viewport.to),s=i.textDirection==mt.LTR,o=i.contentDOM,a=o.getBoundingClientRect(),l=g0(i),u=o.querySelector(".cm-line"),c=u&&window.getComputedStyle(u),h=a.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=a.right-(c?parseInt(c.paddingRight):0),f=mu(i,n,1),p=mu(i,r,-1),g=f.type==Ti.Text?f:null,m=p.type==Ti.Text?p:null;if(g&&(i.lineWrapping||f.widgetLineBreaks)&&(g=xf(i,n,1,g)),m&&(i.lineWrapping||p.widgetLineBreaks)&&(m=xf(i,r,-1,m)),g&&m&&g.from==m.from&&g.to==m.to)return b(x(e.from,e.to,g));{let w=g?x(e.from,null,g):S(f,!1),v=m?x(null,e.to,m):S(p,!0),D=[];return(g||f).to<(m||p).from-(g&&m?1:0)||f.widgetLineBreaks>1&&w.bottom+i.defaultLineHeight/2<v.top?D.push(O(h,w.bottom,d,v.top)):w.bottom<v.top&&i.elementAtHeight((w.bottom+v.top)/2).type==Ti.Text&&(w.bottom=v.top=(w.bottom+v.top)/2),b(w).concat(D).concat(b(v))}function O(w,v,D,R){return new Zo(t,w-l.left,v-l.top,D-w,R-v)}function b({top:w,bottom:v,horizontal:D}){let R=[];for(let $=0;$<D.length;$+=2)R.push(O(D[$],w,D[$+1],v));return R}function x(w,v,D){let R=1e9,$=-1e9,k=[];function A(M,B,W,X,F){let _=i.coordsAtPos(M,M==D.to?-2:2),j=i.coordsAtPos(W,W==D.from?2:-2);!_||!j||(R=Math.min(_.top,j.top,R),$=Math.max(_.bottom,j.bottom,$),F==mt.LTR?k.push(s&&B?h:_.left,s&&X?d:j.right):k.push(!s&&X?h:j.left,!s&&B?d:_.right))}let P=w??D.from,Q=v??D.to;for(let M of i.visibleRanges)if(M.to>P&&M.from<Q)for(let B=Math.max(M.from,P),W=Math.min(M.to,Q);;){let X=i.state.doc.lineAt(B);for(let F of i.bidiSpans(X)){let _=F.from+X.from,j=F.to+X.from;if(_>=W)break;j>B&&A(Math.max(_,B),w==null&&_<=P,Math.min(j,W),v==null&&j>=Q,F.dir)}if(B=X.to+1,B>=W)break}return k.length==0&&A(P,w==null,Q,v==null,i.textDirection),{top:R,bottom:$,horizontal:k}}function S(w,v){let D=a.top+(v?w.top:w.bottom);return{top:D,bottom:D,horizontal:[]}}}function bD(i,t){return i.constructor==t.constructor&&i.eq(t)}class yD{constructor(t,e){this.view=t,this.layer=e,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),e.above&&this.dom.classList.add("cm-layer-above"),e.class&&this.dom.classList.add(e.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),e.mount&&e.mount(this.dom,t)}update(t){t.startState.facet(Pa)!=t.state.facet(Pa)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&(this.scale(),t.view.requestMeasure(this.measureReq))}docViewUpdate(t){this.layer.updateOnDocViewUpdate!==!1&&t.requestMeasure(this.measureReq)}setOrder(t){let e=0,n=t.facet(Pa);for(;e<n.length&&n[e]!=this.layer;)e++;this.dom.style.zIndex=String((this.layer.above?150:-1)-e)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:t,scaleY:e}=this.view;(t!=this.scaleX||e!=this.scaleY)&&(this.scaleX=t,this.scaleY=e,this.dom.style.transform=`scale(${1/t}, ${1/e})`)}draw(t){if(t.length!=this.drawn.length||t.some((e,n)=>!bD(e,this.drawn[n]))){let e=this.dom.firstChild,n=0;for(let r of t)r.update&&e&&r.constructor&&this.drawn[n].constructor&&r.update(e,this.drawn[n])?(e=e.nextSibling,n++):this.dom.insertBefore(r.draw(),e);for(;e;){let r=e.nextSibling;e.remove(),e=r}this.drawn=t,le.safari&&le.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Pa=pe.define();function m0(i){return[Qt.define(t=>new yD(t,i)),Pa.of(i)]}const fo=pe.define({combine(i){return zn(i,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,e)=>Math.min(t,e),drawRangeCursor:(t,e)=>t||e})}});function O0(i={}){return[fo.of(i),xD,wD,SD,Lm.of(!0)]}function b0(i){return i.startState.facet(fo)!=i.state.facet(fo)}const xD=m0({above:!0,markers(i){let{state:t}=i,e=t.facet(fo),n=[];for(let r of t.selection.ranges){let s=r==t.selection.main;if(r.empty||e.drawRangeCursor){let o=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=r.empty?r:U.cursor(r.head,r.head>r.anchor?-1:1);for(let l of Zo.forRange(i,o,a))n.push(l)}}return n},update(i,t){i.transactions.some(n=>n.selection)&&(t.style.animationName=t.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let e=b0(i);return e&&wf(i.state,t),i.docChanged||i.selectionSet||e},mount(i,t){wf(t.state,i)},class:"cm-cursorLayer"});function wf(i,t){t.style.animationDuration=i.facet(fo).cursorBlinkRate+"ms"}const wD=m0({above:!1,markers(i){return i.state.selection.ranges.map(t=>t.empty?[]:Zo.forRange(i,"cm-selectionBackground",t)).reduce((t,e)=>t.concat(e))},update(i,t){return i.docChanged||i.selectionSet||i.viewportChanged||b0(i)},class:"cm-selectionLayer"}),SD=Jr.highest(ae.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),y0=Ze.define({map(i,t){return i==null?null:t.mapPos(i)}}),Vs=pi.define({create(){return null},update(i,t){return i!=null&&(i=t.changes.mapPos(i)),t.effects.reduce((e,n)=>n.is(y0)?n.value:e,i)}}),vD=Qt.fromClass(class{constructor(i){this.view=i,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(i){var t;let e=i.state.field(Vs);e==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(i.startState.field(Vs)!=e||i.docChanged||i.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:i}=this,t=i.state.field(Vs),e=t!=null&&i.coordsAtPos(t);if(!e)return null;let n=i.scrollDOM.getBoundingClientRect();return{left:e.left-n.left+i.scrollDOM.scrollLeft*i.scaleX,top:e.top-n.top+i.scrollDOM.scrollTop*i.scaleY,height:e.bottom-e.top}}drawCursor(i){if(this.cursor){let{scaleX:t,scaleY:e}=this.view;i?(this.cursor.style.left=i.left/t+"px",this.cursor.style.top=i.top/e+"px",this.cursor.style.height=i.height/e+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(i){this.view.state.field(Vs)!=i&&this.view.dispatch({effects:y0.of(i)})}},{eventObservers:{dragover(i){this.setDropPos(this.view.posAtCoords({x:i.clientX,y:i.clientY}))},dragleave(i){(i.target==this.view.contentDOM||!this.view.contentDOM.contains(i.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function kD(){return[Vs,vD]}function Sf(i,t,e,n,r){t.lastIndex=0;for(let s=i.iterRange(e,n),o=e,a;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;a=t.exec(s.value);)r(o+a.index,a)}function CD(i,t){let e=i.visibleRanges;if(e.length==1&&e[0].from==i.viewport.from&&e[0].to==i.viewport.to)return e;let n=[];for(let{from:r,to:s}of e)r=Math.max(i.state.doc.lineAt(r).from,r-t),s=Math.min(i.state.doc.lineAt(s).to,s+t),n.length&&n[n.length-1].to>=r?n[n.length-1].to=s:n.push({from:r,to:s});return n}class DD{constructor(t){const{regexp:e,decoration:n,decorate:r,boundary:s,maxLength:o=1e3}=t;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=e,r)this.addMatch=(a,l,u,c)=>r(c,u,u+a[0].length,a,l);else if(typeof n=="function")this.addMatch=(a,l,u,c)=>{let h=n(a,l,u);h&&c(u,u+a[0].length,h)};else if(n)this.addMatch=(a,l,u,c)=>c(u,u+a[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=s,this.maxLength=o}createDeco(t){let e=new Kn,n=e.add.bind(e);for(let{from:r,to:s}of CD(t,this.maxLength))Sf(t.state.doc,this.regexp,r,s,(o,a)=>this.addMatch(a,t,o,n));return e.finish()}updateDeco(t,e){let n=1e9,r=-1;return t.docChanged&&t.changes.iterChanges((s,o,a,l)=>{l>=t.view.viewport.from&&a<=t.view.viewport.to&&(n=Math.min(a,n),r=Math.max(l,r))}),t.viewportMoved||r-n>1e3?this.createDeco(t.view):r>-1?this.updateRange(t.view,e.map(t.changes),n,r):e}updateRange(t,e,n,r){for(let s of t.visibleRanges){let o=Math.max(s.from,n),a=Math.min(s.to,r);if(a>=o){let l=t.state.doc.lineAt(o),u=l.to<a?t.state.doc.lineAt(a):l,c=Math.max(s.from,l.from),h=Math.min(s.to,u.to);if(this.boundary){for(;o>l.from;o--)if(this.boundary.test(l.text[o-1-l.from])){c=o;break}for(;a<u.to;a++)if(this.boundary.test(u.text[a-u.from])){h=a;break}}let d=[],f,p=(g,m,O)=>d.push(O.range(g,m));if(l==u)for(this.regexp.lastIndex=c-l.from;(f=this.regexp.exec(l.text))&&f.index<h-l.from;)this.addMatch(f,t,f.index+l.from,p);else Sf(t.state.doc,this.regexp,c,h,(g,m)=>this.addMatch(m,t,g,p));e=e.update({filterFrom:c,filterTo:h,filter:(g,m)=>g<c||m>h,add:d})}}return e}}const Su=/x/.unicode!=null?"gu":"g",$D=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,Su),QD={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let ic=null;function PD(){var i;if(ic==null&&typeof document<"u"&&document.body){let t=document.body.style;ic=((i=t.tabSize)!==null&&i!==void 0?i:t.MozTabSize)!=null}return ic||!1}const Aa=pe.define({combine(i){let t=zn(i,{render:null,specialChars:$D,addSpecialChars:null});return(t.replaceTabs=!PD())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,Su)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Su)),t}});function x0(i={}){return[Aa.of(i),AD()]}let vf=null;function AD(){return vf||(vf=Qt.fromClass(class{constructor(i){this.view=i,this.decorations=Se.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(i.state.facet(Aa)),this.decorations=this.decorator.createDeco(i)}makeDecorator(i){return new DD({regexp:i.specialChars,decoration:(t,e,n)=>{let{doc:r}=e.state,s=Fi(t[0],0);if(s==9){let o=r.lineAt(n),a=e.state.tabSize,l=Es(o.text,a,n-o.from);return Se.replace({widget:new _D((a-l%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[s]||(this.decorationCache[s]=Se.replace({widget:new RD(i,s)}))},boundary:i.replaceTabs?void 0:/[^]/})}update(i){let t=i.state.facet(Aa);i.startState.facet(Aa)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(i.view)):this.decorations=this.decorator.updateDeco(i,this.decorations)}},{decorations:i=>i.decorations}))}const ED="•";function TD(i){return i>=32?ED:i==10?"␤":String.fromCharCode(9216+i)}class RD extends ar{constructor(t,e){super(),this.options=t,this.code=e}eq(t){return t.code==this.code}toDOM(t){let e=TD(this.code),n=t.state.phrase("Control character")+" "+(QD[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,n,e);if(r)return r;let s=document.createElement("span");return s.textContent=e,s.title=n,s.setAttribute("aria-label",n),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class _D extends ar{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function w0(){return BD}const MD=Se.line({class:"cm-activeLine"}),BD=Qt.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.docChanged||i.selectionSet)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let t=-1,e=[];for(let n of i.state.selection.ranges){let r=i.lineBlockAt(n.head);r.from>t&&(e.push(MD.range(r.from)),t=r.from)}return Se.set(e)}},{decorations:i=>i.decorations});class FD extends ar{constructor(t){super(),this.content=t}toDOM(t){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(t):this.content.cloneNode(!0)),e.setAttribute("aria-hidden","true"),e}coordsAt(t){let e=t.firstChild?Ss(t.firstChild):[];if(!e.length)return null;let n=window.getComputedStyle(t.parentNode),r=Ro(e[0],n.direction!="rtl"),s=parseInt(n.lineHeight);return r.bottom-r.top>s*1.5?{left:r.left,right:r.right,top:r.top,bottom:r.top+s}:r}ignoreEvent(){return!1}}function ZD(i){let t=Qt.fromClass(class{constructor(e){this.view=e,this.placeholder=i?Se.set([Se.widget({widget:new FD(i),side:1}).range(0)]):Se.none}get decorations(){return this.view.state.doc.length?Se.none:this.placeholder}},{decorations:e=>e.decorations});return typeof i=="string"?[t,ae.contentAttributes.of({"aria-placeholder":i})]:t}const vu=2e3;function zD(i,t,e){let n=Math.min(t.line,e.line),r=Math.max(t.line,e.line),s=[];if(t.off>vu||e.off>vu||t.col<0||e.col<0){let o=Math.min(t.off,e.off),a=Math.max(t.off,e.off);for(let l=n;l<=r;l++){let u=i.doc.line(l);u.length<=a&&s.push(U.range(u.from+o,u.to+a))}}else{let o=Math.min(t.col,e.col),a=Math.max(t.col,e.col);for(let l=n;l<=r;l++){let u=i.doc.line(l),c=eu(u.text,o,i.tabSize,!0);if(c<0)s.push(U.cursor(u.to));else{let h=eu(u.text,a,i.tabSize);s.push(U.range(u.from+c,u.from+h))}}}return s}function jD(i,t){let e=i.coordsAtPos(i.viewport.from);return e?Math.round(Math.abs((e.left-t)/i.defaultCharacterWidth)):-1}function kf(i,t){let e=i.posAtCoords({x:t.clientX,y:t.clientY},!1),n=i.state.doc.lineAt(e),r=e-n.from,s=r>vu?-1:r==n.length?jD(i,t.clientX):Es(n.text,i.state.tabSize,e-n.from);return{line:n.number,col:s,off:r}}function ID(i,t){let e=kf(i,t),n=i.state.selection;return e?{update(r){if(r.docChanged){let s=r.changes.mapPos(r.startState.doc.line(e.line).from),o=r.state.doc.lineAt(s);e={line:o.number,col:e.col,off:Math.min(e.off,o.length)},n=n.map(r.changes)}},get(r,s,o){let a=kf(i,r);if(!a)return n;let l=zD(i.state,e,a);return l.length?o?U.create(l.concat(n.ranges)):U.create(l):n}}:null}function LD(i){let t=(e=>e.altKey&&e.button==0);return ae.mouseSelectionStyle.of((e,n)=>t(n)?ID(e,n):null)}const XD={Alt:[18,i=>!!i.altKey],Control:[17,i=>!!i.ctrlKey],Shift:[16,i=>!!i.shiftKey],Meta:[91,i=>!!i.metaKey]},ND={style:"cursor: crosshair"};function WD(i={}){let[t,e]=XD[i.key||"Alt"],n=Qt.fromClass(class{constructor(r){this.view=r,this.isDown=!1}set(r){this.isDown!=r&&(this.isDown=r,this.view.update([]))}},{eventObservers:{keydown(r){this.set(r.keyCode==t||e(r))},keyup(r){(r.keyCode==t||!e(r))&&this.set(!1)},mousemove(r){this.set(e(r))}}});return[n,ae.contentAttributes.of(r=>{var s;return!((s=r.plugin(n))===null||s===void 0)&&s.isDown?ND:null})]}const zs="-10000px";class S0{constructor(t,e,n,r){this.facet=e,this.createTooltipView=n,this.removeTooltipView=r,this.input=t.state.facet(e),this.tooltips=this.input.filter(o=>o);let s=null;this.tooltipViews=this.tooltips.map(o=>s=n(o,s))}update(t,e){var n;let r=t.state.facet(this.facet),s=r.filter(l=>l);if(r===this.input){for(let l of this.tooltipViews)l.update&&l.update(t);return!1}let o=[],a=e?[]:null;for(let l=0;l<s.length;l++){let u=s[l],c=-1;if(u){for(let h=0;h<this.tooltips.length;h++){let d=this.tooltips[h];d&&d.create==u.create&&(c=h)}if(c<0)o[l]=this.createTooltipView(u,l?o[l-1]:null),a&&(a[l]=!!u.above);else{let h=o[l]=this.tooltipViews[c];a&&(a[l]=e[c]),h.update&&h.update(t)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(n=l.destroy)===null||n===void 0||n.call(l));return e&&(a.forEach((l,u)=>e[u]=l),e.length=a.length),this.input=r,this.tooltips=s,this.tooltipViews=o,!0}}function YD(i){let t=i.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const nc=pe.define({combine:i=>{var t,e,n;return{position:le.ios?"absolute":((t=i.find(r=>r.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((e=i.find(r=>r.parent))===null||e===void 0?void 0:e.parent)||null,tooltipSpace:((n=i.find(r=>r.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||YD}}}),Cf=new WeakMap,kh=Qt.fromClass(class{constructor(i){this.view=i,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=i.state.facet(nc);this.position=t.position,this.parent=t.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new S0(i,Ch,(e,n)=>this.createTooltip(e,n),e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()}),this.above=this.manager.tooltips.map(e=>!!e.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),i.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(i,this.above);t&&this.observeIntersection();let e=t||i.geometryChanged,n=i.state.facet(nc);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let r of this.manager.tooltipViews)r.dom.style.position=this.position;e=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let r of this.manager.tooltipViews)this.container.appendChild(r.dom);e=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);e&&this.maybeMeasure()}createTooltip(i,t){let e=i.create(this.view),n=t?t.dom:null;if(e.dom.classList.add("cm-tooltip"),i.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let r=document.createElement("div");r.className="cm-tooltip-arrow",e.dom.appendChild(r)}return e.dom.style.position=this.position,e.dom.style.top=zs,e.dom.style.left="0px",this.container.insertBefore(e.dom,n),e.mount&&e.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(e.dom),e}destroy(){var i,t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),(i=n.destroy)===null||i===void 0||i.call(n);this.parent&&this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=1,t=1,e=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(le.gecko)e=s.offsetParent!=this.container.ownerDocument.body;else if(s.style.top==zs&&s.style.left=="0px"){let o=s.getBoundingClientRect();e=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}}if(e||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(i=s.width/this.parent.offsetWidth,t=s.height/this.parent.offsetHeight)}else({scaleX:i,scaleY:t}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),r=xh(this.view);return{visible:{left:n.left+r.left,top:n.top+r.top,right:n.right-r.right,bottom:n.bottom-r.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(nc).tooltipSpace(this.view),scaleX:i,scaleY:t,makeAbsolute:e}}writeMeasure(i){var t;if(i.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:e,space:n,scaleX:r,scaleY:s}=i,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],u=this.manager.tooltipViews[a],{dom:c}=u,h=i.pos[a],d=i.size[a];if(!h||l.clip!==!1&&(h.bottom<=Math.max(e.top,n.top)||h.top>=Math.min(e.bottom,n.bottom)||h.right<Math.max(e.left,n.left)-.1||h.left>Math.min(e.right,n.right)+.1)){c.style.top=zs;continue}let f=l.arrow?u.dom.querySelector(".cm-tooltip-arrow"):null,p=f?7:0,g=d.right-d.left,m=(t=Cf.get(u))!==null&&t!==void 0?t:d.bottom-d.top,O=u.offset||VD,b=this.view.textDirection==mt.LTR,x=d.width>n.right-n.left?b?n.left:n.right-d.width:b?Math.max(n.left,Math.min(h.left-(f?14:0)+O.x,n.right-g)):Math.min(Math.max(n.left,h.left-g+(f?14:0)-O.x),n.right-g),S=this.above[a];!l.strictSide&&(S?h.top-m-p-O.y<n.top:h.bottom+m+p+O.y>n.bottom)&&S==n.bottom-h.bottom>h.top-n.top&&(S=this.above[a]=!S);let w=(S?h.top-n.top:n.bottom-h.bottom)-p;if(w<m&&u.resize!==!1){if(w<this.view.defaultLineHeight){c.style.top=zs;continue}Cf.set(u,m),c.style.height=(m=w)/s+"px"}else c.style.height&&(c.style.height="");let v=S?h.top-m-p-O.y:h.bottom+p+O.y,D=x+g;if(u.overlap!==!0)for(let R of o)R.left<D&&R.right>x&&R.top<v+m&&R.bottom>v&&(v=S?R.top-m-2-p:R.bottom+p+2);if(this.position=="absolute"?(c.style.top=(v-i.parent.top)/s+"px",Df(c,(x-i.parent.left)/r)):(c.style.top=v/s+"px",Df(c,x/r)),f){let R=h.left+(b?O.x:-O.x)-(x+14-7);f.style.left=R/r+"px"}u.overlap!==!0&&o.push({left:x,top:v,right:D,bottom:v+m}),c.classList.toggle("cm-tooltip-above",S),c.classList.toggle("cm-tooltip-below",!S),u.positioned&&u.positioned(i.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=zs}},{eventObservers:{scroll(){this.maybeMeasure()}}});function Df(i,t){let e=parseInt(i.style.left,10);(isNaN(e)||Math.abs(t-e)>1)&&(i.style.left=t+"px")}const qD=ae.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),VD={x:0,y:0},Ch=pe.define({enables:[kh,qD]}),Xa=pe.define({combine:i=>i.reduce((t,e)=>t.concat(e),[])});class xl{static create(t){return new xl(t)}constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new S0(t,Xa,(e,n)=>this.createHostedView(e,n),e=>e.dom.remove())}createHostedView(t,e){let n=t.create(this.view);return n.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(n.dom,e?e.dom.nextSibling:this.dom.firstChild),this.mounted&&n.mount&&n.mount(this.view),n}mount(t){for(let e of this.manager.tooltipViews)e.mount&&e.mount(t);this.mounted=!0}positioned(t){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned(t)}update(t){this.manager.update(t)}destroy(){var t;for(let e of this.manager.tooltipViews)(t=e.destroy)===null||t===void 0||t.call(e)}passProp(t){let e;for(let n of this.manager.tooltipViews){let r=n[t];if(r!==void 0){if(e===void 0)e=r;else if(e!==r)return}}return e}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const GD=Ch.compute([Xa],i=>{let t=i.facet(Xa);return t.length===0?null:{pos:Math.min(...t.map(e=>e.pos)),end:Math.max(...t.map(e=>{var n;return(n=e.end)!==null&&n!==void 0?n:e.pos})),create:xl.create,above:t[0].above,arrow:t.some(e=>e.arrow)}});class UD{constructor(t,e,n,r,s){this.view=t,this.source=e,this.field=n,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:t,lastMove:e}=this,n=t.docView.nearest(e.target);if(!n)return;let r,s=1;if(n instanceof wr)r=n.posAtStart;else{if(r=t.posAtCoords(e),r==null)return;let a=t.coordsAtPos(r);if(!a||e.y<a.top||e.y>a.bottom||e.x<a.left-t.defaultCharacterWidth||e.x>a.right+t.defaultCharacterWidth)return;let l=t.bidiSpans(t.state.doc.lineAt(r)).find(c=>c.from<=r&&c.to>=r),u=l&&l.dir==mt.RTL?-1:1;s=e.x<a.left?-u:u}let o=this.source(t,r,s);if(o?.then){let a=this.pending={pos:r};o.then(l=>{this.pending==a&&(this.pending=null,l&&!(Array.isArray(l)&&!l.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])}))},l=>zi(t.state,l,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let t=this.view.plugin(kh),e=t?t.manager.tooltips.findIndex(n=>n.create==xl.create):-1;return e>-1?t.manager.tooltipViews[e]:null}mousemove(t){var e,n;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:r,tooltip:s}=this;if(r.length&&s&&!HD(s.dom,t)||this.pending){let{pos:o}=r[0]||this.pending,a=(n=(e=r[0])===null||e===void 0?void 0:e.end)!==null&&n!==void 0?n:o;(o==a?this.view.posAtCoords(this.lastMove)!=o:!KD(this.view,o,a,t.clientX,t.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(t){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:e}=this;if(e.length){let{tooltip:n}=this;n&&n.dom.contains(t.relatedTarget)?this.watchTooltipLeave(n.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(t){let e=n=>{t.removeEventListener("mouseleave",e),this.active.length&&!this.view.dom.contains(n.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};t.addEventListener("mouseleave",e)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const oa=4;function HD(i,t){let{left:e,right:n,top:r,bottom:s}=i.getBoundingClientRect(),o;if(o=i.querySelector(".cm-tooltip-arrow")){let a=o.getBoundingClientRect();r=Math.min(a.top,r),s=Math.max(a.bottom,s)}return t.clientX>=e-oa&&t.clientX<=n+oa&&t.clientY>=r-oa&&t.clientY<=s+oa}function KD(i,t,e,n,r,s){let o=i.scrollDOM.getBoundingClientRect(),a=i.documentTop+i.documentPadding.top+i.contentHeight;if(o.left>n||o.right<n||o.top>r||Math.min(o.bottom,a)<r)return!1;let l=i.posAtCoords({x:n,y:r},!1);return l>=t&&l<=e}function JD(i,t={}){let e=Ze.define(),n=pi.define({create(){return[]},update(r,s){if(r.length&&(t.hideOnChange&&(s.docChanged||s.selection)?r=[]:t.hideOn&&(r=r.filter(o=>!t.hideOn(s,o))),s.docChanged)){let o=[];for(let a of r){let l=s.changes.mapPos(a.pos,-1,Ai.TrackDel);if(l!=null){let u=Object.assign(Object.create(null),a);u.pos=l,u.end!=null&&(u.end=s.changes.mapPos(u.end)),o.push(u)}}r=o}for(let o of s.effects)o.is(e)&&(r=o.value),o.is(e$)&&(r=[]);return r},provide:r=>Xa.from(r)});return{active:n,extension:[n,Qt.define(r=>new UD(r,i,n,e,t.hoverTime||300)),GD]}}function v0(i,t){let e=i.plugin(kh);if(!e)return null;let n=e.manager.tooltips.indexOf(t);return n<0?null:e.manager.tooltipViews[n]}const e$=Ze.define(),$f=pe.define({combine(i){let t,e;for(let n of i)t=t||n.topContainer,e=e||n.bottomContainer;return{topContainer:t,bottomContainer:e}}});function po(i,t){let e=i.plugin(k0),n=e?e.specs.indexOf(t):-1;return n>-1?e.panels[n]:null}const k0=Qt.fromClass(class{constructor(i){this.input=i.state.facet(go),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(e=>e(i));let t=i.state.facet($f);this.top=new aa(i,!0,t.topContainer),this.bottom=new aa(i,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(i){let t=i.state.facet($f);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new aa(i.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new aa(i.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let e=i.state.facet(go);if(e!=this.input){let n=e.filter(l=>l),r=[],s=[],o=[],a=[];for(let l of n){let u=this.specs.indexOf(l),c;u<0?(c=l(i.view),a.push(c)):(c=this.panels[u],c.update&&c.update(i)),r.push(c),(c.top?s:o).push(c)}this.specs=n,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let n of this.panels)n.update&&n.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:i=>ae.scrollMargins.of(t=>{let e=t.plugin(i);return e&&{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}})});class aa{constructor(t,e,n){this.view=t,this.top=e,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let e of this.panels)e.destroy&&t.indexOf(e)<0&&e.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let t=this.dom.firstChild;for(let e of this.panels)if(e.dom.parentNode==this.dom){for(;t!=e.dom;)t=Qf(t);t=t.nextSibling}else this.dom.insertBefore(e.dom,t);for(;t;)t=Qf(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function Qf(i){let t=i.nextSibling;return i.remove(),t}const go=pe.define({enables:k0});class er extends Vr{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}er.prototype.elementClass="";er.prototype.toDOM=void 0;er.prototype.mapMode=Ai.TrackBefore;er.prototype.startSide=er.prototype.endSide=-1;er.prototype.point=!0;const Ea=pe.define(),t$=pe.define(),i$={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Ge.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},io=pe.define();function n$(i){return[C0(),io.of({...i$,...i})]}const Pf=pe.define({combine:i=>i.some(t=>t)});function C0(i){return[r$]}const r$=Qt.fromClass(class{constructor(i){this.view=i,this.domAfter=null,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=i.state.facet(io).map(t=>new Ef(i,t)),this.fixed=!i.state.facet(Pf);for(let t of this.gutters)t.config.side=="after"?this.getDOMAfter().appendChild(t.dom):this.dom.appendChild(t.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(i){if(this.updateGutters(i)){let t=this.prevViewport,e=i.view.viewport,n=Math.min(t.to,e.to)-Math.max(t.from,e.from);this.syncGutters(n<(e.to-e.from)*.8)}if(i.geometryChanged){let t=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=t,this.domAfter&&(this.domAfter.style.minHeight=t)}this.view.state.facet(Pf)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=i.view.viewport}syncGutters(i){let t=this.dom.nextSibling;i&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let e=Ge.iter(this.view.state.facet(Ea),this.view.viewport.from),n=[],r=this.gutters.map(s=>new s$(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(s.type)){let o=!0;for(let a of s.type)if(a.type==Ti.Text&&o){ku(e,n,a.from);for(let l of r)l.line(this.view,a,n);o=!1}else if(a.widget)for(let l of r)l.widget(this.view,a)}else if(s.type==Ti.Text){ku(e,n,s.from);for(let o of r)o.line(this.view,s,n)}else if(s.widget)for(let o of r)o.widget(this.view,s);for(let s of r)s.finish();i&&(this.view.scrollDOM.insertBefore(this.dom,t),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(i){let t=i.startState.facet(io),e=i.state.facet(io),n=i.docChanged||i.heightChanged||i.viewportChanged||!Ge.eq(i.startState.facet(Ea),i.state.facet(Ea),i.view.viewport.from,i.view.viewport.to);if(t==e)for(let r of this.gutters)r.update(i)&&(n=!0);else{n=!0;let r=[];for(let s of e){let o=t.indexOf(s);o<0?r.push(new Ef(this.view,s)):(this.gutters[o].update(i),r.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),r.indexOf(s)<0&&s.destroy();for(let s of r)s.config.side=="after"?this.getDOMAfter().appendChild(s.dom):this.dom.appendChild(s.dom);this.gutters=r}return n}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:i=>ae.scrollMargins.of(t=>{let e=t.plugin(i);if(!e||e.gutters.length==0||!e.fixed)return null;let n=e.dom.offsetWidth*t.scaleX,r=e.domAfter?e.domAfter.offsetWidth*t.scaleX:0;return t.textDirection==mt.LTR?{left:n,right:r}:{right:n,left:r}})});function Af(i){return Array.isArray(i)?i:[i]}function ku(i,t,e){for(;i.value&&i.from<=e;)i.from==e&&t.push(i.value),i.next()}class s${constructor(t,e,n){this.gutter=t,this.height=n,this.i=0,this.cursor=Ge.iter(t.markers,e.from)}addElement(t,e,n){let{gutter:r}=this,s=(e.top-this.height)/t.scaleY,o=e.height/t.scaleY;if(this.i==r.elements.length){let a=new D0(t,o,s,n);r.elements.push(a),r.dom.appendChild(a.dom)}else r.elements[this.i].update(t,o,s,n);this.height=e.bottom,this.i++}line(t,e,n){let r=[];ku(this.cursor,r,e.from),n.length&&(r=r.concat(n));let s=this.gutter.config.lineMarker(t,e,r);s&&r.unshift(s);let o=this.gutter;r.length==0&&!o.config.renderEmptyElements||this.addElement(t,e,r)}widget(t,e){let n=this.gutter.config.widgetMarker(t,e.widget,e),r=n?[n]:null;for(let s of t.state.facet(t$)){let o=s(t,e.widget,e);o&&(r||(r=[])).push(o)}r&&this.addElement(t,e,r)}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let e=t.elements.pop();t.dom.removeChild(e.dom),e.destroy()}}}class Ef{constructor(t,e){this.view=t,this.config=e,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in e.domEventHandlers)this.dom.addEventListener(n,r=>{let s=r.target,o;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let l=s.getBoundingClientRect();o=(l.top+l.bottom)/2}else o=r.clientY;let a=t.lineBlockAtHeight(o-t.documentTop);e.domEventHandlers[n](t,a,r)&&r.preventDefault()});this.markers=Af(e.markers(t)),e.initialSpacer&&(this.spacer=new D0(t,0,0,[e.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let e=this.markers;if(this.markers=Af(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let r=this.config.updateSpacer(this.spacer.markers[0],t);r!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[r])}let n=t.view.viewport;return!Ge.eq(this.markers,e,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class D0{constructor(t,e,n,r){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,e,n,r)}update(t,e,n,r){this.height!=e&&(this.height=e,this.dom.style.height=e+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),o$(this.markers,r)||this.setMarkers(t,r)}setMarkers(t,e){let n="cm-gutterElement",r=this.dom.firstChild;for(let s=0,o=0;;){let a=o,l=s<e.length?e[s++]:null,u=!1;if(l){let c=l.elementClass;c&&(n+=" "+c);for(let h=o;h<this.markers.length;h++)if(this.markers[h].compare(l)){a=h,u=!0;break}}else a=this.markers.length;for(;o<a;){let c=this.markers[o++];if(c.toDOM){c.destroy(r);let h=r.nextSibling;r.remove(),r=h}}if(!l)break;l.toDOM&&(u?r=r.nextSibling:this.dom.insertBefore(l.toDOM(t),r)),u&&o++}this.dom.className=n,this.markers=e}destroy(){this.setMarkers(null,[])}}function o$(i,t){if(i.length!=t.length)return!1;for(let e=0;e<i.length;e++)if(!i[e].compare(t[e]))return!1;return!0}const a$=pe.define(),l$=pe.define(),cs=pe.define({combine(i){return zn(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,e){let n=Object.assign({},t);for(let r in e){let s=n[r],o=e[r];n[r]=s?(a,l,u)=>s(a,l,u)||o(a,l,u):o}return n}})}});class rc extends er{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function sc(i,t){return i.state.facet(cs).formatNumber(t,i.state)}const c$=io.compute([cs],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(a$)},lineMarker(t,e,n){return n.some(r=>r.toDOM)?null:new rc(sc(t,t.state.doc.lineAt(e.from).number))},widgetMarker:(t,e,n)=>{for(let r of t.state.facet(l$)){let s=r(t,e,n);if(s)return s}return null},lineMarkerChange:t=>t.startState.facet(cs)!=t.state.facet(cs),initialSpacer(t){return new rc(sc(t,Tf(t.state.doc.lines)))},updateSpacer(t,e){let n=sc(e.view,Tf(e.view.state.doc.lines));return n==t.number?t:new rc(n)},domEventHandlers:i.facet(cs).domEventHandlers,side:"before"}));function $0(i={}){return[cs.of(i),C0(),c$]}function Tf(i){let t=9;for(;t<i;)t=t*10+9;return t}const u$=new class extends er{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},h$=Ea.compute(["selection"],i=>{let t=[],e=-1;for(let n of i.selection.ranges){let r=i.doc.lineAt(n.head).from;r>e&&(e=r,t.push(u$.range(r)))}return Ge.of(t)});function Q0(){return h$}const P0=1024;let d$=0;class oc{constructor(t,e){this.from=t,this.to=e}}class Ie{constructor(t={}){this.id=d$++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=t.combine||null}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=Ii.match(t)),e=>{let n=t(e);return n===void 0?null:[this,n]}}}Ie.closedBy=new Ie({deserialize:i=>i.split(" ")});Ie.openedBy=new Ie({deserialize:i=>i.split(" ")});Ie.group=new Ie({deserialize:i=>i.split(" ")});Ie.isolate=new Ie({deserialize:i=>{if(i&&i!="rtl"&&i!="ltr"&&i!="auto")throw new RangeError("Invalid value for isolate: "+i);return i||"auto"}});Ie.contextHash=new Ie({perNode:!0});Ie.lookAhead=new Ie({perNode:!0});Ie.mounted=new Ie({perNode:!0});class Na{constructor(t,e,n){this.tree=t,this.overlay=e,this.parser=n}static get(t){return t&&t.props&&t.props[Ie.mounted.id]}}const f$=Object.create(null);class Ii{constructor(t,e,n,r=0){this.name=t,this.props=e,this.id=n,this.flags=r}static define(t){let e=t.props&&t.props.length?Object.create(null):f$,n=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),r=new Ii(t.name||"",e,t.id,n);if(t.props){for(let s of t.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return r}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(Ie.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let n in t)for(let r of n.split(" "))e[r]=t[n];return n=>{for(let r=n.prop(Ie.group),s=-1;s<(r?r.length:0);s++){let o=e[s<0?n.name:r[s]];if(o)return o}}}}Ii.none=new Ii("",Object.create(null),0,8);class Dh{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let n of this.types){let r=null;for(let s of t){let o=s(n);if(o){r||(r=Object.assign({},n.props));let a=o[1],l=o[0];l.combine&&l.id in r&&(a=l.combine(r[l.id],a)),r[l.id]=a}}e.push(r?new Ii(n.name,r,n.id,n.flags):n)}return new Dh(e)}}const la=new WeakMap,Rf=new WeakMap;var si;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays"})(si||(si={}));class Zt{constructor(t,e,n,r,s){if(this.type=t,this.children=e,this.positions=n,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,a]of s)this.props[typeof o=="number"?o:o.id]=a}}toString(){let t=Na.get(this);if(t&&!t.overlay)return t.tree.toString();let e="";for(let n of this.children){let r=n.toString();r&&(e&&(e+=","),e+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Du(this.topNode,t)}cursorAt(t,e=0,n=0){let r=la.get(this)||this.topNode,s=new Du(r);return s.moveTo(t,e),la.set(this,s._tree),s}get topNode(){return new un(this,0,0,null)}resolve(t,e=0){let n=mo(la.get(this)||this.topNode,t,e,!1);return la.set(this,n),n}resolveInner(t,e=0){let n=mo(Rf.get(this)||this.topNode,t,e,!0);return Rf.set(this,n),n}resolveStack(t,e=0){return m$(this,t,e)}iterate(t){let{enter:e,leave:n,from:r=0,to:s=this.length}=t,o=t.mode||0,a=(o&si.IncludeAnonymous)>0;for(let l=this.cursor(o|si.IncludeAnonymous);;){let u=!1;if(l.from<=s&&l.to>=r&&(!a&&l.type.isAnonymous||e(l)!==!1)){if(l.firstChild())continue;u=!0}for(;u&&n&&(a||!l.type.isAnonymous)&&n(l),!l.nextSibling();){if(!l.parent())return;u=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:Ph(Ii.none,this.children,this.positions,0,this.children.length,0,this.length,(e,n,r)=>new Zt(this.type,e,n,r,this.propValues),t.makeTree||((e,n,r)=>new Zt(Ii.none,e,n,r)))}static build(t){return O$(t)}}Zt.empty=new Zt(Ii.none,[],[],0);class $h{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new $h(this.buffer,this.index)}}class Ar{constructor(t,e,n){this.buffer=t,this.length=e,this.set=n}get type(){return Ii.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],n=this.buffer[t+3],r=this.set.types[e],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),t+=4,n==t)return s;let o=[];for(;t<n;)o.push(this.childString(t)),t=this.buffer[t+3];return s+"("+o.join(",")+")"}findChild(t,e,n,r,s){let{buffer:o}=this,a=-1;for(let l=t;l!=e&&!(A0(s,r,o[l+1],o[l+2])&&(a=l,n>0));l=o[l+3]);return a}slice(t,e,n){let r=this.buffer,s=new Uint16Array(e-t),o=0;for(let a=t,l=0;a<e;){s[l++]=r[a++],s[l++]=r[a++]-n;let u=s[l++]=r[a++]-n;s[l++]=r[a++]-t,o=Math.max(o,u)}return new Ar(s,o,this.set)}}function A0(i,t,e,n){switch(i){case-2:return e<t;case-1:return n>=t&&e<t;case 0:return e<t&&n>t;case 1:return e<=t&&n>t;case 2:return n>t;case 4:return!0}}function mo(i,t,e,n){for(var r;i.from==i.to||(e<1?i.from>=t:i.from>t)||(e>-1?i.to<=t:i.to<t);){let o=!n&&i instanceof un&&i.index<0?null:i.parent;if(!o)return i;i=o}let s=n?0:si.IgnoreOverlays;if(n)for(let o=i,a=o.parent;a;o=a,a=o.parent)o instanceof un&&o.index<0&&((r=a.enter(t,e,s))===null||r===void 0?void 0:r.from)!=o.from&&(i=a);for(;;){let o=i.enter(t,e,s);if(!o)return i;i=o}}class E0{cursor(t=0){return new Du(this,t)}getChild(t,e=null,n=null){let r=_f(this,t,e,n);return r.length?r[0]:null}getChildren(t,e=null,n=null){return _f(this,t,e,n)}resolve(t,e=0){return mo(this,t,e,!1)}resolveInner(t,e=0){return mo(this,t,e,!0)}matchContext(t){return Cu(this.parent,t)}enterUnfinishedNodesBefore(t){let e=this.childBefore(t),n=this;for(;e;){let r=e.lastChild;if(!r||r.to!=e.to)break;r.type.isError&&r.from==r.to?(n=e,e=r.prevSibling):e=r}return n}get node(){return this}get next(){return this.parent}}class un extends E0{constructor(t,e,n,r){super(),this._tree=t,this.from=e,this.index=n,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,n,r,s=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,u=e>0?a.length:-1;t!=u;t+=e){let c=a[t],h=l[t]+o.from;if(A0(r,n,h,h+c.length)){if(c instanceof Ar){if(s&si.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,e,n-h,r);if(d>-1)return new vr(new p$(o,c,t,h),null,d)}else if(s&si.IncludeAnonymous||!c.type.isAnonymous||Qh(c)){let d;if(!(s&si.IgnoreMounts)&&(d=Na.get(c))&&!d.overlay)return new un(d.tree,h,t,o);let f=new un(c,h,t,o);return s&si.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(e<0?c.children.length-1:0,e,n,r)}}}if(s&si.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,n=0){let r;if(!(n&si.IgnoreOverlays)&&(r=Na.get(this._tree))&&r.overlay){let s=t-this.from;for(let{from:o,to:a}of r.overlay)if((e>0?o<=s:o<s)&&(e<0?a>=s:a>s))return new un(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,n)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function _f(i,t,e,n){let r=i.cursor(),s=[];if(!r.firstChild())return s;if(e!=null){for(let o=!1;!o;)if(o=r.type.is(e),!r.nextSibling())return s}for(;;){if(n!=null&&r.type.is(n))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return n==null?s:[]}}function Cu(i,t,e=t.length-1){for(let n=i;e>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[e]&&t[e]!=n.name)return!1;e--}}return!0}class p${constructor(t,e,n,r){this.parent=t,this.buffer=e,this.index=n,this.start=r}}class vr extends E0{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,e,n){super(),this.context=t,this._parent=e,this.index=n,this.type=t.buffer.set.types[t.buffer.buffer[n]]}child(t,e,n){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],t,e-this.context.start,n);return s<0?null:new vr(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,n=0){if(n&si.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return s<0?null:new vr(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new vr(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new vr(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get tree(){return null}toTree(){let t=[],e=[],{buffer:n}=this.context,r=this.index+4,s=n.buffer[this.index+3];if(s>r){let o=n.buffer[this.index+1];t.push(n.slice(r,s,o)),e.push(0)}return new Zt(this.type,t,e,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function T0(i){if(!i.length)return null;let t=0,e=i[0];for(let s=1;s<i.length;s++){let o=i[s];(o.from>e.from||o.to<e.to)&&(e=o,t=s)}let n=e instanceof un&&e.index<0?null:e.parent,r=i.slice();return n?r[t]=n:r.splice(t,1),new g$(r,e)}class g${constructor(t,e){this.heads=t,this.node=e}get next(){return T0(this.heads)}}function m$(i,t,e){let n=i.resolveInner(t,e),r=null;for(let s=n instanceof un?n:n.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(r||(r=[n])).push(o.resolve(t,e)),s=o}else{let o=Na.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let a=new un(o.tree,o.overlay[0].from+s.from,-1,s);(r||(r=[n])).push(mo(a,t,e,!1))}}return r?T0(r):n}class Du{get name(){return this.type.name}constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof un)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let n=t._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=t,this.yieldBuf(t.index)}}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:n,buffer:r}=this.buffer;return this.type=e||r.set.types[r.buffer[t]],this.from=n+r.buffer[t+1],this.to=n+r.buffer[t+2],!0}yield(t){return t?t instanceof un?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,n){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,n,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],t,e-this.buffer.start,n);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,n=this.mode){return this.buffer?n&si.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&si.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&si.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,n=this.stack.length-1;if(t<0){let r=n<0?0:this.stack[n]+4;if(this.index!=r)return this.yieldBuf(e.findChild(r,this.index,-1,0,4))}else{let r=e.buffer[this.index+3];if(r<(n<0?e.buffer.length:e.buffer[this.stack[n]+3]))return this.yieldBuf(r)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,n,{buffer:r}=this;if(r){if(t>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:e,parent:n}=r)}else({index:e,_parent:n}=this._tree);for(;n;{index:e,_parent:n}=n)if(e>-1)for(let s=e+t,o=t<0?-1:n._tree.children.length;s!=o;s+=t){let a=n._tree.children[s];if(this.mode&si.IncludeAnonymous||a instanceof Ar||!a.type.isAnonymous||Qh(a))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,n=0;if(t&&t.context==this.buffer)e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=t;o;o=o._parent)if(o.index==r){if(r==this.index)return o;e=o,n=s+1;break e}r=this.stack[--s]}for(let r=n;r<this.stack.length;r++)e=new vr(this.buffer,e,this.stack[r]);return this.bufferNode=new vr(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let n=0;;){let r=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(r=!0)}for(;;){if(r&&e&&e(this),r=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,r=!0}}}matchContext(t){if(!this.buffer)return Cu(this.node.parent,t);let{buffer:e}=this.buffer,{types:n}=e.set;for(let r=t.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return Cu(this._tree,t,r);let o=n[e.buffer[this.stack[s]]];if(!o.isAnonymous){if(t[r]&&t[r]!=o.name)return!1;r--}}return!0}}function Qh(i){return i.children.some(t=>t instanceof Ar||!t.type.isAnonymous||Qh(t))}function O$(i){var t;let{buffer:e,nodeSet:n,maxBufferLength:r=P0,reused:s=[],minRepeatType:o=n.types.length}=i,a=Array.isArray(e)?new $h(e,e.length):e,l=n.types,u=0,c=0;function h(w,v,D,R,$,k){let{id:A,start:P,end:Q,size:M}=a,B=c,W=u;if(M<0)if(a.next(),M==-1){let q=s[A];D.push(q),R.push(P-w);return}else if(M==-3){u=A;return}else if(M==-4){c=A;return}else throw new RangeError(`Unrecognized record size: ${M}`);let X=l[A],F,_,j=P-w;if(Q-P<=r&&(_=m(a.pos-v,$))){let q=new Uint16Array(_.size-_.skip),E=a.pos-_.size,Z=q.length;for(;a.pos>E;)Z=O(_.start,q,Z);F=new Ar(q,Q-_.start,n),j=_.start-w}else{let q=a.pos-M;a.next();let E=[],Z=[],L=A>=o?A:-1,Y=0,N=Q;for(;a.pos>q;)L>=0&&a.id==L&&a.size>=0?(a.end<=N-r&&(p(E,Z,P,Y,a.end,N,L,B,W),Y=E.length,N=a.end),a.next()):k>2500?d(P,q,E,Z):h(P,q,E,Z,L,k+1);if(L>=0&&Y>0&&Y<E.length&&p(E,Z,P,Y,P,N,L,B,W),E.reverse(),Z.reverse(),L>-1&&Y>0){let z=f(X,W);F=Ph(X,E,Z,0,E.length,0,Q-P,z,z)}else F=g(X,E,Z,Q-P,B-Q,W)}D.push(F),R.push(j)}function d(w,v,D,R){let $=[],k=0,A=-1;for(;a.pos>v;){let{id:P,start:Q,end:M,size:B}=a;if(B>4)a.next();else{if(A>-1&&Q<A)break;A<0&&(A=M-r),$.push(P,Q,M),k++,a.next()}}if(k){let P=new Uint16Array(k*4),Q=$[$.length-2];for(let M=$.length-3,B=0;M>=0;M-=3)P[B++]=$[M],P[B++]=$[M+1]-Q,P[B++]=$[M+2]-Q,P[B++]=B;D.push(new Ar(P,$[2]-Q,n)),R.push(Q-w)}}function f(w,v){return(D,R,$)=>{let k=0,A=D.length-1,P,Q;if(A>=0&&(P=D[A])instanceof Zt){if(!A&&P.type==w&&P.length==$)return P;(Q=P.prop(Ie.lookAhead))&&(k=R[A]+P.length+Q)}return g(w,D,R,$,k,v)}}function p(w,v,D,R,$,k,A,P,Q){let M=[],B=[];for(;w.length>R;)M.push(w.pop()),B.push(v.pop()+D-$);w.push(g(n.types[A],M,B,k-$,P-k,Q)),v.push($-D)}function g(w,v,D,R,$,k,A){if(k){let P=[Ie.contextHash,k];A=A?[P].concat(A):[P]}if($>25){let P=[Ie.lookAhead,$];A=A?[P].concat(A):[P]}return new Zt(w,v,D,R,A)}function m(w,v){let D=a.fork(),R=0,$=0,k=0,A=D.end-r,P={size:0,start:0,skip:0};e:for(let Q=D.pos-w;D.pos>Q;){let M=D.size;if(D.id==v&&M>=0){P.size=R,P.start=$,P.skip=k,k+=4,R+=4,D.next();continue}let B=D.pos-M;if(M<0||B<Q||D.start<A)break;let W=D.id>=o?4:0,X=D.start;for(D.next();D.pos>B;){if(D.size<0)if(D.size==-3)W+=4;else break e;else D.id>=o&&(W+=4);D.next()}$=X,R+=M,k+=W}return(v<0||R==w)&&(P.size=R,P.start=$,P.skip=k),P.size>4?P:void 0}function O(w,v,D){let{id:R,start:$,end:k,size:A}=a;if(a.next(),A>=0&&R<o){let P=D;if(A>4){let Q=a.pos-(A-4);for(;a.pos>Q;)D=O(w,v,D)}v[--D]=P,v[--D]=k-w,v[--D]=$-w,v[--D]=R}else A==-3?u=R:A==-4&&(c=R);return D}let b=[],x=[];for(;a.pos>0;)h(i.start||0,i.bufferStart||0,b,x,-1,0);let S=(t=i.length)!==null&&t!==void 0?t:b.length?x[0]+b[0].length:0;return new Zt(l[i.topID],b.reverse(),x.reverse(),S)}const Mf=new WeakMap;function Ta(i,t){if(!i.isAnonymous||t instanceof Ar||t.type!=i)return 1;let e=Mf.get(t);if(e==null){e=1;for(let n of t.children){if(n.type!=i||!(n instanceof Zt)){e=1;break}e+=Ta(i,n)}Mf.set(t,e)}return e}function Ph(i,t,e,n,r,s,o,a,l){let u=0;for(let p=n;p<r;p++)u+=Ta(i,t[p]);let c=Math.ceil(u*1.5/8),h=[],d=[];function f(p,g,m,O,b){for(let x=m;x<O;){let S=x,w=g[x],v=Ta(i,p[x]);for(x++;x<O;x++){let D=Ta(i,p[x]);if(v+D>=c)break;v+=D}if(x==S+1){if(v>c){let D=p[S];f(D.children,D.positions,0,D.children.length,g[S]+b);continue}h.push(p[S])}else{let D=g[x-1]+p[x-1].length-w;h.push(Ph(i,p,g,S,x,w,D,null,l))}d.push(w+b-s)}}return f(t,e,n,r,0),(a||l)(h,d,o)}class Yr{constructor(t,e,n,r,s=!1,o=!1){this.from=t,this.to=e,this.tree=n,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,e=[],n=!1){let r=[new Yr(0,t.length,t,0,!1,n)];for(let s of e)s.to>t.length&&r.push(s);return r}static applyChanges(t,e,n=128){if(!e.length)return t;let r=[],s=1,o=t.length?t[0]:null;for(let a=0,l=0,u=0;;a++){let c=a<e.length?e[a]:null,h=c?c.fromA:1e9;if(h-l>=n)for(;o&&o.from<h;){let d=o;if(l>=d.from||h<=d.to||u){let f=Math.max(d.from,l)-u,p=Math.min(d.to,h)-u;d=f>=p?null:new Yr(f,p,d.tree,d.offset+u,a>0,!!c)}if(d&&r.push(d),o.to>h)break;o=s<t.length?t[s++]:null}if(!c)break;l=c.toA,u=c.toA-c.toB}return r}}class R0{startParse(t,e,n){return typeof t=="string"&&(t=new b$(t)),n=n?n.length?n.map(r=>new oc(r.from,r.to)):[new oc(0,0)]:[new oc(0,t.length)],this.createParse(t,e||[],n)}parse(t,e,n){let r=this.startParse(t,e,n);for(;;){let s=r.advance();if(s)return s}}}class b${constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new Ie({perNode:!0});let y$=0;class sn{constructor(t,e,n,r){this.name=t,this.set=e,this.base=n,this.modified=r,this.id=y$++}toString(){let{name:t}=this;for(let e of this.modified)e.name&&(t=`${e.name}(${t})`);return t}static define(t,e){let n=typeof t=="string"?t:"?";if(t instanceof sn&&(e=t),e?.base)throw new Error("Can not derive from a modified tag");let r=new sn(n,[],null,[]);if(r.set.push(r),e)for(let s of e.set)r.set.push(s);return r}static defineModifier(t){let e=new Wa(t);return n=>n.modified.indexOf(e)>-1?n:Wa.get(n.base||n,n.modified.concat(e).sort((r,s)=>r.id-s.id))}}let x$=0;class Wa{constructor(t){this.name=t,this.instances=[],this.id=x$++}static get(t,e){if(!e.length)return t;let n=e[0].instances.find(a=>a.base==t&&w$(e,a.modified));if(n)return n;let r=[],s=new sn(t.name,r,t,e);for(let a of e)a.instances.push(s);let o=S$(e);for(let a of t.set)if(!a.modified.length)for(let l of o)r.push(Wa.get(a,l));return s}}function w$(i,t){return i.length==t.length&&i.every((e,n)=>e==t[n])}function S$(i){let t=[[]];for(let e=0;e<i.length;e++)for(let n=0,r=t.length;n<r;n++)t.push(t[n].concat(i[e]));return t.sort((e,n)=>n.length-e.length)}function _0(i){let t=Object.create(null);for(let e in i){let n=i[e];Array.isArray(n)||(n=[n]);for(let r of e.split(" "))if(r){let s=[],o=2,a=r;for(let h=0;;){if(a=="..."&&h>0&&h+3==r.length){o=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!d)throw new RangeError("Invalid path: "+r);if(s.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),h+=d[0].length,h==r.length)break;let f=r[h++];if(h==r.length&&f=="!"){o=0;break}if(f!="/")throw new RangeError("Invalid path: "+r);a=r.slice(h)}let l=s.length-1,u=s[l];if(!u)throw new RangeError("Invalid path: "+r);let c=new Oo(n,o,l>0?s.slice(0,l):null);t[u]=c.sort(t[u])}}return M0.add(t)}const M0=new Ie({combine(i,t){let e,n,r;for(;i||t;){if(!i||t&&i.depth>=t.depth?(r=t,t=t.next):(r=i,i=i.next),e&&e.mode==r.mode&&!r.context&&!e.context)continue;let s=new Oo(r.tags,r.mode,r.context);e?e.next=s:n=s,e=s}return n}});class Oo{constructor(t,e,n,r){this.tags=t,this.mode=e,this.context=n,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}Oo.empty=new Oo([],2,null);function B0(i,t){let e=Object.create(null);for(let s of i)if(!Array.isArray(s.tag))e[s.tag.id]=s.class;else for(let o of s.tag)e[o.id]=s.class;let{scope:n,all:r=null}=t||{};return{style:s=>{let o=r;for(let a of s)for(let l of a.set){let u=e[l.id];if(u){o=o?o+" "+u:u;break}}return o},scope:n}}function v$(i,t){let e=null;for(let n of i){let r=n.style(t);r&&(e=e?e+" "+r:r)}return e}function k$(i,t,e,n=0,r=i.length){let s=new C$(n,Array.isArray(t)?t:[t],e);s.highlightRange(i.cursor(),n,r,"",s.highlighters),s.flush(r)}class C${constructor(t,e,n){this.at=t,this.highlighters=e,this.span=n,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,n,r,s){let{type:o,from:a,to:l}=t;if(a>=n||l<=e)return;o.isTop&&(s=this.highlighters.filter(f=>!f.scope||f.scope(o)));let u=r,c=D$(t)||Oo.empty,h=v$(s,c.tags);if(h&&(u&&(u+=" "),u+=h,c.mode==1&&(r+=(r?" ":"")+h)),this.startSpan(Math.max(e,a),u),c.opaque)return;let d=t.tree&&t.tree.prop(Ie.mounted);if(d&&d.overlay){let f=t.node.enter(d.overlay[0].from+a,1),p=this.highlighters.filter(m=>!m.scope||m.scope(d.tree.type)),g=t.firstChild();for(let m=0,O=a;;m++){let b=m<d.overlay.length?d.overlay[m]:null,x=b?b.from+a:l,S=Math.max(e,O),w=Math.min(n,x);if(S<w&&g)for(;t.from<w&&(this.highlightRange(t,S,w,r,s),this.startSpan(Math.min(w,t.to),u),!(t.to>=x||!t.nextSibling())););if(!b||x>n)break;O=b.to+a,O>e&&(this.highlightRange(f.cursor(),Math.max(e,b.from+a),Math.min(n,O),"",p),this.startSpan(Math.min(n,O),u))}g&&t.parent()}else if(t.firstChild()){d&&(r="");do if(!(t.to<=e)){if(t.from>=n)break;this.highlightRange(t,e,n,r,s),this.startSpan(Math.min(n,t.to),u)}while(t.nextSibling());t.parent()}}}function D$(i){let t=i.type.prop(M0);for(;t&&t.context&&!i.matchContext(t.context);)t=t.next;return t||null}const oe=sn.define,ca=oe(),Or=oe(),Bf=oe(Or),Ff=oe(Or),br=oe(),ua=oe(br),ac=oe(br),Pn=oe(),Br=oe(Pn),$n=oe(),Qn=oe(),$u=oe(),js=oe($u),ha=oe(),T={comment:ca,lineComment:oe(ca),blockComment:oe(ca),docComment:oe(ca),name:Or,variableName:oe(Or),typeName:Bf,tagName:oe(Bf),propertyName:Ff,attributeName:oe(Ff),className:oe(Or),labelName:oe(Or),namespace:oe(Or),macroName:oe(Or),literal:br,string:ua,docString:oe(ua),character:oe(ua),attributeValue:oe(ua),number:ac,integer:oe(ac),float:oe(ac),bool:oe(br),regexp:oe(br),escape:oe(br),color:oe(br),url:oe(br),keyword:$n,self:oe($n),null:oe($n),atom:oe($n),unit:oe($n),modifier:oe($n),operatorKeyword:oe($n),controlKeyword:oe($n),definitionKeyword:oe($n),moduleKeyword:oe($n),operator:Qn,derefOperator:oe(Qn),arithmeticOperator:oe(Qn),logicOperator:oe(Qn),bitwiseOperator:oe(Qn),compareOperator:oe(Qn),updateOperator:oe(Qn),definitionOperator:oe(Qn),typeOperator:oe(Qn),controlOperator:oe(Qn),punctuation:$u,separator:oe($u),bracket:js,angleBracket:oe(js),squareBracket:oe(js),paren:oe(js),brace:oe(js),content:Pn,heading:Br,heading1:oe(Br),heading2:oe(Br),heading3:oe(Br),heading4:oe(Br),heading5:oe(Br),heading6:oe(Br),contentSeparator:oe(Pn),list:oe(Pn),quote:oe(Pn),emphasis:oe(Pn),strong:oe(Pn),link:oe(Pn),monospace:oe(Pn),strikethrough:oe(Pn),inserted:oe(),deleted:oe(),changed:oe(),invalid:oe(),meta:ha,documentMeta:oe(ha),annotation:oe(ha),processingInstruction:oe(ha),definition:sn.defineModifier("definition"),constant:sn.defineModifier("constant"),function:sn.defineModifier("function"),standard:sn.defineModifier("standard"),local:sn.defineModifier("local"),special:sn.defineModifier("special")};for(let i in T){let t=T[i];t instanceof sn&&(t.name=i)}B0([{tag:T.link,class:"tok-link"},{tag:T.heading,class:"tok-heading"},{tag:T.emphasis,class:"tok-emphasis"},{tag:T.strong,class:"tok-strong"},{tag:T.keyword,class:"tok-keyword"},{tag:T.atom,class:"tok-atom"},{tag:T.bool,class:"tok-bool"},{tag:T.url,class:"tok-url"},{tag:T.labelName,class:"tok-labelName"},{tag:T.inserted,class:"tok-inserted"},{tag:T.deleted,class:"tok-deleted"},{tag:T.literal,class:"tok-literal"},{tag:T.string,class:"tok-string"},{tag:T.number,class:"tok-number"},{tag:[T.regexp,T.escape,T.special(T.string)],class:"tok-string2"},{tag:T.variableName,class:"tok-variableName"},{tag:T.local(T.variableName),class:"tok-variableName tok-local"},{tag:T.definition(T.variableName),class:"tok-variableName tok-definition"},{tag:T.special(T.variableName),class:"tok-variableName2"},{tag:T.definition(T.propertyName),class:"tok-propertyName tok-definition"},{tag:T.typeName,class:"tok-typeName"},{tag:T.namespace,class:"tok-namespace"},{tag:T.className,class:"tok-className"},{tag:T.macroName,class:"tok-macroName"},{tag:T.propertyName,class:"tok-propertyName"},{tag:T.operator,class:"tok-operator"},{tag:T.comment,class:"tok-comment"},{tag:T.meta,class:"tok-meta"},{tag:T.invalid,class:"tok-invalid"},{tag:T.punctuation,class:"tok-punctuation"}]);var lc;const us=new Ie;function $$(i){return pe.define({combine:i?t=>t.concat(i):void 0})}const Q$=new Ie;class bn{constructor(t,e,n=[],r=""){this.data=t,this.name=r,qe.prototype.hasOwnProperty("tree")||Object.defineProperty(qe.prototype,"tree",{get(){return Si(this)}}),this.parser=e,this.extension=[Er.of(this),qe.languageData.of((s,o,a)=>{let l=Zf(s,o,a),u=l.type.prop(us);if(!u)return[];let c=s.facet(u),h=l.type.prop(Q$);if(h){let d=l.resolve(o-l.from,a);for(let f of h)if(f.test(d,s)){let p=s.facet(f.facet);return f.type=="replace"?p:p.concat(c)}}return c})].concat(n)}isActiveAt(t,e,n=-1){return Zf(t,e,n).type.prop(us)==this.data}findRegions(t){let e=t.facet(Er);if(e?.data==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let n=[],r=(s,o)=>{if(s.prop(us)==this.data){n.push({from:o,to:o+s.length});return}let a=s.prop(Ie.mounted);if(a){if(a.tree.prop(us)==this.data){if(a.overlay)for(let l of a.overlay)n.push({from:l.from+o,to:l.to+o});else n.push({from:o,to:o+s.length});return}else if(a.overlay){let l=n.length;if(r(a.tree,a.overlay[0].from+o),n.length>l)return}}for(let l=0;l<s.children.length;l++){let u=s.children[l];u instanceof Zt&&r(u,s.positions[l]+o)}};return r(Si(t),0),n}get allowsNesting(){return!0}}bn.setState=Ze.define();function Zf(i,t,e){let n=i.facet(Er),r=Si(i).topNode;if(!n||n.allowsNesting)for(let s=r;s;s=s.enter(t,e,si.ExcludeBuffers))s.type.isTop&&(r=s);return r}class Ya extends bn{constructor(t,e,n){super(t,e,[],n),this.parser=e}static define(t){let e=$$(t.languageData);return new Ya(e,t.parser.configure({props:[us.add(n=>n.isTop?e:void 0)]}),t.name)}configure(t,e){return new Ya(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function Si(i){let t=i.field(bn.state,!1);return t?t.tree:Zt.empty}class P${constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let n=this.cursorPos-this.string.length;return t<n||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-n,e-n)}}let Is=null;class qa{constructor(t,e,n=[],r,s,o,a,l){this.parser=t,this.state=e,this.fragments=n,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(t,e,n){return new qa(t,e,[],Zt.empty,0,n,[],null)}startParse(){return this.parser.startParse(new P$(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=Zt.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof t=="number"){let r=Date.now()+t;t=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(Yr.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(Yr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=Is;Is=this;try{return t()}finally{Is=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=zf(t,e.from,e.to);return t}changes(t,e){let{fragments:n,tree:r,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!t.empty){let l=[];if(t.iterChangedRanges((u,c,h,d)=>l.push({fromA:u,toA:c,fromB:h,toB:d})),n=Yr.applyChanges(n,l),r=Zt.empty,s=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){a=[];for(let u of this.skipped){let c=t.mapPos(u.from,1),h=t.mapPos(u.to,-1);c<h&&a.push({from:c,to:h})}}}return new qa(this.parser,e,n,r,s,o,a,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:r,to:s}=this.skipped[n];r<t.to&&s>t.from&&(this.fragments=zf(this.fragments,r,s),this.skipped.splice(n--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends R0{createParse(e,n,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let l=Is;if(l){for(let u of r)l.tempSkipped.push(u);t&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,t]):t)}return this.parsedPos=o,new Zt(Ii.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return Is}}function zf(i,t,e){return Yr.applyChanges(i,[{fromA:t,toA:e,fromB:t,toB:e}])}class Ds{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),n=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,n)||e.takeTree(),new Ds(e)}static init(t){let e=Math.min(3e3,t.doc.length),n=qa.create(t.facet(Er).parser,t,{from:0,to:e});return n.work(20,e)||n.takeTree(),new Ds(n)}}bn.state=pi.define({create:Ds.init,update(i,t){for(let e of t.effects)if(e.is(bn.setState))return e.value;return t.startState.facet(Er)!=t.state.facet(Er)?Ds.init(t.state):i.apply(t)}});let F0=i=>{let t=setTimeout(()=>i(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(F0=i=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(i,{timeout:400})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const cc=typeof navigator<"u"&&(!((lc=navigator.scheduling)===null||lc===void 0)&&lc.isInputPending)?()=>navigator.scheduling.isInputPending():null,A$=Qt.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(bn.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(bn.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=F0(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:r}}=this.view,s=n.field(bn.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!cc?Math.max(25,t.timeRemaining()-5):1e9),a=s.context.treeLen<r&&n.doc.length>r+1e3,l=s.context.work(()=>cc&&cc()||Date.now()>o,r+(a?0:1e5));this.chunkBudget-=Date.now()-e,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:bn.setState.of(new Ds(s.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>zi(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Er=pe.define({combine(i){return i.length?i[0]:null},enables:i=>[bn.state,A$,ae.contentAttributes.compute([i],t=>{let e=t.facet(i);return e&&e.name?{"data-language":e.name}:{}})]}),E$=pe.define(),wl=pe.define({combine:i=>{if(!i.length)return"  ";let t=i[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return t}});function Va(i){let t=i.facet(wl);return t.charCodeAt(0)==9?i.tabSize*t.length:t.length}function bo(i,t){let e="",n=i.tabSize,r=i.facet(wl)[0];if(r=="	"){for(;t>=n;)e+="	",t-=n;r=" "}for(let s=0;s<t;s++)e+=r;return e}function Ah(i,t){i instanceof qe&&(i=new Sl(i));for(let n of i.state.facet(E$)){let r=n(i,t);if(r!==void 0)return r}let e=Si(i.state);return e.length>=t?T$(i,e,t):null}class Sl{constructor(t,e={}){this.state=t,this.options=e,this.unit=Va(t)}lineAt(t,e=1){let n=this.state.doc.lineAt(t),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=n.from&&r<=n.to?s&&r==t?{text:"",from:t}:(e<0?r<t:r<=t)?{text:n.text.slice(r-n.from),from:r}:{text:n.text.slice(0,r-n.from),from:n.from}:n}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:n,from:r}=this.lineAt(t,e);return n.slice(t-r,Math.min(n.length,t+100-r))}column(t,e=1){let{text:n,from:r}=this.lineAt(t,e),s=this.countColumn(n,t-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(n,n.search(/\S|$/))),s}countColumn(t,e=t.length){return Es(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:n,from:r}=this.lineAt(t,e),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Z0=new Ie;function T$(i,t,e){let n=t.resolveStack(e),r=t.resolveInner(e,-1).resolve(e,0).enterUnfinishedNodesBefore(e);if(r!=n.node){let s=[];for(let o=r;o&&!(o.from<n.node.from||o.to>n.node.to||o.from==n.node.from&&o.type==n.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)n={node:s[o],next:n}}return z0(n,i,e)}function z0(i,t,e){for(let n=i;n;n=n.next){let r=_$(n.node);if(r)return r(Eh.create(t,e,n))}return 0}function R$(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function _$(i){let t=i.type.prop(Z0);if(t)return t;let e=i.firstChild,n;if(e&&(n=e.type.prop(Ie.closedBy))){let r=i.lastChild,s=r&&n.indexOf(r.name)>-1;return o=>j0(o,!0,1,void 0,s&&!R$(o)?r.from:void 0)}return i.parent==null?M$:null}function M$(){return 0}class Eh extends Sl{constructor(t,e,n){super(t.state,t.options),this.base=t,this.pos=e,this.context=n}get node(){return this.context.node}static create(t,e,n){return new Eh(t,e,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let n=t.resolve(e.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(B$(n,t))break;e=this.state.doc.lineAt(n.from)}return this.lineIndent(e.from)}continue(){return z0(this.context.next,this.base,this.pos)}}function B$(i,t){for(let e=t;e;e=e.parent)if(i==e)return!0;return!1}function F$(i){let t=i.node,e=t.childAfter(t.from),n=t.lastChild;if(!e)return null;let r=i.options.simulateBreak,s=i.state.doc.lineAt(e.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let a=e.to;;){let l=t.childAfter(a);if(!l||l==n)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let u=/^ */.exec(s.text.slice(e.to-s.from))[0].length;return{from:e.from,to:e.to+u}}a=l.to}}function Z$({closing:i,align:t=!0,units:e=1}){return n=>j0(n,t,e,i)}function j0(i,t,e,n,r){let s=i.textAfter,o=s.match(/^\s*/)[0].length,a=n&&s.slice(o,o+n.length)==n||r==i.pos+o,l=t?F$(i):null;return l?a?i.column(l.from):i.column(l.to):i.baseIndent+(a?0:i.unit*e)}const z$=i=>i.baseIndent;function uc({except:i,units:t=1}={}){return e=>{let n=i&&i.test(e.textAfter);return e.baseIndent+(n?0:t*e.unit)}}const j$=200;function I0(){return qe.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let t=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!t.length)return i;let e=i.newDoc,{head:n}=i.newSelection.main,r=e.lineAt(n);if(n>r.from+j$)return i;let s=e.sliceString(r.from,n);if(!t.some(u=>u.test(s)))return i;let{state:o}=i,a=-1,l=[];for(let{head:u}of o.selection.ranges){let c=o.doc.lineAt(u);if(c.from==a)continue;a=c.from;let h=Ah(o,c.from);if(h==null)continue;let d=/^\s*/.exec(c.text)[0],f=bo(o,h);d!=f&&l.push({from:c.from,to:c.from+d.length,insert:f})}return l.length?[i,{changes:l,sequential:!0}]:i})}const I$=pe.define(),L0=new Ie;function L$(i){let t=i.firstChild,e=i.lastChild;return t&&t.to<e.from?{from:t.to,to:e.type.isError?i.to:e.from}:null}function X$(i,t,e){let n=Si(i);if(n.length<e)return null;let r=n.resolveStack(e,1),s=null;for(let o=r;o;o=o.next){let a=o.node;if(a.to<=e||a.from>e)continue;if(s&&a.from<t)break;let l=a.type.prop(L0);if(l&&(a.to<n.length-50||n.length==i.doc.length||!N$(a))){let u=l(a,i);u&&u.from<=e&&u.from>=t&&u.to>e&&(s=u)}}return s}function N$(i){let t=i.lastChild;return t&&t.to==i.to&&t.type.isError}function Ga(i,t,e){for(let n of i.facet(I$)){let r=n(i,t,e);if(r)return r}return X$(i,t,e)}function X0(i,t){let e=t.mapPos(i.from,1),n=t.mapPos(i.to,-1);return e>=n?void 0:{from:e,to:n}}const vl=Ze.define({map:X0}),zo=Ze.define({map:X0});function N0(i){let t=[];for(let{head:e}of i.state.selection.ranges)t.some(n=>n.from<=e&&n.to>=e)||t.push(i.lineBlockAt(e));return t}const Kr=pi.define({create(){return Se.none},update(i,t){t.isUserEvent("delete")&&t.changes.iterChangedRanges((e,n)=>i=jf(i,e,n)),i=i.map(t.changes);for(let e of t.effects)if(e.is(vl)&&!W$(i,e.value.from,e.value.to)){let{preparePlaceholder:n}=t.state.facet(q0),r=n?Se.replace({widget:new K$(n(t.state,e.value))}):If;i=i.update({add:[r.range(e.value.from,e.value.to)]})}else e.is(zo)&&(i=i.update({filter:(n,r)=>e.value.from!=n||e.value.to!=r,filterFrom:e.value.from,filterTo:e.value.to}));return t.selection&&(i=jf(i,t.selection.main.head)),i},provide:i=>ae.decorations.from(i),toJSON(i,t){let e=[];return i.between(0,t.doc.length,(n,r)=>{e.push(n,r)}),e},fromJSON(i){if(!Array.isArray(i)||i.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let e=0;e<i.length;){let n=i[e++],r=i[e++];if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid JSON for fold state");t.push(If.range(n,r))}return Se.set(t,!0)}});function jf(i,t,e=t){let n=!1;return i.between(t,e,(r,s)=>{r<e&&s>t&&(n=!0)}),n?i.update({filterFrom:t,filterTo:e,filter:(r,s)=>r>=e||s<=t}):i}function Ua(i,t,e){var n;let r=null;return(n=i.field(Kr,!1))===null||n===void 0||n.between(t,e,(s,o)=>{(!r||r.from>s)&&(r={from:s,to:o})}),r}function W$(i,t,e){let n=!1;return i.between(t,t,(r,s)=>{r==t&&s==e&&(n=!0)}),n}function W0(i,t){return i.field(Kr,!1)?t:t.concat(Ze.appendConfig.of(V0()))}const Y$=i=>{for(let t of N0(i)){let e=Ga(i.state,t.from,t.to);if(e)return i.dispatch({effects:W0(i.state,[vl.of(e),Y0(i,e)])}),!0}return!1},q$=i=>{if(!i.state.field(Kr,!1))return!1;let t=[];for(let e of N0(i)){let n=Ua(i.state,e.from,e.to);n&&t.push(zo.of(n),Y0(i,n,!1))}return t.length&&i.dispatch({effects:t}),t.length>0};function Y0(i,t,e=!0){let n=i.state.doc.lineAt(t.from).number,r=i.state.doc.lineAt(t.to).number;return ae.announce.of(`${i.state.phrase(e?"Folded lines":"Unfolded lines")} ${n} ${i.state.phrase("to")} ${r}.`)}const V$=i=>{let{state:t}=i,e=[];for(let n=0;n<t.doc.length;){let r=i.lineBlockAt(n),s=Ga(t,r.from,r.to);s&&e.push(vl.of(s)),n=(s?i.lineBlockAt(s.to):r).to+1}return e.length&&i.dispatch({effects:W0(i.state,e)}),!!e.length},G$=i=>{let t=i.state.field(Kr,!1);if(!t||!t.size)return!1;let e=[];return t.between(0,i.state.doc.length,(n,r)=>{e.push(zo.of({from:n,to:r}))}),i.dispatch({effects:e}),!0},U$=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Y$},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:q$},{key:"Ctrl-Alt-[",run:V$},{key:"Ctrl-Alt-]",run:G$}],H$={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},q0=pe.define({combine(i){return zn(i,H$)}});function V0(i){return[Kr,t3]}function G0(i,t){let{state:e}=i,n=e.facet(q0),r=o=>{let a=i.lineBlockAt(i.posAtDOM(o.target)),l=Ua(i.state,a.from,a.to);l&&i.dispatch({effects:zo.of(l)}),o.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(i,r,t);let s=document.createElement("span");return s.textContent=n.placeholderText,s.setAttribute("aria-label",e.phrase("folded code")),s.title=e.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=r,s}const If=Se.replace({widget:new class extends ar{toDOM(i){return G0(i,null)}}});class K$ extends ar{constructor(t){super(),this.value=t}eq(t){return this.value==t.value}toDOM(t){return G0(t,this.value)}}const J$={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class hc extends er{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}function e3(i={}){let t={...J$,...i},e=new hc(t,!0),n=new hc(t,!1),r=Qt.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Er)!=o.state.facet(Er)||o.startState.field(Kr,!1)!=o.state.field(Kr,!1)||Si(o.startState)!=Si(o.state)||t.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let a=new Kn;for(let l of o.viewportLineBlocks){let u=Ua(o.state,l.from,l.to)?n:Ga(o.state,l.from,l.to)?e:null;u&&a.add(l.from,l.from,u)}return a.finish()}}),{domEventHandlers:s}=t;return[r,n$({class:"cm-foldGutter",markers(o){var a;return((a=o.plugin(r))===null||a===void 0?void 0:a.markers)||Ge.empty},initialSpacer(){return new hc(t,!1)},domEventHandlers:{...s,click:(o,a,l)=>{if(s.click&&s.click(o,a,l))return!0;let u=Ua(o.state,a.from,a.to);if(u)return o.dispatch({effects:zo.of(u)}),!0;let c=Ga(o.state,a.from,a.to);return c?(o.dispatch({effects:vl.of(c)}),!0):!1}}}),V0()]}const t3=ae.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Ts{constructor(t,e){this.specs=t;let n;function r(a){let l=$r.newName();return(n||(n=Object.create(null)))["."+l]=a,l}const s=typeof e.all=="string"?e.all:e.all?r(e.all):void 0,o=e.scope;this.scope=o instanceof bn?a=>a.prop(us)==o.data:o?a=>a==o:void 0,this.style=B0(t.map(a=>({tag:a.tag,class:a.class||r(Object.assign({},a,{tag:null}))})),{all:s}).style,this.module=n?new $r(n):null,this.themeType=e.themeType}static define(t,e){return new Ts(t,e||{})}}const Qu=pe.define(),U0=pe.define({combine(i){return i.length?[i[0]]:null}});function dc(i){let t=i.facet(Qu);return t.length?t:i.facet(U0)}function kl(i,t){let e=[n3],n;return i instanceof Ts&&(i.module&&e.push(ae.styleModule.of(i.module)),n=i.themeType),t?.fallback?e.push(U0.of(i)):n?e.push(Qu.computeN([ae.darkTheme],r=>r.facet(ae.darkTheme)==(n=="dark")?[i]:[])):e.push(Qu.of(i)),e}class i3{constructor(t){this.markCache=Object.create(null),this.tree=Si(t.state),this.decorations=this.buildDeco(t,dc(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=Si(t.state),n=dc(t.state),r=n!=dc(t.startState),{viewport:s}=t.view,o=t.changes.mapPos(this.decoratedTo,1);e.length<s.to&&!r&&e.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=o):(e!=this.tree||t.viewportChanged||r)&&(this.tree=e,this.decorations=this.buildDeco(t.view,n),this.decoratedTo=s.to)}buildDeco(t,e){if(!e||!this.tree.length)return Se.none;let n=new Kn;for(let{from:r,to:s}of t.visibleRanges)k$(this.tree,e,(o,a,l)=>{n.add(o,a,this.markCache[l]||(this.markCache[l]=Se.mark({class:l})))},r,s);return n.finish()}}const n3=Jr.high(Qt.fromClass(i3,{decorations:i=>i.decorations})),H0=Ts.define([{tag:T.meta,color:"#404740"},{tag:T.link,textDecoration:"underline"},{tag:T.heading,textDecoration:"underline",fontWeight:"bold"},{tag:T.emphasis,fontStyle:"italic"},{tag:T.strong,fontWeight:"bold"},{tag:T.strikethrough,textDecoration:"line-through"},{tag:T.keyword,color:"#708"},{tag:[T.atom,T.bool,T.url,T.contentSeparator,T.labelName],color:"#219"},{tag:[T.literal,T.inserted],color:"#164"},{tag:[T.string,T.deleted],color:"#a11"},{tag:[T.regexp,T.escape,T.special(T.string)],color:"#e40"},{tag:T.definition(T.variableName),color:"#00f"},{tag:T.local(T.variableName),color:"#30a"},{tag:[T.typeName,T.namespace],color:"#085"},{tag:T.className,color:"#167"},{tag:[T.special(T.variableName),T.macroName],color:"#256"},{tag:T.definition(T.propertyName),color:"#00c"},{tag:T.comment,color:"#940"},{tag:T.invalid,color:"#f00"}]),r3=ae.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),K0=1e4,J0="()[]{}",eO=pe.define({combine(i){return zn(i,{afterCursor:!0,brackets:J0,maxScanDistance:K0,renderMatch:a3})}}),s3=Se.mark({class:"cm-matchingBracket"}),o3=Se.mark({class:"cm-nonmatchingBracket"});function a3(i){let t=[],e=i.matched?s3:o3;return t.push(e.range(i.start.from,i.start.to)),i.end&&t.push(e.range(i.end.from,i.end.to)),t}const l3=pi.define({create(){return Se.none},update(i,t){if(!t.docChanged&&!t.selection)return i;let e=[],n=t.state.facet(eO);for(let r of t.state.selection.ranges){if(!r.empty)continue;let s=_n(t.state,r.head,-1,n)||r.head>0&&_n(t.state,r.head-1,1,n)||n.afterCursor&&(_n(t.state,r.head,1,n)||r.head<t.state.doc.length&&_n(t.state,r.head+1,-1,n));s&&(e=e.concat(n.renderMatch(s,t.state)))}return Se.set(e,!0)},provide:i=>ae.decorations.from(i)}),c3=[l3,r3];function tO(i={}){return[eO.of(i),c3]}const u3=new Ie;function Pu(i,t,e){let n=i.prop(t<0?Ie.openedBy:Ie.closedBy);if(n)return n;if(i.name.length==1){let r=e.indexOf(i.name);if(r>-1&&r%2==(t<0?1:0))return[e[r+t]]}return null}function Au(i){let t=i.type.prop(u3);return t?t(i.node):i}function _n(i,t,e,n={}){let r=n.maxScanDistance||K0,s=n.brackets||J0,o=Si(i),a=o.resolveInner(t,e);for(let l=a;l;l=l.parent){let u=Pu(l.type,e,s);if(u&&l.from<l.to){let c=Au(l);if(c&&(e>0?t>=c.from&&t<c.to:t>c.from&&t<=c.to))return h3(i,t,e,l,c,u,s)}}return d3(i,t,e,o,a.type,r,s)}function h3(i,t,e,n,r,s,o){let a=n.parent,l={from:r.from,to:r.to},u=0,c=a?.cursor();if(c&&(e<0?c.childBefore(n.from):c.childAfter(n.to)))do if(e<0?c.to<=n.from:c.from>=n.to){if(u==0&&s.indexOf(c.type.name)>-1&&c.from<c.to){let h=Au(c);return{start:l,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(Pu(c.type,e,o))u++;else if(Pu(c.type,-e,o)){if(u==0){let h=Au(c);return{start:l,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}u--}}while(e<0?c.prevSibling():c.nextSibling());return{start:l,matched:!1}}function d3(i,t,e,n,r,s,o){let a=e<0?i.sliceDoc(t-1,t):i.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=e>0)return null;let u={from:e<0?t-1:t,to:e>0?t+1:t},c=i.doc.iterRange(t,e>0?i.doc.length:0),h=0;for(let d=0;!c.next().done&&d<=s;){let f=c.value;e<0&&(d+=f.length);let p=t+d*e;for(let g=e>0?0:f.length-1,m=e>0?f.length:-1;g!=m;g+=e){let O=o.indexOf(f[g]);if(!(O<0||n.resolveInner(p+g,1).type!=r))if(O%2==0==e>0)h++;else{if(h==1)return{start:u,end:{from:p+g,to:p+g+1},matched:O>>1==l>>1};h--}}e>0&&(d+=f.length)}return c.done?{start:u,matched:!1}:null}const f3=Object.create(null),Lf=[Ii.none],Xf=[],Nf=Object.create(null),p3=Object.create(null);for(let[i,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])p3[i]=g3(f3,t);function fc(i,t){Xf.indexOf(i)>-1||(Xf.push(i),console.warn(t))}function g3(i,t){let e=[];for(let a of t.split(" ")){let l=[];for(let u of a.split(".")){let c=i[u]||T[u];c?typeof c=="function"?l.length?l=l.map(c):fc(u,`Modifier ${u} used at start of tag`):l.length?fc(u,`Tag ${u} used as modifier`):l=Array.isArray(c)?c:[c]:fc(u,`Unknown highlighting tag ${u}`)}for(let u of l)e.push(u)}if(!e.length)return 0;let n=t.replace(/ /g,"_"),r=n+" "+e.map(a=>a.id),s=Nf[r];if(s)return s.id;let o=Nf[r]=Ii.define({id:Lf.length,name:n,props:[_0({[n]:e})]});return Lf.push(o),o.id}mt.RTL,mt.LTR;const m3=i=>{let{state:t}=i,e=t.doc.lineAt(t.selection.main.from),n=Rh(i.state,e.from);return n.line?O3(i):n.block?y3(i):!1};function Th(i,t){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let r=i(t,e);return r?(n(e.update(r)),!0):!1}}const O3=Th(S3,0),b3=Th(iO,0),y3=Th((i,t)=>iO(i,t,w3(t)),0);function Rh(i,t){let e=i.languageDataAt("commentTokens",t,1);return e.length?e[0]:{}}const Ls=50;function x3(i,{open:t,close:e},n,r){let s=i.sliceDoc(n-Ls,n),o=i.sliceDoc(r,r+Ls),a=/\s*$/.exec(s)[0].length,l=/^\s*/.exec(o)[0].length,u=s.length-a;if(s.slice(u-t.length,u)==t&&o.slice(l,l+e.length)==e)return{open:{pos:n-a,margin:a&&1},close:{pos:r+l,margin:l&&1}};let c,h;r-n<=2*Ls?c=h=i.sliceDoc(n,r):(c=i.sliceDoc(n,n+Ls),h=i.sliceDoc(r-Ls,r));let d=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(h)[0].length,p=h.length-f-e.length;return c.slice(d,d+t.length)==t&&h.slice(p,p+e.length)==e?{open:{pos:n+d+t.length,margin:/\s/.test(c.charAt(d+t.length))?1:0},close:{pos:r-f-e.length,margin:/\s/.test(h.charAt(p-1))?1:0}}:null}function w3(i){let t=[];for(let e of i.selection.ranges){let n=i.doc.lineAt(e.from),r=e.to<=n.to?n:i.doc.lineAt(e.to);r.from>n.from&&r.from==e.to&&(r=e.to==n.to+1?n:i.doc.lineAt(e.to-1));let s=t.length-1;s>=0&&t[s].to>n.from?t[s].to=r.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:r.to})}return t}function iO(i,t,e=t.selection.ranges){let n=e.map(s=>Rh(t,s.from).block);if(!n.every(s=>s))return null;let r=e.map((s,o)=>x3(t,n[o],s.from,s.to));if(i!=2&&!r.every(s=>s))return{changes:t.changes(e.map((s,o)=>r[o]?[]:[{from:s.from,insert:n[o].open+" "},{from:s.to,insert:" "+n[o].close}]))};if(i!=1&&r.some(s=>s)){let s=[];for(let o=0,a;o<r.length;o++)if(a=r[o]){let l=n[o],{open:u,close:c}=a;s.push({from:u.pos-l.open.length,to:u.pos+u.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:s}}return null}function S3(i,t,e=t.selection.ranges){let n=[],r=-1;for(let{from:s,to:o}of e){let a=n.length,l=1e9,u=Rh(t,s).line;if(u){for(let c=s;c<=o;){let h=t.doc.lineAt(c);if(h.from>r&&(s==o||o>h.from)){r=h.from;let d=/^\s*/.exec(h.text)[0].length,f=d==h.length,p=h.text.slice(d,d+u.length)==u?d:-1;d<h.text.length&&d<l&&(l=d),n.push({line:h,comment:p,token:u,indent:d,empty:f,single:!1})}c=h.to+1}if(l<1e9)for(let c=a;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=l);n.length==a+1&&(n[a].single=!0)}}if(i!=2&&n.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:a,token:l,indent:u,empty:c,single:h}of n)(h||!c)&&s.push({from:a.from+u,insert:l+" "});let o=t.changes(s);return{changes:o,selection:t.selection.map(o,1)}}else if(i!=1&&n.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:a,token:l}of n)if(a>=0){let u=o.from+a,c=u+l.length;o.text[c-o.from]==" "&&c++,s.push({from:u,to:c})}return{changes:s}}return null}const Eu=Zn.define(),v3=Zn.define(),k3=pe.define(),nO=pe.define({combine(i){return zn(i,{minDepth:100,newGroupDelay:500,joinToEvent:(t,e)=>e},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,e)=>(n,r)=>t(n,r)||e(n,r)})}}),rO=pi.define({create(){return Mn.empty},update(i,t){let e=t.state.facet(nO),n=t.annotation(Eu);if(n){let l=ji.fromTransaction(t,n.selection),u=n.side,c=u==0?i.undone:i.done;return l?c=Ha(c,c.length,e.minDepth,l):c=lO(c,t.startState.selection),new Mn(u==0?n.rest:c,u==0?c:n.rest)}let r=t.annotation(v3);if((r=="full"||r=="before")&&(i=i.isolate()),t.annotation(Gt.addToHistory)===!1)return t.changes.empty?i:i.addMapping(t.changes.desc);let s=ji.fromTransaction(t),o=t.annotation(Gt.time),a=t.annotation(Gt.userEvent);return s?i=i.addChanges(s,o,a,e,t):t.selection&&(i=i.addSelection(t.startState.selection,o,a,e.newGroupDelay)),(r=="full"||r=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(t=>t.toJSON()),undone:i.undone.map(t=>t.toJSON())}},fromJSON(i){return new Mn(i.done.map(ji.fromJSON),i.undone.map(ji.fromJSON))}});function sO(i={}){return[rO,nO.of(i),ae.domEventHandlers({beforeinput(t,e){let n=t.inputType=="historyUndo"?oO:t.inputType=="historyRedo"?Tu:null;return n?(t.preventDefault(),n(e)):!1}})]}function Cl(i,t){return function({state:e,dispatch:n}){if(!t&&e.readOnly)return!1;let r=e.field(rO,!1);if(!r)return!1;let s=r.pop(i,e,t);return s?(n(s),!0):!1}}const oO=Cl(0,!1),Tu=Cl(1,!1),C3=Cl(0,!0),D3=Cl(1,!0);class ji{constructor(t,e,n,r,s){this.changes=t,this.effects=e,this.mapped=n,this.startSelection=r,this.selectionsAfter=s}setSelAfter(t){return new ji(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,e,n;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(e=this.mapped)===null||e===void 0?void 0:e.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(t){return new ji(t.changes&&Vt.fromJSON(t.changes),[],t.mapped&&Bn.fromJSON(t.mapped),t.startSelection&&U.fromJSON(t.startSelection),t.selectionsAfter.map(U.fromJSON))}static fromTransaction(t,e){let n=on;for(let r of t.startState.facet(k3)){let s=r(t);s.length&&(n=n.concat(s))}return!n.length&&t.changes.empty?null:new ji(t.changes.invert(t.startState.doc),n,void 0,e||t.startState.selection,on)}static selection(t){return new ji(void 0,on,void 0,void 0,t)}}function Ha(i,t,e,n){let r=t+1>e+20?t-e-1:0,s=i.slice(r,t);return s.push(n),s}function $3(i,t){let e=[],n=!1;return i.iterChangedRanges((r,s)=>e.push(r,s)),t.iterChangedRanges((r,s,o,a)=>{for(let l=0;l<e.length;){let u=e[l++],c=e[l++];a>=u&&o<=c&&(n=!0)}}),n}function Q3(i,t){return i.ranges.length==t.ranges.length&&i.ranges.filter((e,n)=>e.empty!=t.ranges[n].empty).length===0}function aO(i,t){return i.length?t.length?i.concat(t):i:t}const on=[],P3=200;function lO(i,t){if(i.length){let e=i[i.length-1],n=e.selectionsAfter.slice(Math.max(0,e.selectionsAfter.length-P3));return n.length&&n[n.length-1].eq(t)?i:(n.push(t),Ha(i,i.length-1,1e9,e.setSelAfter(n)))}else return[ji.selection([t])]}function A3(i){let t=i[i.length-1],e=i.slice();return e[i.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),e}function pc(i,t){if(!i.length)return i;let e=i.length,n=on;for(;e;){let r=E3(i[e-1],t,n);if(r.changes&&!r.changes.empty||r.effects.length){let s=i.slice(0,e);return s[e-1]=r,s}else t=r.mapped,e--,n=r.selectionsAfter}return n.length?[ji.selection(n)]:on}function E3(i,t,e){let n=aO(i.selectionsAfter.length?i.selectionsAfter.map(a=>a.map(t)):on,e);if(!i.changes)return ji.selection(n);let r=i.changes.map(t),s=t.mapDesc(i.changes,!0),o=i.mapped?i.mapped.composeDesc(s):s;return new ji(r,Ze.mapEffects(i.effects,t),o,i.startSelection.map(s),n)}const T3=/^(input\.type|delete)($|\.)/;class Mn{constructor(t,e,n=0,r=void 0){this.done=t,this.undone=e,this.prevTime=n,this.prevUserEvent=r}isolate(){return this.prevTime?new Mn(this.done,this.undone):this}addChanges(t,e,n,r,s){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&t.changes&&(!n||T3.test(n))&&(!a.selectionsAfter.length&&e-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,$3(a.changes,t.changes))||n=="input.type.compose")?o=Ha(o,o.length-1,r.minDepth,new ji(t.changes.compose(a.changes),aO(Ze.mapEffects(t.effects,a.changes),a.effects),a.mapped,a.startSelection,on)):o=Ha(o,o.length,r.minDepth,t),new Mn(o,on,e,n)}addSelection(t,e,n,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:on;return s.length>0&&e-this.prevTime<r&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Q3(s[s.length-1],t)?this:new Mn(lO(this.done,t),this.undone,e,n)}addMapping(t){return new Mn(pc(this.done,t),pc(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,e,n){let r=t==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1],o=s.selectionsAfter[0]||e.selection;if(n&&s.selectionsAfter.length)return e.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Eu.of({side:t,rest:A3(r),selection:o}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let a=r.length==1?on:r.slice(0,r.length-1);return s.mapped&&(a=pc(a,s.mapped)),e.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Eu.of({side:t,rest:a,selection:o}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}Mn.empty=new Mn(on,on);const cO=[{key:"Mod-z",run:oO,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Tu,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Tu,preventDefault:!0},{key:"Mod-u",run:C3,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:D3,preventDefault:!0}];function Rs(i,t){return U.create(i.ranges.map(t),i.mainIndex)}function Sn(i,t){return i.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function vn({state:i,dispatch:t},e){let n=Rs(i.selection,e);return n.eq(i.selection,!0)?!1:(t(Sn(i,n)),!0)}function Dl(i,t){return U.cursor(t?i.to:i.from)}function uO(i,t){return vn(i,e=>e.empty?i.moveByChar(e,t):Dl(e,t))}function vi(i){return i.textDirectionAt(i.state.selection.main.head)==mt.LTR}const hO=i=>uO(i,!vi(i)),dO=i=>uO(i,vi(i));function fO(i,t){return vn(i,e=>e.empty?i.moveByGroup(e,t):Dl(e,t))}const R3=i=>fO(i,!vi(i)),_3=i=>fO(i,vi(i));function M3(i,t,e){if(t.type.prop(e))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(i.sliceDoc(t.from,t.to)))||t.firstChild}function $l(i,t,e){let n=Si(i).resolveInner(t.head),r=e?Ie.closedBy:Ie.openedBy;for(let l=t.head;;){let u=e?n.childAfter(l):n.childBefore(l);if(!u)break;M3(i,u,r)?n=u:l=e?u.to:u.from}let s=n.type.prop(r),o,a;return s&&(o=e?_n(i,n.from,1):_n(i,n.to,-1))&&o.matched?a=e?o.end.to:o.end.from:a=e?n.to:n.from,U.cursor(a,e?-1:1)}const B3=i=>vn(i,t=>$l(i.state,t,!vi(i))),F3=i=>vn(i,t=>$l(i.state,t,vi(i)));function pO(i,t){return vn(i,e=>{if(!e.empty)return Dl(e,t);let n=i.moveVertically(e,t);return n.head!=e.head?n:i.moveToLineBoundary(e,t)})}const gO=i=>pO(i,!1),mO=i=>pO(i,!0);function OO(i){let t=i.scrollDOM.clientHeight<i.scrollDOM.scrollHeight-2,e=0,n=0,r;if(t){for(let s of i.state.facet(ae.scrollMargins)){let o=s(i);o?.top&&(e=Math.max(o?.top,e)),o?.bottom&&(n=Math.max(o?.bottom,n))}r=i.scrollDOM.clientHeight-e-n}else r=(i.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:e,marginBottom:n,selfScroll:t,height:Math.max(i.defaultLineHeight,r-5)}}function bO(i,t){let e=OO(i),{state:n}=i,r=Rs(n.selection,o=>o.empty?i.moveVertically(o,t,e.height):Dl(o,t));if(r.eq(n.selection))return!1;let s;if(e.selfScroll){let o=i.coordsAtPos(n.selection.main.head),a=i.scrollDOM.getBoundingClientRect(),l=a.top+e.marginTop,u=a.bottom-e.marginBottom;o&&o.top>l&&o.bottom<u&&(s=ae.scrollIntoView(r.main.head,{y:"start",yMargin:o.top-l}))}return i.dispatch(Sn(n,r),{effects:s}),!0}const Wf=i=>bO(i,!1),Ru=i=>bO(i,!0);function _r(i,t,e){let n=i.lineBlockAt(t.head),r=i.moveToLineBoundary(t,e);if(r.head==t.head&&r.head!=(e?n.to:n.from)&&(r=i.moveToLineBoundary(t,e,!1)),!e&&r.head==n.from&&n.length){let s=/^\s*/.exec(i.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;s&&t.head!=n.from+s&&(r=U.cursor(n.from+s))}return r}const Z3=i=>vn(i,t=>_r(i,t,!0)),z3=i=>vn(i,t=>_r(i,t,!1)),j3=i=>vn(i,t=>_r(i,t,!vi(i))),I3=i=>vn(i,t=>_r(i,t,vi(i))),L3=i=>vn(i,t=>U.cursor(i.lineBlockAt(t.head).from,1)),X3=i=>vn(i,t=>U.cursor(i.lineBlockAt(t.head).to,-1));function N3(i,t,e){let n=!1,r=Rs(i.selection,s=>{let o=_n(i,s.head,-1)||_n(i,s.head,1)||s.head>0&&_n(i,s.head-1,1)||s.head<i.doc.length&&_n(i,s.head+1,-1);if(!o||!o.end)return s;n=!0;let a=o.start.from==s.head?o.end.to:o.end.from;return U.cursor(a)});return n?(t(Sn(i,r)),!0):!1}const W3=({state:i,dispatch:t})=>N3(i,t);function fn(i,t){let e=Rs(i.state.selection,n=>{let r=t(n);return U.range(n.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return e.eq(i.state.selection)?!1:(i.dispatch(Sn(i.state,e)),!0)}function yO(i,t){return fn(i,e=>i.moveByChar(e,t))}const xO=i=>yO(i,!vi(i)),wO=i=>yO(i,vi(i));function SO(i,t){return fn(i,e=>i.moveByGroup(e,t))}const Y3=i=>SO(i,!vi(i)),q3=i=>SO(i,vi(i)),V3=i=>fn(i,t=>$l(i.state,t,!vi(i))),G3=i=>fn(i,t=>$l(i.state,t,vi(i)));function vO(i,t){return fn(i,e=>i.moveVertically(e,t))}const kO=i=>vO(i,!1),CO=i=>vO(i,!0);function DO(i,t){return fn(i,e=>i.moveVertically(e,t,OO(i).height))}const Yf=i=>DO(i,!1),qf=i=>DO(i,!0),U3=i=>fn(i,t=>_r(i,t,!0)),H3=i=>fn(i,t=>_r(i,t,!1)),K3=i=>fn(i,t=>_r(i,t,!vi(i))),J3=i=>fn(i,t=>_r(i,t,vi(i))),e5=i=>fn(i,t=>U.cursor(i.lineBlockAt(t.head).from)),t5=i=>fn(i,t=>U.cursor(i.lineBlockAt(t.head).to)),Vf=({state:i,dispatch:t})=>(t(Sn(i,{anchor:0})),!0),Gf=({state:i,dispatch:t})=>(t(Sn(i,{anchor:i.doc.length})),!0),Uf=({state:i,dispatch:t})=>(t(Sn(i,{anchor:i.selection.main.anchor,head:0})),!0),Hf=({state:i,dispatch:t})=>(t(Sn(i,{anchor:i.selection.main.anchor,head:i.doc.length})),!0),i5=({state:i,dispatch:t})=>(t(i.update({selection:{anchor:0,head:i.doc.length},userEvent:"select"})),!0),n5=({state:i,dispatch:t})=>{let e=Ql(i).map(({from:n,to:r})=>U.range(n,Math.min(r+1,i.doc.length)));return t(i.update({selection:U.create(e),userEvent:"select"})),!0},r5=({state:i,dispatch:t})=>{let e=Rs(i.selection,n=>{let r=Si(i),s=r.resolveStack(n.from,1);if(n.empty){let o=r.resolveStack(n.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:a}=o;if((a.from<n.from&&a.to>=n.to||a.to>n.to&&a.from<=n.from)&&o.next)return U.range(a.to,a.from)}return n});return e.eq(i.selection)?!1:(t(Sn(i,e)),!0)};function $O(i,t){let{state:e}=i,n=e.selection,r=e.selection.ranges.slice();for(let s of e.selection.ranges){let o=e.doc.lineAt(s.head);if(t?o.to<i.state.doc.length:o.from>0)for(let a=s;;){let l=i.moveVertically(a,t);if(l.head<o.from||l.head>o.to){r.some(u=>u.head==l.head)||r.push(l);break}else{if(l.head==a.head)break;a=l}}}return r.length==n.ranges.length?!1:(i.dispatch(Sn(e,U.create(r,r.length-1))),!0)}const s5=i=>$O(i,!1),o5=i=>$O(i,!0),a5=({state:i,dispatch:t})=>{let e=i.selection,n=null;return e.ranges.length>1?n=U.create([e.main]):e.main.empty||(n=U.create([U.cursor(e.main.head)])),n?(t(Sn(i,n)),!0):!1};function jo(i,t){if(i.state.readOnly)return!1;let e="delete.selection",{state:n}=i,r=n.changeByRange(s=>{let{from:o,to:a}=s;if(o==a){let l=t(s);l<o?(e="delete.backward",l=da(i,l,!1)):l>o&&(e="delete.forward",l=da(i,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=da(i,o,!1),a=da(i,a,!0);return o==a?{range:s}:{changes:{from:o,to:a},range:U.cursor(o,o<s.head?-1:1)}});return r.changes.empty?!1:(i.dispatch(n.update(r,{scrollIntoView:!0,userEvent:e,effects:e=="delete.selection"?ae.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function da(i,t,e){if(i instanceof ae)for(let n of i.state.facet(ae.atomicRanges).map(r=>r(i)))n.between(t,t,(r,s)=>{r<t&&s>t&&(t=e?s:r)});return t}const QO=(i,t,e)=>jo(i,n=>{let r=n.from,{state:s}=i,o=s.doc.lineAt(r),a,l;if(e&&!t&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,r-o.from))){if(a[a.length-1]=="	")return r-1;let u=Es(a,s.tabSize),c=u%Va(s)||Va(s);for(let h=0;h<c&&a[a.length-1-h]==" ";h++)r--;l=r}else l=fi(o.text,r-o.from,t,t)+o.from,l==r&&o.number!=(t?s.doc.lines:1)?l+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,r-o.from))&&(l=fi(o.text,l-o.from,!1,!1)+o.from);return l}),_u=i=>QO(i,!1,!0),PO=i=>QO(i,!0,!1),AO=(i,t)=>jo(i,e=>{let n=e.head,{state:r}=i,s=r.doc.lineAt(n),o=r.charCategorizer(n);for(let a=null;;){if(n==(t?s.to:s.from)){n==e.head&&s.number!=(t?r.doc.lines:1)&&(n+=t?1:-1);break}let l=fi(s.text,n-s.from,t)+s.from,u=s.text.slice(Math.min(n,l)-s.from,Math.max(n,l)-s.from),c=o(u);if(a!=null&&c!=a)break;(u!=" "||n!=e.head)&&(a=c),n=l}return n}),EO=i=>AO(i,!1),l5=i=>AO(i,!0),c5=i=>jo(i,t=>{let e=i.lineBlockAt(t.head).to;return t.head<e?e:Math.min(i.state.doc.length,t.head+1)}),u5=i=>jo(i,t=>{let e=i.moveToLineBoundary(t,!1).head;return t.head>e?e:Math.max(0,t.head-1)}),h5=i=>jo(i,t=>{let e=i.moveToLineBoundary(t,!0).head;return t.head<e?e:Math.min(i.state.doc.length,t.head+1)}),d5=({state:i,dispatch:t})=>{if(i.readOnly)return!1;let e=i.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Ue.of(["",""])},range:U.cursor(n.from)}));return t(i.update(e,{scrollIntoView:!0,userEvent:"input"})),!0},f5=({state:i,dispatch:t})=>{if(i.readOnly)return!1;let e=i.changeByRange(n=>{if(!n.empty||n.from==0||n.from==i.doc.length)return{range:n};let r=n.from,s=i.doc.lineAt(r),o=r==s.from?r-1:fi(s.text,r-s.from,!1)+s.from,a=r==s.to?r+1:fi(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:a,insert:i.doc.slice(r,a).append(i.doc.slice(o,r))},range:U.cursor(a)}});return e.changes.empty?!1:(t(i.update(e,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Ql(i){let t=[],e=-1;for(let n of i.selection.ranges){let r=i.doc.lineAt(n.from),s=i.doc.lineAt(n.to);if(!n.empty&&n.to==s.from&&(s=i.doc.lineAt(n.to-1)),e>=r.number){let o=t[t.length-1];o.to=s.to,o.ranges.push(n)}else t.push({from:r.from,to:s.to,ranges:[n]});e=s.number+1}return t}function TO(i,t,e){if(i.readOnly)return!1;let n=[],r=[];for(let s of Ql(i)){if(e?s.to==i.doc.length:s.from==0)continue;let o=i.doc.lineAt(e?s.to+1:s.from-1),a=o.length+1;if(e){n.push({from:s.to,to:o.to},{from:s.from,insert:o.text+i.lineBreak});for(let l of s.ranges)r.push(U.range(Math.min(i.doc.length,l.anchor+a),Math.min(i.doc.length,l.head+a)))}else{n.push({from:o.from,to:s.from},{from:s.to,insert:i.lineBreak+o.text});for(let l of s.ranges)r.push(U.range(l.anchor-a,l.head-a))}}return n.length?(t(i.update({changes:n,scrollIntoView:!0,selection:U.create(r,i.selection.mainIndex),userEvent:"move.line"})),!0):!1}const p5=({state:i,dispatch:t})=>TO(i,t,!1),g5=({state:i,dispatch:t})=>TO(i,t,!0);function RO(i,t,e){if(i.readOnly)return!1;let n=[];for(let r of Ql(i))e?n.push({from:r.from,insert:i.doc.slice(r.from,r.to)+i.lineBreak}):n.push({from:r.to,insert:i.lineBreak+i.doc.slice(r.from,r.to)});return t(i.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const m5=({state:i,dispatch:t})=>RO(i,t,!1),O5=({state:i,dispatch:t})=>RO(i,t,!0),b5=i=>{if(i.state.readOnly)return!1;let{state:t}=i,e=t.changes(Ql(t).map(({from:r,to:s})=>(r>0?r--:s<t.doc.length&&s++,{from:r,to:s}))),n=Rs(t.selection,r=>{let s;if(i.lineWrapping){let o=i.lineBlockAt(r.head),a=i.coordsAtPos(r.head,r.assoc||1);a&&(s=o.bottom+i.documentTop-a.bottom+i.defaultLineHeight/2)}return i.moveVertically(r,!0,s)}).map(e);return i.dispatch({changes:e,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function y5(i,t){if(/\(\)|\[\]|\{\}/.test(i.sliceDoc(t-1,t+1)))return{from:t,to:t};let e=Si(i).resolveInner(t),n=e.childBefore(t),r=e.childAfter(t),s;return n&&r&&n.to<=t&&r.from>=t&&(s=n.type.prop(Ie.closedBy))&&s.indexOf(r.name)>-1&&i.doc.lineAt(n.to).from==i.doc.lineAt(r.from).from&&!/\S/.test(i.sliceDoc(n.to,r.from))?{from:n.to,to:r.from}:null}const Kf=_O(!1),x5=_O(!0);function _O(i){return({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>{let{from:s,to:o}=r,a=t.doc.lineAt(s),l=!i&&s==o&&y5(t,s);i&&(s=o=(o<=a.to?a:t.doc.lineAt(o)).to);let u=new Sl(t,{simulateBreak:s,simulateDoubleBreak:!!l}),c=Ah(u,s);for(c==null&&(c=Es(/^\s*/.exec(t.doc.lineAt(s).text)[0],t.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:s,to:o}=l:s>a.from&&s<a.from+100&&!/\S/.test(a.text.slice(0,s))&&(s=a.from);let h=["",bo(t,c)];return l&&h.push(bo(t,u.lineIndent(a.from,-1))),{changes:{from:s,to:o,insert:Ue.of(h)},range:U.cursor(s+1+h[1].length)}});return e(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function _h(i,t){let e=-1;return i.changeByRange(n=>{let r=[];for(let o=n.from;o<=n.to;){let a=i.doc.lineAt(o);a.number>e&&(n.empty||n.to>a.from)&&(t(a,r,n),e=a.number),o=a.to+1}let s=i.changes(r);return{changes:r,range:U.range(s.mapPos(n.anchor,1),s.mapPos(n.head,1))}})}const w5=({state:i,dispatch:t})=>{if(i.readOnly)return!1;let e=Object.create(null),n=new Sl(i,{overrideIndentation:s=>{let o=e[s];return o??-1}}),r=_h(i,(s,o,a)=>{let l=Ah(n,s.from);if(l==null)return;/\S/.test(s.text)||(l=0);let u=/^\s*/.exec(s.text)[0],c=bo(i,l);(u!=c||a.from<s.from+u.length)&&(e[s.from]=l,o.push({from:s.from,to:s.from+u.length,insert:c}))});return r.changes.empty||t(i.update(r,{userEvent:"indent"})),!0},MO=({state:i,dispatch:t})=>i.readOnly?!1:(t(i.update(_h(i,(e,n)=>{n.push({from:e.from,insert:i.facet(wl)})}),{userEvent:"input.indent"})),!0),BO=({state:i,dispatch:t})=>i.readOnly?!1:(t(i.update(_h(i,(e,n)=>{let r=/^\s*/.exec(e.text)[0];if(!r)return;let s=Es(r,i.tabSize),o=0,a=bo(i,Math.max(0,s-Va(i)));for(;o<r.length&&o<a.length&&r.charCodeAt(o)==a.charCodeAt(o);)o++;n.push({from:e.from+o,to:e.from+r.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),S5=i=>(i.setTabFocusMode(),!0),v5=[{key:"Ctrl-b",run:hO,shift:xO,preventDefault:!0},{key:"Ctrl-f",run:dO,shift:wO},{key:"Ctrl-p",run:gO,shift:kO},{key:"Ctrl-n",run:mO,shift:CO},{key:"Ctrl-a",run:L3,shift:e5},{key:"Ctrl-e",run:X3,shift:t5},{key:"Ctrl-d",run:PO},{key:"Ctrl-h",run:_u},{key:"Ctrl-k",run:c5},{key:"Ctrl-Alt-h",run:EO},{key:"Ctrl-o",run:d5},{key:"Ctrl-t",run:f5},{key:"Ctrl-v",run:Ru}],k5=[{key:"ArrowLeft",run:hO,shift:xO,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:R3,shift:Y3,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:j3,shift:K3,preventDefault:!0},{key:"ArrowRight",run:dO,shift:wO,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:_3,shift:q3,preventDefault:!0},{mac:"Cmd-ArrowRight",run:I3,shift:J3,preventDefault:!0},{key:"ArrowUp",run:gO,shift:kO,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Vf,shift:Uf},{mac:"Ctrl-ArrowUp",run:Wf,shift:Yf},{key:"ArrowDown",run:mO,shift:CO,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Gf,shift:Hf},{mac:"Ctrl-ArrowDown",run:Ru,shift:qf},{key:"PageUp",run:Wf,shift:Yf},{key:"PageDown",run:Ru,shift:qf},{key:"Home",run:z3,shift:H3,preventDefault:!0},{key:"Mod-Home",run:Vf,shift:Uf},{key:"End",run:Z3,shift:U3,preventDefault:!0},{key:"Mod-End",run:Gf,shift:Hf},{key:"Enter",run:Kf,shift:Kf},{key:"Mod-a",run:i5},{key:"Backspace",run:_u,shift:_u,preventDefault:!0},{key:"Delete",run:PO,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:EO,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:l5,preventDefault:!0},{mac:"Mod-Backspace",run:u5,preventDefault:!0},{mac:"Mod-Delete",run:h5,preventDefault:!0}].concat(v5.map(i=>({mac:i.key,run:i.run,shift:i.shift}))),FO=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:B3,shift:V3},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:F3,shift:G3},{key:"Alt-ArrowUp",run:p5},{key:"Shift-Alt-ArrowUp",run:m5},{key:"Alt-ArrowDown",run:g5},{key:"Shift-Alt-ArrowDown",run:O5},{key:"Mod-Alt-ArrowUp",run:s5},{key:"Mod-Alt-ArrowDown",run:o5},{key:"Escape",run:a5},{key:"Mod-Enter",run:x5},{key:"Alt-l",mac:"Ctrl-l",run:n5},{key:"Mod-i",run:r5,preventDefault:!0},{key:"Mod-[",run:BO},{key:"Mod-]",run:MO},{key:"Mod-Alt-\\",run:w5},{key:"Shift-Mod-k",run:b5},{key:"Shift-Mod-\\",run:W3},{key:"Mod-/",run:m3},{key:"Alt-A",run:b3},{key:"Ctrl-m",mac:"Shift-Alt-m",run:S5}].concat(k5),C5={key:"Tab",run:MO,shift:BO},Jf=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i;class $s{constructor(t,e,n=0,r=t.length,s,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(n,r),this.bufferStart=n,this.normalize=s?a=>s(Jf(a)):Jf,this.query=this.normalize(e)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Fi(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let e=hh(t),n=this.bufferStart+this.bufferPos;this.bufferPos+=Tn(t);let r=this.normalize(e);if(r.length)for(let s=0,o=n;;s++){let a=r.charCodeAt(s),l=this.match(a,o,this.bufferPos+this.bufferStart);if(s==r.length-1){if(l)return this.value=l,this;break}o==n&&s<e.length&&e.charCodeAt(s)==a&&o++}}}match(t,e,n){let r=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],a=!1;this.query.charCodeAt(o)==t&&(o==this.query.length-1?r={from:this.matches[s+1],to:n}:(this.matches[s]++,a=!0)),a||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==t&&(this.query.length==1?r={from:e,to:n}:this.matches.push(1,e)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}}typeof Symbol<"u"&&($s.prototype[Symbol.iterator]=function(){return this});const ZO={from:-1,to:-1,match:/.*/.exec("")},Mh="gm"+(/x/.unicode==null?"":"u");class zO{constructor(t,e,n,r=0,s=t.length){if(this.text=t,this.to=s,this.curLine="",this.done=!1,this.value=ZO,/\\[sWDnr]|\n|\r|\[\^/.test(e))return new jO(t,e,n,r,s);this.re=new RegExp(e,Mh+(n?.ignoreCase?"i":"")),this.test=n?.test,this.iter=t.iter();let o=t.lineAt(r);this.curLineStart=o.from,this.matchPos=Ka(t,r),this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){let n=this.curLineStart+e.index,r=n+e[0].length;if(this.matchPos=Ka(this.text,r+(n==r?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<r||n>this.value.to)&&(!this.test||this.test(n,r,e)))return this.value={from:n,to:r,match:e},this;t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),t=0;else return this.done=!0,this}}}const gc=new WeakMap;class gs{constructor(t,e){this.from=t,this.text=e}get to(){return this.from+this.text.length}static get(t,e,n){let r=gc.get(t);if(!r||r.from>=n||r.to<=e){let a=new gs(e,t.sliceString(e,n));return gc.set(t,a),a}if(r.from==e&&r.to==n)return r;let{text:s,from:o}=r;return o>e&&(s=t.sliceString(e,o)+s,o=e),r.to<n&&(s+=t.sliceString(r.to,n)),gc.set(t,new gs(o,s)),new gs(e,s.slice(e-o,n-o))}}class jO{constructor(t,e,n,r,s){this.text=t,this.to=s,this.done=!1,this.value=ZO,this.matchPos=Ka(t,r),this.re=new RegExp(e,Mh+(n?.ignoreCase?"i":"")),this.test=n?.test,this.flat=gs.get(t,r,this.chunkEnd(r+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t&&(this.re.lastIndex=t+1,e=this.re.exec(this.flat.text)),e){let n=this.flat.from+e.index,r=n+e[0].length;if((this.flat.to>=this.to||e.index+e[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,r,e)))return this.value={from:n,to:r,match:e},this.matchPos=Ka(this.text,r+(n==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=gs.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(zO.prototype[Symbol.iterator]=jO.prototype[Symbol.iterator]=function(){return this});function D5(i){try{return new RegExp(i,Mh),!0}catch{return!1}}function Ka(i,t){if(t>=i.length)return t;let e=i.lineAt(t),n;for(;t<e.to&&(n=e.text.charCodeAt(t-e.from))>=56320&&n<57344;)t++;return t}function Mu(i){let t=String(i.state.doc.lineAt(i.state.selection.main.head).number),e=ct("input",{class:"cm-textfield",name:"line",value:t}),n=ct("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),i.dispatch({effects:no.of(!1)}),i.focus()):s.keyCode==13&&(s.preventDefault(),r())},onsubmit:s=>{s.preventDefault(),r()}},ct("label",i.state.phrase("Go to line"),": ",e)," ",ct("button",{class:"cm-button",type:"submit"},i.state.phrase("go")),ct("button",{name:"close",onclick:()=>{i.dispatch({effects:no.of(!1)}),i.focus()},"aria-label":i.state.phrase("close"),type:"button"},["×"]));function r(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!s)return;let{state:o}=i,a=o.doc.lineAt(o.selection.main.head),[,l,u,c,h]=s,d=c?+c.slice(1):0,f=u?+u:a.number;if(u&&h){let m=f/100;l&&(m=m*(l=="-"?-1:1)+a.number/o.doc.lines),f=Math.round(o.doc.lines*m)}else u&&l&&(f=f*(l=="-"?-1:1)+a.number);let p=o.doc.line(Math.max(1,Math.min(o.doc.lines,f))),g=U.cursor(p.from+Math.max(0,Math.min(d,p.length)));i.dispatch({effects:[no.of(!1),ae.scrollIntoView(g.from,{y:"center"})],selection:g}),i.focus()}return{dom:n}}const no=Ze.define(),ep=pi.define({create(){return!0},update(i,t){for(let e of t.effects)e.is(no)&&(i=e.value);return i},provide:i=>go.from(i,t=>t?Mu:null)}),$5=i=>{let t=po(i,Mu);if(!t){let e=[no.of(!0)];i.state.field(ep,!1)==null&&e.push(Ze.appendConfig.of([ep,Q5])),i.dispatch({effects:e}),t=po(i,Mu)}return t&&t.dom.querySelector("input").select(),!0},Q5=ae.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),P5={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},A5=pe.define({combine(i){return zn(i,P5,{highlightWordAroundCursor:(t,e)=>t||e,minSelectionLength:Math.min,maxMatches:Math.min})}});function IO(i){return[M5,_5]}const E5=Se.mark({class:"cm-selectionMatch"}),T5=Se.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function tp(i,t,e,n){return(e==0||i(t.sliceDoc(e-1,e))!=yt.Word)&&(n==t.doc.length||i(t.sliceDoc(n,n+1))!=yt.Word)}function R5(i,t,e,n){return i(t.sliceDoc(e,e+1))==yt.Word&&i(t.sliceDoc(n-1,n))==yt.Word}const _5=Qt.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.selectionSet||i.docChanged||i.viewportChanged)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let t=i.state.facet(A5),{state:e}=i,n=e.selection;if(n.ranges.length>1)return Se.none;let r=n.main,s,o=null;if(r.empty){if(!t.highlightWordAroundCursor)return Se.none;let l=e.wordAt(r.head);if(!l)return Se.none;o=e.charCategorizer(r.head),s=e.sliceDoc(l.from,l.to)}else{let l=r.to-r.from;if(l<t.minSelectionLength||l>200)return Se.none;if(t.wholeWords){if(s=e.sliceDoc(r.from,r.to),o=e.charCategorizer(r.head),!(tp(o,e,r.from,r.to)&&R5(o,e,r.from,r.to)))return Se.none}else if(s=e.sliceDoc(r.from,r.to),!s)return Se.none}let a=[];for(let l of i.visibleRanges){let u=new $s(e.doc,s,l.from,l.to);for(;!u.next().done;){let{from:c,to:h}=u.value;if((!o||tp(o,e,c,h))&&(r.empty&&c<=r.from&&h>=r.to?a.push(T5.range(c,h)):(c>=r.to||h<=r.from)&&a.push(E5.range(c,h)),a.length>t.maxMatches))return Se.none}}return Se.set(a)}},{decorations:i=>i.decorations}),M5=ae.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),B5=({state:i,dispatch:t})=>{let{selection:e}=i,n=U.create(e.ranges.map(r=>i.wordAt(r.head)||U.cursor(r.head)),e.mainIndex);return n.eq(e)?!1:(t(i.update({selection:n})),!0)};function F5(i,t){let{main:e,ranges:n}=i.selection,r=i.wordAt(e.head),s=r&&r.from==e.from&&r.to==e.to;for(let o=!1,a=new $s(i.doc,t,n[n.length-1].to);;)if(a.next(),a.done){if(o)return null;a=new $s(i.doc,t,0,Math.max(0,n[n.length-1].from-1)),o=!0}else{if(o&&n.some(l=>l.from==a.value.from))continue;if(s){let l=i.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}const Z5=({state:i,dispatch:t})=>{let{ranges:e}=i.selection;if(e.some(s=>s.from===s.to))return B5({state:i,dispatch:t});let n=i.sliceDoc(e[0].from,e[0].to);if(i.selection.ranges.some(s=>i.sliceDoc(s.from,s.to)!=n))return!1;let r=F5(i,n);return r?(t(i.update({selection:i.selection.addRange(U.range(r.from,r.to),!1),effects:ae.scrollIntoView(r.to)})),!0):!1},_s=pe.define({combine(i){return zn(i,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:t=>new U5(t),scrollToMatch:t=>ae.scrollIntoView(t)})}});class LO{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.literal=!!t.literal,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||D5(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!t.wholeWord}unquote(t){return this.literal?t:t.replace(/\\([nrt\\])/g,(e,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp&&this.wholeWord==t.wholeWord}create(){return this.regexp?new L5(this):new j5(this)}getCursor(t,e=0,n){let r=t.doc?t:qe.create({doc:t});return n==null&&(n=r.doc.length),this.regexp?os(this,r,e,n):ss(this,r,e,n)}}class XO{constructor(t){this.spec=t}}function ss(i,t,e,n){return new $s(t.doc,i.unquoted,e,n,i.caseSensitive?void 0:r=>r.toLowerCase(),i.wholeWord?z5(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}function z5(i,t){return(e,n,r,s)=>((s>e||s+r.length<n)&&(s=Math.max(0,e-2),r=i.sliceString(s,Math.min(i.length,n+2))),(t(Ja(r,e-s))!=yt.Word||t(el(r,e-s))!=yt.Word)&&(t(el(r,n-s))!=yt.Word||t(Ja(r,n-s))!=yt.Word))}class j5 extends XO{constructor(t){super(t)}nextMatch(t,e,n){let r=ss(this.spec,t,n,t.doc.length).nextOverlapping();if(r.done){let s=Math.min(t.doc.length,e+this.spec.unquoted.length);r=ss(this.spec,t,0,s).nextOverlapping()}return r.done||r.value.from==e&&r.value.to==n?null:r.value}prevMatchInRange(t,e,n){for(let r=n;;){let s=Math.max(e,r-1e4-this.spec.unquoted.length),o=ss(this.spec,t,s,r),a=null;for(;!o.nextOverlapping().done;)a=o.value;if(a)return a;if(s==e)return null;r-=1e4}}prevMatch(t,e,n){let r=this.prevMatchInRange(t,0,e);return r||(r=this.prevMatchInRange(t,Math.max(0,n-this.spec.unquoted.length),t.doc.length)),r&&(r.from!=e||r.to!=n)?r:null}getReplacement(t){return this.spec.unquote(this.spec.replace)}matchAll(t,e){let n=ss(this.spec,t,0,t.doc.length),r=[];for(;!n.next().done;){if(r.length>=e)return null;r.push(n.value)}return r}highlight(t,e,n,r){let s=ss(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,t.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}function os(i,t,e,n){return new zO(t.doc,i.search,{ignoreCase:!i.caseSensitive,test:i.wholeWord?I5(t.charCategorizer(t.selection.main.head)):void 0},e,n)}function Ja(i,t){return i.slice(fi(i,t,!1),t)}function el(i,t){return i.slice(t,fi(i,t))}function I5(i){return(t,e,n)=>!n[0].length||(i(Ja(n.input,n.index))!=yt.Word||i(el(n.input,n.index))!=yt.Word)&&(i(el(n.input,n.index+n[0].length))!=yt.Word||i(Ja(n.input,n.index+n[0].length))!=yt.Word)}class L5 extends XO{nextMatch(t,e,n){let r=os(this.spec,t,n,t.doc.length).next();return r.done&&(r=os(this.spec,t,0,e).next()),r.done?null:r.value}prevMatchInRange(t,e,n){for(let r=1;;r++){let s=Math.max(e,n-r*1e4),o=os(this.spec,t,s,n),a=null;for(;!o.next().done;)a=o.value;if(a&&(s==e||a.from>s+10))return a;if(s==e)return null}}prevMatch(t,e,n){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,n,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(e,n)=>{if(n=="&")return t.match[0];if(n=="$")return"$";for(let r=n.length;r>0;r--){let s=+n.slice(0,r);if(s>0&&s<t.match.length)return t.match[s]+n.slice(r)}return e})}matchAll(t,e){let n=os(this.spec,t,0,t.doc.length),r=[];for(;!n.next().done;){if(r.length>=e)return null;r.push(n.value)}return r}highlight(t,e,n,r){let s=os(this.spec,t,Math.max(0,e-250),Math.min(n+250,t.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const yo=Ze.define(),Bh=Ze.define(),Cr=pi.define({create(i){return new mc(Bu(i).create(),null)},update(i,t){for(let e of t.effects)e.is(yo)?i=new mc(e.value.create(),i.panel):e.is(Bh)&&(i=new mc(i.query,e.value?Fh:null));return i},provide:i=>go.from(i,t=>t.panel)});class mc{constructor(t,e){this.query=t,this.panel=e}}const X5=Se.mark({class:"cm-searchMatch"}),N5=Se.mark({class:"cm-searchMatch cm-searchMatch-selected"}),W5=Qt.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(Cr))}update(i){let t=i.state.field(Cr);(t!=i.startState.field(Cr)||i.docChanged||i.selectionSet||i.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:i,panel:t}){if(!t||!i.spec.valid)return Se.none;let{view:e}=this,n=new Kn;for(let r=0,s=e.visibleRanges,o=s.length;r<o;r++){let{from:a,to:l}=s[r];for(;r<o-1&&l>s[r+1].from-500;)l=s[++r].to;i.highlight(e.state,a,l,(u,c)=>{let h=e.state.selection.ranges.some(d=>d.from==u&&d.to==c);n.add(u,c,h?N5:X5)})}return n.finish()}},{decorations:i=>i.decorations});function Io(i){return t=>{let e=t.state.field(Cr,!1);return e&&e.query.spec.valid?i(t,e):YO(t)}}const tl=Io((i,{query:t})=>{let{to:e}=i.state.selection.main,n=t.nextMatch(i.state,e,e);if(!n)return!1;let r=U.single(n.from,n.to),s=i.state.facet(_s);return i.dispatch({selection:r,effects:[Zh(i,n),s.scrollToMatch(r.main,i)],userEvent:"select.search"}),WO(i),!0}),il=Io((i,{query:t})=>{let{state:e}=i,{from:n}=e.selection.main,r=t.prevMatch(e,n,n);if(!r)return!1;let s=U.single(r.from,r.to),o=i.state.facet(_s);return i.dispatch({selection:s,effects:[Zh(i,r),o.scrollToMatch(s.main,i)],userEvent:"select.search"}),WO(i),!0}),Y5=Io((i,{query:t})=>{let e=t.matchAll(i.state,1e3);return!e||!e.length?!1:(i.dispatch({selection:U.create(e.map(n=>U.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),q5=({state:i,dispatch:t})=>{let e=i.selection;if(e.ranges.length>1||e.main.empty)return!1;let{from:n,to:r}=e.main,s=[],o=0;for(let a=new $s(i.doc,i.sliceDoc(n,r));!a.next().done;){if(s.length>1e3)return!1;a.value.from==n&&(o=s.length),s.push(U.range(a.value.from,a.value.to))}return t(i.update({selection:U.create(s,o),userEvent:"select.search.matches"})),!0},ip=Io((i,{query:t})=>{let{state:e}=i,{from:n,to:r}=e.selection.main;if(e.readOnly)return!1;let s=t.nextMatch(e,n,n);if(!s)return!1;let o=s,a=[],l,u,c=[];o.from==n&&o.to==r&&(u=e.toText(t.getReplacement(o)),a.push({from:o.from,to:o.to,insert:u}),o=t.nextMatch(e,o.from,o.to),c.push(ae.announce.of(e.phrase("replaced match on line $",e.doc.lineAt(n).number)+".")));let h=i.state.changes(a);return o&&(l=U.single(o.from,o.to).map(h),c.push(Zh(i,o)),c.push(e.facet(_s).scrollToMatch(l.main,i))),i.dispatch({changes:h,selection:l,effects:c,userEvent:"input.replace"}),!0}),V5=Io((i,{query:t})=>{if(i.state.readOnly)return!1;let e=t.matchAll(i.state,1e9).map(r=>{let{from:s,to:o}=r;return{from:s,to:o,insert:t.getReplacement(r)}});if(!e.length)return!1;let n=i.state.phrase("replaced $ matches",e.length)+".";return i.dispatch({changes:e,effects:ae.announce.of(n),userEvent:"input.replace.all"}),!0});function Fh(i){return i.state.facet(_s).createPanel(i)}function Bu(i,t){var e,n,r,s,o;let a=i.selection.main,l=a.empty||a.to>a.from+100?"":i.sliceDoc(a.from,a.to);if(t&&!l)return t;let u=i.facet(_s);return new LO({search:((e=t?.literal)!==null&&e!==void 0?e:u.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(n=t?.caseSensitive)!==null&&n!==void 0?n:u.caseSensitive,literal:(r=t?.literal)!==null&&r!==void 0?r:u.literal,regexp:(s=t?.regexp)!==null&&s!==void 0?s:u.regexp,wholeWord:(o=t?.wholeWord)!==null&&o!==void 0?o:u.wholeWord})}function NO(i){let t=po(i,Fh);return t&&t.dom.querySelector("[main-field]")}function WO(i){let t=NO(i);t&&t==i.root.activeElement&&t.select()}const YO=i=>{let t=i.state.field(Cr,!1);if(t&&t.panel){let e=NO(i);if(e&&e!=i.root.activeElement){let n=Bu(i.state,t.query.spec);n.valid&&i.dispatch({effects:yo.of(n)}),e.focus(),e.select()}}else i.dispatch({effects:[Bh.of(!0),t?yo.of(Bu(i.state,t.query.spec)):Ze.appendConfig.of(K5)]});return!0},qO=i=>{let t=i.state.field(Cr,!1);if(!t||!t.panel)return!1;let e=po(i,Fh);return e&&e.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:Bh.of(!1)}),!0},G5=[{key:"Mod-f",run:YO,scope:"editor search-panel"},{key:"F3",run:tl,shift:il,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:tl,shift:il,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:qO,scope:"editor search-panel"},{key:"Mod-Shift-l",run:q5},{key:"Mod-Alt-g",run:$5},{key:"Mod-d",run:Z5,preventDefault:!0}];class U5{constructor(t){this.view=t;let e=this.query=t.state.field(Cr).query.spec;this.commit=this.commit.bind(this),this.searchField=ct("input",{value:e.search,placeholder:Yi(t,"Find"),"aria-label":Yi(t,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=ct("input",{value:e.replace,placeholder:Yi(t,"Replace"),"aria-label":Yi(t,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=ct("input",{type:"checkbox",name:"case",form:"",checked:e.caseSensitive,onchange:this.commit}),this.reField=ct("input",{type:"checkbox",name:"re",form:"",checked:e.regexp,onchange:this.commit}),this.wordField=ct("input",{type:"checkbox",name:"word",form:"",checked:e.wholeWord,onchange:this.commit});function n(r,s,o){return ct("button",{class:"cm-button",name:r,onclick:s,type:"button"},o)}this.dom=ct("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,n("next",()=>tl(t),[Yi(t,"next")]),n("prev",()=>il(t),[Yi(t,"previous")]),n("select",()=>Y5(t),[Yi(t,"all")]),ct("label",null,[this.caseField,Yi(t,"match case")]),ct("label",null,[this.reField,Yi(t,"regexp")]),ct("label",null,[this.wordField,Yi(t,"by word")]),...t.state.readOnly?[]:[ct("br"),this.replaceField,n("replace",()=>ip(t),[Yi(t,"replace")]),n("replaceAll",()=>V5(t),[Yi(t,"replace all")])],ct("button",{name:"close",onclick:()=>qO(t),"aria-label":Yi(t,"close"),type:"button"},["×"])])}commit(){let t=new LO({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:yo.of(t)}))}keydown(t){pD(this.view,t,"search-panel")?t.preventDefault():t.keyCode==13&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?il:tl)(this.view)):t.keyCode==13&&t.target==this.replaceField&&(t.preventDefault(),ip(this.view))}update(t){for(let e of t.transactions)for(let n of e.effects)n.is(yo)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp,this.wordField.checked=t.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(_s).top}}function Yi(i,t){return i.state.phrase(t)}const fa=30,pa=/[\s\.,:;?!]/;function Zh(i,{from:t,to:e}){let n=i.state.doc.lineAt(t),r=i.state.doc.lineAt(e).to,s=Math.max(n.from,t-fa),o=Math.min(r,e+fa),a=i.state.sliceDoc(s,o);if(s!=n.from){for(let l=0;l<fa;l++)if(!pa.test(a[l+1])&&pa.test(a[l])){a=a.slice(l);break}}if(o!=r){for(let l=a.length-1;l>a.length-fa;l--)if(!pa.test(a[l-1])&&pa.test(a[l])){a=a.slice(0,l);break}}return ae.announce.of(`${i.state.phrase("current match")}. ${a} ${i.state.phrase("on line")} ${n.number}.`)}const H5=ae.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),K5=[Cr,Jr.low(W5),H5];class VO{constructor(t,e,n,r){this.state=t,this.pos=e,this.explicit=n,this.view=r,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(t){let e=Si(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),n=Math.max(e.from,this.pos-250),r=e.text.slice(n-e.from,this.pos-e.from),s=r.search(GO(t,!1));return s<0?null:{from:n+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(t,e,n){t=="abort"&&this.abortListeners&&(this.abortListeners.push(e),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function np(i){let t=Object.keys(i).join(""),e=/\w/.test(t);return e&&(t=t.replace(/\w/g,"")),`[${e?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function J5(i){let t=Object.create(null),e=Object.create(null);for(let{label:r}of i){t[r[0]]=!0;for(let s=1;s<r.length;s++)e[r[s]]=!0}let n=np(t)+np(e)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function eQ(i){let t=i.map(r=>typeof r=="string"?{label:r}:r),[e,n]=t.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:J5(t);return r=>{let s=r.matchBefore(n);return s||r.explicit?{from:s?s.from:r.pos,options:t,validFor:e}:null}}class rp{constructor(t,e,n,r){this.completion=t,this.source=e,this.match=n,this.score=r}}function qr(i){return i.selection.main.from}function GO(i,t){var e;let{source:n}=i,r=t&&n[0]!="^",s=n[n.length-1]!="$";return!r&&!s?i:new RegExp(`${r?"^":""}(?:${n})${s?"$":""}`,(e=i.flags)!==null&&e!==void 0?e:i.ignoreCase?"i":"")}const UO=Zn.define();function tQ(i,t,e,n){let{main:r}=i.selection,s=e-r.from,o=n-r.from;return{...i.changeByRange(a=>{if(a!=r&&e!=n&&i.sliceDoc(a.from+s,a.from+o)!=i.sliceDoc(e,n))return{range:a};let l=i.toText(t);return{changes:{from:a.from+s,to:n==r.from?a.to:a.from+o,insert:l},range:U.cursor(a.from+s+l.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const sp=new WeakMap;function iQ(i){if(!Array.isArray(i))return i;let t=sp.get(i);return t||sp.set(i,t=eQ(i)),t}const nl=Ze.define(),xo=Ze.define();class nQ{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let e=0;e<t.length;){let n=Fi(t,e),r=Tn(n);this.chars.push(n);let s=t.slice(e,e+r),o=s.toUpperCase();this.folded.push(Fi(o==s?s.toLowerCase():o,0)),e+=r}this.astral=t.length!=this.chars.length}ret(t,e){return this.score=t,this.matched=e,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:e,folded:n,any:r,precise:s,byWord:o}=this;if(e.length==1){let b=Fi(t,0),x=Tn(b),S=x==t.length?0:-100;if(b!=e[0])if(b==n[0])S+=-200;else return null;return this.ret(S,[0,x])}let a=t.indexOf(this.pattern);if(a==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=e.length,u=0;if(a<0){for(let b=0,x=Math.min(t.length,200);b<x&&u<l;){let S=Fi(t,b);(S==e[u]||S==n[u])&&(r[u++]=b),b+=Tn(S)}if(u<l)return null}let c=0,h=0,d=!1,f=0,p=-1,g=-1,m=/[a-z]/.test(t),O=!0;for(let b=0,x=Math.min(t.length,200),S=0;b<x&&h<l;){let w=Fi(t,b);a<0&&(c<l&&w==e[c]&&(s[c++]=b),f<l&&(w==e[f]||w==n[f]?(f==0&&(p=b),g=b+1,f++):f=0));let v,D=w<255?w>=48&&w<=57||w>=97&&w<=122?2:w>=65&&w<=90?1:0:(v=hh(w))!=v.toLowerCase()?1:v!=v.toUpperCase()?2:0;(!b||D==1&&m||S==0&&D!=0)&&(e[h]==w||n[h]==w&&(d=!0)?o[h++]=b:o.length&&(O=!1)),S=D,b+=Tn(w)}return h==l&&o[0]==0&&O?this.result(-100+(d?-200:0),o,t):f==l&&p==0?this.ret(-200-t.length+(g==t.length?0:-100),[0,g]):a>-1?this.ret(-700-t.length,[a,a+this.pattern.length]):f==l?this.ret(-900-t.length,[p,g]):h==l?this.result(-100+(d?-200:0)+-700+(O?0:-1100),o,t):e.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,t)}result(t,e,n){let r=[],s=0;for(let o of e){let a=o+(this.astral?Tn(Fi(n,o)):1);s&&r[s-1]==o?r[s-1]=a:(r[s++]=o,r[s++]=a)}return this.ret(t-n.length,r)}}class rQ{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let e=t.slice(0,this.pattern.length),n=e==this.pattern?0:e.toLowerCase()==this.folded?-200:null;return n==null?null:(this.matched=[0,e.length],this.score=n+(t.length==this.pattern.length?0:-100),this)}}const ai=pe.define({combine(i){return zn(i,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:sQ,filterStrict:!1,compareCompletions:(t,e)=>t.label.localeCompare(e.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,tooltipClass:(t,e)=>n=>op(t(n),e(n)),optionClass:(t,e)=>n=>op(t(n),e(n)),addToOptions:(t,e)=>t.concat(e),filterStrict:(t,e)=>t||e})}});function op(i,t){return i?t?i+" "+t:i:t}function sQ(i,t,e,n,r,s){let o=i.textDirection==mt.RTL,a=o,l=!1,u="top",c,h,d=t.left-r.left,f=r.right-t.right,p=n.right-n.left,g=n.bottom-n.top;if(a&&d<Math.min(p,f)?a=!1:!a&&f<Math.min(p,d)&&(a=!0),p<=(a?d:f))c=Math.max(r.top,Math.min(e.top,r.bottom-g))-t.top,h=Math.min(400,a?d:f);else{l=!0,h=Math.min(400,(o?t.right:r.right-t.left)-30);let b=r.bottom-t.bottom;b>=g||b>t.top?c=e.bottom-t.top:(u="bottom",c=t.bottom-e.top)}let m=(t.bottom-t.top)/s.offsetHeight,O=(t.right-t.left)/s.offsetWidth;return{style:`${u}: ${c/m}px; max-width: ${h/O}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function oQ(i){let t=i.addToOptions.slice();return i.icons&&t.push({render(e){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),e.type&&n.classList.add(...e.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),n.setAttribute("aria-hidden","true"),n},position:20}),t.push({render(e,n,r,s){let o=document.createElement("span");o.className="cm-completionLabel";let a=e.displayLabel||e.label,l=0;for(let u=0;u<s.length;){let c=s[u++],h=s[u++];c>l&&o.appendChild(document.createTextNode(a.slice(l,c)));let d=o.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(a.slice(c,h))),d.className="cm-completionMatchedText",l=h}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(e){if(!e.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=e.detail,n},position:80}),t.sort((e,n)=>e.position-n.position).map(e=>e.render)}function Oc(i,t,e){if(i<=e)return{from:0,to:i};if(t<0&&(t=0),t<=i>>1){let r=Math.floor(t/e);return{from:r*e,to:(r+1)*e}}let n=Math.floor((i-t)/e);return{from:i-(n+1)*e,to:i-n*e}}class aQ{constructor(t,e,n){this.view=t,this.stateField=e,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let r=t.state.field(e),{options:s,selected:o}=r.open,a=t.state.facet(ai);this.optionContent=oQ(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=Oc(s.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",l=>{let{options:u}=t.state.field(e).open;for(let c=l.target,h;c&&c!=this.dom;c=c.parentNode)if(c.nodeName=="LI"&&(h=/-(\d+)$/.exec(c.id))&&+h[1]<u.length){this.applyCompletion(t,u[+h[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let u=t.state.field(this.stateField,!1);u&&u.tooltip&&t.state.facet(ai).closeOnBlur&&l.relatedTarget!=t.contentDOM&&t.dispatch({effects:xo.of(null)})}),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(t,e){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,e,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var e;let n=t.state.field(this.stateField),r=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),n!=r){let{options:s,selected:o,disabled:a}=n.open;(!r.open||r.open.options!=s)&&(this.range=Oc(s.length,o,t.state.facet(ai).maxRenderedOptions),this.showOptions(s,n.id)),this.updateSel(),a!=((e=r.open)===null||e===void 0?void 0:e.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(t){let e=this.tooltipClass(t);if(e!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of e.split(" "))n&&this.dom.classList.add(n);this.currentClass=e}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;(e.selected>-1&&e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=Oc(e.options.length,e.selected,this.view.state.facet(ai).maxRenderedOptions),this.showOptions(e.options,t.id));let n=this.updateSelectedOption(e.selected);if(n){this.destroyInfo();let{completion:r}=e.options[e.selected],{info:s}=r;if(!s)return;let o=typeof s=="string"?document.createTextNode(s):s(r);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(a,r)}).catch(a=>zi(this.view.state,a,"completion info")):(this.addInfoPane(o,r),n.setAttribute("aria-describedby",this.info.id))}}addInfoPane(t,e){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",n.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),t.nodeType!=null)n.appendChild(t),this.infoDestroy=null;else{let{dom:r,destroy:s}=t;n.appendChild(r),this.infoDestroy=s||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let e=null;for(let n=this.list.firstChild,r=this.range.from;n;n=n.nextSibling,r++)n.nodeName!="LI"||!n.id?r--:r==t?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),e=n):n.hasAttribute("aria-selected")&&(n.removeAttribute("aria-selected"),n.removeAttribute("aria-describedby"));return e&&cQ(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),r=t.getBoundingClientRect(),s=this.space;if(!s){let o=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return r.top>Math.min(s.bottom,e.bottom)-10||r.bottom<Math.max(s.top,e.top)+10?null:this.view.state.facet(ai).positionInfo(this.view,e,r,n,s,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,e,n){const r=document.createElement("ul");r.id=e,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions")),r.addEventListener("mousedown",o=>{o.target==r&&o.preventDefault()});let s=null;for(let o=n.from;o<n.to;o++){let{completion:a,match:l}=t[o],{section:u}=a;if(u){let d=typeof u=="string"?u:u.name;if(d!=s&&(o>n.from||n.from==0))if(s=d,typeof u!="string"&&u.header)r.appendChild(u.header(u));else{let f=r.appendChild(document.createElement("completion-section"));f.textContent=d}}const c=r.appendChild(document.createElement("li"));c.id=e+"-"+o,c.setAttribute("role","option");let h=this.optionClass(a);h&&(c.className=h);for(let d of this.optionContent){let f=d(a,this.view.state,this.view,l);f&&c.appendChild(f)}}return n.from&&r.classList.add("cm-completionListIncompleteTop"),n.to<t.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function lQ(i,t){return e=>new aQ(e,i,t)}function cQ(i,t){let e=i.getBoundingClientRect(),n=t.getBoundingClientRect(),r=e.height/i.offsetHeight;n.top<e.top?i.scrollTop-=(e.top-n.top)/r:n.bottom>e.bottom&&(i.scrollTop+=(n.bottom-e.bottom)/r)}function ap(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function uQ(i,t){let e=[],n=null,r=null,s=c=>{e.push(c);let{section:h}=c.completion;if(h){n||(n=[]);let d=typeof h=="string"?h:h.name;n.some(f=>f.name==d)||n.push(typeof h=="string"?{name:d}:h)}},o=t.facet(ai);for(let c of i)if(c.hasResult()){let h=c.result.getMatch;if(c.result.filter===!1)for(let d of c.result.options)s(new rp(d,c.source,h?h(d):[],1e9-e.length));else{let d=t.sliceDoc(c.from,c.to),f,p=o.filterStrict?new rQ(d):new nQ(d);for(let g of c.result.options)if(f=p.match(g.label)){let m=g.displayLabel?h?h(g,f.matched):[]:f.matched,O=f.score+(g.boost||0);if(s(new rp(g,c.source,m,O)),typeof g.section=="object"&&g.section.rank==="dynamic"){let{name:b}=g.section;r||(r=Object.create(null)),r[b]=Math.max(O,r[b]||-1e9)}}}}if(n){let c=Object.create(null),h=0,d=(f,p)=>(f.rank==="dynamic"&&p.rank==="dynamic"?r[p.name]-r[f.name]:0)||(typeof f.rank=="number"?f.rank:1e9)-(typeof p.rank=="number"?p.rank:1e9)||(f.name<p.name?-1:1);for(let f of n.sort(d))h-=1e5,c[f.name]=h;for(let f of e){let{section:p}=f.completion;p&&(f.score+=c[typeof p=="string"?p:p.name])}}let a=[],l=null,u=o.compareCompletions;for(let c of e.sort((h,d)=>d.score-h.score||u(h.completion,d.completion))){let h=c.completion;!l||l.label!=h.label||l.detail!=h.detail||l.type!=null&&h.type!=null&&l.type!=h.type||l.apply!=h.apply||l.boost!=h.boost?a.push(c):ap(c.completion)>ap(l)&&(a[a.length-1]=c),l=c.completion}return a}class hs{constructor(t,e,n,r,s,o){this.options=t,this.attrs=e,this.tooltip=n,this.timestamp=r,this.selected=s,this.disabled=o}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new hs(this.options,lp(e,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,e,n,r,s,o){if(r&&!o&&t.some(u=>u.isPending))return r.setDisabled();let a=uQ(t,e);if(!a.length)return r&&t.some(u=>u.isPending)?r.setDisabled():null;let l=e.facet(ai).selectOnOpen?0:-1;if(r&&r.selected!=l&&r.selected!=-1){let u=r.options[r.selected].completion;for(let c=0;c<a.length;c++)if(a[c].completion==u){l=c;break}}return new hs(a,lp(n,l),{pos:t.reduce((u,c)=>c.hasResult()?Math.min(u,c.from):u,1e8),create:mQ,above:s.aboveCursor},r?r.timestamp:Date.now(),l,!1)}map(t){return new hs(this.options,this.attrs,{...this.tooltip,pos:t.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new hs(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class rl{constructor(t,e,n){this.active=t,this.id=e,this.open=n}static start(){return new rl(pQ,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:e}=t,n=e.facet(ai),s=(n.override||e.languageDataAt("autocomplete",qr(e)).map(iQ)).map(l=>(this.active.find(c=>c.source==l)||new an(l,this.active.some(c=>c.state!=0)?1:0)).update(t,n));s.length==this.active.length&&s.every((l,u)=>l==this.active[u])&&(s=this.active);let o=this.open,a=t.effects.some(l=>l.is(zh));o&&t.docChanged&&(o=o.map(t.changes)),t.selection||s.some(l=>l.hasResult()&&t.changes.touchesRange(l.from,l.to))||!hQ(s,this.active)||a?o=hs.build(s,e,this.id,o,n,a):o&&o.disabled&&!s.some(l=>l.isPending)&&(o=null),!o&&s.every(l=>!l.isPending)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new an(l.source,0):l));for(let l of t.effects)l.is(KO)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new rl(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?dQ:fQ}}function hQ(i,t){if(i==t)return!0;for(let e=0,n=0;;){for(;e<i.length&&!i[e].hasResult();)e++;for(;n<t.length&&!t[n].hasResult();)n++;let r=e==i.length,s=n==t.length;if(r||s)return r==s;if(i[e++].result!=t[n++].result)return!1}}const dQ={"aria-autocomplete":"list"},fQ={};function lp(i,t){let e={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":i};return t>-1&&(e["aria-activedescendant"]=i+"-"+t),e}const pQ=[];function HO(i,t){if(i.isUserEvent("input.complete")){let n=i.annotation(UO);if(n&&t.activateOnCompletion(n))return 12}let e=i.isUserEvent("input.type");return e&&t.activateOnTyping?5:e?1:i.isUserEvent("delete.backward")?2:i.selection?8:i.docChanged?16:0}class an{constructor(t,e,n=!1){this.source=t,this.state=e,this.explicit=n}hasResult(){return!1}get isPending(){return this.state==1}update(t,e){let n=HO(t,e),r=this;(n&8||n&16&&this.touches(t))&&(r=new an(r.source,0)),n&4&&r.state==0&&(r=new an(this.source,1)),r=r.updateFor(t,n);for(let s of t.effects)if(s.is(nl))r=new an(r.source,1,s.value);else if(s.is(xo))r=new an(r.source,0);else if(s.is(zh))for(let o of s.value)o.source==r.source&&(r=o);return r}updateFor(t,e){return this.map(t.changes)}map(t){return this}touches(t){return t.changes.touchesRange(qr(t.state))}}class ms extends an{constructor(t,e,n,r,s,o){super(t,3,e),this.limit=n,this.result=r,this.from=s,this.to=o}hasResult(){return!0}updateFor(t,e){var n;if(!(e&3))return this.map(t.changes);let r=this.result;r.map&&!t.changes.empty&&(r=r.map(r,t.changes));let s=t.changes.mapPos(this.from),o=t.changes.mapPos(this.to,1),a=qr(t.state);if(a>o||!r||e&2&&(qr(t.startState)==this.from||a<this.limit))return new an(this.source,e&4?1:0);let l=t.changes.mapPos(this.limit);return gQ(r.validFor,t.state,s,o)?new ms(this.source,this.explicit,l,r,s,o):r.update&&(r=r.update(r,s,o,new VO(t.state,a,!1)))?new ms(this.source,this.explicit,l,r,r.from,(n=r.to)!==null&&n!==void 0?n:qr(t.state)):new an(this.source,1,this.explicit)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new ms(this.source,this.explicit,t.mapPos(this.limit),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new an(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function gQ(i,t,e,n){if(!i)return!1;let r=t.sliceDoc(e,n);return typeof i=="function"?i(r,e,n,t):GO(i,!0).test(r)}const zh=Ze.define({map(i,t){return i.map(e=>e.map(t))}}),KO=Ze.define(),Zi=pi.define({create(){return rl.start()},update(i,t){return i.update(t)},provide:i=>[Ch.from(i,t=>t.tooltip),ae.contentAttributes.from(i,t=>t.attrs)]});function jh(i,t){const e=t.completion.apply||t.completion.label;let n=i.state.field(Zi).active.find(r=>r.source==t.source);return n instanceof ms?(typeof e=="string"?i.dispatch({...tQ(i.state,e,n.from,n.to),annotations:UO.of(t.completion)}):e(i,t.completion,n.from,n.to),!0):!1}const mQ=lQ(Zi,jh);function ga(i,t="option"){return e=>{let n=e.state.field(Zi,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<e.state.facet(ai).interactionDelay)return!1;let r=1,s;t=="page"&&(s=v0(e,n.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=n.open.options,a=n.open.selected>-1?n.open.selected+r*(i?1:-1):i?0:o-1;return a<0?a=t=="page"?0:o-1:a>=o&&(a=t=="page"?o-1:0),e.dispatch({effects:KO.of(a)}),!0}}const OQ=i=>{let t=i.state.field(Zi,!1);return i.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<i.state.facet(ai).interactionDelay?!1:jh(i,t.open.options[t.open.selected])},bc=i=>i.state.field(Zi,!1)?(i.dispatch({effects:nl.of(!0)}),!0):!1,bQ=i=>{let t=i.state.field(Zi,!1);return!t||!t.active.some(e=>e.state!=0)?!1:(i.dispatch({effects:xo.of(null)}),!0)};class yQ{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const xQ=50,wQ=1e3,SQ=Qt.fromClass(class{constructor(i){this.view=i,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of i.state.field(Zi).active)t.isPending&&this.startQuery(t)}update(i){let t=i.state.field(Zi),e=i.state.facet(ai);if(!i.selectionSet&&!i.docChanged&&i.startState.field(Zi)==t)return;let n=i.transactions.some(s=>{let o=HO(s,e);return o&8||(s.selection||s.docChanged)&&!(o&3)});for(let s=0;s<this.running.length;s++){let o=this.running[s];if(n||o.context.abortOnDocChange&&i.docChanged||o.updates.length+i.transactions.length>xQ&&Date.now()-o.time>wQ){for(let a of o.context.abortListeners)try{a()}catch(l){zi(this.view.state,l)}o.context.abortListeners=null,this.running.splice(s--,1)}else o.updates.push(...i.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),i.transactions.some(s=>s.effects.some(o=>o.is(nl)))&&(this.pendingStart=!0);let r=this.pendingStart?50:e.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(s=>s.isPending&&!this.running.some(o=>o.active.source==s.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let s of i.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:i}=this.view,t=i.field(Zi);for(let e of t.active)e.isPending&&!this.running.some(n=>n.active.source==e.source)&&this.startQuery(e);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(ai).updateSyncTime))}startQuery(i){let{state:t}=this.view,e=qr(t),n=new VO(t,e,i.explicit,this.view),r=new yQ(i,n);this.running.push(r),Promise.resolve(i.source(n)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:xo.of(null)}),zi(this.view.state,s)})}scheduleAccept(){this.running.every(i=>i.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(ai).updateSyncTime))}accept(){var i;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],e=this.view.state.facet(ai),n=this.view.state.field(Zi);for(let r=0;r<this.running.length;r++){let s=this.running[r];if(s.done===void 0)continue;if(this.running.splice(r--,1),s.done){let a=qr(s.updates.length?s.updates[0].startState:this.view.state),l=Math.min(a,s.done.from+(s.active.explicit?0:1)),u=new ms(s.active.source,s.active.explicit,l,s.done,s.done.from,(i=s.done.to)!==null&&i!==void 0?i:a);for(let c of s.updates)u=u.update(c,e);if(u.hasResult()){t.push(u);continue}}let o=n.active.find(a=>a.source==s.active.source);if(o&&o.isPending)if(s.done==null){let a=new an(s.active.source,0);for(let l of s.updates)a=a.update(l,e);a.isPending||t.push(a)}else this.startQuery(o)}(t.length||n.open&&n.open.disabled)&&this.view.dispatch({effects:zh.of(t)})}},{eventHandlers:{blur(i){let t=this.view.state.field(Zi,!1);if(t&&t.tooltip&&this.view.state.facet(ai).closeOnBlur){let e=t.open&&v0(this.view,t.open.tooltip);(!e||!e.dom.contains(i.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:xo.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:nl.of(!1)}),20),this.composing=0}}}),vQ=typeof navigator=="object"&&/Win/.test(navigator.platform),kQ=Jr.highest(ae.domEventHandlers({keydown(i,t){let e=t.state.field(Zi,!1);if(!e||!e.open||e.open.disabled||e.open.selected<0||i.key.length>1||i.ctrlKey&&!(vQ&&i.altKey)||i.metaKey)return!1;let n=e.open.options[e.open.selected],r=e.active.find(o=>o.source==n.source),s=n.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(i.key)>-1&&jh(t,n),!1}})),CQ=ae.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),wo={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Wr=Ze.define({map(i,t){let e=t.mapPos(i,-1,Ai.TrackAfter);return e??void 0}}),Ih=new class extends Vr{};Ih.startSide=1;Ih.endSide=-1;const JO=pi.define({create(){return Ge.empty},update(i,t){if(i=i.map(t.changes),t.selection){let e=t.state.doc.lineAt(t.selection.main.head);i=i.update({filter:n=>n>=e.from&&n<=e.to})}for(let e of t.effects)e.is(Wr)&&(i=i.update({add:[Ih.range(e.value,e.value+1)]}));return i}});function e1(){return[$Q,JO]}const yc="()[]{}<>«»»«［］｛｝";function t1(i){for(let t=0;t<yc.length;t+=2)if(yc.charCodeAt(t)==i)return yc.charAt(t+1);return hh(i<128?i:i+1)}function i1(i,t){return i.languageDataAt("closeBrackets",t)[0]||wo}const DQ=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),$Q=ae.inputHandler.of((i,t,e,n)=>{if((DQ?i.composing:i.compositionStarted)||i.state.readOnly)return!1;let r=i.state.selection.main;if(n.length>2||n.length==2&&Tn(Fi(n,0))==1||t!=r.from||e!=r.to)return!1;let s=AQ(i.state,n);return s?(i.dispatch(s),!0):!1}),QQ=({state:i,dispatch:t})=>{if(i.readOnly)return!1;let n=i1(i,i.selection.main.head).brackets||wo.brackets,r=null,s=i.changeByRange(o=>{if(o.empty){let a=EQ(i.doc,o.head);for(let l of n)if(l==a&&Pl(i.doc,o.head)==t1(Fi(l,0)))return{changes:{from:o.head-l.length,to:o.head+l.length},range:U.cursor(o.head-l.length)}}return{range:r=o}});return r||t(i.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},PQ=[{key:"Backspace",run:QQ}];function AQ(i,t){let e=i1(i,i.selection.main.head),n=e.brackets||wo.brackets;for(let r of n){let s=t1(Fi(r,0));if(t==r)return s==r?_Q(i,r,n.indexOf(r+r+r)>-1,e):TQ(i,r,s,e.before||wo.before);if(t==s&&n1(i,i.selection.main.from))return RQ(i,r,s)}return null}function n1(i,t){let e=!1;return i.field(JO).between(0,i.doc.length,n=>{n==t&&(e=!0)}),e}function Pl(i,t){let e=i.sliceString(t,t+2);return e.slice(0,Tn(Fi(e,0)))}function EQ(i,t){let e=i.sliceString(t-2,t);return Tn(Fi(e,0))==e.length?e:e.slice(1)}function TQ(i,t,e,n){let r=null,s=i.changeByRange(o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:e,from:o.to}],effects:Wr.of(o.to+t.length),range:U.range(o.anchor+t.length,o.head+t.length)};let a=Pl(i.doc,o.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:t+e,from:o.head},effects:Wr.of(o.head+t.length),range:U.cursor(o.head+t.length)}:{range:r=o}});return r?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function RQ(i,t,e){let n=null,r=i.changeByRange(s=>s.empty&&Pl(i.doc,s.head)==e?{changes:{from:s.head,to:s.head+e.length,insert:e},range:U.cursor(s.head+e.length)}:n={range:s});return n?null:i.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function _Q(i,t,e,n){let r=n.stringPrefixes||wo.stringPrefixes,s=null,o=i.changeByRange(a=>{if(!a.empty)return{changes:[{insert:t,from:a.from},{insert:t,from:a.to}],effects:Wr.of(a.to+t.length),range:U.range(a.anchor+t.length,a.head+t.length)};let l=a.head,u=Pl(i.doc,l),c;if(u==t){if(cp(i,l))return{changes:{insert:t+t,from:l},effects:Wr.of(l+t.length),range:U.cursor(l+t.length)};if(n1(i,l)){let d=e&&i.sliceDoc(l,l+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:l,to:l+d.length,insert:d},range:U.cursor(l+d.length)}}}else{if(e&&i.sliceDoc(l-2*t.length,l)==t+t&&(c=up(i,l-2*t.length,r))>-1&&cp(i,c))return{changes:{insert:t+t+t+t,from:l},effects:Wr.of(l+t.length),range:U.cursor(l+t.length)};if(i.charCategorizer(l)(u)!=yt.Word&&up(i,l,r)>-1&&!MQ(i,l,t,r))return{changes:{insert:t+t,from:l},effects:Wr.of(l+t.length),range:U.cursor(l+t.length)}}return{range:s=a}});return s?null:i.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function cp(i,t){let e=Si(i).resolveInner(t+1);return e.parent&&e.from==t}function MQ(i,t,e,n){let r=Si(i).resolveInner(t,-1),s=n.reduce((o,a)=>Math.max(o,a.length),0);for(let o=0;o<5;o++){let a=i.sliceDoc(r.from,Math.min(r.to,r.from+e.length+s)),l=a.indexOf(e);if(!l||l>-1&&n.indexOf(a.slice(0,l))>-1){let c=r.firstChild;for(;c&&c.from==r.from&&c.to-c.from>e.length+l;){if(i.sliceDoc(c.to-e.length,c.to)==e)return!1;c=c.firstChild}return!0}let u=r.to==t&&r.parent;if(!u)break;r=u}return!1}function up(i,t,e){let n=i.charCategorizer(t);if(n(i.sliceDoc(t-1,t))!=yt.Word)return t;for(let r of e){let s=t-r.length;if(i.sliceDoc(s,t)==r&&n(i.sliceDoc(s-1,s))!=yt.Word)return s}return-1}function BQ(i={}){return[kQ,Zi,ai.of(i),SQ,FQ,CQ]}const r1=[{key:"Ctrl-Space",run:bc},{mac:"Alt-`",run:bc},{mac:"Alt-i",run:bc},{key:"Escape",run:bQ},{key:"ArrowDown",run:ga(!0)},{key:"ArrowUp",run:ga(!1)},{key:"PageDown",run:ga(!0,"page")},{key:"PageUp",run:ga(!1,"page")},{key:"Enter",run:OQ}],FQ=Jr.highest(Fo.computeN([ai],i=>i.facet(ai).defaultKeymap?[r1]:[]));class hp{constructor(t,e,n){this.from=t,this.to=e,this.diagnostic=n}}class Xr{constructor(t,e,n){this.diagnostics=t,this.panel=e,this.selected=n}static init(t,e,n){let r=n.facet(So).markerFilter;r&&(t=r(t,n));let s=t.slice().sort((f,p)=>f.from-p.from||f.to-p.to),o=new Kn,a=[],l=0,u=n.doc.iter(),c=0,h=n.doc.length;for(let f=0;;){let p=f==s.length?null:s[f];if(!p&&!a.length)break;let g,m;if(a.length)g=l,m=a.reduce((x,S)=>Math.min(x,S.to),p&&p.from>g?p.from:1e8);else{if(g=p.from,g>h)break;m=p.to,a.push(p),f++}for(;f<s.length;){let x=s[f];if(x.from==g&&(x.to>x.from||x.to==g))a.push(x),f++,m=Math.min(x.to,m);else{m=Math.min(x.from,m);break}}m=Math.min(m,h);let O=!1;if(a.some(x=>x.from==g&&(x.to==m||m==h))&&(O=g==m,!O&&m-g<10)){let x=g-(c+u.value.length);x>0&&(u.next(x),c=g);for(let S=g;;){if(S>=m){O=!0;break}if(!u.lineBreak&&c+u.value.length>S)break;S=c+u.value.length,c+=u.value.length,u.next()}}let b=UQ(a);if(O)o.add(g,g,Se.widget({widget:new YQ(b),diagnostics:a.slice()}));else{let x=a.reduce((S,w)=>w.markClass?S+" "+w.markClass:S,"");o.add(g,m,Se.mark({class:"cm-lintRange cm-lintRange-"+b+x,diagnostics:a.slice(),inclusiveEnd:a.some(S=>S.to>m)}))}if(l=m,l==h)break;for(let x=0;x<a.length;x++)a[x].to<=l&&a.splice(x--,1)}let d=o.finish();return new Xr(d,e,Qs(d))}}function Qs(i,t=null,e=0){let n=null;return i.between(e,1e9,(r,s,{spec:o})=>{if(!(t&&o.diagnostics.indexOf(t)<0))if(!n)n=new hp(r,s,t||o.diagnostics[0]);else{if(o.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new hp(n.from,s,n.diagnostic)}}),n}function ZQ(i,t){let e=t.pos,n=t.end||e,r=i.state.facet(So).hideOn(i,e,n);if(r!=null)return r;let s=i.startState.doc.lineAt(t.pos);return!!(i.effects.some(o=>o.is(s1))||i.changes.touchesRange(s.from,Math.max(s.to,n)))}function zQ(i,t){return i.field(Ui,!1)?t:t.concat(Ze.appendConfig.of(HQ))}const s1=Ze.define(),Lh=Ze.define(),o1=Ze.define(),Ui=pi.define({create(){return new Xr(Se.none,null,null)},update(i,t){if(t.docChanged&&i.diagnostics.size){let e=i.diagnostics.map(t.changes),n=null,r=i.panel;if(i.selected){let s=t.changes.mapPos(i.selected.from,1);n=Qs(e,i.selected.diagnostic,s)||Qs(e,null,s)}!e.size&&r&&t.state.facet(So).autoPanel&&(r=null),i=new Xr(e,r,n)}for(let e of t.effects)if(e.is(s1)){let n=t.state.facet(So).autoPanel?e.value.length?vo.open:null:i.panel;i=Xr.init(e.value,n,t.state)}else e.is(Lh)?i=new Xr(i.diagnostics,e.value?vo.open:null,i.selected):e.is(o1)&&(i=new Xr(i.diagnostics,i.panel,e.value));return i},provide:i=>[go.from(i,t=>t.panel),ae.decorations.from(i,t=>t.diagnostics)]}),jQ=Se.mark({class:"cm-lintRange cm-lintRange-active"});function IQ(i,t,e){let{diagnostics:n}=i.state.field(Ui),r,s=-1,o=-1;n.between(t-(e<0?1:0),t+(e>0?1:0),(l,u,{spec:c})=>{if(t>=l&&t<=u&&(l==u||(t>l||e>0)&&(t<u||e<0)))return r=c.diagnostics,s=l,o=u,!1});let a=i.state.facet(So).tooltipFilter;return r&&a&&(r=a(r,i.state)),r?{pos:s,end:o,above:i.state.doc.lineAt(s).to<o,create(){return{dom:LQ(i,r)}}}:null}function LQ(i,t){return ct("ul",{class:"cm-tooltip-lint"},t.map(e=>l1(i,e,!1)))}const XQ=i=>{let t=i.state.field(Ui,!1);(!t||!t.panel)&&i.dispatch({effects:zQ(i.state,[Lh.of(!0)])});let e=po(i,vo.open);return e&&e.dom.querySelector(".cm-panel-lint ul").focus(),!0},dp=i=>{let t=i.state.field(Ui,!1);return!t||!t.panel?!1:(i.dispatch({effects:Lh.of(!1)}),!0)},NQ=i=>{let t=i.state.field(Ui,!1);if(!t)return!1;let e=i.state.selection.main,n=t.diagnostics.iter(e.to+1);return!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==e.from&&n.to==e.to)?!1:(i.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},WQ=[{key:"Mod-Shift-m",run:XQ,preventDefault:!0},{key:"F8",run:NQ}],So=pe.define({combine(i){return{sources:i.map(t=>t.source).filter(t=>t!=null),...zn(i.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:fp,tooltipFilter:fp,needsRefresh:(t,e)=>t?e?n=>t(n)||e(n):t:e,hideOn:(t,e)=>t?e?(n,r,s)=>t(n,r,s)||e(n,r,s):t:e,autoPanel:(t,e)=>t||e})}}});function fp(i,t){return i?t?(e,n)=>t(i(e,n),n):i:t}function a1(i){let t=[];if(i)e:for(let{name:e}of i){for(let n=0;n<e.length;n++){let r=e[n];if(/[a-zA-Z]/.test(r)&&!t.some(s=>s.toLowerCase()==r.toLowerCase())){t.push(r);continue e}}t.push("")}return t}function l1(i,t,e){var n;let r=e?a1(t.actions):[];return ct("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},ct("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(i):t.message),(n=t.actions)===null||n===void 0?void 0:n.map((s,o)=>{let a=!1,l=f=>{if(f.preventDefault(),a)return;a=!0;let p=Qs(i.state.field(Ui).diagnostics,t);p&&s.apply(i,p.from,p.to)},{name:u}=s,c=r[o]?u.indexOf(r[o]):-1,h=c<0?u:[u.slice(0,c),ct("u",u.slice(c,c+1)),u.slice(c+1)],d=s.markClass?" "+s.markClass:"";return ct("button",{type:"button",class:"cm-diagnosticAction"+d,onclick:l,onmousedown:l,"aria-label":` Action: ${u}${c<0?"":` (access key "${r[o]})"`}.`},h)}),t.source&&ct("div",{class:"cm-diagnosticSource"},t.source))}class YQ extends ar{constructor(t){super(),this.sev=t}eq(t){return t.sev==this.sev}toDOM(){return ct("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class pp{constructor(t,e){this.diagnostic=e,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=l1(t,e,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class vo{constructor(t){this.view=t,this.items=[];let e=r=>{if(r.keyCode==27)dp(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=a1(s.actions);for(let a=0;a<o.length;a++)if(o[a].toUpperCase().charCodeAt(0)==r.keyCode){let l=Qs(this.view.state.field(Ui).diagnostics,s);l&&s.actions[a].apply(t,l.from,l.to)}}else return;r.preventDefault()},n=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=ct("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:e,onclick:n}),this.dom=ct("div",{class:"cm-panel-lint"},this.list,ct("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>dp(this.view)},"×")),this.update()}get selectedIndex(){let t=this.view.state.field(Ui).selected;if(!t)return-1;for(let e=0;e<this.items.length;e++)if(this.items[e].diagnostic==t.diagnostic)return e;return-1}update(){let{diagnostics:t,selected:e}=this.view.state.field(Ui),n=0,r=!1,s=null,o=new Set;for(t.between(0,this.view.state.doc.length,(a,l,{spec:u})=>{for(let c of u.diagnostics){if(o.has(c))continue;o.add(c);let h=-1,d;for(let f=n;f<this.items.length;f++)if(this.items[f].diagnostic==c){h=f;break}h<0?(d=new pp(this.view,c),this.items.splice(n,0,d),r=!0):(d=this.items[h],h>n&&(this.items.splice(n,h-n),r=!0)),e&&d.diagnostic==e.diagnostic?d.dom.hasAttribute("aria-selected")||(d.dom.setAttribute("aria-selected","true"),s=d):d.dom.hasAttribute("aria-selected")&&d.dom.removeAttribute("aria-selected"),n++}});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new pp(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:a,panel:l})=>{let u=l.height/this.list.offsetHeight;a.top<l.top?this.list.scrollTop-=(l.top-a.top)/u:a.bottom>l.bottom&&(this.list.scrollTop+=(a.bottom-l.bottom)/u)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let t=this.list.firstChild;function e(){let n=t;t=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;t!=n.dom;)e();t=n.dom.nextSibling}else this.list.insertBefore(n.dom,t);for(;t;)e()}moveSelection(t){if(this.selectedIndex<0)return;let e=this.view.state.field(Ui),n=Qs(e.diagnostics,this.items[t].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:o1.of(n)})}static open(t){return new vo(t)}}function qQ(i,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(i)}</svg>')`}function ma(i){return qQ(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${i}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const VQ=ae.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:ma("#d11")},".cm-lintRange-warning":{backgroundImage:ma("orange")},".cm-lintRange-info":{backgroundImage:ma("#999")},".cm-lintRange-hint":{backgroundImage:ma("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function GQ(i){return i=="error"?4:i=="warning"?3:i=="info"?2:1}function UQ(i){let t="hint",e=1;for(let n of i){let r=GQ(n.severity);r>e&&(e=r,t=n.severity)}return t}const HQ=[Ui,ae.decorations.compute([Ui],i=>{let{selected:t,panel:e}=i.field(Ui);return!t||!e||t.from==t.to?Se.none:Se.set([jQ.range(t.from,t.to)])}),JD(IQ,{hideOn:ZQ}),VQ];var gp=function(t){t===void 0&&(t={});var{crosshairCursor:e=!1}=t,n=[];t.closeBracketsKeymap!==!1&&(n=n.concat(PQ)),t.defaultKeymap!==!1&&(n=n.concat(FO)),t.searchKeymap!==!1&&(n=n.concat(G5)),t.historyKeymap!==!1&&(n=n.concat(cO)),t.foldKeymap!==!1&&(n=n.concat(U$)),t.completionKeymap!==!1&&(n=n.concat(r1)),t.lintKeymap!==!1&&(n=n.concat(WQ));var r=[];return t.lineNumbers!==!1&&r.push($0()),t.highlightActiveLineGutter!==!1&&r.push(Q0()),t.highlightSpecialChars!==!1&&r.push(x0()),t.history!==!1&&r.push(sO()),t.foldGutter!==!1&&r.push(e3()),t.drawSelection!==!1&&r.push(O0()),t.dropCursor!==!1&&r.push(kD()),t.allowMultipleSelections!==!1&&r.push(qe.allowMultipleSelections.of(!0)),t.indentOnInput!==!1&&r.push(I0()),t.syntaxHighlighting!==!1&&r.push(kl(H0,{fallback:!0})),t.bracketMatching!==!1&&r.push(tO()),t.closeBrackets!==!1&&r.push(e1()),t.autocompletion!==!1&&r.push(BQ()),t.rectangularSelection!==!1&&r.push(LD()),e!==!1&&r.push(WD()),t.highlightActiveLine!==!1&&r.push(w0()),t.highlightSelectionMatches!==!1&&r.push(IO()),t.tabSize&&typeof t.tabSize=="number"&&r.push(wl.of(" ".repeat(t.tabSize))),r.concat([Fo.of(n.flat())]).filter(Boolean)};const KQ="#e5c07b",mp="#e06c75",JQ="#56b6c2",eP="#ffffff",Ra="#abb2bf",Fu="#7d8799",tP="#61afef",iP="#98c379",Op="#d19a66",nP="#c678dd",rP="#21252b",bp="#2c313a",yp="#282c34",xc="#353a42",sP="#3E4451",xp="#528bff",oP=ae.theme({"&":{color:Ra,backgroundColor:yp},".cm-content":{caretColor:xp},".cm-cursor, .cm-dropCursor":{borderLeftColor:xp},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:sP},".cm-panels":{backgroundColor:rP,color:Ra},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:yp,color:Fu,border:"none"},".cm-activeLineGutter":{backgroundColor:bp},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:xc},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:xc,borderBottomColor:xc},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:bp,color:Ra}}},{dark:!0}),aP=Ts.define([{tag:T.keyword,color:nP},{tag:[T.name,T.deleted,T.character,T.propertyName,T.macroName],color:mp},{tag:[T.function(T.variableName),T.labelName],color:tP},{tag:[T.color,T.constant(T.name),T.standard(T.name)],color:Op},{tag:[T.definition(T.name),T.separator],color:Ra},{tag:[T.typeName,T.className,T.number,T.changed,T.annotation,T.modifier,T.self,T.namespace],color:KQ},{tag:[T.operator,T.operatorKeyword,T.url,T.escape,T.regexp,T.link,T.special(T.string)],color:JQ},{tag:[T.meta,T.comment],color:Fu},{tag:T.strong,fontWeight:"bold"},{tag:T.emphasis,fontStyle:"italic"},{tag:T.strikethrough,textDecoration:"line-through"},{tag:T.link,color:Fu,textDecoration:"underline"},{tag:T.heading,fontWeight:"bold",color:mp},{tag:[T.atom,T.bool,T.special(T.variableName)],color:Op},{tag:[T.processingInstruction,T.string,T.inserted],color:iP},{tag:T.invalid,color:eP}]),lP=[oP,kl(aP)];var cP=ae.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),uP=function(t){t===void 0&&(t={});var{indentWithTab:e=!0,editable:n=!0,readOnly:r=!1,theme:s="light",placeholder:o="",basicSetup:a=!0}=t,l=[];switch(e&&l.unshift(Fo.of([C5])),a&&(typeof a=="boolean"?l.unshift(gp()):l.unshift(gp(a))),o&&l.unshift(ZD(o)),s){case"light":l.push(cP);break;case"dark":l.push(lP);break;case"none":break;default:l.push(s);break}return n===!1&&l.push(ae.editable.of(!1)),r&&l.push(qe.readOnly.of(!0)),[...l]},hP=i=>({line:i.state.doc.lineAt(i.state.selection.main.from),lineCount:i.state.doc.lines,lineBreak:i.state.lineBreak,length:i.state.doc.length,readOnly:i.state.readOnly,tabSize:i.state.tabSize,selection:i.state.selection,selectionAsSingle:i.state.selection.asSingle().main,ranges:i.state.selection.ranges,selectionCode:i.state.sliceDoc(i.state.selection.main.from,i.state.selection.main.to),selections:i.state.selection.ranges.map(t=>i.state.sliceDoc(t.from,t.to)),selectedText:i.state.selection.ranges.some(t=>!t.empty)});class dP{constructor(t,e){this.timeLeftMS=void 0,this.timeoutMS=void 0,this.isCancelled=!1,this.isTimeExhausted=!1,this.callbacks=[],this.timeLeftMS=e,this.timeoutMS=e,this.callbacks.push(t)}tick(){if(!this.isCancelled&&!this.isTimeExhausted&&(this.timeLeftMS--,this.timeLeftMS<=0)){this.isTimeExhausted=!0;var t=this.callbacks.slice();this.callbacks.length=0,t.forEach(e=>{try{e()}catch(n){console.error("TimeoutLatch callback error:",n)}})}}cancel(){this.isCancelled=!0,this.callbacks.length=0}reset(){this.timeLeftMS=this.timeoutMS,this.isCancelled=!1,this.isTimeExhausted=!1}get isDone(){return this.isCancelled||this.isTimeExhausted}}class wp{constructor(){this.interval=null,this.latches=new Set}add(t){this.latches.add(t),this.start()}remove(t){this.latches.delete(t),this.latches.size===0&&this.stop()}start(){this.interval===null&&(this.interval=setInterval(()=>{this.latches.forEach(t=>{t.tick(),t.isDone&&this.remove(t)})},1))}stop(){this.interval!==null&&(clearInterval(this.interval),this.interval=null)}}var wc=null,fP=()=>typeof window>"u"?new wp:(wc||(wc=new wp),wc),Sp=Zn.define(),pP=200,gP=[];function mP(i){var{value:t,selection:e,onChange:n,onStatistics:r,onCreateEditor:s,onUpdate:o,extensions:a=gP,autoFocus:l,theme:u="light",height:c=null,minHeight:h=null,maxHeight:d=null,width:f=null,minWidth:p=null,maxWidth:g=null,placeholder:m="",editable:O=!0,readOnly:b=!1,indentWithTab:x=!0,basicSetup:S=!0,root:w,initialState:v}=i,[D,R]=C.useState(),[$,k]=C.useState(),[A,P]=C.useState(),Q=C.useState(()=>({current:null}))[0],M=C.useState(()=>({current:null}))[0],B=ae.theme({"&":{height:c,minHeight:h,maxHeight:d,width:f,minWidth:p,maxWidth:g},"& .cm-scroller":{height:"100% !important"}}),W=ae.updateListener.of(_=>{if(_.docChanged&&typeof n=="function"&&!_.transactions.some(E=>E.annotation(Sp))){Q.current?Q.current.reset():(Q.current=new dP(()=>{if(M.current){var E=M.current;M.current=null,E()}Q.current=null},pP),fP().add(Q.current));var j=_.state.doc,q=j.toString();n(q,_)}r&&r(hP(_))}),X=uP({theme:u,editable:O,readOnly:b,placeholder:m,indentWithTab:x,basicSetup:S}),F=[W,B,...X];return o&&typeof o=="function"&&F.push(ae.updateListener.of(o)),F=F.concat(a),C.useLayoutEffect(()=>{if(D&&!A){var _={doc:t,selection:e,extensions:F},j=v?qe.fromJSON(v.json,_,v.fields):qe.create(_);if(P(j),!$){var q=new ae({state:j,parent:D,root:w});k(q),s&&s(q,j)}}return()=>{$&&(P(void 0),k(void 0))}},[D,A]),C.useEffect(()=>{i.container&&R(i.container)},[i.container]),C.useEffect(()=>()=>{$&&($.destroy(),k(void 0)),Q.current&&(Q.current.cancel(),Q.current=null)},[$]),C.useEffect(()=>{l&&$&&$.focus()},[l,$]),C.useEffect(()=>{$&&$.dispatch({effects:Ze.reconfigure.of(F)})},[u,a,c,h,d,f,p,g,m,O,b,x,S,n,o]),C.useEffect(()=>{if(t!==void 0){var _=$?$.state.doc.toString():"";if($&&t!==_){var j=Q.current&&!Q.current.isDone,q=()=>{$&&t!==$.state.doc.toString()&&$.dispatch({changes:{from:0,to:$.state.doc.toString().length,insert:t||""},annotations:[Sp.of(!0)]})};j?M.current=q:q()}}},[t,$]),{state:A,setState:P,view:$,setView:k,container:D,setContainer:R}}var OP=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],c1=C.forwardRef((i,t)=>{var{className:e,value:n="",selection:r,extensions:s=[],onChange:o,onStatistics:a,onCreateEditor:l,onUpdate:u,autoFocus:c,theme:h="light",height:d,minHeight:f,maxHeight:p,width:g,minWidth:m,maxWidth:O,basicSetup:b,placeholder:x,indentWithTab:S,editable:w,readOnly:v,root:D,initialState:R}=i,$=Z1(i,OP),k=C.useRef(null),{state:A,view:P,container:Q,setContainer:M}=mP({root:D,value:n,autoFocus:c,theme:h,height:d,minHeight:f,maxHeight:p,width:g,minWidth:m,maxWidth:O,basicSetup:b,placeholder:x,indentWithTab:S,editable:w,readOnly:v,selection:r,onChange:o,onStatistics:a,onCreateEditor:l,onUpdate:u,extensions:s,initialState:R});C.useImperativeHandle(t,()=>({editor:k.current,state:A,view:P}),[k,Q,A,P]);var B=C.useCallback(X=>{k.current=X,M(X)},[M]);if(typeof n!="string")throw new Error("value must be typeof string but got "+typeof n);var W=typeof h=="string"?"cm-theme-"+h:"cm-theme";return y.jsx("div",z1({ref:B,className:""+W+(e?" "+e:"")},$))});c1.displayName="CodeMirror";var vp={};class sl{constructor(t,e,n,r,s,o,a,l,u,c=0,h){this.p=t,this.stack=e,this.state=n,this.reducePos=r,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=u,this.lookAhead=c,this.parent=h}toString(){return`[${this.stack.filter((t,e)=>e%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,n=0){let r=t.parser.context;return new sl(t,[],e,n,n,0,[],0,r?new kp(r,r.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){var e;let n=t>>19,r=t&65535,{parser:s}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=s.dynamicPrecedence(r);if(a&&(this.score+=a),n==0){this.pushState(s.getGoto(this.state,r,!0),this.reducePos),r<s.minRepeatTerm&&this.storeNode(r,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(r,this.reducePos);return}let l=this.stack.length-(n-1)*3-(t&262144?6:0),u=l?this.stack[l-2]:this.p.ranges[0].from,c=this.reducePos-u;c>=2e3&&!(!((e=this.p.parser.nodeSet.types[r])===null||e===void 0)&&e.isAnonymous)&&(u==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=u,this.p.lastBigReductionSize=c));let h=l?this.stack[l-1]:0,d=this.bufferBase+this.buffer.length-h;if(r<s.minRepeatTerm||t&131072){let f=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(r,u,f,d+4,!0)}if(t&262144)this.state=this.stack[l];else{let f=this.stack[l-3];this.state=s.getGoto(f,r,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(r,u)}storeNode(t,e,n,r=4,s=!1){if(t==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(e==n)return;if(o.buffer[a-2]>=e){o.buffer[a-2]=n;return}}}if(!s||this.pos==n)this.buffer.push(t,e,n,r);else{let o=this.buffer.length;if(o>0&&(this.buffer[o-4]!=0||this.buffer[o-1]<0)){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>n;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>n;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,r>4&&(r-=4)}this.buffer[o]=t,this.buffer[o+1]=e,this.buffer[o+2]=n,this.buffer[o+3]=r}}shift(t,e,n,r){if(t&131072)this.pushState(t&65535,this.pos);else if((t&262144)==0){let s=t,{parser:o}=this.p;(r>this.pos||e<=o.maxNode)&&(this.pos=r,o.stateFlag(s,1)||(this.reducePos=r)),this.pushState(s,n),this.shiftContext(e,n),e<=o.maxNode&&this.buffer.push(e,n,r,4)}else this.pos=r,this.shiftContext(e,n),e<=this.p.parser.maxNode&&this.buffer.push(e,n,r,4)}apply(t,e,n,r){t&65536?this.reduce(t):this.shift(t,e,n,r)}useNode(t,e){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=t)&&(this.p.reused.push(t),n++);let r=this.pos;this.reducePos=this.pos=r+t.length,this.pushState(e,r),this.buffer.push(n,r,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let n=t.buffer.slice(e),r=t.bufferBase+e;for(;t&&r==t.bufferBase;)t=t.parent;return new sl(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,r,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){let n=t<=this.p.parser.maxNode;n&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,n?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(t){for(let e=new bP(this);;){let n=this.p.parser.stateSlot(e.state,4)||this.p.parser.hasAction(e.state,t);if(n==0)return!1;if((n&65536)==0)return!0;e.reduce(n)}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let r=[];for(let s=0,o;s<e.length;s+=2)(o=e[s+1])!=this.state&&this.p.parser.hasAction(o,t)&&r.push(e[s],o);if(this.stack.length<120)for(let s=0;r.length<8&&s<e.length;s+=2){let o=e[s+1];r.some((a,l)=>l&1&&a==o)||r.push(e[s],o)}e=r}let n=[];for(let r=0;r<e.length&&n.length<4;r+=2){let s=e[r+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(e[r],this.pos),o.reducePos=this.pos,o.score-=200,n.push(o)}return n}forceReduce(){let{parser:t}=this.p,e=t.stateSlot(this.state,5);if((e&65536)==0)return!1;if(!t.validAction(this.state,e)){let n=e>>19,r=e&65535,s=this.stack.length-n*3;if(s<0||t.getGoto(this.stack[s],r,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;e=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(e),!0}findForcedReduction(){let{parser:t}=this.p,e=[],n=(r,s)=>{if(!e.includes(r))return e.push(r),t.allActions(r,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-s;if(a>1){let l=o&65535,u=this.stack.length-a*3;if(u>=0&&t.getGoto(this.stack[u],l,!1)>=0)return a<<19|65536|l}}else{let a=n(o,s+1);if(a!=null)return a}})};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:t}=this.p;return t.data[t.stateSlot(this.state,1)]==65535&&!t.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(t){if(t!=this.curContext.context){let e=new kp(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class kp{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}class bP{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let e=t&65535,n=t>>19;n==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(n-1)*3;let r=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=r}}class ol{constructor(t,e,n){this.stack=t,this.pos=e,this.index=n,this.buffer=t.buffer,this.index==0&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new ol(t,e,e-t.bufferBase)}maybeNext(){let t=this.stack.parent;t!=null&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new ol(this.stack,this.pos,this.index)}}function Gs(i,t=Uint16Array){if(typeof i!="string")return i;let e=null;for(let n=0,r=0;n<i.length;){let s=0;for(;;){let o=i.charCodeAt(n++),a=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),s+=l,a)break;s*=46}e?e[r++]=s:e=new t(s)}return e}class _a{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Cp=new _a;class yP{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Cp,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let n=this.range,r=this.rangeIndex,s=this.pos+t;for(;s<n.from;){if(!r)return null;let o=this.ranges[--r];s-=n.from-o.to,n=o}for(;e<0?s>n.to:s>=n.to;){if(r==this.ranges.length-1)return null;let o=this.ranges[++r];s+=o.from-n.to,n=o}return s}clipPos(t){if(t>=this.range.from&&t<this.range.to)return t;for(let e of this.ranges)if(e.to>t)return Math.max(t,e.from);return this.end}peek(t){let e=this.chunkOff+t,n,r;if(e>=0&&e<this.chunk.length)n=this.pos+t,r=this.chunk.charCodeAt(e);else{let s=this.resolveOffset(t,1);if(s==null)return-1;if(n=s,n>=this.chunk2Pos&&n<this.chunk2Pos+this.chunk2.length)r=this.chunk2.charCodeAt(n-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=n;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=n),n+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-n)),r=this.chunk2.charCodeAt(0)}}return n>=this.token.lookAhead&&(this.token.lookAhead=n+1),r}acceptToken(t,e=0){let n=e?this.resolveOffset(e,-1):this.pos;if(n==null||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=n}acceptTokenTo(t,e){this.token.value=t,this.token.end=e}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?(this.token=e,e.start=t,e.lookAhead=t+1,e.value=e.extended=-1):this.token=Cp,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.chunk2Pos&&e<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,e-this.chunk2Pos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let n="";for(let r of this.ranges){if(r.from>=e)break;r.to>t&&(n+=this.input.read(Math.max(r.from,t),Math.min(r.to,e)))}return n}}class Os{constructor(t,e){this.data=t,this.id=e}token(t,e){let{parser:n}=e.p;u1(this.data,t,e,this.id,n.data,n.tokenPrecTable)}}Os.prototype.contextual=Os.prototype.fallback=Os.prototype.extend=!1;class Zu{constructor(t,e,n){this.precTable=e,this.elseToken=n,this.data=typeof t=="string"?Gs(t):t}token(t,e){let n=t.pos,r=0;for(;;){let s=t.next<0,o=t.resolveOffset(1,1);if(u1(this.data,t,e,0,this.data,this.precTable),t.token.value>-1)break;if(this.elseToken==null)return;if(s||r++,o==null)break;t.reset(o,t.token)}r&&(t.reset(n,t.token),t.acceptToken(this.elseToken,r))}}Zu.prototype.contextual=Os.prototype.fallback=Os.prototype.extend=!1;class Lo{constructor(t,e={}){this.token=t,this.contextual=!!e.contextual,this.fallback=!!e.fallback,this.extend=!!e.extend}}function u1(i,t,e,n,r,s){let o=0,a=1<<n,{dialect:l}=e.p.parser;e:for(;(a&i[o])!=0;){let u=i[o+1];for(let f=o+3;f<u;f+=2)if((i[f+1]&a)>0){let p=i[f];if(l.allows(p)&&(t.token.value==-1||t.token.value==p||xP(p,t.token.value,r,s))){t.acceptToken(p);break}}let c=t.next,h=0,d=i[o+2];if(t.next<0&&d>h&&i[u+d*3-3]==65535){o=i[u+d*3-1];continue e}for(;h<d;){let f=h+d>>1,p=u+f+(f<<1),g=i[p],m=i[p+1]||65536;if(c<g)d=f;else if(c>=m)h=f+1;else{o=i[p+2],t.advance();continue e}}break}}function Dp(i,t,e){for(let n=t,r;(r=i[n])!=65535;n++)if(r==e)return n-t;return-1}function xP(i,t,e,n){let r=Dp(e,n,t);return r<0||Dp(e,n,i)<r}const qi=typeof process<"u"&&vp&&/\bparse\b/.test(vp.LOG);let Sc=null;function $p(i,t,e){let n=i.cursor(si.IncludeAnonymous);for(n.moveTo(t);;)if(!(e<0?n.childBefore(t):n.childAfter(t)))for(;;){if((e<0?n.to<t:n.from>t)&&!n.type.isError)return e<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(i.length,Math.max(n.from+1,t+25));if(e<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return e<0?0:i.length}}class wP{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?$p(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?$p(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let n=this.trees[e],r=this.index[e];if(r==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=n.children[r],o=this.start[e]+n.positions[r];if(o>t)return this.nextStart=o,null;if(s instanceof Zt){if(o==t){if(o<this.safeFrom)return null;let a=o+s.length;if(a<=this.safeTo){let l=s.prop(Ie.lookAhead);if(!l||a+l<this.fragment.to)return s}}this.index[e]++,o+s.length>=Math.max(this.safeFrom,t)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[e]++,this.nextStart=o+s.length}}}class SP{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map(n=>new _a)}getActions(t){let e=0,n=null,{parser:r}=t.p,{tokenizers:s}=r,o=r.stateSlot(t.state,3),a=t.curContext?t.curContext.hash:0,l=0;for(let u=0;u<s.length;u++){if((1<<u&o)==0)continue;let c=s[u],h=this.tokens[u];if(!(n&&!c.fallback)&&((c.contextual||h.start!=t.pos||h.mask!=o||h.context!=a)&&(this.updateCachedToken(h,c,t),h.mask=o,h.context=a),h.lookAhead>h.end+25&&(l=Math.max(h.lookAhead,l)),h.value!=0)){let d=e;if(h.extended>-1&&(e=this.addActions(t,h.extended,h.end,e)),e=this.addActions(t,h.value,h.end,e),!c.extend&&(n=h,e>d))break}}for(;this.actions.length>e;)this.actions.pop();return l&&t.setLookAhead(l),!n&&t.pos==this.stream.end&&(n=new _a,n.value=t.p.parser.eofTerm,n.start=n.end=t.pos,e=this.addActions(t,n.value,n.end,e)),this.mainToken=n,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let e=new _a,{pos:n,p:r}=t;return e.start=n,e.end=Math.min(n+1,r.stream.end),e.value=n==r.stream.end?r.parser.eofTerm:0,e}updateCachedToken(t,e,n){let r=this.stream.clipPos(n.pos);if(e.token(this.stream.reset(r,t),n),t.value>-1){let{parser:s}=n.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==t.value){let a=s.specializers[o](this.stream.read(t.start,t.end),n);if(a>=0&&n.p.parser.dialect.allows(a>>1)){(a&1)==0?t.value=a>>1:t.extended=a>>1;break}}}else t.value=0,t.end=this.stream.clipPos(r+1)}putAction(t,e,n,r){for(let s=0;s<r;s+=3)if(this.actions[s]==t)return r;return this.actions[r++]=t,this.actions[r++]=e,this.actions[r++]=n,r}addActions(t,e,n,r){let{state:s}=t,{parser:o}=t.p,{data:a}=o;for(let l=0;l<2;l++)for(let u=o.stateSlot(s,l?2:1);;u+=3){if(a[u]==65535)if(a[u+1]==1)u=Nn(a,u+2);else{r==0&&a[u+1]==2&&(r=this.putAction(Nn(a,u+2),e,n,r));break}a[u]==e&&(r=this.putAction(Nn(a,u+1),e,n,r))}return r}}class vP{constructor(t,e,n,r){this.parser=t,this.input=e,this.ranges=r,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new yP(e,r),this.tokens=new SP(t,this.stream),this.topTerm=t.top[1];let{from:s}=r[0];this.stacks=[sl.start(this,t.top[0],s)],this.fragments=n.length&&this.stream.end-s>t.bufferLength*4?new wP(n,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t=this.stacks,e=this.minStackPos,n=this.stacks=[],r,s;if(this.bigReductionCount>300&&t.length==1){let[o]=t;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<t.length;o++){let a=t[o];for(;;){if(this.tokens.mainToken=null,a.pos>e)n.push(a);else{if(this.advanceStack(a,n,t))continue;{r||(r=[],s=[]),r.push(a);let l=this.tokens.getMainToken(a);s.push(l.value,l.end)}}break}}if(!n.length){let o=r&&DP(r);if(o)return qi&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw qi&&r&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+e);this.recovering||(this.recovering=5)}if(this.recovering&&r){let o=this.stoppedAt!=null&&r[0].pos>this.stoppedAt?r[0]:this.runRecovery(r,s,n);if(o)return qi&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(n.length>o)for(n.sort((a,l)=>l.score-a.score);n.length>o;)n.pop();n.some(a=>a.reducePos>e)&&this.recovering--}else if(n.length>1){e:for(let o=0;o<n.length-1;o++){let a=n[o];for(let l=o+1;l<n.length;l++){let u=n[l];if(a.sameState(u)||a.buffer.length>500&&u.buffer.length>500)if((a.score-u.score||a.buffer.length-u.buffer.length)>0)n.splice(l--,1);else{n.splice(o--,1);continue e}}}n.length>12&&n.splice(12,n.length-12)}this.minStackPos=n[0].pos;for(let o=1;o<n.length;o++)n[o].pos<this.minStackPos&&(this.minStackPos=n[o].pos);return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,e,n){let r=t.pos,{parser:s}=this,o=qi?this.stackID(t)+" -> ":"";if(this.stoppedAt!=null&&r>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let u=t.curContext&&t.curContext.tracker.strict,c=u?t.curContext.hash:0;for(let h=this.fragments.nodeAt(r);h;){let d=this.parser.nodeSet.types[h.type.id]==h.type?s.getGoto(t.state,h.type.id):-1;if(d>-1&&h.length&&(!u||(h.prop(Ie.contextHash)||0)==c))return t.useNode(h,d),qi&&console.log(o+this.stackID(t)+` (via reuse of ${s.getName(h.type.id)})`),!0;if(!(h instanceof Zt)||h.children.length==0||h.positions[0]>0)break;let f=h.children[0];if(f instanceof Zt&&h.positions[0]==0)h=f;else break}}let a=s.stateSlot(t.state,4);if(a>0)return t.reduce(a),qi&&console.log(o+this.stackID(t)+` (via always-reduce ${s.getName(a&65535)})`),!0;if(t.stack.length>=8400)for(;t.stack.length>6e3&&t.forceReduce(););let l=this.tokens.getActions(t);for(let u=0;u<l.length;){let c=l[u++],h=l[u++],d=l[u++],f=u==l.length||!n,p=f?t:t.split(),g=this.tokens.mainToken;if(p.apply(c,h,g?g.start:p.pos,d),qi&&console.log(o+this.stackID(p)+` (via ${(c&65536)==0?"shift":`reduce of ${s.getName(c&65535)}`} for ${s.getName(h)} @ ${r}${p==t?"":", split"})`),f)return!0;p.pos>r?e.push(p):n.push(p)}return!1}advanceFully(t,e){let n=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>n)return Qp(t,e),!0}}runRecovery(t,e,n){let r=null,s=!1;for(let o=0;o<t.length;o++){let a=t[o],l=e[o<<1],u=e[(o<<1)+1],c=qi?this.stackID(a)+" -> ":"";if(a.deadEnd&&(s||(s=!0,a.restart(),qi&&console.log(c+this.stackID(a)+" (restarted)"),this.advanceFully(a,n))))continue;let h=a.split(),d=c;for(let f=0;f<10&&h.forceReduce()&&(qi&&console.log(d+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,n));f++)qi&&(d=this.stackID(h)+" -> ");for(let f of a.recoverByInsert(l))qi&&console.log(c+this.stackID(f)+" (via recover-insert)"),this.advanceFully(f,n);this.stream.end>a.pos?(u==a.pos&&(u++,l=0),a.recoverByDelete(l,u),qi&&console.log(c+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),Qp(a,n)):(!r||r.score<a.score)&&(r=a)}return r}stackToTree(t){return t.close(),Zt.build({buffer:ol.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(Sc||(Sc=new WeakMap)).get(t);return e||Sc.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function Qp(i,t){for(let e=0;e<t.length;e++){let n=t[e];if(n.pos==i.pos&&n.sameState(i)){t[e].score<i.score&&(t[e]=i);return}}t.push(i)}class kP{constructor(t,e,n){this.source=t,this.flags=e,this.disabled=n}allows(t){return!this.disabled||this.disabled[t]==0}}const vc=i=>i;class CP{constructor(t){this.start=t.start,this.shift=t.shift||vc,this.reduce=t.reduce||vc,this.reuse=t.reuse||vc,this.hash=t.hash||(()=>0),this.strict=t.strict!==!1}}class al extends R0{constructor(t){if(super(),this.wrappers=[],t.version!=14)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (14)`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let a=0;a<t.repeatNodeCount;a++)e.push("");let n=Object.keys(t.topRules).map(a=>t.topRules[a][1]),r=[];for(let a=0;a<e.length;a++)r.push([]);function s(a,l,u){r[a].push([l,l.deserialize(String(u))])}if(t.nodeProps)for(let a of t.nodeProps){let l=a[0];typeof l=="string"&&(l=Ie[l]);for(let u=1;u<a.length;){let c=a[u++];if(c>=0)s(c,l,a[u++]);else{let h=a[u+-c];for(let d=-c;d>0;d--)s(a[u++],l,h);u++}}}this.nodeSet=new Dh(e.map((a,l)=>Ii.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:r[l],top:n.indexOf(l)>-1,error:l==0,skipped:t.skippedNodes&&t.skippedNodes.indexOf(l)>-1}))),t.propSources&&(this.nodeSet=this.nodeSet.extend(...t.propSources)),this.strict=!1,this.bufferLength=P0;let o=Gs(t.tokenData);this.context=t.context,this.specializerSpecs=t.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(Pp),this.states=Gs(t.states,Uint32Array),this.data=Gs(t.stateData),this.goto=Gs(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map(a=>typeof a=="number"?new Os(o,a):a),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,n){let r=new vP(this,t,e,n);for(let s of this.wrappers)r=s(r,t,e,n);return r}getGoto(t,e,n=!1){let r=this.goto;if(e>=r[0])return-1;for(let s=r[e+1];;){let o=r[s++],a=o&1,l=r[s++];if(a&&n)return l;for(let u=s+(o>>1);s<u;s++)if(r[s]==t)return l;if(a)return-1}}hasAction(t,e){let n=this.data;for(let r=0;r<2;r++)for(let s=this.stateSlot(t,r?2:1),o;;s+=3){if((o=n[s])==65535)if(n[s+1]==1)o=n[s=Nn(n,s+2)];else{if(n[s+1]==2)return Nn(n,s+2);break}if(o==e||o==0)return Nn(n,s+1)}return 0}stateSlot(t,e){return this.states[t*6+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}validAction(t,e){return!!this.allActions(t,n=>n==e?!0:null)}allActions(t,e){let n=this.stateSlot(t,4),r=n?e(n):void 0;for(let s=this.stateSlot(t,1);r==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=Nn(this.data,s+2);else break;r=e(Nn(this.data,s+1))}return r}nextStates(t){let e=[];for(let n=this.stateSlot(t,1);;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=Nn(this.data,n+2);else break;if((this.data[n+2]&1)==0){let r=this.data[n+1];e.some((s,o)=>o&1&&s==r)||e.push(this.data[n],r)}}return e}configure(t){let e=Object.assign(Object.create(al.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let n=this.topRules[t.top];if(!n)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=n}return t.tokenizers&&(e.tokenizers=this.tokenizers.map(n=>{let r=t.tokenizers.find(s=>s.from==n);return r?r.to:n})),t.specializers&&(e.specializers=this.specializers.slice(),e.specializerSpecs=this.specializerSpecs.map((n,r)=>{let s=t.specializers.find(a=>a.from==n.external);if(!s)return n;let o=Object.assign(Object.assign({},n),{external:s.to});return e.specializers[r]=Pp(o),o})),t.contextTracker&&(e.context=t.contextTracker),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),t.strict!=null&&(e.strict=t.strict),t.wrap&&(e.wrappers=e.wrappers.concat(t.wrap)),t.bufferLength!=null&&(e.bufferLength=t.bufferLength),e}hasWrappers(){return this.wrappers.length>0}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return e==null?0:e[t]||0}parseDialect(t){let e=Object.keys(this.dialects),n=e.map(()=>!1);if(t)for(let s of t.split(" ")){let o=e.indexOf(s);o>=0&&(n[o]=!0)}let r=null;for(let s=0;s<e.length;s++)if(!n[s])for(let o=this.dialects[e[s]],a;(a=this.data[o++])!=65535;)(r||(r=new Uint8Array(this.maxTerm+1)))[a]=1;return new kP(t,n,r)}static deserialize(t){return new al(t)}}function Nn(i,t){return i[t]|i[t+1]<<16}function DP(i){let t=null;for(let e of i){let n=e.p.stoppedAt;(e.pos==e.p.stream.end||n!=null&&e.pos>n)&&e.p.parser.stateFlag(e.state,2)&&(!t||t.score<e.score)&&(t=e)}return t}function Pp(i){if(i.external){let t=i.extend?1:0;return(e,n)=>i.external(e,n)<<1|t}return i.get}const $P=316,QP=317,Ap=1,PP=2,AP=3,EP=4,TP=318,RP=320,_P=321,MP=5,BP=6,FP=0,zu=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],h1=125,ZP=59,ju=47,zP=42,jP=43,IP=45,LP=60,XP=44,NP=63,WP=46,YP=91,qP=new CP({start:!1,shift(i,t){return t==MP||t==BP||t==RP?i:t==_P},strict:!1}),VP=new Lo((i,t)=>{let{next:e}=i;(e==h1||e==-1||t.context)&&i.acceptToken(TP)},{contextual:!0,fallback:!0}),GP=new Lo((i,t)=>{let{next:e}=i,n;zu.indexOf(e)>-1||e==ju&&((n=i.peek(1))==ju||n==zP)||e!=h1&&e!=ZP&&e!=-1&&!t.context&&i.acceptToken($P)},{contextual:!0}),UP=new Lo((i,t)=>{i.next==YP&&!t.context&&i.acceptToken(QP)},{contextual:!0}),HP=new Lo((i,t)=>{let{next:e}=i;if(e==jP||e==IP){if(i.advance(),e==i.next){i.advance();let n=!t.context&&t.canShift(Ap);i.acceptToken(n?Ap:PP)}}else e==NP&&i.peek(1)==WP&&(i.advance(),i.advance(),(i.next<48||i.next>57)&&i.acceptToken(AP))},{contextual:!0});function kc(i,t){return i>=65&&i<=90||i>=97&&i<=122||i==95||i>=192||!t&&i>=48&&i<=57}const KP=new Lo((i,t)=>{if(i.next!=LP||!t.dialectEnabled(FP)||(i.advance(),i.next==ju))return;let e=0;for(;zu.indexOf(i.next)>-1;)i.advance(),e++;if(kc(i.next,!0)){for(i.advance(),e++;kc(i.next,!1);)i.advance(),e++;for(;zu.indexOf(i.next)>-1;)i.advance(),e++;if(i.next==XP)return;for(let n=0;;n++){if(n==7){if(!kc(i.next,!0))return;break}if(i.next!="extends".charCodeAt(n))break;i.advance(),e++}}i.acceptToken(EP,-e)}),JP=_0({"get set async static":T.modifier,"for while do if else switch try catch finally return throw break continue default case defer":T.controlKeyword,"in of await yield void typeof delete instanceof as satisfies":T.operatorKeyword,"let var const using function class extends":T.definitionKeyword,"import export from":T.moduleKeyword,"with debugger new":T.keyword,TemplateString:T.special(T.string),super:T.atom,BooleanLiteral:T.bool,this:T.self,null:T.null,Star:T.modifier,VariableName:T.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":T.function(T.variableName),VariableDefinition:T.definition(T.variableName),Label:T.labelName,PropertyName:T.propertyName,PrivatePropertyName:T.special(T.propertyName),"CallExpression/MemberExpression/PropertyName":T.function(T.propertyName),"FunctionDeclaration/VariableDefinition":T.function(T.definition(T.variableName)),"ClassDeclaration/VariableDefinition":T.definition(T.className),"NewExpression/VariableName":T.className,PropertyDefinition:T.definition(T.propertyName),PrivatePropertyDefinition:T.definition(T.special(T.propertyName)),UpdateOp:T.updateOperator,"LineComment Hashbang":T.lineComment,BlockComment:T.blockComment,Number:T.number,String:T.string,Escape:T.escape,ArithOp:T.arithmeticOperator,LogicOp:T.logicOperator,BitOp:T.bitwiseOperator,CompareOp:T.compareOperator,RegExp:T.regexp,Equals:T.definitionOperator,Arrow:T.function(T.punctuation),": Spread":T.punctuation,"( )":T.paren,"[ ]":T.squareBracket,"{ }":T.brace,"InterpolationStart InterpolationEnd":T.special(T.brace),".":T.derefOperator,", ;":T.separator,"@":T.meta,TypeName:T.typeName,TypeDefinition:T.definition(T.typeName),"type enum interface implements namespace module declare":T.definitionKeyword,"abstract global Privacy readonly override":T.modifier,"is keyof unique infer asserts":T.operatorKeyword,JSXAttributeValue:T.attributeValue,JSXText:T.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":T.angleBracket,"JSXIdentifier JSXNameSpacedName":T.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":T.attributeName,"JSXBuiltin/JSXIdentifier":T.standard(T.tagName)}),e4={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,in:52,out:55,const:56,extends:60,this:64,true:72,false:72,null:84,void:88,typeof:92,super:108,new:142,delete:154,yield:163,await:167,class:172,public:235,private:235,protected:235,readonly:237,instanceof:256,satisfies:259,import:292,keyof:349,unique:353,infer:359,asserts:395,is:397,abstract:417,implements:419,type:421,let:424,var:426,using:429,interface:435,enum:439,namespace:445,module:447,declare:451,global:455,defer:471,for:476,of:485,while:488,with:492,do:496,if:500,else:502,switch:506,case:512,try:518,catch:522,finally:526,return:530,throw:534,break:538,continue:542,debugger:546},t4={__proto__:null,async:129,get:131,set:133,declare:195,public:197,private:197,protected:197,static:199,abstract:201,override:203,readonly:209,accessor:211,new:401},i4={__proto__:null,"<":193},n4=al.deserialize({version:14,states:"$F|Q%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#DaO.QQlO'#DgO.bQlO'#DrO%[QlO'#DzO0fQlO'#ESOOQ!0Lf'#E['#E[O1PQ`O'#EXOOQO'#Ep'#EpOOQO'#Il'#IlO1XQ`O'#GsO1dQ`O'#EoO1iQ`O'#EoO3hQ!0MxO'#JrO6[Q!0MxO'#JsO6uQ`O'#F]O6zQ,UO'#FtOOQ!0Lf'#Ff'#FfO7VO7dO'#FfO9XQMhO'#F|O9`Q`O'#F{OOQ!0Lf'#Js'#JsOOQ!0Lb'#Jr'#JrO9eQ`O'#GwOOQ['#K_'#K_O9pQ`O'#IYO9uQ!0LrO'#IZOOQ['#J`'#J`OOQ['#I_'#I_Q`QlOOQ`QlOOO9}Q!L^O'#DvO:UQlO'#EOO:]QlO'#EQO9kQ`O'#GsO:dQMhO'#CoO:rQ`O'#EnO:}Q`O'#EyO;hQMhO'#FeO;xQ`O'#GsOOQO'#K`'#K`O;}Q`O'#K`O<]Q`O'#G{O<]Q`O'#G|O<]Q`O'#HOO9kQ`O'#HRO=SQ`O'#HUO>kQ`O'#CeO>{Q`O'#HcO?TQ`O'#HiO?TQ`O'#HkO`QlO'#HmO?TQ`O'#HoO?TQ`O'#HrO?YQ`O'#HxO?_Q!0LsO'#IOO%[QlO'#IQO?jQ!0LsO'#ISO?uQ!0LsO'#IUO9uQ!0LrO'#IWO@QQ!0MxO'#CiOASQpO'#DlQOQ`OOO%[QlO'#EQOAjQ`O'#ETO:dQMhO'#EnOAuQ`O'#EnOBQQ!bO'#FeOOQ['#Cg'#CgOOQ!0Lb'#Dq'#DqOOQ!0Lb'#Jv'#JvO%[QlO'#JvOOQO'#Jy'#JyOOQO'#Ih'#IhOCQQpO'#EgOOQ!0Lb'#Ef'#EfOOQ!0Lb'#J}'#J}OC|Q!0MSO'#EgODWQpO'#EWOOQO'#Jx'#JxODlQpO'#JyOEyQpO'#EWODWQpO'#EgPFWO&2DjO'#CbPOOO)CD})CD}OOOO'#I`'#I`OFcO#tO,59UOOQ!0Lh,59U,59UOOOO'#Ia'#IaOFqO&jO,59UOGPQ!L^O'#DcOOOO'#Ic'#IcOGWO#@ItO,59{OOQ!0Lf,59{,59{OGfQlO'#IdOGyQ`O'#JtOIxQ!fO'#JtO+}QlO'#JtOJPQ`O,5:ROJgQ`O'#EpOJtQ`O'#KTOKPQ`O'#KSOKPQ`O'#KSOKXQ`O,5;^OK^Q`O'#KROOQ!0Ln,5:^,5:^OKeQlO,5:^OMcQ!0MxO,5:fONSQ`O,5:nONmQ!0LrO'#KQONtQ`O'#KPO9eQ`O'#KPO! YQ`O'#KPO! bQ`O,5;]O! gQ`O'#KPO!#lQ!fO'#JsOOQ!0Lh'#Ci'#CiO%[QlO'#ESO!$[Q!fO,5:sOOQS'#Jz'#JzOOQO-E<j-E<jO9kQ`O,5=_O!$rQ`O,5=_O!$wQlO,5;ZO!&zQMhO'#EkO!(eQ`O,5;ZO!(jQlO'#DyO!(tQpO,5;dO!(|QpO,5;dO%[QlO,5;dOOQ['#FT'#FTOOQ['#FV'#FVO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eOOQ['#FZ'#FZO!)[QlO,5;tOOQ!0Lf,5;y,5;yOOQ!0Lf,5;z,5;zOOQ!0Lf,5;|,5;|O%[QlO'#IpO!+_Q!0LrO,5<iO%[QlO,5;eO!&zQMhO,5;eO!+|QMhO,5;eO!-nQMhO'#E^O%[QlO,5;wOOQ!0Lf,5;{,5;{O!-uQ,UO'#FjO!.rQ,UO'#KXO!.^Q,UO'#KXO!.yQ,UO'#KXOOQO'#KX'#KXO!/_Q,UO,5<SOOOW,5<`,5<`O!/pQlO'#FvOOOW'#Io'#IoO7VO7dO,5<QO!/wQ,UO'#FxOOQ!0Lf,5<Q,5<QO!0hQ$IUO'#CyOOQ!0Lh'#C}'#C}O!0{O#@ItO'#DRO!1iQMjO,5<eO!1pQ`O,5<hO!3YQ(CWO'#GXO!3jQ`O'#GYO!3oQ`O'#GYO!5_Q(CWO'#G^O!6dQpO'#GbOOQO'#Gn'#GnO!,TQMhO'#GmOOQO'#Gp'#GpO!,TQMhO'#GoO!7VQ$IUO'#JlOOQ!0Lh'#Jl'#JlO!7aQ`O'#JkO!7oQ`O'#JjO!7wQ`O'#CuOOQ!0Lh'#C{'#C{O!8YQ`O'#C}OOQ!0Lh'#DV'#DVOOQ!0Lh'#DX'#DXO!8_Q`O,5<eO1SQ`O'#DZO!,TQMhO'#GPO!,TQMhO'#GRO!8gQ`O'#GTO!8lQ`O'#GUO!3oQ`O'#G[O!,TQMhO'#GaO<]Q`O'#JkO!8qQ`O'#EqO!9`Q`O,5<gOOQ!0Lb'#Cr'#CrO!9hQ`O'#ErO!:bQpO'#EsOOQ!0Lb'#KR'#KRO!:iQ!0LrO'#KaO9uQ!0LrO,5=cO`QlO,5>tOOQ['#Jh'#JhOOQ[,5>u,5>uOOQ[-E<]-E<]O!<hQ!0MxO,5:bO!:]QpO,5:`O!?RQ!0MxO,5:jO%[QlO,5:jO!AiQ!0MxO,5:lOOQO,5@z,5@zO!BYQMhO,5=_O!BhQ!0LrO'#JiO9`Q`O'#JiO!ByQ!0LrO,59ZO!CUQpO,59ZO!C^QMhO,59ZO:dQMhO,59ZO!CiQ`O,5;ZO!CqQ`O'#HbO!DVQ`O'#KdO%[QlO,5;}O!:]QpO,5<PO!D_Q`O,5=zO!DdQ`O,5=zO!DiQ`O,5=zO!DwQ`O,5=zO9uQ!0LrO,5=zO<]Q`O,5=jOOQO'#Cy'#CyO!EOQpO,5=gO!EWQMhO,5=hO!EcQ`O,5=jO!EhQ!bO,5=mO!EpQ`O'#K`O?YQ`O'#HWO9kQ`O'#HYO!EuQ`O'#HYO:dQMhO'#H[O!EzQ`O'#H[OOQ[,5=p,5=pO!FPQ`O'#H]O!FbQ`O'#CoO!FgQ`O,59PO!FqQ`O,59PO!HvQlO,59POOQ[,59P,59PO!IWQ!0LrO,59PO%[QlO,59PO!KcQlO'#HeOOQ['#Hf'#HfOOQ['#Hg'#HgO`QlO,5=}O!KyQ`O,5=}O`QlO,5>TO`QlO,5>VO!LOQ`O,5>XO`QlO,5>ZO!LTQ`O,5>^O!LYQlO,5>dOOQ[,5>j,5>jO%[QlO,5>jO9uQ!0LrO,5>lOOQ[,5>n,5>nO#!dQ`O,5>nOOQ[,5>p,5>pO#!dQ`O,5>pOOQ[,5>r,5>rO##QQpO'#D_O%[QlO'#JvO##sQpO'#JvO##}QpO'#DmO#$`QpO'#DmO#&qQlO'#DmO#&xQ`O'#JuO#'QQ`O,5:WO#'VQ`O'#EtO#'eQ`O'#KUO#'mQ`O,5;_O#'rQpO'#DmO#(PQpO'#EVOOQ!0Lf,5:o,5:oO%[QlO,5:oO#(WQ`O,5:oO?YQ`O,5;YO!CUQpO,5;YO!C^QMhO,5;YO:dQMhO,5;YO#(`Q`O,5@bO#(eQ07dO,5:sOOQO-E<f-E<fO#)kQ!0MSO,5;RODWQpO,5:rO#)uQpO,5:rODWQpO,5;RO!ByQ!0LrO,5:rOOQ!0Lb'#Ej'#EjOOQO,5;R,5;RO%[QlO,5;RO#*SQ!0LrO,5;RO#*_Q!0LrO,5;RO!CUQpO,5:rOOQO,5;X,5;XO#*mQ!0LrO,5;RPOOO'#I^'#I^P#+RO&2DjO,58|POOO,58|,58|OOOO-E<^-E<^OOQ!0Lh1G.p1G.pOOOO-E<_-E<_OOOO,59},59}O#+^Q!bO,59}OOOO-E<a-E<aOOQ!0Lf1G/g1G/gO#+cQ!fO,5?OO+}QlO,5?OOOQO,5?U,5?UO#+mQlO'#IdOOQO-E<b-E<bO#+zQ`O,5@`O#,SQ!fO,5@`O#,ZQ`O,5@nOOQ!0Lf1G/m1G/mO%[QlO,5@oO#,cQ`O'#IjOOQO-E<h-E<hO#,ZQ`O,5@nOOQ!0Lb1G0x1G0xOOQ!0Ln1G/x1G/xOOQ!0Ln1G0Y1G0YO%[QlO,5@lO#,wQ!0LrO,5@lO#-YQ!0LrO,5@lO#-aQ`O,5@kO9eQ`O,5@kO#-iQ`O,5@kO#-wQ`O'#ImO#-aQ`O,5@kOOQ!0Lb1G0w1G0wO!(tQpO,5:uO!)PQpO,5:uOOQS,5:w,5:wO#.iQdO,5:wO#.qQMhO1G2yO9kQ`O1G2yOOQ!0Lf1G0u1G0uO#/PQ!0MxO1G0uO#0UQ!0MvO,5;VOOQ!0Lh'#GW'#GWO#0rQ!0MzO'#JlO!$wQlO1G0uO#2}Q!fO'#JwO%[QlO'#JwO#3XQ`O,5:eOOQ!0Lh'#D_'#D_OOQ!0Lf1G1O1G1OO%[QlO1G1OOOQ!0Lf1G1f1G1fO#3^Q`O1G1OO#5rQ!0MxO1G1PO#5yQ!0MxO1G1PO#8aQ!0MxO1G1PO#8hQ!0MxO1G1PO#;OQ!0MxO1G1PO#=fQ!0MxO1G1PO#=mQ!0MxO1G1PO#=tQ!0MxO1G1PO#@[Q!0MxO1G1PO#@cQ!0MxO1G1PO#BpQ?MtO'#CiO#DkQ?MtO1G1`O#DrQ?MtO'#JsO#EVQ!0MxO,5?[OOQ!0Lb-E<n-E<nO#GdQ!0MxO1G1PO#HaQ!0MzO1G1POOQ!0Lf1G1P1G1PO#IdQMjO'#J|O#InQ`O,5:xO#IsQ!0MxO1G1cO#JgQ,UO,5<WO#JoQ,UO,5<XO#JwQ,UO'#FoO#K`Q`O'#FnOOQO'#KY'#KYOOQO'#In'#InO#KeQ,UO1G1nOOQ!0Lf1G1n1G1nOOOW1G1y1G1yO#KvQ?MtO'#JrO#LQQ`O,5<bO!)[QlO,5<bOOOW-E<m-E<mOOQ!0Lf1G1l1G1lO#LVQpO'#KXOOQ!0Lf,5<d,5<dO#L_QpO,5<dO#LdQMhO'#DTOOOO'#Ib'#IbO#LkO#@ItO,59mOOQ!0Lh,59m,59mO%[QlO1G2PO!8lQ`O'#IrO#LvQ`O,5<zOOQ!0Lh,5<w,5<wO!,TQMhO'#IuO#MdQMjO,5=XO!,TQMhO'#IwO#NVQMjO,5=ZO!&zQMhO,5=]OOQO1G2S1G2SO#NaQ!dO'#CrO#NtQ(CWO'#ErO$ |QpO'#GbO$!dQ!dO,5<sO$!kQ`O'#K[O9eQ`O'#K[O$!yQ`O,5<uO$#aQ!dO'#C{O!,TQMhO,5<tO$#kQ`O'#GZO$$PQ`O,5<tO$$UQ!dO'#GWO$$cQ!dO'#K]O$$mQ`O'#K]O!&zQMhO'#K]O$$rQ`O,5<xO$$wQlO'#JvO$%RQpO'#GcO#$`QpO'#GcO$%dQ`O'#GgO!3oQ`O'#GkO$%iQ!0LrO'#ItO$%tQpO,5<|OOQ!0Lp,5<|,5<|O$%{QpO'#GcO$&YQpO'#GdO$&kQpO'#GdO$&pQMjO,5=XO$'QQMjO,5=ZOOQ!0Lh,5=^,5=^O!,TQMhO,5@VO!,TQMhO,5@VO$'bQ`O'#IyO$'vQ`O,5@UO$(OQ`O,59aOOQ!0Lh,59i,59iO$(TQ`O,5@VO$)TQ$IYO,59uOOQ!0Lh'#Jp'#JpO$)vQMjO,5<kO$*iQMjO,5<mO@zQ`O,5<oOOQ!0Lh,5<p,5<pO$*sQ`O,5<vO$*xQMjO,5<{O$+YQ`O'#KPO!$wQlO1G2RO$+_Q`O1G2RO9eQ`O'#KSO9eQ`O'#EtO%[QlO'#EtO9eQ`O'#I{O$+dQ!0LrO,5@{OOQ[1G2}1G2}OOQ[1G4`1G4`OOQ!0Lf1G/|1G/|OOQ!0Lf1G/z1G/zO$-fQ!0MxO1G0UOOQ[1G2y1G2yO!&zQMhO1G2yO%[QlO1G2yO#.tQ`O1G2yO$/jQMhO'#EkOOQ!0Lb,5@T,5@TO$/wQ!0LrO,5@TOOQ[1G.u1G.uO!ByQ!0LrO1G.uO!CUQpO1G.uO!C^QMhO1G.uO$0YQ`O1G0uO$0_Q`O'#CiO$0jQ`O'#KeO$0rQ`O,5=|O$0wQ`O'#KeO$0|Q`O'#KeO$1[Q`O'#JRO$1jQ`O,5AOO$1rQ!fO1G1iOOQ!0Lf1G1k1G1kO9kQ`O1G3fO@zQ`O1G3fO$1yQ`O1G3fO$2OQ`O1G3fO!DiQ`O1G3fO9uQ!0LrO1G3fOOQ[1G3f1G3fO!EcQ`O1G3UO!&zQMhO1G3RO$2TQ`O1G3ROOQ[1G3S1G3SO!&zQMhO1G3SO$2YQ`O1G3SO$2bQpO'#HQOOQ[1G3U1G3UO!6_QpO'#I}O!EhQ!bO1G3XOOQ[1G3X1G3XOOQ[,5=r,5=rO$2jQMhO,5=tO9kQ`O,5=tO$%dQ`O,5=vO9`Q`O,5=vO!CUQpO,5=vO!C^QMhO,5=vO:dQMhO,5=vO$2xQ`O'#KcO$3TQ`O,5=wOOQ[1G.k1G.kO$3YQ!0LrO1G.kO@zQ`O1G.kO$3eQ`O1G.kO9uQ!0LrO1G.kO$5mQ!fO,5AQO$5zQ`O,5AQO9eQ`O,5AQO$6VQlO,5>PO$6^Q`O,5>POOQ[1G3i1G3iO`QlO1G3iOOQ[1G3o1G3oOOQ[1G3q1G3qO?TQ`O1G3sO$6cQlO1G3uO$:gQlO'#HtOOQ[1G3x1G3xO$:tQ`O'#HzO?YQ`O'#H|OOQ[1G4O1G4OO$:|QlO1G4OO9uQ!0LrO1G4UOOQ[1G4W1G4WOOQ!0Lb'#G_'#G_O9uQ!0LrO1G4YO9uQ!0LrO1G4[O$?TQ`O,5@bO!)[QlO,5;`O9eQ`O,5;`O?YQ`O,5:XO!)[QlO,5:XO!CUQpO,5:XO$?YQ?MtO,5:XOOQO,5;`,5;`O$?dQpO'#IeO$?zQ`O,5@aOOQ!0Lf1G/r1G/rO$@SQpO'#IkO$@^Q`O,5@pOOQ!0Lb1G0y1G0yO#$`QpO,5:XOOQO'#Ig'#IgO$@fQpO,5:qOOQ!0Ln,5:q,5:qO#(ZQ`O1G0ZOOQ!0Lf1G0Z1G0ZO%[QlO1G0ZOOQ!0Lf1G0t1G0tO?YQ`O1G0tO!CUQpO1G0tO!C^QMhO1G0tOOQ!0Lb1G5|1G5|O!ByQ!0LrO1G0^OOQO1G0m1G0mO%[QlO1G0mO$@mQ!0LrO1G0mO$@xQ!0LrO1G0mO!CUQpO1G0^ODWQpO1G0^O$AWQ!0LrO1G0mOOQO1G0^1G0^O$AlQ!0MxO1G0mPOOO-E<[-E<[POOO1G.h1G.hOOOO1G/i1G/iO$AvQ!bO,5<iO$BOQ!fO1G4jOOQO1G4p1G4pO%[QlO,5?OO$BYQ`O1G5zO$BbQ`O1G6YO$BjQ!fO1G6ZO9eQ`O,5?UO$BtQ!0MxO1G6WO%[QlO1G6WO$CUQ!0LrO1G6WO$CgQ`O1G6VO$CgQ`O1G6VO9eQ`O1G6VO$CoQ`O,5?XO9eQ`O,5?XOOQO,5?X,5?XO$DTQ`O,5?XO$+YQ`O,5?XOOQO-E<k-E<kOOQS1G0a1G0aOOQS1G0c1G0cO#.lQ`O1G0cOOQ[7+(e7+(eO!&zQMhO7+(eO%[QlO7+(eO$DcQ`O7+(eO$DnQMhO7+(eO$D|Q!0MzO,5=XO$GXQ!0MzO,5=ZO$IdQ!0MzO,5=XO$KuQ!0MzO,5=ZO$NWQ!0MzO,59uO%!]Q!0MzO,5<kO%$hQ!0MzO,5<mO%&sQ!0MzO,5<{OOQ!0Lf7+&a7+&aO%)UQ!0MxO7+&aO%)xQlO'#IfO%*VQ`O,5@cO%*_Q!fO,5@cOOQ!0Lf1G0P1G0PO%*iQ`O7+&jOOQ!0Lf7+&j7+&jO%*nQ?MtO,5:fO%[QlO7+&zO%*xQ?MtO,5:bO%+VQ?MtO,5:jO%+aQ?MtO,5:lO%+kQMhO'#IiO%+uQ`O,5@hOOQ!0Lh1G0d1G0dOOQO1G1r1G1rOOQO1G1s1G1sO%+}Q!jO,5<ZO!)[QlO,5<YOOQO-E<l-E<lOOQ!0Lf7+'Y7+'YOOOW7+'e7+'eOOOW1G1|1G1|O%,YQ`O1G1|OOQ!0Lf1G2O1G2OOOOO,59o,59oO%,_Q!dO,59oOOOO-E<`-E<`OOQ!0Lh1G/X1G/XO%,fQ!0MxO7+'kOOQ!0Lh,5?^,5?^O%-YQMhO1G2fP%-aQ`O'#IrPOQ!0Lh-E<p-E<pO%-}QMjO,5?aOOQ!0Lh-E<s-E<sO%.pQMjO,5?cOOQ!0Lh-E<u-E<uO%.zQ!dO1G2wO%/RQ!dO'#CrO%/iQMhO'#KSO$$wQlO'#JvOOQ!0Lh1G2_1G2_O%/sQ`O'#IqO%0[Q`O,5@vO%0[Q`O,5@vO%0dQ`O,5@vO%0oQ`O,5@vOOQO1G2a1G2aO%0}QMjO1G2`O$+YQ`O'#K[O!,TQMhO1G2`O%1_Q(CWO'#IsO%1lQ`O,5@wO!&zQMhO,5@wO%1tQ!dO,5@wOOQ!0Lh1G2d1G2dO%4UQ!fO'#CiO%4`Q`O,5=POOQ!0Lb,5<},5<}O%4hQpO,5<}OOQ!0Lb,5=O,5=OOCwQ`O,5<}O%4sQpO,5<}OOQ!0Lb,5=R,5=RO$+YQ`O,5=VOOQO,5?`,5?`OOQO-E<r-E<rOOQ!0Lp1G2h1G2hO#$`QpO,5<}O$$wQlO,5=PO%5RQ`O,5=OO%5^QpO,5=OO!,TQMhO'#IuO%6WQMjO1G2sO!,TQMhO'#IwO%6yQMjO1G2uO%7TQMjO1G5qO%7_QMjO1G5qOOQO,5?e,5?eOOQO-E<w-E<wOOQO1G.{1G.{O!,TQMhO1G5qO!,TQMhO1G5qO!:]QpO,59wO%[QlO,59wOOQ!0Lh,5<j,5<jO%7lQ`O1G2ZO!,TQMhO1G2bO%7qQ!0MxO7+'mOOQ!0Lf7+'m7+'mO!$wQlO7+'mO%8eQ`O,5;`OOQ!0Lb,5?g,5?gOOQ!0Lb-E<y-E<yO%8jQ!dO'#K^O#(ZQ`O7+(eO4UQ!fO7+(eO$DfQ`O7+(eO%8tQ!0MvO'#CiO%9XQ!0MvO,5=SO%9lQ`O,5=SO%9tQ`O,5=SOOQ!0Lb1G5o1G5oOOQ[7+$a7+$aO!ByQ!0LrO7+$aO!CUQpO7+$aO!$wQlO7+&aO%9yQ`O'#JQO%:bQ`O,5APOOQO1G3h1G3hO9kQ`O,5APO%:bQ`O,5APO%:jQ`O,5APOOQO,5?m,5?mOOQO-E=P-E=POOQ!0Lf7+'T7+'TO%:oQ`O7+)QO9uQ!0LrO7+)QO9kQ`O7+)QO@zQ`O7+)QO%:tQ`O7+)QOOQ[7+)Q7+)QOOQ[7+(p7+(pO%:yQ!0MvO7+(mO!&zQMhO7+(mO!E^Q`O7+(nOOQ[7+(n7+(nO!&zQMhO7+(nO%;TQ`O'#KbO%;`Q`O,5=lOOQO,5?i,5?iOOQO-E<{-E<{OOQ[7+(s7+(sO%<rQpO'#HZOOQ[1G3`1G3`O!&zQMhO1G3`O%[QlO1G3`O%<yQ`O1G3`O%=UQMhO1G3`O9uQ!0LrO1G3bO$%dQ`O1G3bO9`Q`O1G3bO!CUQpO1G3bO!C^QMhO1G3bO%=dQ`O'#JPO%=xQ`O,5@}O%>QQpO,5@}OOQ!0Lb1G3c1G3cOOQ[7+$V7+$VO@zQ`O7+$VO9uQ!0LrO7+$VO%>]Q`O7+$VO%[QlO1G6lO%[QlO1G6mO%>bQ!0LrO1G6lO%>lQlO1G3kO%>sQ`O1G3kO%>xQlO1G3kOOQ[7+)T7+)TO9uQ!0LrO7+)_O`QlO7+)aOOQ['#Kh'#KhOOQ['#JS'#JSO%?PQlO,5>`OOQ[,5>`,5>`O%[QlO'#HuO%?^Q`O'#HwOOQ[,5>f,5>fO9eQ`O,5>fOOQ[,5>h,5>hOOQ[7+)j7+)jOOQ[7+)p7+)pOOQ[7+)t7+)tOOQ[7+)v7+)vO%?cQpO1G5|O%?}Q?MtO1G0zO%@XQ`O1G0zOOQO1G/s1G/sO%@dQ?MtO1G/sO?YQ`O1G/sO!)[QlO'#DmOOQO,5?P,5?POOQO-E<c-E<cOOQO,5?V,5?VOOQO-E<i-E<iO!CUQpO1G/sOOQO-E<e-E<eOOQ!0Ln1G0]1G0]OOQ!0Lf7+%u7+%uO#(ZQ`O7+%uOOQ!0Lf7+&`7+&`O?YQ`O7+&`O!CUQpO7+&`OOQO7+%x7+%xO$AlQ!0MxO7+&XOOQO7+&X7+&XO%[QlO7+&XO%@nQ!0LrO7+&XO!ByQ!0LrO7+%xO!CUQpO7+%xO%@yQ!0LrO7+&XO%AXQ!0MxO7++rO%[QlO7++rO%AiQ`O7++qO%AiQ`O7++qOOQO1G4s1G4sO9eQ`O1G4sO%AqQ`O1G4sOOQS7+%}7+%}O#(ZQ`O<<LPO4UQ!fO<<LPO%BPQ`O<<LPOOQ[<<LP<<LPO!&zQMhO<<LPO%[QlO<<LPO%BXQ`O<<LPO%BdQ!0MzO,5?aO%DoQ!0MzO,5?cO%FzQ!0MzO1G2`O%I]Q!0MzO1G2sO%KhQ!0MzO1G2uO%MsQ!fO,5?QO%[QlO,5?QOOQO-E<d-E<dO%M}Q`O1G5}OOQ!0Lf<<JU<<JUO%NVQ?MtO1G0uO&!^Q?MtO1G1PO&!eQ?MtO1G1PO&$fQ?MtO1G1PO&$mQ?MtO1G1PO&&nQ?MtO1G1PO&(oQ?MtO1G1PO&(vQ?MtO1G1PO&(}Q?MtO1G1PO&+OQ?MtO1G1PO&+VQ?MtO1G1PO&+^Q!0MxO<<JfO&-UQ?MtO1G1PO&.RQ?MvO1G1PO&/UQ?MvO'#JlO&1[Q?MtO1G1cO&1iQ?MtO1G0UO&1sQMjO,5?TOOQO-E<g-E<gO!)[QlO'#FqOOQO'#KZ'#KZOOQO1G1u1G1uO&1}Q`O1G1tO&2SQ?MtO,5?[OOOW7+'h7+'hOOOO1G/Z1G/ZO&2^Q!dO1G4xOOQ!0Lh7+(Q7+(QP!&zQMhO,5?^O!,TQMhO7+(cO&2eQ`O,5?]O9eQ`O,5?]O$+YQ`O,5?]OOQO-E<o-E<oO&2sQ`O1G6bO&2sQ`O1G6bO&2{Q`O1G6bO&3WQMjO7+'zO&3hQ!dO,5?_O&3rQ`O,5?_O!&zQMhO,5?_OOQO-E<q-E<qO&3wQ!dO1G6cO&4RQ`O1G6cO&4ZQ`O1G2kO!&zQMhO1G2kOOQ!0Lb1G2i1G2iOOQ!0Lb1G2j1G2jO%4hQpO1G2iO!CUQpO1G2iOCwQ`O1G2iOOQ!0Lb1G2q1G2qO&4`QpO1G2iO&4nQ`O1G2kO$+YQ`O1G2jOCwQ`O1G2jO$$wQlO1G2kO&4vQ`O1G2jO&5jQMjO,5?aOOQ!0Lh-E<t-E<tO&6]QMjO,5?cOOQ!0Lh-E<v-E<vO!,TQMhO7++]O&6gQMjO7++]O&6qQMjO7++]OOQ!0Lh1G/c1G/cO&7OQ`O1G/cOOQ!0Lh7+'u7+'uO&7TQMjO7+'|O&7eQ!0MxO<<KXOOQ!0Lf<<KX<<KXO&8XQ`O1G0zO!&zQMhO'#IzO&8^Q`O,5@xO&:`Q!fO<<LPO!&zQMhO1G2nO&:gQ!0LrO1G2nOOQ[<<G{<<G{O!ByQ!0LrO<<G{O&:xQ!0MxO<<I{OOQ!0Lf<<I{<<I{OOQO,5?l,5?lO&;lQ`O,5?lO&;qQ`O,5?lOOQO-E=O-E=OO&<PQ`O1G6kO&<PQ`O1G6kO9kQ`O1G6kO@zQ`O<<LlOOQ[<<Ll<<LlO&<XQ`O<<LlO9uQ!0LrO<<LlO9kQ`O<<LlOOQ[<<LX<<LXO%:yQ!0MvO<<LXOOQ[<<LY<<LYO!E^Q`O<<LYO&<^QpO'#I|O&<iQ`O,5@|O!)[QlO,5@|OOQ[1G3W1G3WOOQO'#JO'#JOO9uQ!0LrO'#JOO&<qQpO,5=uOOQ[,5=u,5=uO&<xQpO'#EgO&=PQpO'#GeO&=UQ`O7+(zO&=ZQ`O7+(zOOQ[7+(z7+(zO!&zQMhO7+(zO%[QlO7+(zO&=cQ`O7+(zOOQ[7+(|7+(|O9uQ!0LrO7+(|O$%dQ`O7+(|O9`Q`O7+(|O!CUQpO7+(|O&=nQ`O,5?kOOQO-E<}-E<}OOQO'#H^'#H^O&=yQ`O1G6iO9uQ!0LrO<<GqOOQ[<<Gq<<GqO@zQ`O<<GqO&>RQ`O7+,WO&>WQ`O7+,XO%[QlO7+,WO%[QlO7+,XOOQ[7+)V7+)VO&>]Q`O7+)VO&>bQlO7+)VO&>iQ`O7+)VOOQ[<<Ly<<LyOOQ[<<L{<<L{OOQ[-E=Q-E=QOOQ[1G3z1G3zO&>nQ`O,5>aOOQ[,5>c,5>cO&>sQ`O1G4QO9eQ`O7+&fO!)[QlO7+&fOOQO7+%_7+%_O&>xQ?MtO1G6ZO?YQ`O7+%_OOQ!0Lf<<Ia<<IaOOQ!0Lf<<Iz<<IzO?YQ`O<<IzOOQO<<Is<<IsO$AlQ!0MxO<<IsO%[QlO<<IsOOQO<<Id<<IdO!ByQ!0LrO<<IdO&?SQ!0LrO<<IsO&?_Q!0MxO<= ^O&?oQ`O<= ]OOQO7+*_7+*_O9eQ`O7+*_OOQ[ANAkANAkO&?wQ!fOANAkO!&zQMhOANAkO#(ZQ`OANAkO4UQ!fOANAkO&@OQ`OANAkO%[QlOANAkO&@WQ!0MzO7+'zO&BiQ!0MzO,5?aO&DtQ!0MzO,5?cO&GPQ!0MzO7+'|O&IbQ!fO1G4lO&IlQ?MtO7+&aO&KpQ?MvO,5=XO&MwQ?MvO,5=ZO&NXQ?MvO,5=XO&NiQ?MvO,5=ZO&NyQ?MvO,59uO'#PQ?MvO,5<kO'%SQ?MvO,5<mO''hQ?MvO,5<{O')^Q?MtO7+'kO')kQ?MtO7+'mO')xQ`O,5<]OOQO7+'`7+'`OOQ!0Lh7+*d7+*dO')}QMjO<<K}OOQO1G4w1G4wO'*UQ`O1G4wO'*aQ`O1G4wO'*oQ`O7++|O'*oQ`O7++|O!&zQMhO1G4yO'*wQ!dO1G4yO'+RQ`O7++}O'+ZQ`O7+(VO'+fQ!dO7+(VOOQ!0Lb7+(T7+(TOOQ!0Lb7+(U7+(UO!CUQpO7+(TOCwQ`O7+(TO'+pQ`O7+(VO!&zQMhO7+(VO$+YQ`O7+(UO'+uQ`O7+(VOCwQ`O7+(UO'+}QMjO<<NwO!,TQMhO<<NwOOQ!0Lh7+$}7+$}O',XQ!dO,5?fOOQO-E<x-E<xO',cQ!0MvO7+(YO!&zQMhO7+(YOOQ[AN=gAN=gO9kQ`O1G5WOOQO1G5W1G5WO',sQ`O1G5WO',xQ`O7+,VO',xQ`O7+,VO9uQ!0LrOANBWO@zQ`OANBWOOQ[ANBWANBWO'-QQ`OANBWOOQ[ANAsANAsOOQ[ANAtANAtO'-VQ`O,5?hOOQO-E<z-E<zO'-bQ?MtO1G6hOOQO,5?j,5?jOOQO-E<|-E<|OOQ[1G3a1G3aO'-lQ`O,5=POOQ[<<Lf<<LfO!&zQMhO<<LfO&=UQ`O<<LfO'-qQ`O<<LfO%[QlO<<LfOOQ[<<Lh<<LhO9uQ!0LrO<<LhO$%dQ`O<<LhO9`Q`O<<LhO'-yQpO1G5VO'.UQ`O7+,TOOQ[AN=]AN=]O9uQ!0LrOAN=]OOQ[<= r<= rOOQ[<= s<= sO'.^Q`O<= rO'.cQ`O<= sOOQ[<<Lq<<LqO'.hQ`O<<LqO'.mQlO<<LqOOQ[1G3{1G3{O?YQ`O7+)lO'.tQ`O<<JQO'/PQ?MtO<<JQOOQO<<Hy<<HyOOQ!0LfAN?fAN?fOOQOAN?_AN?_O$AlQ!0MxOAN?_OOQOAN?OAN?OO%[QlOAN?_OOQO<<My<<MyOOQ[G27VG27VO!&zQMhOG27VO#(ZQ`OG27VO'/ZQ!fOG27VO4UQ!fOG27VO'/bQ`OG27VO'/jQ?MtO<<JfO'/wQ?MvO1G2`O'1mQ?MvO,5?aO'3pQ?MvO,5?cO'5sQ?MvO1G2sO'7vQ?MvO1G2uO'9yQ?MtO<<KXO':WQ?MtO<<I{OOQO1G1w1G1wO!,TQMhOANAiOOQO7+*c7+*cO':eQ`O7+*cO':pQ`O<= hO':xQ!dO7+*eOOQ!0Lb<<Kq<<KqO$+YQ`O<<KqOCwQ`O<<KqO';SQ`O<<KqO!&zQMhO<<KqOOQ!0Lb<<Ko<<KoO!CUQpO<<KoO';_Q!dO<<KqOOQ!0Lb<<Kp<<KpO';iQ`O<<KqO!&zQMhO<<KqO$+YQ`O<<KpO';nQMjOANDcO';xQ!0MvO<<KtOOQO7+*r7+*rO9kQ`O7+*rO'<YQ`O<= qOOQ[G27rG27rO9uQ!0LrOG27rO@zQ`OG27rO!)[QlO1G5SO'<bQ`O7+,SO'<jQ`O1G2kO&=UQ`OANBQOOQ[ANBQANBQO!&zQMhOANBQO'<oQ`OANBQOOQ[ANBSANBSO9uQ!0LrOANBSO$%dQ`OANBSOOQO'#H_'#H_OOQO7+*q7+*qOOQ[G22wG22wOOQ[ANE^ANE^OOQ[ANE_ANE_OOQ[ANB]ANB]O'<wQ`OANB]OOQ[<<MW<<MWO!)[QlOAN?lOOQOG24yG24yO$AlQ!0MxOG24yO#(ZQ`OLD,qOOQ[LD,qLD,qO!&zQMhOLD,qO'<|Q!fOLD,qO'=TQ?MvO7+'zO'>yQ?MvO,5?aO'@|Q?MvO,5?cO'CPQ?MvO7+'|O'DuQMjOG27TOOQO<<M}<<M}OOQ!0LbANA]ANA]O$+YQ`OANA]OCwQ`OANA]O'EVQ!dOANA]OOQ!0LbANAZANAZO'E^Q`OANA]O!&zQMhOANA]O'EiQ!dOANA]OOQ!0LbANA[ANA[OOQO<<N^<<N^OOQ[LD-^LD-^O9uQ!0LrOLD-^O'EsQ?MtO7+*nOOQO'#Gf'#GfOOQ[G27lG27lO&=UQ`OG27lO!&zQMhOG27lOOQ[G27nG27nO9uQ!0LrOG27nOOQ[G27wG27wO'E}Q?MtOG25WOOQOLD*eLD*eOOQ[!$(!]!$(!]O#(ZQ`O!$(!]O!&zQMhO!$(!]O'FXQ!0MzOG27TOOQ!0LbG26wG26wO$+YQ`OG26wO'HjQ`OG26wOCwQ`OG26wO'HuQ!dOG26wO!&zQMhOG26wOOQ[!$(!x!$(!xOOQ[LD-WLD-WO&=UQ`OLD-WOOQ[LD-YLD-YOOQ[!)9Ew!)9EwO#(ZQ`O!)9EwOOQ!0LbLD,cLD,cO$+YQ`OLD,cOCwQ`OLD,cO'H|Q`OLD,cO'IXQ!dOLD,cOOQ[!$(!r!$(!rOOQ[!.K;c!.K;cO'I`Q?MvOG27TOOQ!0Lb!$( }!$( }O$+YQ`O!$( }OCwQ`O!$( }O'KUQ`O!$( }OOQ!0Lb!)9Ei!)9EiO$+YQ`O!)9EiOCwQ`O!)9EiOOQ!0Lb!.K;T!.K;TO$+YQ`O!.K;TOOQ!0Lb!4/0o!4/0oO!)[QlO'#DzO1PQ`O'#EXO'KaQ!fO'#JrO'KhQ!L^O'#DvO'KoQlO'#EOO'KvQ!fO'#CiO'N^Q!fO'#CiO!)[QlO'#EQO'NnQlO,5;ZO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO'#IpO(!qQ`O,5<iO!)[QlO,5;eO(!yQMhO,5;eO($dQMhO,5;eO!)[QlO,5;wO!&zQMhO'#GmO(!yQMhO'#GmO!&zQMhO'#GoO(!yQMhO'#GoO1SQ`O'#DZO1SQ`O'#DZO!&zQMhO'#GPO(!yQMhO'#GPO!&zQMhO'#GRO(!yQMhO'#GRO!&zQMhO'#GaO(!yQMhO'#GaO!)[QlO,5:jO($kQpO'#D_O($uQpO'#JvO!)[QlO,5@oO'NnQlO1G0uO(%PQ?MtO'#CiO!)[QlO1G2PO!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO(%ZQ!dO'#CrO!&zQMhO,5<tO(!yQMhO,5<tO'NnQlO1G2RO!)[QlO7+&zO!&zQMhO1G2`O(!yQMhO1G2`O!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO!&zQMhO1G2bO(!yQMhO1G2bO'NnQlO7+'mO'NnQlO7+&aO!&zQMhOANAiO(!yQMhOANAiO(%nQ`O'#EoO(%sQ`O'#EoO(%{Q`O'#F]O(&QQ`O'#EyO(&VQ`O'#KTO(&bQ`O'#KRO(&mQ`O,5;ZO(&rQMjO,5<eO(&yQ`O'#GYO('OQ`O'#GYO('TQ`O,5<eO(']Q`O,5<gO('eQ`O,5;ZO('mQ?MtO1G1`O('tQ`O,5<tO('yQ`O,5<tO((OQ`O,5<vO((TQ`O,5<vO((YQ`O1G2RO((_Q`O1G0uO((dQMjO<<K}O((kQMjO<<K}O((rQMhO'#F|O9`Q`O'#F{OAuQ`O'#EnO!)[QlO,5;tO!3oQ`O'#GYO!3oQ`O'#GYO!3oQ`O'#G[O!3oQ`O'#G[O!,TQMhO7+(cO!,TQMhO7+(cO%.zQ!dO1G2wO%.zQ!dO1G2wO!&zQMhO,5=]O!&zQMhO,5=]",stateData:"()x~O'|OS'}OSTOS(ORQ~OPYOQYOSfOY!VOaqOdzOeyOl!POpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!uwO!xxO!|]O$W|O$niO%h}O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO&W!WO&^!XO&`!YO&b!ZO&d![O&g!]O&m!^O&s!_O&u!`O&w!aO&y!bO&{!cO(TSO(VTO(YUO(aVO(o[O~OWtO~P`OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa!wOs!nO!S!oO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!xO#W!pO#X!pO#[!zO#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O(O!{O~OP]XR]X[]Xa]Xj]Xr]X!Q]X!S]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X'z]X(a]X(r]X(y]X(z]X~O!g%RX~P(qO_!}O(V#PO(W!}O(X#PO~O_#QO(X#PO(Y#PO(Z#QO~Ox#SO!U#TO(b#TO(c#VO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T<ZO(VTO(YUO(aVO(o[O~O![#ZO!]#WO!Y(hP!Y(vP~P+}O!^#cO~P`OPYOQYOSfOd!jOe!iOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(VTO(YUO(aVO(o[O~Op#mO![#iO!|]O#i#lO#j#iO(T<[O!k(sP~P.iO!l#oO(T#nO~O!x#sO!|]O%h#tO~O#k#uO~O!g#vO#k#uO~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!]$_O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa(fX'z(fX'w(fX!k(fX!Y(fX!_(fX%i(fX!g(fX~P1qO#S$dO#`$eO$Q$eOP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX!_(gX%i(gX~Oa(gX'z(gX'w(gX!Y(gX!k(gXv(gX!g(gX~P4UO#`$eO~O$]$hO$_$gO$f$mO~OSfO!_$nO$i$oO$k$qO~Oh%VOj%dOk%dOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T$sO(VTO(YUO(a$uO(y$}O(z%POg(^P~Ol%[O~P7eO!l%eO~O!S%hO!_%iO(T%gO~O!g%mO~Oa%nO'z%nO~O!Q%rO~P%[O(U!lO~P%[O%n%vO~P%[Oh%VO!l%eO(T%gO(U!lO~Oe%}O!l%eO(T%gO~Oj$RO~O!_&PO(T%gO(U!lO(VTO(YUO`)WP~O!Q&SO!l&RO%j&VO&T&WO~P;SO!x#sO~O%s&YO!S)SX!_)SX(T)SX~O(T&ZO~Ol!PO!u&`O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO~Od&eOe&dO!x&bO%h&cO%{&aO~P<bOd&hOeyOl!PO!_&gO!u&`O!xxO!|]O%h}O%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO~Ob&kO#`&nO%j&iO(U!lO~P=gO!l&oO!u&sO~O!l#oO~O!_XO~Oa%nO'x&{O'z%nO~Oa%nO'x'OO'z%nO~Oa%nO'x'QO'z%nO~O'w]X!Y]Xv]X!k]X&[]X!_]X%i]X!g]X~P(qO!b'_O!c'WO!d'WO(U!lO(VTO(YUO~Os'UO!S'TO!['XO(e'SO!^(iP!^(xP~P@nOn'bO!_'`O(T%gO~Oe'gO!l%eO(T%gO~O!Q&SO!l&RO~Os!nO!S!oO!|<VO#T!pO#U!pO#W!pO#X!pO(U!lO(VTO(YUO(e!mO(o!sO~O!b'mO!c'lO!d'lO#V!pO#['nO#]'nO~PBYOa%nOh%VO!g#vO!l%eO'z%nO(r'pO~O!p'tO#`'rO~PChOs!nO!S!oO(VTO(YUO(e!mO(o!sO~O!_XOs(mX!S(mX!b(mX!c(mX!d(mX!|(mX#T(mX#U(mX#V(mX#W(mX#X(mX#[(mX#](mX(U(mX(V(mX(Y(mX(e(mX(o(mX~O!c'lO!d'lO(U!lO~PDWO(P'xO(Q'xO(R'zO~O_!}O(V'|O(W!}O(X'|O~O_#QO(X'|O(Y'|O(Z#QO~Ov(OO~P%[Ox#SO!U#TO(b#TO(c(RO~O![(TO!Y'WX!Y'^X!]'WX!]'^X~P+}O!](VO!Y(hX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!](VO!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~O!Y(hX~PHRO!Y([O~O!Y(uX!](uX!g(uX!k(uX(r(uX~O#`(uX#k#dX!^(uX~PJUO#`(]O!Y(wX!](wX~O!](^O!Y(vX~O!Y(aO~O#`$eO~PJUO!^(bO~P`OR#zO!Q#yO!S#{O!l#xO(aVOP!na[!naj!nar!na!]!na!p!na#R!na#n!na#o!na#p!na#q!na#r!na#s!na#t!na#u!na#v!na#x!na#z!na#{!na(r!na(y!na(z!na~Oa!na'z!na'w!na!Y!na!k!nav!na!_!na%i!na!g!na~PKlO!k(cO~O!g#vO#`(dO(r'pO!](tXa(tX'z(tX~O!k(tX~PNXO!S%hO!_%iO!|]O#i(iO#j(hO(T%gO~O!](jO!k(sX~O!k(lO~O!S%hO!_%iO#j(hO(T%gO~OP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~O!g#vO!k(gX~P! uOR(nO!Q(mO!l#xO#S$dO!|!{a!S!{a~O!x!{a%h!{a!_!{a#i!{a#j!{a(T!{a~P!#vO!x(rO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~O#k(xO~O![(zO!k(kP~P%[O(e(|O(o[O~O!S)OO!l#xO(e(|O(o[O~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]$_Oa$qa'z$qa'w$qa!k$qa!Y$qa!_$qa%i$qa!g$qa~Ol)dO~P!&zOh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Og(pP~P!,TO!Q)iO!g)hO!_$^X$Z$^X$]$^X$_$^X$f$^X~O!g)hO!_({X$Z({X$]({X$_({X$f({X~O!Q)iO~P!.^O!Q)iO!_({X$Z({X$]({X$_({X$f({X~O!_)kO$Z)oO$])jO$_)jO$f)pO~O![)sO~P!)[O$]$hO$_$gO$f)wO~On$zX!Q$zX#S$zX'y$zX(y$zX(z$zX~OgmXg$zXnmX!]mX#`mX~P!0SOx)yO(b)zO(c)|O~On*VO!Q*OO'y*PO(y$}O(z%PO~Og)}O~P!1WOg*WO~Oh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S*YO!_*ZO!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op*`O![*^O(T*XO!k)OP~P!1uO#k*aO~O!l*bO~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T*dO(VTO(YUO(a$uO(y$}O(z%PO~O![*gO!Y)PP~P!3tOr*sOs!nO!S*iO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO(e!mO~O!^*pO~P!5iO#S$dOn(`X!Q(`X'y(`X(y(`X(z(`X!](`X#`(`X~Og(`X$O(`X~P!6kOn*xO#`*wOg(_X!](_X~O!]*yOg(^X~Oj%dOk%dOl%dO(T&ZOg(^P~Os*|O~Og)}O(T&ZO~O!l+SO~O(T(vO~Op+WO!S%hO![#iO!_%iO!|]O#i#lO#j#iO(T%gO!k(sP~O!g#vO#k+XO~O!S%hO![+ZO!](^O!_%iO(T%gO!Y(vP~Os'[O!S+]O![+[O(VTO(YUO(e(|O~O!^(xP~P!9|O!]+^Oa)TX'z)TX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa!ja!]!ja'z!ja'w!ja!Y!ja!k!jav!ja!_!ja%i!ja!g!ja~P!:tOR#zO!Q#yO!S#{O!l#xO(aVOP!ra[!raj!rar!ra!]!ra!p!ra#R!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#v!ra#x!ra#z!ra#{!ra(r!ra(y!ra(z!ra~Oa!ra'z!ra'w!ra!Y!ra!k!rav!ra!_!ra%i!ra!g!ra~P!=[OR#zO!Q#yO!S#{O!l#xO(aVOP!ta[!taj!tar!ta!]!ta!p!ta#R!ta#n!ta#o!ta#p!ta#q!ta#r!ta#s!ta#t!ta#u!ta#v!ta#x!ta#z!ta#{!ta(r!ta(y!ta(z!ta~Oa!ta'z!ta'w!ta!Y!ta!k!tav!ta!_!ta%i!ta!g!ta~P!?rOh%VOn+gO!_'`O%i+fO~O!g+iOa(]X!_(]X'z(]X!](]X~Oa%nO!_XO'z%nO~Oh%VO!l%eO~Oh%VO!l%eO(T%gO~O!g#vO#k(xO~Ob+tO%j+uO(T+qO(VTO(YUO!^)XP~O!]+vO`)WX~O[+zO~O`+{O~O!_&PO(T%gO(U!lO`)WP~O%j,OO~P;SOh%VO#`,SO~Oh%VOn,VO!_$|O~O!_,XO~O!Q,ZO!_XO~O%n%vO~O!x,`O~Oe,eO~Ob,fO(T#nO(VTO(YUO!^)VP~Oe%}O~O%j!QO(T&ZO~P=gO[,kO`,jO~OPYOQYOSfOdzOeyOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!iuO!lZO!oYO!pYO!qYO!svO!xxO!|]O$niO%h}O(VTO(YUO(aVO(o[O~O!_!eO!u!gO$W!kO(T!dO~P!FyO`,jOa%nO'z%nO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa,pOl!OO!uwO%l!OO%m!OO%n!OO~P!IcO!l&oO~O&^,vO~O!_,xO~O&o,zO&q,{OP&laQ&laS&laY&laa&lad&lae&lal&lap&lar&las&lat&laz&la|&la!O&la!S&la!W&la!X&la!_&la!i&la!l&la!o&la!p&la!q&la!s&la!u&la!x&la!|&la$W&la$n&la%h&la%j&la%l&la%m&la%n&la%q&la%s&la%v&la%w&la%y&la&W&la&^&la&`&la&b&la&d&la&g&la&m&la&s&la&u&la&w&la&y&la&{&la'w&la(T&la(V&la(Y&la(a&la(o&la!^&la&e&lab&la&j&la~O(T-QO~Oh!eX!]!RX!^!RX!g!RX!g!eX!l!eX#`!RX~O!]!eX!^!eX~P#!iO!g-VO#`-UOh(jX!]#hX!^#hX!g(jX!l(jX~O!](jX!^(jX~P##[Oh%VO!g-XO!l%eO!]!aX!^!aX~Os!nO!S!oO(VTO(YUO(e!mO~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(VTO(YUO(aVO(o[O~O(T=QO~P#$qO!]-]O!^(iX~O!^-_O~O!g-VO#`-UO!]#hX!^#hX~O!]-`O!^(xX~O!^-bO~O!c-cO!d-cO(U!lO~P#$`O!^-fO~P'_On-iO!_'`O~O!Y-nO~Os!{a!b!{a!c!{a!d!{a#T!{a#U!{a#V!{a#W!{a#X!{a#[!{a#]!{a(U!{a(V!{a(Y!{a(e!{a(o!{a~P!#vO!p-sO#`-qO~PChO!c-uO!d-uO(U!lO~PDWOa%nO#`-qO'z%nO~Oa%nO!g#vO#`-qO'z%nO~Oa%nO!g#vO!p-sO#`-qO'z%nO(r'pO~O(P'xO(Q'xO(R-zO~Ov-{O~O!Y'Wa!]'Wa~P!:tO![.PO!Y'WX!]'WX~P%[O!](VO!Y(ha~O!Y(ha~PHRO!](^O!Y(va~O!S%hO![.TO!_%iO(T%gO!Y'^X!]'^X~O#`.VO!](ta!k(taa(ta'z(ta~O!g#vO~P#,wO!](jO!k(sa~O!S%hO!_%iO#j.ZO(T%gO~Op.`O!S%hO![.]O!_%iO!|]O#i._O#j.]O(T%gO!]'aX!k'aX~OR.dO!l#xO~Oh%VOn.gO!_'`O%i.fO~Oa#ci!]#ci'z#ci'w#ci!Y#ci!k#civ#ci!_#ci%i#ci!g#ci~P!:tOn>]O!Q*OO'y*PO(y$}O(z%PO~O#k#_aa#_a#`#_a'z#_a!]#_a!k#_a!_#_a!Y#_a~P#/sO#k(`XP(`XR(`X[(`Xa(`Xj(`Xr(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X'z(`X(a(`X(r(`X!k(`X!Y(`X'w(`Xv(`X!_(`X%i(`X!g(`X~P!6kO!].tO!k(kX~P!:tO!k.wO~O!Y.yO~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mia#mij#mir#mi!]#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#n#mi~P#3cO#n$OO~P#3cOP$[OR#zOr$aO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO[#mia#mij#mi!]#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#r#mi~P#6QO#r$QO~P#6QOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO(aVOa#mi!]#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#v#mi~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO(aVO(z#}Oa#mi!]#mi#z#mi#{#mi'z#mi(r#mi(y#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#x$UO~P#;VO#x#mi~P#;VO#v$SO~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO(aVO(y#|O(z#}Oa#mi!]#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#z#mi~P#={O#z$WO~P#={OP]XR]X[]Xj]Xr]X!Q]X!S]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X!]]X!^]X~O$O]X~P#@jOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO#z<gO#{<hO(aVO(r$YO(y#|O(z#}O~O$O.{O~P#BwO#S$dO#`<nO$Q<nO$O(gX!^(gX~P! uOa'da!]'da'z'da'w'da!k'da!Y'dav'da!_'da%i'da!g'da~P!:tO[#mia#mij#mir#mi!]#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO(y#mi(z#mi~P#EyOn>]O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P#EyO!]/POg(pX~P!1WOg/RO~Oa$Pi!]$Pi'z$Pi'w$Pi!Y$Pi!k$Piv$Pi!_$Pi%i$Pi!g$Pi~P!:tO$]/SO$_/SO~O$]/TO$_/TO~O!g)hO#`/UO!_$cX$Z$cX$]$cX$_$cX$f$cX~O![/VO~O!_)kO$Z/XO$])jO$_)jO$f/YO~O!]<iO!^(fX~P#BwO!^/ZO~O!g)hO$f({X~O$f/]O~Ov/^O~P!&zOx)yO(b)zO(c/aO~O!S/dO~O(y$}On%aa!Q%aa'y%aa(z%aa!]%aa#`%aa~Og%aa$O%aa~P#L{O(z%POn%ca!Q%ca'y%ca(y%ca!]%ca#`%ca~Og%ca$O%ca~P#MnO!]fX!gfX!kfX!k$zX(rfX~P!0SOp%WO![/mO!](^O(T/lO!Y(vP!Y)PP~P!1uOr*sO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO~Os<}O!S/nO![+[O!^*pO(e<|O!^(xP~P$ [O!k/oO~P#/sO!]/pO!g#vO(r'pO!k)OX~O!k/uO~OnoX!QoX'yoX(yoX(zoX~O!g#vO!koX~P$#OOp/wO!S%hO![*^O!_%iO(T%gO!k)OP~O#k/xO~O!Y$zX!]$zX!g%RX~P!0SO!]/yO!Y)PX~P#/sO!g/{O~O!Y/}O~OpkO(T0OO~P.iOh%VOr0TO!g#vO!l%eO(r'pO~O!g+iO~Oa%nO!]0XO'z%nO~O!^0ZO~P!5iO!c0[O!d0[O(U!lO~P#$`Os!nO!S0]O(VTO(YUO(e!mO~O#[0_O~Og%aa!]%aa#`%aa$O%aa~P!1WOg%ca!]%ca#`%ca$O%ca~P!1WOj%dOk%dOl%dO(T&ZOg'mX!]'mX~O!]*yOg(^a~Og0hO~On0jO#`0iOg(_a!](_a~OR0kO!Q0kO!S0lO#S$dOn}a'y}a(y}a(z}a!]}a#`}a~Og}a$O}a~P$(cO!Q*OO'y*POn$sa(y$sa(z$sa!]$sa#`$sa~Og$sa$O$sa~P$)_O!Q*OO'y*POn$ua(y$ua(z$ua!]$ua#`$ua~Og$ua$O$ua~P$*QO#k0oO~Og%Ta!]%Ta#`%Ta$O%Ta~P!1WO!g#vO~O#k0rO~O!]+^Oa)Ta'z)Ta~OR#zO!Q#yO!S#{O!l#xO(aVOP!ri[!rij!rir!ri!]!ri!p!ri#R!ri#n!ri#o!ri#p!ri#q!ri#r!ri#s!ri#t!ri#u!ri#v!ri#x!ri#z!ri#{!ri(r!ri(y!ri(z!ri~Oa!ri'z!ri'w!ri!Y!ri!k!riv!ri!_!ri%i!ri!g!ri~P$+oOh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op0{O%]0|O(T0zO~P$.VO!g+iOa(]a!_(]a'z(]a!](]a~O#k1SO~O[]X!]fX!^fX~O!]1TO!^)XX~O!^1VO~O[1WO~Ob1YO(T+qO(VTO(YUO~O!_&PO(T%gO`'uX!]'uX~O!]+vO`)Wa~O!k1]O~P!:tO[1`O~O`1aO~O#`1fO~On1iO!_$|O~O(e(|O!^)UP~Oh%VOn1rO!_1oO%i1qO~O[1|O!]1zO!^)VX~O!^1}O~O`2POa%nO'z%nO~O(T#nO(VTO(YUO~O#S$dO#`$eO$Q$eOP(gXR(gX[(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~Oj2SO&[2TOa(gX~P$3pOj2SO#`$eO&[2TO~Oa2VO~P%[Oa2XO~O&e2[OP&ciQ&ciS&ciY&cia&cid&cie&cil&cip&cir&cis&cit&ciz&ci|&ci!O&ci!S&ci!W&ci!X&ci!_&ci!i&ci!l&ci!o&ci!p&ci!q&ci!s&ci!u&ci!x&ci!|&ci$W&ci$n&ci%h&ci%j&ci%l&ci%m&ci%n&ci%q&ci%s&ci%v&ci%w&ci%y&ci&W&ci&^&ci&`&ci&b&ci&d&ci&g&ci&m&ci&s&ci&u&ci&w&ci&y&ci&{&ci'w&ci(T&ci(V&ci(Y&ci(a&ci(o&ci!^&cib&ci&j&ci~Ob2bO!^2`O&j2aO~P`O!_XO!l2dO~O&q,{OP&liQ&liS&liY&lia&lid&lie&lil&lip&lir&lis&lit&liz&li|&li!O&li!S&li!W&li!X&li!_&li!i&li!l&li!o&li!p&li!q&li!s&li!u&li!x&li!|&li$W&li$n&li%h&li%j&li%l&li%m&li%n&li%q&li%s&li%v&li%w&li%y&li&W&li&^&li&`&li&b&li&d&li&g&li&m&li&s&li&u&li&w&li&y&li&{&li'w&li(T&li(V&li(Y&li(a&li(o&li!^&li&e&lib&li&j&li~O!Y2jO~O!]!aa!^!aa~P#BwOs!nO!S!oO![2pO(e!mO!]'XX!^'XX~P@nO!]-]O!^(ia~O!]'_X!^'_X~P!9|O!]-`O!^(xa~O!^2wO~P'_Oa%nO#`3QO'z%nO~Oa%nO!g#vO#`3QO'z%nO~Oa%nO!g#vO!p3UO#`3QO'z%nO(r'pO~Oa%nO'z%nO~P!:tO!]$_Ov$qa~O!Y'Wi!]'Wi~P!:tO!](VO!Y(hi~O!](^O!Y(vi~O!Y(wi!](wi~P!:tO!](ti!k(tia(ti'z(ti~P!:tO#`3WO!](ti!k(tia(ti'z(ti~O!](jO!k(si~O!S%hO!_%iO!|]O#i3]O#j3[O(T%gO~O!S%hO!_%iO#j3[O(T%gO~On3dO!_'`O%i3cO~Oh%VOn3dO!_'`O%i3cO~O#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aav%aa!_%aa%i%aa!g%aa~P#L{O#k%caP%caR%ca[%caa%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%cav%ca!_%ca%i%ca!g%ca~P#MnO#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!]%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aa#`%aav%aa!_%aa%i%aa!g%aa~P#/sO#k%caP%caR%ca[%caa%caj%car%ca!S%ca!]%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%ca#`%cav%ca!_%ca%i%ca!g%ca~P#/sO#k}aP}a[}aa}aj}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a'z}a(a}a(r}a!k}a!Y}a'w}av}a!_}a%i}a!g}a~P$(cO#k$saP$saR$sa[$saa$saj$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa'z$sa(a$sa(r$sa!k$sa!Y$sa'w$sav$sa!_$sa%i$sa!g$sa~P$)_O#k$uaP$uaR$ua[$uaa$uaj$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua'z$ua(a$ua(r$ua!k$ua!Y$ua'w$uav$ua!_$ua%i$ua!g$ua~P$*QO#k%TaP%TaR%Ta[%Taa%Taj%Tar%Ta!S%Ta!]%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta'z%Ta(a%Ta(r%Ta!k%Ta!Y%Ta'w%Ta#`%Tav%Ta!_%Ta%i%Ta!g%Ta~P#/sOa#cq!]#cq'z#cq'w#cq!Y#cq!k#cqv#cq!_#cq%i#cq!g#cq~P!:tO![3lO!]'YX!k'YX~P%[O!].tO!k(ka~O!].tO!k(ka~P!:tO!Y3oO~O$O!na!^!na~PKlO$O!ja!]!ja!^!ja~P#BwO$O!ra!^!ra~P!=[O$O!ta!^!ta~P!?rOg']X!]']X~P!,TO!]/POg(pa~OSfO!_4TO$d4UO~O!^4YO~Ov4ZO~P#/sOa$mq!]$mq'z$mq'w$mq!Y$mq!k$mqv$mq!_$mq%i$mq!g$mq~P!:tO!Y4]O~P!&zO!S4^O~O!Q*OO'y*PO(z%POn'ia(y'ia!]'ia#`'ia~Og'ia$O'ia~P%-fO!Q*OO'y*POn'ka(y'ka(z'ka!]'ka#`'ka~Og'ka$O'ka~P%.XO(r$YO~P#/sO!YfX!Y$zX!]fX!]$zX!g%RX#`fX~P!0SOp%WO(T=WO~P!1uOp4bO!S%hO![4aO!_%iO(T%gO!]'eX!k'eX~O!]/pO!k)Oa~O!]/pO!g#vO!k)Oa~O!]/pO!g#vO(r'pO!k)Oa~Og$|i!]$|i#`$|i$O$|i~P!1WO![4jO!Y'gX!]'gX~P!3tO!]/yO!Y)Pa~O!]/yO!Y)Pa~P#/sOP]XR]X[]Xj]Xr]X!Q]X!S]X!Y]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~Oj%YX!g%YX~P%2OOj4oO!g#vO~Oh%VO!g#vO!l%eO~Oh%VOr4tO!l%eO(r'pO~Or4yO!g#vO(r'pO~Os!nO!S4zO(VTO(YUO(e!mO~O(y$}On%ai!Q%ai'y%ai(z%ai!]%ai#`%ai~Og%ai$O%ai~P%5oO(z%POn%ci!Q%ci'y%ci(y%ci!]%ci#`%ci~Og%ci$O%ci~P%6bOg(_i!](_i~P!1WO#`5QOg(_i!](_i~P!1WO!k5VO~Oa$oq!]$oq'z$oq'w$oq!Y$oq!k$oqv$oq!_$oq%i$oq!g$oq~P!:tO!Y5ZO~O!]5[O!_)QX~P#/sOa$zX!_$zX%^]X'z$zX!]$zX~P!0SO%^5_OaoX!_oX'zoX!]oX~P$#OOp5`O(T#nO~O%^5_O~Ob5fO%j5gO(T+qO(VTO(YUO!]'tX!^'tX~O!]1TO!^)Xa~O[5kO~O`5lO~O[5pO~Oa%nO'z%nO~P#/sO!]5uO#`5wO!^)UX~O!^5xO~Or6OOs!nO!S*iO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!pO#W!pO#X!pO#[5}O#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O!^5|O~P%;eOn6TO!_1oO%i6SO~Oh%VOn6TO!_1oO%i6SO~Ob6[O(T#nO(VTO(YUO!]'sX!^'sX~O!]1zO!^)Va~O(VTO(YUO(e6^O~O`6bO~Oj6eO&[6fO~PNXO!k6gO~P%[Oa6iO~Oa6iO~P%[Ob2bO!^6nO&j2aO~P`O!g6pO~O!g6rOh(ji!](ji!^(ji!g(ji!l(jir(ji(r(ji~O!]#hi!^#hi~P#BwO#`6sO!]#hi!^#hi~O!]!ai!^!ai~P#BwOa%nO#`6|O'z%nO~Oa%nO!g#vO#`6|O'z%nO~O!](tq!k(tqa(tq'z(tq~P!:tO!](jO!k(sq~O!S%hO!_%iO#j7TO(T%gO~O!_'`O%i7WO~On7[O!_'`O%i7WO~O#k'iaP'iaR'ia['iaa'iaj'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia'z'ia(a'ia(r'ia!k'ia!Y'ia'w'iav'ia!_'ia%i'ia!g'ia~P%-fO#k'kaP'kaR'ka['kaa'kaj'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka'z'ka(a'ka(r'ka!k'ka!Y'ka'w'kav'ka!_'ka%i'ka!g'ka~P%.XO#k$|iP$|iR$|i[$|ia$|ij$|ir$|i!S$|i!]$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i'z$|i(a$|i(r$|i!k$|i!Y$|i'w$|i#`$|iv$|i!_$|i%i$|i!g$|i~P#/sO#k%aiP%aiR%ai[%aia%aij%air%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai'z%ai(a%ai(r%ai!k%ai!Y%ai'w%aiv%ai!_%ai%i%ai!g%ai~P%5oO#k%ciP%ciR%ci[%cia%cij%cir%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci'z%ci(a%ci(r%ci!k%ci!Y%ci'w%civ%ci!_%ci%i%ci!g%ci~P%6bO!]'Ya!k'Ya~P!:tO!].tO!k(ki~O$O#ci!]#ci!^#ci~P#BwOP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mij#mir#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#n#mi~P%NdO#n<_O~P%NdOP$[OR#zOr<kO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO[#mij#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#r#mi~P&!lO#r<aO~P&!lOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO(aVO#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#v#mi~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO(aVO(z#}O#z#mi#{#mi$O#mi(r#mi(y#mi!]#mi!^#mi~O#x<eO~P&&uO#x#mi~P&&uO#v<cO~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO(aVO(y#|O(z#}O#{#mi$O#mi(r#mi!]#mi!^#mi~O#z#mi~P&)UO#z<gO~P&)UOa#|y!]#|y'z#|y'w#|y!Y#|y!k#|yv#|y!_#|y%i#|y!g#|y~P!:tO[#mij#mir#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi!]#mi!^#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO(y#mi(z#mi~P&,QOn>^O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P&,QO#S$dOP(`XR(`X[(`Xj(`Xn(`Xr(`X!Q(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X$O(`X'y(`X(a(`X(r(`X(y(`X(z(`X!](`X!^(`X~O$O$Pi!]$Pi!^$Pi~P#BwO$O!ri!^!ri~P$+oOg']a!]']a~P!1WO!^7nO~O!]'da!^'da~P#BwO!Y7oO~P#/sO!g#vO(r'pO!]'ea!k'ea~O!]/pO!k)Oi~O!]/pO!g#vO!k)Oi~Og$|q!]$|q#`$|q$O$|q~P!1WO!Y'ga!]'ga~P#/sO!g7vO~O!]/yO!Y)Pi~P#/sO!]/yO!Y)Pi~O!Y7yO~Oh%VOr8OO!l%eO(r'pO~Oj8QO!g#vO~Or8TO!g#vO(r'pO~O!Q*OO'y*PO(z%POn'ja(y'ja!]'ja#`'ja~Og'ja$O'ja~P&5RO!Q*OO'y*POn'la(y'la(z'la!]'la#`'la~Og'la$O'la~P&5tOg(_q!](_q~P!1WO#`8VOg(_q!](_q~P!1WO!Y8WO~Og%Oq!]%Oq#`%Oq$O%Oq~P!1WOa$oy!]$oy'z$oy'w$oy!Y$oy!k$oyv$oy!_$oy%i$oy!g$oy~P!:tO!g6rO~O!]5[O!_)Qa~O!_'`OP$TaR$Ta[$Taj$Tar$Ta!Q$Ta!S$Ta!]$Ta!l$Ta!p$Ta#R$Ta#n$Ta#o$Ta#p$Ta#q$Ta#r$Ta#s$Ta#t$Ta#u$Ta#v$Ta#x$Ta#z$Ta#{$Ta(a$Ta(r$Ta(y$Ta(z$Ta~O%i7WO~P&8fO%^8[Oa%[i!_%[i'z%[i!]%[i~Oa#cy!]#cy'z#cy'w#cy!Y#cy!k#cyv#cy!_#cy%i#cy!g#cy~P!:tO[8^O~Ob8`O(T+qO(VTO(YUO~O!]1TO!^)Xi~O`8dO~O(e(|O!]'pX!^'pX~O!]5uO!^)Ua~O!^8nO~P%;eO(o!sO~P$&YO#[8oO~O!_1oO~O!_1oO%i8qO~On8tO!_1oO%i8qO~O[8yO!]'sa!^'sa~O!]1zO!^)Vi~O!k8}O~O!k9OO~O!k9RO~O!k9RO~P%[Oa9TO~O!g9UO~O!k9VO~O!](wi!^(wi~P#BwOa%nO#`9_O'z%nO~O!](ty!k(tya(ty'z(ty~P!:tO!](jO!k(sy~O%i9bO~P&8fO!_'`O%i9bO~O#k$|qP$|qR$|q[$|qa$|qj$|qr$|q!S$|q!]$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q'z$|q(a$|q(r$|q!k$|q!Y$|q'w$|q#`$|qv$|q!_$|q%i$|q!g$|q~P#/sO#k'jaP'jaR'ja['jaa'jaj'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja'z'ja(a'ja(r'ja!k'ja!Y'ja'w'jav'ja!_'ja%i'ja!g'ja~P&5RO#k'laP'laR'la['laa'laj'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la'z'la(a'la(r'la!k'la!Y'la'w'lav'la!_'la%i'la!g'la~P&5tO#k%OqP%OqR%Oq[%Oqa%Oqj%Oqr%Oq!S%Oq!]%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq'z%Oq(a%Oq(r%Oq!k%Oq!Y%Oq'w%Oq#`%Oqv%Oq!_%Oq%i%Oq!g%Oq~P#/sO!]'Yi!k'Yi~P!:tO$O#cq!]#cq!^#cq~P#BwO(y$}OP%aaR%aa[%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa$O%aa(a%aa(r%aa!]%aa!^%aa~On%aa!Q%aa'y%aa(z%aa~P&IyO(z%POP%caR%ca[%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca$O%ca(a%ca(r%ca!]%ca!^%ca~On%ca!Q%ca'y%ca(y%ca~P&LQOn>^O!Q*OO'y*PO(z%PO~P&IyOn>^O!Q*OO'y*PO(y$}O~P&LQOR0kO!Q0kO!S0lO#S$dOP}a[}aj}an}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a$O}a'y}a(a}a(r}a(y}a(z}a!]}a!^}a~O!Q*OO'y*POP$saR$sa[$saj$san$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa$O$sa(a$sa(r$sa(y$sa(z$sa!]$sa!^$sa~O!Q*OO'y*POP$uaR$ua[$uaj$uan$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua$O$ua(a$ua(r$ua(y$ua(z$ua!]$ua!^$ua~On>^O!Q*OO'y*PO(y$}O(z%PO~OP%TaR%Ta[%Taj%Tar%Ta!S%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta$O%Ta(a%Ta(r%Ta!]%Ta!^%Ta~P''VO$O$mq!]$mq!^$mq~P#BwO$O$oq!]$oq!^$oq~P#BwO!^9oO~O$O9pO~P!1WO!g#vO!]'ei!k'ei~O!g#vO(r'pO!]'ei!k'ei~O!]/pO!k)Oq~O!Y'gi!]'gi~P#/sO!]/yO!Y)Pq~Or9wO!g#vO(r'pO~O[9yO!Y9xO~P#/sO!Y9xO~Oj:PO!g#vO~Og(_y!](_y~P!1WO!]'na!_'na~P#/sOa%[q!_%[q'z%[q!]%[q~P#/sO[:UO~O!]1TO!^)Xq~O`:YO~O#`:ZO!]'pa!^'pa~O!]5uO!^)Ui~P#BwO!S:]O~O!_1oO%i:`O~O(VTO(YUO(e:eO~O!]1zO!^)Vq~O!k:hO~O!k:iO~O!k:jO~O!k:jO~P%[O#`:mO!]#hy!^#hy~O!]#hy!^#hy~P#BwO%i:rO~P&8fO!_'`O%i:rO~O$O#|y!]#|y!^#|y~P#BwOP$|iR$|i[$|ij$|ir$|i!S$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i$O$|i(a$|i(r$|i!]$|i!^$|i~P''VO!Q*OO'y*PO(z%POP'iaR'ia['iaj'ian'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia$O'ia(a'ia(r'ia(y'ia!]'ia!^'ia~O!Q*OO'y*POP'kaR'ka['kaj'kan'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka$O'ka(a'ka(r'ka(y'ka(z'ka!]'ka!^'ka~O(y$}OP%aiR%ai[%aij%ain%air%ai!Q%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai$O%ai'y%ai(a%ai(r%ai(z%ai!]%ai!^%ai~O(z%POP%ciR%ci[%cij%cin%cir%ci!Q%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci$O%ci'y%ci(a%ci(r%ci(y%ci!]%ci!^%ci~O$O$oy!]$oy!^$oy~P#BwO$O#cy!]#cy!^#cy~P#BwO!g#vO!]'eq!k'eq~O!]/pO!k)Oy~O!Y'gq!]'gq~P#/sOr:|O!g#vO(r'pO~O[;QO!Y;PO~P#/sO!Y;PO~Og(_!R!](_!R~P!1WOa%[y!_%[y'z%[y!]%[y~P#/sO!]1TO!^)Xy~O!]5uO!^)Uq~O(T;XO~O!_1oO%i;[O~O!k;_O~O%i;dO~P&8fOP$|qR$|q[$|qj$|qr$|q!S$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q$O$|q(a$|q(r$|q!]$|q!^$|q~P''VO!Q*OO'y*PO(z%POP'jaR'ja['jaj'jan'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja$O'ja(a'ja(r'ja(y'ja!]'ja!^'ja~O!Q*OO'y*POP'laR'la['laj'lan'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la$O'la(a'la(r'la(y'la(z'la!]'la!^'la~OP%OqR%Oq[%Oqj%Oqr%Oq!S%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq$O%Oq(a%Oq(r%Oq!]%Oq!^%Oq~P''VOg%e!Z!]%e!Z#`%e!Z$O%e!Z~P!1WO!Y;hO~P#/sOr;iO!g#vO(r'pO~O[;kO!Y;hO~P#/sO!]'pq!^'pq~P#BwO!]#h!Z!^#h!Z~P#BwO#k%e!ZP%e!ZR%e!Z[%e!Za%e!Zj%e!Zr%e!Z!S%e!Z!]%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z'z%e!Z(a%e!Z(r%e!Z!k%e!Z!Y%e!Z'w%e!Z#`%e!Zv%e!Z!_%e!Z%i%e!Z!g%e!Z~P#/sOr;tO!g#vO(r'pO~O!Y;uO~P#/sOr;|O!g#vO(r'pO~O!Y;}O~P#/sOP%e!ZR%e!Z[%e!Zj%e!Zr%e!Z!S%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z$O%e!Z(a%e!Z(r%e!Z!]%e!Z!^%e!Z~P''VOr<QO!g#vO(r'pO~Ov(fX~P1qO!Q%rO~P!)[O(U!lO~P!)[O!YfX!]fX#`fX~P%2OOP]XR]X[]Xj]Xr]X!Q]X!S]X!]]X!]fX!l]X!p]X#R]X#S]X#`]X#`fX#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~O!gfX!k]X!kfX(rfX~P'LTOP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_XO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]<iO!^$qa~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<tO!S${O!_$|O!i>WO!l$xO#j<zO$W%`O$t<vO$v<xO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Ol)dO~P(!yOr!eX(r!eX~P#!iOr(jX(r(jX~P##[O!^]X!^fX~P'LTO!YfX!Y$zX!]fX!]$zX#`fX~P!0SO#k<^O~O!g#vO#k<^O~O#`<nO~Oj<bO~O#`=OO!](wX!^(wX~O#`<nO!](uX!^(uX~O#k=PO~Og=RO~P!1WO#k=XO~O#k=YO~Og=RO(T&ZO~O!g#vO#k=ZO~O!g#vO#k=PO~O$O=[O~P#BwO#k=]O~O#k=^O~O#k=cO~O#k=dO~O#k=eO~O#k=fO~O$O=gO~P!1WO$O=hO~P!1WOl=sO~P7eOk#S#T#U#W#X#[#i#j#u$n$t$v$y%]%^%h%i%j%q%s%v%w%y%{~(OT#o!X'|(U#ps#n#qr!Q'}$]'}(T$_(e~",goto:"$9Y)]PPPPPP)^PP)aP)rP+W/]PPPP6mPP7TPP=QPPP@tPA^PA^PPPA^PCfPA^PA^PA^PCjPCoPD^PIWPPPI[PPPPI[L_PPPLeMVPI[PI[PP! eI[PPPI[PI[P!#lI[P!'S!(X!(bP!)U!)Y!)U!,gPPPPPPP!-W!(XPP!-h!/YP!2iI[I[!2n!5z!:h!:h!>gPPP!>oI[PPPPPPPPP!BOP!C]PPI[!DnPI[PI[I[I[I[I[PI[!FQP!I[P!LbP!Lf!Lp!Lt!LtP!IXP!Lx!LxP#!OP#!SI[PI[#!Y#%_CjA^PA^PA^A^P#&lA^A^#)OA^#+vA^#.SA^A^#.r#1W#1W#1]#1f#1W#1qPP#1WPA^#2ZA^#6YA^A^6mPPP#:_PPP#:x#:xP#:xP#;`#:xPP#;fP#;]P#;]#;y#;]#<e#<k#<n)aP#<q)aP#<z#<z#<zP)aP)aP)aP)aPP)aP#=Q#=TP#=T)aP#=XP#=[P)aP)aP)aP)aP)aP)a)aPP#=b#=h#=s#=y#>P#>V#>]#>k#>q#>{#?R#?]#?c#?s#?y#@k#@}#AT#AZ#Ai#BO#Cs#DR#DY#Et#FS#Gt#HS#HY#H`#Hf#Hp#Hv#H|#IW#Ij#IpPPPPPPPPPPP#IvPPPPPPP#Jk#Mx$ b$ i$ qPPP$']P$'f$*_$0x$0{$1O$1}$2Q$2X$2aP$2g$2jP$3W$3[$4S$5b$5g$5}PP$6S$6Y$6^$6a$6e$6i$7e$7|$8e$8i$8l$8o$8y$8|$9Q$9UR!|RoqOXst!Z#d%m&r&t&u&w,s,x2[2_Y!vQ'`-e1o5{Q%tvQ%|yQ&T|Q&j!VS'W!e-]Q'f!iS'l!r!yU*k$|*Z*oQ+o%}S+|&V&WQ,d&dQ-c'_Q-m'gQ-u'mQ0[*qQ1b,OQ1y,eR<{<Y%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_S#q]<V!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU+P%]<s<tQ+t&PQ,f&gQ,m&oQ0x+gQ0}+iQ1Y+uQ2R,kQ3`.gQ5`0|Q5f1TQ6[1zQ7Y3dQ8`5gR9e7['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S!S!nQ!r!v!y!z$|'W'_'`'l'm'n*k*o*q*r-]-c-e-u0[0_1o5{5}%[$ti#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q&X|Q'U!eS'[%i-`Q+t&PQ,P&WQ,f&gQ0n+SQ1Y+uQ1_+{Q2Q,jQ2R,kQ5f1TQ5o1aQ6[1zQ6_1|Q6`2PQ8`5gQ8c5lQ8|6bQ:X8dQ:f8yQ;V:YR<}*ZrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R,h&k&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'b'r(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>R>S[#]WZ#W#Z'X(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ%wxQ%{yW&Q|&V&W,OQ&_!TQ'c!hQ'e!iQ(q#sS+n%|%}Q+r&PQ,_&bQ,c&dS-l'f'gQ.i(rQ1R+oQ1X+uQ1Z+vQ1^+zQ1t,`S1x,d,eQ2|-mQ5e1TQ5i1WQ5n1`Q6Z1yQ8_5gQ8b5kQ8f5pQ:T8^R;T:U!U$zi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y!^%yy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{Q+h%wQ,T&[Q,W&]Q,b&dQ.h(qQ1s,_U1w,c,d,eQ3e.iQ6U1tS6Y1x1yQ8x6Z#f>T#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o>U<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hW%Ti%V*y>PS&[!Q&iQ&]!RQ&^!SU*}%[%d=sR,R&Y%]%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^T)z$u){V+P%]<s<tW'[!e%i*Z-`S(}#y#zQ+c%rQ+y&SS.b(m(nQ1j,XQ5T0kR8i5u'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S$i$^c#Y#e%q%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.|.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ'Y!eR2q-]!W!nQ!e!r!v!y!z$|'W'_'`'l'm'n*Z*k*o*q*r-]-c-e-u0[0_1o5{5}R1l,ZnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&y!^Q'v!xS(s#u<^Q+l%zQ,]&_Q,^&aQ-j'dQ-w'oS.r(x=PS0q+X=ZQ1P+mQ1n,[Q2c,zQ2e,{Q2m-WQ2z-kQ2}-oS5Y0r=eQ5a1QS5d1S=fQ6t2oQ6x2{Q6}3SQ8]5bQ9Y6vQ9Z6yQ9^7OR:l9V$d$]c#Y#e%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vS(o#p'iQ)P#zS+b%q.|S.c(n(pR3^.d'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS#q]<VQ&t!XQ&u!YQ&w![Q&x!]R2Z,vQ'a!hQ+e%wQ-h'cS.e(q+hQ2x-gW3b.h.i0w0yQ6w2yW7U3_3a3e5^U9a7V7X7ZU:q9c9d9fS;b:p:sQ;p;cR;x;qU!wQ'`-eT5y1o5{!Q_OXZ`st!V!Z#d#h%e%m&i&k&r&t&u&w(j,s,x.[2[2_]!pQ!r'`-e1o5{T#q]<V%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S(}#y#zS.b(m(n!s=l$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU$fd)_,mS(p#p'iU*v%R(w4OU0m+O.n7gQ5^0xQ7V3`Q9d7YR:s9em!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}Q't!uS(f#g2US-s'k'wQ/s*]Q0R*jQ3U-vQ4f/tQ4r0TQ4s0UQ4x0^Q7r4`S7}4t4vS8R4y4{Q9r7sQ9v7yQ9{8OQ:Q8TS:{9w9xS;g:|;PS;s;h;iS;{;t;uS<P;|;}R<S<QQ#wbQ's!uS(e#g2US(g#m+WQ+Y%fQ+j%xQ+p&OU-r'k't'wQ.W(fU/r*]*`/wQ0S*jQ0V*lQ1O+kQ1u,aS3R-s-vQ3Z.`S4e/s/tQ4n0PS4q0R0^Q4u0WQ6W1vQ7P3US7q4`4bQ7u4fU7|4r4x4{Q8P4wQ8v6XS9q7r7sQ9u7yQ9}8RQ:O8SQ:c8wQ:y9rS:z9v9xQ;S:QQ;^:dS;f:{;PS;r;g;hS;z;s;uS<O;{;}Q<R<PQ<T<SQ=o=jQ={=tR=|=uV!wQ'`-e%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S#wz!j!r=i$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=o>R%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Q%fj!^%xy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{S&Oz!jQ+k%yQ,a&dW1v,b,c,d,eU6X1w1x1yS8w6Y6ZQ:d8x!r=j$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ=t>QR=u>R%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Y#bWZ#W#Z(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ,n&o!p=k$Z$n)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=n'XU']!e%i*ZR2s-`%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ,m&oQ0x+gQ3`.gQ7Y3dR9e7[!b$Tc#Y%q(S(Y(t(y)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!P<d)^)q-Z.|2k2n3p3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!f$Vc#Y%q(S(Y(t(y)W)X)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!T<f)^)q-Z.|2k2n3p3v3w3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!^$Zc#Y%q(S(Y(t(y)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<WQ4_/kz>S)^)q-Z.|2k2n3p4P4X6u7b7k7l8k9X9g9m9n;W;`=vQ>X>ZR>Y>['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS$oh$pR4U/U'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$kf$qQ$ifS)j$l)nR)v$qT$jf$qT)l$l)n'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$oh$pQ$rhR)u$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_!s>Q$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S#glOPXZst!Z!`!o#S#d#o#{$n%m&k&n&o&r&t&u&w&{'T'b)O)s*i+]+g,p,s,x-i.g/V/n0]0l1r2S2T2V2X2[2_2a3d4T4z6T6e6f6i7[8t9T!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^Q+T%aQ/c*Oo4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!U$yi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>YQ*c$zU*l$|*Z*oQ+U%bQ0W*m#f=q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n=r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hQ=w>TQ=x>UQ=y>VR=z>W!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hnoOXst!Z#d%m&r&t&u&w,s,x2[2_S*f${*YQ-R'OQ-S'QR4i/y%[%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q,U&]Q1h,WQ5s1gR8h5tV*n$|*Z*oU*n$|*Z*oT5z1o5{S0P*i/nQ4w0]T8S4z:]Q+j%xQ0V*lQ1O+kQ1u,aQ6W1vQ8v6XQ:c8wR;^:d!U%Oi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Yx*R$v)e*S*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>OS0`*t0a#f<o#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<p<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!d=S(u)c*[*e.j.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[`=T3}7c7f7j9h:t:w;yS=_.l3iT=`7e9k!U%Qi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y|*T$v)e*U*t+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>OS0b*u0c#f<q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!h=U(u)c*[*e.k.l.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[d=V3}7d7e7j9h9i:t:u:w;yS=a.m3jT=b7f9lrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q&f!UR,p&ornOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R&f!UQ,Y&^R1d,RsnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q1p,_S6R1s1tU8p6P6Q6US:_8r8sS;Y:^:aQ;m;ZR;w;nQ&m!VR,i&iR6_1|R:f8yW&Q|&V&W,OR1Z+vQ&r!WR,s&sR,y&xT2],x2_R,}&yQ,|&yR2f,}Q'y!{R-y'ySsOtQ#dXT%ps#dQ#OTR'{#OQ#RUR'}#RQ){$uR/`){Q#UVR(Q#UQ#XWU(W#X(X.QQ(X#YR.Q(YQ-^'YR2r-^Q.u(yS3m.u3nR3n.vQ-e'`R2v-eY!rQ'`-e1o5{R'j!rQ/Q)eR4S/QU#_W%h*YU(_#_(`.RQ(`#`R.R(ZQ-a']R2t-at`OXst!V!Z#d%m&i&k&r&t&u&w,s,x2[2_S#hZ%eU#r`#h.[R.[(jQ(k#jQ.X(gW.a(k.X3X7RQ3X.YR7R3YQ)n$lR/W)nQ$phR)t$pQ$`cU)a$`-|<jQ-|<WR<j)qQ/q*]W4c/q4d7t9sU4d/r/s/tS7t4e4fR9s7u$e*Q$v(u)c)e*[*e*t*u+Q+R+V.l.m.o.p.q/_/g/i/k/v/|0d0e0v1e3f3g3h3}4R4[4g4h4l4|5O5R5S5W5r7]7^7_7`7e7f7h7i7j7p7w7z8U8X8Z9h9i9j9t9|:R:S:t:u:v:w:x:};R;e;j;v;y=p=}>O>Z>[Q/z*eU4k/z4m7xQ4m/|R7x4lS*o$|*ZR0Y*ox*S$v)e*t*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>O!d.j(u)c*[*e.l.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/h*S.j7ca7c3}7e7f7j9h:t:w;yQ0a*tQ3i.lU4}0a3i9kR9k7e|*U$v)e*t*u+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>O!h.k(u)c*[*e.l.m.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/j*U.k7de7d3}7e7f7j9h9i:t:u:w;yQ0c*uQ3j.mU5P0c3j9lR9l7fQ*z%UR0g*zQ5]0vR8Y5]Q+_%kR0u+_Q5v1jS8j5v:[R:[8kQ,[&_R1m,[Q5{1oR8m5{Q1{,fS6]1{8zR8z6_Q1U+rW5h1U5j8a:VQ5j1XQ8a5iR:V8bQ+w&QR1[+wQ2_,xR6m2_YrOXst#dQ&v!ZQ+a%mQ,r&rQ,t&tQ,u&uQ,w&wQ2Y,sS2],x2_R6l2[Q%opQ&z!_Q&}!aQ'P!bQ'R!cQ'q!uQ+`%lQ+l%zQ,Q&XQ,h&mQ-P&|W-p'k's't'wQ-w'oQ0X*nQ1P+mQ1c,PS2O,i,lQ2g-OQ2h-RQ2i-SQ2}-oW3P-r-s-v-xQ5a1QQ5m1_Q5q1eQ6V1uQ6a2QQ6k2ZU6z3O3R3UQ6}3SQ8]5bQ8e5oQ8g5rQ8l5zQ8u6WQ8{6`S9[6{7PQ9^7OQ:W8cQ:b8vQ:g8|Q:n9]Q;U:XQ;]:cQ;a:oQ;l;VR;o;^Q%zyQ'd!iQ'o!uU+m%{%|%}Q-W'VU-k'e'f'gS-o'k'uQ0Q*jS1Q+n+oQ2o-YS2{-l-mQ3S-tS4p0R0UQ5b1RQ6v2uQ6y2|Q7O3TU7{4r4s4vQ9z7}R;O9{S$wi>PR*{%VU%Ui%V>PR0f*yQ$viS(u#v+iS)c$b$cQ)e$dQ*[$xS*e${*YQ*t%OQ*u%QQ+Q%^Q+R%_Q+V%cQ.l<oQ.m<qQ.o<uQ.p<wQ.q<yQ/_)yQ/g*RQ/i*TQ/k*VQ/v*aS/|*g/mQ0d*wQ0e*xl0v+f,V.f1i1q3c6S7W8q9b:`:r;[;dQ1e,SQ3f=SQ3g=UQ3h=XS3}<l<mQ4R/PS4[/d4^Q4g/xQ4h/yQ4l/{Q4|0`Q5O0bQ5R0iQ5S0jQ5W0oQ5r1fQ7]=]Q7^=_Q7_=aQ7`=cQ7e<pQ7f<rQ7h<vQ7i<xQ7j<zQ7p4_Q7w4jQ7z4oQ8U5QQ8X5[Q8Z5_Q9h=YQ9i=TQ9j=VQ9t7vQ9|8QQ:R8VQ:S8[Q:t=^Q:u=`Q:v=bQ:w=dQ:x9pQ:}9yQ;R:PQ;e=gQ;j;QQ;v;kQ;y=hQ=p>PQ=}>XQ>O>YQ>Z>]R>[>^Q+O%]Q.n<sR7g<tnpOXst!Z#d%m&r&t&u&w,s,x2[2_Q!fPS#fZ#oQ&|!`W'h!o*i0]4zQ(P#SQ)Q#{Q)r$nS,l&k&nQ,q&oQ-O&{S-T'T/nQ-g'bQ.x)OQ/[)sQ0s+]Q0y+gQ2W,pQ2y-iQ3a.gQ4W/VQ5U0lQ6Q1rQ6c2SQ6d2TQ6h2VQ6j2XQ6o2aQ7Z3dQ7m4TQ8s6TQ9P6eQ9Q6fQ9S6iQ9f7[Q:a8tR:k9T#[cOPXZst!Z!`!o#d#o#{%m&k&n&o&r&t&u&w&{'T'b)O*i+]+g,p,s,x-i.g/n0]0l1r2S2T2V2X2[2_2a3d4z6T6e6f6i7[8t9TQ#YWQ#eYQ%quQ%svS%uw!gS(S#W(VQ(Y#ZQ(t#uQ(y#xQ)R$OQ)S$PQ)T$QQ)U$RQ)V$SQ)W$TQ)X$UQ)Y$VQ)Z$WQ)[$XQ)^$ZQ)`$_Q)b$aQ)g$eW)q$n)s/V4TQ+d%tQ+x&RS-Z'X2pQ-x'rS-}(T.PQ.S(]Q.U(dQ.s(xQ.v(zQ.z<UQ.|<XQ.}<YQ/O<]Q/b)}Q0p+XQ2k-UQ2n-XQ3O-qQ3V.VQ3k.tQ3p<^Q3q<_Q3r<`Q3s<aQ3t<bQ3u<cQ3v<dQ3w<eQ3x<fQ3y<gQ3z<hQ3{.{Q3|<kQ4P<nQ4Q<{Q4X<iQ5X0rQ5c1SQ6u=OQ6{3QQ7Q3WQ7a3lQ7b=PQ7k=RQ7l=ZQ8k5wQ9X6sQ9]6|Q9g=[Q9m=eQ9n=fQ:o9_Q;W:ZQ;`:mQ<W#SR=v>SR#[WR'Z!el!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}S'V!e-]U*j$|*Z*oS-Y'W'_S0U*k*qQ0^*rQ2u-cQ4v0[R4{0_R({#xQ!fQT-d'`-e]!qQ!r'`-e1o5{Q#p]R'i<VR)f$dY!uQ'`-e1o5{Q'k!rS'u!v!yS'w!z5}S-t'l'mQ-v'nR3T-uT#kZ%eS#jZ%eS%km,oU(g#h#i#lS.Y(h(iQ.^(jQ0t+^Q3Y.ZU3Z.[.]._S7S3[3]R9`7Td#^W#W#Z%h(T(^*Y+Z.T/mr#gZm#h#i#l%e(h(i(j+^.Z.[.]._3[3]7TS*]$x*bQ/t*^Q2U,oQ2l-VQ4`/pQ6q2dQ7s4aQ9W6rT=m'X+[V#aW%h*YU#`W%h*YS(U#W(^U(Z#Z+Z/mS-['X+[T.O(T.TV'^!e%i*ZQ$lfR)x$qT)m$l)nR4V/UT*_$x*bT*h${*YQ0w+fQ1g,VQ3_.fQ5t1iQ6P1qQ7X3cQ8r6SQ9c7WQ:^8qQ:p9bQ;Z:`Q;c:rQ;n;[R;q;dnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&l!VR,h&itmOXst!U!V!Z#d%m&i&r&t&u&w,s,x2[2_R,o&oT%lm,oR1k,XR,g&gQ&U|S+}&V&WR1^,OR+s&PT&p!W&sT&q!W&sT2^,x2_",nodeNames:"⚠ ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList in out const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration defer ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:380,context:qP,nodeProps:[["isolate",-8,5,6,14,37,39,51,53,55,""],["group",-26,9,17,19,68,207,211,215,216,218,221,224,234,237,243,245,247,249,252,258,264,266,268,270,272,274,275,"Statement",-34,13,14,32,35,36,42,51,54,55,57,62,70,72,76,80,82,84,85,110,111,120,121,136,139,141,142,143,144,145,147,148,167,169,171,"Expression",-23,31,33,37,41,43,45,173,175,177,178,180,181,182,184,185,186,188,189,190,201,203,205,206,"Type",-3,88,103,109,"ClassItem"],["openedBy",23,"<",38,"InterpolationStart",56,"[",60,"{",73,"(",160,"JSXStartCloseTag"],["closedBy",-2,24,168,">",40,"InterpolationEnd",50,"]",61,"}",74,")",165,"JSXEndTag"]],propSources:[JP],skippedNodes:[0,5,6,278],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$i&j(Wp(Z!b'|0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(X#S$i&j'}0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$i&j(Wp(Z!b'}0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$i&j!p),Q(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(V':f$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$i&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$d`$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$d``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$d`$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(Z!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$d`(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$i&j(Wp(Z!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$i&j(Wp(Z!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$i&j(Z!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$i&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(Z!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$i&j(WpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(WpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Wp(Z!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$i&j(o%1l(Wp(Z!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$i&j(Wp(Z!b$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$i&j(Wp(Z!b$]#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$i&j(Wp(Z!b#p(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$i&j$Q(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(z+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$i&j#z(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(Y';W$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$i&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$d`$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(WpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$d`(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!l/.^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!k!Lf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$i&j(Wp(Z!b(U%&f#q(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$i&j(Wp(Z!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$i&j(Wp(Z!br+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!]+Jf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$i&j(Wp(Z!b!Q.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_![!L^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$i&j(Wp(Z!b#o(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$i&j(Z!b!X7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$i&j!X7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$i&j!X7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!X7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!X7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$i&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$i&j(Z!b!X7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(Z!b!X7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(Z!b!X7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(Z!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$i&j(Z!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$i&j(Wp!X7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$i&j(Wp!X7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Wp!X7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Wp!X7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(WpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$i&j(WpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$i&j(Wp(Z!b!X7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Wp(Z!b!X7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Wp(Z!b!X7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Wp(Z!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$i&j(Wp(Z!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$i&j(Wp(Z!b(O0/l!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$i&j(Wp(Z!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$i&j(Z!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$i&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(Z!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$i&j(WpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(WpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Wp(Z!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$i&j$Q(Ch(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Z#t$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!g$b$i&j$O)Lv(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#R-<U(Wp(Z!b$n7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$k&j(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#r(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$Q(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#s(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#`*!Y$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#k(Cl$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#s(Ch$f#|$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#s(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(r(Ct$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$i&j#{(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!|$Ip$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!S0,v$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$i&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$i&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$i&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$i&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$i&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!Y#)l$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#x(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$i&j(Wp(Z!b(a+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$i&j(Wp(Z!b(T,2j$_#t(e$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$i&j(Wp(Z!b$_#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!_#Hb(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(y+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_!^(CdvBr$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!q7`$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$i&j(Wp(Z!b'|0/l$]#t(T,2j(e$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$i&j(Wp(Z!b'}0/l$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[GP,UP,HP,KP,2,3,4,5,6,7,8,9,10,11,12,13,14,VP,new Zu("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOx~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!U~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(c~~",141,340),new Zu("j~RQYZXz{^~^O(Q~~aP!P!Qd~iO(R~~",25,323)],topRules:{Script:[0,7],SingleExpression:[1,276],SingleClassItem:[2,277]},dialects:{jsx:0,ts:15175},dynamicPrecedences:{80:1,82:1,94:1,169:1,199:1},specialized:[{term:327,get:i=>e4[i]||-1},{term:343,get:i=>t4[i]||-1},{term:95,get:i=>i4[i]||-1}],tokenPrec:15201}),r4=Ya.define({name:"javascript",parser:n4.configure({props:[Z0.add({IfStatement:uc({except:/^\s*({|else\b)/}),TryStatement:uc({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:z$,SwitchBody:i=>{let t=i.textAfter,e=/^\s*\}/.test(t),n=/^\s*(case|default)\b/.test(t);return i.baseIndent+(e?0:n?1:2)*i.unit},Block:Z$({closing:"}"}),ArrowFunction:i=>i.baseIndent+i.unit,"TemplateString BlockComment":()=>null,"Statement Property":uc({except:/^\s*{/}),JSXElement(i){let t=/^\s*<\//.test(i.textAfter);return i.lineIndent(i.node.from)+(t?0:i.unit)},JSXEscape(i){let t=/\s*\}/.test(i.textAfter);return i.lineIndent(i.node.from)+(t?0:i.unit)},"JSXOpenTag JSXSelfClosingTag"(i){return i.column(i.node.from)+i.unit}}),L0.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":L$,BlockComment(i){return{from:i.from+2,to:i.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}});var s4=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,o4=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,a4=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Cc={Space_Separator:s4,ID_Start:o4,ID_Continue:a4},Dt={isSpaceSeparator(i){return typeof i=="string"&&Cc.Space_Separator.test(i)},isIdStartChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i==="$"||i==="_"||Cc.ID_Start.test(i))},isIdContinueChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i>="0"&&i<="9"||i==="$"||i==="_"||i==="‌"||i==="‍"||Cc.ID_Continue.test(i))},isDigit(i){return typeof i=="string"&&/[0-9]/.test(i)},isHexDigit(i){return typeof i=="string"&&/[0-9A-Fa-f]/.test(i)}};let Iu,Ei,qn,ll,Tr,yn,ri,Xh,ro;var l4=function(t,e){Iu=String(t),Ei="start",qn=[],ll=0,Tr=1,yn=0,ri=void 0,Xh=void 0,ro=void 0;do ri=c4(),d4[Ei]();while(ri.type!=="eof");return typeof e=="function"?Lu({"":ro},"",e):ro};function Lu(i,t,e){const n=i[t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let r=0;r<n.length;r++){const s=String(r),o=Lu(n,s,e);o===void 0?delete n[s]:Object.defineProperty(n,s,{value:o,writable:!0,enumerable:!0,configurable:!0})}else for(const r in n){const s=Lu(n,r,e);s===void 0?delete n[r]:Object.defineProperty(n,r,{value:s,writable:!0,enumerable:!0,configurable:!0})}return e.call(i,t,n)}let ze,Fe,Us,Xn,Ye;function c4(){for(ze="default",Fe="",Us=!1,Xn=1;;){Ye=Un();const i=d1[ze]();if(i)return i}}function Un(){if(Iu[ll])return String.fromCodePoint(Iu.codePointAt(ll))}function H(){const i=Un();return i===`
`?(Tr++,yn=0):i?yn+=i.length:yn++,i&&(ll+=i.length),i}const d1={default(){switch(Ye){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":H();return;case"/":H(),ze="comment";return;case void 0:return H(),ft("eof")}if(Dt.isSpaceSeparator(Ye)){H();return}return d1[Ei]()},comment(){switch(Ye){case"*":H(),ze="multiLineComment";return;case"/":H(),ze="singleLineComment";return}throw pt(H())},multiLineComment(){switch(Ye){case"*":H(),ze="multiLineCommentAsterisk";return;case void 0:throw pt(H())}H()},multiLineCommentAsterisk(){switch(Ye){case"*":H();return;case"/":H(),ze="default";return;case void 0:throw pt(H())}H(),ze="multiLineComment"},singleLineComment(){switch(Ye){case`
`:case"\r":case"\u2028":case"\u2029":H(),ze="default";return;case void 0:return H(),ft("eof")}H()},value(){switch(Ye){case"{":case"[":return ft("punctuator",H());case"n":return H(),Fr("ull"),ft("null",null);case"t":return H(),Fr("rue"),ft("boolean",!0);case"f":return H(),Fr("alse"),ft("boolean",!1);case"-":case"+":H()==="-"&&(Xn=-1),ze="sign";return;case".":Fe=H(),ze="decimalPointLeading";return;case"0":Fe=H(),ze="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":Fe=H(),ze="decimalInteger";return;case"I":return H(),Fr("nfinity"),ft("numeric",1/0);case"N":return H(),Fr("aN"),ft("numeric",NaN);case'"':case"'":Us=H()==='"',Fe="",ze="string";return}throw pt(H())},identifierNameStartEscape(){if(Ye!=="u")throw pt(H());H();const i=Xu();switch(i){case"$":case"_":break;default:if(!Dt.isIdStartChar(i))throw Ep();break}Fe+=i,ze="identifierName"},identifierName(){switch(Ye){case"$":case"_":case"‌":case"‍":Fe+=H();return;case"\\":H(),ze="identifierNameEscape";return}if(Dt.isIdContinueChar(Ye)){Fe+=H();return}return ft("identifier",Fe)},identifierNameEscape(){if(Ye!=="u")throw pt(H());H();const i=Xu();switch(i){case"$":case"_":case"‌":case"‍":break;default:if(!Dt.isIdContinueChar(i))throw Ep();break}Fe+=i,ze="identifierName"},sign(){switch(Ye){case".":Fe=H(),ze="decimalPointLeading";return;case"0":Fe=H(),ze="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":Fe=H(),ze="decimalInteger";return;case"I":return H(),Fr("nfinity"),ft("numeric",Xn*(1/0));case"N":return H(),Fr("aN"),ft("numeric",NaN)}throw pt(H())},zero(){switch(Ye){case".":Fe+=H(),ze="decimalPoint";return;case"e":case"E":Fe+=H(),ze="decimalExponent";return;case"x":case"X":Fe+=H(),ze="hexadecimal";return}return ft("numeric",Xn*0)},decimalInteger(){switch(Ye){case".":Fe+=H(),ze="decimalPoint";return;case"e":case"E":Fe+=H(),ze="decimalExponent";return}if(Dt.isDigit(Ye)){Fe+=H();return}return ft("numeric",Xn*Number(Fe))},decimalPointLeading(){if(Dt.isDigit(Ye)){Fe+=H(),ze="decimalFraction";return}throw pt(H())},decimalPoint(){switch(Ye){case"e":case"E":Fe+=H(),ze="decimalExponent";return}if(Dt.isDigit(Ye)){Fe+=H(),ze="decimalFraction";return}return ft("numeric",Xn*Number(Fe))},decimalFraction(){switch(Ye){case"e":case"E":Fe+=H(),ze="decimalExponent";return}if(Dt.isDigit(Ye)){Fe+=H();return}return ft("numeric",Xn*Number(Fe))},decimalExponent(){switch(Ye){case"+":case"-":Fe+=H(),ze="decimalExponentSign";return}if(Dt.isDigit(Ye)){Fe+=H(),ze="decimalExponentInteger";return}throw pt(H())},decimalExponentSign(){if(Dt.isDigit(Ye)){Fe+=H(),ze="decimalExponentInteger";return}throw pt(H())},decimalExponentInteger(){if(Dt.isDigit(Ye)){Fe+=H();return}return ft("numeric",Xn*Number(Fe))},hexadecimal(){if(Dt.isHexDigit(Ye)){Fe+=H(),ze="hexadecimalInteger";return}throw pt(H())},hexadecimalInteger(){if(Dt.isHexDigit(Ye)){Fe+=H();return}return ft("numeric",Xn*Number(Fe))},string(){switch(Ye){case"\\":H(),Fe+=u4();return;case'"':if(Us)return H(),ft("string",Fe);Fe+=H();return;case"'":if(!Us)return H(),ft("string",Fe);Fe+=H();return;case`
`:case"\r":throw pt(H());case"\u2028":case"\u2029":f4(Ye);break;case void 0:throw pt(H())}Fe+=H()},start(){switch(Ye){case"{":case"[":return ft("punctuator",H())}ze="value"},beforePropertyName(){switch(Ye){case"$":case"_":Fe=H(),ze="identifierName";return;case"\\":H(),ze="identifierNameStartEscape";return;case"}":return ft("punctuator",H());case'"':case"'":Us=H()==='"',ze="string";return}if(Dt.isIdStartChar(Ye)){Fe+=H(),ze="identifierName";return}throw pt(H())},afterPropertyName(){if(Ye===":")return ft("punctuator",H());throw pt(H())},beforePropertyValue(){ze="value"},afterPropertyValue(){switch(Ye){case",":case"}":return ft("punctuator",H())}throw pt(H())},beforeArrayValue(){if(Ye==="]")return ft("punctuator",H());ze="value"},afterArrayValue(){switch(Ye){case",":case"]":return ft("punctuator",H())}throw pt(H())},end(){throw pt(H())}};function ft(i,t){return{type:i,value:t,line:Tr,column:yn}}function Fr(i){for(const t of i){if(Un()!==t)throw pt(H());H()}}function u4(){switch(Un()){case"b":return H(),"\b";case"f":return H(),"\f";case"n":return H(),`
`;case"r":return H(),"\r";case"t":return H(),"	";case"v":return H(),"\v";case"0":if(H(),Dt.isDigit(Un()))throw pt(H());return"\0";case"x":return H(),h4();case"u":return H(),Xu();case`
`:case"\u2028":case"\u2029":return H(),"";case"\r":return H(),Un()===`
`&&H(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw pt(H());case void 0:throw pt(H())}return H()}function h4(){let i="",t=Un();if(!Dt.isHexDigit(t)||(i+=H(),t=Un(),!Dt.isHexDigit(t)))throw pt(H());return i+=H(),String.fromCodePoint(parseInt(i,16))}function Xu(){let i="",t=4;for(;t-- >0;){const e=Un();if(!Dt.isHexDigit(e))throw pt(H());i+=H()}return String.fromCodePoint(parseInt(i,16))}const d4={start(){if(ri.type==="eof")throw Zr();Dc()},beforePropertyName(){switch(ri.type){case"identifier":case"string":Xh=ri.value,Ei="afterPropertyName";return;case"punctuator":Oa();return;case"eof":throw Zr()}},afterPropertyName(){if(ri.type==="eof")throw Zr();Ei="beforePropertyValue"},beforePropertyValue(){if(ri.type==="eof")throw Zr();Dc()},beforeArrayValue(){if(ri.type==="eof")throw Zr();if(ri.type==="punctuator"&&ri.value==="]"){Oa();return}Dc()},afterPropertyValue(){if(ri.type==="eof")throw Zr();switch(ri.value){case",":Ei="beforePropertyName";return;case"}":Oa()}},afterArrayValue(){if(ri.type==="eof")throw Zr();switch(ri.value){case",":Ei="beforeArrayValue";return;case"]":Oa()}},end(){}};function Dc(){let i;switch(ri.type){case"punctuator":switch(ri.value){case"{":i={};break;case"[":i=[];break}break;case"null":case"boolean":case"numeric":case"string":i=ri.value;break}if(ro===void 0)ro=i;else{const t=qn[qn.length-1];Array.isArray(t)?t.push(i):Object.defineProperty(t,Xh,{value:i,writable:!0,enumerable:!0,configurable:!0})}if(i!==null&&typeof i=="object")qn.push(i),Array.isArray(i)?Ei="beforeArrayValue":Ei="beforePropertyName";else{const t=qn[qn.length-1];t==null?Ei="end":Array.isArray(t)?Ei="afterArrayValue":Ei="afterPropertyValue"}}function Oa(){qn.pop();const i=qn[qn.length-1];i==null?Ei="end":Array.isArray(i)?Ei="afterArrayValue":Ei="afterPropertyValue"}function pt(i){return cl(i===void 0?`JSON5: invalid end of input at ${Tr}:${yn}`:`JSON5: invalid character '${f1(i)}' at ${Tr}:${yn}`)}function Zr(){return cl(`JSON5: invalid end of input at ${Tr}:${yn}`)}function Ep(){return yn-=5,cl(`JSON5: invalid identifier character at ${Tr}:${yn}`)}function f4(i){console.warn(`JSON5: '${f1(i)}' in strings is not valid ECMAScript; consider escaping`)}function f1(i){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[i])return t[i];if(i<" "){const e=i.charCodeAt(0).toString(16);return"\\x"+("00"+e).substring(e.length)}return i}function cl(i){const t=new SyntaxError(i);return t.lineNumber=Tr,t.columnNumber=yn,t}var p4=function(t,e,n){const r=[];let s="",o,a,l="",u;if(e!=null&&typeof e=="object"&&!Array.isArray(e)&&(n=e.space,u=e.quote,e=e.replacer),typeof e=="function")a=e;else if(Array.isArray(e)){o=[];for(const g of e){let m;typeof g=="string"?m=g:(typeof g=="number"||g instanceof String||g instanceof Number)&&(m=String(g)),m!==void 0&&o.indexOf(m)<0&&o.push(m)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),l="          ".substr(0,n)):typeof n=="string"&&(l=n.substr(0,10)),c("",{"":t});function c(g,m){let O=m[g];switch(O!=null&&(typeof O.toJSON5=="function"?O=O.toJSON5(g):typeof O.toJSON=="function"&&(O=O.toJSON(g))),a&&(O=a.call(m,g,O)),O instanceof Number?O=Number(O):O instanceof String?O=String(O):O instanceof Boolean&&(O=O.valueOf()),O){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof O=="string")return h(O);if(typeof O=="number")return String(O);if(typeof O=="object")return Array.isArray(O)?p(O):d(O)}function h(g){const m={"'":.1,'"':.2},O={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let b="";for(let S=0;S<g.length;S++){const w=g[S];switch(w){case"'":case'"':m[w]++,b+=w;continue;case"\0":if(Dt.isDigit(g[S+1])){b+="\\x00";continue}}if(O[w]){b+=O[w];continue}if(w<" "){let v=w.charCodeAt(0).toString(16);b+="\\x"+("00"+v).substring(v.length);continue}b+=w}const x=u||Object.keys(m).reduce((S,w)=>m[S]<m[w]?S:w);return b=b.replace(new RegExp(x,"g"),O[x]),x+b+x}function d(g){if(r.indexOf(g)>=0)throw TypeError("Converting circular structure to JSON5");r.push(g);let m=s;s=s+l;let O=o||Object.keys(g),b=[];for(const S of O){const w=c(S,g);if(w!==void 0){let v=f(S)+":";l!==""&&(v+=" "),v+=w,b.push(v)}}let x;if(b.length===0)x="{}";else{let S;if(l==="")S=b.join(","),x="{"+S+"}";else{let w=`,
`+s;S=b.join(w),x=`{
`+s+S+`,
`+m+"}"}}return r.pop(),s=m,x}function f(g){if(g.length===0)return h(g);const m=String.fromCodePoint(g.codePointAt(0));if(!Dt.isIdStartChar(m))return h(g);for(let O=m.length;O<g.length;O++)if(!Dt.isIdContinueChar(String.fromCodePoint(g.codePointAt(O))))return h(g);return g}function p(g){if(r.indexOf(g)>=0)throw TypeError("Converting circular structure to JSON5");r.push(g);let m=s;s=s+l;let O=[];for(let x=0;x<g.length;x++){const S=c(String(x),g);O.push(S!==void 0?S:"null")}let b;if(O.length===0)b="[]";else if(l==="")b="["+O.join(",")+"]";else{let x=`,
`+s,S=O.join(x);b=`[
`+s+S+`,
`+m+"]"}return r.pop(),s=m,b}};const g4={parse:l4,stringify:p4};var m4=g4,zr={},pn={},Tp;function Al(){return Tp||(Tp=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.excelBOM=pn.defaultCsv2JsonOptions=pn.defaultJson2CsvOptions=pn.errors=void 0,pn.errors={optionsRequired:"Options were not passed and are required.",json2csv:{cannotCallOn:"Cannot call json2csv on",dataCheckFailure:"Data provided was not an array of documents.",notSameSchema:"Not all documents have the same schema."},csv2json:{cannotCallOn:"Cannot call csv2json on",dataCheckFailure:"CSV is not a string."}},pn.defaultJson2CsvOptions={arrayIndexesAsKeys:!1,checkSchemaDifferences:!1,delimiter:{field:",",wrap:'"',eol:`
`},emptyFieldValue:void 0,escapeHeaderNestedDots:!0,excelBOM:!1,excludeKeys:[],expandNestedObjects:!0,expandArrayObjects:!1,prependHeader:!0,preventCsvInjection:!1,sortHeader:!1,trimFieldValues:!1,trimHeaderFields:!1,unwindArrays:!1,useDateIso8601Format:!1,useLocaleFormat:!1,wrapBooleans:!1,fieldTitleMap:Object.create({})},pn.defaultCsv2JsonOptions={delimiter:{field:",",wrap:'"',eol:`
`},excelBOM:!1,preventCsvInjection:!1,trimFieldValues:!1,trimHeaderFields:!1},pn.excelBOM="\uFEFF"),pn}var gn={},jr={};var Rp;function Nh(){if(Rp)return jr;Rp=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.setPath=jr.evaluatePath=void 0;function i(s,o){if(!s)return null;const{dotIndex:a,key:l,remaining:u}=n(o),c=typeof s=="object"&&o in s?s[o]:void 0,h=typeof s=="object"&&l in s?s[l]:void 0;if(a>=0&&typeof s=="object"&&!(o in s)){const{key:d}=n(u),f=parseInt(d);return Array.isArray(h)&&isNaN(f)?h.map(p=>i(p,u)):i(h,u)}else if(Array.isArray(s)){const d=parseInt(l);return o===l&&a===-1&&!isNaN(d)?h:s.map(f=>i(f,o))}else{if(a>=0&&o!==l&&typeof s=="object"&&l in s)return i(h,u);if(a===-1&&typeof s=="object"&&l in s&&!(o in s))return h}return c}jr.evaluatePath=i;function t(s,o,a){if(s){if(!o)throw new Error("No keyPath was provided.")}else throw new Error("No object was provided.");return e(s,o,a)}jr.setPath=t;function e(s,o,a){const{dotIndex:l,key:u,remaining:c}=n(o);if(o.startsWith("__proto__")||o.startsWith("constructor")||o.startsWith("prototype"))return s;if(l>=0){const h=parseInt(u);if(typeof s=="object"&&s!==null&&!(u in s)&&Array.isArray(s)&&!isNaN(h))return s[u]=s[u]??{},e(s[u],c,a),s;if(typeof s=="object"&&s!==null&&!(u in s)&&Array.isArray(s))return s.forEach(d=>e(d,o,a)),s;if(typeof s=="object"&&s!==null&&!(u in s)&&!Array.isArray(s)){const{key:d}=n(c),f=parseInt(d);if(!isNaN(f))s[u]=[];else{if(c==="")return s[o]=a,s;s[u]={}}}e(s[u],c,a)}else if(Array.isArray(s)){const h=parseInt(u);return o===u&&l===-1&&!isNaN(h)?(s[u]=a,s):(s.forEach(d=>e(d,c,a)),s)}else s[u]=a;return s}function n(s){const o=r(s);return{dotIndex:o,key:s.slice(0,o>=0?o:void 0).replace(/\\./g,"."),remaining:s.slice(o+1)}}function r(s){for(let o=0;o<s.length;o++){const a=o>0?s[o-1]:"";if(s[o]==="."&&a!=="\\")return o}return-1}return jr}var mn={},Ln={},_p;function O4(){if(_p)return Ln;_p=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.isDocumentToRecurOn=Ln.flatten=Ln.unique=void 0;function i(n){return[...new Set(n)]}Ln.unique=i;function t(n){return[].concat(...n)}Ln.flatten=t;function e(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length}return Ln.isDocumentToRecurOn=e,Ln}var $c={},Mp;function b4(){return Mp||(Mp=1,Object.defineProperty($c,"__esModule",{value:!0})),$c}var Bp;function y4(){return Bp||(Bp=1,(function(i){var t=mn&&mn.__createBinding||(Object.create?(function(f,p,g,m){m===void 0&&(m=g);var O=Object.getOwnPropertyDescriptor(p,g);(!O||("get"in O?!p.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return p[g]}}),Object.defineProperty(f,m,O)}):(function(f,p,g,m){m===void 0&&(m=g),f[m]=p[g]})),e=mn&&mn.__setModuleDefault||(Object.create?(function(f,p){Object.defineProperty(f,"default",{enumerable:!0,value:p})}):function(f,p){f.default=p}),n=mn&&mn.__importStar||function(f){if(f&&f.__esModule)return f;var p={};if(f!=null)for(var g in f)g!=="default"&&Object.prototype.hasOwnProperty.call(f,g)&&t(p,f,g);return e(p,f),p},r=mn&&mn.__exportStar||function(f,p){for(var g in f)g!=="default"&&!Object.prototype.hasOwnProperty.call(p,g)&&t(p,f,g)};Object.defineProperty(i,"__esModule",{value:!0}),i.deepKeysFromList=i.deepKeys=void 0;const s=n(O4());r(b4(),i);function o(f,p){const g=d(p);return typeof f=="object"&&f!==null?l("",f,g):[]}i.deepKeys=o;function a(f,p){const g=d(p);return f.map(m=>typeof m=="object"&&m!==null?o(m,g):[])}i.deepKeysFromList=a;function l(f,p,g){const m=Object.keys(p).map(O=>{const b=h(f,c(O,g));return g.expandNestedObjects&&s.isDocumentToRecurOn(p[O])||g.arrayIndexesAsKeys&&Array.isArray(p[O])&&p[O].length?l(b,p[O],g):g.expandArrayObjects&&Array.isArray(p[O])?u(p[O],b,g):g.ignoreEmptyArrays&&Array.isArray(p[O])&&!p[O].length?[]:b});return s.flatten(m)}function u(f,p,g){let m=a(f,g);return f.length?f.length&&s.flatten(m).length===0?[p]:(m=m.map(O=>Array.isArray(O)&&O.length===0?[p]:O.map(b=>h(p,c(b,g)))),s.unique(s.flatten(m))):g.ignoreEmptyArraysWhenExpanding?[]:[p]}function c(f,p){return p.escapeNestedDots?f.replace(/\./g,"\\."):f}function h(f,p){return f?f+"."+p:p}function d(f){return{arrayIndexesAsKeys:!1,expandNestedObjects:!0,expandArrayObjects:!1,ignoreEmptyArraysWhenExpanding:!1,escapeNestedDots:!1,ignoreEmptyArrays:!1,...f??{}}}})(mn)),mn}var _e={},Fp;function Wh(){if(Fp)return _e;Fp=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.isInvalid=_e.flatten=_e.unique=_e.arrayDifference=_e.isError=_e.isUndefined=_e.isNull=_e.isObject=_e.isString=_e.isNumber=_e.unwind=_e.getNCharacters=_e.removeEmptyFields=_e.isEmptyField=_e.computeSchemaDifferences=_e.isDateRepresentation=_e.isStringRepresentation=_e.deepCopy=_e.validate=_e.buildC2JOptions=_e.buildJ2COptions=void 0;const i=Nh(),t=Al(),e=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/,n=1e5;function r(k){return{...t.defaultJson2CsvOptions,...k,delimiter:{field:k?.delimiter?.field??t.defaultJson2CsvOptions.delimiter.field,wrap:k?.delimiter?.wrap||t.defaultJson2CsvOptions.delimiter.wrap,eol:k?.delimiter?.eol||t.defaultJson2CsvOptions.delimiter.eol},fieldTitleMap:k?.fieldTitleMap||Object.create({})}}_e.buildJ2COptions=r;function s(k){return{...t.defaultCsv2JsonOptions,...k,delimiter:{field:k?.delimiter?.field??t.defaultCsv2JsonOptions.delimiter.field,wrap:k?.delimiter?.wrap||t.defaultCsv2JsonOptions.delimiter.wrap,eol:k?.delimiter?.eol||t.defaultCsv2JsonOptions.delimiter.eol}}}_e.buildC2JOptions=s;function o(k,A,P){if(!k)throw new Error(`${P.cannotCallOn} ${k}.`);if(!A(k))throw new Error(P.dataCheckFailure);return!0}_e.validate=o;function a(k){return JSON.parse(JSON.stringify(k))}_e.deepCopy=a;function l(k,A){const P=k[0],Q=k.length-1,M=k[Q];return P===A.delimiter.wrap&&M===A.delimiter.wrap}_e.isStringRepresentation=l;function u(k){return e.test(k)}_e.isDateRepresentation=u;function c(k,A){return v(k,A).concat(v(A,k))}_e.computeSchemaDifferences=c;function h(k){return S(k)||x(k)||k===""}_e.isEmptyField=h;function d(k){return k.filter(A=>!h(A))}_e.removeEmptyFields=d;function f(k,A,P){return k.substring(A,A+P)}_e.getNCharacters=f;function p(k,A,P){const Q=(0,i.evaluatePath)(A,P);let M=a(A);Array.isArray(Q)&&Q.length?Q.forEach(B=>{M=a(A),k.push((0,i.setPath)(M,P,B))}):(Array.isArray(Q)&&Q.length===0&&(0,i.setPath)(M,P,""),k.push(M))}function g(k,A){const P=[];return k.forEach(Q=>{p(P,Q,A)}),P}_e.unwind=g;function m(k){return!isNaN(Number(k))}_e.isNumber=m;function O(k){return typeof k=="string"}_e.isString=O;function b(k){return typeof k=="object"}_e.isObject=b;function x(k){return k===null}_e.isNull=x;function S(k){return typeof k>"u"}_e.isUndefined=S;function w(k){return Object.prototype.toString.call(k)==="[object Error]"}_e.isError=w;function v(k,A){return k.filter(P=>!A.includes(P))}_e.arrayDifference=v;function D(k){return[...new Set(k)]}_e.unique=D;function R(k){if(k.flat)return k.flat();if(k.length>n){let A=[];for(let P=0;P<k.length;P+=n)A=A.concat(...k.slice(P,P+n));return A}return k.reduce((A,P)=>A.concat(P),[])}_e.flatten=R;function $(k){return k===1/0||k===-1/0}return _e.isInvalid=$,_e}var Zp;function x4(){if(Zp)return gn;Zp=1;var i=gn&&gn.__createBinding||(Object.create?(function(l,u,c,h){h===void 0&&(h=c);var d=Object.getOwnPropertyDescriptor(u,c);(!d||("get"in d?!u.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(l,h,d)}):(function(l,u,c,h){h===void 0&&(h=c),l[h]=u[c]})),t=gn&&gn.__setModuleDefault||(Object.create?(function(l,u){Object.defineProperty(l,"default",{enumerable:!0,value:u})}):function(l,u){l.default=u}),e=gn&&gn.__importStar||function(l){if(l&&l.__esModule)return l;var u={};if(l!=null)for(var c in l)c!=="default"&&Object.prototype.hasOwnProperty.call(l,c)&&i(u,l,c);return t(u,l),u};Object.defineProperty(gn,"__esModule",{value:!0}),gn.Json2Csv=void 0;const n=Nh(),r=y4(),s=Al(),o=e(Wh()),a=function(l){const u=new RegExp(l.delimiter.wrap,"g"),c=/\r?\n|\r/,h=l.parseValue&&typeof l.parseValue=="function"?l.parseValue:null,d=l.expandArrayObjects&&!l.unwindArrays,f={arrayIndexesAsKeys:l.arrayIndexesAsKeys,expandNestedObjects:l.expandNestedObjects,expandArrayObjects:d,ignoreEmptyArraysWhenExpanding:d,escapeNestedDots:!0};function p(E){return(0,r.deepKeysFromList)(E,f)}function g(E){return E.length===0?[]:l.checkSchemaDifferences?m(E):o.unique(o.flatten(E))}function m(E){const Z=E[0],L=E.slice(1);if(O(Z,L))throw new Error(s.errors.json2csv.notSameSchema);return Z}function O(E,Z){return Z.reduce((L,Y)=>o.computeSchemaDifferences(E,Y).length>0?L+1:L,0)}function b(E){return l.excludeKeys?E.filter(Z=>{for(const L of l.excludeKeys){const Y=L instanceof RegExp?L:new RegExp(`^${L}`);if(L===Z||Z.match(Y))return!1}return!0}):E}function x(E){return l.sortHeader&&typeof l.sortHeader=="function"?E.sort(l.sortHeader):l.sortHeader?E.sort():E}function S(E){return l.trimHeaderFields&&(E.headerFields=E.headerFields.map(Z=>Z.split(".").map(L=>L.trim()).join("."))),E}function w(E){return l.prependHeader&&(E.headerFields=E.headerFields.map(function(Z){return F(Z)})),E}function v(E){const Z=Object.keys(l.fieldTitleMap);return E.header=E.headerFields.map(function(L){let Y=L;return Z.includes(L)?Y=l.fieldTitleMap[L]:l.escapeHeaderNestedDots||(Y=Y.replace(/\\\./g,".")),Y}).join(l.delimiter.field),E}function D(){return l.keys?l.keys.map(E=>typeof E=="object"&&"field"in E?(l.fieldTitleMap[E.field]=E.title??E.field,E.field):E):[]}function R(){return l.keys?l.keys.flatMap(E=>typeof E=="string"?[]:E?.wildcardMatch?E.field:[]):[]}function $(E){const Z=R(),L=D(),Y=p(E),N=g(Y);if(l.keys){l.keys=L;const I=L.flatMap(V=>{if(!Z.includes(V))return V;const J=[],re=new RegExp(`^${V}`);for(const ee of N)(V===ee||ee.match(re))&&J.push(ee);return J});if(!l.unwindArrays){const V=b(I);return x(V)}}const z=b(N);return x(z)}function k(E){for(const Z of E.records)for(const L of E.headerFields){const Y=(0,n.evaluatePath)(Z,L);if(Array.isArray(Y))return!0}return!1}function A(E,Z=!1){if(l.unwindArrays){if(E.headerFields.forEach(L=>{E.records=o.unwind(E.records,L)}),E.headerFields=$(E.records),k(E))return A(E,Z);if(!Z)return A(E,!0);if(l.keys){const L=D();E.headerFields=b(L)}return E}return E}function P(E){return E.recordString=E.records.map(Z=>{const L=M(Z,E.headerFields),Y=L.map(N=>{N=W(N),N=X(N);let z=h?h(N,B):B(N);return z=F(z),z});return _(Y)}).join(l.delimiter.eol),E}function Q(E){const Z=o.removeEmptyFields(E);return!E.length||!Z.length?l.emptyFieldValue||"":Z.length===1?Z[0]:E}function M(E,Z){const L=[];return Z.forEach(Y=>{let N=(0,n.evaluatePath)(E,Y);!o.isUndefined(l.emptyFieldValue)&&o.isEmptyField(N)?N=l.emptyFieldValue:l.expandArrayObjects&&Array.isArray(N)&&(N=Q(N)),L.push(N)}),L}function B(E){const Z=E instanceof Date;return E===null||Array.isArray(E)||typeof E=="object"&&!Z?JSON.stringify(E):typeof E>"u"?"undefined":Z&&l.useDateIso8601Format?E.toISOString():l.useLocaleFormat?E.toLocaleString():E.toString()}function W(E){return l.trimFieldValues?Array.isArray(E)?E.map(W):typeof E=="string"?E.trim():E:E}function X(E){return l.preventCsvInjection?Array.isArray(E)?E.map(X):typeof E=="string"&&!o.isNumber(E)?E.replace(/^[=+\-@\t\r]+/g,""):E:E}function F(E){const Z=l.delimiter.wrap;return E.includes(l.delimiter.wrap)&&(E=E.replace(u,Z+Z)),(E.includes(l.delimiter.field)||E.includes(l.delimiter.wrap)||E.match(c)||l.wrapBooleans&&(E==="true"||E==="false"))&&(E=Z+E+Z),E}function _(E){return E.join(l.delimiter.field)}function j(E){const Z=E.header,L=E.recordString;return(l.excelBOM?s.excelBOM:"")+(l.prependHeader?Z+l.delimiter.eol:"")+L}function q(E){Array.isArray(E)||(E=[E]);const Z={headerFields:$(E),records:E,header:"",recordString:""},L=A(Z),Y=P(L),N=w(Y),z=S(N),I=v(z);return j(I)}return{convert:q}};return gn.Json2Csv=a,gn}var On={},zp;function w4(){if(zp)return On;zp=1;var i=On&&On.__createBinding||(Object.create?(function(a,l,u,c){c===void 0&&(c=u);var h=Object.getOwnPropertyDescriptor(l,u);(!h||("get"in h?!l.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return l[u]}}),Object.defineProperty(a,c,h)}):(function(a,l,u,c){c===void 0&&(c=u),a[c]=l[u]})),t=On&&On.__setModuleDefault||(Object.create?(function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}):function(a,l){a.default=l}),e=On&&On.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var u in a)u!=="default"&&Object.prototype.hasOwnProperty.call(a,u)&&i(l,a,u);return t(l,a),l};Object.defineProperty(On,"__esModule",{value:!0}),On.Csv2Json=void 0;const n=Nh(),r=Al(),s=e(Wh()),o=function(a){const l=new RegExp(a.delimiter.wrap+a.delimiter.wrap,"g"),u=new RegExp("^"+r.excelBOM),c=a.parseValue&&typeof a.parseValue=="function"?a.parseValue:JSON.parse;function h($){return $=S($),a.trimHeaderFields?$.split(".").map(k=>k.trim()).join("."):$}function d($){let k=[];if(a.headerFields)k=a.headerFields.map((A,P)=>({value:h(A),index:P}));else if(k=$[0].map((P,Q)=>({value:h(P),index:Q})),a.keys){const P=a.keys;k=k.filter(Q=>P.includes(Q.value))}return{lines:$,headerFields:k,recordLines:[]}}function f($){return a.excelBOM?$.replace(u,""):$}function p($){const k=[],A=$.length-1,P=a.delimiter.eol.length,Q={insideWrapDelimiter:!1,parsingValue:!0,justParsedDoubleQuote:!1,startIndex:0};let M=[],B,W,X,F,_=0;for(;_<$.length;){if(B=$[_],W=_?$[_-1]:"",X=_<A?$[_+1]:"",F=s.getNCharacters($,_,P),(F===a.delimiter.eol&&!Q.insideWrapDelimiter||_===A)&&W===a.delimiter.field)F===a.delimiter.eol&&Q.startIndex===_||B===a.delimiter.field?M.push(""):M.push($.substring(Q.startIndex)),M.push(""),k.push(M),M=[],Q.startIndex=_+P,Q.parsingValue=!0,Q.insideWrapDelimiter=X===a.delimiter.wrap;else if(_===A&&B===a.delimiter.field){const j=$.substring(Q.startIndex,_);M.push(j),M.push(""),k.push(M)}else if(_===A||F===a.delimiter.eol&&(!Q.insideWrapDelimiter||Q.insideWrapDelimiter&&W===a.delimiter.wrap&&!Q.justParsedDoubleQuote)){const j=_!==A||W===a.delimiter.wrap?_:void 0;M.push($.substring(Q.startIndex,j)),k.push(M),M=[],Q.startIndex=_+P,Q.parsingValue=!0,Q.insideWrapDelimiter=X===a.delimiter.wrap}else if(B===a.delimiter.wrap&&W===a.delimiter.field&&!Q.insideWrapDelimiter&&!Q.parsingValue)Q.startIndex=_,Q.insideWrapDelimiter=!0,Q.parsingValue=!0,s.getNCharacters($,_+1,P)===a.delimiter.eol&&(_+=a.delimiter.eol.length+1);else if(W===a.delimiter.field&&B===a.delimiter.wrap&&X===a.delimiter.eol)M.push($.substring(Q.startIndex,_-1)),Q.startIndex=_,Q.parsingValue=!0,Q.insideWrapDelimiter=!0,Q.justParsedDoubleQuote=!0,_+=1;else if((W!==a.delimiter.wrap||Q.justParsedDoubleQuote&&W===a.delimiter.wrap)&&B===a.delimiter.wrap&&s.getNCharacters($,_+1,P)===a.delimiter.eol)Q.insideWrapDelimiter=!1,Q.parsingValue=!1;else if(B===a.delimiter.wrap&&(_===0||s.getNCharacters($,_-P,P)===a.delimiter.eol&&!Q.insideWrapDelimiter))Q.insideWrapDelimiter=!0,Q.parsingValue=!0,Q.startIndex=_;else if(B===a.delimiter.wrap&&X===a.delimiter.field&&Q.insideWrapDelimiter)M.push($.substring(Q.startIndex,_+1)),Q.startIndex=_+2,Q.insideWrapDelimiter=!1,Q.parsingValue=!1;else if(B===a.delimiter.wrap&&W===a.delimiter.field&&!Q.insideWrapDelimiter&&Q.parsingValue)M.push($.substring(Q.startIndex,_-1)),Q.insideWrapDelimiter=!0,Q.parsingValue=!0,Q.startIndex=_;else if(B===a.delimiter.wrap&&X===a.delimiter.wrap&&_!==Q.startIndex){_+=2,Q.justParsedDoubleQuote=!0;continue}else B===a.delimiter.field&&W!==a.delimiter.wrap&&X!==a.delimiter.wrap&&!Q.insideWrapDelimiter&&Q.parsingValue?(M.push($.substring(Q.startIndex,_)),Q.startIndex=_+1):B===a.delimiter.field&&W===a.delimiter.wrap&&X!==a.delimiter.wrap&&!Q.parsingValue&&(Q.insideWrapDelimiter=!1,Q.parsingValue=!0,Q.startIndex=_+1);_++,Q.justParsedDoubleQuote=!1}return k}function g($){return a.headerFields?$.recordLines=$.lines:$.recordLines=$.lines.splice(1),$}function m($,k){const A=k[$.index];return O(A)}function O($){const k=D($);return!s.isError(k)&&!s.isInvalid(k)?k:$==="undefined"?void 0:$}function b($){return a.trimFieldValues&&$!==null?$.trim():$}function x($,k){return $.reduce((A,P)=>{const Q=m(P,k);try{return(0,n.setPath)(A,P.value,Q)}catch{return A}},{})}function S($){const k=$[0],A=$.length-1,P=$[A];return k===a.delimiter.wrap&&P===a.delimiter.wrap?$.length<=2?"":$.substring(1,A):$}function w($){return $.replace(l,a.delimiter.wrap)}function v($){return $.recordLines.reduce((k,A)=>{A=A.map(Q=>(Q=S(Q),Q=w(Q),Q=b(Q),Q));const P=x($.headerFields,A);return k.concat(P)},[])}function D($){try{if(s.isStringRepresentation($,a)&&!s.isDateRepresentation($))return $;const k=c($);return Array.isArray(k)?k.map(b):k}catch(k){return k}}function R($){const k=f($),A=p(k),P=d(A),Q=g(P);return v(Q)}return{convert:R}};return On.Csv2Json=o,On}var jp;function S4(){if(jp)return zr;jp=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.csv2json=zr.json2csv=void 0;const i=Al(),t=x4(),e=w4(),n=Wh();function r(o,a){const l=(0,n.buildJ2COptions)(a??{});return(0,n.validate)(o,n.isObject,i.errors.json2csv),(0,t.Json2Csv)(l).convert(o)}zr.json2csv=r;function s(o,a){const l=(0,n.buildC2JOptions)(a??{});return(0,n.validate)(o,n.isString,i.errors.csv2json),(0,e.Csv2Json)(l).convert(o)}return zr.csv2json=s,zr}var v4=S4();const so=["v1","vX","v2021-03-25","v2021-10-21","v2022-03-07","v2025-02-19",`v${new Date().toISOString().split("T")[0]}`],[p1]=so.slice(-1);function g1(i){const t=Pt.c(5),[e,n]=C.useState(!1);let r,s;t[0]!==i.delay?(r=()=>{const a=setTimeout(()=>n(!0),i.delay||500);return()=>clearTimeout(a)},s=[i.delay],t[0]=i.delay,t[1]=r,t[2]=s):(r=t[1],s=t[2]),C.useEffect(r,s);let o;return t[3]!==e?(o=e?y.jsx(ih,{muted:!0,size:4}):null,t[3]=e,t[4]=o):o=t[4],o}const k4=[[r4],$0(),w0(),Q0(),IO(),x0(),I0(),tO(),e1(),sO(),O0(),kl(H0,{fallback:!0}),Fo.of([{key:"Mod-Enter",run:()=>!0},FO,cO].flat().filter(Boolean))];function C4(i){const t=Pt.c(7);let e;t[0]!==i?(e=D4(i),t[0]=i,t[1]=e):e=t[1];const n=e;let r;t[2]!==i?(r=kl($4(i)),t[2]=i,t[3]=r):r=t[3];const s=r;let o;return t[4]!==s||t[5]!==n?(o=[n,s],t[4]=s,t[5]=n,t[6]=o):o=t[6],o}function D4(i){const{color:t,fonts:e}=i.sanity,n=t.card.enabled,r=Jh.blue[t.dark?400:500].hex,s=Jh.gray[i.sanity.color.dark?900:100].hex;return ae.theme({"&":{color:n.fg,backgroundColor:n.bg},".cm-content":{caretColor:r},".cm-editor":{fontFamily:e.code.family,fontSize:he(e.code.sizes[1].fontSize),lineHeight:"inherit"},".cm-cursor, .cm-dropCursor":{borderLeftColor:r},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:s},".cm-panels":{backgroundColor:n.bg,color:n.fg},".cm-panels.cm-panels-top":{borderBottom:`2px solid ${n.border}`},".cm-panels.cm-panels-bottom":{borderTop:`2px solid ${n.border}`}},{dark:t.dark})}function $4(i){const t=i.sanity.color.base,e=i.sanity.color.syntax;return Ts.define([{tag:T.keyword,color:e.keyword},{tag:[T.propertyName,T.name,T.deleted,T.character,T.macroName],color:e.property},{tag:[T.function(T.variableName),T.labelName],color:e.function},{tag:[T.color,T.constant(T.name),T.standard(T.name)],color:e.variable},{tag:[T.definition(T.name),T.separator],color:e.constant},{tag:[T.typeName,T.className,T.number,T.changed,T.annotation,T.modifier,T.self,T.namespace],color:e.number},{tag:[T.operator,T.operatorKeyword,T.url,T.escape,T.regexp,T.link,T.special(T.string)],color:e.operator},{tag:[T.meta,T.comment],color:e.comment},{tag:T.strong,fontWeight:"bold"},{tag:T.emphasis,fontStyle:"italic"},{tag:T.strikethrough,textDecoration:"line-through"},{tag:T.heading,fontWeight:"bold",color:e.property},{tag:[T.atom,T.bool,T.special(T.variableName)],color:e.boolean},{tag:[T.processingInstruction,T.string,T.inserted],color:e.string},{tag:T.invalid,color:t.fg}])}const Q4=G.div`
  width: 100%;
  box-sizing: border-box;
  height: 100%;
  overflow: hidden;
  overflow: clip;
  position: relative;
  display: flex;

  & .cm-theme {
    width: 100%;
  }

  & .cm-editor {
    height: 100%;

    font-size: 16px;
    line-height: 21px;
  }

  & .cm-line {
    padding-left: ${({theme:i})=>he(i.sanity.space[3])};
  }

  & .cm-content {
    border-right-width: ${({theme:i})=>he(i.sanity.space[4])} !important;
    padding-top: ${({theme:i})=>he(i.sanity.space[5])};
  }
`,Yh=C.forwardRef((i,t)=>{const e=Pt.c(7),[n]=C.useState(i.initialValue),r=Fy(),s=C4(r),o=C.useRef(null);let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=d=>{const f=o.current?.view;if(!f)return;const p=f.state.doc.toString();d!==p&&f.dispatch({changes:{from:0,to:p.length,insert:d},selection:U.cursor(d.length)})},e[0]=a):a=e[0];const l=a;let u,c;e[1]===Symbol.for("react.memo_cache_sentinel")?(u=()=>({resetEditorContent:l}),c=[l],e[1]=u,e[2]=c):(u=e[1],c=e[2]),C.useImperativeHandle(t,u,c);let h;return e[3]!==n||e[4]!==i.onChange||e[5]!==s?(h=y.jsx(Q4,{children:y.jsx(c1,{ref:o,basicSetup:!1,theme:s,extensions:k4,value:n,onChange:i.onChange})}),e[3]=n,e[4]=i.onChange,e[5]=s,e[6]=h):h=e[6],h});Yh.displayName="VisionCodeMirror";const m1=["pinnedRelease","raw","published","drafts"],P4=["pinnedRelease"];function Qc(i){return m1.includes(i)}function Ip(i){return typeof i=="string"&&P4.includes(i)}function Lp({selectedPerspectiveName:i}){return typeof i<"u"}function Pc({visionPerspective:i,perspectiveStack:t}){return i!=="pinnedRelease"?i:t}function Ac(i,t={},e={}){const n=new URLSearchParams;n.set("query",i);for(const[r,s]of Object.entries(t))n.set(`$${r}`,JSON.stringify(s));for(const[r,s]of Object.entries(e))s&&n.set(r,`${s}`);return`?${n}`}function A4(i){return!!i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"}const O1=R4(),b1="sanityVision:";function E4(){if(O1)for(let i=0;i<localStorage.length;i++){const t=localStorage.key(i);t?.startsWith(b1)&&localStorage.removeItem(t)}}function T4(i){const t=`${b1}${i}`;let e=null;return{get:n,set:r,merge:s};function n(l,u){const c=o();return typeof c[l]>"u"?u:c[l]}function r(l,u){const c=o();return c[l]=u,localStorage.setItem(t,JSON.stringify(e)),u}function s(l){const u={...o(),...l};return localStorage.setItem(t,JSON.stringify(u)),u}function o(){return e===null&&(e=a()),e}function a(){if(!O1)return{};try{const l=JSON.parse(localStorage.getItem(t)||"{}");return A4(l)?l:{}}catch{return{}}}}function R4(){const i="lsCheck";try{return localStorage.setItem(i,i),localStorage.removeItem(i),!0}catch{return!1}}function _4(i){const t={},e={};for(const[n,r]of i.entries()){if(n[0]==="$"){t[n.slice(1)]=JSON.parse(r);continue}if(n==="perspective"){e[n]=r;continue}}return{query:i.get("query")||"",params:t,options:e}}function M4(i){return i[0]!=="v"&&i!=="other"?`v${i}`:i}function Ec(i){const t=i.replace(/^v/,"").trim().toUpperCase();return t.length>0&&(t==="X"||t==="1"||/^\d{4}-\d{2}-\d{2}$/.test(t)&&!isNaN(Date.parse(t)))}function B4(i,t){try{const e=i?m4.parse(i):{};return typeof e=="object"&&e&&!Array.isArray(e)?e:{}}catch(e){return e.message=`${t("params.error.params-invalid-json")}:

${e.message.replace("JSON5:","")}`,e}}const y1=G(St)`
  .sidebarPanes .Pane {
    overflow-y: auto;
    overflow-x: hidden;
  }

  & .Resizer {
    background: var(--card-border-color);
    opacity: 1;
    z-index: 1;
    box-sizing: border-box;
    background-clip: padding-box;
    border: solid transparent;
  }

  & .Resizer:hover {
    border-color: var(--card-shadow-ambient-color);
  }

  & .Resizer.horizontal {
    height: 11px;
    margin: -5px 0;
    border-width: 5px 0;
    cursor: row-resize;
    width: 100%;
    z-index: 4;
  }

  & .Resizer.vertical {
    width: 11px;
    margin: 0 -5px;
    border-width: 0 5px;
    cursor: col-resize;
    z-index: 2; /* To prevent the resizer from being hidden behind CodeMirror scroll area */
  }

  .Resizer.disabled {
    cursor: not-allowed;
  }

  .Resizer.disabled:hover {
    border-color: transparent;
  }
`;y1.displayName="Root";const F4=G(He)`
  border-bottom: 1px solid var(--card-border-color);
`,Vn=G(hl)`
  flex: 1;
`,Z4=G(me)`
  position: relative;
`,z4=G.a`
  cursor: pointer;
  margin-right: auto;
`,x1=G(me)`
  position: absolute;
  top: 1rem;
  left: 0;
  padding: 0;
  margin: 0;
  z-index: 10;
  right: 0;

  ${Vn} {
    user-select: none;
  }
`,w1=G(x1)`
  // This is so its aligned with the gutters of CodeMirror
  left: 33px;
`,Xp=G(He)`
  width: 100%;
  height: 100%;
  position: relative;
  flex-direction: column;
`,j4=G(St)`
  height: 100%;
`,I4=G(me)`
  position: relative;
`,L4=G(He)`
  height: 100%;
  width: 100%;
  position: absolute;
  max-width: 100%;

  ${({$isInvalid:i})=>i&&Re`
      &:after {
        background-color: var(--card-bg-color);
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        width: 100%;
      }
    `}
`,X4=G(me)`
  position: relative;
  width: 100%;
  height: 100%;
  z-index: 20;
`,N4=G(St)`
  border-top: 1px solid var(--card-border-color);
`,W4=G(He)`
  position: relative;
`;G(me)`
  width: 100%;
  height: 100%;
`;const Y4=G(St)`
  height: 100%;
  min-height: ${({theme:i})=>he(i.sanity.space[3]*2+i.sanity.fonts.text.sizes[2].lineHeight-i.sanity.fonts.text.sizes[2].ascenderHeight-i.sanity.fonts.text.sizes[2].descenderHeight)};
`,q4=G(He)`
  position: relative;
`,V4=G(et)`
  transform: initial;
  &:before,
  &:after {
    content: none;
  }
  > span {
    display: flex !important;
    gap: ${({theme:i})=>he(i.sanity.space[3])};
    align-items: center;
  }
`,G4=G(me)`
  border-top: 1px solid var(--card-border-color);
`,U4=`{
  
}`;function H4(i){const t=Pt.c(21),{onChange:e,paramsError:n,hasValidParams:r,editorRef:s}=i,{t:o}=tr(ir);let a;t[0]!==e?(a=x=>{e(x)},t[0]=e,t[1]=a):a=t[1];const l=a;let u;t[2]!==l?(u=L1(l,333),t[2]=l,t[3]=u):u=t[3];const c=u,h=r?"default":"critical";let d;t[4]!==o?(d=o("params.label"),t[4]=o,t[5]=d):d=t[5];let f;t[6]!==d?(f=y.jsx(Vn,{muted:!0,children:d}),t[6]=d,t[7]=f):f=t[7];let p;t[8]!==n?(p=n&&y.jsx(xs,{animate:!0,placement:"top",portal:!0,content:y.jsx(et,{size:1,children:n}),children:y.jsx(me,{padding:1,marginX:2,children:y.jsx(et,{children:y.jsx(X1,{})})})}),t[8]=n,t[9]=p):p=t[9];let g;t[10]!==f||t[11]!==p?(g=y.jsx(w1,{children:y.jsxs(St,{children:[f,p]})}),t[10]=f,t[11]=p,t[12]=g):g=t[12];const m=i.value||U4;let O;t[13]!==s||t[14]!==c||t[15]!==m?(O=y.jsx(Yh,{ref:s,initialValue:m,onChange:c}),t[13]=s,t[14]=c,t[15]=m,t[16]=O):O=t[16];let b;return t[17]!==h||t[18]!==g||t[19]!==O?(b=y.jsxs(He,{flex:1,tone:h,"data-testid":"params-editor",children:[g,O]}),t[17]=h,t[18]=g,t[19]=O,t[20]=b):b=t[20],b}function Np(i,t){const e=B4(i,t),n=e instanceof Error?{}:e,r=e instanceof Error?e.message:void 0;return{parsed:n,raw:i,valid:!r,error:r}}const K4="studio.vision-tool.saved-queries",Tc={queries:[]},ba=K4;function J4(){const i=J1(),[t,e]=C.useState(Tc),[n,r]=C.useState(!1),[s,o]=C.useState([]),[a,l]=C.useState(),[u,c]=C.useState(),[h,d]=C.useState(),f=C.useMemo(()=>i.getKey(ba),[i]);C.useEffect(()=>{const O=f.pipe(eb(Tc),rg(b=>b||Tc)).subscribe({next:e,error:b=>d(b)});return()=>O?.unsubscribe()},[f,i]);const p=C.useCallback(O=>{r(!0),l(void 0);try{const b=[{...O,_key:tb()},...t.queries];e({queries:b}),i.setKey(ba,{queries:b})}catch(b){l(b)}finally{r(!1)}},[i,t.queries]),g=C.useCallback(O=>{r(!0),l(void 0);try{const b=t.queries.map(x=>x._key===O._key?{...x,...O}:x);e({queries:b}),i.setKey(ba,{queries:b})}catch(b){l(b)}finally{r(!1)}},[i,t.queries]),m=C.useCallback(O=>{o(b=>[...b,O]),c(void 0);try{const b=t.queries.filter(x=>x._key!==O);e({queries:b}),i.setKey(ba,{queries:b})}catch(b){c(b)}finally{o(b=>b.filter(x=>x!==O))}},[i,t.queries]);return{queries:t.queries,saveQuery:p,updateQuery:g,deleteQuery:m,saving:n,deleting:s,saveQueryError:a,deleteQueryError:u,error:h}}const eA=G(oi)`
  position: sticky;
  top: 0;
  background: ${({theme:i})=>i.sanity.color.base.bg};
  z-index: 1;
`,tA=G(me)`
  height: 100%;
  overflow-y: auto;
  overflow-x: hidden;

  &::-webkit-scrollbar {
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: ${({theme:i})=>i.sanity.color.base.border};
    border-radius: 4px;
  }
`;function iA(i){const t=Pt.c(80),{url:e,getStateFromUrl:n,setStateFromParsedUrl:r,currentQuery:s,currentParams:o,generateUrl:a}=i,l=qg(),{saveQuery:u,updateQuery:c,queries:h,deleteQuery:d,saving:f,saveQueryError:p}=J4(),{t:g}=tr(ir);let m;t[0]===Symbol.for("react.memo_cache_sentinel")?(m={month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0},t[0]=m):m=t[0];const O=V1(m),[b,x]=C.useState(null),[S,w]=C.useState("");let v;t[1]===Symbol.for("react.memo_cache_sentinel")?(v={},t[1]=v):v=t[1];const[D,R]=C.useState(v),[$,k]=C.useState(""),[A,P]=C.useState(e);let Q;t[2]!==o||t[3]!==s||t[4]!==O||t[5]!==a||t[6]!==n||t[7]!==h||t[8]!==u||t[9]!==p||t[10]!==g||t[11]!==l?(Q=async()=>{const N=a(s,o);if(h?.some(z=>{const I=n(z.url);return I&&I.query===s&&Ms(I.params,o)})){const z=h?.find(I=>{const V=n(I.url);return V&&V.query===s&&Ms(V.params,o)});l.push({closable:!0,status:"warning",title:g("save-query.already-saved"),description:`${z?.title} - ${O.format(new Date(z?.savedAt||""))}`});return}N&&(await u({url:N,savedAt:new Date().toISOString(),title:"Untitled"}),P(N)),p?l.push({closable:!0,status:"error",title:g("save-query.error"),description:p.message}):l.push({closable:!0,status:"success",title:g("save-query.success")})},t[2]=o,t[3]=s,t[4]=O,t[5]=a,t[6]=n,t[7]=h,t[8]=u,t[9]=p,t[10]=g,t[11]=l,t[12]=Q):Q=t[12];const M=Q;let B;t[13]!==g||t[14]!==l||t[15]!==c?(B=async(N,z)=>{x(null),R(I=>({...I,[N._key]:z}));try{await c({...N,title:z}),R(I=>{const V={...I};return delete V[N._key],V})}catch(I){const V=I;R(J=>{const re={...J};return delete re[N._key],re}),l.push({closable:!0,status:"error",title:g("save-query.error"),description:V.message})}},t[13]=g,t[14]=l,t[15]=c,t[16]=B):B=t[16];const W=B;let X;t[17]!==o||t[18]!==s||t[19]!==O||t[20]!==a||t[21]!==n||t[22]!==h||t[23]!==g||t[24]!==l||t[25]!==c?(X=async N=>{const z=a(s,o);if(h?.some(I=>{if(I._key===N._key)return!1;const V=n(I.url);return V&&V.query===s&&Ms(V.params,o)})){const I=h?.find(V=>{if(V._key===N._key)return!1;const J=n(V.url);return J&&J.query===s&&Ms(J.params,o)});l.push({closable:!0,status:"warning",title:g("save-query.already-saved"),description:`${I?.title} - ${O.format(new Date(I?.savedAt||""))}`});return}try{await c({...N,url:z,savedAt:new Date().toISOString()}),P(z),l.push({closable:!0,status:"success",title:g("save-query.success")})}catch(I){const V=I;l.push({closable:!0,status:"error",title:g("save-query.error"),description:V.message})}},t[17]=o,t[18]=s,t[19]=O,t[20]=a,t[21]=n,t[22]=h,t[23]=g,t[24]=l,t[25]=c,t[26]=X):X=t[26];const F=X;let _,j,q,E,Z;if(t[27]!==o||t[28]!==s||t[29]!==d||t[30]!==b||t[31]!==S||t[32]!==O||t[33]!==n||t[34]!==M||t[35]!==W||t[36]!==F||t[37]!==D||t[38]!==h||t[39]!==f||t[40]!==$||t[41]!==A||t[42]!==r||t[43]!==g){const N=h?.filter(ne=>ne?.title?.toLowerCase().includes($.toLowerCase()));j=tA;let z;t[49]===Symbol.for("react.memo_cache_sentinel")?(z={textTransform:"capitalize"},t[49]=z):z=t[49];let I;t[50]!==g?(I=g("label.saved-queries"),t[50]=g,t[51]=I):I=t[51];let V;t[52]!==I?(V=y.jsx(et,{weight:"semibold",style:z,size:4,children:I}),t[52]=I,t[53]=V):V=t[53];let J;t[54]!==g?(J=g("action.save-query"),t[54]=g,t[55]=J):J=t[55];let re;t[56]!==M||t[57]!==f||t[58]!==J?(re=y.jsx(wi,{label:J,icon:nb,disabled:f,onClick:M,mode:"bleed"}),t[56]=M,t[57]=f,t[58]=J,t[59]=re):re=t[59];let ee;t[60]!==V||t[61]!==re?(ee=y.jsxs(St,{padding:3,paddingTop:4,paddingBottom:0,justify:"space-between",align:"center",children:[V,re]}),t[60]=V,t[61]=re,t[62]=ee):ee=t[62];let se;t[63]!==g?(se=g("label.search-queries"),t[63]=g,t[64]=se):se=t[64];let Oe;t[65]===Symbol.for("react.memo_cache_sentinel")?(Oe=ne=>k(ne.currentTarget.value),t[65]=Oe):Oe=t[65];let be;t[66]!==$||t[67]!==se?(be=y.jsx(me,{padding:3,paddingTop:0,children:y.jsx(ys,{placeholder:se,icon:rb,value:$,onChange:Oe})}),t[66]=$,t[67]=se,t[68]=be):be=t[68],t[69]!==ee||t[70]!==be?(Z=y.jsxs(eA,{space:3,children:[ee,be]}),t[69]=ee,t[70]=be,t[71]=Z):Z=t[71],_=oi,q=3,E=N?.map(ne=>{const ke=n(ne.url),Qe=A===ne.url,Pe=ke&&s===ke.query&&Ms(o,ke.params),ye=Qe&&!Pe;return y.jsx(He,{width:"fill",padding:4,border:!0,tone:Qe?"positive":"default",onClick:()=>{P(ne.url);const we=n(ne.url);we&&r(we)},style:{position:"relative"},children:y.jsxs(oi,{space:3,children:[y.jsxs(St,{justify:"space-between",align:"center",children:[y.jsxs(St,{align:"center",gap:2,paddingRight:1,children:[b===ne._key?y.jsx(ys,{value:S,onChange:we=>w(we.currentTarget.value),onKeyDown:we=>{we.key==="Enter"?W(ne,S):we.key==="Escape"&&x(null)},onBlur:()=>W(ne,S),autoFocus:!0,style:{maxWidth:"170px",height:"24px"}}):y.jsx(et,{weight:"bold",size:3,textOverflow:"ellipsis",style:{maxWidth:"170px",cursor:"pointer",padding:"4px 0"},title:D[ne._key]||ne.title||ne._key.slice(ne._key.length-5,ne._key.length),onClick:()=>{x(ne._key),w(ne.title||ne._key.slice(0,5))},children:D[ne._key]||ne.title||ne._key.slice(ne._key.length-5,ne._key.length)}),ye&&y.jsx(me,{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"var(--card-focus-ring-color)"}})]}),y.jsx(Wg,{button:y.jsx(U1,{}),id:`${ne._key}-menu`,menu:y.jsx(zg,{children:y.jsx(Ig,{tone:"critical",padding:3,icon:G1,text:g("action.delete"),onClick:we=>{we.stopPropagation(),d(ne._key)}})}),popover:{portal:!0,placement:"bottom-end",tone:"default"}})]}),y.jsx(Qo,{muted:!0,children:ke?.query.split("{")[0]}),y.jsx(St,{align:"center",gap:1,children:y.jsx(et,{size:1,muted:!0,children:O.format(new Date(ne.savedAt||""))})}),ye&&y.jsx(wi,{mode:"ghost",tone:"default",size:1,padding:2,style:{height:"24px",position:"absolute",right:"16px",bottom:"16px",fontSize:"12px"},text:g("action.update"),onClick:we=>{we.stopPropagation(),F(ne)}})]})},ne._key)}),t[27]=o,t[28]=s,t[29]=d,t[30]=b,t[31]=S,t[32]=O,t[33]=n,t[34]=M,t[35]=W,t[36]=F,t[37]=D,t[38]=h,t[39]=f,t[40]=$,t[41]=A,t[42]=r,t[43]=g,t[44]=_,t[45]=j,t[46]=q,t[47]=E,t[48]=Z}else _=t[44],j=t[45],q=t[46],E=t[47],Z=t[48];let L;t[72]!==_||t[73]!==q||t[74]!==E?(L=y.jsx(_,{paddingY:q,children:E}),t[72]=_,t[73]=q,t[74]=E,t[75]=L):L=t[75];let Y;return t[76]!==j||t[77]!==Z||t[78]!==L?(Y=y.jsxs(j,{children:[Z,L]}),t[76]=j,t[77]=Z,t[78]=L,t[79]=Y):Y=t[79],Y}function qh(){return typeof window<"u"&&window.innerWidth>600}function S1(i){let t=i;return t||(t=typeof window<"u"&&typeof document<"u"?document.body.getBoundingClientRect().height-60:0),{defaultSize:t/(qh()?2:1),size:t>550?void 0:t*.4,allowResize:t>550,minSize:Math.min(170,Math.max(170,t/2)),maxSize:t>650?t*.7:t*.6}}function nA(i){const t=Pt.c(6),{visionRootRef:e}=i,[n,r]=C.useState(sA),[s,o]=C.useState(rA);let a,l;t[0]!==e?(a=()=>{if(!e.current)return;const c=d=>{r(qh());const f=d?.[0];f&&o(S1(f.contentRect.height))},h=new ResizeObserver(c);return h.observe(e.current),()=>{h.disconnect()}},l=[e],t[0]=e,t[1]=a,t[2]=l):(a=t[1],l=t[2]),C.useEffect(a,l);let u;return t[3]!==n||t[4]!==s?(u={paneSizeOptions:s,isNarrowBreakpoint:n},t[3]=n,t[4]=s,t[5]=u):u=t[5],u}function rA(){return S1(void 0)}function sA(){return qh()}function oA(i){const t=Pt.c(30),{hasValidParams:e,listenInProgress:n,queryInProgress:r,onQueryExecution:s,onListenExecution:o}=i,{t:a}=tr(ir);let l;t[0]!==a?(l=a("params.error.params-invalid-json"),t[0]=a,t[1]=l):l=t[1];let u;t[2]!==l?(u=y.jsx(He,{radius:4,children:y.jsx(et,{size:1,muted:!0,children:l})}),t[2]=l,t[3]=u):u=t[3];let c;t[4]===Symbol.for("react.memo_cache_sentinel")?(c=y.jsx(He,{radius:4,children:y.jsx(uh,{keys:["Ctrl","Enter"]})}),t[4]=c):c=t[4];const h=r?Uh:Hh,d=n||!e,f=r?"positive":"primary";let p;t[5]!==r||t[6]!==a?(p=a(r?"action.query-cancel":"action.query-execute"),t[5]=r,t[6]=a,t[7]=p):p=t[7];let g;t[8]!==s||t[9]!==h||t[10]!==d||t[11]!==f||t[12]!==p?(g=y.jsx(me,{flex:1,children:y.jsx(xs,{content:c,placement:"top",portal:!0,children:y.jsx(wi,{width:"fill",onClick:s,type:"button",icon:h,disabled:d,tone:f,text:p})})}),t[8]=s,t[9]=h,t[10]=d,t[11]=f,t[12]=p,t[13]=g):g=t[13];const m=n?Uh:Hh;let O;t[14]!==n||t[15]!==a?(O=a(n?"action.listen-cancel":"action.listen-execute"),t[14]=n,t[15]=a,t[16]=O):O=t[16];const b=!e,x=n?"positive":"default";let S;t[17]!==o||t[18]!==O||t[19]!==b||t[20]!==x||t[21]!==m?(S=y.jsx(me,{flex:1,marginLeft:3,children:y.jsx(wi,{width:"fill",onClick:o,type:"button",icon:m,text:O,mode:"ghost",disabled:b,tone:x})}),t[17]=o,t[18]=O,t[19]=b,t[20]=x,t[21]=m,t[22]=S):S=t[22];let w;t[23]!==S||t[24]!==g?(w=y.jsxs(St,{justify:"space-evenly",children:[g,S]}),t[23]=S,t[24]=g,t[25]=w):w=t[25];let v;return t[26]!==e||t[27]!==w||t[28]!==u?(v=y.jsx(G4,{children:y.jsx(He,{padding:3,paddingX:3,children:y.jsx(xs,{content:u,placement:"top",disabled:e,portal:!0,children:w})})}),t[26]=e,t[27]=w,t[28]=u,t[29]=v):v=t[29],v}const aA=G(me)`
  /* This limits the width of the popover content */
  max-width: 240px;
`,lA=G.a`
  cursor: pointer;
  margin-right: auto;
`,cA=G.div`
  width: 4px;
  height: 4px;
  border-radius: 3px;
  box-shadow: 0 0 0 1px var(--card-bg-color);
  background-color: ${({$tone:i})=>`var(--card-badge-${i}-dot-color)`};
`;function uA(){const i=Pt.c(39),[t,e]=C.useState(!1),n=C.useRef(null),r=C.useRef(null);let s;i[0]===Symbol.for("react.memo_cache_sentinel")?(s=()=>e(hA),i[0]=s):s=i[0];const o=s,{t:a}=tr(ir);let l,u;i[1]===Symbol.for("react.memo_cache_sentinel")?(l=()=>e(!1),u=()=>[n.current,r.current],i[1]=l,i[2]=u):(l=i[1],u=i[2]),dl(l,u);let c;i[3]!==a?(c=a("settings.perspectives.title"),i[3]=a,i[4]=c):c=i[4];let h;i[5]!==c?(h=y.jsx(Po,{space:2,children:y.jsx(et,{weight:"medium",children:c})}),i[5]=c,i[6]=h):h=i[6];let d;i[7]!==a?(d=a("settings.perspectives.description"),i[7]=a,i[8]=d):d=i[8];let f;i[9]!==d?(f=y.jsx(He,{children:y.jsx(et,{muted:!0,children:d})}),i[9]=d,i[10]=f):f=i[10];let p;i[11]!==a?(p=a("label.new"),i[11]=a,i[12]=p):p=i[12];let g;i[13]!==p?(g=y.jsx(me,{children:y.jsx(kg,{tone:"primary",children:p})}),i[13]=p,i[14]=g):g=i[14];let m;i[15]!==a?(m=y.jsx(et,{muted:!0,children:y.jsx(og,{t:a,i18nKey:"settings.perspective.preview-drafts-renamed-to-drafts.description"})}),i[15]=a,i[16]=m):m=i[16];let O;i[17]!==g||i[18]!==m?(O=y.jsx(He,{children:y.jsxs(oi,{space:2,children:[g,m]})}),i[17]=g,i[18]=m,i[19]=O):O=i[19];let b;i[20]!==a?(b=null,i[20]=a,i[21]=b):b=i[21];let x;i[22]!==a?(x=a("settings.perspectives.action.docs-link"),i[22]=a,i[23]=x):x=i[23];let S;i[24]!==x?(S=y.jsx(He,{children:y.jsx(et,{children:y.jsxs(lA,{href:"https://www.sanity.io/docs/perspectives",target:"_blank",children:[x," →"]})})}),i[24]=x,i[25]=S):S=i[25];let w;i[26]!==O||i[27]!==b||i[28]!==S||i[29]!==h||i[30]!==f?(w=y.jsx(aA,{children:y.jsxs(oi,{space:4,children:[h,f,O,b,S]})}),i[26]=O,i[27]=b,i[28]=S,i[29]=h,i[30]=f,i[31]=w):w=i[31];let v;i[32]===Symbol.for("react.memo_cache_sentinel")?(v=y.jsx(cA,{$tone:"primary"}),i[32]=v):v=i[32];let D;i[33]!==t?(D=y.jsx(wi,{icon:ob,mode:"bleed",padding:2,paddingRight:1,tone:"primary",fontSize:1,ref:n,onClick:o,selected:t,children:v}),i[33]=t,i[34]=D):D=i[34];let R;return i[35]!==t||i[36]!==w||i[37]!==D?(R=y.jsx(To,{content:w,placement:"bottom-start",portal:!0,padding:3,ref:r,open:t,children:D}),i[35]=t,i[36]=w,i[37]=D,i[38]=R):R=i[38],R}function hA(i){return!i}const dA=i=>{const t=Pt.c(9),{pinnedPerspective:e,t:n}=i,r=typeof e.selectedPerspective=="object"?e.selectedPerspective.metadata.title:e.selectedPerspectiveName;let s;t[0]!==e||t[1]!==n?(s=Lp(e)?`(${n("settings.perspectives.pinned-release-label")})`:n("settings.perspectives.pinned-release-label"),t[0]=e,t[1]=n,t[2]=s):s=t[2];const o=s;let a;t[3]!==o||t[4]!==r?(a=[r,o].filter(mA),t[3]=o,t[4]=r,t[5]=a):a=t[5];const l=a.join(" "),u=!Lp(e);let c;return t[6]!==u||t[7]!==l?(c=y.jsx("option",{value:"pinnedRelease",disabled:u,children:l}),t[6]=u,t[7]=l,t[8]=c):c=t[8],c};function fA(i){const t=Pt.c(64),{onChangeDataset:e,dataset:n,customApiVersion:r,apiVersion:s,onChangeApiVersion:o,datasets:a,customApiVersionElementRef:l,onCustomApiVersionChange:u,isValidApiVersion:c,onChangePerspective:h,url:d,perspective:f}=i,p=sg(),{t:g}=tr(ir),m=C.useRef(null);let O;t[0]===Symbol.for("react.memo_cache_sentinel")?(O=()=>{const I=m.current;if(I)try{I.select(),document.execCommand("copy")}catch{console.error("Unable to copy to clipboard :(")}},t[0]=O):O=t[0];const b=O;let x;t[1]===Symbol.for("react.memo_cache_sentinel")?(x=[1,4,8,12],t[1]=x):x=t[1];let S;t[2]!==g?(S=g("settings.dataset-label"),t[2]=g,t[3]=S):S=t[3];let w;t[4]!==S?(w=y.jsx(He,{paddingTop:2,paddingBottom:3,children:y.jsx(Vn,{children:S})}),t[4]=S,t[5]=w):w=t[5];let v;t[6]!==a?(v=a.map(gA),t[6]=a,t[7]=v):v=t[7];let D;t[8]!==n||t[9]!==e||t[10]!==v?(D=y.jsx(xa,{value:n,onChange:e,children:v}),t[8]=n,t[9]=e,t[10]=v,t[11]=D):D=t[11];let R;t[12]!==w||t[13]!==D?(R=y.jsx(me,{padding:1,column:2,children:y.jsxs(oi,{children:[w,D]})}),t[12]=w,t[13]=D,t[14]=R):R=t[14];let $;t[15]!==g?($=g("settings.api-version-label"),t[15]=g,t[16]=$):$=t[16];let k;t[17]!==$?(k=y.jsx(He,{paddingTop:2,paddingBottom:3,children:y.jsx(Vn,{children:$})}),t[17]=$,t[18]=k):k=t[18];const A=r===!1?s:"other";let P;t[19]===Symbol.for("react.memo_cache_sentinel")?(P=so.map(pA),t[19]=P):P=t[19];let Q;t[20]!==g?(Q=g("settings.other-api-version-label"),t[20]=g,t[21]=Q):Q=t[21];let M;t[22]!==Q?(M=y.jsx("option",{value:"other",children:Q},"other"),t[22]=Q,t[23]=M):M=t[23];let B;t[24]!==o||t[25]!==A||t[26]!==M?(B=y.jsxs(xa,{"data-testid":"api-version-selector",value:A,onChange:o,children:[P,M]}),t[24]=o,t[25]=A,t[26]=M,t[27]=B):B=t[27];let W;t[28]!==B||t[29]!==k?(W=y.jsx(me,{padding:1,column:2,children:y.jsxs(oi,{children:[k,B]})}),t[28]=B,t[29]=k,t[30]=W):W=t[30];let X;t[31]!==r||t[32]!==l||t[33]!==c||t[34]!==u||t[35]!==g?(X=r!==!1&&y.jsx(me,{padding:1,column:2,children:y.jsxs(oi,{children:[y.jsx(He,{paddingTop:2,paddingBottom:3,children:y.jsx(Vn,{textOverflow:"ellipsis",children:g("settings.custom-api-version-label")})}),y.jsx(ys,{ref:l,value:r,onChange:u,customValidity:c?void 0:g("settings.error.invalid-api-version"),maxLength:11})]})}),t[31]=r,t[32]=l,t[33]=c,t[34]=u,t[35]=g,t[36]=X):X=t[36];let F;t[37]!==g?(F=g("settings.perspective-label"),t[37]=g,t[38]=F):F=t[38];let _;t[39]!==F?(_=y.jsx(me,{children:y.jsx(Vn,{children:F})}),t[39]=F,t[40]=_):_=t[40];let j;t[41]===Symbol.for("react.memo_cache_sentinel")?(j=y.jsx(me,{children:y.jsx(uA,{})}),t[41]=j):j=t[41];let q;t[42]!==_?(q=y.jsx(He,{paddingBottom:1,children:y.jsxs(Po,{space:1,children:[_,j]})}),t[42]=_,t[43]=q):q=t[43];const E=f||"default";let Z;t[44]!==p||t[45]!==g?(Z=m1.map(I=>I==="pinnedRelease"?y.jsxs(C.Fragment,{children:[y.jsx(dA,{pinnedPerspective:p,t:g}),y.jsx("option",{value:"default",children:g("settings.perspectives.default")},"default"),y.jsx("hr",{})]},"pinnedRelease"):y.jsx("option",{children:I},I)),t[44]=p,t[45]=g,t[46]=Z):Z=t[46];let L;t[47]!==h||t[48]!==E||t[49]!==Z?(L=y.jsx(xa,{value:E,onChange:h,children:Z}),t[47]=h,t[48]=E,t[49]=Z,t[50]=L):L=t[50];let Y;t[51]!==q||t[52]!==L?(Y=y.jsx(me,{padding:1,column:2,children:y.jsxs(oi,{children:[q,L]})}),t[51]=q,t[52]=L,t[53]=Y):Y=t[53];let N;t[54]!==r||t[55]!==g||t[56]!==d?(N=typeof d=="string"?y.jsx(me,{padding:1,flex:1,column:r===!1?6:4,children:y.jsxs(oi,{children:[y.jsx(He,{paddingTop:2,paddingBottom:3,children:y.jsxs(Vn,{children:[g("query.url")," ",y.jsxs(z4,{onClick:b,children:["[",g("action.copy-url-to-clipboard"),"]"]})]})}),y.jsxs(St,{flex:1,gap:1,children:[y.jsx(me,{flex:1,children:y.jsx(ys,{readOnly:!0,type:"url",ref:m,value:d})}),y.jsx(xs,{content:g("action.copy-url-to-clipboard"),children:y.jsx(wi,{"aria-label":g("action.copy-url-to-clipboard"),type:"button",mode:"ghost",icon:q1,onClick:b})})]})]})}):y.jsx(me,{flex:1}),t[54]=r,t[55]=g,t[56]=d,t[57]=N):N=t[57];let z;return t[58]!==W||t[59]!==X||t[60]!==Y||t[61]!==N||t[62]!==R?(z=y.jsx(F4,{paddingX:3,paddingY:2,children:y.jsxs(sh,{columns:x,children:[R,W,X,Y,N]})}),t[58]=W,t[59]=X,t[60]=Y,t[61]=N,t[62]=R,t[63]=z):z=t[63],z}function pA(i){return y.jsx("option",{children:i},i)}function gA(i){return y.jsx("option",{children:i},i)}function mA(i){return typeof i<"u"}function OA(i,t){return URL.createObjectURL(new Blob([i],{type:t}))}function v1(i,t){return(()=>{let e="",n="";return r=>{const s=t(r);if(!(typeof s!="string"||s===""))return s===n||(n=s,e&&URL.revokeObjectURL(e),e=OA(s,i)),e}})()}const bA=v1("application/json",i=>JSON.stringify(i,null,2)),yA=v1("text/csv",i=>v4.json2csv(Array.isArray(i)?i:[i]).trim()),Nu=G(Qo)`
  color: ${({theme:i})=>i.sanity.color.muted.critical.enabled.fg};
`;function xA(i){const t=Pt.c(7),{error:e}=i,{t:n}=tr(ir);if(!("details"in e))return null;const r={...e.details,...wA(e.details)};if(!r.line)return null;const s=`${r.line}
${SA(r.column,r.columnEnd)}`;let o;t[0]!==s?(o=y.jsx(Nu,{size:1,children:s}),t[0]=s,t[1]=o):o=t[1];const a=`${n("query.error.line")}:   ${r.lineNumber}
${n("query.error.column")}: ${r.column}`;let l;t[2]!==a?(l=y.jsx(me,{marginTop:4,children:y.jsx(Nu,{size:1,children:a})}),t[2]=a,t[3]=l):l=t[3];let u;return t[4]!==o||t[5]!==l?(u=y.jsxs("div",{children:[o,l]}),t[4]=o,t[5]=l,t[6]=u):u=t[6],u}function wA(i){if(!i||typeof i.query!="string"||typeof i.start!="number")return{};const{query:t,start:e,end:n}=i,r=t.slice(0,e).lastIndexOf(`
`)+1,s=(t.slice(0,r).match(/\n/g)||[]).length,o=t.slice(r,t.indexOf(`
`,r)),a=e-r,l=typeof n=="number"?n-r:void 0;return{line:o,lineNumber:s,column:a,columnEnd:l}}function SA(i,t){const e="-".repeat(i),n="^".repeat(t?t-i:1);return`${e}${n}`}function vA(i){const t=Pt.c(7);let e;t[0]!==i.error.message?(e=y.jsx(Nu,{size:1,children:i.error.message}),t[0]=i.error.message,t[1]=e):e=t[1];let n;t[2]!==i.error?(n=y.jsx(xA,{error:i.error}),t[2]=i.error,t[3]=n):n=t[3];let r;return t[4]!==e||t[5]!==n?(r=y.jsxs(oi,{space:5,marginTop:2,children:[e,n]}),t[4]=e,t[5]=n,t[6]=r):r=t[6],r}const kA=G.div(({theme:i})=>{const{color:t,fonts:e,space:n}=i.sanity;return Re`
    & .json-inspector,
    & .json-inspector .json-inspector__selection {
      font-family: ${e.code.family};
      font-size: ${e.code.sizes[2].fontSize}px;
      line-height: ${e.code.sizes[2].lineHeight}px;
      color: var(--card-code-fg-color);
    }

    & .json-inspector .json-inspector__leaf {
      padding-left: ${he(n[4])};
    }

    & .json-inspector .json-inspector__leaf.json-inspector__leaf_root {
      padding-top: ${he(n[0])};
      padding-left: 0;
    }

    & .json-inspector > .json-inspector__leaf_root > .json-inspector__line > .json-inspector__key {
      display: none;
    }

    & .json-inspector .json-inspector__line {
      display: block;
      position: relative;
      cursor: default;
    }

    & .json-inspector .json-inspector__line::after {
      content: '';
      position: absolute;
      top: 0;
      left: -200px;
      right: -50px;
      bottom: 0;
      z-index: -1;
      pointer-events: none;
    }

    & .json-inspector .json-inspector__line:hover::after {
      background: var(--card-code-bg-color);
    }

    & .json-inspector .json-inspector__leaf_composite > .json-inspector__line {
      cursor: pointer;
    }

    & .json-inspector .json-inspector__leaf_composite > .json-inspector__line::before {
      content: '▸ ';
      margin-left: calc(0px - ${he(n[4])});
      font-size: ${e.code.sizes[2].fontSize}px;
      line-height: ${e.code.sizes[2].lineHeight}px;
    }

    &
      .json-inspector
      .json-inspector__leaf_expanded.json-inspector__leaf_composite
      > .json-inspector__line::before {
      content: '▾ ';
      font-size: ${e.code.sizes[2].fontSize}px;
      line-height: ${e.code.sizes[2].lineHeight}px;
    }

    & .json-inspector .json-inspector__radio,
    & .json-inspector .json-inspector__flatpath {
      display: none;
    }

    & .json-inspector .json-inspector__value {
      margin-left: ${he(n[4]/2)};
    }

    &
      .json-inspector
      > .json-inspector__leaf_root
      > .json-inspector__line
      > .json-inspector__key
      + .json-inspector__value {
      margin: 0;
    }

    & .json-inspector .json-inspector__key {
      color: ${t.syntax.property};
    }

    & .json-inspector .json-inspector__value_helper,
    & .json-inspector .json-inspector__value_null {
      color: ${t.syntax.constant};
    }

    & .json-inspector .json-inspector__not-found {
      padding-top: ${he(n[2])};
    }

    & .json-inspector .json-inspector__value_string {
      color: ${t.syntax.string};
      word-break: break-word;
    }

    & .json-inspector .json-inspector__value_boolean {
      color: ${t.syntax.boolean};
    }

    & .json-inspector .json-inspector__value_number {
      color: ${t.syntax.number};
    }

    & .json-inspector .json-inspector__show-original {
      display: inline-block;
      padding: 0 6px;
      cursor: pointer;
    }

    & .json-inspector .json-inspector__show-original:hover {
      color: inherit;
    }

    & .json-inspector .json-inspector__show-original::before {
      content: '↔';
    }

    & .json-inspector .json-inspector__show-original:hover::after {
      content: ' expand';
    }
  `}),Wu=new N1({maxSize:5e4});function Wp(i){const t=Pt.c(7),{data:e,datasetName:n}=i,r=H1();if(k1(e)||Array.isArray(e)){const a=r===n?CA:void 0;let l;return t[0]!==e||t[1]!==a?(l=y.jsx(kA,{children:y.jsx(K1,{data:e,search:!1,isExpanded:DA,onClick:$A,interactiveLabel:a})}),t[0]=e,t[1]=a,t[2]=l):l=t[2],l}let s;t[3]!==e?(s=JSON.stringify(e),t[3]=e,t[4]=s):s=t[4];let o;return t[5]!==s?(o=y.jsx(Qo,{language:"json",children:s}),t[5]=s,t[6]=o):o=t[6],o}function CA(i){const t=Pt.c(5);if(i.isKey||!i.keypath.endsWith("_id")&&!i.keypath.endsWith("_ref"))return null;let e;t[0]!==i.value?(e={id:i.value},t[0]=i.value,t[1]=e):e=t[1];let n;t[2]===Symbol.for("react.memo_cache_sentinel")?(n=y.jsx(sb,{}),t[2]=n):n=t[2];let r;return t[3]!==e?(r=y.jsx(ib,{intent:"edit",params:e,children:n}),t[3]=e,t[4]=r):r=t[4],r}function DA(i,t){const e=Wu.get(i);if(typeof e=="boolean")return e;const n=i.split(".",4);return n.length===4?!1:Array.isArray(t)?!0:k1(t)&&!n.some(r=>PA(r))}function $A(i){const{path:t}=i,e=Wu.get(t);e!==void 0&&Wu.set(t,!e)}function k1(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)}const QA=/^\d+$/;function PA(i,t=10){return QA.test(i)&&parseInt(i,10)>t}function AA(i){return i.preventDefault()}function EA(i){const t=Pt.c(9),{blobUrl:e}=i,{t:n}=tr(ir),r=!e,s=r?void 0:"query-result.csv",o=r?AA:void 0;let a;t[0]!==e||t[1]!==r||t[2]!==s||t[3]!==o?(a=y.jsx(wi,{as:"a",disabled:r,download:s,href:e,icon:ag,mode:"ghost",onClick:o,text:"CSV",tone:"default"}),t[0]=e,t[1]=r,t[2]=s,t[3]=o,t[4]=a):a=t[4];const l=a;let u;return t[5]!==l||t[6]!==r||t[7]!==n?(u=r?y.jsx(xs,{content:n("result.save-result-as-csv.not-csv-encodable"),placement:"top",children:l}):l,t[5]=l,t[6]=r,t[7]=n,t[8]=u):u=t[8],u}function TA(i){const t=Pt.c(2),{blobUrl:e}=i;let n;return t[0]!==e?(n=y.jsx(wi,{as:"a",download:"query-result.json",href:e,icon:ag,mode:"ghost",text:"JSON",tone:"default"}),t[0]=e,t[1]=n):n=t[1],n}function RA(i){const t=Pt.c(67),{error:e,queryInProgress:n,queryResult:r,listenInProgress:s,listenMutations:o,dataset:a,queryTime:l,e2eTime:u}=i,{t:c}=tr(ir),h=!e&&!n&&typeof r<"u";let d;t[0]!==h||t[1]!==r?(d=h?bA(r):"",t[0]=h,t[1]=r,t[2]=d):d=t[2];const f=d;let p;t[3]!==h||t[4]!==r?(p=h?yA(r):"",t[3]=h,t[4]=r,t[5]=p):p=t[5];const g=p,m=e?"critical":"default",O=!!e;let b;t[6]!==c?(b=c("result.label"),t[6]=c,t[7]=b):b=t[7];let x;t[8]!==b?(x=y.jsx(x1,{children:y.jsx(me,{marginLeft:3,children:y.jsx(Vn,{muted:!0,children:b})})}),t[8]=b,t[9]=x):x=t[9];let S;t[10]!==s||t[11]!==o||t[12]!==n?(S=(n||s&&o.length===0)&&y.jsx(me,{marginTop:3,children:y.jsx(g1,{})}),t[10]=s,t[11]=o,t[12]=n,t[13]=S):S=t[13];let w;t[14]!==e?(w=e&&y.jsx(vA,{error:e}),t[14]=e,t[15]=w):w=t[15];let v;t[16]!==a||t[17]!==h||t[18]!==r?(v=h&&y.jsx(Wp,{data:r,datasetName:a}),t[16]=a,t[17]=h,t[18]=r,t[19]=v):v=t[19];let D;t[20]!==a||t[21]!==s||t[22]!==o?(D=s&&o.length>0&&y.jsx(Wp,{data:o,datasetName:a}),t[20]=a,t[21]=s,t[22]=o,t[23]=D):D=t[23];let R;t[24]!==D||t[25]!==S||t[26]!==w||t[27]!==v?(R=y.jsxs(me,{padding:3,paddingTop:5,children:[S,w,v,D]}),t[24]=D,t[25]=S,t[26]=w,t[27]=v,t[28]=R):R=t[28];let $;t[29]!==R||t[30]!==x?($=y.jsxs(X4,{overflow:"auto",children:[x,R]}),t[29]=R,t[30]=x,t[31]=$):$=t[31];let k;t[32]!==$||t[33]!==m||t[34]!==O?(k=y.jsx(I4,{flex:1,children:y.jsx(L4,{flex:1,overflow:"hidden",tone:m,$isInvalid:O,children:$})}),t[32]=$,t[33]=m,t[34]=O,t[35]=k):k=t[35];let A;t[36]===Symbol.for("react.memo_cache_sentinel")?(A=["column","column","row"],t[36]=A):A=t[36];let P;t[37]!==c?(P=c("result.execution-time-label"),t[37]=c,t[38]=P):P=t[38];let Q;t[39]!==l||t[40]!==c?(Q=typeof l=="number"?`${l}ms`:c("result.timing-not-applicable"),t[39]=l,t[40]=c,t[41]=Q):Q=t[41];let M;t[42]!==P||t[43]!==Q?(M=y.jsx(me,{children:y.jsxs(et,{muted:!0,children:[P,":"," ",Q]})}),t[42]=P,t[43]=Q,t[44]=M):M=t[44];let B;t[45]!==c?(B=c("result.end-to-end-time-label"),t[45]=c,t[46]=B):B=t[46];let W;t[47]!==u||t[48]!==c?(W=typeof u=="number"?`${u}ms`:c("result.timing-not-applicable"),t[47]=u,t[48]=c,t[49]=W):W=t[49];let X;t[50]!==B||t[51]!==W?(X=y.jsx(me,{marginLeft:4,children:y.jsxs(et,{muted:!0,children:[B,":"," ",W]})}),t[50]=B,t[51]=W,t[52]=X):X=t[52];let F;t[53]!==M||t[54]!==X?(F=y.jsx(W4,{paddingX:4,paddingY:3,sizing:"border",children:y.jsxs(Y4,{align:"center",children:[M,X]})}),t[53]=M,t[54]=X,t[55]=F):F=t[55];let _;t[56]!==g||t[57]!==h||t[58]!==f||t[59]!==c?(_=h&&y.jsx(q4,{paddingX:4,paddingY:3,sizing:"border",children:y.jsx(V4,{muted:!0,children:y.jsx(og,{components:{SaveResultButtons:()=>y.jsxs(y.Fragment,{children:[y.jsx(TA,{blobUrl:f}),y.jsx(EA,{blobUrl:g})]})},i18nKey:"result.save-result-as-format",t:c})})}),t[56]=g,t[57]=h,t[58]=f,t[59]=c,t[60]=_):_=t[60];let j;t[61]!==F||t[62]!==_?(j=y.jsxs(N4,{justify:"space-between",direction:A,children:[F,_]}),t[61]=F,t[62]=_,t[63]=j):j=t[63];let q;return t[64]!==k||t[65]!==j?(q=y.jsxs(j4,{direction:"column","data-testid":"vision-result",children:[k,j]}),t[64]=k,t[65]=j,t[66]=q):q=t[66],q}function _A(i,t){return!i||!t?!1:i===t||!!(i.compareDocumentPosition(t)&16)}const MA=/\.(?:api|apicdn)\.sanity\.(?:io|work)\/(vX|v1|v\d{4}-\d\d-\d\d)\/.*?(?:query|listen)\/(.*?)\?(.*)/,BA=i=>Kh("ctrl+enter",i)||Kh("mod+enter",i);function FA(i){const t=Pt.c(199),{datasets:e,config:n,projectId:r,defaultDataset:s}=i,o=qg(),{t:a}=tr(ir),{perspectiveStack:l}=sg(),u=C.useRef(null),c=C.useRef(null),h=C.useRef(null),d=C.useRef(null),f=C.useRef(void 0),p=C.useRef(void 0);let g;t[0]!==r?(g=()=>T4(r||"default"),t[0]=r,t[1]=g):g=t[1];const[m]=C.useState(g);let O;t[2]!==s||t[3]!==m?(O=m.get("dataset",s),t[2]=s,t[3]=m,t[4]=O):O=t[4];const b=O;let x;t[5]!==n.defaultApiVersion||t[6]!==m?(x=m.get("apiVersion",M4(`${n.defaultApiVersion}`)),t[5]=n.defaultApiVersion,t[6]=m,t[7]=x):x=t[7];const S=x;let w;t[8]!==m?(w=m.get("query",""),t[8]=m,t[9]=w):w=t[9];const v=w;let D;t[10]!==m?(D=m.get("params",`{
  
}`),t[10]=m,t[11]=D):D=t[11];const R=D;let $;t[12]!==m?($=m.get("perspective",void 0),t[12]=m,t[13]=$):$=t[13];const k=$;let A;t[14]!==e||t[15]!==s||t[16]!==b?(A=()=>e.includes(b)?b:e.includes(s)?s:e[0],t[14]=e,t[15]=s,t[16]=b,t[17]=A):A=t[17];const[P,Q]=C.useState(A);let M;t[18]!==S?(M=()=>so.includes(S)?S:p1,t[18]=S,t[19]=M):M=t[19];const[B,W]=C.useState(M);let X;t[20]!==S?(X=()=>so.includes(S)?!1:S,t[20]=S,t[21]=X):X=t[21];const[F,_]=C.useState(X),[j,q]=C.useState(k||"raw");let E;t[22]!==F?(E=F?Ec(F):!0,t[22]=F,t[23]=E):E=t[23];const Z=E,[L,Y]=C.useState(void 0);let N;t[24]!==v?(N=()=>typeof v=="string"?v:"",t[24]=v,t[25]=N):N=t[25];const[z,I]=C.useState(N),[V,J]=C.useState(R);let re;t[26]!==V||t[27]!==a?(re=Np(V,a),t[26]=V,t[27]=a,t[28]=re):re=t[28];const ee=re,[se,Oe]=C.useState(void 0);let be;t[29]===Symbol.for("react.memo_cache_sentinel")?(be=[],t[29]=be):be=t[29];const[ne,ke]=C.useState(be),[Qe,Pe]=C.useState(void 0),[ye,we]=C.useState(void 0),[Ce,Ee]=C.useState(void 0),[De,xe]=C.useState(!1),[ue,ve]=C.useState(!1),[Be,je]=C.useState(!1);let Le;t[30]===Symbol.for("react.memo_cache_sentinel")?(Le={visionRootRef:h},t[30]=Le):Le=t[30];const{paneSizeOptions:Xe,isNarrowBreakpoint:tt}=nA(Le),Te=Z&&F?F:B;let At;t[31]!==Te?(At={apiVersion:Te},t[31]=Te,t[32]=At):At=t[32];const li=qu(At);let ht;t[33]!==li||t[34]!==B||t[35]!==F||t[36]!==P||t[37]!==Z||t[38]!==j||t[39]!==l?(ht=li.withConfig({apiVersion:Z&&F?F:B,perspective:Pc({visionPerspective:j,perspectiveStack:l}),dataset:P,allowReconfigure:!0}),t[33]=li,t[34]=B,t[35]=F,t[36]=P,t[37]=Z,t[38]=j,t[39]=l,t[40]=ht):ht=t[40];const Ke=ht;let Je;t[41]===Symbol.for("react.memo_cache_sentinel")?(Je=()=>{f.current&&(f.current.unsubscribe(),f.current=void 0)},t[41]=Je):Je=t[41];const xt=Je;let Ut;t[42]===Symbol.for("react.memo_cache_sentinel")?(Ut=()=>{p.current&&(p.current.unsubscribe(),p.current=void 0)},t[42]=Ut):Ut=t[42];const Ot=Ut;let zt;t[43]!==B||t[44]!==Ke||t[45]!==F||t[46]!==P||t[47]!==Z||t[48]!==m||t[49]!==ee.parsed||t[50]!==j||t[51]!==l||t[52]!==z||t[53]!==De||t[54]!==a?(zt=ge=>{if(De){xt(),Ot(),xe(!1);return}const $e={query:ge?.query||z,dataset:ge?.dataset||P,params:Np(JSON.stringify(ge?.params||ee.parsed,null,2),a),perspective:Pc({visionPerspective:ge?.perspective||j,perspectiveStack:l}),apiVersion:ge?.apiVersion||(F&&Z?F:B)};if(m.set("query",$e.query),m.set("params",$e.params.raw),Ot(),xe(!$e.params.error&&!!$e.query),ve(!1),ke([]),Pe($e.params.error?new Error($e.params.error):void 0),Oe(void 0),we(void 0),Ee(void 0),$e.params.error)return;const $i={perspective:$e.perspective??[]},mr=Ke.withConfig({apiVersion:$e.apiVersion,dataset:$e.dataset,perspective:$e.perspective}),El=mr.getUrl(mr.getDataUrl("query",Ac($e.query,$e.params.parsed,$i)));Y(El);const Tl=Date.now();f.current=mr.observable.fetch($e.query,$e.params.parsed,{filterResponse:!1,tag:"vision"}).subscribe({next:Mi=>{we(Mi.ms),Ee(Date.now()-Tl),Oe(Mi.result),xe(!1),Pe(void 0)},error:Mi=>{Pe(Mi),xe(!1)}})},t[43]=B,t[44]=Ke,t[45]=F,t[46]=P,t[47]=Z,t[48]=m,t[49]=ee.parsed,t[50]=j,t[51]=l,t[52]=z,t[53]=De,t[54]=a,t[55]=zt):zt=t[55];const Ve=zt;let gi;t[56]!==Ve||t[57]!==m?(gi=ge=>{ge!==void 0&&!Qc(ge)||(q(ge),m.set("perspective",ge),Ve({perspective:ge}))},t[56]=Ve,t[57]=m,t[58]=gi):gi=t[58];const mi=gi;let jt;t[59]!==Ve||t[60]!==m?(jt=ge=>{const $e=ge.target.value;m.set("dataset",$e),Q($e),Ve({dataset:$e})},t[59]=Ve,t[60]=m,t[61]=jt):jt=t[61];const Ht=jt;let vt;t[62]!==Ve||t[63]!==m?(vt=ge=>{const $e=ge.target.value;if($e?.toLowerCase()==="other"){_("v"),d.current?.focus();return}W($e),_(!1),m.set("apiVersion",$e),Ve({apiVersion:$e})},t[62]=Ve,t[63]=m,t[64]=vt):vt=t[64];const ci=vt;let Kt;t[65]!==Ve||t[66]!==m?(Kt=ge=>{const $e=ge.target.value||"";_($e||"v"),Ec($e)&&(W($e),m.set("apiVersion",$e),Ve({apiVersion:$e}))},t[65]=Ve,t[66]=m,t[67]=Kt):Kt=t[67];const Oi=Kt;let Et;t[68]!==mi?(Et=ge=>{const $e=ge.target.value;mi($e==="default"?void 0:$e)},t[68]=mi,t[69]=Et):Et=t[69];const It=Et;let bt;t[70]===Symbol.for("react.memo_cache_sentinel")?(bt=ge=>{ge.type==="mutation"&&ke($e=>$e.length===50?[ge,...$e.slice(0,49)]:[ge,...$e])},t[70]=bt):bt=t[70];const _i=bt;let Jt;t[71]!==Ke||t[72]!==ue||t[73]!==m||t[74]!==ee.error||t[75]!==ee.parsed||t[76]!==ee.raw||t[77]!==z?(Jt=()=>{if(ue){Ot(),ve(!1);return}const ge=Ke.getDataUrl("listen",Ac(z,ee.parsed,{})),$e=!ee.error&&z.trim().length>0;m.set("query",z),m.set("params",ee.raw),xt(),Y(ge),ke([]),xe(!1),Oe(void 0),ve($e),Pe(ee.error?new Error(ee.error):void 0),we(void 0),Ee(void 0),$e&&(p.current=Ke.listen(z,ee.parsed,{events:["mutation","welcome"],includeAllVersions:!0}).subscribe({next:_i,error:$i=>{Pe($i),ve(!1)}}))},t[71]=Ke,t[72]=ue,t[73]=m,t[74]=ee.error,t[75]=ee.parsed,t[76]=ee.raw,t[77]=z,t[78]=Jt):Jt=t[78];const Lt=Jt;let Tt;t[79]!==m?(Tt=ge=>{J(ge),m.set("params",ge)},t[79]=m,t[80]=Tt):Tt=t[80];const ei=Tt;let Xt;t[81]!==B||t[82]!==P||t[83]!==e||t[84]!==j||t[85]!==o?(Xt=ge=>{const $e=ge.match(MA);if(!$e)return null;const[,$i,mr,El]=$e,Tl=new URLSearchParams(El),Mi=_4(Tl);if(!Mi)return null;let Vh,Rl;Ec($i)&&(so.includes($i)?(Vh=$i,Rl=!1):Rl=$i);const Gh=Qc(Mi.options.perspective)&&!Ip(Mi.options.perspective)?Mi.options.perspective:void 0;return Gh&&(!Qc(Mi.options.perspective)||Ip(Mi.options.perspective))&&o.push({closable:!0,id:"vision-paste-unsupported-perspective",status:"warning",title:'Perspective in pasted url is currently not supported. Falling back to "raw"'}),{query:Mi.query,params:Mi.params,rawParams:JSON.stringify(Mi.params,null,2),dataset:e.includes(mr)?mr:P,apiVersion:Vh||B,customApiVersion:Rl,perspective:Gh||j,url:ge}},t[81]=B,t[82]=P,t[83]=e,t[84]=j,t[85]=o,t[86]=Xt):Xt=t[86];const Nt=Xt;let Wt;t[87]!==Ve||t[88]!==m?(Wt=ge=>{Q(ge.dataset),I(ge.query),J(ge.rawParams),W(ge.apiVersion),ge.customApiVersion&&_(ge.customApiVersion),q(ge.perspective),Y(ge.url),u.current?.resetEditorContent(ge.query),c.current?.resetEditorContent(ge.rawParams),m.merge({query:ge.query,params:ge.rawParams,dataset:ge.dataset,apiVersion:ge.customApiVersion||ge.apiVersion,perspective:ge.perspective}),Ve(ge)},t[87]=Ve,t[88]=m,t[89]=Wt):Wt=t[89];const ki=Wt;let ti;t[90]!==Nt||t[91]!==ki||t[92]!==o?(ti=ge=>{if(!ge.clipboardData)return;const $e=ge.clipboardData.getData("text/plain");ge.preventDefault();const $i=Nt($e);$i&&(ki($i),o.push({closable:!0,id:"vision-paste",status:"info",title:"Parsed URL to query"}))},t[90]=Nt,t[91]=ki,t[92]=o,t[93]=ti):ti=t[93];const kt=ti;let Ct;t[94]!==Ve||t[95]!==ee.valid?(Ct=ge=>{const $e=h.current&&_A(h.current,ge.target);BA(ge)&&$e&&ee.valid&&(Ve(),ge.preventDefault(),ge.stopPropagation())},t[94]=Ve,t[95]=ee.valid,t[96]=Ct):Ct=t[96];const Rt=Ct;let Yt,ii;t[97]!==Rt||t[98]!==kt?(Yt=()=>(window.document.addEventListener("paste",kt),window.document.addEventListener("keydown",Rt),()=>{window.document.removeEventListener("paste",kt),window.document.removeEventListener("keydown",Rt)}),ii=[Rt,kt],t[97]=Rt,t[98]=kt,t[99]=Yt,t[100]=ii):(Yt=t[99],ii=t[100]),C.useEffect(Yt,ii);let ni,_t;t[101]===Symbol.for("react.memo_cache_sentinel")?(ni=()=>()=>{xt(),Ot()},_t=[xt,Ot],t[101]=ni,t[102]=_t):(ni=t[101],_t=t[102]),C.useEffect(ni,_t);let Mt;t[103]!==mi?(Mt=ge=>{ge.length>0&&mi("pinnedRelease")},t[103]=mi,t[104]=Mt):Mt=t[104];const Ae=ul(Mt);let dt;t[105]!==Ae||t[106]!==l?(dt=()=>{Ae(l)},t[105]=Ae,t[106]=l,t[107]=dt):dt=t[107];let qt;t[108]!==l?(qt=[l],t[108]=l,t[109]=qt):qt=t[109],C.useEffect(dt,qt);let Li;t[110]!==Ke||t[111]!==j||t[112]!==l?(Li=(ge,$e)=>{const $i={perspective:Pc({visionPerspective:j,perspectiveStack:l})??[]};return Ke.getUrl(Ke.getDataUrl("query",Ac(ge,$e,$i)))},t[110]=Ke,t[111]=j,t[112]=l,t[113]=Li):Li=t[113];const Xi=Li;let Ni;t[114]!==B||t[115]!==F||t[116]!==P||t[117]!==e||t[118]!==ci||t[119]!==Ht||t[120]!==It||t[121]!==Oi||t[122]!==Z||t[123]!==j||t[124]!==L?(Ni=y.jsx(fA,{apiVersion:B,customApiVersion:F,dataset:P,datasets:e,onChangeDataset:Ht,onChangeApiVersion:ci,customApiVersionElementRef:d,onCustomApiVersionChange:Oi,isValidApiVersion:Z,onChangePerspective:It,url:L,perspective:j}),t[114]=B,t[115]=F,t[116]=P,t[117]=e,t[118]=ci,t[119]=Ht,t[120]=It,t[121]=Oi,t[122]=Z,t[123]=j,t[124]=L,t[125]=Ni):Ni=t[125];const Ci=Be?window.innerWidth:window.innerWidth-275,Hi=tt?"vertical":"horizontal",it=tt?Xe.defaultSize:Xe.minSize,kn=Xe.size,Mr=Xe.allowResize,Ki=tt?Xe.minSize:100,lr=Xe.maxSize;let Ji;t[126]!==a?(Ji=a("query.label"),t[126]=a,t[127]=Ji):Ji=t[127];let en;t[128]!==Ji?(en=y.jsx(w1,{children:y.jsx(St,{children:y.jsx(Vn,{muted:!0,children:Ji})})}),t[128]=Ji,t[129]=en):en=t[129];let tn;t[130]!==z?(tn=y.jsx(Yh,{initialValue:z,onChange:I,ref:u}),t[130]=z,t[131]=tn):tn=t[131];let Di;t[132]!==en||t[133]!==tn?(Di=y.jsx(Xp,{display:"flex","data-testid":"vision-query-editor",children:y.jsxs(me,{flex:1,children:[en,tn]})}),t[132]=en,t[133]=tn,t[134]=Di):Di=t[134];let Wi;t[135]!==ei||t[136]!==ee.error||t[137]!==ee.raw||t[138]!==ee.valid?(Wi=y.jsx(H4,{value:ee.raw,onChange:ei,paramsError:ee.error,hasValidParams:ee.valid,editorRef:c}),t[135]=ei,t[136]=ee.error,t[137]=ee.raw,t[138]=ee.valid,t[139]=Wi):Wi=t[139];let de;t[140]!==Lt||t[141]!==Ve||t[142]!==ue||t[143]!==ee.valid||t[144]!==De?(de=y.jsx(oA,{hasValidParams:ee.valid,queryInProgress:De,listenInProgress:ue,onQueryExecution:Ve,onListenExecution:Lt}),t[140]=Lt,t[141]=Ve,t[142]=ue,t[143]=ee.valid,t[144]=De,t[145]=de):de=t[145];let Ne;t[146]!==Wi||t[147]!==de?(Ne=y.jsxs(Xp,{display:"flex",children:[Wi,de]}),t[146]=Wi,t[147]=de,t[148]=Ne):Ne=t[148];let st;t[149]!==Xe.allowResize||t[150]!==Xe.maxSize||t[151]!==Xe.size||t[152]!==it||t[153]!==Ki||t[154]!==Di||t[155]!==Ne?(st=y.jsx(me,{height:"stretch",flex:1,children:y.jsxs(Yl,{className:"sidebarPanes",split:"horizontal",defaultSize:it,size:kn,allowResize:Mr,minSize:Ki,maxSize:lr,primary:"first",children:[Di,Ne]})}),t[149]=Xe.allowResize,t[150]=Xe.maxSize,t[151]=Xe.size,t[152]=it,t[153]=Ki,t[154]=Di,t[155]=Ne,t[156]=st):st=t[156];let nt;t[157]!==P||t[158]!==Ce||t[159]!==Qe||t[160]!==ue||t[161]!==ne||t[162]!==De||t[163]!==se||t[164]!==ye?(nt=y.jsx(RA,{error:Qe,queryInProgress:De,queryResult:se,listenInProgress:ue,listenMutations:ne,dataset:P,queryTime:ye,e2eTime:Ce}),t[157]=P,t[158]=Ce,t[159]=Qe,t[160]=ue,t[161]=ne,t[162]=De,t[163]=se,t[164]=ye,t[165]=nt):nt=t[165];let Bt;t[166]!==Hi||t[167]!==st||t[168]!==nt?(Bt=y.jsx(me,{height:"stretch",flex:1,children:y.jsxs(Yl,{className:"sidebarPanes",split:Hi,minSize:300,children:[st,nt]})}),t[166]=Hi,t[167]=st,t[168]=nt,t[169]=Bt):Bt=t[169];let bi;t[170]===Symbol.for("react.memo_cache_sentinel")?(bi={position:"relative",height:"100%"},t[170]=bi):bi=t[170];let Cn;t[171]===Symbol.for("react.memo_cache_sentinel")?(Cn={position:"absolute",left:-32,top:"50%",transform:"translateY(-50%)",zIndex:100,pointerEvents:"auto"},t[171]=Cn):Cn=t[171];let cr;t[172]!==Be?(cr=()=>je(!Be),t[172]=Be,t[173]=cr):cr=t[173];let es;t[174]===Symbol.for("react.memo_cache_sentinel")?(es={display:"flex",alignItems:"center",height:"100%"},t[174]=es):es=t[174];let ur;t[175]!==Be?(ur=y.jsx("div",{style:es,children:Be?y.jsx(W1,{}):y.jsx(Y1,{})}),t[175]=Be,t[176]=ur):ur=t[176];let hr;t[177]!==cr||t[178]!==ur?(hr=y.jsx(wi,{mode:"ghost",padding:2,style:Cn,onClick:cr,children:ur}),t[177]=cr,t[178]=ur,t[179]=hr):hr=t[179];let dr;t[180]!==ee.parsed?(dr=ee.parsed||{},t[180]=ee.parsed,t[181]=dr):dr=t[181];let fr;t[182]!==Xi||t[183]!==Nt||t[184]!==z||t[185]!==ki||t[186]!==dr||t[187]!==L?(fr=y.jsx(iA,{url:L,getStateFromUrl:Nt,setStateFromParsedUrl:ki,currentQuery:z,currentParams:dr,generateUrl:Xi}),t[182]=Xi,t[183]=Nt,t[184]=z,t[185]=ki,t[186]=dr,t[187]=L,t[188]=fr):fr=t[188];let pr;t[189]!==hr||t[190]!==fr?(pr=y.jsxs(me,{style:bi,children:[hr,fr]}),t[189]=hr,t[190]=fr,t[191]=pr):pr=t[191];let gr;t[192]!==Ci||t[193]!==Bt||t[194]!==pr?(gr=y.jsx(Z4,{flex:"auto",children:y.jsxs(Yl,{minSize:800,defaultSize:window.innerWidth-275,size:Ci,maxSize:-225,primary:"first",children:[Bt,pr]})}),t[192]=Ci,t[193]=Bt,t[194]=pr,t[195]=gr):gr=t[195];let ts;return t[196]!==Ni||t[197]!==gr?(ts=y.jsxs(y1,{direction:"column",height:"fill",ref:h,sizing:"border",overflow:"hidden","data-testid":"vision-root",children:[Ni,gr]}),t[196]=Ni,t[197]=gr,t[198]=ts):ts=t[198],ts}function ZA(i){const t=Pt.c(7),{client:e,datasets:n}=i;let r;e:{if(Array.isArray(n)){let o;t[0]!==n?(o=ng(n),t[0]=n,t[1]=o):o=t[1],r=o;break e}let s;if(t[2]!==e.observable.datasets||t[3]!==n){let o;t[5]!==n?(o=a=>typeof n=="function"?n(a).map(IA):a.map(jA),t[5]=n,t[6]=o):o=t[6],s=e.observable.datasets.list().pipe(rg(o),j1(zA)),t[2]=e.observable.datasets,t[3]=n,t[4]=s}else s=t[4];r=s}return I1(r,null)}function zA(i){return ng(i)}function jA(i){return i.name}function IA(i){return i.name}function LA(i){const t=Pt.c(19);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e={apiVersion:"v2025-06-27"},t[0]=e):e=t[0];const n=qu(e);let r;t[1]!==n||t[2]!==i.config.datasets?(r={client:n,datasets:i.config.datasets},t[1]=n,t[2]=i.config.datasets,t[3]=r):r=t[3];const s=ZA(r);if(!s){let f;return t[4]===Symbol.for("react.memo_cache_sentinel")?(f=y.jsx(St,{align:"center",height:"fill",justify:"center",children:y.jsx(g1,{})}),t[4]=f):f=t[4],f}let o;t[5]!==s||t[6]!==i.client?(o=s instanceof Error?[i.client.config().dataset||"production"]:s,t[5]=s,t[6]=i.client,t[7]=o):o=t[7];const a=o;let l;t[8]!==i.client?(l=i.client.config(),t[8]=i.client,t[9]=l):l=t[9];const u=l.projectId;let c;t[10]!==a||t[11]!==i.client||t[12]!==i.config.defaultDataset?(c=i.config.defaultDataset||i.client.config().dataset||a[0],t[10]=a,t[11]=i.client,t[12]=i.config.defaultDataset,t[13]=c):c=t[13];const h=c;let d;return t[14]!==a||t[15]!==h||t[16]!==u||t[17]!==i?(d=y.jsx(FA,{...i,datasets:a,projectId:u,defaultDataset:h},u),t[14]=a,t[15]=h,t[16]=u,t[17]=i,t[18]=d):d=t[18],d}class XA extends C.Component{constructor(t){super(t),this.state={error:null,numRetries:0}}static getDerivedStateFromError(t){return{error:t instanceof Error?t.message:`${t}`}}handleRetryRender=()=>this.setState(t=>({error:null,numRetries:t.numRetries+1}));handleRetryWithCacheClear=()=>{E4(),this.handleRetryRender()};render(){if(!this.state.error)return this.props.children;const t=this.state.error,e=this.state.numRetries>0;return y.jsx(He,{height:"fill",overflow:"auto",paddingY:[4,5,6,7],paddingX:4,sizing:"border",tone:"critical",children:y.jsx(rh,{width:3,children:y.jsxs(oi,{space:4,children:[y.jsx("div",{children:y.jsx(wi,{onClick:e?this.handleRetryWithCacheClear:this.handleRetryRender,text:e?"Clear cache and retry":"Retry",tone:"default"})}),y.jsx(Pg,{children:"An error occurred"}),y.jsx(He,{border:!0,radius:2,overflow:"auto",padding:4,tone:"inherit",children:y.jsx(oi,{space:4,children:t&&y.jsx(Qo,{size:1,children:y.jsxs("strong",{children:["Error: ",t]})})})})]})})})}}function NA(i){const t=Pt.c(6);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e={apiVersion:"1"},t[0]=e):e=t[0];const n=qu(e);let r;t[1]!==i.tool.options?(r={defaultApiVersion:p1,...i.tool.options},t[1]=i.tool.options,t[2]=r):r=t[2];const s=r;let o;return t[3]!==n||t[4]!==s?(o=y.jsx(XA,{children:y.jsx(LA,{client:n,config:s})}),t[3]=n,t[4]=s,t[5]=o):o=t[5],o}const VA=Object.freeze(Object.defineProperty({__proto__:null,default:NA},Symbol.toStringTag,{value:"Module"}));export{VA as S,ce as d};
</file>

<file path="betternotes/dist/static/stegaEncodeSourceMap-v7OBnJPR.js">
import{bi as m,bj as L}from"./sanity-z2y04qld.js";const j=/_key\s*==\s*['"](.*)['"]/;function W(t){return typeof t=="string"?j.test(t.trim()):typeof t=="object"&&"_key"in t}function x(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce((e,r,n)=>{const o=typeof r;if(o==="number")return`${e}[${r}]`;if(o==="string")return`${e}${n===0?"":"."}${r}`;if(W(r)&&r._key)return`${e}[_key=="${r._key}"]`;if(Array.isArray(r)){const[a,i]=r;return`${e}[${a}:${i}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)},"")}const b={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},E={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function C(t){return`$${t.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,r=>b[r])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,r=>b[r])}')]`:`[${e._index}]`).join("")}`}function P(t){const e=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let n;for(;(n=r.exec(t))!==null;){if(n[1]!==void 0){const o=n[1].replace(/\\(\\|f|n|r|t|')/g,a=>E[a]);e.push(o);continue}if(n[2]!==void 0){e.push(parseInt(n[2],10));continue}if(n[3]!==void 0){const o=n[3].replace(/\\(\\')/g,a=>E[a]);e.push({_key:o,_index:-1});continue}}return e}function A(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._key!=="")return{_key:e._key};if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function N(t){return t.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function V(t,e){if(!e?.mappings)return;const r=C(N(t));if(e.mappings[r]!==void 0)return{mapping:e.mappings[r],matchedPath:r,pathSuffix:""};const n=Object.entries(e.mappings).filter(([f])=>r.startsWith(f)).sort(([f],[s])=>s.length-f.length);if(n.length==0)return;const[o,a]=n[0],i=r.substring(o.length);return{mapping:a,matchedPath:o,pathSuffix:i}}function M(t){return t!==null&&Array.isArray(t)}function u(t,e,r=[]){if(M(t))return t.map((n,o)=>{if(m(n)){const a=n._key;if(typeof a=="string")return u(n,e,r.concat({_key:a,_index:o}))}return u(n,e,r.concat(o))});if(m(t)){if(t._type==="block"||t._type==="span"){const n={...t};return t._type==="block"?n.children=u(t.children,e,r.concat("children")):t._type==="span"&&(n.text=u(t.text,e,r.concat("text"))),n}return Object.fromEntries(Object.entries(t).map(([n,o])=>[n,u(o,e,r.concat(n))]))}return e(t,r)}function q(t,e,r){return u(t,(n,o)=>{if(typeof n!="string")return n;const a=V(o,e);if(!a)return n;const{mapping:i,matchedPath:f}=a;if(i.type!=="value"||i.source.type!=="documentValue")return n;const s=e.documents[i.source.document],p=e.paths[i.source.path],d=P(f),c=P(p).concat(o.slice(d.length));return r({sourcePath:c,sourceDocument:s,resultPath:o,value:n})})}const J="drafts",F="versions",g=".",T=`${J}${g}`,z=`${F}${g}`;function U(t){return t.startsWith(T)}function k(t){return t.startsWith(z)}function G(t){return!U(t)&&!k(t)}function H(t){if(!k(t))return;const[e,r,...n]=t.split(g);return r}function K(t){return k(t)?t.split(g).slice(2).join(g):U(t)?t.slice(T.length):t}function X(t){const{baseUrl:e,workspace:r="default",tool:n="default",id:o,type:a,path:i,projectId:f,dataset:s}=t;if(!e)throw new Error("baseUrl is required");if(!i)throw new Error("path is required");if(!o)throw new Error("id is required");if(e!=="/"&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const p=r==="default"?void 0:r,d=n==="default"?void 0:n,c=K(o),h=Array.isArray(i)?x(A(i)):i,l=new URLSearchParams({baseUrl:e,id:c,type:a,path:h});if(p&&l.set("workspace",p),d&&l.set("tool",d),f&&l.set("projectId",f),s&&l.set("dataset",s),G(o))l.set("perspective","published");else if(k(o)){const w=H(o);l.set("perspective",w)}const y=[e==="/"?"":e];p&&y.push(p);const _=["mode=presentation",`id=${c}`,`type=${a}`,`path=${encodeURIComponent(h)}`];return d&&_.push(`tool=${d}`),y.push("intent","edit",`${_.join(";")}?${l}`),y.join("/")}function B(t){let e=typeof t=="string"?t:t.baseUrl;return e!=="/"&&(e=e.replace(/\/$/,"")),typeof t=="string"?{baseUrl:e}:{...t,baseUrl:e}}const S=({sourcePath:t,resultPath:e,value:r})=>{if(Y(r)||v(r))return!1;const n=t.at(-1);return!(t.at(-2)==="slug"&&n==="current"||typeof n=="string"&&(n.startsWith("_")||n.endsWith("Id"))||t.some(o=>o==="meta"||o==="metadata"||o==="openGraph"||o==="seo")||R(t)||R(e)||typeof n=="string"&&Q.has(n))},Q=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function Y(t){return/^\d{4}-\d{2}-\d{2}/.test(t)?!!Date.parse(t):!1}const Z=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function v(t){try{const{protocol:e}=new URL(t,t.startsWith("/")?"https://acme.com":void 0);return Z.has(e)||e.startsWith("web+")}catch{return!1}}function R(t){return t.some(e=>typeof e=="string"&&e.match(/type/i)!==null)}const $=20;function tt(t,e,r){const{filter:n,logger:o,enabled:a}=r;if(!a){const s="config.enabled must be true, don't call this function otherwise";throw o?.error?.(`[@sanity/client]: ${s}`,{result:t,resultSourceMap:e,config:r}),new TypeError(s)}if(!e)return o?.error?.("[@sanity/client]: Missing Content Source Map from response body",{result:t,resultSourceMap:e,config:r}),t;if(!r.studioUrl){const s="config.studioUrl must be defined";throw o?.error?.(`[@sanity/client]: ${s}`,{result:t,resultSourceMap:e,config:r}),new TypeError(s)}const i={encoded:[],skipped:[]},f=q(t,e,({sourcePath:s,sourceDocument:p,resultPath:d,value:c})=>{if((typeof n=="function"?n({sourcePath:s,resultPath:d,filterDefault:S,sourceDocument:p,value:c}):S({sourcePath:s,resultPath:d,value:c}))===!1)return o&&i.skipped.push({path:I(s),value:`${c.slice(0,$)}${c.length>$?"...":""}`,length:c.length}),c;o&&i.encoded.push({path:I(s),value:`${c.slice(0,$)}${c.length>$?"...":""}`,length:c.length});const{baseUrl:h,workspace:l,tool:y}=B(typeof r.studioUrl=="function"?r.studioUrl(p):r.studioUrl);if(!h)return c;const{_id:_,_type:w,_projectId:O,_dataset:D}=p;return L(c,{origin:"sanity.io",href:X({baseUrl:h,workspace:l,tool:y,id:_,type:w,path:s,...!r.omitCrossDatasetReferenceData&&{dataset:D,projectId:O}})},!1)});if(o){const s=i.skipped.length,p=i.encoded.length;if((s||p)&&((o?.groupCollapsed||o.log)?.("[@sanity/client]: Encoding source map into result"),o.log?.(`[@sanity/client]: Paths encoded: ${i.encoded.length}, skipped: ${i.skipped.length}`)),i.encoded.length>0&&(o?.log?.("[@sanity/client]: Table of encoded paths"),(o?.table||o.log)?.(i.encoded)),i.skipped.length>0){const d=new Set;for(const{path:c}of i.skipped)d.add(c.replace(j,"0").replace(/\[\d+\]/g,"[]"));o?.log?.("[@sanity/client]: List of skipped paths",[...d.values()])}(s||p)&&o?.groupEnd?.()}return f}function I(t){return x(A(t))}var rt=Object.freeze({__proto__:null,stegaEncodeSourceMap:tt});export{q as encodeIntoResult,tt as stegaEncodeSourceMap,rt as stegaEncodeSourceMap$1};
</file>

<file path="betternotes/dist/static/VideoPlayer-D_FmRSM7.js">
import{m as Ua,r as $a,d as zb,j as Qb}from"./sanity-z2y04qld.js";var Xb=Object.create,lv=Object.defineProperty,Zb=Object.getOwnPropertyDescriptor,Jb=Object.getOwnPropertyNames,e_=Object.getPrototypeOf,t_=Object.prototype.hasOwnProperty,dv=function(i,e){return function(){return i&&(e=i(i=0)),e}},wt=function(i,e){return function(){return e||i((e={exports:{}}).exports,e),e.exports}},i_=function(i,e,t,s){if(e&&typeof e=="object"||typeof e=="function")for(var r=Jb(e),n=0,a=r.length,o;n<a;n++)o=r[n],!t_.call(i,o)&&o!==t&&lv(i,o,{get:(function(l){return e[l]}).bind(null,o),enumerable:!(s=Zb(e,o))||s.enumerable});return i},qt=function(i,e,t){return t=i!=null?Xb(e_(i)):{},i_(!i||!i.__esModule?lv(t,"default",{value:i,enumerable:!0}):t,i)},Ei=wt(function(i,e){var t;typeof window<"u"?t=window:typeof global<"u"?t=global:typeof self<"u"?t=self:t={},e.exports=t});function Lr(i,e){return e!=null&&typeof Symbol<"u"&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](i):Lr(i,e)}var Rr=dv(function(){Rr()});function uv(i){"@swc/helpers - typeof";return i&&typeof Symbol<"u"&&i.constructor===Symbol?"symbol":typeof i}var cv=dv(function(){}),hv=wt(function(i,e){var t=Array.prototype.slice;e.exports=s;function s(r,n){for(("length"in r)||(r=[r]),r=t.call(r);r.length;){var a=r.shift(),o=n(a);if(o)return o;a.childNodes&&a.childNodes.length&&(r=t.call(a.childNodes).concat(r))}}}),s_=wt(function(i,e){Rr(),e.exports=t;function t(s,r){if(!Lr(this,t))return new t(s,r);this.data=s,this.nodeValue=s,this.length=s.length,this.ownerDocument=r||null}t.prototype.nodeType=8,t.prototype.nodeName="#comment",t.prototype.toString=function(){return"[object Comment]"}}),r_=wt(function(i,e){Rr(),e.exports=t;function t(s,r){if(!Lr(this,t))return new t(s);this.data=s||"",this.length=this.data.length,this.ownerDocument=r||null}t.prototype.type="DOMTextNode",t.prototype.nodeType=3,t.prototype.nodeName="#text",t.prototype.toString=function(){return this.data},t.prototype.replaceData=function(s,r,n){var a=this.data,o=a.substring(0,s),l=a.substring(s+r,a.length);this.data=o+n+l,this.length=this.data.length}}),fv=wt(function(i,e){e.exports=t;function t(s){var r=this,n=s.type;s.target||(s.target=r),r.listeners||(r.listeners={});var a=r.listeners[n];if(a)return a.forEach(function(o){s.currentTarget=r,typeof o=="function"?o(s):o.handleEvent(s)});r.parentNode&&r.parentNode.dispatchEvent(s)}}),mv=wt(function(i,e){e.exports=t;function t(s,r){var n=this;n.listeners||(n.listeners={}),n.listeners[s]||(n.listeners[s]=[]),n.listeners[s].indexOf(r)===-1&&n.listeners[s].push(r)}}),pv=wt(function(i,e){e.exports=t;function t(s,r){var n=this;if(n.listeners&&n.listeners[s]){var a=n.listeners[s],o=a.indexOf(r);o!==-1&&a.splice(o,1)}}}),n_=wt(function(i,e){cv(),e.exports=s;var t=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function s(h){switch(h.nodeType){case 3:return u(h.data);case 8:return"<!--"+h.data+"-->";default:return r(h)}}function r(h){var f=[],m=h.tagName;return h.namespaceURI==="http://www.w3.org/1999/xhtml"&&(m=m.toLowerCase()),f.push("<"+m+d(h)+o(h)),t.indexOf(m)>-1?f.push(" />"):(f.push(">"),h.childNodes.length?f.push.apply(f,h.childNodes.map(s)):h.textContent||h.innerText?f.push(u(h.textContent||h.innerText)):h.innerHTML&&f.push(h.innerHTML),f.push("</"+m+">")),f.join("")}function n(h,f){var m=uv(h[f]);return f==="style"&&Object.keys(h.style).length>0?!0:h.hasOwnProperty(f)&&(m==="string"||m==="boolean"||m==="number")&&f!=="nodeName"&&f!=="className"&&f!=="tagName"&&f!=="textContent"&&f!=="innerText"&&f!=="namespaceURI"&&f!=="innerHTML"}function a(h){if(typeof h=="string")return h;var f="";return Object.keys(h).forEach(function(m){var g=h[m];m=m.replace(/[A-Z]/g,function(p){return"-"+p.toLowerCase()}),f+=m+":"+g+";"}),f}function o(h){var f=h.dataset,m=[];for(var g in f)m.push({name:"data-"+g,value:f[g]});return m.length?l(m):""}function l(h){var f=[];return h.forEach(function(m){var g=m.name,p=m.value;g==="style"&&(p=a(p)),f.push(g+'="'+c(p)+'"')}),f.length?" "+f.join(" "):""}function d(h){var f=[];for(var m in h)n(h,m)&&f.push({name:m,value:h[m]});for(var g in h._attributes)for(var p in h._attributes[g]){var E=h._attributes[g][p],T=(E.prefix?E.prefix+":":"")+p;f.push({name:T,value:E.value})}return h.className&&f.push({name:"class",value:h.className}),f.length?l(f):""}function u(h){var f="";return typeof h=="string"?f=h:h&&(f=h.toString()),f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(h){return u(h).replace(/"/g,"&quot;")}}),gv=wt(function(i,e){Rr();var t=hv(),s=fv(),r=mv(),n=pv(),a=n_(),o="http://www.w3.org/1999/xhtml";e.exports=l;function l(d,u,c){if(!Lr(this,l))return new l(d);var h=c===void 0?o:c||null;this.tagName=h===o?String(d).toUpperCase():d,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=u||null,this.namespaceURI=h,this._attributes={},this.tagName==="INPUT"&&(this.type="text")}l.prototype.type="DOMElement",l.prototype.nodeType=1,l.prototype.appendChild=function(d){return d.parentNode&&d.parentNode.removeChild(d),this.childNodes.push(d),d.parentNode=this,d},l.prototype.replaceChild=function(d,u){d.parentNode&&d.parentNode.removeChild(d);var c=this.childNodes.indexOf(u);return u.parentNode=null,this.childNodes[c]=d,d.parentNode=this,u},l.prototype.removeChild=function(d){var u=this.childNodes.indexOf(d);return this.childNodes.splice(u,1),d.parentNode=null,d},l.prototype.insertBefore=function(d,u){d.parentNode&&d.parentNode.removeChild(d);var c=u==null?-1:this.childNodes.indexOf(u);return c>-1?this.childNodes.splice(c,0,d):this.childNodes.push(d),d.parentNode=this,d},l.prototype.setAttributeNS=function(d,u,c){var h=null,f=u,m=u.indexOf(":");if(m>-1&&(h=u.substr(0,m),f=u.substr(m+1)),this.tagName==="INPUT"&&u==="type")this.type=c;else{var g=this._attributes[d]||(this._attributes[d]={});g[f]={value:c,prefix:h}}},l.prototype.getAttributeNS=function(d,u){var c=this._attributes[d],h=c&&c[u]&&c[u].value;return this.tagName==="INPUT"&&u==="type"?this.type:typeof h!="string"?null:h},l.prototype.removeAttributeNS=function(d,u){var c=this._attributes[d];c&&delete c[u]},l.prototype.hasAttributeNS=function(d,u){var c=this._attributes[d];return!!c&&u in c},l.prototype.setAttribute=function(d,u){return this.setAttributeNS(null,d,u)},l.prototype.getAttribute=function(d){return this.getAttributeNS(null,d)},l.prototype.removeAttribute=function(d){return this.removeAttributeNS(null,d)},l.prototype.hasAttribute=function(d){return this.hasAttributeNS(null,d)},l.prototype.removeEventListener=n,l.prototype.addEventListener=r,l.prototype.dispatchEvent=s,l.prototype.focus=function(){},l.prototype.toString=function(){return a(this)},l.prototype.getElementsByClassName=function(d){var u=d.split(" "),c=[];return t(this,function(h){if(h.nodeType===1){var f=h.className||"",m=f.split(" ");u.every(function(g){return m.indexOf(g)!==-1})&&c.push(h)}}),c},l.prototype.getElementsByTagName=function(d){d=d.toLowerCase();var u=[];return t(this.childNodes,function(c){c.nodeType===1&&(d==="*"||c.tagName.toLowerCase()===d)&&u.push(c)}),u},l.prototype.contains=function(d){return t(this,function(u){return d===u})||!1}}),a_=wt(function(i,e){Rr();var t=gv();e.exports=s;function s(r){if(!Lr(this,s))return new s;this.childNodes=[],this.parentNode=null,this.ownerDocument=r||null}s.prototype.type="DocumentFragment",s.prototype.nodeType=11,s.prototype.nodeName="#document-fragment",s.prototype.appendChild=t.prototype.appendChild,s.prototype.replaceChild=t.prototype.replaceChild,s.prototype.removeChild=t.prototype.removeChild,s.prototype.toString=function(){return this.childNodes.map(function(r){return String(r)}).join("")}}),o_=wt(function(i,e){e.exports=t;function t(s){}t.prototype.initEvent=function(s,r,n){this.type=s,this.bubbles=r,this.cancelable=n},t.prototype.preventDefault=function(){}}),l_=wt(function(i,e){Rr();var t=hv(),s=s_(),r=r_(),n=gv(),a=a_(),o=o_(),l=fv(),d=mv(),u=pv();e.exports=c;function c(){if(!Lr(this,c))return new c;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var h=c.prototype;h.createTextNode=function(f){return new r(f,this)},h.createElementNS=function(f,m){var g=f===null?null:String(f);return new n(m,this,g)},h.createElement=function(f){return new n(f,this)},h.createDocumentFragment=function(){return new a(this)},h.createEvent=function(f){return new o(f)},h.createComment=function(f){return new s(f,this)},h.getElementById=function(f){f=String(f);var m=t(this.childNodes,function(g){if(String(g.id)===f)return g});return m||null},h.getElementsByClassName=n.prototype.getElementsByClassName,h.getElementsByTagName=n.prototype.getElementsByTagName,h.contains=n.prototype.contains,h.removeEventListener=u,h.addEventListener=d,h.dispatchEvent=l}),d_=wt(function(i,e){var t=l_();e.exports=new t}),vv=wt(function(i,e){var t=typeof global<"u"?global:typeof window<"u"?window:{},s=d_(),r;typeof document<"u"?r=document:(r=t["__GLOBAL_DOCUMENT_CACHE@4"],r||(r=t["__GLOBAL_DOCUMENT_CACHE@4"]=s)),e.exports=r});function u_(i){if(Array.isArray(i))return i}function c_(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var s=[],r=!0,n=!1,a,o;try{for(t=t.call(i);!(r=(a=t.next()).done)&&(s.push(a.value),!(e&&s.length===e));r=!0);}catch(l){n=!0,o=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(n)throw o}}return s}}function h_(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ac(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=i[t];return s}function Ev(i,e){if(i){if(typeof i=="string")return Ac(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ac(i,e)}}function hs(i,e){return u_(i)||c_(i,e)||Ev(i,e)||h_()}var Sa=qt(Ei()),op=qt(Ei()),f_=qt(Ei()),m_={now:function(){var i=f_.default.performance,e=i&&i.timing,t=e&&e.navigationStart,s=typeof t=="number"&&typeof i.now=="function"?t+i.now():Date.now();return Math.round(s)}},st=m_,Fa=function(){var i,e,t;if(typeof((i=op.default.crypto)===null||i===void 0?void 0:i.getRandomValues)=="function"){t=new Uint8Array(32),op.default.crypto.getRandomValues(t);for(var s=0;s<32;s++)t[s]=t[s]%16}else{t=[];for(var r=0;r<32;r++)t[r]=Math.random()*16|0}var n=0;e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){var d=l==="x"?t[n]:t[n]&3|8;return n++,d.toString(16)});var a=st.now(),o=a?.toString(16).substring(3);return o?e.substring(0,28)+o:e},yv=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},li=function(i){if(i&&typeof i.nodeName<"u")return i.muxId||(i.muxId=yv()),i.muxId;var e;try{e=document.querySelector(i)}catch{}return e&&!e.muxId&&(e.muxId=i),e?.muxId||i},fd=function(i){var e;i&&typeof i.nodeName<"u"?(e=i,i=li(e)):e=document.querySelector(i);var t=e&&e.nodeName?e.nodeName.toLowerCase():"";return[e,i,t]};function p_(i){if(Array.isArray(i))return Ac(i)}function g_(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function v_(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function di(i){return p_(i)||g_(i)||Ev(i)||v_()}var lr={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},E_=function(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,t,s,r,n,a,o=[console,i],l=(t=console.trace).bind.apply(t,di(o)),d=(s=console.info).bind.apply(s,di(o)),u=(r=console.debug).bind.apply(r,di(o)),c=(n=console.warn).bind.apply(n,di(o)),h=(a=console.error).bind.apply(a,di(o)),f=e;return{trace:function(){for(var m=arguments.length,g=new Array(m),p=0;p<m;p++)g[p]=arguments[p];if(!(f>lr.TRACE))return l.apply(void 0,di(g))},debug:function(){for(var m=arguments.length,g=new Array(m),p=0;p<m;p++)g[p]=arguments[p];if(!(f>lr.DEBUG))return u.apply(void 0,di(g))},info:function(){for(var m=arguments.length,g=new Array(m),p=0;p<m;p++)g[p]=arguments[p];if(!(f>lr.INFO))return d.apply(void 0,di(g))},warn:function(){for(var m=arguments.length,g=new Array(m),p=0;p<m;p++)g[p]=arguments[p];if(!(f>lr.WARN))return c.apply(void 0,di(g))},error:function(){for(var m=arguments.length,g=new Array(m),p=0;p<m;p++)g[p]=arguments[p];if(!(f>lr.ERROR))return h.apply(void 0,di(g))},get level(){return f},set level(m){m!==this.level&&(f=m??e)}}},Ce=E_("[mux]"),xu=qt(Ei());function Sc(){var i=xu.default.doNotTrack||xu.default.navigator&&xu.default.navigator.doNotTrack;return i==="1"}function ae(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}Rr();function mt(i,e){if(!Lr(i,e))throw new TypeError("Cannot call a class as a function")}function y_(i,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Xi(i,e,t){return e&&y_(i.prototype,e),i}function K(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xn(i){return xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xn(i)}function T_(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=xn(i),i!==null););return i}function Qo(i,e,t){return typeof Reflect<"u"&&Reflect.get?Qo=Reflect.get:Qo=function(s,r,n){var a=T_(s,r);if(a){var o=Object.getOwnPropertyDescriptor(a,r);return o.get?o.get.call(n||s):o.value}},Qo(i,e,t||i)}function Ic(i,e){return Ic=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t},Ic(i,e)}function b_(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Ic(i,e)}function __(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}cv();function A_(i,e){return e&&(uv(e)==="object"||typeof e=="function")?e:ae(i)}function S_(i){var e=__();return function(){var t=xn(i),s;if(e){var r=xn(this).constructor;s=Reflect.construct(t,arguments,r)}else s=t.apply(this,arguments);return A_(this,s)}}var pi=function(i){return Ba(i)[0]},Ba=function(i){if(typeof i!="string"||i==="")return["localhost"];var e=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,t=i.match(e)||[],s=t[4],r;return s&&(r=(s.match(/[^\.]+\.[^\.]+$/)||[])[0]),[s,r]},ku=qt(Ei()),I_={exists:function(){var i=ku.default.performance,e=i&&i.timing;return e!==void 0},domContentLoadedEventEnd:function(){var i=ku.default.performance,e=i&&i.timing;return e&&e.domContentLoadedEventEnd},navigationStart:function(){var i=ku.default.performance,e=i&&i.timing;return e&&e.navigationStart}},md=I_;function tt(i,e,t){t=t===void 0?1:t,i[e]=i[e]||0,i[e]+=t}function pd(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),s.forEach(function(r){K(i,r,t[r])})}return i}function L_(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);t.push.apply(t,s)}return t}function mf(i,e){return e=e??{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):L_(Object(e)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))}),i}var R_=["x-cdn","content-type"],Tv=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],x_=R_.concat(Tv);function pf(i){i=i||"";var e={},t=i.trim().split(/[\r\n]+/);return t.forEach(function(s){if(s){var r=s.split(": "),n=r.shift();n&&(x_.indexOf(n.toLowerCase())>=0||n.toLowerCase().indexOf("x-litix-")===0)&&(e[n]=r.join(": "))}}),e}function gd(i){if(i){var e=Tv.find(function(t){return i[t]!==void 0});return e?i[e]:void 0}}var k_=function(i){var e={};for(var t in i){var s=i[t],r=s["DATA-ID"].search("io.litix.data.");if(r!==-1){var n=s["DATA-ID"].replace("io.litix.data.","");e[n]=s.VALUE}}return e},bv=k_,go=function(i){if(!i)return{};var e=md.navigationStart(),t=i.loading,s=t?t.start:i.trequest,r=t?t.first:i.tfirst,n=t?t.end:i.tload;return{bytesLoaded:i.total,requestStart:Math.round(e+s),responseStart:Math.round(e+r),responseEnd:Math.round(e+n)}},Gn=function(i){if(!(!i||typeof i.getAllResponseHeaders!="function"))return pf(i.getAllResponseHeaders())},D_=function(i,e,t){var s=arguments.length>4?arguments[4]:void 0,r=i.log,n=i.utils.secondsToMs,a=function(p){var E=parseInt(s.version),T;return E===1&&p.programDateTime!==null&&(T=p.programDateTime),E===0&&p.pdt!==null&&(T=p.pdt),T};if(!md.exists()){r.warn("performance timing not supported. Not tracking HLS.js.");return}var o=function(p,E){return i.emit(e,p,E)},l=function(p,E){var T=E.levels,y=E.audioTracks,b=E.url,A=E.stats,L=E.networkDetails,S=E.sessionData,R={},x={};T.forEach(function(H,N){R[N]={width:H.width,height:H.height,bitrate:H.bitrate,attrs:H.attrs}}),y.forEach(function(H,N){x[N]={name:H.name,language:H.lang,bitrate:H.bitrate}});var I=go(A),M=I.bytesLoaded,$=I.requestStart,V=I.responseStart,q=I.responseEnd;o("requestcompleted",mf(pd({},bv(S)),{request_event_type:p,request_bytes_loaded:M,request_start:$,request_response_start:V,request_response_end:q,request_type:"manifest",request_hostname:pi(b),request_response_headers:Gn(L),request_rendition_lists:{media:R,audio:x,video:{}}}))};t.on(s.Events.MANIFEST_LOADED,l);var d=function(p,E){var T=E.details,y=E.level,b=E.networkDetails,A=E.stats,L=go(A),S=L.bytesLoaded,R=L.requestStart,x=L.responseStart,I=L.responseEnd,M=T.fragments[T.fragments.length-1],$=a(M)+n(M.duration);o("requestcompleted",{request_event_type:p,request_bytes_loaded:S,request_start:R,request_response_start:x,request_response_end:I,request_current_level:y,request_type:"manifest",request_hostname:pi(T.url),request_response_headers:Gn(b),video_holdback:T.holdBack&&n(T.holdBack),video_part_holdback:T.partHoldBack&&n(T.partHoldBack),video_part_target_duration:T.partTarget&&n(T.partTarget),video_target_duration:T.targetduration&&n(T.targetduration),video_source_is_live:T.live,player_manifest_newest_program_time:isNaN($)?void 0:$})};t.on(s.Events.LEVEL_LOADED,d);var u=function(p,E){var T=E.details,y=E.networkDetails,b=E.stats,A=go(b),L=A.bytesLoaded,S=A.requestStart,R=A.responseStart,x=A.responseEnd;o("requestcompleted",{request_event_type:p,request_bytes_loaded:L,request_start:S,request_response_start:R,request_response_end:x,request_type:"manifest",request_hostname:pi(T.url),request_response_headers:Gn(y)})};t.on(s.Events.AUDIO_TRACK_LOADED,u);var c=function(p,E){var T=E.stats,y=E.networkDetails,b=E.frag;T=T||b.stats;var A=go(T),L=A.bytesLoaded,S=A.requestStart,R=A.responseStart,x=A.responseEnd,I=y?Gn(y):void 0,M={request_event_type:p,request_bytes_loaded:L,request_start:S,request_response_start:R,request_response_end:x,request_hostname:y?pi(y.responseURL):void 0,request_id:I?gd(I):void 0,request_response_headers:I,request_media_duration:b.duration,request_url:y?.responseURL};b.type==="main"?(M.request_type="media",M.request_current_level=b.level,M.request_video_width=(t.levels[b.level]||{}).width,M.request_video_height=(t.levels[b.level]||{}).height,M.request_labeled_bitrate=(t.levels[b.level]||{}).bitrate):M.request_type=b.type,o("requestcompleted",M)};t.on(s.Events.FRAG_LOADED,c);var h=function(p,E){var T=E.frag,y=T.start,b=a(T),A={currentFragmentPDT:b,currentFragmentStart:n(y)};o("fragmentchange",A)};t.on(s.Events.FRAG_CHANGED,h);var f=function(p,E){var T=E.type,y=E.details,b=E.response,A=E.fatal,L=E.frag,S=E.networkDetails,R=L?.url||E.url||"",x=S?Gn(S):void 0;if((y===s.ErrorDetails.MANIFEST_LOAD_ERROR||y===s.ErrorDetails.MANIFEST_LOAD_TIMEOUT||y===s.ErrorDetails.FRAG_LOAD_ERROR||y===s.ErrorDetails.FRAG_LOAD_TIMEOUT||y===s.ErrorDetails.LEVEL_LOAD_ERROR||y===s.ErrorDetails.LEVEL_LOAD_TIMEOUT||y===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||y===s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT||y===s.ErrorDetails.SUBTITLE_LOAD_ERROR||y===s.ErrorDetails.SUBTITLE_LOAD_TIMEOUT||y===s.ErrorDetails.KEY_LOAD_ERROR||y===s.ErrorDetails.KEY_LOAD_TIMEOUT)&&o("requestfailed",{request_error:y,request_url:R,request_hostname:pi(R),request_id:x?gd(x):void 0,request_type:y===s.ErrorDetails.FRAG_LOAD_ERROR||y===s.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":y===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||y===s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":y===s.ErrorDetails.SUBTITLE_LOAD_ERROR||y===s.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":y===s.ErrorDetails.KEY_LOAD_ERROR||y===s.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:b?.code,request_error_text:b?.text}),A){var I,M="".concat(R?"url: ".concat(R,`
`):"")+"".concat(b&&(b.code||b.text)?"response: ".concat(b.code,", ").concat(b.text,`
`):"")+"".concat(E.reason?"failure reason: ".concat(E.reason,`
`):"")+"".concat(E.level?"level: ".concat(E.level,`
`):"")+"".concat(E.parent?"parent stream controller: ".concat(E.parent,`
`):"")+"".concat(E.buffer?"buffer length: ".concat(E.buffer,`
`):"")+"".concat(E.error?"error: ".concat(E.error,`
`):"")+"".concat(E.event?"event: ".concat(E.event,`
`):"")+"".concat(E.err?"error message: ".concat((I=E.err)===null||I===void 0?void 0:I.message,`
`):"");o("error",{player_error_code:T,player_error_message:y,player_error_context:M})}};t.on(s.Events.ERROR,f);var m=function(p,E){var T=E.frag,y=T&&T._url||"";o("requestcanceled",{request_event_type:p,request_url:y,request_type:"media",request_hostname:pi(y)})};t.on(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,m);var g=function(p,E){var T=E.level,y=t.levels[T];if(y&&y.attrs&&y.attrs.BANDWIDTH){var b=y.attrs.BANDWIDTH,A,L=parseFloat(y.attrs["FRAME-RATE"]);isNaN(L)||(A=L),b?o("renditionchange",{video_source_fps:A,video_source_bitrate:b,video_source_width:y.width,video_source_height:y.height,video_source_rendition_name:y.name,video_source_codec:y?.videoCodec}):r.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};t.on(s.Events.LEVEL_SWITCHED,g),t._stopMuxMonitor=function(){t.off(s.Events.MANIFEST_LOADED,l),t.off(s.Events.LEVEL_LOADED,d),t.off(s.Events.AUDIO_TRACK_LOADED,u),t.off(s.Events.FRAG_LOADED,c),t.off(s.Events.FRAG_CHANGED,h),t.off(s.Events.ERROR,f),t.off(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,m),t.off(s.Events.LEVEL_SWITCHED,g),t.off(s.Events.DESTROYING,t._stopMuxMonitor),delete t._stopMuxMonitor},t.on(s.Events.DESTROYING,t._stopMuxMonitor)},C_=function(i){i&&typeof i._stopMuxMonitor=="function"&&i._stopMuxMonitor()},lp=function(i,e){if(!i||!i.requestEndDate)return{};var t=pi(i.url),s=i.url,r=i.bytesLoaded,n=new Date(i.requestStartDate).getTime(),a=new Date(i.firstByteDate).getTime(),o=new Date(i.requestEndDate).getTime(),l=isNaN(i.duration)?0:i.duration,d=typeof e.getMetricsFor=="function"?e.getMetricsFor(i.mediaType).HttpList:e.getDashMetrics().getHttpRequests(i.mediaType),u;d.length>0&&(u=pf(d[d.length-1]._responseHeaders||""));var c=u?gd(u):void 0;return{requestStart:n,requestResponseStart:a,requestResponseEnd:o,requestBytesLoaded:r,requestResponseHeaders:u,requestMediaDuration:l,requestHostname:t,requestUrl:s,requestId:c}},w_=function(i,e){var t=e.getQualityFor(i),s=e.getCurrentTrackFor(i).bitrateList;return s?{currentLevel:t,renditionWidth:s[t].width||null,renditionHeight:s[t].height||null,renditionBitrate:s[t].bandwidth}:{}},M_=function(i){var e;return(e=i.match(/.*codecs\*?="(.*)"/))===null||e===void 0?void 0:e[1]},P_=function(i){try{var e,t,s=(t=i.getVersion)===null||t===void 0||(e=t.call(i))===null||e===void 0?void 0:e.split(".").map(function(r){return parseInt(r)})[0];return s}catch{return!1}},O_=function(i,e,t){var s=i.log;if(!t||!t.on){s.warn("Invalid dash.js player reference. Monitoring blocked.");return}var r=P_(t),n=function(T,y){return i.emit(e,T,y)},a=function(T){var y=T.type,b=T.data,A=(b||{}).url;n("requestcompleted",{request_event_type:y,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:pi(A),request_url:A})};t.on("manifestLoaded",a);var o={},l=function(T){if(typeof T.getRequests!="function")return null;var y=T.getRequests({state:"executed"});return y.length===0?null:y[y.length-1]},d=function(T){var y=T.type,b=T.fragmentModel,A=T.chunk,L=l(b);u({type:y,request:L,chunk:A})},u=function(T){var y=T.type,b=T.chunk,A=T.request,L=(b||{}).mediaInfo,S=L||{},R=S.type,x=S.bitrateList;x=x||[];var I={};x.forEach(function(ee,U){I[U]={},I[U].width=ee.width,I[U].height=ee.height,I[U].bitrate=ee.bandwidth,I[U].attrs={}}),R==="video"?o.video=I:R==="audio"?o.audio=I:o.media=I;var M=lp(A,t),$=M.requestStart,V=M.requestResponseStart,q=M.requestResponseEnd,H=M.requestResponseHeaders,N=M.requestMediaDuration,W=M.requestHostname,B=M.requestUrl,Y=M.requestId;n("requestcompleted",{request_event_type:y,request_start:$,request_response_start:V,request_response_end:q,request_bytes_loaded:-1,request_type:R+"_init",request_response_headers:H,request_hostname:W,request_id:Y,request_url:B,request_media_duration:N,request_rendition_lists:o})};r>=4?t.on("initFragmentLoaded",u):t.on("initFragmentLoaded",d);var c=function(T){var y=T.type,b=T.fragmentModel,A=T.chunk,L=l(b);h({type:y,request:L,chunk:A})},h=function(T){var y=T.type,b=T.chunk,A=T.request,L=b||{},S=L.mediaInfo,R=L.start,x=S||{},I=x.type,M=lp(A,t),$=M.requestStart,V=M.requestResponseStart,q=M.requestResponseEnd,H=M.requestBytesLoaded,N=M.requestResponseHeaders,W=M.requestMediaDuration,B=M.requestHostname,Y=M.requestUrl,ee=M.requestId,U=w_(I,t),F=U.currentLevel,ne=U.renditionWidth,pe=U.renditionHeight,de=U.renditionBitrate;n("requestcompleted",{request_event_type:y,request_start:$,request_response_start:V,request_response_end:q,request_bytes_loaded:H,request_type:I,request_response_headers:N,request_hostname:B,request_id:ee,request_url:Y,request_media_start_time:R,request_media_duration:W,request_current_level:F,request_labeled_bitrate:de,request_video_width:ne,request_video_height:pe})};r>=4?t.on("mediaFragmentLoaded",h):t.on("mediaFragmentLoaded",c);var f={video:void 0,audio:void 0,totalBitrate:void 0},m=function(){if(f.video&&typeof f.video.bitrate=="number"){if(!(f.video.width&&f.video.height)){s.warn("have bitrate info for video but missing width/height");return}var T=f.video.bitrate;if(f.audio&&typeof f.audio.bitrate=="number"&&(T+=f.audio.bitrate),T!==f.totalBitrate)return f.totalBitrate=T,{video_source_bitrate:T,video_source_height:f.video.height,video_source_width:f.video.width,video_source_codec:M_(f.video.codec)}}},g=function(T,y,b){if(typeof T.newQuality!="number"){s.warn("missing evt.newQuality in qualityChangeRendered event",T);return}var A=T.mediaType;if(A==="audio"||A==="video"){var L=t.getBitrateInfoListFor(A).find(function(R){var x=R.qualityIndex;return x===T.newQuality});if(!(L&&typeof L.bitrate=="number")){s.warn("missing bitrate info for ".concat(A));return}f[A]=mf(pd({},L),{codec:t.getCurrentTrackFor(A).codec});var S=m();S&&n("renditionchange",S)}};t.on("qualityChangeRendered",g);var p=function(T){var y=T.request,b=T.mediaType;y=y||{},n("requestcanceled",{request_event_type:y.type+"_"+y.action,request_url:y.url,request_type:b,request_hostname:pi(y.url)})};t.on("fragmentLoadingAbandoned",p);var E=function(T){var y=T.error,b,A,L=(y==null||(b=y.data)===null||b===void 0?void 0:b.request)||{},S=(y==null||(A=y.data)===null||A===void 0?void 0:A.response)||{};y?.code===27&&n("requestfailed",{request_error:L.type+"_"+L.action,request_url:L.url,request_hostname:pi(L.url),request_type:L.mediaType,request_error_code:S.status,request_error_text:S.statusText});var R="".concat(L!=null&&L.url?"url: ".concat(L.url,`
`):"")+"".concat(S!=null&&S.status||S!=null&&S.statusText?"response: ".concat(S?.status,", ").concat(S?.statusText,`
`):"");n("error",{player_error_code:y?.code,player_error_message:y?.message,player_error_context:R})};t.on("error",E),t._stopMuxMonitor=function(){t.off("manifestLoaded",a),t.off("initFragmentLoaded",u),t.off("mediaFragmentLoaded",h),t.off("qualityChangeRendered",g),t.off("error",E),t.off("fragmentLoadingAbandoned",p),delete t._stopMuxMonitor}},N_=function(i){i&&typeof i._stopMuxMonitor=="function"&&i._stopMuxMonitor()},dp=0,U_=(function(){function i(){mt(this,i),K(this,"_listeners",void 0)}return Xi(i,[{key:"on",value:function(e,t,s){return t._eventEmitterGuid=t._eventEmitterGuid||++dp,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],s&&(t=t.bind(s)),this._listeners[e].push(t),t}},{key:"off",value:function(e,t){var s=this._listeners&&this._listeners[e];s&&s.forEach(function(r,n){r._eventEmitterGuid===t._eventEmitterGuid&&s.splice(n,1)})}},{key:"one",value:function(e,t,s){var r=this;t._eventEmitterGuid=t._eventEmitterGuid||++dp;var n=function(){r.off(e,n),t.apply(s||this,arguments)};n._eventEmitterGuid=t._eventEmitterGuid,this.on(e,n)}},{key:"emit",value:function(e,t){var s=this;if(this._listeners){t=t||{};var r=this._listeners["before*"]||[],n=this._listeners[e]||[],a=this._listeners["after"+e]||[],o=function(l,d){l=l.slice(),l.forEach(function(u){u.call(s,{type:e},d)})};o(r,t),o(n,t),o(a,t)}}}]),i})(),$_=U_,Du=qt(Ei()),F_=(function(){function i(e){var t=this;mt(this,i),K(this,"_playbackHeartbeatInterval",void 0),K(this,"_playheadShouldBeProgressing",void 0),K(this,"pm",void 0),this.pm=e,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,e.on("playing",function(){t._playheadShouldBeProgressing=!0}),e.on("play",this._startPlaybackHeartbeatInterval.bind(this)),e.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),e.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),e.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),e.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),e.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),e.on("seeked",function(){e.data.player_is_paused?t._stopPlaybackHeartbeatInterval():t._startPlaybackHeartbeatInterval()}),e.on("timeupdate",function(){t._playbackHeartbeatInterval!==null&&e.emit("playbackheartbeat")}),e.on("devicesleep",function(s,r){t._playbackHeartbeatInterval!==null&&(Du.default.clearInterval(t._playbackHeartbeatInterval),e.emit("playbackheartbeatend",{viewer_time:r.viewer_time}),t._playbackHeartbeatInterval=null)})}return Xi(i,[{key:"_startPlaybackHeartbeatInterval",value:function(){var e=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=Du.default.setInterval(function(){e.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(Du.default.clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}]),i})(),B_=F_,H_=function i(e){var t=this;mt(this,i),K(this,"viewErrored",void 0),e.on("viewinit",function(){t.viewErrored=!1}),e.on("error",function(s,r){try{var n=e.errorTranslator({player_error_code:r.player_error_code,player_error_message:r.player_error_message,player_error_context:r.player_error_context,player_error_severity:r.player_error_severity,player_error_business_exception:r.player_error_business_exception});n&&(e.data.player_error_code=n.player_error_code||r.player_error_code,e.data.player_error_message=n.player_error_message||r.player_error_message,e.data.player_error_context=n.player_error_context||r.player_error_context,e.data.player_error_severity=n.player_error_severity||r.player_error_severity,e.data.player_error_business_exception=n.player_error_business_exception||r.player_error_business_exception,t.viewErrored=!0)}catch(a){e.mux.log.warn("Exception in error translator callback.",a),t.viewErrored=!0}}),e.on("aftererror",function(){var s,r,n,a,o;(s=e.data)===null||s===void 0||delete s.player_error_code,(r=e.data)===null||r===void 0||delete r.player_error_message,(n=e.data)===null||n===void 0||delete n.player_error_context,(a=e.data)===null||a===void 0||delete a.player_error_severity,(o=e.data)===null||o===void 0||delete o.player_error_business_exception})},G_=H_,K_=(function(){function i(e){mt(this,i),K(this,"_watchTimeTrackerLastCheckedTime",void 0),K(this,"pm",void 0),this.pm=e,this._watchTimeTrackerLastCheckedTime=null,e.on("playbackheartbeat",this._updateWatchTime.bind(this)),e.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}return Xi(i,[{key:"_updateWatchTime",value:function(e,t){var s=t.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=s),tt(this.pm.data,"view_watch_time",s-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=s}},{key:"_clearWatchTimeState",value:function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null}}]),i})(),V_=K_,W_=(function(){function i(e){var t=this;mt(this,i),K(this,"_playbackTimeTrackerLastPlayheadPosition",void 0),K(this,"_lastTime",void 0),K(this,"_isAdPlaying",void 0),K(this,"_callbackUpdatePlaybackTime",void 0),K(this,"pm",void 0),this.pm=e,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=st.now(),this._isAdPlaying=!1,this._callbackUpdatePlaybackTime=null;var s=this._startPlaybackTimeTracking.bind(this);e.on("playing",s),e.on("adplaying",s),e.on("seeked",s);var r=this._stopPlaybackTimeTracking.bind(this);e.on("playbackheartbeatend",r),e.on("seeking",r),e.on("adplaying",function(){t._isAdPlaying=!0}),e.on("adended",function(){t._isAdPlaying=!1}),e.on("adpause",function(){t._isAdPlaying=!1}),e.on("adbreakstart",function(){t._isAdPlaying=!1}),e.on("adbreakend",function(){t._isAdPlaying=!1}),e.on("adplay",function(){t._isAdPlaying=!1}),e.on("viewinit",function(){t._playbackTimeTrackerLastPlayheadPosition=-1,t._lastTime=st.now(),t._isAdPlaying=!1,t._callbackUpdatePlaybackTime=null})}return Xi(i,[{key:"_startPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime===null&&(this._callbackUpdatePlaybackTime=this._updatePlaybackTime.bind(this),this._playbackTimeTrackerLastPlayheadPosition=this.pm.data.player_playhead_time,this.pm.on("playbackheartbeat",this._callbackUpdatePlaybackTime))}},{key:"_stopPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime&&(this._updatePlaybackTime(),this.pm.off("playbackheartbeat",this._callbackUpdatePlaybackTime),this._callbackUpdatePlaybackTime=null,this._playbackTimeTrackerLastPlayheadPosition=-1)}},{key:"_updatePlaybackTime",value:function(){var e=this.pm.data.player_playhead_time,t=st.now(),s=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition?s=e-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(s=t-this._lastTime),s>0&&s<=1e3&&tt(this.pm.data,"view_content_playback_time",s),this._playbackTimeTrackerLastPlayheadPosition=e,this._lastTime=t}}]),i})(),q_=W_,Y_=(function(){function i(e){mt(this,i),K(this,"pm",void 0),this.pm=e;var t=this._updatePlayheadTime.bind(this);e.on("playbackheartbeat",t),e.on("playbackheartbeatend",t),e.on("timeupdate",t),e.on("destroy",function(){e.off("timeupdate",t)})}return Xi(i,[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=typeof this.pm.data.view_max_playhead_position>"u"?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(e,t){var s=this,r=function(){s.pm.currentFragmentPDT&&s.pm.currentFragmentStart&&(s.pm.data.player_program_time=s.pm.currentFragmentPDT+s.pm.data.player_playhead_time-s.pm.currentFragmentStart)};if(t&&t.player_playhead_time)this.pm.data.player_playhead_time=t.player_playhead_time,r(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var n=this.pm.getPlayheadTime();typeof n<"u"&&(this.pm.data.player_playhead_time=n,r(),this._updateMaxPlayheadPosition())}}}]),i})(),j_=Y_,up=300*1e3,z_=function i(e){if(mt(this,i),!e.disableRebufferTracking){var t,s=function(n,a){r(a),t=void 0},r=function(n){if(t){var a=n.viewer_time-t;tt(e.data,"view_rebuffer_duration",a),t=n.viewer_time,e.data.view_rebuffer_duration>up&&(e.emit("viewend"),e.send("viewend"),e.mux.log.warn("Ending view after rebuffering for longer than ".concat(up,"ms, future events will be ignored unless a programchange or videochange occurs.")))}e.data.view_watch_time>=0&&e.data.view_rebuffer_count>0&&(e.data.view_rebuffer_frequency=e.data.view_rebuffer_count/e.data.view_watch_time,e.data.view_rebuffer_percentage=e.data.view_rebuffer_duration/e.data.view_watch_time)};e.on("playbackheartbeat",function(n,a){return r(a)}),e.on("rebufferstart",function(n,a){t||(tt(e.data,"view_rebuffer_count",1),t=a.viewer_time,e.one("rebufferend",s))}),e.on("viewinit",function(){t=void 0,e.off("rebufferend",s)})}},Q_=z_,X_=(function(){function i(e){var t=this;mt(this,i),K(this,"_lastCheckedTime",void 0),K(this,"_lastPlayheadTime",void 0),K(this,"_lastPlayheadTimeUpdatedTime",void 0),K(this,"_rebuffering",void 0),K(this,"pm",void 0),this.pm=e,!(e.disableRebufferTracking||e.disablePlayheadRebufferTracking)&&(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,e.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),e.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),e.on("seeking",function(){t._cleanupRebufferTracker(null,{viewer_time:st.now()})}))}return Xi(i,[{key:"_checkIfRebuffering",value:function(e,t){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing){this._cleanupRebufferTracker(e,t);return}if(this._lastCheckedTime===null){this._prepareRebufferTrackerState(t.viewer_time);return}if(this._lastPlayheadTime!==this.pm.data.player_playhead_time){this._cleanupRebufferTracker(e,t,!0);return}var s=t.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&s>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=t.viewer_time}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e}},{key:"_cleanupRebufferTracker",value:function(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:t.viewer_time});else{if(this._lastCheckedTime===null)return;var r=this.pm.data.player_playhead_time-this._lastPlayheadTime,n=t.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&r>0&&n-r>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+n-r}))}s?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}}]),i})(),Z_=X_,J_=(function(){function i(e){var t=this;mt(this,i),K(this,"NAVIGATION_START",void 0),K(this,"pm",void 0),this.pm=e,e.on("viewinit",function(){var s=e.data,r=s.view_id;if(!s.view_program_changed){var n=function(a,o){var l=o.viewer_time;(a.type==="playing"&&typeof e.data.view_time_to_first_frame>"u"||a.type==="adplaying"&&(typeof e.data.view_time_to_first_frame>"u"||t._inPrerollPosition()))&&t.calculateTimeToFirstFrame(l||st.now(),r)};e.one("playing",n),e.one("adplaying",n),e.one("viewend",function(){e.off("playing",n),e.off("adplaying",n)})}})}return Xi(i,[{key:"_inPrerollPosition",value:function(){return typeof this.pm.data.view_content_playback_time>"u"||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(e,t){t===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:e}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}]),i})(),eA=J_,tA=function i(e){var t=this;mt(this,i),K(this,"_lastPlayerHeight",void 0),K(this,"_lastPlayerWidth",void 0),K(this,"_lastPlayheadPosition",void 0),K(this,"_lastSourceHeight",void 0),K(this,"_lastSourceWidth",void 0),e.on("viewinit",function(){t._lastPlayheadPosition=-1});var s=["pause","rebufferstart","seeking","error","adbreakstart","hb","renditionchange","orientationchange","viewend"],r=["playing","hb","renditionchange","orientationchange"];s.forEach(function(n){e.on(n,function(){if(t._lastPlayheadPosition>=0&&e.data.player_playhead_time>=0&&t._lastPlayerWidth>=0&&t._lastSourceWidth>0&&t._lastPlayerHeight>=0&&t._lastSourceHeight>0){var a=e.data.player_playhead_time-t._lastPlayheadPosition;if(a<0){t._lastPlayheadPosition=-1;return}var o=Math.min(t._lastPlayerWidth/t._lastSourceWidth,t._lastPlayerHeight/t._lastSourceHeight),l=Math.max(0,o-1),d=Math.max(0,1-o);e.data.view_max_upscale_percentage=Math.max(e.data.view_max_upscale_percentage||0,l),e.data.view_max_downscale_percentage=Math.max(e.data.view_max_downscale_percentage||0,d),tt(e.data,"view_total_content_playback_time",a),tt(e.data,"view_total_upscaling",l*a),tt(e.data,"view_total_downscaling",d*a)}t._lastPlayheadPosition=-1})}),r.forEach(function(n){e.on(n,function(){t._lastPlayheadPosition=e.data.player_playhead_time,t._lastPlayerWidth=e.data.player_width,t._lastPlayerHeight=e.data.player_height,t._lastSourceWidth=e.data.video_source_width,t._lastSourceHeight=e.data.video_source_height})})},iA=tA,sA=2e3,rA=function i(e){var t=this;mt(this,i),K(this,"isSeeking",void 0),this.isSeeking=!1;var s=-1,r=function(){var n=st.now(),a=(e.data.viewer_time||n)-(s||n);tt(e.data,"view_seek_duration",a),e.data.view_max_seek_time=Math.max(e.data.view_max_seek_time||0,a),t.isSeeking=!1,s=-1};e.on("seeking",function(n,a){if(Object.assign(e.data,a),t.isSeeking&&a.viewer_time-s<=sA){s=a.viewer_time;return}t.isSeeking&&r(),t.isSeeking=!0,s=a.viewer_time,tt(e.data,"view_seek_count",1),e.send("seeking")}),e.on("seeked",function(){r()}),e.on("viewend",function(){t.isSeeking&&(r(),e.send("seeked")),t.isSeeking=!1,s=-1})},nA=rA,cp=function(i,e){i.push(e),i.sort(function(t,s){return t.viewer_time-s.viewer_time})},aA=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror","adclicked","adskipped"],oA=(function(){function i(e){var t=this;mt(this,i),K(this,"_adHasPlayed",void 0),K(this,"_adRequests",void 0),K(this,"_adResponses",void 0),K(this,"_currentAdRequestNumber",void 0),K(this,"_currentAdResponseNumber",void 0),K(this,"_prerollPlayTime",void 0),K(this,"_wouldBeNewAdPlay",void 0),K(this,"isAdBreak",void 0),K(this,"pm",void 0),this.pm=e,e.on("viewinit",function(){t.isAdBreak=!1,t._currentAdRequestNumber=0,t._currentAdResponseNumber=0,t._adRequests=[],t._adResponses=[],t._adHasPlayed=!1,t._wouldBeNewAdPlay=!0,t._prerollPlayTime=void 0}),aA.forEach(function(r){return e.on(r,t._updateAdData.bind(t))});var s=function(){t.isAdBreak=!1};e.on("adbreakstart",function(){t.isAdBreak=!0}),e.on("play",s),e.on("playing",s),e.on("viewend",s),e.on("adrequest",function(r,n){n=Object.assign({ad_request_id:"generatedAdRequestId"+t._currentAdRequestNumber++},n),cp(t._adRequests,n),tt(e.data,"view_ad_request_count"),t.inPrerollPosition()&&(e.data.view_preroll_requested=!0,t._adHasPlayed||tt(e.data,"view_preroll_request_count"))}),e.on("adresponse",function(r,n){n=Object.assign({ad_request_id:"generatedAdRequestId"+t._currentAdResponseNumber++},n),cp(t._adResponses,n);var a=t.findAdRequest(n.ad_request_id);a&&tt(e.data,"view_ad_request_time",Math.max(0,n.viewer_time-a.viewer_time))}),e.on("adplay",function(r,n){t._adHasPlayed=!0,t._wouldBeNewAdPlay&&(t._wouldBeNewAdPlay=!1,tt(e.data,"view_ad_played_count")),t.inPrerollPosition()&&!e.data.view_preroll_played&&(e.data.view_preroll_played=!0,t._adRequests.length>0&&(e.data.view_preroll_request_time=Math.max(0,n.viewer_time-t._adRequests[0].viewer_time)),e.data.view_start&&(e.data.view_startup_preroll_request_time=Math.max(0,n.viewer_time-e.data.view_start)),t._prerollPlayTime=n.viewer_time)}),e.on("adplaying",function(r,n){t.inPrerollPosition()&&typeof e.data.view_preroll_load_time>"u"&&typeof t._prerollPlayTime<"u"&&(e.data.view_preroll_load_time=n.viewer_time-t._prerollPlayTime,e.data.view_startup_preroll_load_time=n.viewer_time-t._prerollPlayTime)}),e.on("adclicked",function(r,n){t._wouldBeNewAdPlay||tt(e.data,"view_ad_clicked_count")}),e.on("adskipped",function(r,n){t._wouldBeNewAdPlay||tt(e.data,"view_ad_skipped_count")}),e.on("adended",function(){t._wouldBeNewAdPlay=!0}),e.on("aderror",function(){t._wouldBeNewAdPlay=!0})}return Xi(i,[{key:"inPrerollPosition",value:function(){return typeof this.pm.data.view_content_playback_time>"u"||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]}},{key:"_updateAdData",value:function(e,t){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var s=hs(Ba(t.ad_tag_url),2),r=s[0],n=s[1];this.pm.data.view_preroll_ad_tag_domain=n,this.pm.data.view_preroll_ad_tag_hostname=r}if(!this.pm.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var a=hs(Ba(t.ad_asset_url),2),o=a[0],l=a[1];this.pm.data.view_preroll_ad_asset_domain=l,this.pm.data.view_preroll_ad_asset_hostname=o}}this.pm.data.ad_asset_url=t?.ad_asset_url,this.pm.data.ad_tag_url=t?.ad_tag_url,this.pm.data.ad_creative_id=t?.ad_creative_id,this.pm.data.ad_id=t?.ad_id,this.pm.data.ad_universal_id=t?.ad_universal_id}}]),i})(),lA=oA,hp=qt(Ei()),dA=function i(e){mt(this,i);var t,s,r=function(){e.disableRebufferTracking||(tt(e.data,"view_waiting_rebuffer_count",1),t=st.now(),s=hp.default.setInterval(function(){if(t){var d=st.now();tt(e.data,"view_waiting_rebuffer_duration",d-t),t=d}},250))},n=function(){e.disableRebufferTracking||t&&(tt(e.data,"view_waiting_rebuffer_duration",st.now()-t),t=!1,hp.default.clearInterval(s))},a=!1,o=function(){a=!0},l=function(){a=!1,n()};e.on("waiting",function(){a&&r()}),e.on("playing",function(){n(),o()}),e.on("pause",l),e.on("seeking",l)},uA=dA,cA=function i(e){var t=this;mt(this,i),K(this,"lastWallClockTime",void 0);var s=function(){t.lastWallClockTime=st.now(),e.on("before*",r)},r=function(n){var a=st.now(),o=t.lastWallClockTime;t.lastWallClockTime=a,a-o>3e4&&(e.emit("devicesleep",{viewer_time:o}),Object.assign(e.data,{viewer_time:o}),e.send("devicesleep"),e.emit("devicewake",{viewer_time:a}),Object.assign(e.data,{viewer_time:a}),e.send("devicewake"))};e.one("playbackheartbeat",s),e.on("playbackheartbeatend",function(){e.off("before*",r),e.one("playbackheartbeat",s)})},hA=cA,Cu=qt(Ei()),_v=(function(i){return i()})(function(){var i=function(){for(var t=0,s={};t<arguments.length;t++){var r=arguments[t];for(var n in r)s[n]=r[n]}return s};function e(t){function s(r,n,a){var o;if(typeof document<"u"){if(arguments.length>1){if(a=i({path:"/"},s.defaults,a),typeof a.expires=="number"){var l=new Date;l.setMilliseconds(l.getMilliseconds()+a.expires*864e5),a.expires=l}try{o=JSON.stringify(n),/^[\{\[]/.test(o)&&(n=o)}catch{}return t.write?n=t.write(n,r):n=encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),r=encodeURIComponent(String(r)),r=r.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),r=r.replace(/[\(\)]/g,escape),document.cookie=[r,"=",n,a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}r||(o={});for(var d=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,c=0;c<d.length;c++){var h=d[c].split("="),f=h.slice(1).join("=");f.charAt(0)==='"'&&(f=f.slice(1,-1));try{var m=h[0].replace(u,decodeURIComponent);if(f=t.read?t.read(f,m):t(f,m)||f.replace(u,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch{}if(r===m){o=f;break}r||(o[m]=f)}catch{}}return o}}return s.set=s,s.get=function(r){return s.call(s,r)},s.getJSON=function(){return s.apply({json:!0},[].slice.call(arguments))},s.defaults={},s.remove=function(r,n){s(r,"",i(n,{expires:-1}))},s.withConverter=e,s}return e(function(){})}),Av="muxData",fA=function(i){return Object.entries(i).map(function(e){var t=hs(e,2),s=t[0],r=t[1];return"".concat(s,"=").concat(r)}).join("&")},mA=function(i){return i.split("&").reduce(function(e,t){var s=hs(t.split("="),2),r=s[0],n=s[1],a=+n,o=n&&a==n?a:n;return e[r]=o,e},{})},Sv=function(){var i;try{i=mA(_v.get(Av)||"")}catch{i={}}return i},Iv=function(i){try{_v.set(Av,fA(i),{expires:365})}catch{}},pA=function(){var i=Sv();return i.mux_viewer_id=i.mux_viewer_id||Fa(),i.msn=i.msn||Math.random(),Iv(i),{mux_viewer_id:i.mux_viewer_id,mux_sample_number:i.msn}},gA=function(){var i=Sv(),e=st.now();return i.session_start&&(i.sst=i.session_start,delete i.session_start),i.session_id&&(i.sid=i.session_id,delete i.session_id),i.session_expires&&(i.sex=i.session_expires,delete i.session_expires),(!i.sex||i.sex<e)&&(i.sid=Fa(),i.sst=e),i.sex=e+1500*1e3,Iv(i),{session_id:i.sid,session_start:i.sst,session_expires:i.sex}};function vA(i,e){var t=e.beaconCollectionDomain,s=e.beaconDomain;if(t)return"https://"+t;i=i||"inferred";var r=s||"litix.io";return i.match(/^[a-z0-9]+$/)?"https://"+i+"."+r:"https://img.litix.io/a.gif"}var EA=qt(Ei()),Lv=function(){var i;switch(Rv()){case"cellular":i="cellular";break;case"ethernet":i="wired";break;case"wifi":i="wifi";break;case void 0:break;default:i="other"}return i},Rv=function(){var i=EA.default.navigator,e=i&&(i.connection||i.mozConnection||i.webkitConnection);return e&&e.type};Lv.getConnectionFromAPI=Rv;var yA=Lv,TA={a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"},bA=xv(TA),_A={ad:"ad",af:"affiliate",ag:"aggregate",ap:"api",al:"application",ao:"audio",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",bn:"brand",br:"break",bw:"browser",by:"bytes",bz:"business",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",ci:"client",ck:"clicked",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cq:"creator",cr:"creative",cs:"captions",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",dy:"dynamic",eb:"enabled",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",ep:"experiments",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ez:"exception",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",or:"origin",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pp:"pip",pr:"preload",ps:"position",pt:"part",py:"property",px:"pop",pz:"plan",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rg:"range",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",sd:"skipped",se:"session",sh:"shift",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",ss:"status",st:"start",su:"startup",sv:"server",sw:"software",sy:"severity",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"},fp=xv(_A);function xv(i){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[i[t]]=t);return e}function Lc(i){var e={},t={};return Object.keys(i).forEach(function(s){var r=!1;if(i.hasOwnProperty(s)&&i[s]!==void 0){var n=s.split("_"),a=n[0],o=bA[a];o||(Ce.info("Data key word `"+n[0]+"` not expected in "+s),o=a+"_"),n.splice(1).forEach(function(l){l==="url"&&(r=!0),fp[l]?o+=fp[l]:Number.isInteger(Number(l))?o+=l:(Ce.info("Data key word `"+l+"` not expected in "+s),o+="_"+l+"_")}),r?t[o]=i[s]:e[o]=i[s]}}),Object.assign(e,t)}var ur=qt(Ei()),AA=qt(vv()),SA={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},IA=56*1024,LA=["hb","requestcompleted","requestfailed","requestcanceled"],RA="https://img.litix.io",ms=function(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._beaconUrl=i||RA,this._eventQueue=[],this._postInFlight=!1,this._resendAfterPost=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},SA,e)};ms.prototype.queueEvent=function(i,e){var t=Object.assign({},e);return this._eventQueue.length<=this._options.maxQueueLength||i==="eventrateexceeded"?(this._eventQueue.push(t),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):!1};ms.prototype.flushEvents=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(i&&this._eventQueue.length===1){this._eventQueue.pop();return}this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()};ms.prototype.destroy=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.destroyed=!0,i?this._clearBeaconQueue():this.flushEvents(),ur.default.clearTimeout(this._sendTimeout)};ms.prototype._clearBeaconQueue=function(){var i=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,e=this._eventQueue.slice(i);i>0&&Object.assign(e[e.length-1],Lc({mux_view_message:"event queue truncated"}));var t=this._createPayload(e);kv(this._beaconUrl,t,!0,function(){})};ms.prototype._sendBeaconQueue=function(){var i=this;if(this._postInFlight){this._resendAfterPost=!0;return}var e=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var t=this._createPayload(e),s=st.now();kv(this._beaconUrl,t,!1,function(r,n){n?(i._eventQueue=e.concat(i._eventQueue),i._failureCount+=1,Ce.info("Error sending beacon: "+n)):i._failureCount=0,i._roundTripTime=st.now()-s,i._postInFlight=!1,i._resendAfterPost&&(i._resendAfterPost=!1,i._eventQueue.length>0&&i._sendBeaconQueue())})};ms.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var i=Math.pow(2,this._failureCount-1);return i=i*Math.random(),(1+i)*this._options.baseTimeBetweenBeacons};ms.prototype._startBeaconSending=function(){var i=this;ur.default.clearTimeout(this._sendTimeout),!this.destroyed&&(this._sendTimeout=ur.default.setTimeout(function(){i._eventQueue.length&&i._sendBeaconQueue(),i._startBeaconSending()},this._getNextBeaconTime()))};ms.prototype._createPayload=function(i){var e=this,t={transmission_timestamp:Math.round(st.now())};this._roundTripTime&&(t.rtt_ms=Math.round(this._roundTripTime));var s,r,n,a=function(){s=JSON.stringify({metadata:t,events:r||i}),n=s.length/1024},o=function(){return n<=e._options.maxPayloadKBSize};return a(),o()||(Ce.info("Payload size is too big ("+n+" kb). Removing unnecessary events."),r=i.filter(function(l){return LA.indexOf(l.e)===-1}),a()),o()||(Ce.info("Payload size still too big ("+n+" kb). Cropping fields.."),r.forEach(function(l){for(var d in l){var u=l[d],c=50*1024;typeof u=="string"&&u.length>c&&(l[d]=u.substring(0,c))}}),a()),s};var xA=typeof AA.default.exitPictureInPicture=="function"?function(i){return i.length<=IA}:function(i){return!1},kv=function(i,e,t,s){if(t&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(i,e)){s();return}if(ur.default.fetch){ur.default.fetch(i,{method:"POST",body:e,headers:{"Content-Type":"text/plain"},keepalive:xA(e)}).then(function(n){return s(null,n.ok?null:"Error")}).catch(function(n){return s(null,n)});return}if(ur.default.XMLHttpRequest){var r=new ur.default.XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4)return s(null,r.status!==200?"error":void 0)},r.open("POST",i),r.setRequestHeader("Content-Type","text/plain"),r.send(e);return}s()},kA=ms,DA=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id","player_error_code","player_error_message","player_error_context","player_error_severity","player_error_business_exception"],CA=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],wA=["ad_id","ad_creative_id","ad_universal_id"],MA=["viewstart","error","ended","viewend"],PA=600*1e3,OA=(function(){function i(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};mt(this,i);var r,n,a,o,l,d,u,c,h,f,m,g;K(this,"mux",void 0),K(this,"envKey",void 0),K(this,"options",void 0),K(this,"eventQueue",void 0),K(this,"sampleRate",void 0),K(this,"disableCookies",void 0),K(this,"respectDoNotTrack",void 0),K(this,"previousBeaconData",void 0),K(this,"lastEventTime",void 0),K(this,"rateLimited",void 0),K(this,"pageLevelData",void 0),K(this,"viewerData",void 0),this.mux=e,this.envKey=t,this.options=s,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.eventQueue=new kA(vA(this.envKey,this.options));var p;this.sampleRate=(p=this.options.sampleRate)!==null&&p!==void 0?p:1;var E;this.disableCookies=(E=this.options.disableCookies)!==null&&E!==void 0?E:!1;var T;this.respectDoNotTrack=(T=this.options.respectDoNotTrack)!==null&&T!==void 0?T:!1,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:(r=this.options.platform)===null||r===void 0?void 0:r.name,viewer_application_version:(n=this.options.platform)===null||n===void 0?void 0:n.version,viewer_application_engine:(a=this.options.platform)===null||a===void 0?void 0:a.layout,viewer_device_name:(o=this.options.platform)===null||o===void 0?void 0:o.product,viewer_device_category:"",viewer_device_manufacturer:(l=this.options.platform)===null||l===void 0?void 0:l.manufacturer,viewer_os_family:(u=this.options.platform)===null||u===void 0||(d=u.os)===null||d===void 0?void 0:d.family,viewer_os_architecture:(h=this.options.platform)===null||h===void 0||(c=h.os)===null||c===void 0?void 0:c.architecture,viewer_os_version:(m=this.options.platform)===null||m===void 0||(f=m.os)===null||f===void 0?void 0:f.version,viewer_connection_type:yA(),page_url:Cu.default===null||Cu.default===void 0||(g=Cu.default.location)===null||g===void 0?void 0:g.href},this.viewerData=this.disableCookies?{}:pA()}return Xi(i,[{key:"send",value:function(e,t){if(!(!e||!(t!=null&&t.view_id))){if(this.respectDoNotTrack&&Sc())return Ce.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||typeof t!="object")return Ce.error("A data object was expected in send() but was not provided");var s=this.disableCookies?{}:gA(),r=mf(pd({},this.pageLevelData,t,s,this.viewerData),{event:e,env_key:this.envKey});r.user_id&&(r.viewer_user_id=r.user_id,delete r.user_id);var n,a=((n=r.mux_sample_number)!==null&&n!==void 0?n:0)>=this.sampleRate,o=this._deduplicateBeaconData(e,r),l=Lc(o);if(this.lastEventTime=this.mux.utils.now(),a)return Ce.info("Not sending event due to sample rate restriction",e,r,l);if(this.envKey||Ce.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",e,r,l),!this.rateLimited){if(Ce.info("Sending event",e,r,l),this.rateLimited=!this.eventQueue.queueEvent(e,l),this.mux.WINDOW_UNLOADING&&e==="viewend")this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&e==="hb"?this.eventQueue.flushEvents(!0):MA.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return r.event="eventrateexceeded",l=Lc(r),this.eventQueue.queueEvent(r.event,l),Ce.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(e,t){var s=this,r={},n=t.view_id;if(n==="-1"||e==="viewstart"||e==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=PA)r=pd({},t),n&&(this.previousBeaconData=r),n&&e==="viewend"&&(this.previousBeaconData=null);else{var a=e.indexOf("request")===0;Object.entries(t).forEach(function(o){var l=hs(o,2),d=l[0],u=l[1];s.previousBeaconData&&(u!==s.previousBeaconData[d]||DA.indexOf(d)>-1||s.objectHasChanged(a,d,u,s.previousBeaconData[d])||s.eventRequiresKey(e,d))&&(r[d]=u,s.previousBeaconData[d]=u)})}return r}},{key:"objectHasChanged",value:function(e,t,s,r){return!e||t.indexOf("request_")!==0?!1:t==="request_response_headers"||typeof s!="object"||typeof r!="object"?!0:Object.keys(s||{}).length!==Object.keys(r||{}).length}},{key:"eventRequiresKey",value:function(e,t){return!!(e==="renditionchange"&&t.indexOf("video_source_")===0||wA.includes(t)&&CA.includes(e))}}]),i})(),NA=function i(e){mt(this,i);var t=0,s=0,r=0,n=0,a=0,o=0,l=0,d=function(h,f){var m=f.request_start,g=f.request_response_start,p=f.request_response_end,E=f.request_bytes_loaded;n++;var T,y;if(g?(T=g-(m??0),y=(p??0)-g):y=(p??0)-(m??0),y>0&&E&&E>0){var b=E/y*8e3;a++,s+=E,r+=y,e.data.view_min_request_throughput=Math.min(e.data.view_min_request_throughput||1/0,b),e.data.view_average_request_throughput=s/r*8e3,e.data.view_request_count=n,T>0&&(t+=T,e.data.view_max_request_latency=Math.max(e.data.view_max_request_latency||0,T),e.data.view_average_request_latency=t/a)}},u=function(h,f){n++,o++,e.data.view_request_count=n,e.data.view_request_failed_count=o},c=function(h,f){n++,l++,e.data.view_request_count=n,e.data.view_request_canceled_count=l};e.on("requestcompleted",d),e.on("requestfailed",u),e.on("requestcanceled",c)},UA=NA,$A=3600*1e3,FA=function i(e){var t=this;mt(this,i),K(this,"_lastEventTime",void 0),e.on("before*",function(s,r){var n=r.viewer_time,a=st.now(),o=t._lastEventTime;if(t._lastEventTime=a,o&&a-o>$A){var l=Object.keys(e.data).reduce(function(u,c){return c.indexOf("video_")===0?Object.assign(u,K({},c,e.data[c])):u},{});e.mux.log.info("Received event after at least an hour inactivity, creating a new view");var d=e.playbackHeartbeat._playheadShouldBeProgressing;e._resetView(Object.assign({viewer_time:n},l)),e.playbackHeartbeat._playheadShouldBeProgressing=d,e.playbackHeartbeat._playheadShouldBeProgressing&&s.type!=="play"&&s.type!=="adbreakstart"&&(e.emit("play",{viewer_time:n}),s.type!=="playing"&&e.emit("playing",{viewer_time:n}))}})},BA=FA,HA=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],GA=new Set(["requestcompleted","requestfailed","requestcanceled"]),KA=(function(i){b_(t,i);var e=S_(t);function t(s,r,n){mt(this,t);var a;a=e.call(this),K(ae(a),"DOM_CONTENT_LOADED_EVENT_END",void 0),K(ae(a),"NAVIGATION_START",void 0),K(ae(a),"_destroyed",void 0),K(ae(a),"_heartBeatTimeout",void 0),K(ae(a),"adTracker",void 0),K(ae(a),"dashjs",void 0),K(ae(a),"data",void 0),K(ae(a),"disablePlayheadRebufferTracking",void 0),K(ae(a),"disableRebufferTracking",void 0),K(ae(a),"errorTracker",void 0),K(ae(a),"errorTranslator",void 0),K(ae(a),"emitTranslator",void 0),K(ae(a),"getAdData",void 0),K(ae(a),"getPlayheadTime",void 0),K(ae(a),"getStateData",void 0),K(ae(a),"stateDataTranslator",void 0),K(ae(a),"hlsjs",void 0),K(ae(a),"id",void 0),K(ae(a),"longResumeTracker",void 0),K(ae(a),"minimumRebufferDuration",void 0),K(ae(a),"mux",void 0),K(ae(a),"playbackEventDispatcher",void 0),K(ae(a),"playbackHeartbeat",void 0),K(ae(a),"playbackHeartbeatTime",void 0),K(ae(a),"playheadTime",void 0),K(ae(a),"seekingTracker",void 0),K(ae(a),"sustainedRebufferThreshold",void 0),K(ae(a),"watchTimeTracker",void 0),K(ae(a),"currentFragmentPDT",void 0),K(ae(a),"currentFragmentStart",void 0),a.DOM_CONTENT_LOADED_EVENT_END=md.domContentLoadedEventEnd(),a.NAVIGATION_START=md.navigationStart();var o={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(h){return h},emitTranslator:function(){for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return f},stateDataTranslator:function(h){return h}};a.mux=s,a.id=r,n!=null&&n.beaconDomain&&a.mux.log.warn("The `beaconDomain` setting has been deprecated in favor of `beaconCollectionDomain`. Please change your integration to use `beaconCollectionDomain` instead of `beaconDomain`."),n=Object.assign(o,n),n.data=n.data||{},n.data.property_key&&(n.data.env_key=n.data.property_key,delete n.data.property_key),Ce.level=n.debug?lr.DEBUG:lr.WARN,a.getPlayheadTime=n.getPlayheadTime,a.getStateData=n.getStateData||function(){return{}},a.getAdData=n.getAdData||function(){},a.minimumRebufferDuration=n.minimumRebufferDuration,a.sustainedRebufferThreshold=n.sustainedRebufferThreshold,a.playbackHeartbeatTime=n.playbackHeartbeatTime,a.disableRebufferTracking=n.disableRebufferTracking,a.disableRebufferTracking&&a.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),a.disablePlayheadRebufferTracking=n.disablePlayheadRebufferTracking,a.errorTranslator=n.errorTranslator,a.emitTranslator=n.emitTranslator,a.stateDataTranslator=n.stateDataTranslator,a.playbackEventDispatcher=new OA(s,n.data.env_key,n),a.data={player_instance_id:Fa(),mux_sample_rate:n.sampleRate,beacon_domain:n.beaconCollectionDomain||n.beaconDomain},a.data.view_sequence_number=1,a.data.player_sequence_number=1;var l=(function(){typeof this.data.view_start>"u"&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}).bind(ae(a));if(a.on("viewinit",function(h,f){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,f),this._initializeViewData(),this.one("play",l),this.one("adbreakstart",l)}),a.on("videochange",function(h,f){this._resetView(f)}),a.on("programchange",function(h,f){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),this._resetView(Object.assign(f,{view_program_changed:!0})),l(),this.emit("play"),this.emit("playing")}),a.on("fragmentchange",function(h,f){this.currentFragmentPDT=f.currentFragmentPDT,this.currentFragmentStart=f.currentFragmentStart}),a.on("destroy",a.destroy),typeof window<"u"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var d=function(){var h=typeof a.data.view_start<"u";a.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",h&&a.mux.WINDOW_HIDDEN&&(a.data.player_is_paused||a.emit("hb"))};window.addEventListener("visibilitychange",d,!1);var u=function(h){h.persisted||a.destroy()};window.addEventListener("pagehide",u,!1),a.on("destroy",function(){window.removeEventListener("visibilitychange",d),window.removeEventListener("pagehide",u)})}a.on("playerready",function(h,f){Object.assign(this.data,f)}),HA.forEach(function(h){a.on(h,function(f,m){h.indexOf("ad")!==0&&this._updateStateData(),Object.assign(this.data,m),this._sanitizeData()}),a.on("after"+h,function(){(h!=="error"||this.errorTracker.viewErrored)&&this.send(h)})}),a.on("viewend",function(h,f){Object.assign(a.data,f)});var c=function(h){var f=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=f-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};return a.one("playerready",c),a.longResumeTracker=new BA(ae(a)),a.errorTracker=new G_(ae(a)),new hA(ae(a)),a.seekingTracker=new nA(ae(a)),a.playheadTime=new j_(ae(a)),a.playbackHeartbeat=new B_(ae(a)),new iA(ae(a)),a.watchTimeTracker=new V_(ae(a)),new q_(ae(a)),a.adTracker=new lA(ae(a)),new Z_(ae(a)),new Q_(ae(a)),new eA(ae(a)),new uA(ae(a)),new UA(ae(a)),n.hlsjs&&a.addHLSJS(n),n.dashjs&&a.addDashJS(n),a.emit("viewinit",n.data),a}return Xi(t,[{key:"emit",value:function(s,r){var n,a=Object.assign({viewer_time:this.mux.utils.now()},r),o=[s,a];if(this.emitTranslator)try{o=this.emitTranslator(s,a)}catch(l){this.mux.log.warn("Exception in emit translator callback.",l)}o!=null&&o.length&&(n=Qo(xn(t.prototype),"emit",this)).call.apply(n,[this].concat(di(o)))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,typeof this.data.view_start<"u"&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(s){if(this.data.view_id){var r=Object.assign({},this.data),n=["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"];if(r.video_source_is_live===void 0&&(r.player_source_duration===1/0||r.video_source_duration===1/0?r.video_source_is_live=!0:(r.player_source_duration>0||r.video_source_duration>0)&&(r.video_source_is_live=!1)),r.video_source_is_live||n.forEach(function(d){r[d]=void 0}),r.video_source_url=r.video_source_url||r.player_source_url,r.video_source_url){var a=hs(Ba(r.video_source_url),2),o=a[0],l=a[1];r.video_source_domain=l,r.video_source_hostname=o}delete r.ad_request_id,this.playbackEventDispatcher.send(s,r),this.data.view_sequence_number++,this.data.player_sequence_number++,GA.has(s)||this._restartHeartBeat(),s==="viewend"&&delete this.data.view_id}}},{key:"_resetView",value:function(s){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",s)}},{key:"_updateStateData",value:function(){var s=this.getStateData();if(typeof this.stateDataTranslator=="function")try{s=this.stateDataTranslator(s)}catch(r){this.mux.log.warn("Exception in stateDataTranslator translator callback.",r)}Object.assign(this.data,s),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var s=this,r=["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"];r.forEach(function(a){var o=parseInt(s.data[a],10);s.data[a]=isNaN(o)?void 0:o});var n=["player_source_url","video_source_url"];n.forEach(function(a){if(s.data[a]){var o=s.data[a].toLowerCase();(o.indexOf("data:")===0||o.indexOf("blob:")===0)&&(s.data[a]="MSE style URL")}})}},{key:"_resetVideoData",value:function(){var s=this;Object.keys(this.data).forEach(function(r){r.indexOf("video_")===0&&delete s.data[r]})}},{key:"_resetViewData",value:function(){var s=this;Object.keys(this.data).forEach(function(r){r.indexOf("view_")===0&&delete s.data[r]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(){delete this.data.player_error_code,delete this.data.player_error_message,delete this.data.player_error_context,delete this.data.player_error_severity,delete this.data.player_error_business_exception}},{key:"_initializeViewData",value:function(){var s=this,r=this.data.view_id=Fa(),n=function(){r===s.data.view_id&&tt(s.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",n):n()}},{key:"_restartHeartBeat",value:function(){var s=this;window.clearTimeout(this._heartBeatTimeout),this._heartBeatTimeout=window.setTimeout(function(){s.data.player_is_paused||s.emit("hb")},1e4)}},{key:"addHLSJS",value:function(s){if(!s.hlsjs){this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.");return}if(this.hlsjs){this.mux.log.warn("An instance of HLS.js is already being monitored for this player.");return}this.hlsjs=s.hlsjs,D_(this.mux,this.id,s.hlsjs,{},s.Hls||window.Hls)}},{key:"removeHLSJS",value:function(){this.hlsjs&&(C_(this.hlsjs),this.hlsjs=void 0)}},{key:"addDashJS",value:function(s){if(!s.dashjs){this.mux.log.warn("You must pass a valid dashjs instance in order to track it.");return}if(this.dashjs){this.mux.log.warn("An instance of Dash.js is already being monitored for this player.");return}this.dashjs=s.dashjs,O_(this.mux,this.id,s.dashjs)}},{key:"removeDashJS",value:function(){this.dashjs&&(N_(this.dashjs),this.dashjs=void 0)}}]),t})($_),VA=KA,Kn=qt(vv());function WA(){return Kn.default&&!!(Kn.default.fullscreenElement||Kn.default.webkitFullscreenElement||Kn.default.mozFullScreenElement||Kn.default.msFullscreenElement)}var qA=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],YA={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};function jA(i,e,t){var s=hs(fd(e),3),r=s[0],n=s[1],a=s[2],o=i.log,l=i.utils.getComputedStyle,d=i.utils.secondsToMs,u={automaticErrorTracking:!0};if(r){if(a!=="video"&&a!=="audio")return o.error("The element of `"+n+"` was not a media element.")}else return o.error("No element was found with the `"+n+"` query selector.");r.mux&&(r.mux.destroy(),delete r.mux,o.warn("Already monitoring this video element, replacing existing event listeners"));var c={getPlayheadTime:function(){return d(r.currentTime)},getStateData:function(){var f,m,g,p=((f=(m=this).getPlayheadTime)===null||f===void 0?void 0:f.call(m))||d(r.currentTime),E=this.hlsjs&&this.hlsjs.url,T=this.dashjs&&typeof this.dashjs.getSource=="function"&&this.dashjs.getSource(),y={player_is_paused:r.paused,player_width:parseInt(l(r,"width")),player_height:parseInt(l(r,"height")),player_autoplay_on:r.autoplay,player_preload_on:r.preload,player_language_code:r.lang,player_is_fullscreen:WA(),video_poster_url:r.poster,video_source_url:E||T||r.currentSrc,video_source_duration:d(r.duration),video_source_height:r.videoHeight,video_source_width:r.videoWidth,view_dropped_frame_count:r==null||(g=r.getVideoPlaybackQuality)===null||g===void 0?void 0:g.call(r).droppedVideoFrames};if(r.getStartDate&&p>0){var b=r.getStartDate();if(b&&typeof b.getTime=="function"&&b.getTime()){var A=b.getTime();if(y.player_program_time=A+p,r.seekable.length>0){var L=A+r.seekable.end(r.seekable.length-1);y.player_live_edge_program_time=L}}}return y}};t=Object.assign(u,t,c),t.data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:i.VERSION},t.data),r.mux=r.mux||{},r.mux.deleted=!1,r.mux.emit=function(f,m){i.emit(n,f,m)},r.mux.updateData=function(f){r.mux.emit("hb",f)};var h=function(){o.error("The monitor for this video element has already been destroyed.")};r.mux.destroy=function(){Object.keys(r.mux.listeners).forEach(function(f){r.removeEventListener(f,r.mux.listeners[f],!1)}),delete r.mux.listeners,r.mux.destroy=h,r.mux.swapElement=h,r.mux.emit=h,r.mux.addHLSJS=h,r.mux.addDashJS=h,r.mux.removeHLSJS=h,r.mux.removeDashJS=h,r.mux.updateData=h,r.mux.setEmitTranslator=h,r.mux.setStateDataTranslator=h,r.mux.setGetPlayheadTime=h,r.mux.deleted=!0,i.emit(n,"destroy")},r.mux.swapElement=function(f){var m=hs(fd(f),3),g=m[0],p=m[1],E=m[2];if(g){if(E!=="video"&&E!=="audio")return i.log.error("The element of `"+p+"` was not a media element.")}else return i.log.error("No element was found with the `"+p+"` query selector.");g.muxId=r.muxId,delete r.muxId,g.mux=g.mux||{},g.mux.listeners=Object.assign({},r.mux.listeners),delete r.mux.listeners,Object.keys(g.mux.listeners).forEach(function(T){r.removeEventListener(T,g.mux.listeners[T],!1),g.addEventListener(T,g.mux.listeners[T],!1)}),g.mux.swapElement=r.mux.swapElement,g.mux.destroy=r.mux.destroy,delete r.mux,r=g},r.mux.addHLSJS=function(f){i.addHLSJS(n,f)},r.mux.addDashJS=function(f){i.addDashJS(n,f)},r.mux.removeHLSJS=function(){i.removeHLSJS(n)},r.mux.removeDashJS=function(){i.removeDashJS(n)},r.mux.setEmitTranslator=function(f){i.setEmitTranslator(n,f)},r.mux.setStateDataTranslator=function(f){i.setStateDataTranslator(n,f)},r.mux.setGetPlayheadTime=function(f){f||(f=t.getPlayheadTime),i.setGetPlayheadTime(n,f)},i.init(n,t),i.emit(n,"playerready"),r.paused||(i.emit(n,"play"),r.readyState>2&&i.emit(n,"playing")),r.mux.listeners={},qA.forEach(function(f){f==="error"&&!t.automaticErrorTracking||(r.mux.listeners[f]=function(){var m={};if(f==="error"){if(!r.error||r.error.code===1)return;m.player_error_code=r.error.code,m.player_error_message=YA[r.error.code]||r.error.message}i.emit(n,f,m)},r.addEventListener(f,r.mux.listeners[f],!1))})}function zA(i,e,t,s){var r=s;if(i&&typeof i[e]=="function")try{r=i[e].apply(i,t)}catch(n){Ce.info("safeCall error",n)}return r}var Ia=qt(Ei()),Hr;Ia.default&&Ia.default.WeakMap&&(Hr=new WeakMap);function QA(i,e){if(!i||!e||!Ia.default||typeof Ia.default.getComputedStyle!="function")return"";var t;return Hr&&Hr.has(i)&&(t=Hr.get(i)),t||(t=Ia.default.getComputedStyle(i,null),Hr&&Hr.set(i,t)),t.getPropertyValue(e)}function XA(i){return Math.floor(i*1e3)}var qs={TARGET_DURATION:"#EXT-X-TARGETDURATION",PART_INF:"#EXT-X-PART-INF",SERVER_CONTROL:"#EXT-X-SERVER-CONTROL",INF:"#EXTINF",PROGRAM_DATE_TIME:"#EXT-X-PROGRAM-DATE-TIME",VERSION:"#EXT-X-VERSION",SESSION_DATA:"#EXT-X-SESSION-DATA"},tu=function(i){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(i),this.manifest};tu.prototype.process=function(i){var e;for(this.buffer+=i,e=this.buffer.indexOf(`
`);e>-1;e=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)};tu.prototype.processLine=function(i){var e=i.indexOf(":"),t=tS(i,e),s=t[0],r=t.length===2?gf(t[1]):void 0;if(s[0]!=="#")this.currentUri.uri=s,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(s){case qs.TARGET_DURATION:{if(!isFinite(r)||r<0)return;this.manifest.targetDuration=r,this.setHoldBack();break}case qs.PART_INF:{wu(this.manifest,t),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break}case qs.SERVER_CONTROL:{wu(this.manifest,t),this.setHoldBack();break}case qs.INF:{r===0?this.currentUri.duration=.01:r>0&&(this.currentUri.duration=r);break}case qs.PROGRAM_DATE_TIME:{var n=r,a=new Date(n);this.manifest.dateTimeString||(this.manifest.dateTimeString=n,this.manifest.dateTimeObject=a),this.currentUri.dateTimeString=n,this.currentUri.dateTimeObject=a;break}case qs.VERSION:{wu(this.manifest,t);break}case qs.SESSION_DATA:{var o=iS(t[1]),l=bv(o);Object.assign(this.manifest.sessionData,l)}}};tu.prototype.setHoldBack=function(){var i=this.manifest,e=i.serverControl,t=i.targetDuration,s=i.partTargetDuration;if(e){var r="holdBack",n="partHoldBack",a=t&&t*3,o=s&&s*2;t&&!e.hasOwnProperty(r)&&(e[r]=a),a&&e[r]<a&&(e[r]=a),s&&!e.hasOwnProperty(n)&&(e[n]=s*3),s&&e[n]<o&&(e[n]=o)}};var wu=function(i,e){var t=Dv(e[0].replace("#EXT-X-","")),s;eS(e[1])?(s={},s=Object.assign(JA(e[1]),s)):s=gf(e[1]),i[t]=s},Dv=function(i){return i.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()})},gf=function(i){if(i.toLowerCase()==="yes"||i.toLowerCase()==="no")return i.toLowerCase()==="yes";var e=i.indexOf(":")!==-1?i:parseFloat(i);return isNaN(e)?i:e},ZA=function(i){var e={},t=i.split("=");if(t.length>1){var s=Dv(t[0]);e[s]=gf(t[1])}return e},JA=function(i){for(var e=i.split(","),t={},s=0;e.length>s;s++){var r=e[s],n=ZA(r);t=Object.assign(n,t)}return t},eS=function(i){return i.indexOf("=")>-1},tS=function(i,e){return e===-1?[i]:[i.substring(0,e),i.substring(e+1)]},iS=function(i){var e={};if(i){var t=i.search(","),s=i.slice(0,t),r=i.slice(t+1),n=[s,r];return n.forEach(function(a,o){for(var l=a.replace(/['"]+/g,"").split("="),d=0;d<l.length;d++)l[d]==="DATA-ID"&&(e["DATA-ID"]=l[1-d]),l[d]==="VALUE"&&(e.VALUE=l[1-d])}),{data:e}}},sS=tu,rS={safeCall:zA,safeIncrement:tt,getComputedStyle:QA,secondsToMs:XA,assign:Object.assign,headersStringToObject:pf,cdnHeadersToRequestId:gd,extractHostnameAndDomain:Ba,extractHostname:pi,manifestParser:sS,generateShortID:yv,generateUUID:Fa,now:st.now,findMediaElement:fd},nS=rS,aS={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled",HEARTBEAT:"hb",DESTROY:"destroy"},oS=aS,lS="mux-embed",dS="5.9.0",uS="2.1",Qe={},$s=function(i){var e=arguments;typeof i=="string"?$s.hasOwnProperty(i)?Sa.default.setTimeout(function(){e=Array.prototype.splice.call(e,1),$s[i].apply(null,e)},0):Ce.warn("`"+i+"` is an unknown task"):typeof i=="function"?Sa.default.setTimeout(function(){i($s)},0):Ce.warn("`"+i+"` is invalid.")},cS={loaded:st.now(),NAME:lS,VERSION:dS,API_VERSION:uS,PLAYER_TRACKED:!1,monitor:function(i,e){return jA($s,i,e)},destroyMonitor:function(i){var e=hs(fd(i),1),t=e[0];t&&t.mux&&typeof t.mux.destroy=="function"?t.mux.destroy():Ce.error("A video element monitor for `"+i+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(i,e){var t=li(i);Qe[t]?Qe[t].addHLSJS(e):Ce.error("A monitor for `"+t+"` has not been initialized.")},addDashJS:function(i,e){var t=li(i);Qe[t]?Qe[t].addDashJS(e):Ce.error("A monitor for `"+t+"` has not been initialized.")},removeHLSJS:function(i){var e=li(i);Qe[e]?Qe[e].removeHLSJS():Ce.error("A monitor for `"+e+"` has not been initialized.")},removeDashJS:function(i){var e=li(i);Qe[e]?Qe[e].removeDashJS():Ce.error("A monitor for `"+e+"` has not been initialized.")},init:function(i,e){Sc()&&e&&e.respectDoNotTrack&&Ce.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var t=li(i);Qe[t]=new VA($s,t,e)},emit:function(i,e,t){var s=li(i);Qe[s]?(Qe[s].emit(e,t),e==="destroy"&&delete Qe[s]):Ce.error("A monitor for `"+s+"` has not been initialized.")},updateData:function(i,e){var t=li(i);Qe[t]?Qe[t].emit("hb",e):Ce.error("A monitor for `"+t+"` has not been initialized.")},setEmitTranslator:function(i,e){var t=li(i);Qe[t]?Qe[t].emitTranslator=e:Ce.error("A monitor for `"+t+"` has not been initialized.")},setStateDataTranslator:function(i,e){var t=li(i);Qe[t]?Qe[t].stateDataTranslator=e:Ce.error("A monitor for `"+t+"` has not been initialized.")},setGetPlayheadTime:function(i,e){var t=li(i);Qe[t]?Qe[t].getPlayheadTime=e:Ce.error("A monitor for `"+t+"` has not been initialized.")},checkDoNotTrack:Sc,log:Ce,utils:nS,events:oS,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign($s,cS);typeof Sa.default<"u"&&typeof Sa.default.addEventListener=="function"&&Sa.default.addEventListener("pagehide",function(i){i.persisted||($s.WINDOW_UNLOADING=!0)},!1);var vf=$s;const j=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},hS=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=fS},fS=Number.MAX_SAFE_INTEGER||9007199254740991;let te=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),C=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),v=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var me={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Z={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Cr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class mS{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Cr(e),this.fast_=new Cr(t),this.defaultTTFB_=r,this.ttfb_=new Cr(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:n}=this;s.halfLife!==e&&(this.slow_=new Cr(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Cr(t,r.getEstimate(),r.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Cr(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,n=s/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function pS(i,e,t){return(e=vS(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function De(){return De=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},De.apply(null,arguments)}function mp(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function Le(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mp(Object(t),!0).forEach(function(s){pS(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):mp(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function gS(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function vS(i){var e=gS(i,"string");return typeof e=="symbol"?e:e+""}class si{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Cs,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Cs=function(){},ES={trace:Cs,debug:Cs,log:Cs,warn:Cs,info:Cs,error:Cs};function Rc(){return De({},ES)}function yS(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Cs}function pp(i,e,t){return e[i]?e[i].bind(e):yS(i,t)}const xc=Rc();function TS(i,e,t){const s=Rc();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(n=>{s[n]=pp(n,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.14`)}catch{return Rc()}r.forEach(n=>{xc[n]=pp(n,i)})}else De(xc,s);return s}const Re=xc;function Bs(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function bS(i){return typeof self<"u"&&i===self.ManagedMediaSource}function Cv(i,e){const t=Object.keys(i),s=Object.keys(e),r=t.length,n=s.length;return!r||!n||r===n&&!t.some(a=>s.indexOf(a)===-1)}function Wt(i,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(i);if(e){const u=d.indexOf("\0");return u!==-1?d.substring(0,u):d}return d.replace(/\0/g,"")}const t=i.length;let s,r,n,a="",o=0;for(;o<t;){if(s=i[o++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:r=i[o++],a+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=i[o++],n=i[o++],a+=String.fromCharCode((s&15)<<12|(r&63)<<6|(n&63)<<0);break}}return a}function It(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function wv(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function _S(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Mu={exports:{}},gp;function AS(){return gp||(gp=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,d,u){if(u=u||{},l=l.trim(),d=d.trim(),!d){if(!u.alwaysNormalize)return l;var c=o.parseURL(l);if(!c)throw new Error("Error trying to parse base URL.");return c.path=o.normalizePath(c.path),o.buildURLFromParts(c)}var h=o.parseURL(d);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):d;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var m=r.exec(f.path);f.netLoc=m[1],f.path=m[2]}f.netLoc&&!f.path&&(f.path="/");var g={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)g.path=f.path,h.params||(g.params=f.params,h.query||(g.query=f.query));else{var p=f.path,E=p.substring(0,p.lastIndexOf("/")+1)+h.path;g.path=o.normalizePath(E)}return g.path===null&&(g.path=u.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(g)},parseURL:function(l){var d=s.exec(l);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(n,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=o})()})(Mu)),Mu.exports}var Ef=AS();class yf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var we={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Mv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,IS(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[we.AUDIO]:null,[we.VIDEO]:null,[we.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new yf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ef.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[we.AUDIO]=null,e[we.VIDEO]=null,e[we.AUDIOVIDEO]=null}}function it(i){return i.sn!=="initSegment"}class Pu extends Mv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(j(e)&&j(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const r=this._decryptdata=t[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=j(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!j(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return it(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const r=t[e];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,n,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:n,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,n)}}let SS=class extends Mv{constructor(e,t,s,r,n){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}};function Pv(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||Pv(t,e)}}function IS(i,e){const t=Pv(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const vp=Math.pow(2,32)-1,LS=[].push,Ov={video:1,audio:2,id3:3,text:4};function lt(i){return String.fromCharCode.apply(null,i)}function Nv(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function oe(i,e){const t=Uv(i,e);return t<0?4294967296+t:t}function Ep(i,e){let t=oe(i,e);return t*=Math.pow(2,32),t+=oe(i,e+4),t}function Uv(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function RS(i){const e=i.byteLength;for(let t=0;t<e;){const s=oe(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function he(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let r=0;r<s;){const n=oe(i,r),a=lt(i.subarray(r+4,r+8)),o=n>1?r+n:s;if(a===e[0])if(e.length===1)t.push(i.subarray(r+8,o));else{const l=he(i.subarray(r+8,o),e.slice(1));l.length&&LS.apply(t,l)}r=o}return t}function xS(i){const e=[],t=i[0];let s=8;const r=oe(i,s);s+=4;let n=0,a=0;t===0?(n=oe(i,s),a=oe(i,s+4),s+=8):(n=Ep(i,s),a=Ep(i,s+8),s+=16),s+=2;let o=i.length+a;const l=Nv(i,s);s+=2;for(let d=0;d<l;d++){let u=s;const c=oe(i,u);u+=4;const h=c&2147483647;if((c&2147483648)>>>31===1)return Re.warn("SIDX has hierarchical references (not supported)"),null;const m=oe(i,u);u+=4,e.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/r,start:o,end:o+h-1}}),o+=h,u+=4,s=u}return{earliestPresentationTime:n,timescale:r,version:t,referencesCount:l,references:e}}function $v(i){const e=[],t=he(i,["moov","trak"]);for(let r=0;r<t.length;r++){const n=t[r],a=he(n,["tkhd"])[0];if(a){let o=a[0];const l=oe(a,o===0?12:20),d=he(n,["mdia","mdhd"])[0];if(d){o=d[0];const u=oe(d,o===0?12:20),c=he(n,["mdia","hdlr"])[0];if(c){const h=lt(c.subarray(8,12)),f={soun:we.AUDIO,vide:we.VIDEO}[h],m=he(n,["mdia","minf","stbl","stsd"])[0],g=kS(m);f?(e[l]={timescale:u,type:f,stsd:g},e[f]=Le({timescale:u,id:l},g)):e[l]={timescale:u,type:h,stsd:g}}}}}return he(i,["moov","mvex","trex"]).forEach(r=>{const n=oe(r,4),a=e[n];a&&(a.default={duration:oe(r,12),flags:oe(r,20)})}),e}function kS(i){const e=i.subarray(8),t=e.subarray(86),s=lt(e.subarray(4,8));let r=s,n;const a=s==="enca"||s==="encv";if(a){const d=he(e,[s])[0].subarray(s==="enca"?28:78);he(d,["sinf"]).forEach(c=>{const h=he(c,["schm"])[0];if(h){const f=lt(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const m=he(c,["frma"])[0];m&&(r=lt(m))}}})}const o=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=he(t,["avcC"])[0];l&&l.length>3&&(r+="."+Eo(l[1])+Eo(l[2])+Eo(l[3]),n=vo(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=he(e,[s])[0],d=he(l.subarray(28),["esds"])[0];if(d&&d.length>7){let u=4;if(d[u++]!==3)break;u=Ou(d,u),u+=2;const c=d[u++];if(c&128&&(u+=2),c&64&&(u+=d[u++]),d[u++]!==4)break;u=Ou(d,u);const h=d[u++];if(h===64)r+="."+Eo(h);else break;if(u+=12,d[u++]!==5)break;u=Ou(d,u);const f=d[u++];let m=(f&248)>>3;m===31&&(m+=1+((f&7)<<3)+((d[u]&224)>>5)),r+="."+m}break}case"hvc1":case"hev1":{const l=he(t,["hvcC"])[0];if(l&&l.length>12){const d=l[1],u=["","A","B","C"][d>>6],c=d&31,h=oe(l,2),f=(d&32)>>5?"H":"L",m=l[12],g=l.subarray(6,12);r+="."+u+c,r+="."+DS(h).toString(16).toUpperCase(),r+="."+f+m;let p="";for(let E=g.length;E--;){const T=g[E];(T||p)&&(p="."+T.toString(16).toUpperCase()+p)}r+=p}n=vo(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=vo(r,t)||r;break}case"vp09":{const l=he(t,["vpcC"])[0];if(l&&l.length>6){const d=l[4],u=l[5],c=l[6]>>4&15;r+="."+Ui(d)+"."+Ui(u)+"."+Ui(c)}break}case"av01":{const l=he(t,["av1C"])[0];if(l&&l.length>2){const d=l[1]>>>5,u=l[1]&31,c=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,m=d===2&&h?f?12:10:h?10:8,g=(l[2]&16)>>4,p=(l[2]&8)>>3,E=(l[2]&4)>>2,T=l[2]&3;r+="."+d+"."+Ui(u)+c+"."+Ui(m)+"."+g+"."+p+E+T+"."+Ui(1)+"."+Ui(1)+"."+Ui(1)+"."+0,n=vo("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:n}}function vo(i,e){const t=he(e,["dvvC"]),s=t.length?t[0]:he(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,n=s[2]<<5&32|s[3]>>3&31;return i+"."+Ui(r)+"."+Ui(n)}}function DS(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Ou(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Eo(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function Ui(i){return(i<10?"0":"")+i}function CS(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Fv(i,(s,r)=>{const n=s.subarray(8,24);n.some(a=>a!==0)||(Re.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${It(n)} -> ${It(t)}`),s.set(t,8))})}function wS(i){const e=[];return Fv(i,t=>e.push(t.subarray(8,24))),e}function Fv(i,e){he(i,["moov","trak"]).forEach(s=>{const r=he(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const n=r.subarray(8);let a=he(n,["enca"]);const o=a.length>0;o||(a=he(n,["encv"])),a.forEach(l=>{const d=o?l.subarray(28):l.subarray(78);he(d,["sinf"]).forEach(c=>{const h=Bv(c);h&&e(h,o)})})})}function Bv(i){const e=he(i,["schm"])[0];if(e){const t=lt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=he(i,["schi","tenc"])[0];if(s)return s}}}function MS(i,e,t){const s={},r=he(i,["moof","traf"]);for(let n=0;n<r.length;n++){const a=r[n],o=he(a,["tfhd"])[0],l=oe(o,4),d=e[l];if(!d)continue;s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const u=s[l],c=he(a,["tfdt"])[0];if(c){const y=c[0];let b=oe(c,4);y===1&&(b===vp?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=vp+1,b+=oe(c,8))),j(b)&&(!j(u.start)||b<u.start)&&(u.start=b)}const h=d.default,f=oe(o,0)|h?.flags;let m=h?.duration||0;f&8&&(f&2?m=oe(o,12):m=oe(o,8));const g=he(a,["trun"]);let p=u.start||0,E=0,T=m;for(let y=0;y<g.length;y++){const b=g[y],A=oe(b,4),L=u.sampleCount;u.sampleCount+=A;const S=b[3]&1,R=b[3]&4,x=b[2]&1,I=b[2]&2,M=b[2]&4,$=b[2]&8;let V=8,q=A;for(S&&(V+=4),R&&A&&(!(b[V+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=L),V+=4,x?(T=oe(b,V),V+=4):T=m,I&&(V+=4),$&&(V+=4),p+=T,E+=T,q--);q--;)x?(T=oe(b,V),V+=4):T=m,I&&(V+=4),M&&(b[V+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(q+1),u.keyFrameStart=p),V+=4),$&&(V+=4),p+=T,E+=T;!E&&m&&(E+=m*A)}u.duration+=E}if(!Object.keys(s).some(n=>s[n].duration)){let n=1/0,a=0;const o=he(i,["sidx"]);for(let l=0;l<o.length;l++){const d=xS(o[l]);if(d!=null&&d.references){n=Math.min(n,d.earliestPresentationTime/d.timescale);const u=d.references.reduce((c,h)=>c+h.info.duration||0,0);a=Math.max(a,u+d.earliestPresentationTime/d.timescale)}}a&&j(a)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=a*s[l].timescale-s[l].start)})}return s}function PS(i){const e={valid:null,remainder:null},t=he(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function ii(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function yp(i,e){const t=[],s=e.samples,r=e.timescale,n=e.id;let a=!1;return he(s,["moof"]).map(l=>{const d=l.byteOffset-8;he(l,["traf"]).map(c=>{const h=he(c,["tfdt"]).map(f=>{const m=f[0];let g=oe(f,4);return m===1&&(g*=Math.pow(2,32),g+=oe(f,8)),g/r})[0];return h!==void 0&&(i=h),he(c,["tfhd"]).map(f=>{const m=oe(f,4),g=oe(f,0)&16777215,p=(g&1)!==0,E=(g&2)!==0,T=(g&8)!==0;let y=0;const b=(g&16)!==0;let A=0;const L=(g&32)!==0;let S=8;m===n&&(p&&(S+=8),E&&(S+=4),T&&(y=oe(f,S),S+=4),b&&(A=oe(f,S),S+=4),L&&(S+=4),e.type==="video"&&(a=iu(e.codec)),he(c,["trun"]).map(R=>{const x=R[0],I=oe(R,0)&16777215,M=(I&1)!==0;let $=0;const V=(I&4)!==0,q=(I&256)!==0;let H=0;const N=(I&512)!==0;let W=0;const B=(I&1024)!==0,Y=(I&2048)!==0;let ee=0;const U=oe(R,4);let F=8;M&&($=oe(R,F),F+=4),V&&(F+=4);let ne=$+d;for(let pe=0;pe<U;pe++){if(q?(H=oe(R,F),F+=4):H=y,N?(W=oe(R,F),F+=4):W=A,B&&(F+=4),Y&&(x===0?ee=oe(R,F):ee=Uv(R,F),F+=4),e.type===we.VIDEO){let de=0;for(;de<W;){const fe=oe(s,ne);if(ne+=4,OS(a,s[ne])){const rt=s.subarray(ne,ne+fe);Tf(rt,a?2:1,i+ee/r,t)}ne+=fe,de+=fe+4}}i+=H/r}}))})})}),t}function iu(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function OS(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Tf(i,e,t,s){const r=Hv(i);let n=0;n+=e;let a=0,o=0,l=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;l=r[n++],a+=l}while(l===255);o=0;do{if(n>=r.length)break;l=r[n++],o+=l}while(l===255);const d=r.length-n;let u=n;if(o<d)n+=o;else if(o>d){Re.error(`Malformed SEI payload. ${o} is too small, only ${d} bytes left to parse.`);break}if(a===4){if(r[u++]===181){const h=Nv(r,u);if(u+=2,h===49){const f=oe(r,u);if(u+=4,f===1195456820){const m=r[u++];if(m===3){const g=r[u++],p=31&g,E=64&g,T=E?2+p*3:0,y=new Uint8Array(T);if(E){y[0]=g;for(let b=1;b<T;b++)y[b]=r[u++]}s.push({type:m,payloadType:a,pts:t,bytes:y})}}}}}else if(a===5&&o>16){const c=[];for(let m=0;m<16;m++){const g=r[u++].toString(16);c.push(g.length==1?"0"+g:g),(m===3||m===5||m===7||m===9)&&c.push("-")}const h=o-16,f=new Uint8Array(h);for(let m=0;m<h;m++)f[m]=r[u++];s.push({payloadType:a,pts:t,uuid:c.join(""),userData:Wt(f),userDataBytes:f})}}}function Hv(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const r=e-t.length,n=new Uint8Array(r);let a=0;for(s=0;s<r;a++,s++)a===t[0]&&(a++,t.shift()),n[s]=i[a];return n}function NS(i){const e=i[0];let t="",s="",r=0,n=0,a=0,o=0,l=0,d=0;if(e===0){for(;lt(i.subarray(d,d+1))!=="\0";)t+=lt(i.subarray(d,d+1)),d+=1;for(t+=lt(i.subarray(d,d+1)),d+=1;lt(i.subarray(d,d+1))!=="\0";)s+=lt(i.subarray(d,d+1)),d+=1;s+=lt(i.subarray(d,d+1)),d+=1,r=oe(i,12),n=oe(i,16),o=oe(i,20),l=oe(i,24),d=28}else if(e===1){d+=4,r=oe(i,d),d+=4;const c=oe(i,d);d+=4;const h=oe(i,d);for(d+=4,a=2**32*c+h,hS(a)||(a=Number.MAX_SAFE_INTEGER,Re.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=oe(i,d),d+=4,l=oe(i,d),d+=4;lt(i.subarray(d,d+1))!=="\0";)t+=lt(i.subarray(d,d+1)),d+=1;for(t+=lt(i.subarray(d,d+1)),d+=1;lt(i.subarray(d,d+1))!=="\0";)s+=lt(i.subarray(d,d+1)),d+=1;s+=lt(i.subarray(d,d+1)),d+=1}const u=i.subarray(d,i.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:u}}function US(i,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=s&255,n.set(i,4),r=0,s=8;r<t;r++)n.set(e[r],s),s+=e[r].byteLength;return n}function $S(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let n;s>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),US([112,115,115,104],new Uint8Array([s,0,0,0]),i,n,r,a,t)}function FS(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const r=new DataView(i,s),n=BS(r);e.push(n),s+=n.size}}return e}function BS(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const n=i.getUint32(8)>>>24;if(n!==0&&n!==1)return{offset:t,size:e};const a=i.buffer,o=It(new Uint8Array(a,t+12,16));let l=null,d=null,u=0;if(n===0)u=28;else{const h=i.getUint32(28);if(!h||s<32+h*16)return{offset:t,size:e};l=[];for(let f=0;f<h;f++)l.push(new Uint8Array(a,t+32+f*16,16));u=32+h*16}if(!u)return{offset:t,size:e};const c=i.getUint32(u);return e-32<c?{offset:t,size:e}:(d=new Uint8Array(a,t+u+4,c),{version:n,systemId:o,kids:l,data:d,offset:t,size:e})}const Gv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),kn={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function bf(i,e){const t=kn[e];return!!t&&!!t[i.slice(0,4)]}function Ha(i,e,t=!0){return!i.split(",").some(s=>!_f(s,e,t))}function _f(i,e,t=!0){var s;const r=Bs(t);return(s=r?.isTypeSupported(Ga(i,e)))!=null?s:!1}function Ga(i,e){return`${e}/mp4;codecs=${i}`}function Tp(i){if(i){const e=i.substring(0,4);return kn.video[e]}return 2}function vd(i){const e=Gv();return i.split(",").reduce((t,s)=>{const n=e&&iu(s)?9:kn.video[s];return n?(n*2+t)/(t?3:2):(kn.audio[s]+t)/(t?2:1)},0)}const Nu={};function HS(i,e=!0){if(Nu[i])return Nu[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var s;if(_f(t[r],"audio",e))return Nu[i]=t[r],t[r];if(t[r]==="mp3"&&(s=Bs(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const GS=/flac|opus|mp4a\.40\.34/i;function Ed(i,e=!0){return i.replace(GS,t=>HS(t.toLowerCase(),e))}function KS(i,e){const t=[];if(i){const s=i.split(",");for(let r=0;r<s.length;r++)bf(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function Xo(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(bp(i,"audio")||bp(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function bp(i,e){return bf(i,e)&&_f(i,e)}function VS(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function WS(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function _p(i){const e=Bs(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function kc(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const qS={supported:!0,powerEfficient:!0,smooth:!0},YS={supported:!1,smooth:!1,powerEfficient:!1},Kv={supported:!0,configurations:[],decodingInfoResults:[qS]};function Vv(i,e){return{supported:!1,configurations:e,decodingInfoResults:[YS],error:i}}function jS(i,e,t,s,r,n){const a=i.videoCodec,o=i.audioCodec?i.audioGroups:null,l=n?.audioCodec,d=n?.channels,u=d?parseInt(d):l?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((h,f)=>{if(f){const m=e.groups[f];if(!m)throw new Error(`Audio track group ${f} not found`);Object.keys(m.channels).forEach(g=>{h[g]=(h[g]||0)+m.channels[g]})}return h},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(h=>iu(h))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!c&&j(u)&&Object.keys(c).some(h=>parseInt(h)>u)}function Wv(i,e,t,s={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(Kv);const n=[],a=zS(i),o=a.length,l=QS(i,e,o>0),d=l.length;for(let u=o||1*d||1;u--;){const c={type:"media-source"};if(o&&(c.video=a[u%o]),d){c.audio=l[u%d];const h=c.audio.bitrate;c.video&&h&&(c.video.bitrate-=h)}n.push(c)}if(r){const u=navigator.userAgent;if(r.split(",").some(c=>iu(c))&&Gv())return Promise.resolve(Vv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),n))}return Promise.all(n.map(u=>{const c=ZS(u);return s[c]||(s[c]=t.decodingInfo(u))})).then(u=>({supported:!u.some(c=>!c.supported),configurations:n,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:n,decodingInfoResults:[],error:u}))}function zS(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=qv(i),r=i.width||640,n=i.height||480,a=i.frameRate||30,o=i.videoRange.toLowerCase();return t?t.map(l=>{const d={contentType:Ga(WS(l),"video"),width:r,height:n,bitrate:s,framerate:a};return o!=="sdr"&&(d.transferFunction=o),d}):[]}function QS(i,e,t){var s;const r=(s=i.audioCodec)==null?void 0:s.split(","),n=qv(i);return r&&i.audioGroups?i.audioGroups.reduce((a,o)=>{var l;const d=o?(l=e.groups[o])==null?void 0:l.tracks:null;return d?d.reduce((u,c)=>{if(c.groupId===o){const h=parseFloat(c.channels||"");r.forEach(f=>{const m={contentType:Ga(f,"audio"),bitrate:t?XS(f,n):n};h&&(m.channels=""+h),u.push(m)})}return u},a):a},[]):[]}function XS(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function qv(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function ZS(i){let e="";const{audio:t,video:s}=i;if(s){const r=kc(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=kc(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const Dc=["NONE","TYPE-0","TYPE-1",null];function JS(i){return Dc.indexOf(i)>-1}const yd=["SDR","PQ","HLG"];function e1(i){return!!i&&yd.indexOf(i)>-1}var Zo={No:"",Yes:"YES",v2:"v2"};function Ap(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,r=s<e/2;return e&&r?t?Zo.v2:Zo.Yes:Zo.No}class Sp{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ka{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ip(this._audioGroups,e)}hasSubtitleGroup(e){return Ip(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Ip(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function t1(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function i1(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||yd.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&t1(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const s1=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Me=(i,e)=>JSON.stringify(i,s1(e));function r1(i,e,t,s,r){const n=Object.keys(i),a=s?.channels,o=s?.audioCodec,l=r?.videoCodec,d=a&&parseInt(a)===2;let u=!1,c=!1,h=1/0,f=1/0,m=1/0,g=1/0,p=0,E=[];const{preferHDR:T,allowedVideoRanges:y}=i1(e,r);for(let R=n.length;R--;){const x=i[n[R]];u||(u=x.channels[2]>0),h=Math.min(h,x.minHeight),f=Math.min(f,x.minFramerate),m=Math.min(m,x.minBitrate),y.filter(M=>x.videoRanges[M]>0).length>0&&(c=!0)}h=j(h)?h:0,f=j(f)?f:0;const b=Math.max(1080,h),A=Math.max(30,f);m=j(m)?m:t,t=Math.max(m,t),c||(e=void 0);const L=n.length>1;return{codecSet:n.reduce((R,x)=>{const I=i[x];if(x===R)return R;if(E=c?y.filter(M=>I.videoRanges[M]>0):[],L){if(I.minBitrate>t)return bi(x,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),R;if(!I.hasDefaultAudio)return bi(x,"no renditions with default or auto-select sound found"),R;if(o&&x.indexOf(o.substring(0,4))%5!==0)return bi(x,`audio codec preference "${o}" not found`),R;if(a&&!d){if(!I.channels[a])return bi(x,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),R}else if((!o||d)&&u&&I.channels[2]===0)return bi(x,"no renditions with stereo sound found"),R;if(I.minHeight>b)return bi(x,`min resolution of ${I.minHeight} > maximum of ${b}`),R;if(I.minFramerate>A)return bi(x,`min framerate of ${I.minFramerate} > maximum of ${A}`),R;if(!E.some(M=>I.videoRanges[M]>0))return bi(x,`no variants with VIDEO-RANGE of ${Me(E)} found`),R;if(l&&x.indexOf(l.substring(0,4))%5!==0)return bi(x,`video codec preference "${l}" not found`),R;if(I.maxScore<p)return bi(x,`max score of ${I.maxScore} < selected max of ${p}`),R}return R&&(vd(x)>=vd(R)||I.fragmentError>i[R].fragmentError)?R:(g=I.minIndex,p=I.maxScore,x)},void 0),videoRanges:E,preferHDR:T,minFramerate:f,minBitrate:m,minIndex:g}}function bi(i,e){Re.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function Yv(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function n1(i,e,t,s){return i.slice(t,s+1).reduce((r,n,a)=>{if(!n.codecSet)return r;const o=n.audioGroups;let l=r[n.codecSet];l||(r[n.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,n.bitrate);const d=Math.min(n.height,n.width);return l.minHeight=Math.min(l.minHeight,d),l.minFramerate=Math.min(l.minFramerate,n.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,n.score),l.fragmentError+=n.fragmentError,l.videoRanges[n.videoRange]=(l.videoRanges[n.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const c=e.groups[u];c&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?c.hasDefault:c.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(c.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+c.channels[h]}))}),r},{})}function Lp(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:n}=i;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:n}}function Gi(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(gr(i,r,t))return s}return-1}function gr(i,e,t){const{groupId:s,name:r,lang:n,assocLang:a,default:o}=i,l=i.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(n===void 0||a1(n,e.lang))&&(n===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||o1(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function a1(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function o1(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function Zs(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function l1(i,e,t,s,r){const n=e[s],o=e.reduce((h,f,m)=>{const g=f.uri;return(h[g]||(h[g]=[])).push(m),h},{})[n.uri];o.length>1&&(s=Math.max.apply(Math,o));const l=n.videoRange,d=n.frameRate,u=n.codecSet.substring(0,4),c=Rp(e,s,h=>{if(h.videoRange!==l||h.frameRate!==d||h.codecSet.substring(0,4)!==u)return!1;const f=h.audioGroups,m=t.filter(g=>!f||f.indexOf(g.groupId)!==-1);return Gi(i,m,r)>-1});return c>-1?c:Rp(e,s,h=>{const f=h.audioGroups,m=t.filter(g=>!f||f.indexOf(g.groupId)!==-1);return Gi(i,m,r)>-1})}function Rp(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function Td(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class d1 extends si{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:n,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!r||!l)return;const d=performance.now(),u=n?n.stats:r.stats,c=n?n.duration:r.duration,h=d-u.loading.start,f=a.minAutoLevel,m=r.level,g=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const p=g>-1&&g!==m,E=!!t||p;if(!E&&(l.paused||!l.playbackRate||!l.readyState))return;const T=a.mainForwardBufferInfo;if(!E&&T===null)return;const y=this.bwEstimator.getEstimateTTFB(),b=Math.abs(l.playbackRate);if(h<=Math.max(y,1e3*(c/(b*2))))return;const A=T?T.len/b:0,L=u.loading.first?u.loading.first-u.loading.start:-1,S=u.loaded&&L>-1,R=this.getBwEstimate(),x=a.levels,I=x[m],M=Math.max(u.loaded,Math.round(c*(r.bitrate||I.averageBitrate)/8));let $=S?h-L:h;$<1&&S&&($=Math.min(h,u.loaded*8/R));const V=S?u.loaded*1e3/$:0,q=y/1e3,H=V?(M-u.loaded)/V:M*8/R+q;if(H<=A)return;const N=V?V*8:R,W=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,B=this.hls.config.abrBandWidthUpFactor;let Y=Number.POSITIVE_INFINITY,ee;for(ee=m-1;ee>f;ee--){const pe=x[ee].maxBitrate,de=!x[ee].details||W;if(Y=this.getTimeToLoadFrag(q,N,c*pe,de),Y<Math.min(A,c+q))break}if(Y>=H||Y>c*10)return;S?this.bwEstimator.sample(h-Math.min(y,L),u.loaded):this.bwEstimator.sampleTTFB(h);const U=x[ee].maxBitrate;this.getBwEstimate()*B>U&&this.resetEstimator(U);const F=this.findBestLevel(U,f,ee,0,A,1,1);F>-1&&(ee=F),this.warn(`Fragment ${r.sn}${n?" part "+n.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${H.toFixed(3)} s
      Estimated load time for down switch fragment: ${Y.toFixed(3)} s
      TTFB estimate: ${L|0} ms
      Current BW estimate: ${j(R)?R|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ee} @ ${U|0} bps`),a.nextLoadLevel=a.nextAutoLevel=ee,this.clearTimer();const ne=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ee&&ee>0){const pe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ee>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${pe.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ee>f){let de=this.findBestLevel(this.hls.levels[f].bitrate,f,ee,0,pe,1,1);de===-1&&(de=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=de,this.resetEstimator(this.hls.levels[de].bitrate)}}};p||H>Y*2?ne():this.timer=self.setInterval(ne,Y*1e3),a.trigger(v.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:n,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new mS(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(v.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case C.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:n}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const a=performance.now(),o=n?n.stats:s.stats,l=a-o.loading.start,d=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&d>-1){const c=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(c,d),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,r){const n=e+s/t,a=r?e+this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,n=r.end-r.first;j(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===Z.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const n=s?s.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const n={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(v.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,n=r!=null&&r.stats.loaded?r.stats:s.stats;if(n.aborted||this.ignoreFragment(s))return;const a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Z.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,n=this.findBestLevel(s,t,e,0,r,1,1);if(n>-1)return n;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:n,minAutoLevel:a}=s,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),d=this.getStarvationDelay();let u=n.abrBandWidthFactor,c=n.abrBandWidthUpFactor;if(d){const p=this.findBestLevel(l,a,r,d,0,u,c);if(p>=0)return this.rebufferNotice=-1,p}let h=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay;if(!d){const p=this.bitrateTestDelay;p&&(h=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-p,this.info(`bitrate test took ${Math.round(1e3*p)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=c=1)}const f=this.findBestLevel(l,a,r,d,h,u,c);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const m=s.levels[a],g=s.loadLevelObj;return g&&m?.bitrate<g.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,n,a,o){var l;const d=r+n,u=this.lastLoadedFragLevel,c=u===-1?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:f}=this,{levels:m,allAudioTracks:g,loadLevel:p,config:E}=this.hls;if(m.length===1)return 0;const T=m[c],y=!!((l=this.hls.latestLevelDetails)!=null&&l.live),b=p===-1||u===-1;let A,L="SDR",S=T?.frameRate||0;const{audioPreference:R,videoPreference:x}=E,I=this.audioTracksByGroup||(this.audioTracksByGroup=Yv(g));let M=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const N=this.codecTiers||(this.codecTiers=n1(m,I,t,s)),W=r1(N,L,e,R,x),{codecSet:B,videoRanges:Y,minFramerate:ee,minBitrate:U,minIndex:F,preferHDR:ne}=W;M=F,A=B,L=ne?Y[Y.length-1]:Y[0],S=ee,e=Math.max(e,U),this.log(`picked start tier ${Me(W)}`)}else A=T?.codecSet,L=T?.videoRange;const $=f?f.duration:h?h.duration:0,V=this.bwEstimator.getEstimateTTFB()/1e3,q=[];for(let N=s;N>=t;N--){var H;const W=m[N],B=N>c;if(!W)continue;if(E.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const de=navigator.mediaCapabilities;typeof de?.decodingInfo=="function"&&jS(W,I,L,S,e,R)?(W.supportedPromise=Wv(W,I,de,this.supportedCache),W.supportedPromise.then(fe=>{if(!this.hls)return;W.supportedResult=fe;const rt=this.hls.levels,ze=rt.indexOf(W);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${ze} ${Me(fe)}`):fe.supported?fe.decodingInfoResults.some(At=>At.smooth===!1||At.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ze} not smooth or powerEfficient: ${Me(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ze} ${Me(fe)}`),ze>-1&&rt.length>1&&(this.log(`Removing unsupported level ${ze}`),this.hls.removeLevel(ze),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):W.supportedResult=Kv}if((A&&W.codecSet!==A||L&&W.videoRange!==L||B&&S>W.frameRate||!B&&S>0&&S<W.frameRate||(H=W.supportedResult)!=null&&(H=H.decodingInfoResults)!=null&&H.some(de=>de.smooth===!1))&&(!b||N!==M)){q.push(N);continue}const Y=W.details,ee=(f?Y?.partTarget:Y?.averagetargetduration)||$;let U;B?U=o*e:U=a*e;const F=$&&r>=$*2&&n===0?W.averageBitrate:W.maxBitrate,ne=this.getTimeToLoadFrag(V,U,F*ee,Y===void 0);if(U>=F&&(N===u||W.loadError===0&&W.fragmentError===0)&&(ne<=V||!j(ne)||y&&!this.bitrateTestDelay||ne<d)){const de=this.forcedAutoLevel;return N!==p&&(de===-1||de!==p)&&(q.length&&this.trace(`Skipped level(s) ${q.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${m[q[0]].codecs}" ${m[q[0]].videoRange}; not compatible with "${A}" ${L}`),this.info(`switch candidate:${c}->${N} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-F)} ttfb:${V.toFixed(1)} avgDuration:${ee.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ne.toFixed(1)} firstSelection:${b} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${p}`)),b&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const jv={search:function(i,e){let t=0,s=i.length-1,r=null,n=null;for(;t<=s;){r=(t+s)/2|0,n=i[r];const a=e(n);if(a>0)t=r+1;else if(a<0)s=r-1;else return n}return null}};function u1(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!j(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let n=0;n<i.length;++n){const a=i[n];if(h1(e,t,a))return a}return null}function Sr(i,e,t=0,s=0,r=.005){let n=null;if(i){n=e[1+i.sn-e[0].sn]||null;const o=i.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),n&&i.level!==n.level&&n.end<=i.end&&(n=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(n=e[0]);if(n&&((!i||i.level===n.level)&&xp(t,s,n)===0||c1(n,i,Math.min(r,s))))return n;const a=jv.search(e,xp.bind(null,t,s));return a&&(a!==i||!n)?a:n}function c1(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,n)=>(n[0]==="INF"&&(r+=parseFloat(n[1])),r),t);return i.start<=s}return!1}function xp(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function h1(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function zv(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:r}=i;r&&(s=s.concat(r));let n;return jv.search(s,a=>a.cc<e?1:a.cc>e?-1:(n=a,a.end<=t?1:a.start>t?-1:0)),n||null}return null}function bd(i){switch(i.details){case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_TIMEOUT:case C.LEVEL_LOAD_TIMEOUT:case C.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Qv(i){return i.details.startsWith("key")}function Xv(i){return Qv(i)&&!!i.frag&&!i.frag.decryptdata}function kp(i,e){const t=bd(e);return i.default[`${t?"timeout":"error"}Retry`]}function Af(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function Dp(i){return Le(Le({},i),{errorRetry:null,timeoutRetry:null})}function _d(i,e,t,s){if(!i)return!1;const r=s?.code,n=e<i.maxNumRetry&&(f1(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,n):n}function f1(i){return Cc(i)||!!i&&(i<400||i>499)}function Cc(i){return i===0&&navigator.onLine===!1}var vt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Bt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class m1 extends si{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.ERROR,this.onError,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.ERROR,this.onError,this),e.off(v.ERROR,this.onErrorOut,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Z.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(a=>r.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,n=t.context;switch(t.details){case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case C.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=gn();return}case C.FRAG_GAP:case C.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=vt.SendAlternateToPenaltyBox;return}case C.LEVEL_EMPTY_ERROR:case C.LEVEL_PARSING_ERROR:{var a;const l=t.parent===Z.MAIN?t.level:r.loadLevel;t.details===C.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:typeof n?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level));return;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.SUBTITLE_LOAD_ERROR:case C.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const l=r.loadLevelObj;if(l&&(n.type===me.AUDIO_TRACK&&l.hasAudioGroup(n.groupId)||n.type===me.SUBTITLE_TRACK&&l.hasSubtitleGroup(n.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=vt.SendAlternateToPenaltyBox,t.errorAction.flags=Bt.MoveAllAlternatesMatchingHost;return}}return;case C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:vt.SendAlternateToPenaltyBox,flags:Bt.MoveAllAlternatesMatchingHDCP};return;case C.KEY_SYSTEM_SESSION_UPDATE_FAILED:case C.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case C.KEY_SYSTEM_NO_SESSION:t.errorAction={action:vt.SendAlternateToPenaltyBox,flags:Bt.MoveAllAlternatesMatchingKey};return;case C.BUFFER_ADD_CODEC_ERROR:case C.REMUX_ALLOC_ERROR:case C.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:r.loadLevel)}return;case C.INTERNAL_EXCEPTION:case C.BUFFER_APPENDING_ERROR:case C.BUFFER_FULL_ERROR:case C.LEVEL_SWITCH_ERROR:case C.BUFFER_STALLED_ERROR:case C.BUFFER_SEEK_OVER_HOLE:case C.BUFFER_NUDGE_ON_STALL:t.errorAction=gn();return}t.type===te.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=gn())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=kp(s.config.playlistLoadPolicy,e),n=this.playlistError++;if(_d(r,n,bd(e),e.response))return{action:vt.RetryRequest,flags:Bt.None,retryConfig:r,retryCount:n};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=n),o}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,o=kp(Qv(e)?a:n,e),l=t.levels.reduce((u,c)=>u+c.fragmentError,0);if(r&&(e.details!==C.FRAG_GAP&&r.fragmentError++,!Xv(e)&&_d(o,l,bd(e),e.response)))return{action:vt.RetryRequest,flags:Bt.None,retryConfig:o,retryCount:l};const d=this.getLevelSwitchAction(e,s);return o&&(d.retryConfig=o,d.retryCount=l),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var n,a;const d=e.details;r.loadError++,d===C.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:c,loadLevel:h,minAutoLevel:f,maxAutoLevel:m}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const g=(n=e.frag)==null?void 0:n.type,E=(g===Z.AUDIO&&d===C.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===C.BUFFER_ADD_CODEC_ERROR||d===C.BUFFER_APPEND_ERROR))&&c.some(({audioCodec:L})=>r.audioCodec!==L),y=e.sourceBufferName==="video"&&(d===C.BUFFER_ADD_CODEC_ERROR||d===C.BUFFER_APPEND_ERROR)&&c.some(({codecSet:L,audioCodec:S})=>r.codecSet!==L&&r.audioCodec===S),{type:b,groupId:A}=(a=e.context)!=null?a:{};for(let L=c.length;L--;){const S=(L+h)%c.length;if(S!==h&&S>=f&&S<=m&&c[S].loadError===0){var o,l;const R=c[S];if(d===C.FRAG_GAP&&g===Z.MAIN&&e.frag){const x=c[S].details;if(x){const I=Sr(e.frag,x.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(b===me.AUDIO_TRACK&&R.hasAudioGroup(A)||b===me.SUBTITLE_TRACK&&R.hasSubtitleGroup(A))continue;if(g===Z.AUDIO&&(o=r.audioGroups)!=null&&o.some(x=>R.hasAudioGroup(x))||g===Z.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(x=>R.hasSubtitleGroup(x))||E&&r.audioCodec===R.audioCodec||y&&r.codecSet===R.codecSet||!E&&r.codecSet!==R.codecSet)continue}u=S;break}}if(u>-1&&s.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:vt.SendAlternateToPenaltyBox,flags:Bt.None,nextAutoLevel:u}}return{action:vt.SendAlternateToPenaltyBox,flags:Bt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case vt.DoNothing:break;case vt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==C.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,n=s.nextAutoLevel;switch(r){case Bt.None:this.switchLevel(e,n);break;case Bt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),d=t.levels[l],u=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=Dc[Dc.indexOf(u)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Bt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const d=this.hls.levels,u=d.length;for(let h=u;h--;)if(this.variantHasKey(d[h],l)){var a,o;this.log(`Banned key found in level ${h} (${d[h].bitrate}bps) or audio group "${(a=d[h].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${It(l.keyId||[])}`),d[h].fragmentError++,d[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const c=e.frag;if(this.hls.levels.length<u)s.resolved=!0;else if(c&&c.type!==Z.MAIN){const h=c.decryptdata;h&&!l.matches(h)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===C.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=kc(e.mimeType),r=this.hls.levels;for(let n=r.length;n--;)r[n][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${n} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(n))}}}function gn(i){const e={action:vt.DoNothing,flags:Bt.None};return i&&(e.resolved=!0),e}var dt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class p1{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const n=s[r];if(!n)break;if(n.start<=e&&e<=n.end&&n.loaded)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,n=Object.keys(r);for(let a=n.length;a--;){const o=r[n[a]];if(o?.body.type===t&&(!s||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,r,n){this.timeRanges&&(this.timeRanges[e]=t);const a=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||n)){l.body.type===s&&this.removeFragment(l.body);return}const d=l.range[e];if(d){if(d.time.length===0){this.removeFragment(l.body);return}d.time.some(u=>{const c=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return c&&this.removeFragment(l.body),c})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=wr(s),n=this.fragments[r];if(!n||n.buffered&&s.gap)return;const a=!s.relurl;Object.keys(t).forEach(o=>{const l=s.elementaryStreams[o];if(!l)return;const d=t[o],u=a||l.partial===!0;n.range[o]=this.getBufferedTimes(s,e.part,u,d)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,(n.body.endList=s.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),yo(n)||this.removeParts(s.sn-1,s.type)):this.removeFragment(n.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Cp(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=wr(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,s,r){const n={time:[],partial:s},a=e.start,o=e.end,l=e.minEndPTS||o,d=e.maxStartPTS||a;for(let u=0;u<r.length;u++){const c=r.start(u)-this.bufferPadding,h=r.end(u)+this.bufferPadding;if(d>=c&&l<=h){n.time.push({startPTS:Math.max(a,r.start(u)),endPTS:Math.min(o,r.end(u))});break}else if(a<h&&o>c){const f=Math.max(a,r.start(u)),m=Math.min(o,r.end(u));m>f&&(n.partial=!0,n.time.push({startPTS:f,endPTS:m}))}else if(o<=c)break}return n}getPartialFragment(e){let t=null,s,r,n,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(d=>{const u=l[d];u&&yo(u)&&(r=u.body.start-o,n=u.body.end+o,e>=r&&e<=n&&(s=Math.min(e-r,n-e),a<=s&&(t=u.body,a=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||yo(t))}getState(e){const t=wr(e),s=this.fragments[t];return s?s.buffered?yo(s)?dt.PARTIAL:dt.OK:dt.APPENDING:dt.NOT_LOADED}isTimeBuffered(e,t,s){let r,n;for(let a=0;a<s.length;a++){if(r=s.start(a)-this.bufferPadding,n=s.end(a)+this.bufferPadding,e>=r&&t<=n)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,n=wr(s);this.fragments[n]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:n,type:a}=t;if(s.sn==="initSegment")return;const o=s.type;if(r){let d=this.activePartLists[o];d||(this.activePartLists[o]=d=[]),d.push(r)}this.timeRanges=n;const l=n[a];this.detectEvictedFragments(a,l,o,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=wr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const n=t[s[r]];if(n?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,n){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==s||r&&!l.gap||l.start<t&&l.end>e&&(o.buffered||n)&&this.removeFragment(l)})}removeFragment(e){const t=wr(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=Cp(s,n=>n.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function yo(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function wr(i){return`${i.type}_${i.level}_${i.sn}`}function Cp(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Hs={cbc:0,ctr:1};class g1{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Hs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Hs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function v1(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class E1{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],n=s[1],a=s[2],o=s[3],l=this.invSubMix,d=l[0],u=l[1],c=l[2],h=l[3],f=new Uint32Array(256);let m=0,g=0,p=0;for(p=0;p<256;p++)p<128?f[p]=p<<1:f[p]=p<<1^283;for(p=0;p<256;p++){let E=g^g<<1^g<<2^g<<3^g<<4;E=E>>>8^E&255^99,e[m]=E,t[E]=m;const T=f[m],y=f[T],b=f[y];let A=f[E]*257^E*16843008;r[m]=A<<24|A>>>8,n[m]=A<<16|A>>>16,a[m]=A<<8|A>>>24,o[m]=A,A=b*16843009^y*65537^T*257^m*16843008,d[E]=A<<24|A>>>8,u[E]=A<<16|A>>>16,c[E]=A<<8|A>>>24,h[E]=A,m?(m=T^f[f[f[b^T]]],g^=f[f[g]]):m=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const a=this.ksRows=(n+6+1)*4;let o,l;const d=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),c=this.sBox,h=this.rcon,f=this.invSubMix,m=f[0],g=f[1],p=f[2],E=f[3];let T,y;for(o=0;o<a;o++){if(o<n){T=d[o]=t[o];continue}y=T,o%n===0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[y&255],y^=h[o/n|0]<<24):n>6&&o%n===4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[y&255]),d[o]=T=(d[o-n]^y)>>>0}for(l=0;l<a;l++)o=a-l,l&3?y=d[o]:y=d[o-4],l<4||o<=4?u[l]=y:u[l]=m[c[y>>>24]]^g[c[y>>>16&255]]^p[c[y>>>8&255]]^E[c[y&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],d=o[1],u=o[2],c=o[3],h=this.uint8ArrayToUint32Array_(s);let f=h[0],m=h[1],g=h[2],p=h[3];const E=new Int32Array(e),T=new Int32Array(E.length);let y,b,A,L,S,R,x,I,M,$,V,q,H,N;const W=this.networkToHostOrderSwap;for(;t<E.length;){for(M=W(E[t]),$=W(E[t+1]),V=W(E[t+2]),q=W(E[t+3]),S=M^n[0],R=q^n[1],x=V^n[2],I=$^n[3],H=4,N=1;N<r;N++)y=l[S>>>24]^d[R>>16&255]^u[x>>8&255]^c[I&255]^n[H],b=l[R>>>24]^d[x>>16&255]^u[I>>8&255]^c[S&255]^n[H+1],A=l[x>>>24]^d[I>>16&255]^u[S>>8&255]^c[R&255]^n[H+2],L=l[I>>>24]^d[S>>16&255]^u[R>>8&255]^c[x&255]^n[H+3],S=y,R=b,x=A,I=L,H=H+4;y=a[S>>>24]<<24^a[R>>16&255]<<16^a[x>>8&255]<<8^a[I&255]^n[H],b=a[R>>>24]<<24^a[x>>16&255]<<16^a[I>>8&255]<<8^a[S&255]^n[H+1],A=a[x>>>24]<<24^a[I>>16&255]<<16^a[S>>8&255]<<8^a[R&255]^n[H+2],L=a[I>>>24]<<24^a[S>>16&255]<<16^a[R>>8&255]<<8^a[x&255]^n[H+3],T[t]=W(y^f),T[t+1]=W(L^m),T[t+2]=W(A^g),T[t+3]=W(b^p),f=M,m=$,g=V,p=q,t=t+4}return T.buffer}}class y1{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=T1(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function T1(i){switch(i){case Hs.cbc:return"AES-CBC";case Hs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const b1=16;class Sf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?v1(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((n,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,s,r);const l=this.flush();l?n(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:n,currentResult:a,remainderData:o}=this;if(r!==Hs.cbc||t.byteLength!==16)return Re.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=ii(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;n&&(s=n);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new E1),d.expandKey(t);const u=a;return this.currentResult=d.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new y1(this.subtle,t,r)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new g1(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(Re.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%b1;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Re.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const wp=Math.pow(2,17);class _1{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new ns({type:te.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,n=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Pp(e));return}else e.gap=!1;const d=this.loader=n?new n(r):new a(r),u=Mp(e);e.loader=d;const c=Dp(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:wp};e.stats=d.stats;const f={onSuccess:(m,g,p,E)=>{this.resetLoader(e,d);let T=m.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),o({frag:e,part:null,payload:T,networkDetails:E})},onError:(m,g,p,E)=>{this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Le({url:s,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:p,stats:E}))},onAbort:(m,g,p)=>{this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:m}))},onTimeout:(m,g,p)=>{this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:m}))}};t&&(f.onProgress=(m,g,p,E)=>t({frag:e,part:null,payload:p,networkDetails:E})),d.load(u,h,f)})}loadPart(e,t,s){this.abort();const r=this.config,n=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Pp(e,t));return}const d=this.loader=n?new n(r):new a(r),u=Mp(e,t);e.loader=d;const c=Dp(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:wp};t.stats=d.stats,d.load(u,h,{onSuccess:(f,m,g,p)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:f.data,networkDetails:p};s(E),o(E)},onError:(f,m,g,p)=>{this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Le({url:u.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:g,stats:p}))},onAbort:(f,m,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:f}))},onTimeout:(f,m,g)=>{this.resetLoader(e,d),l(new ns({type:te.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:g,stats:f}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,n=r.total;if(s.loaded+=r.loaded,n){const l=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/n),l),c=(l-d)*Math.round(s.loaded/d);s.total=s.loaded+c}else s.total=Math.max(s.loaded,s.total);const a=s.loading,o=r.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Mp(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(j(r)&&j(n)){var a;let o=r,l=n;if(i.sn==="initSegment"&&A1((a=i.decryptdata)==null?void 0:a.method)){const d=n-r;d%16&&(l=n+(16-d%16)),r!==0&&(s.resetIV=!0,o=r-16)}s.rangeStart=o,s.rangeEnd=l}return s}function Pp(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:te.MEDIA_ERROR,details:C.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new ns(s)}function A1(i){return i==="AES-128"||i==="AES-256"}class ns extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Zv extends si{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class If{constructor(e,t,s,r=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=To(),this.buffering={audio:To(),video:To(),audiovideo:To()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=n,this.partial=a}}function To(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Op={length:0,start:()=>0,end:()=>0};class le{static isBuffered(e,t){if(e){const s=le.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=le.getBuffered(e);return le.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=le.bufferedRanges(e);if(r.length)return le.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((u,c)=>u.start-c.start||c.end-u.end);let r=-1,n=[];if(s)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(r=u);const c=n.length;if(c){const h=n[c-1].end;e[u].start-h<s?e[u].end>h&&(n[c-1].end=e[u].end):n.push(e[u])}else n.push(e[u])}else n=e;let a=0,o,l=t,d=t;for(let u=0;u<n.length;u++){const c=n[u].start,h=n[u].end;if(r===-1&&t>=c&&t<=h&&(r=u),t+s>=c&&t<h)l=c,d=h,a=d-t;else if(t+s<c){o=c;break}}return{len:a,start:l||0,end:d||0,nextStart:o,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Op}catch(t){return Re.log("failed to get media.buffered",t),Op}}}const Jv=/\{\$([a-zA-Z0-9-_]+)\}/g;function Np(i){return Jv.test(i)}function wc(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(Jv,s=>{const r=s.substring(2,s.length-1),n=t?.[r];return n===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):n})}return e}function Up(i,e,t){let s=i.variableList;s||(i.variableList=s={});let r,n;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))n=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,n=e.VALUE;r in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=n||""}function S1(i,e,t){const s=e.IMPORT;if(t&&s in t){let r=i.variableList;r||(i.variableList=r={}),r[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const I1=/^(\d+)x(\d+)$/,$p=/(.+?)=(".*?"|.*?)(?:,|$)/g;class He{constructor(e,t){typeof e=="string"&&(e=He.parseAttrList(e,t)),De(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,n)=>(r[n.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=I1.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={};for($p.lastIndex=0;(s=$p.exec(e))!==null;){const a=s[1].trim();let o=s[2];const l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let d=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(l||d))o=wc(t,o);else if(!d&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Re.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=o}return r}}const L1="com.apple.hls.interstitial";function R1(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function x1(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class eE{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:s,t){const n=t.attr;for(const a in n)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==n[a]){Re.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=De(new He({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=t?.endDate||new Date(this.attr["END-DATE"]);j(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Re.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(j(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===L1}get isValid(){return!!this.id&&!this._badValueForSameId&&j(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const k1=10;class D1{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?j(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||k1}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ad(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function Fp(i,e){return!i&&!e?!0:!i||!e?!1:Ad(i,e)}function vn(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function Lf(i){switch(i){case"AES-128":case"AES-256":return Hs.cbc;case"AES-256-CTR":return Hs.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function Rf(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Mc(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function C1(i){const e=Mc(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function tE(i){const e=function(s,r,n){const a=s[r];s[r]=s[n],s[n]=a};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function iE(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const n=r[0]==="base64",a=r[1];n?(s.splice(-1,1),t=Rf(a)):t=C1(a)}}return t}const Sd=typeof self<"u"?self:void 0;var Ge={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Et={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Jo(i){switch(i){case Et.FAIRPLAY:return Ge.FAIRPLAY;case Et.PLAYREADY:return Ge.PLAYREADY;case Et.WIDEVINE:return Ge.WIDEVINE;case Et.CLEARKEY:return Ge.CLEARKEY}}function Uu(i){switch(i){case Ge.FAIRPLAY:return Et.FAIRPLAY;case Ge.PLAYREADY:return Et.PLAYREADY;case Ge.WIDEVINE:return Et.WIDEVINE;case Ge.CLEARKEY:return Et.CLEARKEY}}function ia(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[Ge.FAIRPLAY,Ge.WIDEVINE,Ge.PLAYREADY,Ge.CLEARKEY].filter(r=>!!e[r]):[];return!s[Ge.WIDEVINE]&&t&&s.push(Ge.WIDEVINE),s}const sE=(function(i){return Sd!=null&&(i=Sd.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function w1(i,e,t,s){let r;switch(i){case Ge.FAIRPLAY:r=["cenc","sinf"];break;case Ge.WIDEVINE:case Ge.PLAYREADY:r=["cenc"];break;case Ge.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return M1(r,e,t,s)}function M1(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs=${n}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs=${n}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function P1(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function rE(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Rf(o).subarray(0,16);return tE(l),l}}return null}let bo={};class vr{static clearKeyUriToKeyIdMap(){bo={}}static setKeyIdForUri(e,t){bo[e]=t}constructor(e,t,s,r=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!vn(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(wv(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Ad(e.keyFormatVersions,this.keyFormatVersions)&&Fp(e.iv,this.iv)&&Fp(e.keyId,this.keyId)}isSupported(){if(this.method){if(vn(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Et.FAIRPLAY:case Et.WIDEVINE:case Et.PLAYREADY:case Et.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(vn(this.method)){let n=this.iv;return n||(typeof e!="number"&&(Re.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),n=N1(e)),new vr(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.keyId){const n=bo[this.uri];if(n&&!Ad(this.keyId,n)&&vr.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=iE(this.uri);if(s)switch(this.keyFormat){case Et.WIDEVINE:if(this.pssh=s,!this.keyId){const n=FS(s.buffer);if(n.length){var r;const a=n[0];this.keyId=(r=a.kids)!=null&&r.length?a.kids[0]:null}}this.keyId||(this.keyId=Bp(t));break;case Et.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=$S(n,null,s),this.keyId=rE(s);break}default:{let n=s.subarray(0,16);if(n.length!==16){const a=new Uint8Array(16);a.set(n,16-n.length),n=a}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n;n=O1(t),n||(n=Bp(t),n||(n=bo[this.uri])),n&&(this.keyId=n,vr.setKeyIdForUri(this.uri,n))}return this}}function O1(i){const e=i?.[Et.WIDEVINE];return e?e.keyId:null}function Bp(i){const e=i?.[Et.PLAYREADY];if(e){const t=iE(e.uri);if(t)return rE(t)}return null}function N1(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const Hp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Gp=/#EXT-X-MEDIA:(.*)/g,U1=/^#EXT(?:INF|-X-TARGETDURATION):/m,$u=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),$1=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ki{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return Ef.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return U1.test(e)}static parseMasterPlaylist(e,t){const s=Np(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},n=[];if(Hp.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let a;for(;(a=Hp.exec(e))!=null;)if(a[1]){var o;const d=new He(a[1],r),u=wc(r,a[2]),c={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Ki.resolve(u,t)},h=d.decimalResolution("RESOLUTION");h&&(c.width=h.width,c.height=h.height),Wp(d.CODECS,c);const f=d["SUPPLEMENTAL-CODECS"];f&&(c.supplemental={},Wp(f,c.supplemental)),(o=c.unknownCodecs)!=null&&o.length||n.push(c),r.levels.push(c)}else if(a[3]){const d=a[3],u=a[4];switch(d){case"SESSION-DATA":{const c=new He(u,r),h=c["DATA-ID"];h&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[h]=c);break}case"SESSION-KEY":{const c=Kp(u,t,r);c.encrypted&&c.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(c)):Re.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const c=new He(u,r);Up(r,c,t)}break}case"CONTENT-STEERING":{const c=new He(u,r);r.contentSteering={uri:Ki.resolve(c["SERVER-URI"],t),pathwayId:c["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Vp(u);break}}}const l=n.length>0&&n.length<r.levels.length;return r.levels=l?n:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const n={},a=s.levels,o={AUDIO:a.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:a.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Gp.lastIndex=0;(r=Gp.exec(e))!==null;){const d=new He(r[1],s),u=d.TYPE;if(u){const c=o[u],h=n[u]||[];n[u]=h;const f=d.LANGUAGE,m=d["ASSOC-LANGUAGE"],g=d.CHANNELS,p=d.CHARACTERISTICS,E=d["INSTREAM-ID"],T={attrs:d,bitrate:0,id:l++,groupId:d["GROUP-ID"]||"",name:d.NAME||f||"",type:u,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:f,url:d.URI?Ki.resolve(d.URI,t):""};if(m&&(T.assocLang=m),g&&(T.channels=g),p&&(T.characteristics=p),E&&(T.instreamId=E),c!=null&&c.length){const y=Ki.findGroup(c,T.groupId)||c[0];qp(T,y,"audioCodec"),qp(T,y,"textCodec")}h.push(T)}}return n}static parseLevelPlaylist(e,t,s,r,n,a){var o;const l={url:t},d=new D1(t),u=d.fragments,c=[];let h=null,f=0,m=0,g=0,p=0,E=0,T=null,y=new Pu(r,l),b,A,L,S=-1,R=!1,x=null,I;if($u.lastIndex=0,d.m3u8=e,d.hasVariableRefs=Np(e),((o=$u.exec(e))==null?void 0:o[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(b=$u.exec(e))!==null;){R&&(R=!1,y=new Pu(r,l),y.playlistOffset=g,y.setStart(g),y.sn=f,y.cc=p,E&&(y.bitrate=E),y.level=s,h&&(y.initSegment=h,h.rawProgramDateTime&&(y.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),x&&(y.setByteRange(x),x=null)));const q=b[1];if(q){y.duration=parseFloat(q);const H=(" "+b[2]).slice(1);y.title=H||null,y.tagList.push(H?["INF",q,H]:["INF",q])}else if(b[3]){if(j(y.duration)){y.playlistOffset=g,y.setStart(g),L&&jp(y,L,d),y.sn=f,y.level=s,y.cc=p,u.push(y);const H=(" "+b[3]).slice(1);y.relurl=wc(d,H),Pc(y,T,c),T=y,g+=y.duration,f++,m=0,R=!0}}else{if(b=b[0].match($1),!b){Re.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<b.length&&b[A]===void 0;A++);const H=(" "+b[A]).slice(1),N=(" "+b[A+1]).slice(1),W=b[A+2]?(" "+b[A+2]).slice(1):null;switch(H){case"BYTERANGE":T?y.setByteRange(N,T):y.setByteRange(N);break;case"PROGRAM-DATE-TIME":y.rawProgramDateTime=N,y.tagList.push(["PROGRAM-DATE-TIME",N]),S===-1&&(S=u.length);break;case"PLAYLIST-TYPE":d.type&&Zi(d,H,b),d.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Zi(d,H,b):u.length>0&&zp(d,H,b),f=d.startSN=parseInt(N);break;case"SKIP":{d.skippedSegments&&Zi(d,H,b);const B=new He(N,d),Y=B.decimalInteger("SKIPPED-SEGMENTS");if(j(Y)){d.skippedSegments+=Y;for(let U=Y;U--;)u.push(null);f+=Y}const ee=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(ee.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Zi(d,H,b),d.targetduration=Math.max(parseInt(N),1);break;case"VERSION":d.version!==null&&Zi(d,H,b),d.version=parseInt(N);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Zi(d,H,b),d.live=!1;break;case"#":(N||W)&&y.tagList.push(W?[N,W]:[N]);break;case"DISCONTINUITY":p++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([H]);break;case"BITRATE":y.tagList.push([H,N]),E=parseInt(N)*1e3,j(E)?y.bitrate=E:E=0;break;case"DATERANGE":{const B=new He(N,d),Y=new eE(B,d.dateRanges[B.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Y.isValid||d.skippedSegments?d.dateRanges[Y.id]=Y:Re.warn(`Ignoring invalid DATERANGE tag: "${N}"`),y.tagList.push(["EXT-X-DATERANGE",N]);break}case"DEFINE":{{const B=new He(N,d);"IMPORT"in B?S1(d,B,a):Up(d,B,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Zi(d,H,b):u.length>0&&zp(d,H,b),d.startCC=p=parseInt(N);break;case"KEY":{const B=Kp(N,t,d);if(B.isSupported()){if(B.method==="NONE"){L=void 0;break}L||(L={});const Y=L[B.keyFormat];Y!=null&&Y.matches(B)||(Y&&(L=De({},L)),L[B.keyFormat]=B)}else Re.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${N}"`);break}case"START":d.startTimeOffset=Vp(N);break;case"MAP":{const B=new He(N,d);if(y.duration){const Y=new Pu(r,l);Yp(Y,B,s,L),h=Y,y.initSegment=h,h.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=h.rawProgramDateTime)}else{const Y=y.byteRangeEndOffset;if(Y){const ee=y.byteRangeStartOffset;x=`${Y-ee}@${ee}`}else x=null;Yp(y,B,s,L),h=y,R=!0}h.cc=p;break}case"SERVER-CONTROL":{I&&Zi(d,H,b),I=new He(N),d.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),d.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Zi(d,H,b);const B=new He(N);d.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=d.partList;B||(B=d.partList=[]);const Y=m>0?B[B.length-1]:void 0,ee=m++,U=new He(N,d),F=new SS(U,y,l,ee,Y);B.push(F),y.duration+=F.duration;break}case"PRELOAD-HINT":{const B=new He(N,d);d.preloadHint=B;break}case"RENDITION-REPORT":{const B=new He(N,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(B);break}default:Re.warn(`line parsed but not handled: ${b}`);break}}}T&&!T.relurl?(u.pop(),g-=T.duration,d.partList&&(d.fragmentHint=T)):d.partList&&(Pc(y,T,c),y.cc=p,d.fragmentHint=y,L&&jp(y,L,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const M=u.length,$=u[0],V=u[M-1];if(g+=d.skippedSegments*d.targetduration,g>0&&M&&V){d.averagetargetduration=g/M;const q=V.sn;d.endSN=q!=="initSegment"?q:0,d.live||(V.endList=!0),S>0&&(B1(u,S),$&&c.unshift($))}return d.fragmentHint&&(g+=d.fragmentHint.duration),d.totalduration=g,c.length&&d.dateRangeTagCount&&$&&nE(c,d),d.endCC=p,d}}function nE(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];i.push(o),t++}else return;const s=i[t-1],r=e.live?1/0:e.totalduration,n=Object.keys(e.dateRanges);for(let o=n.length;o--;){const l=e.dateRanges[n[o]],d=l.startDate.getTime();l.tagAnchor=s.ref;for(let u=t;u--;){var a;if(((a=i[u])==null?void 0:a.sn)<e.startSN)break;const c=F1(e,d,i,u,r);if(c!==-1){l.tagAnchor=e.fragments[c].ref;break}}}}function F1(i,e,t,s,r){const n=t[s];if(n){const o=n.programDateTime;if(e>=o||s===0){var a;const l=(((a=t[s+1])==null?void 0:a.start)||r)-n.start;if(e<=o+l*1e3){const d=t[s].sn-i.startSN;if(d<0)return-1;const u=i.fragments;if(u.length>t.length){const h=(t[s+1]||u[u.length-1]).sn-i.startSN;for(let f=h;f>d;f--){const m=u[f].programDateTime;if(e>=m&&e<m+u[f].duration*1e3)return f}}return d}}}return-1}function Kp(i,e,t){var s,r;const n=new He(i,t),a=(s=n.METHOD)!=null?s:"",o=n.URI,l=n.hexadecimalInteger("IV"),d=n.KEYFORMATVERSIONS,u=(r=n.KEYFORMAT)!=null?r:"identity";o&&n.IV&&!l&&Re.error(`Invalid IV: ${n.IV}`);const c=o?Ki.resolve(o,e):"",h=(d||"1").split("/").map(Number).filter(Number.isFinite);return new vr(a,c,u,h,l,n.KEYID)}function Vp(i){const t=new He(i).decimalFloatingPoint("TIME-OFFSET");return j(t)?t:null}function Wp(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(n=>bf(n,s));r.length&&(e[`${s}Codec`]=r.map(n=>n.split("/")[0]).join(","),t=t.filter(n=>r.indexOf(n)===-1))}),e.unknownCodecs=t}function qp(i,e,t){const s=e[t];s&&(i[t]=s)}function B1(i,e){let t=i[e];for(let s=e;s--;){const r=i[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function Pc(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Yp(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function jp(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(i)}function Zi(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function zp(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Fu(i,e){const t=e.startPTS;if(j(t)){let s=0,r;e.sn>i.sn?(s=t-i.start,r=i):(s=i.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function aE(i,e,t,s,r,n,a){s-t<=0&&(a.warn("Fragment should have a positive duration",e),s=t+e.duration,n=r+e.duration);let l=t,d=s;const u=e.startPTS,c=e.endPTS;if(j(u)){const E=Math.abs(u-t);i&&E>i.totalduration?a.warn(`media timestamps and playlist times differ by ${E}s for level ${e.level} ${i.url}`):j(e.deltaPTS)?e.deltaPTS=Math.max(E,e.deltaPTS):e.deltaPTS=E,l=Math.max(t,u),t=Math.min(t,u),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,d=Math.min(s,c),s=Math.max(s,c),n=e.endDTS!==void 0?Math.max(n,e.endDTS):n}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=s,e.minEndPTS=d,e.endDTS=n;const f=e.sn;if(!i||f<i.startSN||f>i.endSN)return 0;let m;const g=f-i.startSN,p=i.fragments;for(p[g]=e,m=g;m>0;m--)Fu(p[m],p[m-1]);for(m=g;m<p.length-1;m++)Fu(p[m],p[m+1]);return i.fragmentHint&&Fu(p[p.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,h}function H1(i,e,t){if(i===e)return;let s=null;const r=i.fragments;for(let u=r.length-1;u>=0;u--){const c=r[u].initSegment;if(c){s=c;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let n;V1(i,e,(u,c,h,f)=>{if((!e.startCC||e.skippedSegments)&&c.cc!==u.cc){const m=u.cc-c.cc;for(let g=h;g<f.length;g++)f[g].cc+=m;e.endCC=f[f.length-1].cc}j(u.startPTS)&&j(u.endPTS)&&(c.setStart(c.startPTS=u.startPTS),c.startDTS=u.startDTS,c.maxStartPTS=u.maxStartPTS,c.endPTS=u.endPTS,c.endDTS=u.endDTS,c.minEndPTS=u.minEndPTS,c.setDuration(u.endPTS-u.startPTS),c.duration&&(n=c),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(c.elementaryStreams=u.elementaryStreams),c.loader=u.loader,u.hasStats&&(c.stats=u.stats),u.initSegment&&(c.initSegment=u.initSegment,s=u.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(s&&o.forEach(u=>{var c;u&&(!u.initSegment||u.initSegment.relurl===((c=s)==null?void 0:c.relurl))&&(u.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=G1(i.dateRanges,e,t));const u=i.fragments.filter(c=>c.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let c=1;c<o.length;c++)o[c].programDateTime===null&&Pc(o[c],o[c-1],u);nE(u,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const u=dE(i,e.startSN-1);e.startCC=(l=u?.cc)!=null?l:a[0].cc}K1(i.partList,e.partList,(u,c)=>{c.elementaryStreams=u.elementaryStreams,c.stats=u.stats}),n?aE(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS,t):oE(i,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const u=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=u),e.driftEndTime=d,e.driftEnd=u}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function G1(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,n=De({},i);r&&r.forEach(l=>{delete n[l]});const o=Object.keys(n).length;return o?(Object.keys(s).forEach(l=>{const d=n[l],u=new eE(s[l].attr,d);u.isValid?(n[l]=u,d||(u.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Me(s[l].attr)}"`)}),n):s}function K1(i,e,t){if(i&&e){let s=0;for(let r=0,n=i.length;r<=n;r++){const a=i[r],o=e[r+s];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):s--}}}function V1(i,e,t){const s=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,n=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,a=e.startSN-i.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let d=r;d<=n;d++){const u=l[a+d];let c=o[d];if(s&&!c&&u&&(c=e.fragments[d]=u),u&&c){t(u,c,d,o);const h=u.relurl,f=c.relurl;if(h&&W1(h,f)){e.playlistParsingError=Qp(`media sequence mismatch ${c.sn}:`,i,e,u,c);return}else if(u.cc!==c.cc){e.playlistParsingError=Qp(`discontinuity sequence mismatch (${u.cc}!=${c.cc})`,i,e,u,c);return}}}}function Qp(i,e,t,s,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function oE(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,n=s>=0;let a=0;if(n&&s<r.length)a=r[s].start;else if(n&&e.startSN===i.endSN+1)a=i.fragmentEnd;else if(n&&t)a=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=i.fragmentStart;else return;Oc(e,a)}function Oc(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function lE(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const n=s[s.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function dE(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function Xp(i,e,t){return i?uE(i.partList,e,t):null}function uE(i,e,t){if(i)for(let s=i.length;s--;){const r=i[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function cE(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function W1(i,e){return i!==e&&e?Zp(i)!==Zp(e):!1}function Zp(i){return i.replace(/\?[^?]*$/,"")}function La(i,e){for(let s=0,r=i.length;s<r;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function q1(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function Jp(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function hE(i,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)Jp(t[s],i);e.fragmentHint&&Jp(e.fragmentHint,i),e.alignedSliding=!0}function Y1(i,e){i&&(fE(e,i),e.alignedSliding||Id(e,i),!e.alignedSliding&&!e.skippedSegments&&oE(i,e,!1))}function fE(i,e){if(!q1(e,i))return;const t=Math.min(e.endCC,i.endCC),s=La(e.fragments,t),r=La(i.fragments,t);if(!s||!r)return;Re.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const n=s.start-r.start;hE(n,i)}function Id(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,n;const a=Math.min(e.endCC,i.endCC);e.startCC<a&&i.startCC<a&&(r=La(s,a),n=La(t,a)),(!r||!n)&&(r=s[Math.floor(s.length/2)],n=La(t,r.cc)||t[Math.floor(t.length/2)]);const o=r.programDateTime,l=n.programDateTime;if(!o||!l)return;const d=(l-o)/1e3-(n.start-r.start);hE(d,i)}function Lt(i,e,t){Dt(i,e,t),i.addEventListener(e,t)}function Dt(i,e,t){i.removeEventListener(e,t)}const j1={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},P={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class xf extends Zv{constructor(e,t,s,r,n){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=P.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:d,state:u}=this,c=l?l.currentTime:0,h=le.bufferInfo(d||l,c,a.maxBufferHole),f=!h.len;if(this.log(`Media seeking to ${j(c)?c.toFixed(3):c}, state: ${u}, ${f?"out of":"in"} buffer`),this.state===P.ENDED)this.resetLoadingState();else if(o){const m=a.maxFragLookUpTolerance,g=o.start-m,p=o.start+o.duration+m;if(f||p<h.start||g>h.end){const E=c>p;(c<g||E)&&(E&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(c,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(c>m&&(this.lastCurrentTime=c),!this.loadingParts){const g=Math.max(h.end,c),p=this.shouldLoadParts(this.getLevelDetails(),g);p&&(this.log(`LL-Part loading ON after seeking to ${c.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=p)}}this.hls.hasEnoughToStart||(this.log(`Setting ${f?"startPosition":"nextLoadPosition"} to ${c} for seek without enough to start`),this.nextLoadPosition=c,f&&(this.startPosition=c)),f&&this.state===P.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new _1(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Sf(e.config)}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===P.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=P.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=le.bufferedInfo(n,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return le.isBuffered(this.media,u.start+u.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Lt(s,"seeking",this.onMediaSeeking),Lt(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===P.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Dt(r,"seeking",this.onMediaSeeking),Dt(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=P.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=n=>{const a=n.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${n.part?" part: "+n.part.index:""} of ${this.fragInfo(a,!1,n.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,s,r).then(n=>{if(!n)return;const a=this.state,o=n.frag;if(this.fragContextChanged(o)){(a===P.FRAG_LOADING||!this.fragCurrent&&a===P.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=P.IDLE);return}"payload"in n&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(v.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===P.STOPPED||this.state===P.ERROR||(this.warn(`Frag error: ${n?.message||n}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===dt.APPENDING){const n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===dt.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(v.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:n,payload:a}=s,o=n.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&vn(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Lf(o.method)).catch(d=>{throw r.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:n}),d}).then(d=>{const u=self.performance.now();return r.trigger(v.FRAG_DECRYPTED,{frag:n,payload:d,stats:{tstart:l,tdecrypt:u}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===P.STOPPED||this.state===P.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==P.STOPPED&&(this.state=P.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const n=e.tracks;if(n&&!t.encrypted&&((s=n.audio)!=null&&s.encrypted||(r=n.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(v.ERROR,{type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?j1.toString(le.getBuffered(s)):"(detached)"})`),it(e)){var r;if(e.type!==Z.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=P.IDLE;return}}const n=(r=this.levels)==null?void 0:r[e.level];n!=null&&n.fragmentError&&(this.log(`Resetting level fragment error count of ${n.fragmentError} on frag buffered`),n.fragmentError=0)}this.state=P.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:n}=e,a=!n||n.length===0||n.some(l=>!l),o=new If(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var n;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=P.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(v.KEY_LOADED,h),this.state===P.KEY_LOADING&&(this.state=P.IDLE),h}),this.hls.trigger(v.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(it(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=h)}if(s=Math.max(e.start,s||0),this.loadingParts&&it(e)){const h=a.partList;if(h&&r){s>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const f=this.getNextPart(h,e,s);if(f>-1){const m=h[f];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${f}/${h.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=P.FRAG_LOADING;let g;return o?g=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,m,t,r)).catch(p=>this.handleFragLoadError(p)):g=this.doFragPartsLoad(e,m,t,r).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(v.FRAG_LOADING,{frag:e,part:m,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(h,s))return Promise.resolve(null)}}if(it(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=a.partList)==null?void 0:d.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),j(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=P.FRAG_LOADING;const u=this.config.progressive;let c;return u&&o?c=o.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,r)).catch(h=>this.handleFragLoadError(h)):c=Promise.all([this.fragmentLoader.load(e,u?r:void 0),o]).then(([h])=>(!u&&r&&r(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(v.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,s,r){return new Promise((n,a)=>{var o;const l=[],d=(o=s.details)==null?void 0:o.partList,u=c=>{this.fragmentLoader.loadPart(e,c,r).then(h=>{l[c.index]=h;const f=h.part;this.hls.trigger(v.FRAG_LOADED,h);const m=Xp(s.details,e.sn,c.index+1)||uE(d,e.sn,c.index+1);if(m)u(m);else return n({frag:e,part:f,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===C.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===te.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(v.ERROR,t)}else this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==P.PARSING){!this.fragCurrent&&this.state!==P.STOPPED&&this.state!==P.ERROR&&(this.state=P.IDLE);return}const{frag:s,part:r,level:n}=t,a=self.performance.now();s.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const o=this.getLevelDetails(),d=o&&s.sn>o.endSN||this.shouldLoadParts(o,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,r,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const n=e.partList[0];if(n.fragment.type===Z.SUBTITLE)return!1;const a=n.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:n,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const o=t[r],l=o.details,d=a>-1?Xp(l,n,a):null,u=d?d.fragment:dE(l,n,s);return u?(s&&s!==u&&(u.stats=s.stats),{frag:u,part:d,level:o}):null}bufferFragmentData(e,t,s,r,n){if(this.state!==P.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=ii(a,o)),!l.length)return;const d=this.initPTS[t.cc],u=d?-d.baseTime/d.timescale:void 0,c={type:e.type,frag:t,part:s,chunkMeta:r,offset:u,parent:t.type,data:l};if(this.hls.trigger(v.BUFFER_APPENDING,c),e.dropped&&e.independent&&!s){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!le.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=le.bufferInfo(t,s,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),o=Math.max(Math.min(e.start-a,r.end-a),s+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!j(r))return null;const a=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,s,r){const n=le.bufferInfo(e,t,r);if(n.len===0&&n.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(n.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(n.nextStart,a.end)-t,r);return le.bufferInfo(e,t,o)}}return n}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),n=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return n>=r?(s.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0):!1}getAppendedFrag(e,t=Z.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:n}=this,a=s[0].start,o=n.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const c=n.initialLiveManifestSize;if(r<c)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${c})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var d;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,m=l?(h!==-1&&h>=a?h:f)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(d=l)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=a&&(l=s[0]);if(!l){const c=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,c,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const c=l.sn-t.startSN;u=this.filterReplacedPrimary(s[c+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===dt.OK||s===dt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(o!==null&&s.len+o.len>=n){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(eg(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(eg(this.config)&&e.type!==Z.SUBTITLE){const s=this.hls.interstitialsManager,r=s?.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const n=s?.playerQueue;if(n)for(let a=n.length;a--;){const o=n[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,n=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const d=e[o];if(a=a&&!d.independent,r>-1&&s<d.start)break;const u=d.loaded;u?r=-1:(n||(d.independent||a)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),r=o),n=u}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=u1(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const n=s.sn+1;if(n>=e.startSN&&n<=e.endSN){const a=t[n-e.startSN];s.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=zv(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(r=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:n}=this,{fragments:a,endSN:o}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:d}=r,u=s.partList,c=!!(this.loadingParts&&u!=null&&u.length&&l);c&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var f;const g=e<this.lastCurrentTime||e>t-d||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:d;h=Sr(n,a,e,g)}else h=a[a.length-1];if(h){const m=h.sn-s.startSN,g=this.fragmentTracker.getState(h);if((g===dt.OK||g===dt.PARTIAL&&h.gap)&&(n=h),n&&h.sn===n.sn&&(!c||u[0].fragment.sn>h.sn||!s.live)&&h.level===n.level){const E=a[m+1];h.sn<o&&this.fragmentTracker.getState(E)!==dt.OK?h=E:h=null}}return h}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,a=!t,o=e.alignedSliding&&j(n);if(a||!o&&!n){Y1(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const n=this.startTimeOffset!==null,a=n?this.startTimeOffset:e.startTimeOffset;a!==null&&j(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&it(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==P.FRAG_LOADING_WAITING_RETRY)&&(this.state=P.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var n;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const a=t.details===C.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction;if(!o){this.state=P.ERROR;return}const{action:l,flags:d,retryCount:u=0,retryConfig:c}=o,h=!!c,f=h&&l===vt.RetryRequest,m=h&&!o.resolved&&d===Bt.MoveAllAlternatesMatchingHost,g=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!f&&m&&it(r)&&!r.endList&&g&&!Xv(t))this.resetFragmentErrors(e),this.treatAsGap(r),o.resolved=!0;else if((f||m)&&u<c.maxNumRetry){var p;const E=Cc((p=t.response)==null?void 0:p.code),T=Af(c,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+T,this.state=P.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,E){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${T}ms`)}else if(c)if(this.resetFragmentErrors(e),u<c.maxNumRetry)!a&&l!==vt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===vt.SendAlternateToPenaltyBox?this.state=P.WAITING_LEVEL:this.state=P.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!Cc(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=P.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===P.PARSING||this.state===P.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),n=r&&r.len>.5;n&&this.reduceMaxBufferLength(r.len,t?.duration||10);const a=!n;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Z.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==P.STOPPED&&(this.state=P.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=le.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===P.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==P.STOPPED&&(this.state=P.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const n=s.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,d)=>{const u=e.elementaryStreams[d];if(u){const c=u.endPTS-u.startPTS;if(c<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${c})`),l||!1;const h=r?0:aE(n,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(v.LEVEL_PTS_UPDATED,{details:n,level:s,drift:h,type:d,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var o;if(s.fragmentError===0&&this.treatAsGap(e,s),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=P.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(v.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Z.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,n;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((n=t&&!s?e.endPTS:(s||e).end)!=null?n:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function eg(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class mE{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=z1(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function z1(i,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<i.length;r++){const n=i[r];t.set(n,s),s+=n.length}return t}var Bu={exports:{}},tg;function Q1(){return tg||(tg=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(l,d,u){this.fn=l,this.context=d,this.once=u||!1}function n(l,d,u,c,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new r(u,c||l,h),m=t?t+d:d;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function a(l,d){--l._eventsCount===0?l._events=new s:delete l._events[d]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var d=[],u,c;if(this._eventsCount===0)return d;for(c in u=this._events)e.call(u,c)&&d.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},o.prototype.listeners=function(d){var u=t?t+d:d,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var h=0,f=c.length,m=new Array(f);h<f;h++)m[h]=c[h].fn;return m},o.prototype.listenerCount=function(d){var u=t?t+d:d,c=this._events[u];return c?c.fn?1:c.length:0},o.prototype.emit=function(d,u,c,h,f,m){var g=t?t+d:d;if(!this._events[g])return!1;var p=this._events[g],E=arguments.length,T,y;if(p.fn){switch(p.once&&this.removeListener(d,p.fn,void 0,!0),E){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,c),!0;case 4:return p.fn.call(p.context,u,c,h),!0;case 5:return p.fn.call(p.context,u,c,h,f),!0;case 6:return p.fn.call(p.context,u,c,h,f,m),!0}for(y=1,T=new Array(E-1);y<E;y++)T[y-1]=arguments[y];p.fn.apply(p.context,T)}else{var b=p.length,A;for(y=0;y<b;y++)switch(p[y].once&&this.removeListener(d,p[y].fn,void 0,!0),E){case 1:p[y].fn.call(p[y].context);break;case 2:p[y].fn.call(p[y].context,u);break;case 3:p[y].fn.call(p[y].context,u,c);break;case 4:p[y].fn.call(p[y].context,u,c,h);break;default:if(!T)for(A=1,T=new Array(E-1);A<E;A++)T[A-1]=arguments[A];p[y].fn.apply(p[y].context,T)}}return!0},o.prototype.on=function(d,u,c){return n(this,d,u,c,!1)},o.prototype.once=function(d,u,c){return n(this,d,u,c,!0)},o.prototype.removeListener=function(d,u,c,h){var f=t?t+d:d;if(!this._events[f])return this;if(!u)return a(this,f),this;var m=this._events[f];if(m.fn)m.fn===u&&(!h||m.once)&&(!c||m.context===c)&&a(this,f);else{for(var g=0,p=[],E=m.length;g<E;g++)(m[g].fn!==u||h&&!m[g].once||c&&m[g].context!==c)&&p.push(m[g]);p.length?this._events[f]=p.length===1?p[0]:p:a(this,f)}return this},o.prototype.removeAllListeners=function(d){var u;return d?(u=t?t+d:d,this._events[u]&&a(this,u)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,i.exports=o})(Bu)),Bu.exports}var X1=Q1(),kf=_S(X1);const Va="1.6.14",Dn={};function Z1(){return typeof __HLS_WORKER_BUNDLE__=="function"}function J1(){const i=Dn[Va];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Dn[Va]=r,r}function eI(i){const e=Dn[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Dn[i]=r,r}function tI(i){const e=Dn[i||Va];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete Dn[i||Va],r&&self.URL.revokeObjectURL(r),s.terminate()}}function pE(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Df(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function su(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Wa(i,e){const t=e;let s=0;for(;Df(i,e);){s+=10;const r=su(i,e+6);s+=r,pE(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function iI(i,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],n=e[t+2],a=n>>2&15;if(a>12){const f=new Error(`invalid ADTS sampling index:${a}`);i.emit(v.ERROR,v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(n>>6&3)+1,l=e[t+3]>>6&3|(n&1)<<2,d="mp4a.40."+o,u=r[a];let c=a;(o===5||o===29)&&(c-=3);const h=[o<<3|(c&14)>>1,(c&1)<<7|l<<3];return Re.log(`manifest codec:${s}, parsed codec:${d}, channels:${l}, rate:${u} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:u,channelCount:l,codec:d,parsedCodec:d,manifestCodec:s}}function gE(i,e){return i[e]===255&&(i[e+1]&246)===240}function vE(i,e){return i[e+1]&1?7:9}function Cf(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function sI(i,e){return e+5<i.length}function Ld(i,e){return e+1<i.length&&gE(i,e)}function rI(i,e){return sI(i,e)&&gE(i,e)&&Cf(i,e)<=i.length-e}function nI(i,e){if(Ld(i,e)){const t=vE(i,e);if(e+t>=i.length)return!1;const s=Cf(i,e);if(s<=t)return!1;const r=e+s;return r===i.length||Ld(i,r)}return!1}function EE(i,e,t,s,r){if(!i.samplerate){const n=iI(e,t,s,r);if(!n)return;De(i,n)}}function yE(i){return 1024*9e4/i}function aI(i,e){const t=vE(i,e);if(e+t<=i.length){const s=Cf(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function TE(i,e,t,s,r){const n=yE(i.samplerate),a=s+r*n,o=aI(e,t);let l;if(o){const{frameLength:c,headerLength:h}=o,f=h+c,m=Math.max(0,t+f-e.length);m?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const g={unit:l,pts:a};return m||i.samples.push(g),{sample:g,length:f,missing:m}}const d=e.length-t;return l=new Uint8Array(d),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:d,missing:-1}}function oI(i,e){return Df(i,e)&&su(i,e+6)+10<=i.length-e}function lI(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Hu(i,e=0,t=1/0){return dI(i,e,t,Uint8Array)}function dI(i,e,t,s){const r=uI(i);let n=1;"BYTES_PER_ELEMENT"in s&&(n=s.BYTES_PER_ELEMENT);const a=cI(i)?i.byteOffset:0,o=(a+i.byteLength)/n,l=(a+e)/n,d=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(d+Math.max(t,0),o));return new s(r,d,u-d)}function uI(i){return i instanceof ArrayBuffer?i:i.buffer}function cI(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function hI(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const r=Wt(Hu(i.data,1,s)),n=i.data[2+s],a=i.data.subarray(3+s).indexOf(0);if(a===-1)return;const o=Wt(Hu(i.data,3+s,a));let l;return r==="-->"?l=Wt(Hu(i.data,4+s+a)):l=lI(i.data.subarray(4+s+a)),e.mimeType=r,e.pictureType=n,e.description=o,e.data=l,e}function fI(i){if(i.size<2)return;const e=Wt(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function mI(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=Wt(i.data.subarray(t),!0);t+=s.length+1;const r=Wt(i.data.subarray(t));return{key:i.type,info:s,data:r}}const e=Wt(i.data.subarray(1));return{key:i.type,info:"",data:e}}function pI(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=Wt(i.data.subarray(t),!0);t+=s.length+1;const r=Wt(i.data.subarray(t));return{key:i.type,info:s,data:r}}const e=Wt(i.data);return{key:i.type,info:"",data:e}}function gI(i){return i.type==="PRIV"?fI(i):i.type[0]==="W"?pI(i):i.type==="APIC"?hI(i):mI(i)}function vI(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=su(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const _o=10,EI=10;function bE(i){let e=0;const t=[];for(;Df(i,e);){const s=su(i,e+6);i[e+5]>>6&1&&(e+=_o),e+=_o;const r=e+s;for(;e+EI<r;){const n=vI(i.subarray(e)),a=gI(n);a&&t.push(a),e+=n.size+_o}pE(i,e)&&(e+=_o)}return t}function _E(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function yI(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function wf(i){const e=bE(i);for(let t=0;t<e.length;t++){const s=e[t];if(_E(s))return yI(s)}}let Vt=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Fi(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Mf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=ii(this.cachedData,e),this.cachedData=null);let s=Wa(e,0),r=s?s.length:0,n;const a=this._audioTrack,o=this._id3Track,l=s?wf(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&j(l))&&(this.basePTS=TI(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Vt.audioId3,duration:Number.POSITIVE_INFINITY});r<d;){if(this.canParse(e,r)){const u=this.appendFrame(a,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,n=r):r=d}else oI(e,r)?(s=Wa(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Vt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,n=r):r++;if(r===d&&n!==d){const u=e.slice(n);this.cachedData?this.cachedData=ii(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:Fi(),id3Track:o,textTrack:Fi()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Fi(),id3Track:this._id3Track,textTrack:Fi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const TI=(i,e,t)=>{if(j(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Ao=null;const bI=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],_I=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],AI=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],SI=[0,1,1,4];function AE(i,e,t,s,r){if(t+24>e.length)return;const n=SE(e,t);if(n&&t+n.frameLength<=e.length){const a=n.samplesPerFrame*9e4/n.sampleRate,o=s+r*a,l={unit:e.subarray(t,t+n.frameLength),pts:o,dts:o};return i.config=[],i.channelCount=n.channelCount,i.samplerate=n.sampleRate,i.samples.push(l),{sample:l,length:n.frameLength,missing:0}}}function SE(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,r=i[e+2]>>4&15,n=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&n!==3){const a=i[e+2]>>1&1,o=i[e+3]>>6,l=t===3?3-s:s===3?3:4,d=bI[l*14+r-1]*1e3,c=_I[(t===3?0:t===2?1:2)*3+n],h=o===3?1:2,f=AI[t][s],m=SI[s],g=f*8*m,p=Math.floor(f*d/c+a)*m;if(Ao===null){const y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ao=y?parseInt(y[1]):0}return!!Ao&&Ao<=87&&s===2&&d>=224e3&&o===0&&(i[e+3]=i[e+3]|128),{sampleRate:c,channelCount:h,frameLength:p,samplesPerFrame:g}}}function Pf(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function IE(i,e){return e+1<i.length&&Pf(i,e)}function II(i,e){return Pf(i,e)&&4<=i.length-e}function LE(i,e){if(e+1<i.length&&Pf(i,e)){const s=SE(i,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const n=e+r;return n===i.length||IE(i,n)}return!1}class LI extends Mf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Wa(e,0);let r=s?.length||0;if(LE(e,r))return!1;for(let n=e.length;r<n;r++)if(nI(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return rI(e,t)}appendFrame(e,t,s){EE(e,this.observer,t,s,e.manifestCodec);const r=TE(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const RE=(i,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=i[e];const o=Math.min(s,8),l=8-o;n[0]=4278190080>>>24+l<<l,r[0]=(a[0]&n[0])>>l,t=t?t<<o|r[0]:r[0],e+=1,s-=o}return t};class RI extends Mf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=xE(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Wa(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&wf(t)!==void 0&&RE(e,s)<16}}function xE(i,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const n=e[t+4]>>6;if(n>=3)return-1;const o=[48e3,44100,32e3][n],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+n]*2;if(t+u>e.length)return-1;const c=e[t+6]>>5;let h=0;c===2?h+=2:(c&1&&c!==1&&(h+=2),c&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,g=[2,1,2,3,3,4,4,5][c]+f,p=e[t+5]>>3,E=e[t+5]&7,T=new Uint8Array([n<<6|p<<1|E>>2,(E&3)<<6|c<<3|f<<2|l>>4,l<<4&224]),y=1536/o*9e4,b=s+r*y,A=e.subarray(t,t+u);return i.config=T,i.channelCount=g,i.samplerate=o,i.samples.push({unit:A,pts:b}),u}class xI extends Mf{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wa(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&wf(t)!==void 0&&RE(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(LE(e,s))return Re.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return II(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return AE(e,t,s,this.basePTS,this.frameIndex)}}const kI=/\/emsg[-/]ID3/i;class DI{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const n=this.videoTrack=Fi("video",1),a=this.audioTrack=Fi("audio",1),o=this.txtTrack=Fi("text",1);if(this.id3Track=Fi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=$v(e);if(l.video){const{id:d,timescale:u,codec:c,supplemental:h}=l.video;n.id=d,n.timescale=o.timescale=u,n.codec=c,n.supplemental=h}if(l.audio){const{id:d,timescale:u,codec:c}=l.audio;a.id=d,a.timescale=u,a.codec=c}o.id=Ov.text,n.sampleDuration=0,n.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return RS(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=ii(this.remainderData,e));const o=PS(s);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=s;const a=this.extractID3Track(r,t);return n.samples=yp(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=yp(e,t),{videoTrack:t,audioTrack:Fi(),id3Track:r,textTrack:Fi()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=he(e.samples,["emsg"]);r&&r.forEach(n=>{const a=NS(n);if(kI.test(a.schemeIdUri)){const o=ig(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const d=a.payload;s.samples.push({data:d,len:d.byteLength,dts:o,pts:o,type:Vt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=ig(a,t);s.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Vt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function ig(i,e){return j(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class CI{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Sf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Hs.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const n=r.subarray(16,r.length-r.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let n=32;n<e.length-16;n+=160,r+=16)s.set(e.subarray(n,n+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let n=32;n<e.length-16;n+=160,r+=16)e.set(s.subarray(r,r+16),n);return e}decryptAvcSample(e,t,s,r,n){const a=Hv(n.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{n.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const n=e[t].units;for(;!(s>=n.length);s++){const a=n[s];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,s,r,a),!this.decrypter.isSync()))return}}}}class kE{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const n=s.units;r=n[n.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const n=s[r-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let n=e.naluState||0;const a=n,o=[];let l=0,d,u,c,h=-1,f=0;for(n===-1&&(h=0,f=this.getNALuType(t,0),n=0,l=1);l<r;){if(d=t[l++],!n){n=d?0:1;continue}if(n===1){n=d?0:2;continue}if(!d)n=3;else if(d===1){if(u=l-n-1,h>=0){const m={data:t.subarray(h,u),type:f};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(a&&l<=4-a&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-a)),u>0&&(m.data=ii(m.data,t.subarray(0,u)),m.state=0))}l<r?(c=this.getNALuType(t,l),h=l,f=c,n=0):n=-1}else n=0}if(h>=0&&n>=0){const m={data:t.subarray(h,r),type:f,state:n};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=ii(m.data,t))}return e.naluState=n,o}}class Ra{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");r.set(e.subarray(s,s+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Re.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class wI extends kE{parsePES(e,t,s,r){const n=this.parseNALu(e,s.data,r);let a=this.VideoSample,o,l=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(d=>{var u,c;switch(d.type){case 1:{let g=!1;o=!0;const p=d.data;if(l&&p.length>4){const E=this.readSliceType(p);(E===2||E===4||E===7||E===9)&&(g=!0)}if(g){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=g;break}case 5:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Tf(d.data,1,s.pts,t.samples);break}case 7:{var f,m;o=!0,l=!0;const g=d.data,p=this.readSPS(g);if(!e.sps||e.width!==p.width||e.height!==p.height||((f=e.pixelRatio)==null?void 0:f[0])!==p.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[g];const E=g.subarray(1,4);let T="avc1.";for(let y=0;y<3;y++){let b=E[y].toString(16);b.length<2&&(b="0"+b),T+=b}e.codec=T}break}case 8:o=!0,e.pps=[d.data];break;case 9:o=!0,e.audFound=!0,(c=a)!=null&&c.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(d)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ra(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,n;for(let a=0;a<e;a++)r!==0&&(n=t.readEG(),r=(s+n+256)%256),s=r===0?s:r}readSPS(e){const t=new Ra(e);let s=0,r=0,n=0,a=0,o,l,d;const u=t.readUByte.bind(t),c=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),m=t.skipBits.bind(t),g=t.skipEG.bind(t),p=t.skipUEG.bind(t),E=this.skipScalingList.bind(this);u();const T=u();if(c(5),m(3),u(),p(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const R=h();if(R===3&&m(1),p(),p(),m(1),f())for(l=R!==3?8:12,d=0;d<l;d++)f()&&(d<6?E(16,t):E(64,t))}p();const y=h();if(y===0)h();else if(y===1)for(m(1),g(),g(),o=h(),d=0;d<o;d++)g();p(),m(1);const b=h(),A=h(),L=c(1);L===0&&m(1),m(1),f()&&(s=h(),r=h(),n=h(),a=h());let S=[1,1];if(f()&&f())switch(u()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((b+1)*16-s*2-r*2),height:(2-L)*(A+1)*16-(L?2:4)*(n+a),pixelRatio:S}}}class MI extends kE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const n=this.parseNALu(e,s.data,r);let a=this.VideoSample,o,l=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(d=>{var u,c;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Tf(d.data,2,s.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=De(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(d.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in f.params)e.params[m]=f.params[m]}this.pushParameterSet(e.sps,d.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(d.data);for(const m in f)e.params[m]=f[m]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(c=a)!=null&&c.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:o=!1;break}a&&o&&a.units.push(d)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ra(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new Ra(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),d=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),p=t.readUByte(),E=t.readUByte(),T=[],y=[];for(let ve=0;ve<s;ve++)T.push(t.readBoolean()),y.push(t.readBoolean());if(s>0)for(let ve=s;ve<8;ve++)t.readBits(2);for(let ve=0;ve<s;ve++)T[ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[ve]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const A=t.readUEG(),L=t.readUEG(),S=t.readBoolean();let R=0,x=0,I=0,M=0;S&&(R+=t.readUEG(),x+=t.readUEG(),I+=t.readUEG(),M+=t.readUEG());const $=t.readUEG(),V=t.readUEG(),q=t.readUEG(),H=t.readBoolean();for(let ve=H?0:s;ve<=s;ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let nt=0;nt<4;nt++)for(let St=0;St<(nt===3?2:6);St++)if(!t.readBoolean())t.readUEG();else{const jt=Math.min(64,1<<4+(nt<<1));nt>1&&t.readEG();for(let Te=0;Te<jt;Te++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const B=t.readUEG();let Y=0;for(let ve=0;ve<B;ve++){let nt=!1;if(ve!==0&&(nt=t.readBoolean()),nt){ve===B&&t.readUEG(),t.readBoolean(),t.readUEG();let St=0;for(let Ti=0;Ti<=Y;Ti++){const jt=t.readBoolean();let Te=!1;jt||(Te=t.readBoolean()),(jt||Te)&&St++}Y=St}else{const St=t.readUEG(),Ti=t.readUEG();Y=St+Ti;for(let jt=0;jt<St;jt++)t.readUEG(),t.readBoolean();for(let jt=0;jt<Ti;jt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ve=t.readUEG();for(let nt=0;nt<ve;nt++){for(let St=0;St<q+4;St++)t.readBits(1);t.readBits(1)}}let U=0,F=1,ne=1,pe=!0,de=1,fe=0;t.readBoolean(),t.readBoolean();let rt=!1;if(t.readBoolean()){if(t.readBoolean()){const Pt=t.readUByte(),ho=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Dr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Pt>0&&Pt<16?(F=ho[Pt-1],ne=Dr[Pt-1]):Pt===255&&(F=t.readBits(16),ne=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),rt=t.readBoolean(),rt&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(de=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Dr=t.readBoolean(),fo=t.readBoolean();let Ws=!1;(Dr||fo)&&(Ws=t.readBoolean(),Ws&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ws&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let mo=0;mo<=s;mo++){pe=t.readBoolean();const Ru=pe||t.readBoolean();let po=!1;Ru?t.readEG():po=t.readBoolean();const Tt=po?1:t.readUEG()+1;if(Dr)for(let Fe=0;Fe<Tt;Fe++)t.readUEG(),t.readUEG(),Ws&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(fo)for(let Fe=0;Fe<Tt;Fe++)t.readUEG(),t.readUEG(),Ws&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readUEG())}let At=A,Mt=L;if(S){let ve=1,nt=1;b===1?ve=nt=2:b==2&&(ve=2),At=A-ve*x-ve*R,Mt=L-nt*M-nt*I}const yi=r?["A","B","C"][r]:"",gs=o<<24|l<<16|d<<8|u;let xr=0;for(let ve=0;ve<32;ve++)xr=(xr|(gs>>ve&1)<<31-ve)>>>0;let kr=xr.toString(16);return a===1&&kr==="2"&&(kr="6"),{codecString:`hvc1.${yi}${a}.${kr}.${n?"H":"L"}${E}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[o,l,d,u],general_constraint_indicator_flags:[c,h,f,m,g,p],general_level_idc:E,bit_depth:$+8,bit_depth_luma_minus8:$,bit_depth_chroma_minus8:V,min_spatial_segmentation_idc:U,chroma_format_idc:b,frame_rate:{fixed:pe,fps:fe/de}},width:At,height:Mt,pixelRatio:[F,ne]}}readPPS(e){const t=new Ra(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),n=t.readBoolean();let a=1;return n&&r?a=0:n?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ct=188;class ws{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=ws.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(ct*5,t-ct)+1,r=0;for(;r<s;){let n=!1,a=-1,o=0;for(let l=r;l<t;l+=ct)if(e[l]===71&&(t-l===ct||e[l+ct]===71)){if(o++,a===-1&&(a=l,a!==0&&(s=Math.min(a+ct*99,e.length-ct)+1)),n||(n=Nc(e,l)===0),n&&o>1&&(a===0&&o>2||l+ct>s))return a}else{if(o)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ov[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ws.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=ws.createTrack("audio",r),this._id3Track=ws.createTrack("id3"),this._txtTrack=ws.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let n;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,d=this._txtTrack;let u=a.pid,c=a.pesData,h=o.pid,f=l.pid,m=o.pesData,g=l.pesData,p=null,E=this.pmtParsed,T=this._pmtId,y=e.length;if(this.remainderData&&(e=ii(this.remainderData,e),y=e.length,this.remainderData=null),y<ct&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:d};const b=Math.max(0,ws.syncOffset(e));y-=(y-b)%ct,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let A=0;for(let S=b;S<y;S+=ct)if(e[S]===71){const R=!!(e[S+1]&64),x=Nc(e,S),I=(e[S+3]&48)>>4;let M;if(I>1){if(M=S+5+e[S+4],M===S+ct)continue}else M=S+4;switch(x){case u:R&&(c&&(n=Mr(c,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,d,n,!1)),c={data:[],size:0}),c&&(c.data.push(e.subarray(M,S+ct)),c.size+=S+ct-M);break;case h:if(R){if(m&&(n=Mr(m,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break;case"ac3":this.parseAC3PES(o,n);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(M,S+ct)),m.size+=S+ct-M);break;case f:R&&(g&&(n=Mr(g,this.logger))&&this.parseID3PES(l,n),g={data:[],size:0}),g&&(g.data.push(e.subarray(M,S+ct)),g.size+=S+ct-M);break;case 0:R&&(M+=e[M]+1),T=this._pmtId=PI(e,M);break;case T:{R&&(M+=e[M]+1);const $=OI(e,M,this.typeSupported,s,this.observer,this.logger);u=$.videoPid,u>0&&(a.pid=u,a.segmentCodec=$.segmentVideoCodec),h=$.audioPid,h>0&&(o.pid=h,o.segmentCodec=$.segmentAudioCodec),f=$.id3Pid,f>0&&(l.pid=f),p!==null&&!E&&(this.logger.warn(`MPEG-TS PMT found at ${S} after unknown PID '${p}'. Backtracking to sync byte @${b} to parse all TS packets.`),p=null,S=b-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=x;break}}else A++;A>0&&Uc(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=c,o.pesData=m,l.pesData=g;const L={audioTrack:o,videoTrack:a,id3Track:l,textTrack:d};return r&&this.extractRemainingSamples(L),L}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:n}=e,a=s.pesData,o=t.pesData,l=r.pesData;let d;if(a&&(d=Mr(a,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,n,d,!0),s.pesData=null)):s.pesData=a,o&&(d=Mr(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(d=Mr(l,this.logger))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),n=this.sampleAes=new CI(this.observer,this.config,t);return this.decrypt(r,n)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new wI:e==="hevc"&&(this.videoParser=new MI))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:n}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{s(e)}):s(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let n=t.data;if(r){this.aacOverFlow=null;const c=r.missing,h=r.sample.unit.byteLength;if(c===-1)n=ii(r.sample.unit,n);else{const f=h-c;r.sample.unit.set(n.subarray(0,c),f),e.samples.push(r.sample),s=r.missing}}let a,o;for(a=s,o=n.length;a<o-1&&!Ld(n,a);a++);if(a!==s){let c;const h=a<o-1;if(h?c=`AAC PES did not start with ADTS header,offset:${a}`:c="No ADTS header found in AAC PES",Uc(this.observer,new Error(c),h,this.logger),!h)return}EE(e,this.observer,n,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const c=yE(e.samplerate);l=r.sample.pts+c}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,u;for(;a<o;)if(u=TE(e,n,a,l,d),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(d++;a<o-1&&!Ld(n,a);a++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let n=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(IE(s,a)){const l=AE(e,s,a,o,n);if(l)a+=l.length,n++;else break}else a++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const n=s.length;let a=0,o=0,l;for(;o<n&&(l=xE(e,s,o,r,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=De({},t,{type:this._videoTrack?Vt.emsg:Vt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Nc(i,e){return((i[e+1]&31)<<8)+i[e+2]}function PI(i,e){return(i[e+10]&31)<<8|i[e+11]}function OI(i,e,t,s,r,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(i[e+1]&15)<<8|i[e+2],l=e+3+o-4,d=(i[e+10]&15)<<8|i[e+11];for(e+=12+d;e<l;){const u=Nc(i,e),c=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){Gu("ADTS AAC",n);break}case 15:a.audioPid===-1&&(a.audioPid=u);break;case 21:a.id3Pid===-1&&(a.id3Pid=u);break;case 219:if(!s){Gu("H.264",n);break}case 27:a.videoPid===-1&&(a.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?n.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="mp3");break;case 193:if(!s){Gu("AC-3",n);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&c>0){let h=e+5,f=c;for(;f>2;){switch(i[h]){case 106:t.ac3!==!0?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=u,a.segmentAudioCodec="ac3");break}const g=i[h+1]+2;h+=g,f-=g}}break;case 194:case 135:return Uc(r,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:a.videoPid===-1&&(a.videoPid=u,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"));break}e+=c+5}return a}function Uc(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(v.ERROR,v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Gu(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Mr(i,e){let t=0,s,r,n,a,o;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=ii(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>i.size-6)return null;const u=s[7];u&192&&(a=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,u&64?(o=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),n=s[8];let c=n+9;if(i.size<=c)return null;i.size-=c;const h=new Uint8Array(i.size);for(let f=0,m=l.length;f<m;f++){s=l[f];let g=s.byteLength;if(c)if(c>g){c-=g;continue}else s=s.subarray(c),g-=c,c=0;h.set(s,t),t+=g}return r&&(r-=n+3),{data:h,pts:a,dts:o,len:r}}return null}class NI{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const vs=Math.pow(2,32)-1;class D{static init(){D.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in D.types)D.types.hasOwnProperty(e)&&(D.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=n,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,a,l,a,o),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,r))}static box(e,...t){let s=8,r=t.length;const n=r;for(;r--;)s+=t[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(e,4),r=0,s=8;r<n;r++)a.set(t[r],s),s+=t[r].byteLength;return a}static hdlr(e){return D.box(D.types.hdlr,D.HDLR_TYPES[e])}static mdat(e){return D.box(D.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(vs+1)),r=Math.floor(t%(vs+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return D.box(D.types.mdia,D.mdhd(e.timescale||0,e.duration||0),D.hdlr(e.type),D.minf(e))}static mfhd(e){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(e)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(e))}static moof(e,t,s){return D.box(D.types.moof,D.mfhd(e),D.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=D.trak(e[t]);return D.box.apply(null,[D.types.moov,D.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(D.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=D.trex(e[t]);return D.box.apply(null,[D.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(vs+1)),r=Math.floor(t%(vs+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,n)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,n;for(r=0;r<t.length;r++)n=t[r].flags,s[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return D.box(D.types.sdtp,s)}static stbl(e){return D.box(D.types.stbl,D.stsd(e),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))}static avc1(e){let t=[],s=[],r,n,a;for(r=0;r<e.sps.length;r++)n=e.sps[r],a=n.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(n));for(r=0;r<e.pps.length;r++)n=e.pps[r],a=n.byteLength,s.push(a>>>8&255),s.push(a&255),s=s.concat(Array.prototype.slice.call(n));const o=D.box(D.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,d=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,c>>24,c>>16&255,c>>8&255,c&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return D.box(D.types.mp4a,D.audioStsd(e),D.box(D.types.esds,D.esds(e)))}static mp3(e){return D.box(D.types[".mp3"],D.audioStsd(e))}static ac3(e){return D.box(D.types["ac-3"],D.audioStsd(e),D.box(D.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return D.box(D.types.stsd,D.STSD,D.mp4a(e));if(t==="ac3"&&e.config)return D.box(D.types.stsd,D.STSD,D.ac3(e));if(t==="mp3"&&e.codec==="mp3")return D.box(D.types.stsd,D.STSD,D.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return D.box(D.types.stsd,D.STSD,D.avc1(e));if(t==="hevc"&&e.vps)return D.box(D.types.stsd,D.STSD,D.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,n=e.height||0,a=Math.floor(s/(vs+1)),o=Math.floor(s%(vs+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const s=D.sdtp(e),r=e.id,n=Math.floor(t/(vs+1)),a=Math.floor(t%(vs+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255])),D.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,D.box(D.types.trak,D.tkhd(e),D.mdia(e))}static trex(e){const t=e.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,n=12+16*r,a=new Uint8Array(n);let o,l,d,u,c,h;for(t+=8+n,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<r;o++)l=s[o],d=l.duration,u=l.size,c=l.flags,h=l.cts,a.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,c.degradPrio&61440,c.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return D.box(D.types.trun,a)}static initSegment(e){D.types||D.init();const t=D.moov(e);return ii(D.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let a=n.length;for(let m=0;m<s.length;m+=1){a+=3;for(let g=0;g<s[m].length;g+=1)a+=2+s[m][g].length}const o=new Uint8Array(a);o.set(n,0),a=n.length;const l=s.length-1;for(let m=0;m<s.length;m+=1){o.set(new Uint8Array([32+m|(m===l?128:0),0,s[m].length]),a),a+=3;for(let g=0;g<s[m].length;g+=1)o.set(new Uint8Array([s[m][g].length>>8,s[m][g].length&255]),a),a+=2,o.set(s[m][g],a),a+=s[m][g].length}const d=D.box(D.types.hvcC,o),u=e.width,c=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return D.box(D.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}D.types=void 0;D.HDLR_TYPES=void 0;D.STTS=void 0;D.STSC=void 0;D.STCO=void 0;D.STSZ=void 0;D.VMHD=void 0;D.SMHD=void 0;D.STSD=void 0;D.FTYP=void 0;D.DINF=void 0;const DE=9e4;function Of(i,e,t=1,s=!1){const r=i*e*t;return s?Math.round(r):r}function UI(i,e,t=1,s=!1){return Of(i,e,1/t,s)}function Vn(i,e=!1){return Of(i,1e3,1/DE,e)}function $I(i,e=1){return Of(i,DE,1/e)}function sg(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const FI=10*1e3,BI=1024,HI=1152,GI=1536;let Pr=null,Ku=null;function rg(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class el extends si{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Pr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pr=a?parseInt(a[1]):0}if(Ku===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);Ku=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&sg(t)} > ${e&&sg(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((n,a)=>{let o=a.pts,l=o-n;return l<-4294967296&&(t=!0,o=Gt(o,s),l=o-n),l>0?n:o},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,n,a,o,l){let d,u,c,h,f,m,g=n,p=n;const E=e.pid>-1,T=t.pid>-1,y=t.samples.length,b=e.samples.length>0,A=o&&y>0||y>1;if((!E||b)&&(!T||A)||this.ISGenerated||o){if(this.ISGenerated){var S,R,x,I;const q=this.videoTrackConfig;(q&&(t.width!==q.width||t.height!==q.height||((S=t.pixelRatio)==null?void 0:S[0])!==((R=q.pixelRatio)==null?void 0:R[0])||((x=t.pixelRatio)==null?void 0:x[1])!==((I=q.pixelRatio)==null?void 0:I[1]))||!q&&A||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,n,a));const M=this.isVideoContiguous;let $=-1,V;if(A&&($=KI(t.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,$>0){this.warn(`Dropped ${$} out of ${y} video samples due to a missing keyframe`);const q=this.getVideoStartPts(t.samples);t.samples=t.samples.slice($),t.dropped+=$,p+=(t.samples[0].pts-q)/t.inputTimeScale,V=p}else $===-1&&(this.warn(`No keyframe found out of ${y} video samples`),m=!1);if(this.ISGenerated){if(b&&A){const q=this.getVideoStartPts(t.samples),N=(Gt(e.samples[0].pts,q)-q)/t.inputTimeScale;g+=Math.max(0,N),p+=Math.max(0,-N)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(e,t,n,a)),u=this.remuxAudio(e,g,this.isAudioContiguous,a,T||A||l===Z.AUDIO?p:void 0),A){const q=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(e,t,n,a)),d=this.remuxVideo(t,p,M,q)}}else A&&(d=this.remuxVideo(t,p,M,0));d&&(d.firstKeyFrame=$,d.independent=$!==-1,d.firstKeyFramePTS=V)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(f=CE(s,n,this._initPTS,this._initDTS)),r.samples.length&&(h=wE(r,n,this._initPTS))),{audio:u,video:d,initSegment:c,independent:m,text:h,id3:f}}computeInitPts(e,t,s,r){const n=Math.round(s*t);let a=Gt(e,n);if(a<n+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(n-a)/t} ${r}`);a<n+t;)a+=8589934592;return a-n}generateIS(e,t,s,r){const n=e.samples,a=t.samples,o=this.typeSupported,l={},d=this._initPTS;let u=!d||r,c="audio/mp4",h,f,m,g=-1;if(u&&(h=f=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(c="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:c,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):D.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(g=e.id,m=e.inputTimeScale,!d||m!==d.timescale?h=f=this.computeInitPts(n[0].pts,m,s,"audio"):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:D.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(g=t.id,m=t.inputTimeScale,!d||m!==d.timescale){const p=this.getVideoStartPts(a),E=Gt(a[0].dts,p),T=this.computeInitPts(E,m,s,"video"),y=this.computeInitPts(p,m,s,"video");f=Math.min(f,T),h=Math.min(h,y)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(d&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${h/m} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${h/m} (${h}/${m}) trackId: ${g}`),this._initPTS={baseTime:h,timescale:m,trackId:g},this._initDTS={baseTime:f,timescale:m,trackId:g}):h=m=void 0,{tracks:l,initPTS:h,timescale:m,trackId:g}}remuxVideo(e,t,s,r){const n=e.inputTimeScale,a=e.samples,o=[],l=a.length,d=this._initPTS,u=d.baseTime*n/d.timescale;let c=this.nextVideoTs,h=8,f=this.videoSampleDuration,m,g,p=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,T=!1;if(!s||c===null){const U=u+t*n,F=a[0].pts-Gt(a[0].dts,a[0].pts);Pr&&c!==null&&Math.abs(U-F-(c+u))<15e3?s=!0:c=U-F-u}const y=c+u;for(let U=0;U<l;U++){const F=a[U];F.pts=Gt(F.pts,y),F.dts=Gt(F.dts,y),F.dts<a[U>0?U-1:U].dts&&(T=!0)}T&&a.sort(function(U,F){const ne=U.dts-F.dts,pe=U.pts-F.pts;return ne||pe}),m=a[0].dts,g=a[a.length-1].dts;const b=g-m,A=b?Math.round(b/(l-1)):f||e.inputTimeScale/30;if(s){const U=m-y,F=U>A,ne=U<-1;if((F||ne)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Vn(U,!0)} ms (${U}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Vn(-U,!0)} ms (${U}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ne||y>=a[0].pts||Pr)){m=y;const pe=a[0].pts-U;if(F)a[0].dts=m,a[0].pts=pe;else{let de=!0;for(let fe=0;fe<a.length&&!(a[fe].dts>pe&&de);fe++){const rt=a[fe].pts;if(a[fe].dts-=U,a[fe].pts-=U,fe<a.length-1){const ze=a[fe+1].pts,At=a[fe].pts,Mt=ze<=At,yi=ze<=rt;de=Mt==yi}}}this.log(`Video: Initial PTS/DTS adjusted: ${Vn(pe,!0)}/${Vn(m,!0)}, delta: ${Vn(U,!0)} ms`)}}m=Math.max(0,m);let L=0,S=0,R=m;for(let U=0;U<l;U++){const F=a[U],ne=F.units,pe=ne.length;let de=0;for(let fe=0;fe<pe;fe++)de+=ne[fe].data.length;S+=de,L+=pe,F.length=de,F.dts<R?(F.dts=R,R+=A/4|0||1):R=F.dts,p=Math.min(F.pts,p),E=Math.max(F.pts,E)}g=a[l-1].dts;const x=S+4*L+8;let I;try{I=new Uint8Array(x)}catch(U){this.observer.emit(v.ERROR,v.ERROR,{type:te.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:x,reason:`fail allocating video mdat ${x}`});return}const M=new DataView(I.buffer);M.setUint32(0,x),I.set(D.types.mdat,4);let $=!1,V=Number.POSITIVE_INFINITY,q=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let U=0;U<l;U++){const F=a[U],ne=F.units;let pe=0;for(let rt=0,ze=ne.length;rt<ze;rt++){const At=ne[rt],Mt=At.data,yi=At.data.byteLength;M.setUint32(h,yi),h+=4,I.set(Mt,h),h+=yi,pe+=4+yi}let de;if(U<l-1)f=a[U+1].dts-F.dts,de=a[U+1].pts-F.pts;else{const rt=this.config,ze=U>0?F.dts-a[U-1].dts:A;if(de=U>0?F.pts-a[U-1].pts:A,rt.stretchShortVideoTrack&&this.nextAudioTs!==null){const At=Math.floor(rt.maxBufferHole*n),Mt=(r?p+r*n:this.nextAudioTs+u)-F.pts;Mt>At?(f=Mt-ze,f<0?f=ze:$=!0,this.log(`It is approximately ${Mt/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=ze}else f=ze}const fe=Math.round(F.pts-F.dts);V=Math.min(V,f),H=Math.max(H,f),q=Math.min(q,de),N=Math.max(N,de),o.push(rg(F.key,f,pe,fe))}if(o.length){if(Pr){if(Pr<70){const U=o[0].flags;U.dependsOn=2,U.isNonSync=0}}else if(Ku&&N-q<H-V&&A/H<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let U=m;for(let F=0,ne=o.length;F<ne;F++){const pe=U+o[F].duration,de=U+o[F].cts;if(F<ne-1){const fe=pe+o[F+1].cts;o[F].duration=fe-de}else o[F].duration=F?o[F-1].duration:A;o[F].cts=0,U=pe}}}f=$||!f?A:f;const W=g+f;this.nextVideoTs=c=W-u,this.videoSampleDuration=f,this.isVideoContiguous=!0;const ee={data1:D.moof(e.sequenceNumber++,m,De(e,{samples:o})),data2:I,startPTS:(p-u)/n,endPTS:(E+f-u)/n,startDTS:(m-u)/n,endDTS:c/n,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ee}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return HI;case"ac3":return GI;default:return BI}}remuxAudio(e,t,s,r,n){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,d=this.getSamplesPerFrame(e),u=d*l,c=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],m=n!==void 0;let g=e.samples,p=h?0:8,E=this.nextAudioTs||-1;const T=c.baseTime*a/c.timescale,y=T+t*a;if(this.isAudioContiguous=s=s||g.length&&E>0&&(r&&Math.abs(y-(E+T))<9e3||Math.abs(Gt(g[0].pts,y)-(E+T))<20*u),g.forEach(function(N){N.pts=Gt(N.pts,y)}),!s||E<0){const N=g.length;if(g=g.filter(W=>W.pts>=0),N!==g.length&&this.warn(`Removed ${g.length-N} of ${N} samples (initPTS ${T} / ${a})`),!g.length)return;n===0?E=0:r&&!m?E=Math.max(0,y-T):E=g[0].pts-T}if(e.segmentCodec==="aac"){const N=this.config.maxAudioFramesDrift;for(let W=0,B=E+T;W<g.length;W++){const Y=g[W],ee=Y.pts,U=ee-B,F=Math.abs(1e3*U/a);if(U<=-N*u&&m)W===0&&(this.warn(`Audio frame @ ${(ee/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*U/a)} ms.`),this.nextAudioTs=E=ee-T,B=ee);else if(U>=N*u&&F<FI&&m){let ne=Math.round(U/u);for(B=ee-ne*u;B<0&&ne&&u;)ne--,B+=u;W===0&&(this.nextAudioTs=E=B-T),this.warn(`Injecting ${ne} audio frames @ ${((B-T)/a).toFixed(3)}s due to ${Math.round(1e3*U/a)} ms gap.`);for(let pe=0;pe<ne;pe++){let de=NI.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);de||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),de=Y.unit.subarray()),g.splice(W,0,{unit:de,pts:B}),B+=u,W++}}Y.pts=B,B+=u}}let b=null,A=null,L,S=0,R=g.length;for(;R--;)S+=g[R].unit.byteLength;for(let N=0,W=g.length;N<W;N++){const B=g[N],Y=B.unit;let ee=B.pts;if(A!==null){const F=f[N-1];F.duration=Math.round((ee-A)/l)}else if(s&&e.segmentCodec==="aac"&&(ee=E+T),b=ee,S>0){S+=p;try{L=new Uint8Array(S)}catch(F){this.observer.emit(v.ERROR,v.ERROR,{type:te.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:S,reason:`fail allocating audio mdat ${S}`});return}h||(new DataView(L.buffer).setUint32(0,S),L.set(D.types.mdat,4))}else return;L.set(Y,p);const U=Y.byteLength;p+=U,f.push(rg(!0,d,U,0)),A=ee}const x=f.length;if(!x)return;const I=f[f.length-1];E=A-T,this.nextAudioTs=E+l*I.duration;const M=h?new Uint8Array(0):D.moof(e.sequenceNumber++,b/l,De({},e,{samples:f}));e.samples=[];const $=(b-T)/a,V=E/a,H={data1:M,data2:L,startPTS:$,endPTS:V,startDTS:$,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.isAudioContiguous=!0,H}}function Gt(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function KI(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function CE(i,e,t,s){const r=i.samples.length;if(!r)return;const n=i.inputTimeScale;for(let o=0;o<r;o++){const l=i.samples[o];l.pts=Gt(l.pts-t.baseTime*n/t.timescale,e*n)/n,l.dts=Gt(l.dts-s.baseTime*n/s.timescale,e*n)/n}const a=i.samples;return i.samples=[],{samples:a}}function wE(i,e,t){const s=i.samples.length;if(!s)return;const r=i.inputTimeScale;for(let a=0;a<s;a++){const o=i.samples[a];o.pts=Gt(o.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((a,o)=>a.pts-o.pts);const n=i.samples;return i.samples=[],{samples:n}}class VI extends si{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:n,video:a}=this.initData=$v(e);if(t)CS(e,t);else{const l=n||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}n&&(s=ng(n,we.AUDIO,this)),a&&(r=ng(a,we.VIDEO,this));const o={};n&&a?o.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:n?o.audio={container:"audio/mp4",codec:s,encrypted:n.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,s,r,n,a){var o,l;let{initPTS:d,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};j(u)||(u=this.lastEndTime=n||0);const h=t.samples;if(!h.length)return c;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((o=m)!=null&&o.length||(this.generateInitSegment(h),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const g=MS(h,m,this),p=m.audio?g[m.audio.id]:null,E=m.video?g[m.video.id]:null,T=So(E,1/0),y=So(p,1/0),b=So(E,0,!0),A=So(p,0,!0);let L=n,S=0;const R=p&&(!E||!d&&y<T||d&&d.trackId===m.audio.id),x=R?p:E;if(x){const B=x.timescale,Y=x.start-n*B,ee=R?m.audio.id:m.video.id;L=x.start/B,S=R?A-y:b-T,(a||!d)&&(WI(d,L,n,S)||B!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${n} ${Y/B} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${L-n} (${Y}/${B}) trackId: ${ee}`),d=null,f.initPTS=Y,f.timescale=B,f.trackId=ee)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${n}`);d?(f.initPTS=d.baseTime,f.timescale=d.timescale,f.trackId=d.trackId):((!f.timescale||f.trackId===void 0||f.initPTS===void 0)&&(this.warn("Could not set initPTS"),f.initPTS=L,f.timescale=1,f.trackId=-1),this.initPTS=d={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const I=L-d.baseTime/d.timescale,M=I+S;S>0?this.lastEndTime=M:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const $=!!m.audio,V=!!m.video;let q="";$&&(q+="audio"),V&&(q+="video");const H=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),N={data1:h,startPTS:I,startDTS:I,endPTS:M,endDTS:M,type:q,hasAudio:$,hasVideo:V,nb:1,dropped:0,encrypted:H};c.audio=$&&!V?N:void 0,c.video=V?N:void 0;const W=E?.sampleCount;if(W){const B=E.keyFrameIndex,Y=B!==-1;N.nb=W,N.dropped=B===0||this.isVideoContiguous?0:Y?B:W,N.independent=Y,N.firstKeyFrame=B,Y&&E.keyFrameStart&&(N.firstKeyFramePTS=(E.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(c.independent=Y),this.isVideoContiguous||(this.isVideoContiguous=Y),N.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${B}/${W} dropped: ${N.dropped} start: ${N.firstKeyFramePTS||"NA"}`)}return c.initSegment=f,c.id3=CE(s,n,d,d),r.samples.length&&(c.text=wE(r,n,d)),c}}function So(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function WI(i,e,t,s){if(i===null)return!0;const r=Math.max(s,1),n=e-i.baseTime/i.timescale;return Math.abs(n-t)>r}function ng(i,e,t){const s=i.codec;return s&&s.length>4?s:e===we.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Ed(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let as;try{as=self.performance.now.bind(self.performance)}catch{as=Date.now}const tl=[{demux:DI,remux:VI},{demux:ws,remux:el},{demux:LI,remux:el},{demux:xI,remux:el}];tl.splice(2,0,{demux:RI,remux:el});class ag{constructor(e,t,s,r,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const n=s.transmuxing;n.executeStart=as();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:d,discontinuity:u,trackSwitch:c,accurateTimeOffset:h,timeOffset:f,initSegmentChange:m}=r||o,{audioCodec:g,videoCodec:p,defaultInitPts:E,duration:T,initSegmentData:y}=l,b=qI(a,t);if(b&&vn(b.method)){const R=this.getDecrypter(),x=Lf(b.method);if(R.isSync()){let I=R.softwareDecrypt(a,b.key.buffer,b.iv.buffer,x);if(s.part>-1){const $=R.flush();I=$&&$.buffer}if(!I)return n.executeEnd=as(),Vu(s);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=R.webCryptoDecrypt(a,b.key.buffer,b.iv.buffer,x).then(I=>{const M=this.push(I,null,s);return this.decryptionPromise=null,M}),this.decryptionPromise}const A=this.needsProbing(u,c);if(A){const R=this.configureTransmuxer(a);if(R)return this.logger.warn(`[transmuxer] ${R.message}`),this.observer.emit(v.ERROR,v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),n.executeEnd=as(),Vu(s)}(u||c||m||A)&&this.resetInitSegment(y,g,p,T,t),(u||m||A)&&this.resetInitialTimestamp(E),d||this.resetContiguity();const L=this.transmux(a,b,f,h,s);this.asyncResult=qa(L);const S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,n.executeEnd=as(),L}flush(e){const t=e.transmuxing;t.executeStart=as();const{decrypter:s,currentTransmuxState:r,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));const a=[],{timeOffset:o}=r;if(s){const c=s.flush();c&&a.push(this.push(c.buffer,null,e))}const{demuxer:l,remuxer:d}=this;if(!l||!d){t.executeEnd=as();const c=[Vu(e)];return this.asyncResult?Promise.resolve(c):c}const u=l.flush(o);return qa(u)?(this.asyncResult=!0,u.then(c=>(this.flushRemux(a,c,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===Z.MAIN?"level":"track"} ${s.level}`);const u=this.remuxer.remux(r,n,a,o,d,l,!0,this.id);e.push({remuxResult:u,chunkMeta:s}),s.transmuxing.executeEnd=as()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,n){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,s,r),o.resetInitSegment(e,t,s,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,s,r,n):a=this.transmuxUnencrypted(e,s,r,n),a}transmuxUnencrypted(e,t,s,r){const{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,o,l,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,n){return this.demuxer.demuxSampleAes(e,t,s).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,s,r,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let n;for(let c=0,h=tl.length;c<h;c++){var a;if((a=tl[c].demux)!=null&&a.probe(e,this.logger)){n=tl[c];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,d=n.remux,u=n.demux;(!l||!(l instanceof d))&&(this.remuxer=new d(s,t,r,this.logger)),(!o||!(o instanceof u))&&(this.demuxer=new u(s,t,r,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Sf(this.config)),e}}function qI(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Vu=i=>({remuxResult:{},chunkMeta:i});function qa(i){return"then"in i&&i.then instanceof Function}class YI{constructor(e,t,s,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=n||null}}class jI{constructor(e,t,s,r,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=a}}let og=0;class ME{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=og++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const d=l.data,u=this.hls;if(!(!u||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var c;const h=(c=this.workerContext)==null?void 0:c.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{u.logger[d.data.logType]&&u.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,u.trigger(d.event,d.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const d=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const a=(l,d)=>{d=d||{},d.frag=this.frag||void 0,l===v.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(l,d)};this.observer=new kf,this.observer.on(v.FRAG_DECRYPTED,a),this.observer.on(v.ERROR,a);const o=_p(n.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(n.workerPath||Z1()){try{n.workerPath?(l.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=eI(n.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=J1());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Me(n)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new ag(this.observer,o,n,"",t,e.logger)}return}}this.transmuxer=new ag(this.observer,o,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=og++;const t=this.hls.config,s=_p(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Me(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),tI(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,n,a,o,l,d,u){var c,h;d.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:m}=this,g=a?a.start:n.start,p=n.decryptdata,E=this.frag,T=!(E&&n.cc===E.cc),y=!(E&&d.level===E.level),b=E?d.sn-E.sn:-1,A=this.part?d.part-this.part.index:-1,L=b===0&&d.id>1&&d.id===E?.stats.chunkCount,S=!y&&(b===1||b===0&&(A===1||L&&A<=0)),R=self.performance.now();(y||b||n.stats.parsing.start===0)&&(n.stats.parsing.start=R),a&&(A||!S)&&(a.stats.parsing.start=R);const x=!(E&&((c=n.initSegment)==null?void 0:c.url)===((h=E.initSegment)==null?void 0:h.url)),I=new jI(T,S,l,y,g,x);if(!S||T||x){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===Z.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${T}
        trackSwitch: ${y}
        contiguous: ${S}
        accurateTimeOffset: ${l}
        timeOffset: ${g}
        initSegmentChange: ${x}`);const M=new YI(s,r,t,o,u);this.configureTransmuxer(M)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:p,chunkMeta:d,state:I},e instanceof ArrayBuffer?[e]:[]);else if(m){const M=m.push(e,p,d,I);qa(M)?M.then($=>{this.handleTransmuxComplete($)}).catch($=>{this.transmuxerError($,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(M)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);qa(r)?r.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const lg=100;class zI extends xf{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Z.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:n,trackId:a}){if(s===Z.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:n,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${r/n} (${r}/${n}) trackId: ${a}`),this.mainAnchor=t,this.state===P.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==o)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===P.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&r?.cc===t.cc)return;const n=(r||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=zv(a,n,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===P.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=P.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(lg),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=P.IDLE):this.state=P.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case P.IDLE:this.doTickIdle();break;case P.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=P.WAITING_INIT_PTS}break}case P.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case P.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:n}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=P.FRAG_LOADING;const o=r.flush().buffer,l={frag:t,part:s,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),n&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=P.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:n}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(s!=null&&s[n]))return;const o=s[n],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=P.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,we.AUDIO,Z.AUDIO));const u=this.getFwdBufferInfo(d,Z.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(v.BUFFER_EOS,{type:"audio"}),this.state=P.ENDED;return}const c=u.len,h=t.maxBufferLength,f=l.fragments,m=f[0].start,g=this.getLoadPosition(),p=this.flushing?g:u.end;if(this.switchingTrack&&r){const y=g;l.PTSKnown&&y<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(c>=h&&!this.switchingTrack&&p<f[f.length-1].start)return;let E=this.getNextFragment(p,l);if(E&&this.isLoopLoading(E,p)&&(E=this.getNextFragmentLoopLoading(E,l,u,Z.MAIN,h)),!E){this.bufferFlushed=!0;return}let T=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&T&&it(E)&&!E.endList&&(!l.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(T)===dt.OK&&(this.mainFragLoading=T=null),T&&it(T))){if(E.start>T.end){const b=this.fragmentTracker.getFragAtPos(p,Z.MAIN);b&&b.end>T.end&&(T=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(E.start>T.end)return}this.loadFragment(E,o,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Ka(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==P.STOPPED&&(this.setInterval(lg),this.state=P.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(v.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:n,id:a,groupId:o,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const d=this.mainDetails;if(!d||n.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==P.STOPPED&&(this.state=P.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const u=r[a];let c=0;if(n.live||(s=u.details)!=null&&s.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;if(u.details){var h;c=this.alignPlaylists(n,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}n.alignedSliding||(fE(n,d),n.alignedSliding||Id(n,d),c=n.fragmentStart)}u.details=n,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(d,c),this.hls.trigger(v.AUDIO_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.state===P.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=P.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:n}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=l[o];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const u=d.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const c=a.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new ME(this.hls,Z.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[s.cc],m=(t=s.initSegment)==null?void 0:t.data;if(f!==void 0){const p=r?r.index:-1,E=p!==-1,T=new If(s.level,s.sn,s.stats.chunkCount,n.byteLength,p,E);h.push(n,m,c,"",s,r,u.totalduration,!1,T,f)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:g}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new mE,complete:!1};g.push(new Uint8Array(n)),this.state!==P.STOPPED&&(this.state=P.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Z.MAIN&&it(t.frag)&&(this.mainFragLoading=t,this.state===P.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==Z.AUDIO){!this.audioOnly&&s.type===Z.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(it(s)){this.fragPrevious=s;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(v.AUDIO_TRACK_SWITCHED,Le({},n)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=P.ERROR;return}switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.AUDIO,t);break;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===P.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===me.AUDIO_TRACK&&(this.state=P.IDLE);break;case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case C.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==we.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==we.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===P.ENDED&&(this.state=P.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,Z.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:d,level:u}=o,{details:c}=u,{audio:h,text:f,id3:m,initSegment:g}=n;if(this.fragContextChanged(l)||!c){this.fragmentTracker.removeFragment(l);return}if(this.state=P.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const p=l.initSegment||l;if(this.unhandledEncryptionError(g,l))return;this._bufferInitSegment(u,g.tracks,p,a),r.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:s,tracks:g.tracks})}if(h){const{startPTS:p,endPTS:E,startDTS:T,endDTS:y}=h;d&&(d.elementaryStreams[we.AUDIO]={startPTS:p,endPTS:E,startDTS:T,endDTS:y}),l.setElementaryStreamInfo(we.AUDIO,p,E,T,y),this.bufferFragmentData(h,l,d,a)}if(m!=null&&(t=m.samples)!=null&&t.length){const p=De({id:s,frag:l,details:c},m);r.trigger(v.FRAG_PARSING_METADATA,p)}if(f){const p=De({id:s,frag:l,details:c},f);r.trigger(v.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,s,r){if(this.state!==P.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const n=t.audio;n.id=Z.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(v.BUFFER_CODECS,t);const o=n.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:o};this.hls.trigger(v.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===dt.NOT_LOADED||r===dt.PARTIAL){var n;if(!it(e))this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=P.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Id(t.details,a)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:n,audioCodec:a,channels:o}=this.bufferedTrack;gr({name:t,lang:s,assocLang:r,characteristics:n,audioCodec:a,channels:o},e,Zs)||(Td(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(v.AUDIO_TRACK_SWITCHED,Le({},e))}}class Nf extends si{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t?.renditionReports;if(r){let n=-1;for(let a=0;a<r.length;a++){const o=r[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),l=o.URI||""}if(l===e){n=a;break}else l===e.substring(0,l.length)&&(n=a)}if(n!==-1){const a=r[n],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const d=s&&Ap(s);return new Sp(o,l>=0?l:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:n}=t,a=self.performance.now(),o=n.loading.first?Math.max(0,a-n.loading.first):0;r.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(c=>{c.setStart(c.playlistOffset+u)})}if(r.live||s!=null&&s.live){const u="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){H1(s,r,this);const T=r.playlistParsingError;if(T){this.warn(T);const y=this.hls;if(!y.config.ignorePlaylistParsingErrors){var d;const{networkDetails:b}=t;y.trigger(v.ERROR,{type:te.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:T,reason:T.message,level:t.level||void 0,parent:(d=r.fragments[0])==null?void 0:d.type,networkDetails:b,stats:n});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=n.loading.start);const c=this.hls.mainForwardBufferInfo,h=c?c.end-c.len:0,f=(r.edge-h)*1e3,m=lE(r,f);if(r.requestScheduled+m<a?r.requestScheduled=a:r.requestScheduled+=m,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let g,p,E;if(r.canBlockReload&&r.endSN&&r.advanced){const T=this.hls.config.lowLatencyMode,y=r.lastPartSn,b=r.endSN,A=r.lastPartIndex,L=A!==-1,S=y===b;L?S?(p=b+1,E=T?0:A):(p=y,E=T?A+1:r.maxPartIndex):p=b+1;const R=r.age,x=R+r.ageHeader;let I=Math.min(x-r.partTarget,r.targetduration*1.5);if(I>0){if(x>r.targetduration*3)this.log(`Playlist last advanced ${R.toFixed(2)}s ago. Omitting segment and part directives.`),p=void 0,E=void 0;else if(s!=null&&s.tuneInGoal&&x-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${I} with playlist age: ${r.age}`),I=0;else{const M=Math.floor(I/r.targetduration);if(p+=M,E!==void 0){const $=Math.round(I%r.targetduration/r.partTarget);E+=$}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${I} skip sn ${M} to part ${E}`)}r.tuneInGoal=I}if(g=this.getDeliveryDirectives(r,t.deliveryDirectives,p,E),T||!S){r.requestScheduled=a,this.loadingPlaylist(u,g);return}}else(r.canBlockReload||r.canSkipUntil)&&(g=this.getDeliveryDirectives(r,t.deliveryDirectives,p,E));g&&p!==void 0&&r.canBlockReload&&(r.requestScheduled=n.loading.first+Math.max(m-o*2,m/2)),this.scheduleLoading(u,g,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const n=self.performance.now(),a=r.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}const o=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,s,r){let n=Ap(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,n=Zo.No),new Sp(s,r,n)}checkRetry(e){const t=e.details,s=bd(e),r=e.errorAction,{action:n,retryCount:a=0,retryConfig:o}=r||{},l=!!r&&!!o&&(n===vt.RetryRequest||!r.resolved&&n===vt.SendAlternateToPenaltyBox);if(l){var d;if(a>=o.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Af(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function PE(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Ya(i[t].attrs,e[t].attrs))return!1;return!0}function Ya(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function $c(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class QI extends Nf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${r} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let n=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(o=>r?.indexOf(o)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!s||s.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!n&&l){const h=Gi(l,o,Zs);if(h>-1)n=o[h];else{const f=Gi(l,this.tracks);n=this.tracks[f]}}let d=this.findTrackId(n);d===-1&&n&&(d=this.findTrackId(null));const u={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(v.AUDIO_TRACKS_UPDATED,u);const c=this.trackId;if(d!==-1&&c===-1)this.setAudioTrack(d);else if(o.length&&c===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===me.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&gr(e,r,Zs))return r;const n=Gi(e,this.tracksInGroup,Zs);if(n>-1){const a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=l1(e,t.levels,s,a,Zs);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Gi(e,s);if(a>-1)return s[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],n=r.details&&!r.details.live;if(e===this.trackId&&r===s&&n||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(v.AUDIO_TRACK_SWITCHING,Le({},r)),n))return;const a=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||gr(e,r,Zs)))return s}if(e){const{name:s,lang:r,assocLang:n,characteristics:a,audioCodec:o,channels:l}=e;for(let d=0;d<t.length;d++){const u=t[d];if(gr({name:s,lang:r,assocLang:n,characteristics:a,audioCodec:o,channels:l},u,Zs))return d}for(let d=0;d<t.length;d++){const u=t[d];if(Ya(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const u=t[d];if(Ya(e.attrs,u.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Td(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(v.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class XI{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(n){var s;if(r.onError(n),this.queues===null||this.tracks===null)return;const a=(s=this.tracks[e])==null?void 0:s.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const dg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,OE="HlsJsTrackRemovedError";class ZI extends Error{constructor(e){super(e),this.name=OE}}class JI extends si{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:n}=this;s&&this.log("Media source opened"),!(!r||!n)&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(v.MEDIA_ATTACHED,{media:r,mediaSource:n}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=bS(Bs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_APPENDING,this.onBufferAppending,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.BUFFER_EOS,this.onBufferEos,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.FRAG_PARSED,this.onFragParsed,this),e.on(v.FRAG_CHANGED,this.onFragChanged,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_APPENDING,this.onBufferAppending,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_EOS,this.onBufferEos,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.FRAG_PARSED,this.onFragParsed,this),e.off(v.FRAG_CHANGED,this.onFragChanged,this),e.off(v.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const n=this.isUpdating();n||this.operationQueue.removeBlockers();const a=this.isQueued();(n||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${n?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?De(s,r.tracks):this.sourceBuffers.forEach(n=>{const[a]=n;a&&(s[a]=De({},this.tracks[a]),this.removeBuffer(a)),n[0]=n[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=Bs(this.appendSource);if(r){const n=!!t.mediaSource;(n||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),n)this._objectUrl=s.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&a instanceof l,ug(s),eL(s,o),s.load()}catch{s.src=o}else s.src=o}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,n=r?Object.keys(r):null,a=n?n.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Me(s,(l,d)=>l==="initSegment"?void 0:d)};
transfer tracks: ${Me(r,(l,d)=>l==="initSegment"?void 0:d)}}`),!Cv(r,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,d=this.details,u=Math.max(l,d?.fragments[0].start||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(v.MEDIA_DETACHING,{}),this.onMediaAttaching(v.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,n.forEach(l=>{const d=l,u=r[d];if(u){const c=u.buffer;if(c){const h=this.fragmentTracker,f=u.id;if(h.hasFragments(f)||h.hasParts(f)){const p=le.getBuffered(c);h.detectEvictedFragments(d,p,f,null,!0)}const m=Wu(d),g=[d,c];this.sourceBuffers[m]=g,c.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,u)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=n.readyState==="open";try{const l=n.sourceBuffers;for(let d=l.length;d--;)o&&l[d].abort(),n.removeSourceBuffer(l[d]);o&&n.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&ug(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(v.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(n){this.warn(`onBufferReset ${e}`,n)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Wu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new XI(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&n.some(l=>!r[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${n}" SourceBuffers`);return}n.forEach(l=>{var d,u;const c=t[l],{id:h,codec:f,levelCodec:m,container:g,metadata:p,supplemental:E}=c;let T=r[l];const y=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[l],b=y!=null&&y.buffer?y:T,A=b?.pendingCodec||b?.codec,L=b?.levelCodec;T||(T=r[l]={buffer:void 0,listeners:[],codec:f,supplemental:E,container:g,levelCodec:m,metadata:p,id:h});const S=Xo(A,L),R=S?.replace(dg,"$1");let x=Xo(f,m);const I=(u=x)==null?void 0:u.replace(dg,"$1");x&&S&&R!==I&&(l.slice(0,5)==="audio"&&(x=Ed(x,this.appendSource)),this.log(`switching codec ${A} to ${x}`),x!==(T.pendingCodec||T.codec)&&(T.pendingCodec=x),T.container=g,this.appendChangeType(l,g,x))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,n={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),o.changeType(r),a.codec=s,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,Z.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&le.isBuffered(l.buffer,r)||((o=this.fragmentTracker.getAppendedFrag(r,Z.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:n,parent:a,frag:o,part:l,chunkMeta:d,offset:u}=t,c=d.buffering[n],{sn:h,cc:f}=o,m=self.performance.now();c.start=m;const g=o.stats.buffering,p=l?l.stats.buffering:null;g.start===0&&(g.start=m),p&&p.start===0&&(p.start=m);const E=s.audio;let T=!1;n==="audio"&&E?.container==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const y=s.video,b=y?.buffer;if(b&&h!=="initSegment"){const S=l||o,R=this.blockedAudioAppend;if(n==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(y.ending||y.ended)){const I=S.start+S.duration*.05,M=b.buffered,$=this.currentOp("video");!M.length&&!$?this.blockAudio(S):!$&&!le.isBuffered(b,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(S)}else if(n==="video"){const x=S.end;if(R){const I=R.frag.start;(x>I||x<this.lastVideoAppendEnd||le.isBuffered(b,I))&&this.unblockAudio()}this.lastVideoAppendEnd=x}}const A=(l||o).start,L={label:`append-${n}`,execute:()=>{var S;c.executeStart=self.performance.now();const R=(S=this.tracks[n])==null?void 0:S.buffer;R&&(T?this.updateTimestampOffset(R,A,.1,n,h,f):u!==void 0&&j(u)&&this.updateTimestampOffset(R,u,1e-6,n,h,f)),this.appendExecutor(r,n)},onStart:()=>{},onComplete:()=>{const S=self.performance.now();c.executeEnd=c.end=S,g.first===0&&(g.first=S),p&&p.first===0&&(p.first=S);const R={};this.sourceBuffers.forEach(([x,I])=>{x&&(R[x]=le.getBuffered(I))}),this.appendErrors[n]=0,n==="audio"||n==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(v.BUFFER_APPENDED,{type:n,frag:o,part:l,chunkMeta:d,parent:o.type,timeRanges:R})},onError:S=>{var R;const x={type:te.MEDIA_ERROR,parent:o.type,details:C.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:o,part:l,chunkMeta:d,error:S,err:S,fatal:!1},I=(R=this.media)==null?void 0:R.error;if(S.code===DOMException.QUOTA_EXCEEDED_ERR||S.name=="QuotaExceededError"||"quota"in S)x.details=C.BUFFER_FULL_ERROR;else if(S.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)x.errorAction=gn(!0);else if(S.name===OE&&this.sourceBufferCount===0)x.errorAction=gn(!0);else{const M=++this.appendErrors[n];this.warn(`Failed ${M}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${I||"no media error"})`),(M>=this.hls.config.appendErrorMaxRetry||I)&&(x.fatal=!0)}this.hls.trigger(v.ERROR,x)}};this.log(`queuing "${n}" append sn: ${h}${l?" p: "+l.index:""} of ${o.type===Z.MAIN?"level":"track"} ${o.level} cc: ${f}`),this.append(L,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(v.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:n}=t;s?this.append(this.getFlushOp(s,r,n),s):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,n),a)})}onFragParsed(e,t){const{frag:s,part:r}=t,n=[],a=r?r.elementaryStreams:s.elementaryStreams;a[we.AUDIOVIDEO]?n.push("audiovideo"):(a[we.AUDIO]&&n.push("audio"),a[we.VIDEO]&&n.push("video"));const o=()=>{const l=self.performance.now();s.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const d=r?r.stats:s.stats;this.hls.trigger(v.FRAG_BUFFERED,{frag:s,part:r,stats:d,id:s.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(o,n).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(v.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(v.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===C.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;j(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,n=s.currentTime,a=t.levelTargetDuration,o=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(j(o)&&o>=0){const d=Math.max(o,a),u=Math.floor(n/a)*a-d;this.flushBackBuffer(n,a,u)}const l=r.frontBufferFlushThreshold;if(j(l)&&l>0){const d=Math.max(r.maxBufferLength,l),u=Math.max(d,a),c=Math.floor(n/a)*a+u;this.flushFrontBuffer(n,a,c)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,n])=>{if(n){const o=le.getBuffered(n);if(o.length>0&&s>o.start(0)){var a;this.hls.trigger(v.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(v.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,n])=>{if(n){const a=le.getBuffered(n),o=a.length;if(o<2)return;const l=a.start(o-1),d=a.end(o-1);if(s>l||e>=l&&e<=d)return;this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),u=Math.max(d,r);return{duration:1/0,start:d,end:u}}return{duration:1/0}}const n=(e=this.overrides)==null?void 0:e.duration;if(n)return j(n)?{duration:n}:null;const a=this.media.duration,o=j(s.duration)?s.duration:0;return r>o&&r>a||!j(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(j(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Me(s)}`),this.tracksReady){var r;const n=(r=this.transferData)==null?void 0:r.tracks;n&&Object.keys(n).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(v.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const a=n,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),d=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${d})${this.currentOp(a)?" Queued":""} ${Me(o)}`);try{const u=s.addSourceBuffer(d),c=Wu(a),h=[a,u];t[c]=h,o.buffer=u}catch(u){var r;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:a,mimeType:d,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&Ha(s,"video")&&(r=KS(r,s));const n=Xo(r,e.levelCodec);return n?t.slice(0,5)==="audio"?Ed(n,this.appendSource):n:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(n,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(v.BUFFER_FLUSHED,{type:n})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const n=this.currentOp(e);n&&n.onError(r)}updateTimestampOffset(e,t,s,r,n,a){const o=t-e.timestampOffset;Math.abs(o)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:n}=this,a=this.tracks[e],o=a?.buffer;if(!r||!n||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=j(r.duration)?r.duration:1/0,d=j(n.duration)?n.duration:1/0,u=Math.max(0,t),c=Math.min(s,l,d);c>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${c}] from the ${e} SourceBuffer`),o.remove(u,c)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s?.buffer;if(!r)throw new ZI(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const n=r.buffer;if(!n)return;const a=s.bind(this,e);r.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function ug(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function eL(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Wu(i){return i==="audio"?1:0}class Uf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&j(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,n)=>this.isLevelAllowed(r)&&n<=e);return this.clientRect=null,Uf.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let n=e.length-1;const a=Math.max(t,s);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&r(l,e[o+1])){n=o;break}}return n}}const tL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Rt=tL,iL={HLS:"h"},sL=iL;class zi{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof zi?s:new zi(s))),this.value=e,this.params=t}}const rL="Dict";function nL(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function aL(i,e,t,s){return new Error(`failed to ${i} "${nL(e)}" as ${t}`,{cause:s})}function Qi(i,e,t){return aL("serialize",i,e,t)}class NE{constructor(e){this.description=e}}const cg="Bare Item",oL="Boolean";function lL(i){if(typeof i!="boolean")throw Qi(i,oL);return i?"?1":"?0"}function dL(i){return btoa(String.fromCharCode(...i))}const uL="Byte Sequence";function cL(i){if(ArrayBuffer.isView(i)===!1)throw Qi(i,uL);return`:${dL(i)}:`}const hL="Integer";function fL(i){return i<-999999999999999||999999999999999<i}function UE(i){if(fL(i))throw Qi(i,hL);return i.toString()}function mL(i){return`@${UE(i.getTime()/1e3)}`}function $E(i,e){if(i<0)return-$E(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const pL="Decimal";function gL(i){const e=$E(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Qi(i,pL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const vL="String",EL=/[\x00-\x1f\x7f]+/;function yL(i){if(EL.test(i))throw Qi(i,vL);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function TL(i){return i.description||i.toString().slice(7,-1)}const bL="Token";function hg(i){const e=TL(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Qi(e,bL);return e}function Fc(i){switch(typeof i){case"number":if(!j(i))throw Qi(i,cg);return Number.isInteger(i)?UE(i):gL(i);case"string":return yL(i);case"symbol":return hg(i);case"boolean":return lL(i);case"object":if(i instanceof Date)return mL(i);if(i instanceof Uint8Array)return cL(i);if(i instanceof NE)return hg(i);default:throw Qi(i,cg)}}const _L="Key";function Bc(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Qi(i,_L);return i}function $f(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Bc(e)}`:`;${Bc(e)}=${Fc(t)}`).join("")}function FE(i){return i instanceof zi?`${Fc(i.value)}${$f(i.params)}`:Fc(i)}function AL(i){return`(${i.value.map(FE).join(" ")})${$f(i.params)}`}function SL(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Qi(i,rL);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([r,n])=>{n instanceof zi||(n=new zi(n));let a=Bc(r);return n.value===!0?a+=$f(n.params):(a+="=",Array.isArray(n.value)?a+=AL(n):a+=FE(n)),a}).join(`,${s}`)}function BE(i,e){return SL(i,e)}const _i="CMCD-Object",Ke="CMCD-Request",Ys="CMCD-Session",Es="CMCD-Status",IL={br:_i,ab:_i,d:_i,ot:_i,tb:_i,tpb:_i,lb:_i,tab:_i,lab:_i,url:_i,pb:Ke,bl:Ke,tbl:Ke,dl:Ke,ltc:Ke,mtp:Ke,nor:Ke,nrr:Ke,rc:Ke,sn:Ke,sta:Ke,su:Ke,ttfb:Ke,ttfbb:Ke,ttlb:Ke,cmsdd:Ke,cmsds:Ke,smrt:Ke,df:Ke,cs:Ke,ts:Ke,cid:Ys,pr:Ys,sf:Ys,sid:Ys,st:Ys,v:Ys,msd:Ys,bs:Es,bsd:Es,cdn:Es,rtp:Es,bg:Es,pt:Es,ec:Es,e:Es},LL={REQUEST:Ke};function RL(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function xL(i,e){const t={};if(!i)return t;const s=Object.keys(i),r=e?RL(e):{};return s.reduce((n,a)=>{var o;const l=IL[a]||r[a]||LL.REQUEST,d=(o=n[l])!==null&&o!==void 0?o:n[l]={};return d[a]=i[a],n},t)}function kL(i){return["ot","sf","st","e","sta"].includes(i)}function DL(i){return typeof i=="number"?j(i):i!=null&&i!==""&&i!==!1}const HE="event";function CL(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const r=t.pathname.split("/").slice(1),n=s.pathname.split("/").slice(1,-1);for(;r[0]===n[0];)r.shift(),n.shift();for(;n.length;)n.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const il=i=>Math.round(i),Hc=(i,e)=>Array.isArray(i)?i.map(t=>Hc(t,e)):i instanceof zi&&typeof i.value=="string"?new zi(Hc(i.value,e),i.params):(e.baseUrl&&(i=CL(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Io=i=>il(i/100)*100,wL=(i,e)=>{let t=i;return e.version>=2&&(i instanceof zi&&typeof i.value=="string"?t=new zi([i]):typeof i=="string"&&(t=[i])),Hc(t,e)},ML={br:il,d:il,bl:Io,dl:Io,mtp:Io,nor:wL,rtp:Io,tb:il},GE="request",KE="response",Ff=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],PL=["e"],OL=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ru(i){return OL.test(i)}function NL(i){return Ff.includes(i)||PL.includes(i)||ru(i)}const VE=["d","dl","nor","ot","rtp","su"];function UL(i){return Ff.includes(i)||VE.includes(i)||ru(i)}const $L=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function FL(i){return Ff.includes(i)||VE.includes(i)||$L.includes(i)||ru(i)}const BL=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function HL(i){return BL.includes(i)||ru(i)}const GL={[KE]:FL,[HE]:NL,[GE]:UL};function WE(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,r=e.reportingMode||GE,n=s===1?HL:GL[r];let a=Object.keys(i).filter(n);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=r===KE||r===HE;l&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const d=De({},ML,e.formatters),u={version:s,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(c=>{let h=i[c];const f=d[c];if(typeof f=="function"&&(h=f(h,u)),c==="v"){if(s===1)return;h=s}c=="pr"&&h===1||(l&&c==="ts"&&!j(h)&&(h=Date.now()),DL(h)&&(kL(c)&&typeof h=="string"&&(h=new NE(h)),t[c]=h))}),t}function KL(i,e={}){const t={};if(!i)return t;const s=WE(i,e),r=xL(s,e?.customHeaderMap);return Object.entries(r).reduce((n,[a,o])=>{const l=BE(o,{whitespace:!1});return l&&(n[a]=l),n},t)}function VL(i,e,t){return De(i,KL(e,t))}const WL="CMCD";function qL(i,e={}){return i?BE(WE(i,e),{whitespace:!1}):""}function YL(i,e={}){if(!i)return"";const t=qL(i,e);return encodeURIComponent(t)}function jL(i,e={}){if(!i)return"";const t=YL(i,e);return`${WL}=${t}`}const fg=/CMCD=[^&#]+/;function zL(i,e,t){const s=jL(e,t);if(!s)return i;if(fg.test(i))return i.replace(fg,s);const r=i.includes("?")?"&":"?";return`${i}${r}${s}`}class QL{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Rt.MANIFEST,su:!this.initialized})}catch(n){this.hls.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=r=>{try{const{frag:n,part:a}=r,o=this.hls.levels[n.level],l=this.getObjectType(n),d={d:(a||n).duration*1e3,ot:l};(l===Rt.VIDEO||l===Rt.AUDIO||l==Rt.MUXED)&&(d.br=o.bitrate/1e3,d.tb=this.getTopBandwidth(l)/1e3,d.bl=this.getBufferLength(l));const u=a?this.getNextPart(a):this.getNextFrag(n);u!=null&&u.url&&u.url!==n.url&&(d.nor=u.url),this.apply(r,d)}catch(n){this.hls.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHED,this.onMediaDetached,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHED,this.onMediaDetached,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:sL.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){De(t,this.createData());const s=t.ot===Rt.INIT||t.ot===Rt.VIDEO||t.ot===Rt.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,o)=>(r.includes(o)&&(a[o]=t[o]),a),{}));const n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),VL(e.headers,t,n)):e.url=zL(e.url,t,n)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,n=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(n){const{sn:a}=r;for(let o=n.length-1;o>=0;o--){const l=n[o];if(l.index===s&&l.fragment.sn===a)return n[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Rt.TIMED_TEXT;if(e.sn==="initSegment")return Rt.INIT;if(t==="audio")return Rt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Rt.VIDEO:Rt.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===Rt.AUDIO)s=r.audioTracks;else{const n=r.maxAutoLevel,a=n>-1?n+1:r.levels.length;s=r.levels.slice(0,a)}return s.forEach(n=>{n.bitrate>t&&(t=n.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Rt.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:le.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}}const XL=3e5;class ZL extends si{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===vt.SendAlternateToPenaltyBox&&s.flags===Bt.MoveAllAlternatesMatchingHost){const r=this.levels;let n=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:d}=t.context;o&&r?a=this.getPathwayForGroupId(o,d,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&r&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),s.resolved=this.pathwayId!==a),t.details===C.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${Me(n)} penalized: ${Me(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(n=>{r-s[n]>XL&&delete s[n]});for(let n=0;n<e.length;n++){const a=e[n];if(a in s)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,cE(t),this.hls.trigger(v.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[o];l&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let n=0;n<r.length;n++)if(t===me.AUDIO_TRACK&&r[n].hasAudioGroup(e)||t===me.SUBTITLE_TRACK&&r[n].hasSubtitleGroup(e))return r[n].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(n=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=n;if(t.some(u=>u.pathwayId===a))return;const d=this.getLevelsForPathway(o).map(u=>{const c=new He(u.attrs);c["PATHWAY-ID"]=a;const h=c.AUDIO&&`${c.AUDIO}_clone_${a}`,f=c.SUBTITLES&&`${c.SUBTITLES}_clone_${a}`;h&&(s[c.AUDIO]=h,c.AUDIO=h),f&&(r[c.SUBTITLES]=f,c.SUBTITLES=f);const m=qE(u.uri,c["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new Ka({attrs:c,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let p=1;p<u.audioGroups.length;p++)g.addGroupId("audio",`${u.audioGroups[p]}_clone_${a}`);if(u.subtitleGroups)for(let p=1;p<u.subtitleGroups.length;p++)g.addGroupId("text",`${u.subtitleGroups[p]}_clone_${a}`);return g});t.push(...d),mg(this.audioTracks,s,l,a),mg(this.subtitleTracks,r,l,a)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const n={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(u,c,h,f)=>{this.log(`Loaded steering manifest: "${r}"`);const m=u.data;if(m?.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":p,"PATHWAY-PRIORITY":E}=m;if(g)try{this.uri=new self.URL(g,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||h.url),p&&this.clonePathways(p);const T={steeringManifest:m,url:r.toString()};this.hls.trigger(v.STEERING_MANIFEST_LOADED,T),E&&this.updatePathwayPriority(E)},onError:(u,c,h,f)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${c.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${c.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const g=this.loader;if(typeof g?.getResponseHeader=="function"){const p=g.getResponseHeader("Retry-After");p&&(m=parseFloat(p)*1e3)}this.log(`Steering manifest ${c.url} rate limited`);return}this.scheduleRefresh(this.uri||c.url,m)},onTimeout:(u,c,h)=>{this.log(`Timeout loading steering manifest (${c.url})`),this.scheduleRefresh(this.uri||c.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(n,l,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function mg(i,e,t,s){i&&Object.keys(e).forEach(r=>{const n=i.filter(a=>a.groupId===r).map(a=>{const o=De({},a);return o.details=void 0,o.attrs=new He(o.attrs),o.url=o.attrs.URI=qE(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=s,o});i.push(...n)})}function qE(i,e,t,s){const{HOST:r,PARAMS:n,[t]:a}=s;let o;e&&(o=a?.[e],o&&(i=o));const l=new self.URL(i);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach(d=>{d&&l.searchParams.set(d,n[d])}),l.href}class En extends si{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=En.CDMCleanupPromise?[En.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,n=`"${t.type}" event: init data type: "${s}"`;if(this.debug(n),r!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=ia(this.config));const o=a.map(Uu).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Jo(a);if(s!=="sinf"||o!==Ge.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${o}`);return}let l;try{const f=lt(new Uint8Array(r)),m=Rf(JSON.parse(f).sinf),g=Bv(m);if(!g)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(g.subarray(8,24))}catch(f){this.warn(`${n} Failed to parse sinf: ${f}`);return}const d=It(l),{keyIdToKeySessionPromise:u,mediaKeySessions:c}=this;let h=u[d];for(let f=0;f<c.length;f++){const m=c[f],g=m.decryptdata;if(!g.keyId)continue;const p=It(g.keyId);if(Ad(l,g.keyId)||g.uri.replace(/-/g,"").indexOf(d)!==-1){if(h=u[p],!h)continue;if(g.pssh)break;delete u[p],g.pssh=new Uint8Array(r),g.keyId=l,h=u[d]=h.then(()=>this.generateRequestWithPreferredKeySession(m,s,r,"encrypted-event-key-match")),h.catch(E=>this.handleError(E));break}}h||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${c.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(v.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(v.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t?.[e];if(r)return r.licenseUrl;if(e===Ge.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(a,o,l)=>!!a&&l.indexOf(a)===o,r=t.map(a=>a.audioCodec).filter(s),n=t.map(a=>a.videoCodec).filter(s);return r.length+n.length===0&&n.push("avc1.42e01e"),new Promise((a,o)=>{const l=d=>{const u=d.shift();this.getMediaKeysPromise(u,r,n).then(c=>a({keySystem:u,mediaKeys:c})).catch(c=>{d.length?l(d):c instanceof $t?o(c):o(new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_ACCESS,error:c,fatal:!0},c.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return sE===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const n=w1(e,t,s,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(r=a)==null?void 0:r.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Me(n)}`),o=this.requestMediaKeySystemAccess(e,n);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),o.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const c=l.mediaKeys=d.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h)));return c.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),c})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${It(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=Lo(t),n="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,n,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${It(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Uu(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const n=Uu(r);n?t(n):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ia(this.config),s=e.map(Jo).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=JL(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=Lo(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const o=pg(r||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const n=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);const a=this.keyIdToKeySessionPromise[s];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(l,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:d,decryptdata:t}))))).then(l=>{const d="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,d,u,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[s]=o,o}return a.catch(o=>{if(o instanceof $t){const l=Le({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const d=new $t(l,o.message);this.handleError(d,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof $t){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${It(s.keyId||[])})`:""}`),this.hls.trigger(v.ERROR,e.data)}else this.error(e.message),this.hls.trigger(v.ERROR,{type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Lo(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=Jo(e.keyFormat),n=r?[r]:ia(this.config);return this.attemptKeySystemAccess(n)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=ia(this.config)),e.length===0)throw new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Me({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((n,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(n).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>s.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var n;const a=(n=this.config.drmSystems)==null||(n=n[e.keySystem])==null?void 0:n.generateRequest;if(a)try{const m=a.call(this.hls,t,s,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,s=m.initData?m.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const o=Lo(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${s.byteLength})`);const d=new kf,u=e._onmessage=m=>{const g=e.mediaKeysSession;if(!g){d.emit("error",new Error("invalid state"));return}const{messageType:p,message:E}=m;this.log(`"${p}" message event for session "${g.sessionId}" message size: ${E.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(e,E).catch(T=>{d.eventNames().length?d.emit("error",T):this.handleError(T)}):p==="license-release"?e.keySystem===Ge.FAIRPLAY&&this.updateKeySession(e,Mc("acknowledged")).then(()=>this.removeSession(e)).catch(T=>this.handleError(T)):this.warn(`unhandled media key message type "${p}"`)},c=(m,g)=>{g.keyStatus=m;let p;m.startsWith("usable")?d.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?p=pg(m,g.decryptdata):m==="expired"?p=new Error(`key expired (keyId: ${o})`):m==="released"?p=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${o})`),p&&(d.eventNames().length?d.emit("error",p):this.handleError(p))},h=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const p=this.getKeyStatuses(e);if(!Object.keys(p).some(b=>p[b]!=="status-pending"))return;if(p[o]==="expired"){this.log(`Expired key ${Me(p)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let T=p[o];if(T)c(T,e);else{var y;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(y=e.keyStatusTimeouts)[o]||(y[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const A=this.getKeyStatus(e.decryptdata);if(A&&A!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${A} from other session.`),c(A,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),T="internal-error",c(T,e)},1e3)),this.log(`No status for keyId ${o} (${Me(p)}).`)}};Lt(e.mediaKeysSession,"message",u),Lt(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((m,g)=>{d.on("error",g),d.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(m=>{throw new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>f).catch(m=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const o=r;r=s,s=o}const n="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===Ge.PLAYREADY&&n.length===16&&tE(n);const a=It(n);s==="internal-error"&&(this.bannedKeyIds[a]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:n},d=t.certLoadPolicy.default,u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(h,f,m,g)=>{a(h.data)},onError:(h,f,m,g)=>{o(new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Le({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${n}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,m)=>{o(new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(h,f,m)=>{o(new Error("aborted"))}};r.load(l,u,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,n)=>{e.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(a=>{n(new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),n=r.querySelectorAll("HttpHeader");if(n.length>0){let u;for(let c=0,h=n.length;c<h;c++){var a,o;u=n[c];const f=(a=u.querySelector("name"))==null?void 0:a.textContent,m=(o=u.querySelector("value"))==null?void 0:o.textContent;f&&m&&e.setRequestHeader(f,m)}}const l=r.querySelector("Challenge"),d=l?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Mc(atob(d))}setupLicenseXHR(e,t,s,r){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,s,r)}).catch(a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,s,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,n)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const d=this.config.licenseResponseCallback;if(d)try{l=d.call(this.hls,o,a,e)}catch(u){this.error(u)}r(l)}else{const l=s.errorRetry,d=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||o.status>=400&&o.status<500)n(new $t({type:te.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const u=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:d})=>{e.keySystem==Ge.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(l,d)),l.send(d)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Lt(s,"encrypted",this.onMediaEncrypted),Lt(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(Dt(e,"encrypted",this.onMediaEncrypted),Dt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,vr.clearKeyUriToKeyIdMap();const n=r.length;En.CDMCleanupPromise=Promise.all(r.map(a=>this.removeSession(a)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,n)=>(r.indexOf(n.keyFormat)===-1&&r.push(n.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${It(r?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(d=>self.clearTimeout(a[d]));const{drmSystemOptions:o}=this.config;return(P1(o)?new Promise((d,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(u)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}En.CDMCleanupPromise=void 0;function Lo(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return It(i.keyId)}function JL(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class $t extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function pg(i,e){const t=i==="output-restricted",s=t?C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:C.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new $t({type:te.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class eR{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const n=r-this.lastTime,a=s-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/n,d=this.hls;if(d.trigger(v.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:s}),l>0&&a>d.config.fpsDroppedMonitoringThreshold*o){let u=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=u)&&(u=u-1,d.trigger(v.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:d.currentLevel}),d.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function YE(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function jE(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Re.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Re.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function un(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Gc(i,e,t,s){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const n=iR(i.cues,e,t);for(let a=0;a<n.length;a++)(!s||s(n[a]))&&i.removeCue(n[a])}r==="disabled"&&(i.mode=r)}function tR(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,r=t,n;for(;s<=r;)if(n=Math.floor((r+s)/2),e<i[n].startTime)r=n-1;else if(e>i[n].startTime&&s<t)s=n+1;else return n;return i[s].startTime-e<e-i[r].startTime?s:r}function iR(i,e,t){const s=[],r=tR(i,e);if(r>-1)for(let n=r,a=i.length;n<a;n++){const o=i[n];if(o.startTime>=e&&o.endTime<=t)s.push(o);else if(o.startTime>t)return s}return s}function sl(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class sR extends Nf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=sl(this.media.textTracks);for(let n=0;n<s.length;n++)if(s[n].mode==="hidden")t=s[n];else if(s[n].mode==="showing"){t=s[n];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;sl(s.textTracks).forEach(a=>{un(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${r} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let n=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(a=>r?.indexOf(a)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!s||s.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,c)=>{u.id=c});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!n&&o){this.selectDefaultTrack=!1;const u=Gi(o,a);if(u>-1)n=a[u];else{const c=Gi(o,this.tracks);n=this.tracks[c]}}let l=this.findTrackId(n);l===-1&&n&&(l=this.findTrackId(null));const d={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(v.SUBTITLE_TRACKS_UPDATED,d),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const n=t[r];if(!(s&&!n.default||!s&&!e)&&(!e||gr(n,e)))return r}if(e){for(let r=0;r<t.length;r++){const n=t[r];if(Ya(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const n=t[r];if(Ya(e.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if($c(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===me.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&gr(e,s))return s;const r=Gi(e,this.tracksInGroup);if(r>-1){const n=this.tracksInGroup[r];return this.setSubtitleTrack(r),n}else{if(s)return null;{const n=Gi(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(v.SUBTITLE_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=sl(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(n=>$c(s,n))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==r&&(n.mode="disabled")}),r){const n=this.subtitleDisplay?"showing":"hidden";r.mode!==n&&(r.mode=n)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!j(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:e});return}const n=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&n)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:o="",name:l,type:d,url:u}=r;this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:d,url:u});const c=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(c)}}function rR(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?n:n&3|8).toString(16)})}}}function xa(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const yn=.025;let Rd=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function nR(i,e,t){return`${i.identifier}-${t+1}-${xa(e)}`}class aR{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return qu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=qu(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=j(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return qu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<yn))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Rd.Range:Rd.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return oR(this)}}function qu(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<yn)?e.start:e.start+e.duration}function zE(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Yu(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function oR(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function Gr(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class lR{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(v.PLAYOUT_LIMIT_REACHED,{})};const n=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const a=()=>{this.hasDetails=!0};n.once(v.LEVEL_LOADED,a),n.once(v.AUDIO_TRACK_LOADED,a),n.once(v.SUBTITLE_TRACK_LOADED,a),n.on(v.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(v.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,n.trigger(v.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=zE(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,n=le.bufferInfo(e,r,0);return this.getAssetTime(n.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=le.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Gr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const gg=.033;class dR extends si{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(n=r[s])!=null&&n.event;){var n;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let n=s[r];if(t&&t!=="primary"&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const n=s[r].event;if(n!=null&&n.restrictions.jump&&!n.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let n=0;n<r;n++){const a=s[n];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||n===r-1))return n}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,n=this.events,a=this.parseDateRanges(r,{url:s.url},t),o=Object.keys(r),l=n?n.filter(d=>!o.includes(d.identifier)):[];a.length&&a.sort((d,u)=>{const c=d.cue.pre,h=d.cue.post,f=u.cue.pre,m=u.cue.post;if(c&&!f)return-1;if(f&&!c||h&&!m)return 1;if(m&&!h)return-1;if(!c&&!f&&!h&&!m){const g=d.startTime,p=u.startTime;if(g!==p)return g-p}return d.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=a,l.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const n=this.items,a=this.parseSchedule(r,e);(s||t.length||n?.length!==a.length||a.some((l,d)=>Math.abs(l.playout.start-n[d].playout.start)>.005||Math.abs(l.playout.end-n[d].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,s){const r=[],n=Object.keys(e);for(let a=0;a<n.length;a++){const o=n[a],l=e[o];if(l.isInterstitial){let d=this.eventMap[o];d?d.setDateRange(l):(d=new aR(l,t),this.eventMap[o]=d,s===!1&&(d.appendInPlace=s)),r.push(d)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,n=r.live?1/0:r.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,d=0;if(e.forEach((u,c)=>{const h=u.cue.pre,f=u.cue.post,m=e[c-1]||null,g=u.appendInPlace,p=f?n:u.startOffset,E=u.duration,T=u.timelineOccupancy===Rd.Range?E:0,y=u.resumptionOffset,b=m?.startTime===p,A=p+u.cumulativeDuration;let L=g?A+E:p+y;if(h||!f&&p<=0){const R=d;d+=T,u.timelineStart=A;const x=a;a+=E,s.push({event:u,start:A,end:L,playout:{start:x,end:a},integrated:{start:R,end:d}})}else if(p<=n){if(!b){const I=p-l;if(I>gg){const M=l,$=d;d+=I;const V=a;a+=I;const q={previousEvent:e[c-1]||null,nextEvent:u,start:M,end:M+I,playout:{start:V,end:a},integrated:{start:$,end:d}};s.push(q)}else I>0&&m&&(m.cumulativeDuration+=I,s[s.length-1].end=p)}f&&(L=A),u.timelineStart=A;const R=d;d+=T;const x=a;a+=E,s.push({event:u,start:A,end:L,playout:{start:x,end:a},integrated:{start:R,end:d}})}else return;const S=u.resumeTime;f||S>n?l=n:l=S}),l<n){var o;const u=l,c=d,h=n-l;d+=h;const f=a;a+=h,s.push({previousEvent:((o=s[s.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:u+h,playout:{start:f,end:a},integrated:{start:c,end:d}})}this.setDurations(n,a,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let n=0,a=-1;e.forEach((o,l)=>{const d=o.cue.pre,u=o.cue.post,c=d?0:u?r:o.startTime;this.updateAssetDurations(o),a===c?o.cumulativeDuration=n:(n=0,a=c),!u&&o.snapOptions.in&&(o.resumeAnchor=Sr(null,s.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<gg&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=j(o.resumeOffset)?o.resumeOffset:o.duration;n+=f})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>yn?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${a} playlist end ${l}`),!1;const d=Sr(null,o.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const u=a==="audio"?.175:0;return Math.abs(d.start-s)<yn+u||Math.abs(d.end-s)<yn+u?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${a} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,n=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+s;o.startOffset=s,o.timelineStart=l,r||(r=o.duration===null),n||(n=!!o.error);const d=o.error?0:o.duration||0;s+=d}r&&!n?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ai(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class uR{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=zE(s,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,C.ASSET_LIST_LOAD_ERROR,h,s);this.hls.trigger(v.ERROR,f);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const n=this.hls.config,a=n.loader,o=new a(n),l={responseType:"json",url:r.href},d=n.interstitialAssetListLoadPolicy.default,u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(h,f,m,g)=>{const p=h.data,E=p?.ASSETS;if(!Array.isArray(E)){const T=this.assignAssetListError(e,C.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,f,g);this.hls.trigger(v.ERROR,T);return}e.assetListResponse=p,this.hls.trigger(v.ASSET_LIST_LOADED,{event:e,assetListResponse:p,networkDetails:g})},onError:(h,f,m,g)=>{const p=this.assignAssetListError(e,C.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,g,m);this.hls.trigger(v.ERROR,p)},onTimeout:(h,f,m)=>{const g=this.assignAssetListError(e,C.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,m);this.hls.trigger(v.ERROR,g)}};return o.load(l,u,c),this.hls.trigger(v.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,s,r,n,a){return e.error=s,{type:te.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:a,stats:n}}}function vg(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Ro(i,e){return`[${i}] Advancing timeline position to ${e}`}class cR extends si{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&s<o.start||s>=o.end){var l;const f=this.findItemIndex(o);let m=this.schedule.findItemIndexAtTime(s);if(m===-1&&(m=f+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${s} (resolving from ${f} to ${m})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&m>f){const g=this.schedule.findJumpRestrictedIndex(f+1,m);if(g>f){this.setSchedulePosition(g);return}}this.setSchedulePosition(m);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(o)){const f=o.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,f))}return}const u=d.timelineStart,c=d.duration||0;if(a&&s<u||s>=u+c){var h;(h=o.event)!=null&&h.appendInPlace&&(this.clearInterstitial(o.event,o),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}const n=this.playingAsset;if(!n)return;const a=n.timelineStart+(n.duration||0);s>=a&&this.setScheduleToAssetAtTime(s,n)},this.onScheduleUpdate=(s,r)=>{const n=this.schedule;if(!n)return;const a=this.playingItem,o=n.events||[],l=n.items||[],d=n.durations,u=s.map(g=>g.identifier),c=!!(o.length||u.length);(c||r)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(g=>ai(g))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let h=null,f=null;a&&(h=this.updateItem(a,this.timelinePos),this.itemsMatch(a,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(f=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,f)?this.bufferingItem=f:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),s.forEach(g=>{g.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const p=g.assetItem.timelineStart,E=g.timelineOffset-p;if(E)try{g.timelineOffset=p}catch(T){Math.abs(E)>yn&&this.warn(`${T} ("${g.assetId}" ${g.timelineOffset}->${p})`)}}}),c||r){if(this.hls.trigger(v.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:d,removedIds:u}),this.isInterstitial(a)&&u.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(h,a),m&&f!==h&&this.trimInPlace(f,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new uR(e),this.schedule=new dR(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(v.MEDIA_ENDED,this.onMediaEnded,this),e.on(v.ERROR,this.onError,this),e.on(v.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(v.MEDIA_ENDED,this.onMediaEnded,this),e.off(v.ERROR,this.onError,this),e.off(v.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Dt(e,"play",this.onPlay),Dt(e,"pause",this.onPause),Dt(e,"seeking",this.onSeeking),Dt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Lt(s,"seeking",this.onSeeking),Lt(s,"timeupdate",this.onTimeupdate),Lt(s,"play",this.onPlay),Lt(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const n=this.findItemIndex(s);this.setSchedulePosition(n)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const n=this.getBufferingPlayer();n&&(this.log(`Removing schedule state for detachedData and ${n}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,n.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=c=>c&&e.getAssetPlayer(c.identifier),r=(c,h,f,m,g)=>{if(c){let p=c[h].start;const E=c.event;if(E){if(h==="playout"||E.timelineOccupancy!==Rd.Point){const T=s(f);T?.interstitial===E&&(p+=T.assetItem.startOffset+T[g])}}else{const T=m==="bufferedPos"?a():e[m];p+=T-c.start}return p}return 0},n=(c,h)=>{var f;if(c!==0&&h!=="primary"&&(f=e.schedule)!=null&&f.length){var m;const g=e.schedule.findItemIndexAtTime(c),p=(m=e.schedule.items)==null?void 0:m[g];if(p){const E=p[h].start-p.start;return c+E}}return c},a=()=>{const c=e.bufferedPos;return c===Number.MAX_VALUE?o("primary"):Math.max(c,0)},o=c=>{var h,f;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((f=e.schedule)==null?void 0:f.durations[c])||0},l=(c,h)=>{var f,m;const g=e.effectivePlayingItem;if(g!=null&&(f=g.event)!=null&&f.restrictions.skip||!e.schedule)return;e.log(`seek to ${c} "${h}"`);const p=e.effectivePlayingItem,E=e.schedule.findItemIndexAtTime(c,h),T=(m=e.schedule.items)==null?void 0:m[E],y=e.getBufferingPlayer(),b=y?.interstitial,A=b?.appendInPlace,L=p&&e.itemsMatch(p,T);if(p&&(A||L)){const S=s(e.playingAsset),R=S?.media||e.primaryMedia;if(R){const x=h==="primary"?R.currentTime:r(p,h,e.playingAsset,"timelinePos","currentTime"),I=c-x,M=(A?x:R.currentTime)+I;if(M>=0&&(!S||A||M<=S.duration)){R.currentTime=M;return}}}if(T){let S=c;if(h!=="primary"){const x=T[h].start,I=c-x;S=T.start+I}const R=!e.isInterstitial(T);if((!e.isInterstitial(p)||p.event.appendInPlace)&&(R||T.event.appendInPlace)){const x=e.media||(A?y?.media:null);x&&(x.currentTime=S)}else if(p){const x=e.findItemIndex(p);if(E>x){const M=e.schedule.findJumpRestrictedIndex(x+1,E);if(M>x){e.setSchedulePosition(M);return}}let I=0;if(R)e.timelinePos=S,e.checkBuffer();else{const M=T.event.assetList,$=c-(T[h]||T).start;for(let V=M.length;V--;){const q=M[V];if(q.duration&&$>=q.startOffset&&$<q.startOffset+q.duration){I=V;break}}}e.setSchedulePosition(E,I)}}},d=()=>{const c=e.effectivePlayingItem;if(e.isInterstitial(c))return c;const h=t();return e.isInterstitial(h)?h:null},u={get bufferedEnd(){const c=t(),h=e.bufferingItem;if(h&&h===c){var f;return r(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((f=e.bufferingAsset)==null?void 0:f.startOffset)||0}return 0},get currentTime(){const c=d(),h=e.effectivePlayingItem;return h&&h===c?r(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(c){const h=d(),f=e.effectivePlayingItem;f&&f===h&&l(c+f.playout.start,"playout")},get duration(){const c=d();return c?c.playout.end-c.playout.start:0},get assetPlayers(){var c;const h=(c=d())==null?void 0:c.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var c;const h=(c=d())==null?void 0:c.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var c;return((c=e.schedule)==null||(c=c.events)==null?void 0:c.slice(0))||[]},get schedule(){var c;return((c=e.schedule)==null||(c=c.items)==null?void 0:c.slice(0))||[]},get interstitialPlayer(){return d()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const c=t();return e.findItemIndex(c)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const c=e.effectivePlayingItem;return e.findItemIndex(c)},primary:{get bufferedEnd(){return a()},get currentTime(){const c=e.timelinePos;return c>0?c:0},set currentTime(c){l(c,"primary")},get duration(){return o("primary")},get seekableStart(){var c;return((c=e.primaryDetails)==null?void 0:c.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(c){l(c,"integrated")},get duration(){return o("integrated")},get seekableStart(){var c;return n(((c=e.primaryDetails)==null?void 0:c.fragmentStart)||0,"integrated")}},skip:()=>{const c=e.effectivePlayingItem,h=c?.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(c);if(h.appendInPlace){const m=c.playout.start+c.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const n=(t=r)==null?void 0:t.currentTime;if(!(n===void 0||!j(n)))return n}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Me(n)}`),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let n=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let u;if(a.media)l&&(n=a.transferMedia(),this.detachedData=n),u="Primary";else if(d){const m=this.getBufferingPlayer();m?(n=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!n){if(d)n=this.detachedData,this.log(`using detachedData: MediaSource ${Me(n)}`);else if(!this.detachedData||a.media===t){const m=this.playerQueue;m.length>1&&m.forEach(g=>{if(o&&g.interstitial.appendInPlace!==l){const p=g.interstitial;this.clearInterstitial(g.interstitial,null),p.appendInPlace=!1,p.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${p}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const c=n&&"mediaSource"in n&&((r=n.mediaSource)==null?void 0:r.readyState)!=="closed",h=c&&n?n:t;this.log(`${c?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(h===n&&f){const m=o&&e.assetId===f.assetIdAtEnd;h.overrides={duration:f.duration,endOfStream:!o||m,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const n=this.hls.startPosition;if(this.log(Ro("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(n>=0||!this.primaryLive){const a=this.timelinePos=n>0?n:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(r&&!this.playingItem){const n=e.findItemIndex(r);this.setSchedulePosition(n)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),n=Yu(s,r);if(!s.isAssetPastPlayoutLimit(n))this.bufferedToEvent(e,n);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,s){const r=Yu(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const a=t+1,o=n.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Ro("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const n=e.assetList[r];n&&this.advanceInPlace(n.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,n=s.getEvent(r);if(n){const a=s.findEventIndex(r),o=s.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,a,o-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const n=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${n&&ai(n)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const u=a.event,c=this.playingAsset,h=c?.identifier,f=h?this.getAssetPlayer(h):null;if(f&&h&&(!this.eventItemsMatch(a,n)||t!==void 0&&h!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(c);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${Gr(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(v.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:m,event:u,schedule:r.slice(0),scheduleIndex:e,player:f}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(h,n),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(a,n)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ai(a)}`),u.hasPlayed=!0,this.hls.trigger(v.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){var d;this.updateSchedule();const m=(d=this.schedule)==null?void 0:d.items;if(n&&m){const g=this.findItemIndex(n);this.advanceSchedule(g,m,t,a,o)}return}}this.advanceSchedule(e,r,t,a,o)}advanceSchedule(e,t,s,r,n){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(u=>{const c=u.interstitial,h=a.findEventIndex(c.identifier);(h<e||h>e+1)&&this.clearInterstitial(c,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;if(s===void 0){s=a.findAssetIndex(u,this.timelinePos);const m=Yu(u,s-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(u,e,s);return}s=m}const c=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let h=this.preloadAssets(u,s);if(this.eventItemsMatch(o,c||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${ai(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(v.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=u.assetList[s];if(!f){this.advanceAfterAssetEnded(u,e,s||0);return}if(h||(h=this.getAssetPlayer(f.identifier)),h===null||h.destroyed){const m=u.assetList.length;this.warn(`asset ${s+1}/${m} player destroyed ${u}`),h=this.createAssetPlayer(u,f,s),h.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(h,s,t,e,l),this.shouldPlay&&vg(h.media)}else o?(this.resumePrimary(o,e,r),this.shouldPlay&&vg(this.hls.media)):n&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ai(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Ro("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!s)return;const a=(n=this.schedule)==null?void 0:n.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ai(e)}`),this.hls.trigger(v.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:le.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Ro("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(v.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(v.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=Le(Le({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Le(Le({},this.altSelection),{},{audio:s});return}const n=Le(Le({},r),{},{audio:s});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Le(Le({},this.altSelection),{},{subtitles:s});return}const n=Le(Le({},r),{},{subtitles:s});this.mediaSelection=n}onAudioTrackSwitching(e,t){const s=Lp(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Lp(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const n=t[r];if(n.cue.post){var s;const a=this.schedule.findEventIndex(n.identifier),o=(s=this.schedule.items)==null?void 0:s[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const n=this.findItemIndex(e,t);return r[n]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((n,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(n.identifier,null)});const s=e.end+.25,r=le.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${ai(e)} (was ${ai(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=le.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const u=this.findItemIndex(n),c=Math.min(u+1,t.length-1),h=t[c];if((l===-1&&n&&e>=n.end||(d=h.event)!=null&&d.appendInPlace&&e+.01>=h.start)&&(l=c),this.isInterstitial(n)){const f=n.event;if(c-o>1&&f.appendInPlace===!1||f.assetList.length===0&&f.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>o)this.bufferedToItem(h);else{const f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else s&&a&&!this.itemsMatch(a,n)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const n=this.getAssetPlayer(r.identifier);return!(n!=null&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:n}=s;if(!r||!n)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ai(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,c)=>{const h=this.getAssetPlayer(u.identifier);h&&(c===d&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(v.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,n=s.cue.once;if(r||!n){const a=this.preloadAssets(s,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,n=r===0&&!e.assetListLoader,a=e.cue.once;if(n){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let d,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const h=u-l;h>0&&(d=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${d?` live-start: ${u} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const c=this.assetListLoader.loadAssetList(e,d);c&&(e.assetListLoader=c)}else if(!a&&r){for(let d=t;d<r;d++){const u=e.assetList[d],c=this.getAssetPlayerQueueIndex(u.identifier);(c===-1||this.playerQueue[c].destroyed)&&!u.error&&this.createAssetPlayer(e,u,d)}const l=e.assetList[t];if(l){const d=this.getAssetPlayer(l.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,n,a){const o={parentIdentifier:e.identifier,identifier:nR(e,a,t),duration:n,startOffset:s,timelineStart:r,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,s){const r=this.hls,n=r.userConfig;let a=n.videoPreference;const o=r.loadLevelObj||r.levels[r.currentLevel];(a||o)&&(a=De({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=r.audioTracks[r.audioTrack],d=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const b=this.timelinePos-t.timelineStart;if(b>1){const A=t.duration;A&&b<A&&(u=b)}}const c=t.identifier,h=Le(Le({},n),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:c,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||n.audioPreference,subtitlePreference:d||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=De({},f,{contentId:xa(t.uri)})),this.getAssetPlayer(c)&&this.warn(`Duplicate date range identifier ${e} and asset ${c}`);const m=new lR(this.HlsPlayerClass,h,e,t);this.playerQueue.push(m),e.assetList[s]=t;let g=!0;const p=b=>{if(b.live){var A;const R=new Error(`Interstitials MUST be VOD assets ${e}`),x={fatal:!0,type:te.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:R},I=((A=this.schedule)==null?void 0:A.findEventIndex(e.identifier))||-1;this.handleAssetItemError(x,e,I,s,R.message);return}const L=b.edge-b.fragmentStart,S=t.duration;(g||S===null||L>S)&&(g=!1,this.log(`Interstitial asset "${c}" duration change ${S} > ${L}`),t.duration=L,this.updateSchedule())};m.on(v.LEVEL_UPDATED,(b,{details:A})=>p(A)),m.on(v.LEVEL_PTS_UPDATED,(b,{details:A})=>p(A)),m.on(v.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const E=(b,A)=>{const L=this.getAssetPlayer(c);if(L&&A.tracks){L.off(v.BUFFER_CODECS,E),L.tracks=A.tracks;const S=this.primaryMedia;this.bufferingAsset===L.assetItem&&S&&!L.media&&this.bufferAssetPlayer(L,S)}};m.on(v.BUFFER_CODECS,E);const T=()=>{var b;const A=this.getAssetPlayer(c);if(this.log(`buffered to end of asset ${A}`),!A||!this.schedule)return;const L=this.schedule.findEventIndex(e.identifier),S=(b=this.schedule.items)==null?void 0:b[L];this.isInterstitial(S)&&this.advanceAssetBuffering(S,t)};m.on(v.BUFFERED_TO_END,T);const y=b=>()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,b)};return m.once(v.MEDIA_ENDED,y(s)),m.once(v.PLAYOUT_LIMIT_REACHED,y(1/0)),m.on(v.ERROR,(b,A)=>{if(!this.schedule)return;const L=this.getAssetPlayer(c);if(A.details===C.BUFFER_STALLED_ERROR){if(L!=null&&L.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${A.error} ${e}`)}),m.on(v.DESTROYING,()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;const A=new Error(`Asset player destroyed unexpectedly ${c}`),L={fatal:!0,type:te.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:A};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),s,A.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Gr(t)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&ai(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,n){const{interstitial:a,assetItem:o,assetId:l}=e,d=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,s[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${Gr(o)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:n,assetItem:a}=e,o=this.schedule.findEventIndex(n.identifier),l=(s=this.schedule.items)==null?void 0:s[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const d=this.getBufferingPlayer();if(d===e)return;const u=n.appendInPlace;if(u&&d?.interstitial.appendInPlace===!1)return;const c=d?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(c&&!Cv(c,e.tracks)){const h=new Error(`Asset ${Gr(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(c)}')`),f={fatal:!0,type:te.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},m=n.findAssetIndex(a);this.handleAssetItemError(f,n,o,m,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,n=t.findAssetIndex(e,r),a=e.assetList[n];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||r-a.timelineStart,d=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+d} in ${o} ${e} (media.currentTime: ${r})`),l&&(d/s.playbackRate<.5||o.bufferedInPlaceToEnd(s))&&o.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,n)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,n){if(e.details===C.BUFFER_STALLED_ERROR)return;const a=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Gr(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",l=this.getAssetPlayerQueueIndex(o),d=this.playerQueue[l]||null,u=this.schedule.items,c=De({},e,{fatal:!1,errorAction:gn(!0),asset:a,assetListIndex:r,event:t,schedule:u,scheduleIndex:s,player:d});if(this.hls.trigger(v.INTERSTITIAL_ASSET_ERROR,c),!e.fatal)return;const h=this.playingAsset,f=this.bufferingAsset,m=new Error(n);if(a&&(this.clearAssetPlayer(o,null),a.error=m),!t.assetList.some(g=>!g.error))t.error=m;else for(let g=r;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===o?this.advanceAfterAssetEnded(t,s,r):f&&f.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${ai(s)} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const n=this.updateItem(s,r);if(this.itemsMatch(s,n)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var s,r;const n=t.event,a=n.identifier,o=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(a)))return;const l=n.timelineStart,d=n.duration;let u=0;o.forEach((g,p)=>{const E=parseFloat(g.DURATION);this.createAsset(n,p,u,l+u,E,g.URI),u+=E}),n.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${d}) ${n}`);const c=this.waitingItem,h=c?.event.identifier===a;this.updateSchedule();const f=(r=this.bufferingItem)==null?void 0:r.event;if(h){var m;const g=this.schedule.findEventIndex(a),p=(m=this.schedule.items)==null?void 0:m[g];if(p){if(!this.playingItem&&this.timelinePos>p.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){n.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${n}`),this.updateSchedule(!0),this.primaryFallback(n);return}this.setBufferingItem(p)}this.setSchedulePosition(g)}else if(f?.identifier===a){const g=n.assetList[0];if(g){const p=this.getAssetPlayer(g.identifier);if(f.appendInPlace){const E=this.primaryMedia;p&&E&&this.bufferAssetPlayer(p,E)}else p&&p.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case C.ASSET_LIST_PARSING_ERROR:case C.ASSET_LIST_LOAD_ERROR:case C.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case C.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Eg=500;class hR extends xf{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Z.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=P.IDLE,this.setInterval(Eg),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||(it(s)&&(this.fragPrevious=s),this.state=P.IDLE),!r)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a;const o=s.start;for(let d=0;d<n.length;d++)if(o>=n[d].start&&o<=n[d].end){a=n[d];break}const l=s.start+s.duration;a?a.end=l:(a={start:o,end:l},n.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const n=r-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=n){a.shift();continue}else if(a[o].start<n)a[o].start=n;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(s,n,Z.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===Z.SUBTITLE&&(t.details===C.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==P.STOPPED&&(this.state=P.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&PE(this.levels,t)){this.levels=t.map(s=>new Ka(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new Ka(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Z.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==P.STOPPED&&this.setInterval(Eg)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:n}=this,{details:a,id:o}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=n[o];if(o>=n.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(a.live||(s=l.details)!=null&&s.live){if(a.deltaUpdateFailed)return;const c=this.mainDetails;if(!c){this.startFragRequested=!1;return}const h=c.fragments[0];if(!l.details)a.hasProgramDateTime&&c.hasProgramDateTime?(Id(a,c),d=a.fragmentStart):h&&(d=h.start,Oc(a,d));else{var u;d=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),d===0&&h&&(d=h.start,Oc(a,d))}c&&!this.startFragRequested&&this.setStartPosition(c,d)}l.details=a,this.levelLastLoaded=l,o===r&&(this.hls.trigger(v.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===P.IDLE&&(Sr(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&vn(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,Lf(r.method)).catch(o=>{throw n.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();n.trigger(v.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=P.IDLE})}}doTick(){if(!this.media){this.state=P.IDLE;return}if(this.state===P.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,n=this.getLoadPosition(),a=le.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,r.maxBufferHole),{end:o,len:l}=a,d=s.details,u=this.hls.maxBufferLength+d.levelTargetDuration;if(l>u)return;const c=d.fragments,h=c.length,f=d.edge;let m=null;const g=this.fragPrevious;if(o<f){const T=r.maxFragLookUpTolerance,y=o>f-T?0:T;m=Sr(g,c,Math.max(c[0].start,o),y),!m&&g&&g.start<c[0].start&&(m=c[0])}else m=c[h-1];if(m=this.filterReplacedPrimary(m,s.details),!m)return;const p=m.sn-d.startSN,E=c[p-1];if(E&&E.cc===m.cc&&this.fragmentTracker.getState(E)===dt.NOT_LOADED&&(m=E),this.fragmentTracker.getState(m)===dt.NOT_LOADED){const T=this.mapToInitFragWhenRequired(m);T&&this.loadFragment(T,s,o)}}}loadFragment(e,t,s){it(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new fR(this.tracksBuffered[this.currentTrackId]||[])}}class fR{constructor(e){this.buffered=void 0;const t=(s,r,n)=>{if(r=r>>>0,r>n-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${n})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const mR={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},QE=i=>String.fromCharCode(mR[i]||i),ci=15,Ji=100,pR={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},gR={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vR={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ER={25:2,26:4,29:6,30:8,31:10,27:13,28:15},yR=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class TR{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Re.log(`${this.time} [${e}] ${s}`)}}}const js=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class XE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class bR{constructor(){this.uchar=" ",this.penState=new XE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class _R{constructor(e){this.chars=[],this.pos=0,this.currPenState=new XE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ji;t++)this.chars.push(new bR);this.logger=e}equals(e){for(let t=0;t<Ji;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ji;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ji;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ji&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ji)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=QE(e);if(this.pos>=Ji){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ji;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Ji;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class ju{constructor(e){this.rows=[],this.currRow=ci-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ci;t++)this.rows.push(new _R(e));this.logger=e}reset(){for(let e=0;e<ci;e++)this.rows[e].clear();this.currRow=ci-1}equals(e){let t=!0;for(let s=0;s<ci;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<ci;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ci;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Me(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<ci;o++)this.rows[o].clear();const n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[n].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(a.rows[n+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,a=Math.max(n-1,0);s.setCursor(e.indent),e.color=s.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Me(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let n=0;n<ci;n++){const a=this.rows[n].getTextString();a&&(r=n+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class yg{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ju(s),this.nonDisplayedMemory=new ju(s),this.lastOutputScreen=new ju(s),this.currRollUpRow=this.displayedMemory.rows[ci-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ci-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+Me(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Tg{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=SR(),this.logger=void 0;const r=this.logger=new TR;this.channels=[null,new yg(e,t,r),new yg(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,n=t[s+1]&127;let a=!1,o=null;if(r===0&&n===0)continue;this.logger.log(3,()=>"["+js([t[s],t[s+1]])+"] -> ("+js([r,n])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(AR(r,n,l)){xo(null,null,l),this.logger.log(3,()=>"Repeated command ("+js([r,n])+") is dropped");continue}xo(r,n,this.cmdHistory),a=this.parseCmd(r,n),a||(a=this.parseMidrow(r,n)),a||(a=this.parsePAC(r,n)),a||(a=this.parseBackgroundAttributes(r,n))}else xo(null,null,l);if(!a&&(o=this.parseChars(r,n),o)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+js([r,n])+" orig: "+js([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+js([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(e===16||e===24)&&t>=64&&t<=95;if(!(r||n))return!1;const a=e<=23?1:2;t>=64&&t<=95?s=a===1?pR[e]:vR[e]:s=a===1?gR[e]:ER[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(s,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,n=null;if(e>=25?(s=2,n=e-8):(s=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+QE(a)+"' in channel "+s),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+js(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let n;const a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=yR[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}xo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function xo(i,e,t){t.a=i,t.b=e}function AR(i,e,t){return t.a===i&&t.b===e}function SR(){return{a:null,b:null}}var Bf=(function(){if(Sd!=null&&Sd.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const d=l.toLowerCase();return~o.indexOf(d)?d:!1}function s(o){return t(i,o)}function r(o){return t(e,o)}function n(o,...l){let d=1;for(;d<arguments.length;d++){const u=arguments[d];for(const c in u)o[c]=u[c]}return o}function a(o,l,d){const u=this,c={enumerable:!0};u.hasBeenReset=!1;let h="",f=!1,m=o,g=l,p=d,E=null,T="",y=!0,b="auto",A="start",L=50,S="middle",R=50,x="middle";Object.defineProperty(u,"id",n({},c,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(u,"pauseOnExit",n({},c,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(u,"startTime",n({},c,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",n({},c,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",n({},c,{get:function(){return p},set:function(I){p=""+I,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",n({},c,{get:function(){return E},set:function(I){E=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",n({},c,{get:function(){return T},set:function(I){const M=s(I);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",n({},c,{get:function(){return y},set:function(I){y=!!I,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",n({},c,{get:function(){return b},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",n({},c,{get:function(){return A},set:function(I){const M=r(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",n({},c,{get:function(){return L},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");L=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",n({},c,{get:function(){return S},set:function(I){const M=r(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");S=M,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",n({},c,{get:function(){return R},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");R=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",n({},c,{get:function(){return x},set:function(I){const M=r(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");x=M,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class IR{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ZE(i){function e(s,r,n,a){return(s|0)*3600+(r|0)*60+(n|0)+parseFloat(a||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class LR{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function JE(i,e,t,s){const r=s?i.split(s):[i];for(const n in r){if(typeof r[n]!="string")continue;const a=r[n].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Kc=new Bf(0,0,""),ko=Kc.align==="middle"?"middle":"center";function RR(i,e,t){const s=i;function r(){const o=ZE(i);if(o===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),o}function n(o,l){const d=new LR;JE(o,function(h,f){let m;switch(h){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===f){d.set(h,t[g].region);break}break;case"vertical":d.alt(h,f,["rl","lr"]);break;case"line":m=f.split(","),d.integer(h,m[0]),d.percent(h,m[0])&&d.set("snapToLines",!1),d.alt(h,m[0],["auto"]),m.length===2&&d.alt("lineAlign",m[1],["start",ko,"end"]);break;case"position":m=f.split(","),d.percent(h,m[0]),m.length===2&&d.alt("positionAlign",m[1],["start",ko,"end","line-left","line-right","auto"]);break;case"size":d.percent(h,f);break;case"align":d.alt(h,f,["start",ko,"end","left","right"]);break}},/:/,/\s/),l.region=d.get("region",null),l.vertical=d.get("vertical","");let u=d.get("line","auto");u==="auto"&&Kc.line===-1&&(u=-1),l.line=u,l.lineAlign=d.get("lineAlign","start"),l.snapToLines=d.get("snapToLines",!0),l.size=d.get("size",100),l.align=d.get("align",ko);let c=d.get("position","auto");c==="auto"&&Kc.position===50&&(c=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=c}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),a(),e.endTime=r(),a(),n(i,e)}function ey(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class xR{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new IR,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let n=t.buffer,a=0;for(n=ey(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;const o=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),o}function r(n){JE(n,function(a,o){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=s();const o=n.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=s(),t.state){case"HEADER":/:/.test(n)?r(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Bf(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{RR(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=n.indexOf("-->")!==-1;if(!n||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const kR=/\r\n|\n\r|\n|\r/g,zu=function(e,t,s=0){return e.slice(s,s+t.length)===t},DR=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!j(t)||!j(s)||!j(r)||!j(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=3600*1e3*n,t};function Hf(i,e,t){return xa(i.toString())+xa(e.toString())+xa(t)}const CR=function(e,t,s){let r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC]}e.presentationOffset=s};function wR(i,e,t,s,r,n,a){const o=new xR,l=Wt(new Uint8Array(i)).trim().replace(kR,`
`).split(`
`),d=[],u=e?$I(e.baseTime,e.timescale):0;let c="00:00.000",h=0,f=0,m,g=!0;o.oncue=function(p){const E=t[s];let T=t.ccOffset;const y=(h-u)/9e4;if(E!=null&&E.new&&(f!==void 0?T=t.ccOffset=E.start:CR(t,s,y)),y){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}T=y-t.presentationOffset}const b=p.endTime-p.startTime,A=Gt((p.startTime+T-f)*9e4,r*9e4)/9e4;p.startTime=Math.max(A,0),p.endTime=Math.max(A+b,0);const L=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(L)),p.id||(p.id=Hf(p.startTime,p.endTime,L)),p.endTime>0&&d.push(p)},o.onparsingerror=function(p){m=p},o.onflush=function(){if(m){a(m);return}n(d)},l.forEach(p=>{if(g)if(zu(p,"X-TIMESTAMP-MAP=")){g=!1,p.slice(16).split(",").forEach(E=>{zu(E,"LOCAL:")?c=E.slice(6):zu(E,"MPEGTS:")&&(h=parseInt(E.slice(7)))});try{f=DR(c)/1e3}catch(E){m=E}return}else p===""&&(g=!1);o.parse(p+`
`)}),o.flush()}const Qu="stpp.ttml.im1t",ty=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,iy=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,MR={left:"start",center:"center",right:"end",start:"start",end:"end"};function bg(i,e,t,s){const r=he(new Uint8Array(i),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const n=r.map(o=>Wt(o)),a=UI(e.baseTime,1,e.timescale);try{n.forEach(o=>t(PR(o,a)))}catch(o){s(o)}}function PR(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((c,h)=>(c[h]=r.getAttribute(`ttp:${h}`)||n[h],c),{}),o=r.getAttribute("xml:space")!=="preserve",l=_g(Xu(r,"styling","style")),d=_g(Xu(r,"layout","region")),u=Xu(r,"body","[begin]");return[].map.call(u,c=>{const h=sy(c,o);if(!h||!c.hasAttribute("begin"))return null;const f=Ju(c.getAttribute("begin"),a),m=Ju(c.getAttribute("dur"),a);let g=Ju(c.getAttribute("end"),a);if(f===null)throw Ag(c);if(g===null){if(m===null)throw Ag(c);g=f+m}const p=new Bf(f-e,g-e,h);p.id=Hf(p.startTime,p.endTime,p.text);const E=d[c.getAttribute("region")],T=l[c.getAttribute("style")],y=OR(E,T,l),{textAlign:b}=y;if(b){const A=MR[b];A&&(p.lineAlign=A),p.align=b}return De(p,y),p}).filter(c=>c!==null)}function Xu(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function _g(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function sy(i,e){return[].slice.call(i.childNodes).reduce((t,s,r)=>{var n;return s.nodeName==="br"&&r?t+`
`:(n=s.childNodes)!=null&&n.length?sy(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function OR(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),n.reduce((o,l)=>{const d=Zu(e,s,l)||Zu(i,s,l)||Zu(r,s,l);return d&&(o[l]=d),o},{})}function Zu(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function Ag(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Ju(i,e){if(!i)return null;let t=ZE(i);return t===null&&(ty.test(i)?t=NR(i,e):iy.test(i)&&(t=UR(i,e))),t}function NR(i,e){const t=ty.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function UR(i,e){const t=iy.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Do{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class $R{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ig(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Do(this,"textTrack1"),t=new Do(this,"textTrack2"),s=new Do(this,"textTrack3"),r=new Do(this,"textTrack4");this.cea608Parser1=new Tg(1,e,t),this.cea608Parser2=new Tg(3,s,r)}addCues(e,t,s,r,n){let a=!1;for(let o=n.length;o--;){const l=n[o],d=FR(l[0],l[1],t,s);if(d>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),a=!0,d/(s-t)>.5))return}if(a||n.push([t,s]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,s,r)}else{const o=this.Cues.newCue(null,t,s,r);this.hls.trigger(v.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:n,trackId:a}){const{unparsedVttFrags:o}=this;s===Z.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:n,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(v.FRAG_LOADED,l):this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const n=s.textTracks[r];if(Sg(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:n,languageCode:a}=t[e],o=this.getExistingTrack(n,a);if(o)s[e]=o,un(s[e]),YE(s[e],r);else{const l=this.createTextTrack("captions",n,a);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(n=>{un(r[n]),delete r[n]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ig(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)un(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(n=>n.textCodec===Qu);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(PE(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const a=this.media,o=a?sl(a.textTracks):null;if(this.tracks.forEach((l,d)=>{let u;if(o){let c=null;for(let h=0;h<o.length;h++)if(o[h]&&Sg(o[h],l)){c=o[h],o[h]=null;break}c&&(u=c)}if(u)un(u);else{const c=ry(l);u=this.createTextTrack(c,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),o!=null&&o.length){const l=o.filter(d=>d!==null).map(d=>d.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const n=`textTrack${r[1]}`,a=this.captionsProperties[n];a&&(a.label=s.name,s.lang&&(a.languageCode=s.lang),a.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Z.MAIN){var s,r;const{cea608Parser1:n,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:d}=t.frag,u=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;n&&a&&(d!==o+1||d===o&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(n.reset(),a.reset()),this.lastCc=l,this.lastSn=d,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===Z.SUBTITLE)if(r.byteLength){const n=s.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){const o=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),o&&o.textCodec===Qu?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;bg(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:n,unparsedVttFrags:a}=this,o=n.length-1;if(!n[s.cc]&&o===-1){a.push(e);return}const l=this.hls,d=(t=s.initSegment)!=null&&t.data?ii(s.initSegment.data,new Uint8Array(r)).buffer:r;wR(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,u=>{this._appendCues(u,s.level),l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},u=>{const c=u.message==="Missing initPTS for VTT MPEGTS";c?a.push(e):this._fallbackToIMSC1(s,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(c&&o>s.cc)&&l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:u})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||bg(t,this.initPTS[e.cc],()=>{s.textCodec=Qu,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(n=>jE(r,n))}else{const r=this.tracks[t];if(!r)return;const n=r.default?"default":"subtitles"+t;s.trigger(v.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Z.SUBTITLE&&this.onFragLoaded(v.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===Z.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let n=0;n<r.length;n++){const a=r[n].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(r[n].pts,o[0]),this.cea608Parser2.addData(r[n].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:n}){const{media:a}=this;if(!(!a||a.currentTime<s)){if(!n||n==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Gc(o[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Gc(o[l],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let n=0;n<s;n++){const a=e[r++],o=127&e[r++],l=127&e[r++];if(o===0&&l===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}}function ry(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Sg(i,e){return!!i&&i.kind===ry(e)&&$c(e,i)}function FR(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function Ig(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const BR=/\s/,HR={newCue(i,e,t,s){const r=[];let n,a,o,l,d;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<s.rows.length;h++)if(n=s.rows[h],o=!0,l=0,d="",!n.isEmpty()){var c;for(let g=0;g<n.chars.length;g++)BR.test(n.chars[g].uchar)&&o?l++:(d+=n.chars[g].uchar,o=!1);n.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=ey(d.trim()),m=Hf(e,t,f);i!=null&&(c=i.cues)!=null&&c.getCueById(m)||(a=new u(e,t,f),a.id=m,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(a))}return i&&r.length&&(r.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),r.forEach(h=>jE(i,h))),r}};function GR(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const KR=/(\d+)-(\d+)\/(\d+)/;class Lg{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||YR,this.controller=new self.AbortController,this.stats=new yf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const n=VR(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&j(l)?l:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(qa(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(c=>{var h;this.response=this.loader=c;const f=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},d-(f-r.loading.start)),!c.ok){const{status:g,statusText:p}=c;throw new jR(p||"fetch, bad network response",g,c)}r.loading.first=f,r.total=qR(c.headers)||r.total;const m=(h=this.callbacks)==null?void 0:h.onProgress;return m&&j(t.highWaterMark)?this.loadProgressively(c,r,e,t.highWaterMark,m):a?c.arrayBuffer():e.responseType==="json"?c.json():c.text()}).then(c=>{var h,f;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=c[o];g&&(r.loaded=r.total=g);const p={url:m.url,data:c,code:m.status},E=(h=this.callbacks)==null?void 0:h.onProgress;E&&!j(t.highWaterMark)&&E(r,e,c,m),(f=this.callbacks)==null||f.onSuccess(p,r,e,m)}).catch(c=>{var h;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const f=c&&c.code||0,m=c?c.message:null;(h=this.callbacks)==null||h.onError({code:f,text:m},e,c?c.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,n){const a=new mE,o=e.body.getReader(),l=()=>o.read().then(d=>{if(d.done)return a.dataLength&&n(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=d.value,c=u.length;return t.loaded+=c,c<r||a.dataLength?(a.push(u),a.dataLength>=r&&n(t,s,a.flush().buffer,e)):n(t,s,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function VR(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(De({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function WR(i){const e=KR.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function qR(i){const e=i.get("Content-Range");if(e){const s=WR(e);if(j(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function YR(i,e){return new self.Request(i.url,e)}class jR extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const zR=/^age:\s*[\d.]+\s*$/im;class ny{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new yf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return n(s,t.url)}).catch(a=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),n(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:s.status,text:a.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=s.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=n&&j(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,n=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,u=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const m=u??t.response;if(m!=null){var a,o;s.loading.end=Math.max(self.performance.now(),s.loading.first);const g=t.responseType==="arraybuffer"?m.byteLength:m.length;s.loaded=s.total=g,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const p=(a=this.callbacks)==null?void 0:a.onProgress;p&&p(s,e,m,t);const E={url:t.responseURL,data:m,code:d};(o=this.callbacks)==null||o.onSuccess(E,s,e,t);return}}const c=n.loadPolicy.errorRetry,h=s.retry,f={url:e.url,data:void 0,code:d};if(_d(c,h,!1,f))this.retry(c);else{var l;Re.error(`${d} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(_d(e,t,!0))this.retry(e);else{var s;Re.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Af(e,s.retry),s.retry++,Re.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&zR.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const QR={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},XR=Le(Le({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:ny,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:d1,bufferController:JI,capLevelController:Uf,errorController:m1,fpsController:eR,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:sE,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:QR},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ZR()),{},{subtitleStreamController:hR,subtitleTrackController:sR,timelineController:$R,audioStreamController:zI,audioTrackController:QI,emeController:En,cmcdController:QL,contentSteeringController:ZL,interstitialsController:cR});function ZR(){return{cueHandler:HR,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function JR(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Vc(i),r=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,d=[];n.forEach(u=>{const c=`${a}Loading${u}`,h=e[c];if(h!==void 0&&l){d.push(c);const f=s[o].default;switch(e[o]={default:f},u){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${o}": ${Me(e[o])}`)}),Le(Le({},s),e)}function Vc(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Vc):Object.keys(i).reduce((e,t)=>(e[t]=Vc(i[t]),e),{}):i}function ex(i,e){const t=i.loader;t!==Lg&&t!==ny?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):GR()&&(i.loader=Lg,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const rl=2,tx=.1,ix=.05,sx=100;class rx extends Zv{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(sx),this.mediaSource=t.mediaSource;const s=this.media=t.media;Lt(s,"playing",this.onMediaPlaying),Lt(s,"waiting",this.onMediaWaiting),Lt(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Dt(s,"playing",this.onMediaPlaying),Dt(s,"waiting",this.onMediaWaiting),Dt(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const n=(s=this.hls)==null?void 0:s.config;if(!n)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,d=!this.seeking&&o,u=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1}));return}if(!le.getBuffered(a).length){this.nudgeRetry=0;return}const c=le.bufferInfo(a,e,0),h=c.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const L=Rg(this.hls.inFlightFragments,e),S=c.len>rl,R=!h||L||h-e>rl&&!f.getPartialFragment(e);if(S||R)return;this.moved=!1}const m=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(c.len>0)&&!h)return;const S=Math.max(h,c.start||0)-e,x=!!(m!=null&&m.live)?m.targetduration*2:rl,I=Co(e,f);if(S>0&&(S<=x||I)){a.paused||this._trySkipBufferHole(I);return}}const g=n.detectStallWithCurrentTimeMs,p=self.performance.now(),E=this.waiting;let T=this.stalled;if(T===null)if(E>0&&p-E<g)T=this.stalled=E;else{this.stalled=p;return}const y=p-T;if(!o&&(y>=g||E)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-(m?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(c),!this.media||!this.hls)return}const A=le.bufferInfo(a,e,n.maxBufferHole);this._tryFixBufferStall(A,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(v.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const n=le.bufferedInfo(le.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const a=le.timeRangesToArray(r),o=le.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=le.bufferedInfo(a,e,0).bufferedIndex,d=a[o].end,u=a[o+1].start;if((l===-1||l>o)&&u-d<1&&e-d<2){const c=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${u} buffered index: ${l}`);this.warn(c.message),this.media.currentTime+=1e-6;let h=Co(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const f=le.bufferInfo(this.media,e,0);this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:c,reason:c.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,s){var r,n;const{fragmentTracker:a,media:o}=this,l=(r=this.hls)==null?void 0:r.config;if(!o||!a||!l)return;const d=(n=this.hls)==null?void 0:n.latestLevelDetails,u=Co(s,a);if((u||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const c=e.buffered,h=this.adjacentTraversal(e,s);(c&&c.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const n=s.getFragAtPos(t,Z.MAIN),a=s.getFragAtPos(r,Z.MAIN);if(n&&a)return a.sn-n.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:n}=this;if(!r&&n!==null&&s&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Me(e)})`);this.warn(a.message),t.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,n=(t=this.hls)==null?void 0:t.config;if(!r||!s||!n)return 0;const a=r.currentTime,o=le.bufferInfo(r,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const u=o.len<=n.maxBufferHole,c=o.len>0&&o.len<1&&r.readyState<3,h=l-a;if(h>0&&(u||c)){if(h>n.maxBufferHole){let m=!1;if(a===0){const g=s.getAppendedFrag(0,Z.MAIN);g&&l<g.end&&(m=!0)}if(!m&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||Rg(this.hls.inFlightFragments,l))return 0;let p=!1,E=e.end;for(;E<l;){const T=Co(E,s);if(T)E+=T.duration;else{p=!0;break}}if(p)return 0}}const f=Math.max(l+ix,a+tx);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${f}`),this.moved=!0,r.currentTime=f,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${f}`),g={type:te.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?g.part=e:g.frag=e),this.hls.trigger(v.ERROR,g)}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,n=t?.config;if(!s||!n)return 0;const a=s.currentTime;if(this.nudgeRetry++,r<n.nudgeMaxRetry){const o=a+(r+1)*n.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),s.currentTime=o,t.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Rg(i,e){const t=xg(i.main);if(t&&t.start<=e)return t;const s=xg(i.audio);return s&&s.start<=e?s:null}function xg(i){if(!i)return null;switch(i.state){case P.IDLE:case P.STOPPED:case P.ENDED:case P.ERROR:return null}return i.frag}function Co(i,e){return e.getAppendedFrag(i,Z.MAIN)||e.getPartialFragment(i)}const nx=.25;function Wc(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ec(i,e,t,s,r){let n=new i(e,t,"");try{n.value=s,r&&(n.type=r)}catch{n=new i(e,t,Me(r?Le({type:r},s):s))}return n}const wo=(()=>{const i=Wc();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class ax{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(v.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&un(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return YE(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Wc();if(a)for(let o=0;o<n.length;o++){const l=n[o].type;if(l===Vt.emsg&&!s||!r)continue;const d=bE(n[o].data),u=n[o].pts;let c=u+n[o].duration;c>wo&&(c=wo),c-u<=0&&(c=u+nx);for(let f=0;f<d.length;f++){const m=d[f];if(!_E(m)){this.updateId3CueEnds(u,l);const g=ec(a,u,c,m,l);g&&this.id3Track.addCue(g)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let n=r.length;n--;){const a=r[n];a.type===t&&a.startTime<e&&a.endTime===wo&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:n,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(n&&(o||l)){let d;r==="audio"?d=u=>u.type===Vt.audioId3&&l:r==="video"?d=u=>u.type===Vt.emsg&&o:d=u=>u.type===Vt.audioId3&&l||u.type===Vt.emsg&&o,Gc(n,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:n,interstitialsController:a}=this.hls.config;if(!n)return;const o=Wc();if(s&&r&&!a){const{fragmentStart:g,fragmentEnd:p}=e;let E=this.assetCue;E?(E.startTime=g,E.endTime=p):o&&(E=this.assetCue=ec(o,g,p,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),E&&(E.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(E),E.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:d}=e,u=Object.keys(d);let c=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const g=Object.keys(c).filter(p=>!u.includes(p));for(let p=g.length;p--;){var f;const E=g[p],T=(f=c[E])==null?void 0:f.cues;delete c[E],T&&Object.keys(T).forEach(y=>{const b=T[y];if(b){b.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(b)}catch{}}})}}else c=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!j(m?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let g=0;g<u.length;g++){const p=u[g],E=d[p],T=E.startTime,y=c[p],b=y?.cues||{};let A=y?.durationKnown||!1,L=wo;const{duration:S,endDate:R}=E;if(R&&S!==null)L=T+S,A=!0;else if(E.endOnNext&&!A){const I=u.reduce((M,$)=>{if($!==E.id){const V=d[$];if(V.class===E.class&&V.startDate>E.startDate&&(!M||E.startDate<M.startDate))return V}return M},null);I&&(L=I.startTime,A=!0)}const x=Object.keys(E.attr);for(let I=0;I<x.length;I++){const M=x[I];if(!R1(M))continue;const $=b[M];if($)A&&!(y!=null&&y.durationKnown)?$.endTime=L:Math.abs($.startTime-T)>.01&&($.startTime=T,$.endTime=L);else if(o){let V=E.attr[M];x1(M)&&(V=wv(V));const H=ec(o,T,L,{key:M,data:V},Vt.dateRange);H&&(H.id=p,this.id3Track.addCue(H),b[M]=H,a&&(M==="X-ASSET-LIST"||M==="X-ASSET-URL")&&H.addEventListener("enter",this.onEventCueEnter))}}c[p]={cues:b,dateRange:E,durationKnown:A}}}}}class ox{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:a}=this.config;if(!n||a===1||!s.live)return;const o=this.targetLatency;if(o===null)return;const l=r-o,d=Math.min(this.maxLatency,o+s.targetduration);if(l<d&&l>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(c,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let d=o&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||d===0)&&(d=n!==void 0?n:a*r);const u=r;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,n=e-t-this.edgeStalled,a=r-s.totalduration,o=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,n),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===C.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class lx extends Nf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],n={},a={};let o=!1,l=!1,d=!1;t.levels.forEach(u=>{const c=u.attrs;let{audioCodec:h,videoCodec:f}=u;h&&(u.audioCodec=h=Ed(h,s)||void 0),f&&(f=u.videoCodec=VS(f));const{width:m,height:g,unknownCodecs:p}=u,E=p?.length||0;if(o||(o=!!(m&&g)),l||(l=!!f),d||(d=!!h),E||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${c.CODECS}"`);return}const{CODECS:T,"FRAME-RATE":y,"HDCP-LEVEL":b,"PATHWAY-ID":A,RESOLUTION:L,"VIDEO-RANGE":S}=c,x=`${`${A||"."}-`}${u.bitrate}-${L}-${y}-${T}-${S}-${b}`;if(n[x])if(n[x].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const I=a[x]+=1;u.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const M=this.createLevel(u);n[x]=M,r.push(M)}else n[x].addGroupId("audio",c.AUDIO),n[x].addGroupId("text",c.SUBTITLES);else{const I=this.createLevel(u);n[x]=I,a[x]=1,r.push(I)}}),this.filterAndSortMediaOptions(r,t,o,l,d)}createLevel(e){const t=new Ka(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=Vv(r,[])}return t}isAudioSupported(e){return Ha(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ha(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,n){var a;let o=[],l=[],d=e;const u=((a=t.stats)==null?void 0:a.parsing)||{};if((s||r)&&n&&(d=d.filter(({videoCodec:T,videoRange:y,width:b,height:A})=>(!!T||!!(b&&A))&&e1(y))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",y=T;t.levels.length&&(y=`one or more CODECS in variant not supported: ${Me(t.levels.map(A=>A.attrs.CODECS).filter((A,L,S)=>S.indexOf(A)===L))}`,this.warn(y),T+=` (${y})`);const b=new Error(T);this.hls.trigger(v.ERROR,{type:te.MEDIA_ERROR,details:C.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:y})}}),u.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),kg(o)),t.subtitles&&(l=t.subtitles,kg(l));const c=d.slice(0);d.sort((T,y)=>{if(T.attrs["HDCP-LEVEL"]!==y.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(y.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&T.height!==y.height)return T.height-y.height;if(T.frameRate!==y.frameRate)return T.frameRate-y.frameRate;if(T.videoRange!==y.videoRange)return yd.indexOf(T.videoRange)-yd.indexOf(y.videoRange);if(T.videoCodec!==y.videoCodec){const b=Tp(T.videoCodec),A=Tp(y.videoCodec);if(b!==A)return A-b}if(T.uri===y.uri&&T.codecSet!==y.codecSet){const b=vd(T.codecSet),A=vd(y.codecSet);if(b!==A)return A-b}return T.averageBitrate!==y.averageBitrate?T.averageBitrate-y.averageBitrate:0});let h=c[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==c.length)){for(let T=0;T<c.length;T++)if(c[T].pathwayId===d[0].pathwayId){h=c[T];break}}this._levels=d;for(let T=0;T<d.length;T++)if(d[T]===h){var f;this._firstLevel=T;const y=h.bitrate,b=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${y}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const A=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);A>b&&b===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=A)}break}const m=n&&!r,g=this.hls.config,p=!!(g.audioStreamController&&g.audioTrackController),E={levels:d,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:r,altAudio:p&&!m&&o.some(T=>!!T.url)};u.end=performance.now(),this.hls.trigger(v.MANIFEST_PARSED,E)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),c=e<0;if(this.hls.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.LEVEL_SWITCH_ERROR,level:e,fatal:c,error:u,reason:u.message}),c)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,n=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&r&&n===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${s}${n?" with Pathway "+n:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(v.LEVEL_SWITCHING,l);const d=a.details;if(!d||d.live){const u=this.switchParams(a.uri,r?.details,d);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===me.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Z.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(n=>!!s[n]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:n}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${r}`),(o=t.deliveryDirectives)!=null&&o.skip&&(n.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(v.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((n,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(o=>o.level=-1)),!1));cE(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(v.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(v.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function kg(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function ay(){return self.SourceBuffer||self.WebKitSourceBuffer}function oy(){if(!Bs())return!1;const e=ay();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function dx(){if(!oy())return!1;const i=Bs();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Ga(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Ga(e,"audio"))))}function ux(){var i;const e=ay();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const cx=100;class hx extends xf{constructor(e,t,s){super(e,t,s,"stream-controller",Z.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,n=r?r.currentTime:null;if(n===null||!j(n)||(this.log(`Media seeked to ${n.toFixed(3)}`),!this.getBufferedFrag(n)))return;const a=this.getFwdBufferInfoAtPos(r,n,Z.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${n} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(cx),this.level=-1,!this.startFragRequested){let n=r.startLevel;n===-1&&(r.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=r.firstAutoLevel),r.nextLoadLevel=n,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=P.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=P.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case P.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=P.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=P.IDLE;break}break}case P.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===P.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[n]))return;const a=s[n],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(v.BUFFER_EOS,g),this.state=P.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const d=a.details;if(!d||this.state===P.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=P.WAITING_LEVEL,this.startFragRequested=!1;return}const u=o.len,c=this.getMaxBufferLength(a.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,d);if(this.couldBacktrack&&!this.fragPrevious&&f&&it(f)&&this.fragmentTracker.getState(f)!==dt.OK){var m;const p=((m=this.backtrackFragment)!=null?m:f).sn-d.startSN,E=d.fragments[p-1];E&&f.cc===E.cc&&(f=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const p=this.audioOnly&&!this.altAudio?we.AUDIO:we.VIDEO,E=(p===we.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,p,Z.MAIN)}f=this.getNextFragmentLoopLoading(f,d,o,Z.MAIN,c)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===dt.NOT_LOADED||r===dt.PARTIAL?it(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Z.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<n.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*d)+1:s=0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,d=o.duration,u=Math.max(a.end,l+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case P.KEY_LOADING:case P.FRAG_LOADING:case P.FRAG_LOADING_WAITING_RETRY:case P.PARSING:case P.PARSED:this.state=P.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Lt(s,"playing",this.onMediaPlaying),Lt(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Dt(s,"playing",this.onMediaPlaying),Dt(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let n=0;n<t.levels.length;n++){const a=t.levels[n].audioCodec;a&&(s=s||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!ux(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==P.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=P.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:n}=this,a=t.level,o=t.details,l=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const d=t.levelInfo,u=this.fragCurrent;u&&(this.state===P.FRAG_LOADING||this.state===P.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(o.live||(s=d.details)!=null&&s.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,d.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(d.details=o,this.levelLastLoaded=d,n||this.setStartPosition(o,c),this.hls.trigger(v.LEVEL_UPDATED,{details:o,level:a}),this.state===P.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=P.IDLE}n&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=n>=a-t.maxFragLookUpTolerance&&n<=o;if(r!==null&&s.duration>r&&(n<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||n<o-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const c=le.bufferInfo(s,r,0);if(!((d=c.buffered)!=null&&d.length)){s.currentTime=r;return}if(c.start<=n){s.currentTime=r;return}const{nextStart:f}=le.bufferedInfo(c.buffered,n,0);f&&(s.currentTime=f)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const o=a[s.level];if(!o){this.warn(`Level ${s.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=o.videoCodec,u=l.PTSKnown||!l.live,c=(t=s.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new ME(this.hls,Z.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,g=m!==-1,p=new If(s.level,s.sn,s.stats.chunkCount,n.byteLength,m,g),E=this.initPTS[s.cc];f.push(n,c,h,d,s,r,l.totalduration,u,p,E)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio===2;if(Td(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),s.once(v.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(v.AUDIO_TRACK_SWITCHED,t)}),s.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(v.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Td(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,n,a=!1;for(const o in s){const l=s[o];if(l.id==="main"){if(n=o,r=l,o==="video"){const d=s[o];d&&(this.videoBuffer=d.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,n=s.type===Z.MAIN;if(n){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===P.PARSED&&(this.state=P.IDLE);return}const o=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),it(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const a=this.media;a&&(!this._hasEnoughToStart&&le.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=P.ERROR;return}switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.MAIN,t);break;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===P.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===me.LEVEL&&(this.state=P.IDLE);break;case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case C.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=P.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==we.AUDIO||!this.altAudio){const s=(t===we.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,Z.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const n=this.getLevelDetails(),a=le.getBuffered(e),o=a.length?a.start(0):0,l=o-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<d||this.loadingParts&&l<2*(n?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${o}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,n=s?.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=P.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=n.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(v.FRAG_LOADED,s),n.bitrateTest=!1}).catch(s=>{this.state===P.STOPPED||this.state===P.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:o,part:l,level:d}=a,{video:u,text:c,id3:h,initSegment:f}=r,{details:m}=d,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=P.PARSING,f){const p=f.tracks;if(p){const b=o.initSegment||o;if(this.unhandledEncryptionError(f,o))return;this._bufferInitSegment(d,p,b,n),s.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:t,tracks:p})}const E=f.initPTS,T=f.timescale,y=this.initPTS[o.cc];if(j(E)&&(!y||y.baseTime!==E||y.timescale!==T)){const b=f.trackId;this.initPTS[o.cc]={baseTime:E,timescale:T,trackId:b},s.trigger(v.INIT_PTS_FOUND,{frag:o,id:t,initPTS:E,timescale:T,trackId:b})}}if(u&&m){g&&u.type==="audiovideo"&&this.logMuxedErr(o);const p=m.fragments[o.sn-1-m.startSN],E=o.sn===m.startSN,T=!p||o.cc>p.cc;if(r.independent!==!1){const{startPTS:y,endPTS:b,startDTS:A,endDTS:L}=u;if(l)l.elementaryStreams[u.type]={startPTS:y,endPTS:b,startDTS:A,endDTS:L};else if(u.firstKeyFrame&&u.independent&&n.id===1&&!T&&(this.couldBacktrack=!0),u.dropped&&u.independent){const S=this.getMainFwdBufferInfo(),R=(S?S.end:this.getLoadPosition())+this.config.maxBufferHole,x=u.firstKeyFramePTS?u.firstKeyFramePTS:y;if(!E&&R<x-this.config.maxBufferHole&&!T){this.backtrack(o);return}else T&&(o.gap=!0);o.setElementaryStreamInfo(u.type,o.start,b,o.start,L,!0)}else E&&y-(m.appliedTimelineOffset||0)>rl&&(o.gap=!0);o.setElementaryStreamInfo(u.type,y,b,A,L),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,n,E||T)}else if(E||T)o.gap=!0;else{this.backtrack(o);return}}if(g){const{startPTS:p,endPTS:E,startDTS:T,endDTS:y}=g;l&&(l.elementaryStreams[we.AUDIO]={startPTS:p,endPTS:E,startDTS:T,endDTS:y}),o.setElementaryStreamInfo(we.AUDIO,p,E,T,y),this.bufferFragmentData(g,o,l,n)}if(m&&h!=null&&h.samples.length){const p={id:t,frag:o,details:m,samples:h.samples};s.trigger(v.FRAG_PARSING_METADATA,p)}if(m&&c){const p={id:t,frag:o,details:m,samples:c.samples};s.trigger(v.FRAG_PARSING_USERDATA,p)}}logMuxedErr(e){this.warn(`${it(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==P.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:n,video:a,audiovideo:o}=t;if(n){const d=e.audioCodec;let u=Xo(n.codec,d);u==="mp4a"&&(u="mp4a.40.5");const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const h=n.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),d&&d!==u&&this.log(`Swapping manifest audio codec "${d}" for "${u}"`),n.levelCodec=u,n.id=Z.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${u||""}/${d||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Z.MAIN;const d=a.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${a.codec!==d?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(v.BUFFER_CODECS,t),!this.hls)return;l.forEach(d=>{const c=t[d].initSegment;c!=null&&c.byteLength&&this.hls.trigger(v.BUFFER_APPENDING,{type:d,data:c,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Z.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=P.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(le.isBuffered(e,s)?t=this.getAppendedFrag(s):le.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,n=t.level;(!r||t.sn!==r.sn||r.level!==n)&&(this.fragPlaying=t,this.hls.trigger(v.FRAG_CHANGED,{frag:t}),(!r||r.level!==n)&&this.hls.trigger(v.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return j(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(j(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?Sr(null,s.fragments,t):null);if(r){const n=r.programDateTime;if(n!==null){const a=n+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class fx extends si{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=C.KEY_LOAD_ERROR,s,r,n){return new ns({type:te.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,n=t.length;r<n;r++){const a=t[r];if(e.cc<=a.cc&&(!it(e)||!it(a)||e.sn<a.sn)||!s&&r==n-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Jo(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=ia(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,d))}const a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=tc(n);let l=this.keyIdToKeyInfo[o];if((s=l)!=null&&s.decryptdata.key)return n.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:c}=u;return n.key=c.decryptdata.key,{frag:e,keyInfo:c}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${n.keyId?" keyId: "+It(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const a=wS(t.initSegment.data);if(a.length){const o=a[0];o.some(l=>l!==0)&&(this.log(`Using keyId found in init segment ${It(o)}`),e.decryptdata.keyId=o,vr.setKeyIdForUri(e.decryptdata.uri,o))}}const n=this.emeController.loadKey(s);return(e.keyLoadPromise=n.then(a=>(e.mediaKeySessionContext=a,s))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,n=new r(s);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(h,f,m,g)=>{const{frag:p,keyInfo:E}=m,T=tc(E.decryptdata);if(!p.decryptdata||E!==this.keyIdToKeyInfo[T])return o(this.createKeyLoadError(p,C.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));E.decryptdata.key=p.decryptdata.key=new Uint8Array(h.data),p.keyLoader=null,E.loader=null,a({frag:p,keyInfo:E})},onError:(h,f,m,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),m,Le({url:l.url,data:void 0},h)))},onTimeout:(h,f,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,C.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(h,f,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,C.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};n.load(l,u,c)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,n=s.loader;t.keyLoader===n&&(t.keyLoader=null,s.loader=null);const a=tc(s.decryptdata)||r;delete this.keyIdToKeyInfo[a],n&&n.destroy()}}function tc(i){if(i.keyFormat!==Et.FAIRPLAY){const e=i.keyId;if(e)return It(e)}return i.uri}function Dg(i){const{type:e}=i;switch(e){case me.AUDIO_TRACK:return Z.AUDIO;case me.SUBTITLE_TRACK:return Z.SUBTITLE;default:return Z.MAIN}}function ic(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class mx{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,n=s||r,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:me.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:n,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:s,level:r,pathwayId:n,responseType:"text",type:me.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:n,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:me.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:n,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:me.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const s=this.loaders[me.LEVEL];if(s){const r=s.context;r&&!t.levels.some(n=>n===r.levelOrTrack)&&(s.abort(),delete this.loaders[me.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const d=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let n;if(e.type===me.MANIFEST?n=s.manifestLoadPolicy.default:n=De({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),j((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===me.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===me.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===me.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const u=d.partTarget,c=d.targetduration;if(u&&c){const h=Math.max(u*3,c*.8)*1e3;n=De({},n,{maxTimeToFirstByteMs:Math.min(h,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(d,u,c,h)=>{const f=this.getInternalLoader(c);this.resetInternalLoader(c.type);const m=d.data;u.parsing.start=performance.now(),Ki.isMediaPlaylist(m)||c.type!==me.MANIFEST?this.handleTrackOrLevelPlaylist(d,u,c,h||null,f):this.handleMasterPlaylist(d,u,c,h)},onError:(d,u,c,h)=>{this.handleNetworkError(u,c,!1,d,h)},onTimeout:(d,u,c)=>{this.handleNetworkError(u,c,!0,void 0,d)}};r.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const n=this.hls,a=e.data,o=ic(e,s),l=Ki.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,l.playlistParsingError,r,t);return}const{contentSteering:d,levels:u,sessionData:c,sessionKeys:h,startTimeOffset:f,variableList:m}=l;this.variableList=m,u.forEach(T=>{const{unknownCodecs:y}=T;if(y){const{preferManagedMediaSource:b}=this.hls.config;let{audioCodec:A,videoCodec:L}=T;for(let S=y.length;S--;){const R=y[S];Ha(R,"audio",b)?(T.audioCodec=A=A?`${A},${R}`:R,kn.audio[A.substring(0,4)]=2,y.splice(S,1)):Ha(R,"video",b)&&(T.videoCodec=L=L?`${L},${R}`:R,kn.video[L.substring(0,4)]=2,y.splice(S,1))}}});const{AUDIO:g=[],SUBTITLES:p,"CLOSED-CAPTIONS":E}=Ki.parseMasterPlaylistMedia(a,o,l);g.length&&!g.some(y=>!y.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new He({}),bitrate:0,url:""})),n.trigger(v.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:p,captions:E,contentSteering:d,url:o,stats:t,networkDetails:r,sessionData:c,sessionKeys:h,startTimeOffset:f,variableList:m})}handleTrackOrLevelPlaylist(e,t,s,r,n){const a=this.hls,{id:o,level:l,type:d}=s,u=ic(e,s),c=j(l)?l:j(o)?o:0,h=Dg(s),f=Ki.parseLevelPlaylist(e.data,u,c,h,0,this.variableList);if(d===me.MANIFEST){const m={attrs:new He({}),bitrate:0,details:f,name:"",url:u};f.requestScheduled=t.loading.start+lE(f,0),a.trigger(v.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=f,this.handlePlaylistLoaded(f,e,t,s,r,n)}handleManifestParsingError(e,t,s,r,n){this.hls.trigger(v.ERROR,{type:te.NETWORK_ERROR,details:C.MANIFEST_PARSING_ERROR,fatal:t.type===me.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:n})}handleNetworkError(e,t,s=!1,r,n){let a=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===me.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===me.AUDIO_TRACK||e.type===me.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=C.UNKNOWN,d=!1;const u=this.getInternalLoader(e);switch(e.type){case me.MANIFEST:l=s?C.MANIFEST_LOAD_TIMEOUT:C.MANIFEST_LOAD_ERROR,d=!0;break;case me.LEVEL:l=s?C.LEVEL_LOAD_TIMEOUT:C.LEVEL_LOAD_ERROR,d=!1;break;case me.AUDIO_TRACK:l=s?C.AUDIO_TRACK_LOAD_TIMEOUT:C.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case me.SUBTITLE_TRACK:l=s?C.SUBTITLE_TRACK_LOAD_TIMEOUT:C.SUBTITLE_LOAD_ERROR,d=!1;break}u&&this.resetInternalLoader(e.type);const c={type:te.NETWORK_ERROR,details:l,fatal:d,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:n};if(r){const h=t?.url||e.url;c.response=Le({url:h,data:void 0},r)}this.hls.trigger(v.ERROR,c)}handlePlaylistLoaded(e,t,s,r,n,a){const o=this.hls,{type:l,level:d,levelOrTrack:u,id:c,groupId:h,deliveryDirectives:f}=r,m=ic(t,r),g=Dg(r);let p=typeof r.level=="number"&&g===Z.MAIN?d:void 0;const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(`${E} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(v.ERROR,{type:te.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:E,reason:E.message,response:t,context:r,level:p,parent:g,networkDetails:n,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const T=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(v.ERROR,{type:te.NETWORK_ERROR,details:C.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:T,reason:T.message,response:t,context:r,level:p,parent:g,networkDetails:n,stats:s});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case me.MANIFEST:case me.LEVEL:if(p){if(!u)p=0;else if(u!==o.levels[p]){const T=o.levels.indexOf(u);T>-1&&(p=T)}}o.trigger(v.LEVEL_LOADED,{details:e,levelInfo:u||o.levels[0],level:p||0,id:c||0,stats:s,networkDetails:n,deliveryDirectives:f,withoutMultiVariant:l===me.MANIFEST});break;case me.AUDIO_TRACK:o.trigger(v.AUDIO_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:h||"",stats:s,networkDetails:n,deliveryDirectives:f});break;case me.SUBTITLE_TRACK:o.trigger(v.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:h||"",stats:s,networkDetails:n,deliveryDirectives:f});break}}}class Ps{static get version(){return Va}static isMSESupported(){return oy()}static isSupported(){return dx()}static getMediaSource(){return Bs()}static get Events(){return v}static get MetadataSchema(){return Vt}static get ErrorTypes(){return te}static get ErrorDetails(){return C}static get DefaultConfig(){return Ps.defaultConfig?Ps.defaultConfig:XR}static set DefaultConfig(e){Ps.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new kf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=TS(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=JR(Ps.DefaultConfig,e,t);this.userConfig=e,s.progressive&&ex(s,t);const{abrController:r,bufferController:n,capLevelController:a,errorController:o,fpsController:l}=s,d=new o(this),u=this.abrController=new r(this),c=new p1(this),h=s.interstitialsController,f=h?this.interstitialsController=new h(this,Ps):null,m=this.bufferController=new n(this,c),g=this.capLevelController=new a(this),p=new l(this),E=new mx(this),T=s.contentSteeringController,y=T?new T(this):null,b=this.levelController=new lx(this,y),A=new ax(this),L=new fx(this.config,this.logger),S=this.streamController=new hx(this,c,L),R=this.gapController=new rx(this,c);g.setStreamController(S),p.setStreamController(S);const x=[E,b,S];f&&x.splice(1,0,f),y&&x.splice(1,0,y),this.networkControllers=x;const I=[u,m,R,g,p,A,c];this.audioTrackController=this.createController(s.audioTrackController,x);const M=s.audioStreamController;M&&x.push(this.audioStreamController=new M(this,c,L)),this.subtitleTrackController=this.createController(s.subtitleTrackController,x);const $=s.subtitleStreamController;$&&x.push(this.subtititleStreamController=new $(this,c,L)),this.createController(s.timelineController,I),L.emeController=this.emeController=this.createController(s.emeController,I),this.cmcdController=this.createController(s.cmcdController,I),this.latencyController=this.createController(ox,I),this.coreComponents=I,x.push(d);const V=d.onErrorOut;typeof V=="function"&&this.on(v.ERROR,V,d),this.on(v.MANIFEST_LOADED,E.onManifestLoaded,E)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===v.ERROR;this.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(v.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const n=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(v.ERROR,{type:te.OTHER_ERROR,details:C.ATTACH_MEDIA_ERROR,fatal:!0,error:n});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(v.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(v.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(v.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=Ef.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Z.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Z.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Z.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=rR()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){JS(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let n=r;n--;){const a=e[n].attrs["HDCP-LEVEL"];if(a&&a<=s)return n}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Yv(t);return Wv(e,s,navigator.mediaCapabilities)}}Ps.defaultConfig=void 0;var ge=Ps,Pe={VIDEO:"video",THUMBNAIL:"thumbnail",STORYBOARD:"storyboard",DRM:"drm"},re={NOT_AN_ERROR:0,NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_NO_STATUS:2000001,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_GENERIC_SERVER_FAIL:25e5,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},nu=i=>i===Pe.VIDEO?"playback":i,As=class sa extends Error{constructor(e,t=sa.MEDIA_ERR_CUSTOM,s,r){var n;super(e),this.name="MediaError",this.code=t,this.context=r,this.fatal=s??(t>=sa.MEDIA_ERR_NETWORK&&t<=sa.MEDIA_ERR_ENCRYPTED),this.message||(this.message=(n=sa.defaultMessages[this.code])!=null?n:"")}};As.MEDIA_ERR_ABORTED=1,As.MEDIA_ERR_NETWORK=2,As.MEDIA_ERR_DECODE=3,As.MEDIA_ERR_SRC_NOT_SUPPORTED=4,As.MEDIA_ERR_ENCRYPTED=5,As.MEDIA_ERR_CUSTOM=100,As.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var z=As,px=i=>i==null,Gf=(i,e)=>px(e)?!1:i in e,qc={ANY:"any",MUTED:"muted"},Se={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},Vi={MSE:"mse",NATIVE:"native"},ra={HEADER:"header",QUERY:"query",NONE:"none"},xd=Object.values(ra),us={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},Cg={HLS:us.M3U8};[...Object.values(us)];var gx="en",Yc={code:gx},Ze=(i,e,t,s,r=i)=>{r.addEventListener(e,t,s),i.addEventListener("teardown",()=>{r.removeEventListener(e,t)},{once:!0})};function vx(i,e,t){e&&t>e&&(t=e);for(let s=0;s<i.length;s++)if(i.start(s)<=t&&i.end(s)>=t)return!0;return!1}var Kf=i=>{let e=i.indexOf("?");if(e<0)return[i];let t=i.slice(0,e),s=i.slice(e);return[t,s]},au=i=>{let{type:e}=i;if(e){let t=e.toUpperCase();return Gf(t,Cg)?Cg[t]:e}return Ex(i)},ly=i=>i==="VOD"?Se.ON_DEMAND:Se.LIVE,dy=i=>i==="EVENT"?Number.POSITIVE_INFINITY:i==="VOD"?Number.NaN:0,Ex=i=>{let{src:e}=i;if(!e)return"";let t="";try{t=new URL(e).pathname}catch{console.error("invalid url")}let s=t.lastIndexOf(".");if(s<0)return Tx(i)?us.M3U8:"";let r=t.slice(s+1).toUpperCase();return Gf(r,us)?us[r]:""},yx="mux.com",Tx=({src:i,customDomain:e=yx})=>{let t;try{t=new URL(`${i}`)}catch{return!1}let s=t.protocol==="https:",r=t.hostname===`stream.${e}`.toLowerCase(),n=t.pathname.split("/"),a=n.length===2,o=!(n!=null&&n[1].includes("."));return s&&r&&a&&o},Tn=i=>{let e=(i??"").split(".")[1];if(e)try{let t=e.replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(t).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}catch{return}},bx=({exp:i},e=Date.now())=>!i||i*1e3<e,_x=({sub:i},e)=>i!==e,Ax=({aud:i},e)=>!i,Sx=({aud:i},e)=>i!==e,uy="en";function ie(i,e=!0){var t,s;let r=e&&(s=(t=Yc)==null?void 0:t[i])!=null?s:i,n=e?Yc.code:uy;return new Ix(r,n)}var Ix=class{constructor(e,t=(s=>(s=Yc)!=null?s:uy)()){this.message=e,this.locale=t}format(e){return this.message.replace(/\{(\w+)\}/g,(t,s)=>{var r;return(r=e[s])!=null?r:""})}toString(){return this.message}},Lx=Object.values(qc),wg=i=>typeof i=="boolean"||typeof i=="string"&&Lx.includes(i),Rx=(i,e,t)=>{let{autoplay:s}=i,r=!1,n=!1,a=wg(s)?s:!!s,o=()=>{r||Ze(e,"playing",()=>{r=!0},{once:!0})};if(o(),Ze(e,"loadstart",()=>{r=!1,o(),sc(e,a)},{once:!0}),Ze(e,"loadstart",()=>{t||(i.streamType&&i.streamType!==Se.UNKNOWN?n=i.streamType===Se.LIVE:n=!Number.isFinite(e.duration)),sc(e,a)},{once:!0}),t&&t.once(ge.Events.LEVEL_LOADED,(l,d)=>{var u;i.streamType&&i.streamType!==Se.UNKNOWN?n=i.streamType===Se.LIVE:n=(u=d.details.live)!=null?u:!1}),!a){let l=()=>{!n||Number.isFinite(i.startTime)||(t!=null&&t.liveSyncPosition?e.currentTime=t.liveSyncPosition:Number.isFinite(e.seekable.end(0))&&(e.currentTime=e.seekable.end(0)))};t&&Ze(e,"play",()=>{e.preload==="metadata"?t.once(ge.Events.LEVEL_UPDATED,l):l()},{once:!0})}return l=>{r||(a=wg(l)?l:!!l,sc(e,a))}},sc=(i,e)=>{if(!e)return;let t=i.muted,s=()=>i.muted=t;switch(e){case qc.ANY:i.play().catch(()=>{i.muted=!0,i.play().catch(s)});break;case qc.MUTED:i.muted=!0,i.play().catch(s);break;default:i.play().catch(()=>{});break}},xx=({preload:i,src:e},t,s)=>{let r=c=>{c!=null&&["","none","metadata","auto"].includes(c)?t.setAttribute("preload",c):t.removeAttribute("preload")};if(!s)return r(i),r;let n=!1,a=!1,o=s.config.maxBufferLength,l=s.config.maxBufferSize,d=c=>{r(c);let h=c??t.preload;a||h==="none"||(h==="metadata"?(s.config.maxBufferLength=1,s.config.maxBufferSize=1):(s.config.maxBufferLength=o,s.config.maxBufferSize=l),u())},u=()=>{!n&&e&&(n=!0,s.loadSource(e))};return Ze(t,"play",()=>{a=!0,s.config.maxBufferLength=o,s.config.maxBufferSize=l,u()},{once:!0}),d(i),d};function kx(i,e){var t;if(!("videoTracks"in i))return;let s=new WeakMap;e.on(ge.Events.MANIFEST_PARSED,function(l,d){o();let u=i.addVideoTrack("main");u.selected=!0;for(let[c,h]of d.levels.entries()){let f=u.addRendition(h.url[0],h.width,h.height,h.videoCodec,h.bitrate);s.set(h,`${c}`),f.id=`${c}`}}),e.on(ge.Events.AUDIO_TRACKS_UPDATED,function(l,d){a();for(let u of d.audioTracks){let c=u.default?"main":"alternative",h=i.addAudioTrack(c,u.name,u.lang);h.id=`${u.id}`,u.default&&(h.enabled=!0)}}),i.audioTracks.addEventListener("change",()=>{var l;let d=+((l=[...i.audioTracks].find(c=>c.enabled))==null?void 0:l.id),u=e.audioTracks.map(c=>c.id);d!=e.audioTrack&&u.includes(d)&&(e.audioTrack=d)}),e.on(ge.Events.LEVELS_UPDATED,function(l,d){var u;let c=i.videoTracks[(u=i.videoTracks.selectedIndex)!=null?u:0];if(!c)return;let h=d.levels.map(f=>s.get(f));for(let f of i.videoRenditions)f.id&&!h.includes(f.id)&&c.removeRendition(f)});let r=l=>{let d=l.target.selectedIndex;d!=e.nextLevel&&(e.nextLevel=d)};(t=i.videoRenditions)==null||t.addEventListener("change",r);let n=()=>{for(let l of i.videoTracks)i.removeVideoTrack(l)},a=()=>{for(let l of i.audioTracks)i.removeAudioTrack(l)},o=()=>{n(),a()};e.once(ge.Events.DESTROYING,o)}var rc=i=>"time"in i?i.time:i.startTime;function Dx(i,e){e.on(ge.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(r,{tracks:n})=>{n.forEach(a=>{var o,l;let d=(o=a.subtitleTrack)!=null?o:a.closedCaptions,u=e.subtitleTracks.findIndex(({lang:h,name:f,type:m})=>h==d?.lang&&f===a.label&&m.toLowerCase()===a.kind),c=((l=a._id)!=null?l:a.default)?"default":`${a.kind}${u}`;Vf(i,a.kind,a.label,d?.lang,c,a.default)})});let t=()=>{if(!e.subtitleTracks.length)return;let r=Array.from(i.textTracks).find(o=>o.id&&o.mode==="showing"&&["subtitles","captions"].includes(o.kind));if(!r)return;let n=e.subtitleTracks[e.subtitleTrack],a=n?n.default?"default":`${e.subtitleTracks[e.subtitleTrack].type.toLowerCase()}${e.subtitleTrack}`:void 0;if(e.subtitleTrack<0||r?.id!==a){let o=e.subtitleTracks.findIndex(({lang:l,name:d,type:u,default:c})=>r.id==="default"&&c||l==r.language&&d===r.label&&u.toLowerCase()===r.kind);e.subtitleTrack=o}r?.id===a&&r.cues&&Array.from(r.cues).forEach(o=>{r.addCue(o)})};i.textTracks.addEventListener("change",t),e.on(ge.Events.CUES_PARSED,(r,{track:n,cues:a})=>{let o=i.textTracks.getTrackById(n);if(!o)return;let l=o.mode==="disabled";l&&(o.mode="hidden"),a.forEach(d=>{var u;(u=o.cues)!=null&&u.getCueById(d.id)||o.addCue(d)}),l&&(o.mode="disabled")}),e.once(ge.Events.DESTROYING,()=>{i.textTracks.removeEventListener("change",t),i.querySelectorAll("track[data-removeondestroy]").forEach(r=>{r.remove()})});let s=()=>{Array.from(i.textTracks).forEach(r=>{var n,a;if(!["subtitles","caption"].includes(r.kind)&&(r.label==="thumbnails"||r.kind==="chapters")){if(!((n=r.cues)!=null&&n.length)){let o="track";r.kind&&(o+=`[kind="${r.kind}"]`),r.label&&(o+=`[label="${r.label}"]`);let l=i.querySelector(o),d=(a=l?.getAttribute("src"))!=null?a:"";l?.removeAttribute("src"),setTimeout(()=>{l?.setAttribute("src",d)},0)}r.mode!=="hidden"&&(r.mode="hidden")}})};e.once(ge.Events.MANIFEST_LOADED,s),e.once(ge.Events.MEDIA_ATTACHED,s)}function Vf(i,e,t,s,r,n){let a=document.createElement("track");return a.kind=e,a.label=t,s&&(a.srclang=s),r&&(a.id=r),n&&(a.default=!0),a.track.mode=["subtitles","captions"].includes(e)?"disabled":"hidden",a.setAttribute("data-removeondestroy",""),i.append(a),a.track}function Cx(i,e){let t=Array.prototype.find.call(i.querySelectorAll("track"),s=>s.track===e);t?.remove()}function uo(i,e,t){var s;return(s=Array.from(i.querySelectorAll("track")).find(r=>r.track.label===e&&r.track.kind===t))==null?void 0:s.track}async function cy(i,e,t,s){let r=uo(i,t,s);return r||(r=Vf(i,s,t),r.mode="hidden",await new Promise(n=>setTimeout(()=>n(void 0),0))),r.mode!=="hidden"&&(r.mode="hidden"),[...e].sort((n,a)=>rc(a)-rc(n)).forEach(n=>{var a,o;let l=n.value,d=rc(n);if("endTime"in n&&n.endTime!=null)r?.addCue(new VTTCue(d,n.endTime,s==="chapters"?l:JSON.stringify(l??null)));else{let u=Array.prototype.findIndex.call(r?.cues,m=>m.startTime>=d),c=(a=r?.cues)==null?void 0:a[u],h=c?c.startTime:Number.isFinite(i.duration)?i.duration:Number.MAX_SAFE_INTEGER,f=(o=r?.cues)==null?void 0:o[u-1];f&&(f.endTime=d),r?.addCue(new VTTCue(d,h,s==="chapters"?l:JSON.stringify(l??null)))}}),i.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),r}var Wf="cuepoints",hy=Object.freeze({label:Wf});async function fy(i,e,t=hy){return cy(i,e,t.label,"metadata")}var jc=i=>({time:i.startTime,value:JSON.parse(i.text)});function wx(i,e={label:Wf}){let t=uo(i,e.label,"metadata");return t!=null&&t.cues?Array.from(t.cues,s=>jc(s)):[]}function my(i,e={label:Wf}){var t,s;let r=uo(i,e.label,"metadata");if(!((t=r?.activeCues)!=null&&t.length))return;if(r.activeCues.length===1)return jc(r.activeCues[0]);let{currentTime:n}=i,a=Array.prototype.find.call((s=r.activeCues)!=null?s:[],({startTime:o,endTime:l})=>o<=n&&l>n);return jc(a||r.activeCues[0])}async function Mx(i,e=hy){return new Promise(t=>{Ze(i,"loadstart",async()=>{let s=await fy(i,[],e);Ze(i,"cuechange",()=>{let r=my(i);if(r){let n=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:r});i.dispatchEvent(n)}},{},s),t(s)})})}var qf="chapters",py=Object.freeze({label:qf}),zc=i=>({startTime:i.startTime,endTime:i.endTime,value:i.text});async function gy(i,e,t=py){return cy(i,e,t.label,"chapters")}function Px(i,e={label:qf}){var t;let s=uo(i,e.label,"chapters");return(t=s?.cues)!=null&&t.length?Array.from(s.cues,r=>zc(r)):[]}function vy(i,e={label:qf}){var t,s;let r=uo(i,e.label,"chapters");if(!((t=r?.activeCues)!=null&&t.length))return;if(r.activeCues.length===1)return zc(r.activeCues[0]);let{currentTime:n}=i,a=Array.prototype.find.call((s=r.activeCues)!=null?s:[],({startTime:o,endTime:l})=>o<=n&&l>n);return zc(a||r.activeCues[0])}async function Ox(i,e=py){return new Promise(t=>{Ze(i,"loadstart",async()=>{let s=await gy(i,[],e);Ze(i,"cuechange",()=>{let r=vy(i);if(r){let n=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:r});i.dispatchEvent(n)}},{},s),t(s)})})}function Nx(i,e){if(e){let t=e.playingDate;if(t!=null)return new Date(t.getTime()-i.currentTime*1e3)}return typeof i.getStartDate=="function"?i.getStartDate():new Date(NaN)}function Ux(i,e){if(e&&e.playingDate)return e.playingDate;if(typeof i.getStartDate=="function"){let t=i.getStartDate();return new Date(t.getTime()+i.currentTime*1e3)}return new Date(NaN)}var ka={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},$x=i=>{if(i===Pe.VIDEO)return ka.VIDEO;if(i===Pe.DRM)return ka.DRM},Fx=(i,e)=>{var t,s;let r=nu(i),n=`${r}Token`;return(t=e.tokens)!=null&&t[r]?(s=e.tokens)==null?void 0:s[r]:Gf(n,e)?e[n]:void 0},kd=(i,e,t,s,r=!1,n=!(a=>(a=globalThis.navigator)==null?void 0:a.onLine)())=>{var a,o;if(n){let E=ie("Your device appears to be offline",r),T,y=z.MEDIA_ERR_NETWORK,b=new z(E,y,!1,T);return b.errorCategory=e,b.muxCode=re.NETWORK_OFFLINE,b.data=i,b}let l="status"in i?i.status:i.code,d=Date.now(),u=z.MEDIA_ERR_NETWORK;if(l===200)return;let c=nu(e),h=Fx(e,t),f=$x(e),[m]=Kf((a=t.playbackId)!=null?a:"");if(!l||!m)return;let g=Tn(h);if(h&&!g){let E=ie("The {tokenNamePrefix}-token provided is invalid or malformed.",r).format({tokenNamePrefix:c}),T=ie("Compact JWT string: {token}",r).format({token:h}),y=new z(E,u,!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_TOKEN_MALFORMED,y.data=i,y}if(l>=500){let E=new z("",u,s??!0);return E.errorCategory=e,E.muxCode=re.NETWORK_UNKNOWN_ERROR,E}if(l===403)if(g){if(bx(g,d)){let E={timeStyle:"medium",dateStyle:"medium"},T=ie("The video’s secured {tokenNamePrefix}-token has expired.",r).format({tokenNamePrefix:c}),y=ie("Expired at: {expiredDate}. Current time: {currentDate}.",r).format({expiredDate:new Intl.DateTimeFormat("en",E).format((o=g.exp)!=null?o:0*1e3),currentDate:new Intl.DateTimeFormat("en",E).format(d)}),b=new z(T,u,!0,y);return b.errorCategory=e,b.muxCode=re.NETWORK_TOKEN_EXPIRED,b.data=i,b}if(_x(g,m)){let E=ie("The video’s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",r).format({tokenNamePrefix:c}),T=ie("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",r).format({tokenNamePrefix:c,playbackId:m,tokenPlaybackId:g.sub}),y=new z(E,u,!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_TOKEN_SUB_MISMATCH,y.data=i,y}if(Ax(g)){let E=ie("The {tokenNamePrefix}-token is formatted with incorrect information.",r).format({tokenNamePrefix:c}),T=ie("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",r).format({tokenNamePrefix:c,expectedAud:f}),y=new z(E,u,!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_TOKEN_AUD_MISSING,y.data=i,y}if(Sx(g,f)){let E=ie("The {tokenNamePrefix}-token is formatted with incorrect information.",r).format({tokenNamePrefix:c}),T=ie("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",r).format({tokenNamePrefix:c,expectedAud:f,aud:g.aud}),y=new z(E,u,!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_TOKEN_AUD_MISMATCH,y.data=i,y}}else{let E=ie("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",r).format({tokenNamePrefix:c,category:e}),T=ie("Specified playback ID: {playbackId}",r).format({playbackId:m}),y=new z(E,u,s??!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_TOKEN_MISSING,y.data=i,y}if(l===412){let E=ie("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",r),T=ie("Specified playback ID: {playbackId}",r).format({playbackId:m}),y=new z(E,u,s??!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_NOT_READY,y.streamType=t.streamType===Se.LIVE?"live":t.streamType===Se.ON_DEMAND?"on-demand":"unknown",y.data=i,y}if(l===404){let E=ie("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",r),T=ie("Specified playback ID: {playbackId}",r).format({playbackId:m}),y=new z(E,u,s??!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_NOT_FOUND,y.data=i,y}if(l===400){let E=ie("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),T=ie("Specified playback ID: {playbackId}",r).format({playbackId:m}),y=new z(E,u,s??!0,T);return y.errorCategory=e,y.muxCode=re.NETWORK_INVALID_URL,y.data=i,y}let p=new z("",u,s??!0);return p.errorCategory=e,p.muxCode=re.NETWORK_UNKNOWN_ERROR,p.data=i,p},Mg=ge.DefaultConfig.capLevelController,Ey=class yy extends Mg{constructor(e){super(e)}get levels(){var e;return(e=this.hls.levels)!=null?e:[]}getValidLevels(e){return this.levels.filter((t,s)=>this.isLevelAllowed(t)&&s<=e)}getMaxLevel(e){let t=super.getMaxLevel(e),s=this.getValidLevels(e);if(!s[t])return t;let r=Math.min(s[t].width,s[t].height),n=yy.minMaxResolution;return r>=n?t:Mg.getMaxLevelByMediaSize(s,n*(16/9),n)}};Ey.minMaxResolution=720;var Bx=Ey,Hx=Bx,nl={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},Gx=i=>{if(i.includes("fps"))return nl.FAIRPLAY;if(i.includes("playready"))return nl.PLAYREADY;if(i.includes("widevine"))return nl.WIDEVINE},Kx=i=>{let e=i.split(`
`).find((t,s,r)=>s&&r[s-1].startsWith("#EXT-X-STREAM-INF"));return fetch(e).then(t=>t.status!==200?Promise.reject(t):t.text())},Vx=i=>{let e=i.split(`
`).filter(s=>s.startsWith("#EXT-X-SESSION-DATA"));if(!e.length)return{};let t={};for(let s of e){let r=qx(s),n=r["DATA-ID"];n&&(t[n]={...r})}return{sessionData:t}},Wx=/([A-Z0-9-]+)="?(.*?)"?(?:,|$)/g;function qx(i){let e=[...i.matchAll(Wx)];return Object.fromEntries(e.map(([,t,s])=>[t,s]))}var Yx=i=>{var e,t,s;let r=i.split(`
`),n=(t=((e=r.find(d=>d.startsWith("#EXT-X-PLAYLIST-TYPE")))!=null?e:"").split(":")[1])==null?void 0:t.trim(),a=ly(n),o=dy(n),l;if(a===Se.LIVE){let d=r.find(u=>u.startsWith("#EXT-X-PART-INF"));if(d)l=+d.split(":")[1].split("=")[1]*2;else{let u=r.find(h=>h.startsWith("#EXT-X-TARGETDURATION")),c=(s=u?.split(":"))==null?void 0:s[1];l=+(c??6)*3}}return{streamType:a,targetLiveWindow:o,liveEdgeStartOffset:l}},jx=async(i,e)=>{if(e===us.MP4)return{streamType:Se.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0,sessionData:void 0};if(e===us.M3U8){let t=await fetch(i);if(!t.ok)return Promise.reject(t);let s=await t.text(),r=await Kx(s);return{...Vx(s),...Yx(r)}}return console.error(`Media type ${e} is an unrecognized or unsupported type for src ${i}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0,sessionData:void 0}},zx=async(i,e,t=au({src:i}))=>{var s,r,n,a;let{streamType:o,targetLiveWindow:l,liveEdgeStartOffset:d,sessionData:u}=await jx(i,t),c=u?.["com.apple.hls.chapters"];(c!=null&&c.URI||c!=null&&c.VALUE.toLocaleLowerCase().startsWith("http"))&&Yf((s=c.URI)!=null?s:c.VALUE,e),((r=We.get(e))!=null?r:{}).liveEdgeStartOffset=d,((n=We.get(e))!=null?n:{}).targetLiveWindow=l,e.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((a=We.get(e))!=null?a:{}).streamType=o,e.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},Yf=async(i,e)=>{var t,s;try{let r=await fetch(i);if(!r.ok)throw new Error(`Failed to fetch Mux metadata: ${r.status} ${r.statusText}`);let n=await r.json(),a={};if(!((t=n?.[0])!=null&&t.metadata))return;for(let l of n[0].metadata)l.key&&l.value&&(a[l.key]=l.value);((s=We.get(e))!=null?s:{}).metadata=a;let o=new CustomEvent("muxmetadata");e.dispatchEvent(o)}catch(r){console.error(r)}},Qx=i=>{var e;let t=i.type,s=ly(t),r=dy(t),n,a=!!((e=i.partList)!=null&&e.length);return s===Se.LIVE&&(n=a?i.partTarget*2:i.targetduration*3),{streamType:s,targetLiveWindow:r,liveEdgeStartOffset:n,lowLatency:a}},Xx=(i,e,t)=>{var s,r,n,a,o,l,d,u;let{streamType:c,targetLiveWindow:h,liveEdgeStartOffset:f,lowLatency:m}=Qx(i);if(c===Se.LIVE){m?(t.config.backBufferLength=(s=t.userConfig.backBufferLength)!=null?s:4,t.config.maxFragLookUpTolerance=(r=t.userConfig.maxFragLookUpTolerance)!=null?r:.001,t.config.abrBandWidthUpFactor=(n=t.userConfig.abrBandWidthUpFactor)!=null?n:t.config.abrBandWidthFactor):t.config.backBufferLength=(a=t.userConfig.backBufferLength)!=null?a:8;let g=Object.freeze({get length(){return e.seekable.length},start(p){return e.seekable.start(p)},end(p){var E;return p>this.length||p<0||Number.isFinite(e.duration)?e.seekable.end(p):(E=t.liveSyncPosition)!=null?E:e.seekable.end(p)}});((o=We.get(e))!=null?o:{}).seekable=g}((l=We.get(e))!=null?l:{}).liveEdgeStartOffset=f,((d=We.get(e))!=null?d:{}).targetLiveWindow=h,e.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((u=We.get(e))!=null?u:{}).streamType=c,e.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},Pg,Og,Zx=(Og=(Pg=globalThis?.navigator)==null?void 0:Pg.userAgent)!=null?Og:"",Ng,Ug,$g,Jx=($g=(Ug=(Ng=globalThis?.navigator)==null?void 0:Ng.userAgentData)==null?void 0:Ug.platform)!=null?$g:"",Fg,Bg,Hg,ek=(Hg=(Bg=(Fg=globalThis?.navigator)==null?void 0:Fg.userAgentData)==null?void 0:Bg.brands)!=null?Hg:[],tk=Zx.toLowerCase().includes("android")||["x11","android"].some(i=>Jx.toLowerCase().includes(i)),Gg=ek.find(i=>i.brand==="Google Chrome"),ik=i=>{var e;return Gg&&parseInt((e=Gg.version)!=null?e:"0")>=141&&!!i.canPlayType("application/vnd.apple.mpegurl")},We=new WeakMap,cs="mux.com",Kg,Vg,Ty=(Vg=(Kg=ge).isSupported)==null?void 0:Vg.call(Kg),sk=i=>tk||ik(i),jf=()=>vf.utils.now(),rk=vf.utils.generateUUID,Qc=({playbackId:i,customDomain:e=cs,maxResolution:t,minResolution:s,renditionOrder:r,programStartTime:n,programEndTime:a,assetStartTime:o,assetEndTime:l,playbackToken:d,tokens:{playback:u=d}={},extraSourceParams:c={}}={})=>{if(!i)return;let[h,f=""]=Kf(i),m=new URL(`https://stream.${e}/${h}.m3u8${f}`);return u||m.searchParams.has("token")?(m.searchParams.forEach((g,p)=>{p!="token"&&m.searchParams.delete(p)}),u&&m.searchParams.set("token",u)):(t&&m.searchParams.set("max_resolution",t),s&&(m.searchParams.set("min_resolution",s),t&&+t.slice(0,-1)<+s.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",s,"maxResolution",t)),r&&m.searchParams.set("rendition_order",r),n&&m.searchParams.set("program_start_time",`${n}`),a&&m.searchParams.set("program_end_time",`${a}`),o&&m.searchParams.set("asset_start_time",`${o}`),l&&m.searchParams.set("asset_end_time",`${l}`),Object.entries(c).forEach(([g,p])=>{p!=null&&m.searchParams.set(g,p)})),m.toString()},ou=i=>{if(!i)return;let[e]=i.split("?");return e||void 0},zf=i=>{if(!i||!i.startsWith("https://stream."))return;let[e]=new URL(i).pathname.slice(1).split(/\.m3u8|\//);return e||void 0},nk=i=>{var e,t,s;return(e=i?.metadata)!=null&&e.video_id?i.metadata.video_id:xy(i)&&(s=(t=ou(i.playbackId))!=null?t:zf(i.src))!=null?s:i.src},by=i=>{var e;return(e=We.get(i))==null?void 0:e.error},ak=i=>{var e;return(e=We.get(i))==null?void 0:e.metadata},Xc=i=>{var e,t;return(t=(e=We.get(i))==null?void 0:e.streamType)!=null?t:Se.UNKNOWN},ok=i=>{var e,t;return(t=(e=We.get(i))==null?void 0:e.targetLiveWindow)!=null?t:Number.NaN},Qf=i=>{var e,t;return(t=(e=We.get(i))==null?void 0:e.seekable)!=null?t:i.seekable},lk=i=>{var e;let t=(e=We.get(i))==null?void 0:e.liveEdgeStartOffset;if(typeof t!="number")return Number.NaN;let s=Qf(i);return s.length?s.end(s.length-1)-t:Number.NaN},Xf=.034,dk=(i,e,t=Xf)=>Math.abs(i-e)<=t,_y=(i,e,t=Xf)=>i>e||dk(i,e,t),uk=(i,e=Xf)=>i.paused&&_y(i.currentTime,i.duration,e),Ay=(i,e)=>{var t,s,r;if(!e||!i.buffered.length)return;if(i.readyState>2)return!1;let n=e.currentLevel>=0?(s=(t=e.levels)==null?void 0:t[e.currentLevel])==null?void 0:s.details:(r=e.levels.find(c=>!!c.details))==null?void 0:r.details;if(!n||n.live)return;let{fragments:a}=n;if(!(a!=null&&a.length))return;if(i.currentTime<i.duration-(n.targetduration+.5))return!1;let o=a[a.length-1];if(i.currentTime<=o.start)return!1;let l=o.start+o.duration/2,d=i.buffered.start(i.buffered.length-1),u=i.buffered.end(i.buffered.length-1);return l>d&&l<u},Sy=(i,e)=>i.ended||i.loop?i.ended:e&&Ay(i,e)?!0:uk(i),ck=(i,e,t)=>{Iy(e,t,i);let{metadata:s={}}=i,{view_session_id:r=rk()}=s,n=nk(i);s.view_session_id=r,s.video_id=n,i.metadata=s;let a=u=>{var c;(c=e.mux)==null||c.emit("hb",{view_drm_type:u})};i.drmTypeCb=a,We.set(e,{retryCount:0});let o=hk(i,e),l=xx(i,e,o);i!=null&&i.muxDataKeepSession&&e!=null&&e.mux&&!e.mux.deleted?o&&e.mux.addHLSJS({hlsjs:o,Hls:o?ge:void 0}):Ek(i,e,o),yk(i,e,o),Mx(e),Ox(e);let d=Rx(i,e,o);return{engine:o,setAutoplay:d,setPreload:l}},Iy=(i,e,t)=>{let s=e?.engine;i!=null&&i.mux&&!i.mux.deleted&&(t!=null&&t.muxDataKeepSession?s&&i.mux.removeHLSJS():(i.mux.destroy(),delete i.mux)),s&&(s.detachMedia(),s.destroy()),i&&(i.hasAttribute("src")&&(i.removeAttribute("src"),i.load()),i.removeEventListener("error",Dy),i.removeEventListener("error",Zc),i.removeEventListener("durationchange",ky),We.delete(i),i.dispatchEvent(new Event("teardown")))};function Ly(i,e){var t;let s=au(i);if(s!==us.M3U8)return!0;let r=!s||((t=e.canPlayType(s))!=null?t:!0),{preferPlayback:n}=i,a=n===Vi.MSE,o=n===Vi.NATIVE,l=Ty&&(a||sk(e));return r&&(o||!l)}var hk=(i,e)=>{let{debug:t,streamType:s,startTime:r=-1,metadata:n,preferCmcd:a,_hlsConfig:o={}}=i,l=au(i)===us.M3U8,d=Ly(i,e);if(l&&!d&&Ty){let u={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},c=fk(s),h=mk(i),f=[ra.QUERY,ra.HEADER].includes(a)?{useHeaders:a===ra.HEADER,sessionId:n?.view_session_id,contentId:n?.video_id}:void 0,m=o.capLevelToPlayerSize==null?{capLevelController:Hx}:{},g=new ge({debug:t,startPosition:r,cmcd:f,xhrSetup:(p,E)=>{var T,y;if(a&&a!==ra.QUERY)return;let b=new URL(E);if(!b.searchParams.has("CMCD"))return;let A=((y=(T=b.searchParams.get("CMCD"))==null?void 0:T.split(","))!=null?y:[]).filter(L=>L.startsWith("sid")||L.startsWith("cid")).join(",");b.searchParams.set("CMCD",A),p.open("GET",b)},...m,...u,...c,...h,...o});return g.on(ge.Events.MANIFEST_PARSED,async function(p,E){var T,y;let b=(T=E.sessionData)==null?void 0:T["com.apple.hls.chapters"];(b!=null&&b.URI||b!=null&&b.VALUE.toLocaleLowerCase().startsWith("http"))&&Yf((y=b?.URI)!=null?y:b?.VALUE,e)}),g}},fk=i=>i===Se.LIVE?{backBufferLength:8}:{},mk=i=>{let{tokens:{drm:e}={},playbackId:t,drmTypeCb:s}=i,r=ou(t);return!e||!r?{}:{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:al(i,"fairplay"),serverCertificateUrl:Ry(i,"fairplay")},"com.widevine.alpha":{licenseUrl:al(i,"widevine")},"com.microsoft.playready":{licenseUrl:al(i,"playready")}},requestMediaKeySystemAccessFunc:(n,a)=>(n==="com.widevine.alpha"&&(a=[...a.map(o=>{var l;let d=(l=o.videoCapabilities)==null?void 0:l.map(u=>({...u,robustness:"HW_SECURE_ALL"}));return{...o,videoCapabilities:d}}),...a]),navigator.requestMediaKeySystemAccess(n,a).then(o=>{let l=Gx(n);return s?.(l),o}))}},pk=async i=>{let e=await fetch(i);return e.status!==200?Promise.reject(e):await e.arrayBuffer()},gk=async(i,e)=>{let t=await fetch(e,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:i});if(t.status!==200)return Promise.reject(t);let s=await t.arrayBuffer();return new Uint8Array(s)},vk=(i,e)=>{Ze(e,"encrypted",async t=>{try{let s=t.initDataType;if(s!=="skd"){console.error(`Received unexpected initialization data type "${s}"`);return}if(!e.mediaKeys){let l=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[s],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(u=>{var c;return(c=i.drmTypeCb)==null||c.call(i,nl.FAIRPLAY),u}).catch(()=>{let u=ie("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),c=new z(u,z.MEDIA_ERR_ENCRYPTED,!0);c.errorCategory=Pe.DRM,c.muxCode=re.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,ei(e,c)});if(!l)return;let d=await l.createMediaKeys();try{let u=await pk(Ry(i,"fairplay")).catch(c=>{if(c instanceof Response){let h=kd(c,Pe.DRM,i);return console.error("mediaError",h?.message,h?.context),h?Promise.reject(h):Promise.reject(new Error("Unexpected error in app cert request"))}return Promise.reject(c)});await d.setServerCertificate(u).catch(()=>{let c=ie("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),h=new z(c,z.MEDIA_ERR_ENCRYPTED,!0);return h.errorCategory=Pe.DRM,h.muxCode=re.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(h)})}catch(u){ei(e,u);return}await e.setMediaKeys(d)}let r=t.initData;if(r==null){console.error(`Could not start encrypted playback due to missing initData in ${t.type} event`);return}let n=e.mediaKeys.createSession();n.addEventListener("keystatuseschange",()=>{n.keyStatuses.forEach(l=>{let d;if(l==="internal-error"){let u=ie("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");d=new z(u,z.MEDIA_ERR_ENCRYPTED,!0),d.errorCategory=Pe.DRM,d.muxCode=re.ENCRYPTED_CDM_ERROR}else if(l==="output-restricted"||l==="output-downscaled"){let u=ie("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");d=new z(u,z.MEDIA_ERR_ENCRYPTED,!1),d.errorCategory=Pe.DRM,d.muxCode=re.ENCRYPTED_OUTPUT_RESTRICTED}d&&ei(e,d)})});let a=await Promise.all([n.generateRequest(s,r).catch(()=>{let l=ie("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),d=new z(l,z.MEDIA_ERR_ENCRYPTED,!0);d.errorCategory=Pe.DRM,d.muxCode=re.ENCRYPTED_GENERATE_REQUEST_FAILED,ei(e,d)}),new Promise(l=>{n.addEventListener("message",d=>{l(d.message)},{once:!0})})]).then(([,l])=>l),o=await gk(a,al(i,"fairplay")).catch(l=>{if(l instanceof Response){let d=kd(l,Pe.DRM,i);return console.error("mediaError",d?.message,d?.context),d?Promise.reject(d):Promise.reject(new Error("Unexpected error in license key request"))}return Promise.reject(l)});await n.update(o).catch(()=>{let l=ie("Failed to update DRM license. This may be an issue with the player or your protected content."),d=new z(l,z.MEDIA_ERR_ENCRYPTED,!0);return d.errorCategory=Pe.DRM,d.muxCode=re.ENCRYPTED_UPDATE_LICENSE_FAILED,Promise.reject(d)})}catch(s){ei(e,s);return}})},al=({playbackId:i,tokens:{drm:e}={},customDomain:t=cs},s)=>{let r=ou(i);return`https://license.${t.toLocaleLowerCase().endsWith(cs)?t:cs}/license/${s}/${r}?token=${e}`},Ry=({playbackId:i,tokens:{drm:e}={},customDomain:t=cs},s)=>{let r=ou(i);return`https://license.${t.toLocaleLowerCase().endsWith(cs)?t:cs}/appcert/${s}/${r}?token=${e}`},xy=({playbackId:i,src:e,customDomain:t})=>{if(i)return!0;if(typeof e!="string")return!1;let s=window?.location.href,r=new URL(e,s).hostname.toLocaleLowerCase();return r.includes(cs)||!!t&&r.includes(t.toLocaleLowerCase())},Ek=(i,e,t)=>{var s;let{envKey:r,disableTracking:n,muxDataSDK:a=vf,muxDataSDKOptions:o={}}=i,l=xy(i);if(!n&&(r||l)){let{playerInitTime:d,playerSoftwareName:u,playerSoftwareVersion:c,beaconCollectionDomain:h,debug:f,disableCookies:m}=i,g={...i.metadata,video_title:((s=i?.metadata)==null?void 0:s.video_title)||void 0},p=E=>typeof E.player_error_code=="string"?!1:typeof i.errorTranslator=="function"?i.errorTranslator(E):E;a.monitor(e,{debug:f,beaconCollectionDomain:h,hlsjs:t,Hls:t?ge:void 0,automaticErrorTracking:!1,errorTranslator:p,disableCookies:m,...o,data:{...r?{env_key:r}:{},player_software_name:u,player_software:u,player_software_version:c,player_init_time:d,...g}})}},yk=(i,e,t)=>{var s,r;let n=Ly(i,e),{src:a,customDomain:o=cs}=i,l=()=>{e.ended||i.disablePseudoEnded||!Sy(e,t)||(Ay(e,t)?e.currentTime=e.buffered.end(e.buffered.length-1):e.dispatchEvent(new Event("ended")))},d,u,c=()=>{let h=Qf(e),f,m;h.length>0&&(f=h.start(0),m=h.end(0)),(u!==m||d!==f)&&e.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),d=f,u=m};if(Ze(e,"durationchange",c),e&&n){let h=au(i);if(typeof a=="string"){if(a.endsWith(".mp4")&&a.includes(o)){let g=zf(a),p=new URL(`https://stream.${o}/${g}/metadata.json`);Yf(p.toString(),e)}let f=()=>{if(Xc(e)!==Se.LIVE||Number.isFinite(e.duration))return;let g=setInterval(c,1e3);e.addEventListener("teardown",()=>{clearInterval(g)},{once:!0}),Ze(e,"durationchange",()=>{Number.isFinite(e.duration)&&clearInterval(g)})},m=async()=>zx(a,e,h).then(f).catch(g=>{if(g instanceof Response){let p=kd(g,Pe.VIDEO,i);if(p){ei(e,p);return}}});if(e.preload==="none"){let g=()=>{m(),e.removeEventListener("loadedmetadata",p)},p=()=>{m(),e.removeEventListener("play",g)};Ze(e,"play",g,{once:!0}),Ze(e,"loadedmetadata",p,{once:!0})}else m();(s=i.tokens)!=null&&s.drm?vk(i,e):Ze(e,"encrypted",()=>{let g=ie("Attempting to play DRM-protected content without providing a DRM token."),p=new z(g,z.MEDIA_ERR_ENCRYPTED,!0);p.errorCategory=Pe.DRM,p.muxCode=re.ENCRYPTED_MISSING_TOKEN,ei(e,p)},{once:!0}),e.setAttribute("src",a),i.startTime&&(((r=We.get(e))!=null?r:{}).startTime=i.startTime,e.addEventListener("durationchange",ky,{once:!0}))}else e.removeAttribute("src");e.addEventListener("error",Dy),e.addEventListener("error",Zc),e.addEventListener("emptied",()=>{e.querySelectorAll("track[data-removeondestroy]").forEach(f=>{f.remove()})},{once:!0}),Ze(e,"pause",l),Ze(e,"seeked",l),Ze(e,"play",()=>{e.ended||_y(e.currentTime,e.duration)&&(e.currentTime=e.seekable.length?e.seekable.start(0):0)})}else t&&a?(t.once(ge.Events.LEVEL_LOADED,(h,f)=>{Xx(f.details,e,t),c(),Xc(e)===Se.LIVE&&!Number.isFinite(e.duration)&&(t.on(ge.Events.LEVEL_UPDATED,c),Ze(e,"durationchange",()=>{Number.isFinite(e.duration)&&t.off(ge.Events.LEVELS_UPDATED,c)}))}),t.on(ge.Events.ERROR,(h,f)=>{var m,g;let p=Tk(f,i);if(p.muxCode===re.NETWORK_NOT_READY){let E=(m=We.get(e))!=null?m:{},T=(g=E.retryCount)!=null?g:0;if(T<6){let y=T===0?5e3:6e4,b=new z(`Retrying in ${y/1e3} seconds...`,p.code,p.fatal);Object.assign(b,p),ei(e,b),setTimeout(()=>{E.retryCount=T+1,f.details==="manifestLoadError"&&f.url&&t.loadSource(f.url)},y);return}else{E.retryCount=0;let y=new z('Try again later or <a href="#" onclick="window.location.reload(); return false;" style="color: #4a90e2;">click here to retry</a>',p.code,p.fatal);Object.assign(y,p),ei(e,y);return}}ei(e,p)}),t.on(ge.Events.MANIFEST_LOADED,()=>{let h=We.get(e);h&&h.error&&(h.error=null,h.retryCount=0,e.dispatchEvent(new Event("emptied")),e.dispatchEvent(new Event("loadstart")))}),e.addEventListener("error",Zc),Ze(e,"waiting",l),kx(i,t),Dx(e,t),t.attachMedia(e)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function ky(i){var e;let t=i.target,s=(e=We.get(t))==null?void 0:e.startTime;if(s&&vx(t.seekable,t.duration,s)){let r=t.preload==="auto";r&&(t.preload="none"),t.currentTime=s,r&&(t.preload="auto")}}async function Dy(i){if(!i.isTrusted)return;i.stopImmediatePropagation();let e=i.target;if(!(e!=null&&e.error))return;let{message:t,code:s}=e.error,r=new z(t,s);if(e.src&&s===z.MEDIA_ERR_SRC_NOT_SUPPORTED&&e.readyState===HTMLMediaElement.HAVE_NOTHING){setTimeout(()=>{var n;let a=(n=by(e))!=null?n:e.error;a?.code===z.MEDIA_ERR_SRC_NOT_SUPPORTED&&ei(e,r)},500);return}if(e.src&&(s!==z.MEDIA_ERR_DECODE||s!==void 0))try{let{status:n}=await fetch(e.src);r.data={response:{code:n}}}catch{}ei(e,r)}function ei(i,e){var t;e.fatal&&(((t=We.get(i))!=null?t:{}).error=e,i.dispatchEvent(new CustomEvent("error",{detail:e})))}function Zc(i){var e,t;if(!(i instanceof CustomEvent)||!(i.detail instanceof z))return;let s=i.target,r=i.detail;!r||!r.fatal||(((e=We.get(s))!=null?e:{}).error=r,(t=s.mux)==null||t.emit("error",{player_error_code:r.code,player_error_message:r.message,player_error_context:r.context}))}var Tk=(i,e)=>{var t,s,r;console.error("getErrorFromHlsErrorData()",i);let n={[ge.ErrorTypes.NETWORK_ERROR]:z.MEDIA_ERR_NETWORK,[ge.ErrorTypes.MEDIA_ERROR]:z.MEDIA_ERR_DECODE,[ge.ErrorTypes.KEY_SYSTEM_ERROR]:z.MEDIA_ERR_ENCRYPTED},a=u=>[ge.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,ge.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(u.details)?z.MEDIA_ERR_NETWORK:n[u.type],o=u=>{if(u.type===ge.ErrorTypes.KEY_SYSTEM_ERROR)return Pe.DRM;if(u.type===ge.ErrorTypes.NETWORK_ERROR)return Pe.VIDEO},l,d=a(i);if(d===z.MEDIA_ERR_NETWORK&&i.response){let u=(t=o(i))!=null?t:Pe.VIDEO;l=(s=kd(i.response,u,e,i.fatal))!=null?s:new z("",d,i.fatal)}else if(d===z.MEDIA_ERR_ENCRYPTED)if(i.details===ge.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE){let u=ie("Attempting to play DRM-protected content without providing a DRM token.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_MISSING_TOKEN}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_NO_ACCESS){let u=ie("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_NO_SESSION){let u=ie("Failed to generate a DRM license request. This may be an issue with the player or your protected content.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,!0),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_GENERATE_REQUEST_FAILED}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED){let u=ie("Failed to update DRM license. This may be an issue with the player or your protected content.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_UPDATE_LICENSE_FAILED}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED){let u=ie("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_UPDATE_SERVER_CERT_FAILED}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR){let u=ie("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_CDM_ERROR}else if(i.details===ge.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED){let u=ie("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");l=new z(u,z.MEDIA_ERR_ENCRYPTED,!1),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_OUTPUT_RESTRICTED}else l=new z(i.error.message,z.MEDIA_ERR_ENCRYPTED,i.fatal),l.errorCategory=Pe.DRM,l.muxCode=re.ENCRYPTED_ERROR;else l=new z("",d,i.fatal);return l.context||(l.context=`${i.url?`url: ${i.url}
`:""}${i.response&&(i.response.code||i.response.text)?`response: ${i.response.code}, ${i.response.text}
`:""}${i.reason?`failure reason: ${i.reason}
`:""}${i.level?`level: ${i.level}
`:""}${i.parent?`parent stream controller: ${i.parent}
`:""}${i.buffer?`buffer length: ${i.buffer}
`:""}${i.error?`error: ${i.error}
`:""}${i.event?`event: ${i.event}
`:""}${i.err?`error message: ${(r=i.err)==null?void 0:r.message}
`:""}`),l.data=i,l};const bk=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],Cy=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function _k(i){return`
    <style>
      :host {
        display: inline-flex;
        line-height: 0;
        flex-direction: column;
        justify-content: end;
      }

      audio {
        width: 100%;
      }
    </style>
    <slot name="media">
      <audio${My(i)}></audio>
    </slot>
    <slot></slot>
  `}function Ak(i){return`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot name="media">
      <video${My(i)}></video>
    </slot>
    <slot></slot>
  `}function wy(i,{tag:e,is:t}){const s=globalThis.document?.createElement?.(e,{is:t}),r=s?Sk(s):[];return class Jc extends i{static getTemplateHTML=e.endsWith("audio")?_k:Ak;static shadowRootOptions={mode:"open"};static Events=bk;static#e=!1;static get observedAttributes(){return Jc.#s(),[...s?.constructor?.observedAttributes??[],...Cy]}static#s(){if(this.#e)return;this.#e=!0;const a=new Set(this.observedAttributes);a.delete("muted");for(const o of r)if(!(o in this.prototype))if(typeof s[o]=="function")this.prototype[o]=function(...l){return this.#n(),this.call?this.call(o,...l):this.nativeEl?.[o]?.apply(this.nativeEl,l)};else{const l={get(){this.#n();const d=o.toLowerCase();if(a.has(d)){const u=this.getAttribute(d);return u===null?!1:u===""?!0:u}return this.get?.(o)??this.nativeEl?.[o]}};o!==o.toUpperCase()&&(l.set=function(d){this.#n();const u=o.toLowerCase();if(a.has(u)){d===!0||d===!1||d==null?this.toggleAttribute(u,!!d):this.setAttribute(u,d);return}if(this.set){this.set(o,d);return}this.nativeEl&&(this.nativeEl[o]=d)}),Object.defineProperty(this.prototype,o,l)}}#i=!1;#r=null;#t=new Map;#a;get;set;call;get nativeEl(){return this.#n(),this.#r??this.querySelector(":scope > [slot=media]")??this.querySelector(e)??this.shadowRoot?.querySelector(e)??null}set nativeEl(a){this.#r=a}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(a){this.toggleAttribute("muted",a)}get src(){return this.getAttribute("src")}set src(a){this.setAttribute("src",`${a}`)}get preload(){return this.getAttribute("preload")??this.nativeEl?.preload}set preload(a){this.setAttribute("preload",`${a}`)}#n(){this.#i||(this.#i=!0,this.init())}init(){if(!this.shadowRoot){this.attachShadow({mode:"open"});const a=Ik(this.attributes);t&&(a.is=t),e&&(a.part=e),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(a)}this.nativeEl.muted=this.hasAttribute("muted");for(const a of r)this.#c(a);this.#a=new MutationObserver(this.#o.bind(this)),this.shadowRoot.addEventListener("slotchange",()=>this.#l()),this.#l();for(const a of this.constructor.Events)this.shadowRoot.addEventListener(a,this,!0)}handleEvent(a){a.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(a.type,{detail:a.detail}))}#l(){const a=new Map(this.#t);(this.shadowRoot?.querySelector("slot:not([name])")?.assignedElements({flatten:!0}).filter(d=>["track","source"].includes(d.localName))).forEach(d=>{a.delete(d);let u=this.#t.get(d);u||(u=d.cloneNode(),this.#t.set(d,u),this.#a?.observe(d,{attributes:!0})),this.nativeEl?.append(u),this.#d(u)}),a.forEach((d,u)=>{d.remove(),this.#t.delete(u)})}#o(a){for(const o of a)if(o.type==="attributes"){const{target:l,attributeName:d}=o,u=this.#t.get(l);u&&d&&(u.setAttribute(d,l.getAttribute(d)??""),this.#d(u))}}#d(a){a&&a.localName==="track"&&a.default&&(a.kind==="chapters"||a.kind==="metadata")&&a.track.mode==="disabled"&&(a.track.mode="hidden")}#c(a){if(Object.prototype.hasOwnProperty.call(this,a)){const o=this[a];delete this[a],this[a]=o}}attributeChangedCallback(a,o,l){this.#n(),this.#u(a,o,l)}#u(a,o,l){["id","class"].includes(a)||!Jc.observedAttributes.includes(a)&&this.constructor.observedAttributes.includes(a)||(l===null?this.nativeEl?.removeAttribute(a):this.nativeEl?.getAttribute(a)!==l&&this.nativeEl?.setAttribute(a,l))}connectedCallback(){this.#n()}}}function Sk(i){const e=[];for(let t=Object.getPrototypeOf(i);t&&t!==HTMLElement.prototype;t=Object.getPrototypeOf(t)){const s=Object.getOwnPropertyNames(t);e.push(...s)}return e}function My(i){let e="";for(const t in i){if(!Cy.includes(t))continue;const s=i[t];s===""?e+=` ${t}`:e+=` ${t}="${s}"`}return e}function Ik(i){const e={};for(const t of i)e[t.name]=t.value;return e}const Mo=wy(globalThis.HTMLElement??class{},{tag:"video"});wy(globalThis.HTMLElement??class{},{tag:"audio"});var Py=i=>{throw TypeError(i)},Zf=(i,e,t)=>e.has(i)||Py("Cannot "+t),gt=(i,e,t)=>(Zf(i,e,"read from private field"),t?t.call(i):e.get(i)),oi=(i,e,t)=>e.has(i)?Py("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Xt=(i,e,t,s)=>(Zf(i,e,"write to private field"),e.set(i,t),t),nc=(i,e,t)=>(Zf(i,e,"access private method"),t),Lk=()=>{try{return"0.27.2"}catch{}return"UNKNOWN"},Rk=Lk(),xk=()=>Rk,kk=`
<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" part="logo" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 1600 500"><g fill="#fff"><path d="M994.287 93.486c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m0-93.486c-34.509 0-62.484 27.976-62.484 62.486v187.511c0 68.943-56.09 125.033-125.032 125.033s-125.03-56.09-125.03-125.033V62.486C681.741 27.976 653.765 0 619.256 0s-62.484 27.976-62.484 62.486v187.511C556.772 387.85 668.921 500 806.771 500c137.851 0 250.001-112.15 250.001-250.003V62.486c0-34.51-27.976-62.486-62.485-62.486M1537.51 468.511c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m-275.883-218.509-143.33 143.329c-24.402 24.402-24.402 63.966 0 88.368 24.402 24.402 63.967 24.402 88.369 0l143.33-143.329 143.328 143.329c24.402 24.4 63.967 24.402 88.369 0 24.403-24.402 24.403-63.966.001-88.368l-143.33-143.329.001-.004 143.329-143.329c24.402-24.402 24.402-63.965 0-88.367s-63.967-24.402-88.369 0L1349.996 161.63 1206.667 18.302c-24.402-24.401-63.967-24.402-88.369 0s-24.402 63.965 0 88.367l143.329 143.329v.004ZM437.511 468.521c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31M461.426 4.759C438.078-4.913 411.2.432 393.33 18.303L249.999 161.632 106.669 18.303C88.798.432 61.922-4.913 38.573 4.759 15.224 14.43-.001 37.214-.001 62.488v375.026c0 34.51 27.977 62.486 62.487 62.486 34.51 0 62.486-27.976 62.486-62.486V213.341l80.843 80.844c24.404 24.402 63.965 24.402 88.369 0l80.843-80.844v224.173c0 34.51 27.976 62.486 62.486 62.486s62.486-27.976 62.486-62.486V62.488c0-25.274-15.224-48.058-38.573-57.729" style="fill-rule:nonzero"/></g></svg>`,w={BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DEBUG:"debug",DISABLE_TRACKING:"disable-tracking",DISABLE_COOKIES:"disable-cookies",DISABLE_PSEUDO_ENDED:"disable-pseudo-ended",DRM_TOKEN:"drm-token",PLAYBACK_TOKEN:"playback-token",ENV_KEY:"env-key",MAX_RESOLUTION:"max-resolution",MIN_RESOLUTION:"min-resolution",RENDITION_ORDER:"rendition-order",PROGRAM_START_TIME:"program-start-time",PROGRAM_END_TIME:"program-end-time",ASSET_START_TIME:"asset-start-time",ASSET_END_TIME:"asset-end-time",METADATA_URL:"metadata-url",PLAYBACK_ID:"playback-id",PLAYER_SOFTWARE_NAME:"player-software-name",PLAYER_SOFTWARE_VERSION:"player-software-version",PLAYER_INIT_TIME:"player-init-time",PREFER_CMCD:"prefer-cmcd",PREFER_PLAYBACK:"prefer-playback",START_TIME:"start-time",STREAM_TYPE:"stream-type",TARGET_LIVE_WINDOW:"target-live-window",LIVE_EDGE_OFFSET:"live-edge-offset",TYPE:"type",LOGO:"logo"},Dk=Object.values(w),Wg=xk(),qg="mux-video",Ri,na,ol,aa,ll,dl,ul,cl,hl,oa,la,fl,Ck=class extends Mo{constructor(){super(),oi(this,la),oi(this,Ri),oi(this,na),oi(this,ol),oi(this,aa,{}),oi(this,ll,{}),oi(this,dl),oi(this,ul),oi(this,cl),oi(this,hl),oi(this,oa,""),Xt(this,ol,jf()),this.nativeEl.addEventListener("muxmetadata",e=>{var t;let s=ak(this.nativeEl),r=(t=this.metadata)!=null?t:{};this.metadata={...s,...r},s?.["com.mux.video.branding"]==="mux-free-plan"&&(Xt(this,oa,"default"),this.updateLogo())})}static get NAME(){return qg}static get VERSION(){return Wg}static get observedAttributes(){var e;return[...Dk,...(e=Mo.observedAttributes)!=null?e:[]]}static getLogoHTML(e){return!e||e==="false"?"":e==="default"?kk:`<img part="logo" src="${e}" />`}static getTemplateHTML(e={}){var t;return`
      ${Mo.getTemplateHTML(e)}
      <style>
        :host {
          position: relative;
        }
        slot[name="logo"] {
          display: flex;
          justify-content: end;
          position: absolute;
          top: 1rem;
          right: 1rem;
          opacity: 0;
          transition: opacity 0.25s ease-in-out;
          z-index: 1;
        }
        slot[name="logo"]:has([part="logo"]) {
          opacity: 1;
        }
        slot[name="logo"] [part="logo"] {
          width: 5rem;
          pointer-events: none;
          user-select: none;
        }
      </style>
      <slot name="logo">
        ${this.getLogoHTML((t=e[w.LOGO])!=null?t:"")}
      </slot>
    `}get preferCmcd(){var e;return(e=this.getAttribute(w.PREFER_CMCD))!=null?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?xd.includes(e)?this.setAttribute(w.PREFER_CMCD,e):console.warn(`Invalid value for preferCmcd. Must be one of ${xd.join()}`):this.removeAttribute(w.PREFER_CMCD))}get playerInitTime(){return this.hasAttribute(w.PLAYER_INIT_TIME)?+this.getAttribute(w.PLAYER_INIT_TIME):gt(this,ol)}set playerInitTime(e){e!=this.playerInitTime&&(e==null?this.removeAttribute(w.PLAYER_INIT_TIME):this.setAttribute(w.PLAYER_INIT_TIME,`${+e}`))}get playerSoftwareName(){var e;return(e=gt(this,cl))!=null?e:qg}set playerSoftwareName(e){Xt(this,cl,e)}get playerSoftwareVersion(){var e;return(e=gt(this,ul))!=null?e:Wg}set playerSoftwareVersion(e){Xt(this,ul,e)}get _hls(){var e;return(e=gt(this,Ri))==null?void 0:e.engine}get mux(){var e;return(e=this.nativeEl)==null?void 0:e.mux}get error(){var e;return(e=by(this.nativeEl))!=null?e:null}get errorTranslator(){return gt(this,hl)}set errorTranslator(e){Xt(this,hl,e)}get src(){return this.getAttribute("src")}set src(e){e!==this.src&&(e==null?this.removeAttribute("src"):this.setAttribute("src",e))}get type(){var e;return(e=this.getAttribute(w.TYPE))!=null?e:void 0}set type(e){e!==this.type&&(e?this.setAttribute(w.TYPE,e):this.removeAttribute(w.TYPE))}get preload(){let e=this.getAttribute("preload");return e===""?"auto":["none","metadata","auto"].includes(e)?e:super.preload}set preload(e){e!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(e)?this.setAttribute("preload",e):this.removeAttribute("preload"))}get debug(){return this.getAttribute(w.DEBUG)!=null}set debug(e){e!==this.debug&&(e?this.setAttribute(w.DEBUG,""):this.removeAttribute(w.DEBUG))}get disableTracking(){return this.hasAttribute(w.DISABLE_TRACKING)}set disableTracking(e){e!==this.disableTracking&&this.toggleAttribute(w.DISABLE_TRACKING,!!e)}get disableCookies(){return this.hasAttribute(w.DISABLE_COOKIES)}set disableCookies(e){e!==this.disableCookies&&(e?this.setAttribute(w.DISABLE_COOKIES,""):this.removeAttribute(w.DISABLE_COOKIES))}get disablePseudoEnded(){return this.hasAttribute(w.DISABLE_PSEUDO_ENDED)}set disablePseudoEnded(e){e!==this.disablePseudoEnded&&(e?this.setAttribute(w.DISABLE_PSEUDO_ENDED,""):this.removeAttribute(w.DISABLE_PSEUDO_ENDED))}get startTime(){let e=this.getAttribute(w.START_TIME);if(e==null)return;let t=+e;return Number.isNaN(t)?void 0:t}set startTime(e){e!==this.startTime&&(e==null?this.removeAttribute(w.START_TIME):this.setAttribute(w.START_TIME,`${e}`))}get playbackId(){var e;return this.hasAttribute(w.PLAYBACK_ID)?this.getAttribute(w.PLAYBACK_ID):(e=zf(this.src))!=null?e:void 0}set playbackId(e){e!==this.playbackId&&(e?this.setAttribute(w.PLAYBACK_ID,e):this.removeAttribute(w.PLAYBACK_ID))}get maxResolution(){var e;return(e=this.getAttribute(w.MAX_RESOLUTION))!=null?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(w.MAX_RESOLUTION,e):this.removeAttribute(w.MAX_RESOLUTION))}get minResolution(){var e;return(e=this.getAttribute(w.MIN_RESOLUTION))!=null?e:void 0}set minResolution(e){e!==this.minResolution&&(e?this.setAttribute(w.MIN_RESOLUTION,e):this.removeAttribute(w.MIN_RESOLUTION))}get renditionOrder(){var e;return(e=this.getAttribute(w.RENDITION_ORDER))!=null?e:void 0}set renditionOrder(e){e!==this.renditionOrder&&(e?this.setAttribute(w.RENDITION_ORDER,e):this.removeAttribute(w.RENDITION_ORDER))}get programStartTime(){let e=this.getAttribute(w.PROGRAM_START_TIME);if(e==null)return;let t=+e;return Number.isNaN(t)?void 0:t}set programStartTime(e){e==null?this.removeAttribute(w.PROGRAM_START_TIME):this.setAttribute(w.PROGRAM_START_TIME,`${e}`)}get programEndTime(){let e=this.getAttribute(w.PROGRAM_END_TIME);if(e==null)return;let t=+e;return Number.isNaN(t)?void 0:t}set programEndTime(e){e==null?this.removeAttribute(w.PROGRAM_END_TIME):this.setAttribute(w.PROGRAM_END_TIME,`${e}`)}get assetStartTime(){let e=this.getAttribute(w.ASSET_START_TIME);if(e==null)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetStartTime(e){e==null?this.removeAttribute(w.ASSET_START_TIME):this.setAttribute(w.ASSET_START_TIME,`${e}`)}get assetEndTime(){let e=this.getAttribute(w.ASSET_END_TIME);if(e==null)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetEndTime(e){e==null?this.removeAttribute(w.ASSET_END_TIME):this.setAttribute(w.ASSET_END_TIME,`${e}`)}get customDomain(){var e;return(e=this.getAttribute(w.CUSTOM_DOMAIN))!=null?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(w.CUSTOM_DOMAIN,e):this.removeAttribute(w.CUSTOM_DOMAIN))}get drmToken(){var e;return(e=this.getAttribute(w.DRM_TOKEN))!=null?e:void 0}set drmToken(e){e!==this.drmToken&&(e?this.setAttribute(w.DRM_TOKEN,e):this.removeAttribute(w.DRM_TOKEN))}get playbackToken(){var e,t,s,r;if(this.hasAttribute(w.PLAYBACK_TOKEN))return(e=this.getAttribute(w.PLAYBACK_TOKEN))!=null?e:void 0;if(this.hasAttribute(w.PLAYBACK_ID)){let[,n]=Kf((t=this.playbackId)!=null?t:"");return(s=new URLSearchParams(n).get("token"))!=null?s:void 0}if(this.src)return(r=new URLSearchParams(this.src).get("token"))!=null?r:void 0}set playbackToken(e){e!==this.playbackToken&&(e?this.setAttribute(w.PLAYBACK_TOKEN,e):this.removeAttribute(w.PLAYBACK_TOKEN))}get tokens(){let e=this.getAttribute(w.PLAYBACK_TOKEN),t=this.getAttribute(w.DRM_TOKEN);return{...gt(this,ll),...e!=null?{playback:e}:{},...t!=null?{drm:t}:{}}}set tokens(e){Xt(this,ll,e??{})}get ended(){return Sy(this.nativeEl,this._hls)}get envKey(){var e;return(e=this.getAttribute(w.ENV_KEY))!=null?e:void 0}set envKey(e){e!==this.envKey&&(e?this.setAttribute(w.ENV_KEY,e):this.removeAttribute(w.ENV_KEY))}get beaconCollectionDomain(){var e;return(e=this.getAttribute(w.BEACON_COLLECTION_DOMAIN))!=null?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(w.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(w.BEACON_COLLECTION_DOMAIN))}get streamType(){var e;return(e=this.getAttribute(w.STREAM_TYPE))!=null?e:Xc(this.nativeEl)}set streamType(e){e!==this.streamType&&(e?this.setAttribute(w.STREAM_TYPE,e):this.removeAttribute(w.STREAM_TYPE))}get targetLiveWindow(){return this.hasAttribute(w.TARGET_LIVE_WINDOW)?+this.getAttribute(w.TARGET_LIVE_WINDOW):ok(this.nativeEl)}set targetLiveWindow(e){e!=this.targetLiveWindow&&(e==null?this.removeAttribute(w.TARGET_LIVE_WINDOW):this.setAttribute(w.TARGET_LIVE_WINDOW,`${+e}`))}get liveEdgeStart(){var e,t;if(this.hasAttribute(w.LIVE_EDGE_OFFSET)){let{liveEdgeOffset:s}=this,r=(e=this.nativeEl.seekable.end(0))!=null?e:0,n=(t=this.nativeEl.seekable.start(0))!=null?t:0;return Math.max(n,r-s)}return lk(this.nativeEl)}get liveEdgeOffset(){if(this.hasAttribute(w.LIVE_EDGE_OFFSET))return+this.getAttribute(w.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){e!=this.liveEdgeOffset&&(e==null?this.removeAttribute(w.LIVE_EDGE_OFFSET):this.setAttribute(w.LIVE_EDGE_OFFSET,`${+e}`))}get seekable(){return Qf(this.nativeEl)}async addCuePoints(e){return fy(this.nativeEl,e)}get activeCuePoint(){return my(this.nativeEl)}get cuePoints(){return wx(this.nativeEl)}async addChapters(e){return gy(this.nativeEl,e)}get activeChapter(){return vy(this.nativeEl)}get chapters(){return Px(this.nativeEl)}getStartDate(){return Nx(this.nativeEl,this._hls)}get currentPdt(){return Ux(this.nativeEl,this._hls)}get preferPlayback(){let e=this.getAttribute(w.PREFER_PLAYBACK);if(e===Vi.MSE||e===Vi.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===Vi.MSE||e===Vi.NATIVE?this.setAttribute(w.PREFER_PLAYBACK,e):this.removeAttribute(w.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(e=>e.startsWith("metadata-")&&![w.METADATA_URL].includes(e)).reduce((e,t)=>{let s=this.getAttribute(t);return s!=null&&(e[t.replace(/^metadata-/,"").replace(/-/g,"_")]=s),e},{}),...gt(this,aa)}}set metadata(e){Xt(this,aa,e??{}),this.mux&&this.mux.emit("hb",gt(this,aa))}get _hlsConfig(){return gt(this,dl)}set _hlsConfig(e){Xt(this,dl,e)}get logo(){var e;return(e=this.getAttribute(w.LOGO))!=null?e:gt(this,oa)}set logo(e){e?this.setAttribute(w.LOGO,e):this.removeAttribute(w.LOGO)}load(){Xt(this,Ri,ck(this,this.nativeEl,gt(this,Ri)))}unload(){Iy(this.nativeEl,gt(this,Ri),this),Xt(this,Ri,void 0)}attributeChangedCallback(e,t,s){var r,n;switch(Mo.observedAttributes.includes(e)&&!["src","autoplay","preload"].includes(e)&&super.attributeChangedCallback(e,t,s),e){case w.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=s??void 0;break;case w.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=s??void 0;break;case"src":{let a=!!t,o=!!s;!a&&o?nc(this,la,fl).call(this):a&&!o?this.unload():a&&o&&(this.unload(),nc(this,la,fl).call(this));break}case"autoplay":if(s===t)break;(r=gt(this,Ri))==null||r.setAutoplay(this.autoplay);break;case"preload":if(s===t)break;(n=gt(this,Ri))==null||n.setPreload(s);break;case w.PLAYBACK_ID:this.src=Qc(this);break;case w.DEBUG:{let a=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=a);break}case w.METADATA_URL:s&&fetch(s).then(a=>a.json()).then(a=>this.metadata=a).catch(()=>console.error(`Unable to load or parse metadata JSON from metadata-url ${s}!`));break;case w.STREAM_TYPE:(s==null||s!==t)&&this.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}));break;case w.TARGET_LIVE_WINDOW:(s==null||s!==t)&&this.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0,detail:this.targetLiveWindow}));break;case w.LOGO:(s==null||s!==t)&&this.updateLogo();break}}updateLogo(){if(!this.shadowRoot)return;let e=this.shadowRoot.querySelector('slot[name="logo"]');if(!e)return;let t=this.constructor.getLogoHTML(gt(this,oa)||this.logo);e.innerHTML=t}connectedCallback(){var e;(e=super.connectedCallback)==null||e.call(this),this.nativeEl&&this.src&&!gt(this,Ri)&&nc(this,la,fl).call(this)}disconnectedCallback(){this.unload()}handleEvent(e){e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{composed:!0,detail:e.detail}))}};Ri=new WeakMap,na=new WeakMap,ol=new WeakMap,aa=new WeakMap,ll=new WeakMap,dl=new WeakMap,ul=new WeakMap,cl=new WeakMap,hl=new WeakMap,oa=new WeakMap,la=new WeakSet,fl=async function(){gt(this,na)||(await Xt(this,na,Promise.resolve()),Xt(this,na,null),this.load())};const Er=new WeakMap;class ac extends Error{}class wk extends Error{}const Mk=["application/x-mpegURL","application/vnd.apple.mpegurl","audio/mpegurl"],Pk=globalThis.WeakRef?class extends Set{add(i){super.add(new WeakRef(i))}forEach(i){super.forEach(e=>{const t=e.deref();t&&i(t)})}}:Set;function Ok(i){globalThis.chrome?.cast?.isAvailable?globalThis.cast?.framework?i():customElements.whenDefined("google-cast-button").then(i):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(i)}}function Nk(){return globalThis.chrome}function Uk(){const i="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";if(globalThis.chrome?.cast||document.querySelector(`script[src="${i}"]`))return;const e=document.createElement("script");e.src=i,document.head.append(e)}function Us(){return globalThis.cast?.framework?.CastContext.getInstance()}function Jf(){return Us()?.getCurrentSession()}function em(){return Jf()?.getSessionObj().media[0]}function $k(i){return new Promise((e,t)=>{em().editTracksInfo(i,e,t)})}function Fk(i){return new Promise((e,t)=>{em().getStatus(i,e,t)})}function Yg(i){return Us().setOptions({...Oy(),...i})}function Oy(){return{receiverApplicationId:"CC1AD845",autoJoinPolicy:"origin_scoped",androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0}}function Bk(i){if(!i)return;const e=/\.([a-zA-Z0-9]+)(?:\?.*)?$/,t=i.match(e);return t?t[1]:null}function Hk(i){const e=i.split(`
`),t=[];for(let s=0;s<e.length;s++)if(e[s].trim().startsWith("#EXT-X-STREAM-INF")){const n=e[s+1]?e[s+1].trim():"";n&&!n.startsWith("#")&&t.push(n)}return t}function Gk(i){return i.split(`
`).find(s=>!s.trim().startsWith("#")&&s.trim()!=="")}async function Kk(i){try{const t=(await fetch(i,{method:"HEAD"})).headers.get("Content-Type");return Mk.some(s=>t===s)}catch(e){return console.error("Error while trying to get the Content-Type of the manifest",e),!1}}async function Vk(i){try{const e=await(await fetch(i)).text();let t=e;const s=Hk(e);if(s.length>0){const a=new URL(s[0],i).toString();t=await(await fetch(a)).text()}const r=Gk(t);return Bk(r)}catch(e){console.error("Error while trying to parse the manifest playlist",e);return}}const ml=new Pk,ys=new WeakSet;let ot;Ok(()=>{if(!globalThis.chrome?.cast?.isAvailable){console.debug("chrome.cast.isAvailable",globalThis.chrome?.cast?.isAvailable);return}ot||(ot=cast.framework,Us().addEventListener(ot.CastContextEventType.CAST_STATE_CHANGED,i=>{ml.forEach(e=>Er.get(e).onCastStateChanged?.(i))}),Us().addEventListener(ot.CastContextEventType.SESSION_STATE_CHANGED,i=>{ml.forEach(e=>Er.get(e).onSessionStateChanged?.(i))}),ml.forEach(i=>Er.get(i).init?.()))});let jg=0;class Wk extends EventTarget{#e;#s;#i;#r;#t="disconnected";#a=!1;#n=new Set;#l=new WeakMap;constructor(e){super(),this.#e=e,ml.add(this),Er.set(this,{init:()=>this.#h(),onCastStateChanged:()=>this.#u(),onSessionStateChanged:()=>this.#m(),getCastPlayer:()=>this.#o}),this.#h()}get#o(){if(ys.has(this.#e))return this.#i}get state(){return this.#t}async watchAvailability(e){if(this.#e.disableRemotePlayback)throw new ac("disableRemotePlayback attribute is present.");return this.#l.set(e,++jg),this.#n.add(e),queueMicrotask(()=>e(this.#c())),jg}async cancelWatchAvailability(e){if(this.#e.disableRemotePlayback)throw new ac("disableRemotePlayback attribute is present.");e?this.#n.delete(e):this.#n.clear()}async prompt(){if(this.#e.disableRemotePlayback)throw new ac("disableRemotePlayback attribute is present.");if(!globalThis.chrome?.cast?.isAvailable)throw new wk("The RemotePlayback API is disabled on this platform.");const e=ys.has(this.#e);ys.add(this.#e),Yg(this.#e.castOptions),Object.entries(this.#r).forEach(([t,s])=>{this.#i.controller.addEventListener(t,s)});try{await Us().requestSession()}catch(t){if(e||ys.delete(this.#e),t==="cancel")return;throw new Error(t)}Er.get(this.#e)?.loadOnPrompt?.()}#d(){ys.has(this.#e)&&(Object.entries(this.#r).forEach(([e,t])=>{this.#i.controller.removeEventListener(e,t)}),ys.delete(this.#e),this.#e.muted=this.#i.isMuted,this.#e.currentTime=this.#i.savedPlayerState.currentTime,this.#i.savedPlayerState.isPaused===!1&&this.#e.play())}#c(){const e=Us()?.getCastState();return e&&e!=="NO_DEVICES_AVAILABLE"}#u(){const e=Us().getCastState();if(ys.has(this.#e)&&e==="CONNECTING"&&(this.#t="connecting",this.dispatchEvent(new Event("connecting"))),!this.#a&&e?.includes("CONNECT")){this.#a=!0;for(let t of this.#n)t(!0)}else if(this.#a&&(!e||e==="NO_DEVICES_AVAILABLE")){this.#a=!1;for(let t of this.#n)t(!1)}}async#m(){const{SESSION_RESUMED:e}=ot.SessionState;if(Us().getSessionState()===e&&this.#e.castSrc===em()?.media.contentId){ys.add(this.#e),Object.entries(this.#r).forEach(([t,s])=>{this.#i.controller.addEventListener(t,s)});try{await Fk(new chrome.cast.media.GetStatusRequest)}catch(t){console.error(t)}this.#r[ot.RemotePlayerEventType.IS_PAUSED_CHANGED](),this.#r[ot.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}}#h(){!ot||this.#s||(this.#s=!0,Yg(this.#e.castOptions),this.#e.textTracks.addEventListener("change",()=>this.#f()),this.#u(),this.#i=new ot.RemotePlayer,new ot.RemotePlayerController(this.#i),this.#r={[ot.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:e})=>{e===!0?(this.#t="connected",this.dispatchEvent(new Event("connect"))):(this.#d(),this.#t="disconnected",this.dispatchEvent(new Event("disconnect")))},[ot.RemotePlayerEventType.DURATION_CHANGED]:()=>{this.#e.dispatchEvent(new Event("durationchange"))},[ot.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{this.#e.dispatchEvent(new Event("volumechange"))},[ot.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{this.#e.dispatchEvent(new Event("volumechange"))},[ot.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{this.#o?.isMediaLoaded&&this.#e.dispatchEvent(new Event("timeupdate"))},[ot.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{this.#e.dispatchEvent(new Event("resize"))},[ot.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{this.#e.dispatchEvent(new Event(this.paused?"pause":"play"))},[ot.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{this.#o?.playerState!==chrome.cast.media.PlayerState.PAUSED&&this.#e.dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[this.#o?.playerState]))},[ot.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{this.#o?.isMediaLoaded&&(await Promise.resolve(),this.#p())}})}#p(){this.#f()}async#f(){if(!this.#o)return;const t=(this.#i.mediaInfo?.tracks??[]).filter(({type:c})=>c===chrome.cast.media.TrackType.TEXT),s=[...this.#e.textTracks].filter(({kind:c})=>c==="subtitles"||c==="captions"),r=t.map(({language:c,name:h,trackId:f})=>{const{mode:m}=s.find(g=>g.language===c&&g.label===h)??{};return m?{mode:m,trackId:f}:!1}).filter(Boolean),a=r.filter(({mode:c})=>c!=="showing").map(({trackId:c})=>c),o=r.find(({mode:c})=>c==="showing"),l=Jf()?.getSessionObj().media[0]?.activeTrackIds??[];let d=l;if(l.length&&(d=d.filter(c=>!a.includes(c))),o?.trackId&&(d=[...d,o.trackId]),d=[...new Set(d)],!((c,h)=>c.length===h.length&&c.every(f=>h.includes(f)))(l,d))try{const c=new chrome.cast.media.EditTracksInfoRequest(d);await $k(c)}catch(c){console.error(c)}}}const qk=i=>class extends i{static observedAttributes=[...i.observedAttributes??[],"cast-src","cast-content-type","cast-stream-type","cast-receiver"];#e={paused:!1};#s=Oy();#i;#r;get remote(){return this.#r?this.#r:Nk()?(this.disableRemotePlayback||Uk(),Er.set(this,{loadOnPrompt:()=>this.#a()}),this.#r=new Wk(this)):super.remote}get#t(){return Er.get(this.remote)?.getCastPlayer?.()}attributeChangedCallback(t,s,r){if(super.attributeChangedCallback(t,s,r),t==="cast-receiver"&&r){this.#s.receiverApplicationId=r;return}if(this.#t)switch(t){case"cast-stream-type":case"cast-src":this.load();break}}async#a(){this.#e.paused=super.paused,super.pause(),this.muted=super.muted;try{await this.load()}catch(t){console.error(t)}}async load(){if(!this.#t)return super.load();const t=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType);t.customData=this.castCustomData;const s=[...this.querySelectorAll("track")].filter(({kind:o,src:l})=>l&&(o==="subtitles"||o==="captions")),r=[];let n=0;if(s.length&&(t.tracks=s.map(o=>{const l=++n;r.length===0&&o.track.mode==="showing"&&r.push(l);const d=new chrome.cast.media.Track(l,chrome.cast.media.TrackType.TEXT);return d.trackContentId=o.src,d.trackContentType="text/vtt",d.subtype=o.kind==="captions"?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,d.name=o.label,d.language=o.srclang,d})),this.castStreamType==="live"?t.streamType=chrome.cast.media.StreamType.LIVE:t.streamType=chrome.cast.media.StreamType.BUFFERED,t.metadata=new chrome.cast.media.GenericMediaMetadata,t.metadata.title=this.title,t.metadata.images=[{url:this.poster}],Kk(this.castSrc)){const o=await Vk(this.castSrc);o?.includes("m4s")||o?.includes("mp4")?(t.hlsSegmentFormat=chrome.cast.media.HlsSegmentFormat.FMP4,t.hlsVideoSegmentFormat=chrome.cast.media.HlsVideoSegmentFormat.FMP4):o?.includes("ts")&&(t.hlsSegmentFormat=chrome.cast.media.HlsSegmentFormat.TS,t.hlsVideoSegmentFormat=chrome.cast.media.HlsVideoSegmentFormat.TS)}const a=new chrome.cast.media.LoadRequest(t);a.currentTime=super.currentTime??0,a.autoplay=!this.#e.paused,a.activeTrackIds=r,await Jf()?.loadMedia(a),this.dispatchEvent(new Event("volumechange"))}play(){if(this.#t){this.#t.isPaused&&this.#t.controller?.playOrPause();return}return super.play()}pause(){if(this.#t){this.#t.isPaused||this.#t.controller?.playOrPause();return}super.pause()}get castOptions(){return this.#s}get castReceiver(){return this.getAttribute("cast-receiver")??void 0}set castReceiver(t){this.castReceiver!=t&&this.setAttribute("cast-receiver",`${t}`)}get castSrc(){return this.getAttribute("cast-src")??this.querySelector("source")?.src??this.currentSrc}set castSrc(t){this.castSrc!=t&&this.setAttribute("cast-src",`${t}`)}get castContentType(){return this.getAttribute("cast-content-type")??void 0}set castContentType(t){this.setAttribute("cast-content-type",`${t}`)}get castStreamType(){return this.getAttribute("cast-stream-type")??this.streamType??void 0}set castStreamType(t){this.setAttribute("cast-stream-type",`${t}`)}get castCustomData(){return this.#i}set castCustomData(t){const s=typeof t;if(!["object","undefined"].includes(s)){console.error(`castCustomData must be nullish or an object but value was of type ${s}`);return}this.#i=t}get readyState(){if(this.#t)switch(this.#t.playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return this.#t?this.#t.isPaused:super.paused}get muted(){return this.#t?this.#t?.isMuted:super.muted}set muted(t){if(this.#t){(t&&!this.#t.isMuted||!t&&this.#t.isMuted)&&this.#t.controller?.muteOrUnmute();return}super.muted=t}get volume(){return this.#t?this.#t?.volumeLevel??1:super.volume}set volume(t){if(this.#t){this.#t.volumeLevel=+t,this.#t.controller?.setVolumeLevel();return}super.volume=t}get duration(){return this.#t&&this.#t?.isMediaLoaded?this.#t?.duration??NaN:super.duration}get currentTime(){return this.#t&&this.#t?.isMediaLoaded?this.#t?.currentTime??0:super.currentTime}set currentTime(t){if(this.#t){this.#t.currentTime=t,this.#t.controller?.seek();return}super.currentTime=t}};class lu extends Event{track;constructor(e,t){super(e),this.track=t.track}}const eh=new WeakMap;function Q(i){return eh.get(i)??Yk(i,{})}function Yk(i,e){let t=eh.get(i);return t||eh.set(i,t={}),Object.assign(t,e)}function th(i,e){const t=i.videoTracks;Q(e).media=i,Q(e).renditionSet||(Q(e).renditionSet=new Set);const s=Q(t).trackSet;s.add(e);const r=s.size-1;r in sh.prototype||Object.defineProperty(sh.prototype,r,{get(){return[...Q(this).trackSet][r]}}),queueMicrotask(()=>{t.dispatchEvent(new lu("addtrack",{track:e}))})}function ih(i){const e=Q(i).media?.videoTracks;if(!e)return;Q(e).trackSet.delete(i),queueMicrotask(()=>{e.dispatchEvent(new lu("removetrack",{track:i}))})}function jk(i){const e=Q(i).media.videoTracks??[];let t=!1;for(const s of e)s!==i&&(s.selected=!1,t=!0);if(t){if(Q(e).changeRequested)return;Q(e).changeRequested=!0,queueMicrotask(()=>{delete Q(e).changeRequested,e.dispatchEvent(new Event("change"))})}}class sh extends EventTarget{#e;#s;#i;constructor(){super(),Q(this).trackSet=new Set}get#r(){return Q(this).trackSet}[Symbol.iterator](){return this.#r.values()}get length(){return this.#r.size}getTrackById(e){return[...this.#r].find(t=>t.id===e)??null}get selectedIndex(){return[...this.#r].findIndex(e=>e.selected)}get onaddtrack(){return this.#e}set onaddtrack(e){this.#e&&(this.removeEventListener("addtrack",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#s}set onremovetrack(e){this.#s&&(this.removeEventListener("removetrack",this.#s),this.#s=void 0),typeof e=="function"&&(this.#s=e,this.addEventListener("removetrack",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class du extends Event{rendition;constructor(e,t){super(e),this.rendition=t.rendition}}function zk(i,e){const t=Q(i).media.videoRenditions;Q(e).media=Q(i).media,Q(e).track=i;const s=Q(i).renditionSet;s.add(e);const r=s.size-1;r in rh.prototype||Object.defineProperty(rh.prototype,r,{get(){return Kr(this)[r]}}),queueMicrotask(()=>{i.selected&&t.dispatchEvent(new du("addrendition",{rendition:e}))})}function Qk(i){const e=Q(i).media.videoRenditions,t=Q(i).track;Q(t).renditionSet.delete(i),queueMicrotask(()=>{Q(i).track.selected&&e.dispatchEvent(new du("removerendition",{rendition:i}))})}function Xk(i){const e=Q(i).media.videoRenditions;!e||Q(e).changeRequested||(Q(e).changeRequested=!0,queueMicrotask(()=>{delete Q(e).changeRequested,Q(i).track.selected&&e.dispatchEvent(new Event("change"))}))}function Kr(i){return[...Q(i).media.videoTracks].filter(t=>t.selected).flatMap(t=>[...Q(t).renditionSet])}class rh extends EventTarget{#e;#s;#i;[Symbol.iterator](){return Kr(this).values()}get length(){return Kr(this).length}getRenditionById(e){return Kr(this).find(t=>`${t.id}`==`${e}`)??null}get selectedIndex(){return Kr(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[t,s]of Kr(this).entries())s.selected=t===e}get onaddrendition(){return this.#e}set onaddrendition(e){this.#e&&(this.removeEventListener("addrendition",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#s}set onremoverendition(e){this.#s&&(this.removeEventListener("removerendition",this.#s),this.#s=void 0),typeof e=="function"&&(this.#s=e,this.addEventListener("removerendition",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class Zk{src;id;width;height;bitrate;frameRate;codec;#e=!1;get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,Xk(this))}}class Ny{id;kind;label="";language="";sourceBuffer;#e=!1;addRendition(e,t,s,r,n,a){const o=new Zk;return o.src=e,o.width=t,o.height=s,o.frameRate=a,o.bitrate=n,o.codec=r,zk(this,o),o}removeRendition(e){Qk(e)}get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,e===!0&&jk(this))}}function Jk(i,e){const t=Q(i).media.audioRenditions;Q(e).media=Q(i).media,Q(e).track=i;const s=Q(i).renditionSet;s.add(e);const r=s.size-1;r in nh.prototype||Object.defineProperty(nh.prototype,r,{get(){return Vr(this)[r]}}),queueMicrotask(()=>{i.enabled&&t.dispatchEvent(new du("addrendition",{rendition:e}))})}function eD(i){const e=Q(i).media.audioRenditions,t=Q(i).track;Q(t).renditionSet.delete(i),queueMicrotask(()=>{Q(i).track.enabled&&e.dispatchEvent(new du("removerendition",{rendition:i}))})}function tD(i){const e=Q(i).media.audioRenditions;!e||Q(e).changeRequested||(Q(e).changeRequested=!0,queueMicrotask(()=>{delete Q(e).changeRequested,Q(i).track.enabled&&e.dispatchEvent(new Event("change"))}))}function Vr(i){return[...Q(i).media.audioTracks].filter(t=>t.enabled).flatMap(t=>[...Q(t).renditionSet])}class nh extends EventTarget{#e;#s;#i;[Symbol.iterator](){return Vr(this).values()}get length(){return Vr(this).length}getRenditionById(e){return Vr(this).find(t=>`${t.id}`==`${e}`)??null}get selectedIndex(){return Vr(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[t,s]of Vr(this).entries())s.selected=t===e}get onaddrendition(){return this.#e}set onaddrendition(e){this.#e&&(this.removeEventListener("addrendition",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#s}set onremoverendition(e){this.#s&&(this.removeEventListener("removerendition",this.#s),this.#s=void 0),typeof e=="function"&&(this.#s=e,this.addEventListener("removerendition",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class iD{src;id;bitrate;codec;#e=!1;get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,tD(this))}}function ah(i,e){const t=i.audioTracks;Q(e).media=i,Q(e).renditionSet||(Q(e).renditionSet=new Set);const s=Q(t).trackSet;s.add(e);const r=s.size-1;r in lh.prototype||Object.defineProperty(lh.prototype,r,{get(){return[...Q(this).trackSet][r]}}),queueMicrotask(()=>{t.dispatchEvent(new lu("addtrack",{track:e}))})}function oh(i){const e=Q(i).media?.audioTracks;if(!e)return;Q(e).trackSet.delete(i),queueMicrotask(()=>{e.dispatchEvent(new lu("removetrack",{track:i}))})}function sD(i){const e=Q(i).media.audioTracks;!e||Q(e).changeRequested||(Q(e).changeRequested=!0,queueMicrotask(()=>{delete Q(e).changeRequested,e.dispatchEvent(new Event("change"))}))}class lh extends EventTarget{#e;#s;#i;constructor(){super(),Q(this).trackSet=new Set}get#r(){return Q(this).trackSet}[Symbol.iterator](){return this.#r.values()}get length(){return this.#r.size}getTrackById(e){return[...this.#r].find(t=>t.id===e)??null}get onaddtrack(){return this.#e}set onaddtrack(e){this.#e&&(this.removeEventListener("addtrack",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#s}set onremovetrack(e){this.#s&&(this.removeEventListener("removetrack",this.#s),this.#s=void 0),typeof e=="function"&&(this.#s=e,this.addEventListener("removetrack",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class Uy{id;kind;label="";language="";sourceBuffer;#e=!1;addRendition(e,t,s){const r=new iD;return r.src=e,r.codec=t,r.bitrate=s,Jk(this,r),r}removeRendition(e){eD(e)}get enabled(){return this.#e}set enabled(e){this.#e!==e&&(this.#e=e,sD(this))}}const zg=Dd(globalThis.HTMLMediaElement,"video"),Qg=Dd(globalThis.HTMLMediaElement,"audio");function rD(i){if(!i?.prototype)return i;const e=Dd(i,"video");(!e||`${e}`.includes("[native code]"))&&Object.defineProperty(i.prototype,"videoTracks",{get(){return nD(this)}});const t=Dd(i,"audio");(!t||`${t}`.includes("[native code]"))&&Object.defineProperty(i.prototype,"audioTracks",{get(){return aD(this)}}),"addVideoTrack"in i.prototype||(i.prototype.addVideoTrack=function(n,a="",o=""){const l=new Ny;return l.kind=n,l.label=a,l.language=o,th(this,l),l}),"removeVideoTrack"in i.prototype||(i.prototype.removeVideoTrack=ih),"addAudioTrack"in i.prototype||(i.prototype.addAudioTrack=function(n,a="",o=""){const l=new Uy;return l.kind=n,l.label=a,l.language=o,ah(this,l),l}),"removeAudioTrack"in i.prototype||(i.prototype.removeAudioTrack=oh),"videoRenditions"in i.prototype||Object.defineProperty(i.prototype,"videoRenditions",{get(){return s(this)}});const s=n=>{let a=Q(n).videoRenditions;return a||(a=new rh,Q(a).media=n,Q(n).videoRenditions=a),a};"audioRenditions"in i.prototype||Object.defineProperty(i.prototype,"audioRenditions",{get(){return r(this)}});const r=n=>{let a=Q(n).audioRenditions;return a||(a=new nh,Q(a).media=n,Q(n).audioRenditions=a),a};return i}function Dd(i,e){if(i?.prototype)return Object.getOwnPropertyDescriptor(i.prototype,`${e}Tracks`)?.get}function nD(i){let e=Q(i).videoTracks;if(!e&&(e=new sh,Q(i).videoTracks=e,zg)){const t=zg.call(i.nativeEl??i);for(const s of t)th(i,s);t.addEventListener("change",()=>{e.dispatchEvent(new Event("change"))}),t.addEventListener("addtrack",s=>{if([...e].some(r=>r instanceof Ny)){for(const r of t)ih(r);return}th(i,s.track)}),t.addEventListener("removetrack",s=>{ih(s.track)})}return e}function aD(i){let e=Q(i).audioTracks;if(!e&&(e=new lh,Q(i).audioTracks=e,Qg)){const t=Qg.call(i.nativeEl??i);for(const s of t)ah(i,s);t.addEventListener("change",()=>{e.dispatchEvent(new Event("change"))}),t.addEventListener("addtrack",s=>{if([...e].some(r=>r instanceof Uy)){for(const r of t)oh(r);return}ah(i,s.track)}),t.addEventListener("removetrack",s=>{oh(s.track)})}return e}var $y=i=>{throw TypeError(i)},Fy=(i,e,t)=>e.has(i)||$y("Cannot "+t),oD=(i,e,t)=>(Fy(i,e,"read from private field"),t?t.call(i):e.get(i)),lD=(i,e,t)=>e.has(i)?$y("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),dD=(i,e,t,s)=>(Fy(i,e,"write to private field"),e.set(i,t),t),By=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};if(typeof DocumentFragment>"u"){class i extends By{}globalThis.DocumentFragment=i}var uD=class extends By{},cD={get(i){},define(i,e,t){},getName(i){return null},upgrade(i){},whenDefined(i){return Promise.resolve(uD)}},hD={customElements:cD},fD=typeof window>"u"||typeof globalThis.customElements>"u",oc=fD?hD:globalThis,pl,Xg=class extends qk(rD(Ck)){constructor(){super(...arguments),lD(this,pl)}get autoplay(){let i=this.getAttribute("autoplay");return i===null?!1:i===""?!0:i}set autoplay(i){let e=this.autoplay;i!==e&&(i?this.setAttribute("autoplay",typeof i=="string"?i:""):this.removeAttribute("autoplay"))}get muxCastCustomData(){return{mux:{playbackId:this.playbackId,minResolution:this.minResolution,maxResolution:this.maxResolution,renditionOrder:this.renditionOrder,customDomain:this.customDomain,tokens:{drm:this.drmToken},envKey:this.envKey,metadata:this.metadata,disableCookies:this.disableCookies,disableTracking:this.disableTracking,beaconCollectionDomain:this.beaconCollectionDomain,startTime:this.startTime,preferCmcd:this.preferCmcd}}}get castCustomData(){var i;return(i=oD(this,pl))!=null?i:this.muxCastCustomData}set castCustomData(i){dD(this,pl,i)}};pl=new WeakMap;oc.customElements.get("mux-video")||(oc.customElements.define("mux-video",Xg),oc.MuxVideoElement=Xg);const X={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_TOGGLE_SUBTITLES_REQUEST:"mediatogglesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",MEDIA_RENDITION_REQUEST:"mediarenditionrequest",MEDIA_AUDIO_TRACK_REQUEST:"mediaaudiotrackrequest",MEDIA_SEEK_TO_LIVE_REQUEST:"mediaseektoliverequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},_e={MEDIA_CHROME_ATTRIBUTES:"mediachromeattributes",MEDIA_CONTROLLER:"mediacontroller"},Hy={MEDIA_AIRPLAY_UNAVAILABLE:"mediaAirplayUnavailable",MEDIA_AUDIO_TRACK_ENABLED:"mediaAudioTrackEnabled",MEDIA_AUDIO_TRACK_LIST:"mediaAudioTrackList",MEDIA_AUDIO_TRACK_UNAVAILABLE:"mediaAudioTrackUnavailable",MEDIA_BUFFERED:"mediaBuffered",MEDIA_CAST_UNAVAILABLE:"mediaCastUnavailable",MEDIA_CHAPTERS_CUES:"mediaChaptersCues",MEDIA_CURRENT_TIME:"mediaCurrentTime",MEDIA_DURATION:"mediaDuration",MEDIA_ENDED:"mediaEnded",MEDIA_ERROR:"mediaError",MEDIA_ERROR_CODE:"mediaErrorCode",MEDIA_ERROR_MESSAGE:"mediaErrorMessage",MEDIA_FULLSCREEN_UNAVAILABLE:"mediaFullscreenUnavailable",MEDIA_HAS_PLAYED:"mediaHasPlayed",MEDIA_HEIGHT:"mediaHeight",MEDIA_IS_AIRPLAYING:"mediaIsAirplaying",MEDIA_IS_CASTING:"mediaIsCasting",MEDIA_IS_FULLSCREEN:"mediaIsFullscreen",MEDIA_IS_PIP:"mediaIsPip",MEDIA_LOADING:"mediaLoading",MEDIA_MUTED:"mediaMuted",MEDIA_PAUSED:"mediaPaused",MEDIA_PIP_UNAVAILABLE:"mediaPipUnavailable",MEDIA_PLAYBACK_RATE:"mediaPlaybackRate",MEDIA_PREVIEW_CHAPTER:"mediaPreviewChapter",MEDIA_PREVIEW_COORDS:"mediaPreviewCoords",MEDIA_PREVIEW_IMAGE:"mediaPreviewImage",MEDIA_PREVIEW_TIME:"mediaPreviewTime",MEDIA_RENDITION_LIST:"mediaRenditionList",MEDIA_RENDITION_SELECTED:"mediaRenditionSelected",MEDIA_RENDITION_UNAVAILABLE:"mediaRenditionUnavailable",MEDIA_SEEKABLE:"mediaSeekable",MEDIA_STREAM_TYPE:"mediaStreamType",MEDIA_SUBTITLES_LIST:"mediaSubtitlesList",MEDIA_SUBTITLES_SHOWING:"mediaSubtitlesShowing",MEDIA_TARGET_LIVE_WINDOW:"mediaTargetLiveWindow",MEDIA_TIME_IS_LIVE:"mediaTimeIsLive",MEDIA_VOLUME:"mediaVolume",MEDIA_VOLUME_LEVEL:"mediaVolumeLevel",MEDIA_VOLUME_UNAVAILABLE:"mediaVolumeUnavailable",MEDIA_LANG:"mediaLang",MEDIA_WIDTH:"mediaWidth"},Gy=Object.entries(Hy),_=Gy.reduce((i,[e,t])=>(i[e]=t.toLowerCase(),i),{}),mD={USER_INACTIVE_CHANGE:"userinactivechange",BREAKPOINTS_CHANGE:"breakpointchange",BREAKPOINTS_COMPUTED:"breakpointscomputed"},fs=Gy.reduce((i,[e,t])=>(i[e]=t.toLowerCase(),i),{...mD});Object.entries(fs).reduce((i,[e,t])=>{const s=_[e];return s&&(i[t]=s),i},{userinactivechange:"userinactive"});const pD=Object.entries(_).reduce((i,[e,t])=>{const s=fs[e];return s&&(i[t]=s),i},{userinactive:"userinactivechange"}),Yi={SUBTITLES:"subtitles",CAPTIONS:"captions",CHAPTERS:"chapters",METADATA:"metadata"},bn={DISABLED:"disabled",SHOWING:"showing"},lc={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},Nt={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},os={LIVE:"live",ON_DEMAND:"on-demand",UNKNOWN:"unknown"},gD={FULLSCREEN:"fullscreen"};function vD(i){return i?.map(yD).join(" ")}function ED(i){return i?.split(/\s+/).map(TD)}function yD(i){if(i){const{id:e,width:t,height:s}=i;return[e,t,s].filter(r=>r!=null).join(":")}}function TD(i){if(i){const[e,t,s]=i.split(":");return{id:e,width:+t,height:+s}}}function bD(i){return i?.map(AD).join(" ")}function _D(i){return i?.split(/\s+/).map(SD)}function AD(i){if(i){const{id:e,kind:t,language:s,label:r}=i;return[e,t,s,r].filter(n=>n!=null).join(":")}}function SD(i){if(i){const[e,t,s,r]=i.split(":");return{id:e,kind:t,language:s,label:r}}}function ID(i){return i.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase())}function tm(i){return typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i)}function Ky(i){return typeof i!="string"?!1:!isNaN(i)&&!isNaN(parseFloat(i))}const Vy=i=>new Promise(e=>setTimeout(e,i)),Zg=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],LD=(i,e)=>{const t=i===1?Zg[e].singular:Zg[e].plural;return`${i} ${t}`},Da=i=>{if(!tm(i))return"";const e=Math.abs(i),t=e!==i,s=new Date(0,0,0,0,0,e,0);return`${[s.getHours(),s.getMinutes(),s.getSeconds()].map((o,l)=>o&&LD(o,l)).filter(o=>o).join(", ")}${t?" remaining":""}`};function Fs(i,e){let t=!1;i<0&&(t=!0,i=0-i),i=i<0?0:i;let s=Math.floor(i%60),r=Math.floor(i/60%60),n=Math.floor(i/3600);const a=Math.floor(e/60%60),o=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(n=r=s="0"),n=n>0||o>0?n+":":"",r=((n||a>=10)&&r<10?"0"+r:r)+":",s=s<10?"0"+s:s,(t?"-":"")+n+r+s}const RD={"Start airplay":"Start airplay","Stop airplay":"Stop airplay",Audio:"Audio",Captions:"Captions","Enable captions":"Enable captions","Disable captions":"Disable captions","Start casting":"Start casting","Stop casting":"Stop casting","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode",Mute:"Mute",Unmute:"Unmute","Enter picture in picture mode":"Enter picture in picture mode","Exit picture in picture mode":"Exit picture in picture mode",Play:"Play",Pause:"Pause","Playback rate":"Playback rate","Playback rate {playbackRate}":"Playback rate {playbackRate}",Quality:"Quality","Seek backward":"Seek backward","Seek forward":"Seek forward",Settings:"Settings",Auto:"Auto","audio player":"audio player","video player":"video player",volume:"volume",seek:"seek","closed captions":"closed captions","current playback rate":"current playback rate","playback time":"playback time","media loading":"media loading",settings:"settings","audio tracks":"audio tracks",quality:"quality",play:"play",pause:"pause",mute:"mute",unmute:"unmute","chapter: {chapterName}":"chapter: {chapterName}",live:"live",Off:"Off","start airplay":"start airplay","stop airplay":"stop airplay","start casting":"start casting","stop casting":"stop casting","enter fullscreen mode":"enter fullscreen mode","exit fullscreen mode":"exit fullscreen mode","enter picture in picture mode":"enter picture in picture mode","exit picture in picture mode":"exit picture in picture mode","seek to live":"seek to live","playing live":"playing live","seek back {seekOffset} seconds":"seek back {seekOffset} seconds","seek forward {seekOffset} seconds":"seek forward {seekOffset} seconds","Network Error":"Network Error","Decode Error":"Decode Error","Source Not Supported":"Source Not Supported","Encryption Error":"Encryption Error","A network error caused the media download to fail.":"A network error caused the media download to fail.","A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.":"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.","An unsupported error occurred. The server or network failed, or your browser does not support this format.":"An unsupported error occurred. The server or network failed, or your browser does not support this format.","The media is encrypted and there are no keys to decrypt it.":"The media is encrypted and there are no keys to decrypt it."};var Jg;const dc={en:RD};let dh=((Jg=globalThis.navigator)==null?void 0:Jg.language)||"en";const xD=i=>{dh=i},kD=i=>{var e,t,s;const[r]=dh.split("-");return((e=dc[dh])==null?void 0:e[i])||((t=dc[r])==null?void 0:t[i])||((s=dc.en)==null?void 0:s[i])||i},J=(i,e={})=>kD(i).replace(/\{(\w+)\}/g,(t,s)=>s in e?String(e[s]):`{${s}}`);let Wy=class{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}};class qy extends Wy{}let e0=class extends qy{constructor(){super(...arguments),this.role=null}};class DD{observe(){}unobserve(){}disconnect(){}}const Yy={createElement:function(){return new ja.HTMLElement},createElementNS:function(){return new ja.HTMLElement},addEventListener(){},removeEventListener(){},dispatchEvent(i){return!1}},ja={ResizeObserver:DD,document:Yy,Node:qy,Element:e0,HTMLElement:class extends e0{constructor(){super(...arguments),this.innerHTML=""}get content(){return new ja.DocumentFragment}},DocumentFragment:class extends Wy{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},localStorage:{getItem(i){return null},setItem(i,e){},removeItem(i){}},CustomEvent:function(){},getComputedStyle:function(){},navigator:{languages:[],get userAgent(){return""}},matchMedia(i){return{matches:!1,media:i}},DOMParser:class{parseFromString(e,t){return{body:{textContent:e}}}}},jy=typeof window>"u"||typeof window.customElements>"u",zy=Object.keys(ja).every(i=>i in globalThis),k=jy&&!zy?ja:globalThis,ut=jy&&!zy?Yy:globalThis.document,t0=new WeakMap,im=i=>{let e=t0.get(i);return e||t0.set(i,e=new Set),e},Qy=new k.ResizeObserver(i=>{for(const e of i)for(const t of im(e.target))t(e)});function Cn(i,e){im(i).add(e),Qy.observe(i)}function wn(i,e){const t=im(i);t.delete(e),t.size||Qy.unobserve(i)}function Yt(i){const e={};for(const t of i)e[t.name]=t.value;return e}function Ct(i){var e;return(e=uh(i))!=null?e:$n(i,"media-controller")}function uh(i){var e;const{MEDIA_CONTROLLER:t}=_e,s=i.getAttribute(t);if(s)return(e=uu(i))==null?void 0:e.getElementById(s)}const Xy=(i,e,t=".value")=>{const s=i.querySelector(t);s&&(s.textContent=e)},CD=(i,e)=>{const t=`slot[name="${e}"]`,s=i.shadowRoot.querySelector(t);return s?s.children:[]},Zy=(i,e)=>CD(i,e)[0],ps=(i,e)=>!i||!e?!1:i?.contains(e)?!0:ps(i,e.getRootNode().host),$n=(i,e)=>{if(!i)return null;const t=i.closest(e);return t||$n(i.getRootNode().host,e)};function sm(i=document){var e;const t=i?.activeElement;return t?(e=sm(t.shadowRoot))!=null?e:t:null}function uu(i){var e;const t=(e=i?.getRootNode)==null?void 0:e.call(i);return t instanceof ShadowRoot||t instanceof Document?t:null}function Jy(i,{depth:e=3,checkOpacity:t=!0,checkVisibilityCSS:s=!0}={}){if(i.checkVisibility)return i.checkVisibility({checkOpacity:t,checkVisibilityCSS:s});let r=i;for(;r&&e>0;){const n=getComputedStyle(r);if(t&&n.opacity==="0"||s&&n.visibility==="hidden"||n.display==="none")return!1;r=r.parentElement,e--}return!0}function wD(i,e,t,s){const r=s.x-t.x,n=s.y-t.y,a=r*r+n*n;if(a===0)return 0;const o=((i-t.x)*r+(e-t.y)*n)/a;return Math.max(0,Math.min(1,o))}function et(i,e){const t=MD(i,s=>s===e);return t||eT(i,e)}function MD(i,e){var t,s;let r;for(r of(t=i.querySelectorAll("style:not([media])"))!=null?t:[]){let n;try{n=(s=r.sheet)==null?void 0:s.cssRules}catch{continue}for(const a of n??[])if(e(a.selectorText))return a}}function eT(i,e){var t,s;const r=(t=i.querySelectorAll("style:not([media])"))!=null?t:[],n=r?.[r.length-1];return n?.sheet?(n?.sheet.insertRule(`${e}{}`,n.sheet.cssRules.length),(s=n.sheet.cssRules)==null?void 0:s[n.sheet.cssRules.length-1]):(console.warn("Media Chrome: No style sheet found on style tag of",i),{style:{setProperty:()=>{},removeProperty:()=>"",getPropertyValue:()=>""}})}function Oe(i,e,t=Number.NaN){const s=i.getAttribute(e);return s!=null?+s:t}function qe(i,e,t){const s=+t;if(t==null||Number.isNaN(s)){i.hasAttribute(e)&&i.removeAttribute(e);return}Oe(i,e,void 0)!==s&&i.setAttribute(e,`${s}`)}function Ee(i,e){return i.hasAttribute(e)}function ye(i,e,t){if(t==null){i.hasAttribute(e)&&i.removeAttribute(e);return}Ee(i,e)!=t&&i.toggleAttribute(e,t)}function Ne(i,e,t=null){var s;return(s=i.getAttribute(e))!=null?s:t}function Ue(i,e,t){if(t==null){i.hasAttribute(e)&&i.removeAttribute(e);return}const s=`${t}`;Ne(i,e,void 0)!==s&&i.setAttribute(e,s)}var tT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ts=(i,e,t)=>(tT(i,e,"read from private field"),t?t.call(i):e.get(i)),PD=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Po=(i,e,t,s)=>(tT(i,e,"write to private field"),e.set(i,t),t),xt;function OD(i){return`
    <style>
      :host {
        display: var(--media-control-display, var(--media-gesture-receiver-display, inline-block));
        box-sizing: border-box;
      }
    </style>
  `}class cu extends k.HTMLElement{constructor(){if(super(),PD(this,xt,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}static get observedAttributes(){return[_e.MEDIA_CONTROLLER,_.MEDIA_PAUSED]}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===_e.MEDIA_CONTROLLER&&(t&&((n=(r=Ts(this,xt))==null?void 0:r.unassociateElement)==null||n.call(r,this),Po(this,xt,null)),s&&this.isConnected&&(Po(this,xt,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Ts(this,xt))==null?void 0:o.associateElement)==null||l.call(o,this)))}connectedCallback(){var e,t,s,r;this.tabIndex=-1,this.setAttribute("aria-hidden","true"),Po(this,xt,ND(this)),this.getAttribute(_e.MEDIA_CONTROLLER)&&((t=(e=Ts(this,xt))==null?void 0:e.associateElement)==null||t.call(e,this)),(s=Ts(this,xt))==null||s.addEventListener("pointerdown",this),(r=Ts(this,xt))==null||r.addEventListener("click",this)}disconnectedCallback(){var e,t,s,r;this.getAttribute(_e.MEDIA_CONTROLLER)&&((t=(e=Ts(this,xt))==null?void 0:e.unassociateElement)==null||t.call(e,this)),(s=Ts(this,xt))==null||s.removeEventListener("pointerdown",this),(r=Ts(this,xt))==null||r.removeEventListener("click",this),Po(this,xt,null)}handleEvent(e){var t;const s=(t=e.composedPath())==null?void 0:t[0];if(["video","media-controller"].includes(s?.localName)){if(e.type==="pointerdown")this._pointerType=e.pointerType;else if(e.type==="click"){const{clientX:n,clientY:a}=e,{left:o,top:l,width:d,height:u}=this.getBoundingClientRect(),c=n-o,h=a-l;if(c<0||h<0||c>d||h>u||d===0&&u===0)return;const f=this._pointerType||"mouse";if(this._pointerType=void 0,f===lc.TOUCH){this.handleTap(e);return}else if(f===lc.MOUSE||f===lc.PEN){this.handleMouseClick(e);return}}}}get mediaPaused(){return Ee(this,_.MEDIA_PAUSED)}set mediaPaused(e){ye(this,_.MEDIA_PAUSED,e)}handleTap(e){}handleMouseClick(e){const t=this.mediaPaused?X.MEDIA_PLAY_REQUEST:X.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new k.CustomEvent(t,{composed:!0,bubbles:!0}))}}xt=new WeakMap;cu.shadowRootOptions={mode:"open"};cu.getTemplateHTML=OD;function ND(i){var e;const t=i.getAttribute(_e.MEDIA_CONTROLLER);return t?(e=i.getRootNode())==null?void 0:e.getElementById(t):$n(i,"media-controller")}k.customElements.get("media-gesture-receiver")||k.customElements.define("media-gesture-receiver",cu);var i0=cu,rm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Kt=(i,e,t)=>(rm(i,e,"read from private field"),t?t.call(i):e.get(i)),Ut=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Js=(i,e,t,s)=>(rm(i,e,"write to private field"),e.set(i,t),t),ti=(i,e,t)=>(rm(i,e,"access private method"),t),Cd,Wr,za,cn,gl,ch,iT,da,vl,hh,sT,fh,rT,Qa,hu,fu,nm,Mn,Xa;const se={AUDIO:"audio",AUTOHIDE:"autohide",BREAKPOINTS:"breakpoints",GESTURES_DISABLED:"gesturesdisabled",KEYBOARD_CONTROL:"keyboardcontrol",NO_AUTOHIDE:"noautohide",USER_INACTIVE:"userinactive",AUTOHIDE_OVER_CONTROLS:"autohideovercontrols"};function UD(i){return`
    <style>
      
      :host([${_.MEDIA_IS_FULLSCREEN}]) ::slotted([slot=media]) {
        outline: none;
      }

      :host {
        box-sizing: border-box;
        position: relative;
        display: inline-block;
        line-height: 0;
        background-color: var(--media-background-color, #000);
        overflow: hidden;
      }

      :host(:not([${se.AUDIO}])) [part~=layer]:not([part~=media-layer]) {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        display: flex;
        flex-flow: column nowrap;
        align-items: start;
        pointer-events: none;
        background: none;
      }

      slot[name=media] {
        display: var(--media-slot-display, contents);
      }

      
      :host([${se.AUDIO}]) slot[name=media] {
        display: var(--media-slot-display, none);
      }

      
      :host([${se.AUDIO}]) [part~=layer][part~=gesture-layer] {
        height: 0;
        display: block;
      }

      
      :host(:not([${se.AUDIO}])[${se.GESTURES_DISABLED}]) ::slotted([slot=gestures-chrome]),
          :host(:not([${se.AUDIO}])[${se.GESTURES_DISABLED}]) media-gesture-receiver[slot=gestures-chrome] {
        display: none;
      }

      
      ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator):not([role=dialog]):not([hidden])) {
        pointer-events: auto;
      }

      :host(:not([${se.AUDIO}])) *[part~=layer][part~=centered-layer] {
        align-items: center;
        justify-content: center;
      }

      :host(:not([${se.AUDIO}])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
      :host(:not([${se.AUDIO}])) media-gesture-receiver[slot=gestures-chrome] {
        align-self: stretch;
        flex-grow: 1;
      }

      slot[name=middle-chrome] {
        display: inline;
        flex-grow: 1;
        pointer-events: none;
        background: none;
      }

      
      ::slotted([slot=media]),
      ::slotted([slot=poster]) {
        width: 100%;
        height: 100%;
      }

      
      :host(:not([${se.AUDIO}])) .spacer {
        flex-grow: 1;
      }

      
      :host(:-webkit-full-screen) {
        
        width: 100% !important;
        height: 100% !important;
      }

      
      ::slotted(:not([slot=media]):not([slot=poster]):not([${se.NO_AUTOHIDE}]):not([hidden]):not([role=dialog])) {
        opacity: 1;
        transition: var(--media-control-transition-in, opacity 0.25s);
      }

      
      :host([${se.USER_INACTIVE}]:not([${_.MEDIA_PAUSED}]):not([${_.MEDIA_IS_AIRPLAYING}]):not([${_.MEDIA_IS_CASTING}]):not([${se.AUDIO}])) ::slotted(:not([slot=media]):not([slot=poster]):not([${se.NO_AUTOHIDE}]):not([role=dialog])) {
        opacity: 0;
        transition: var(--media-control-transition-out, opacity 1s);
      }

      :host([${se.USER_INACTIVE}]:not([${se.NO_AUTOHIDE}]):not([${_.MEDIA_PAUSED}]):not([${_.MEDIA_IS_CASTING}]):not([${se.AUDIO}])) ::slotted([slot=media]) {
        cursor: none;
      }

      :host([${se.USER_INACTIVE}][${se.AUTOHIDE_OVER_CONTROLS}]:not([${se.NO_AUTOHIDE}]):not([${_.MEDIA_PAUSED}]):not([${_.MEDIA_IS_CASTING}]):not([${se.AUDIO}])) * {
        --media-cursor: none;
        cursor: none;
      }


      ::slotted(media-control-bar)  {
        align-self: stretch;
      }

      
      :host(:not([${se.AUDIO}])[${_.MEDIA_HAS_PLAYED}]) slot[name=poster] {
        display: none;
      }

      ::slotted([role=dialog]) {
        width: 100%;
        height: 100%;
        align-self: center;
      }

      ::slotted([role=menu]) {
        align-self: end;
      }
    </style>

    <slot name="media" part="layer media-layer"></slot>
    <slot name="poster" part="layer poster-layer"></slot>
    <slot name="gestures-chrome" part="layer gesture-layer">
      <media-gesture-receiver slot="gestures-chrome">
        <template shadowrootmode="${i0.shadowRootOptions.mode}">
          ${i0.getTemplateHTML({})}
        </template>
      </media-gesture-receiver>
    </slot>
    <span part="layer vertical-layer">
      <slot name="top-chrome" part="top chrome"></slot>
      <slot name="middle-chrome" part="middle chrome"></slot>
      <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
      
      <slot part="bottom chrome"></slot>
    </span>
    <slot name="dialog" part="layer dialog-layer"></slot>
  `}const $D=Object.values(_),FD="sm:384 md:576 lg:768 xl:960";function BD(i){nT(i.target,i.contentRect.width)}function nT(i,e){var t;if(!i.isConnected)return;const s=(t=i.getAttribute(se.BREAKPOINTS))!=null?t:FD,r=HD(s),n=GD(r,e);let a=!1;if(Object.keys(r).forEach(o=>{if(n.includes(o)){i.hasAttribute(`breakpoint${o}`)||(i.setAttribute(`breakpoint${o}`,""),a=!0);return}i.hasAttribute(`breakpoint${o}`)&&(i.removeAttribute(`breakpoint${o}`),a=!0)}),a){const o=new CustomEvent(fs.BREAKPOINTS_CHANGE,{detail:n});i.dispatchEvent(o)}i.breakpointsComputed||(i.breakpointsComputed=!0,i.dispatchEvent(new CustomEvent(fs.BREAKPOINTS_COMPUTED,{bubbles:!0,composed:!0})))}function HD(i){const e=i.split(/\s+/);return Object.fromEntries(e.map(t=>t.split(":")))}function GD(i,e){return Object.keys(i).filter(t=>e>=parseInt(i[t]))}class mu extends k.HTMLElement{constructor(){if(super(),Ut(this,ch),Ut(this,hh),Ut(this,fh),Ut(this,Qa),Ut(this,fu),Ut(this,Mn),Ut(this,Cd,0),Ut(this,Wr,null),Ut(this,za,null),Ut(this,cn,void 0),this.breakpointsComputed=!1,Ut(this,gl,new MutationObserver(ti(this,ch,iT).bind(this))),Ut(this,da,!1),Ut(this,vl,t=>{Kt(this,da)||(setTimeout(()=>{BD(t),Js(this,da,!1)},0),Js(this,da,!0))}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const t=Yt(this.attributes),s=this.constructor.getTemplateHTML(t);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(s):this.shadowRoot.innerHTML=s}const e=this.querySelector(":scope > slot[slot=media]");e&&e.addEventListener("slotchange",()=>{if(!e.assignedElements({flatten:!0}).length){Kt(this,Wr)&&this.mediaUnsetCallback(Kt(this,Wr));return}this.handleMediaUpdated(this.media)})}static get observedAttributes(){return[se.AUTOHIDE,se.GESTURES_DISABLED].concat($D).filter(e=>![_.MEDIA_RENDITION_LIST,_.MEDIA_AUDIO_TRACK_LIST,_.MEDIA_CHAPTERS_CUES,_.MEDIA_WIDTH,_.MEDIA_HEIGHT,_.MEDIA_ERROR,_.MEDIA_ERROR_MESSAGE].includes(e))}attributeChangedCallback(e,t,s){e.toLowerCase()==se.AUTOHIDE&&(this.autohide=s)}get media(){let e=this.querySelector(":scope > [slot=media]");return e?.nodeName=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}async handleMediaUpdated(e){e&&(Js(this,Wr,e),e.localName.includes("-")&&await k.customElements.whenDefined(e.localName),this.mediaSetCallback(e))}connectedCallback(){var e;Kt(this,gl).observe(this,{childList:!0,subtree:!0}),Cn(this,Kt(this,vl));const t=this.getAttribute(se.AUDIO)!=null,s=J(t?"audio player":"video player");this.setAttribute("role","region"),this.setAttribute("aria-label",s),this.handleMediaUpdated(this.media),this.setAttribute(se.USER_INACTIVE,""),nT(this,this.getBoundingClientRect().width),this.addEventListener("pointerdown",this),this.addEventListener("pointermove",this),this.addEventListener("pointerup",this),this.addEventListener("mouseleave",this),this.addEventListener("keyup",this),(e=k.window)==null||e.addEventListener("mouseup",this)}disconnectedCallback(){var e;Kt(this,gl).disconnect(),wn(this,Kt(this,vl)),this.media&&this.mediaUnsetCallback(this.media),(e=k.window)==null||e.removeEventListener("mouseup",this)}mediaSetCallback(e){}mediaUnsetCallback(e){Js(this,Wr,null)}handleEvent(e){switch(e.type){case"pointerdown":Js(this,Cd,e.timeStamp);break;case"pointermove":ti(this,hh,sT).call(this,e);break;case"pointerup":ti(this,fh,rT).call(this,e);break;case"mouseleave":ti(this,Qa,hu).call(this);break;case"mouseup":this.removeAttribute(se.KEYBOARD_CONTROL);break;case"keyup":ti(this,Mn,Xa).call(this),this.setAttribute(se.KEYBOARD_CONTROL,"");break}}set autohide(e){const t=Number(e);Js(this,cn,isNaN(t)?0:t)}get autohide(){return(Kt(this,cn)===void 0?2:Kt(this,cn)).toString()}get breakpoints(){return Ne(this,se.BREAKPOINTS)}set breakpoints(e){Ue(this,se.BREAKPOINTS,e)}get audio(){return Ee(this,se.AUDIO)}set audio(e){ye(this,se.AUDIO,e)}get gesturesDisabled(){return Ee(this,se.GESTURES_DISABLED)}set gesturesDisabled(e){ye(this,se.GESTURES_DISABLED,e)}get keyboardControl(){return Ee(this,se.KEYBOARD_CONTROL)}set keyboardControl(e){ye(this,se.KEYBOARD_CONTROL,e)}get noAutohide(){return Ee(this,se.NO_AUTOHIDE)}set noAutohide(e){ye(this,se.NO_AUTOHIDE,e)}get autohideOverControls(){return Ee(this,se.AUTOHIDE_OVER_CONTROLS)}set autohideOverControls(e){ye(this,se.AUTOHIDE_OVER_CONTROLS,e)}get userInteractive(){return Ee(this,se.USER_INACTIVE)}set userInteractive(e){ye(this,se.USER_INACTIVE,e)}}Cd=new WeakMap;Wr=new WeakMap;za=new WeakMap;cn=new WeakMap;gl=new WeakMap;ch=new WeakSet;iT=function(i){const e=this.media;for(const t of i){if(t.type!=="childList")continue;const s=t.removedNodes;for(const r of s){if(r.slot!="media"||t.target!=this)continue;let n=t.previousSibling&&t.previousSibling.previousElementSibling;if(!n||!e)this.mediaUnsetCallback(r);else{let a=n.slot!=="media";for(;(n=n.previousSibling)!==null;)n.slot=="media"&&(a=!1);a&&this.mediaUnsetCallback(r)}}if(e)for(const r of t.addedNodes)r===e&&this.handleMediaUpdated(e)}};da=new WeakMap;vl=new WeakMap;hh=new WeakSet;sT=function(i){if(i.pointerType!=="mouse"&&i.timeStamp-Kt(this,Cd)<250)return;ti(this,fu,nm).call(this),clearTimeout(Kt(this,za));const e=this.hasAttribute(se.AUTOHIDE_OVER_CONTROLS);([this,this.media].includes(i.target)||e)&&ti(this,Mn,Xa).call(this)};fh=new WeakSet;rT=function(i){if(i.pointerType==="touch"){const e=!this.hasAttribute(se.USER_INACTIVE);[this,this.media].includes(i.target)&&e?ti(this,Qa,hu).call(this):ti(this,Mn,Xa).call(this)}else i.composedPath().some(e=>["media-play-button","media-fullscreen-button"].includes(e?.localName))&&ti(this,Mn,Xa).call(this)};Qa=new WeakSet;hu=function(){if(Kt(this,cn)<0||this.hasAttribute(se.USER_INACTIVE))return;this.setAttribute(se.USER_INACTIVE,"");const i=new k.CustomEvent(fs.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(i)};fu=new WeakSet;nm=function(){if(!this.hasAttribute(se.USER_INACTIVE))return;this.removeAttribute(se.USER_INACTIVE);const i=new k.CustomEvent(fs.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(i)};Mn=new WeakSet;Xa=function(){ti(this,fu,nm).call(this),clearTimeout(Kt(this,za));const i=parseInt(this.autohide);i<0||Js(this,za,setTimeout(()=>{ti(this,Qa,hu).call(this)},i*1e3))};mu.shadowRootOptions={mode:"open"};mu.getTemplateHTML=UD;k.customElements.get("media-container")||k.customElements.define("media-container",mu);var aT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ft=(i,e,t)=>(aT(i,e,"read from private field"),t?t.call(i):e.get(i)),Wn=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Oo=(i,e,t,s)=>(aT(i,e,"write to private field"),e.set(i,t),t),qr,Yr,wd,cr,ss,Ss;class am{constructor(e,t,{defaultValue:s}={defaultValue:void 0}){Wn(this,ss),Wn(this,qr,void 0),Wn(this,Yr,void 0),Wn(this,wd,void 0),Wn(this,cr,new Set),Oo(this,qr,e),Oo(this,Yr,t),Oo(this,wd,new Set(s))}[Symbol.iterator](){return ft(this,ss,Ss).values()}get length(){return ft(this,ss,Ss).size}get value(){var e;return(e=[...ft(this,ss,Ss)].join(" "))!=null?e:""}set value(e){var t;e!==this.value&&(Oo(this,cr,new Set),this.add(...(t=e?.split(" "))!=null?t:[]))}toString(){return this.value}item(e){return[...ft(this,ss,Ss)][e]}values(){return ft(this,ss,Ss).values()}forEach(e,t){ft(this,ss,Ss).forEach(e,t)}add(...e){var t,s;e.forEach(r=>ft(this,cr).add(r)),!(this.value===""&&!((t=ft(this,qr))!=null&&t.hasAttribute(`${ft(this,Yr)}`)))&&((s=ft(this,qr))==null||s.setAttribute(`${ft(this,Yr)}`,`${this.value}`))}remove(...e){var t;e.forEach(s=>ft(this,cr).delete(s)),(t=ft(this,qr))==null||t.setAttribute(`${ft(this,Yr)}`,`${this.value}`)}contains(e){return ft(this,ss,Ss).has(e)}toggle(e,t){return typeof t<"u"?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){return this.remove(e),this.add(t),e===t}}qr=new WeakMap;Yr=new WeakMap;wd=new WeakMap;cr=new WeakMap;ss=new WeakSet;Ss=function(){return ft(this,cr).size?ft(this,cr):ft(this,wd)};const KD=(i="")=>i.split(/\s+/),oT=(i="")=>{const[e,t,s]=i.split(":"),r=s?decodeURIComponent(s):void 0;return{kind:e==="cc"?Yi.CAPTIONS:Yi.SUBTITLES,language:t,label:r}},pu=(i="",e={})=>KD(i).map(t=>{const s=oT(t);return{...e,...s}}),lT=i=>i?Array.isArray(i)?i.map(e=>typeof e=="string"?oT(e):e):typeof i=="string"?pu(i):[i]:[],mh=({kind:i,label:e,language:t}={kind:"subtitles"})=>e?`${i==="captions"?"cc":"sb"}:${t}:${encodeURIComponent(e)}`:t,Za=(i=[])=>Array.prototype.map.call(i,mh).join(" "),VD=(i,e)=>t=>t[i]===e,dT=i=>{const e=Object.entries(i).map(([t,s])=>VD(t,s));return t=>e.every(s=>s(t))},Ca=(i,e=[],t=[])=>{const s=lT(t).map(dT),r=n=>s.some(a=>a(n));Array.from(e).filter(r).forEach(n=>{n.mode=i})},gu=(i,e=()=>!0)=>{if(!i?.textTracks)return[];const t=typeof e=="function"?e:dT(e);return Array.from(i.textTracks).filter(t)},uT=i=>{var e;return!!((e=i.mediaSubtitlesShowing)!=null&&e.length)||i.hasAttribute(_.MEDIA_SUBTITLES_SHOWING)},WD=i=>{var e;const{media:t,fullscreenElement:s}=i;try{const r=s&&"requestFullscreen"in s?"requestFullscreen":s&&"webkitRequestFullScreen"in s?"webkitRequestFullScreen":void 0;if(r){const n=(e=s[r])==null?void 0:e.call(s);if(n instanceof Promise)return n.catch(()=>{})}else t?.webkitEnterFullscreen?t.webkitEnterFullscreen():t?.requestFullscreen&&t.requestFullscreen()}catch(r){console.error(r)}},s0="exitFullscreen"in ut?"exitFullscreen":"webkitExitFullscreen"in ut?"webkitExitFullscreen":"webkitCancelFullScreen"in ut?"webkitCancelFullScreen":void 0,qD=i=>{var e;const{documentElement:t}=i;if(s0){const s=(e=t?.[s0])==null?void 0:e.call(t);if(s instanceof Promise)return s.catch(()=>{})}},ua="fullscreenElement"in ut?"fullscreenElement":"webkitFullscreenElement"in ut?"webkitFullscreenElement":void 0,YD=i=>{const{documentElement:e,media:t}=i,s=e?.[ua];return!s&&"webkitDisplayingFullscreen"in t&&"webkitPresentationMode"in t&&t.webkitDisplayingFullscreen&&t.webkitPresentationMode===gD.FULLSCREEN?t:s},jD=i=>{var e;const{media:t,documentElement:s,fullscreenElement:r=t}=i;if(!t||!s)return!1;const n=YD(i);if(!n)return!1;if(n===r||n===t)return!0;if(n.localName.includes("-")){let a=n.shadowRoot;if(!(ua in a))return ps(n,r);for(;a?.[ua];){if(a[ua]===r)return!0;a=(e=a[ua])==null?void 0:e.shadowRoot}}return!1},zD="fullscreenEnabled"in ut?"fullscreenEnabled":"webkitFullscreenEnabled"in ut?"webkitFullscreenEnabled":void 0,QD=i=>{const{documentElement:e,media:t}=i;return!!e?.[zD]||t&&"webkitSupportsFullscreen"in t};let No;const om=()=>{var i,e;return No||(No=(e=(i=ut)==null?void 0:i.createElement)==null?void 0:e.call(i,"video"),No)},XD=async(i=om())=>{if(!i)return!1;const e=i.volume;i.volume=e/2+.1;const t=new AbortController,s=await Promise.race([ZD(i,t.signal),JD(i,e)]);return t.abort(),s},ZD=(i,e)=>new Promise(t=>{i.addEventListener("volumechange",()=>t(!0),{signal:e})}),JD=async(i,e)=>{for(let t=0;t<10;t++){if(i.volume===e)return!1;await Vy(10)}return i.volume!==e},eC=/.*Version\/.*Safari\/.*/.test(k.navigator.userAgent),cT=(i=om())=>k.matchMedia("(display-mode: standalone)").matches&&eC?!1:typeof i?.requestPictureInPicture=="function",hT=(i=om())=>QD({documentElement:ut,media:i}),tC=hT(),iC=cT(),sC=!!k.WebKitPlaybackTargetAvailabilityEvent,rC=!!k.chrome,Md=i=>gu(i.media,e=>[Yi.SUBTITLES,Yi.CAPTIONS].includes(e.kind)).sort((e,t)=>e.kind>=t.kind?1:-1),fT=i=>gu(i.media,e=>e.mode===bn.SHOWING&&[Yi.SUBTITLES,Yi.CAPTIONS].includes(e.kind)),mT=(i,e)=>{const t=Md(i),s=fT(i),r=!!s.length;if(t.length){if(e===!1||r&&e!==!0)Ca(bn.DISABLED,t,s);else if(e===!0||!r&&e!==!1){let n=t[0];const{options:a}=i;if(!a?.noSubtitlesLangPref){const u=globalThis.localStorage.getItem("media-chrome-pref-subtitles-lang"),c=u?[u,...globalThis.navigator.languages]:globalThis.navigator.languages,h=t.filter(f=>c.some(m=>f.language.toLowerCase().startsWith(m.split("-")[0]))).sort((f,m)=>{const g=c.findIndex(E=>f.language.toLowerCase().startsWith(E.split("-")[0])),p=c.findIndex(E=>m.language.toLowerCase().startsWith(E.split("-")[0]));return g-p});h[0]&&(n=h[0])}const{language:o,label:l,kind:d}=n;Ca(bn.DISABLED,t,s),Ca(bn.SHOWING,t,[{language:o,label:l,kind:d}])}}},lm=(i,e)=>i===e?!0:i==null||e==null||typeof i!=typeof e?!1:typeof i=="number"&&Number.isNaN(i)&&Number.isNaN(e)?!0:typeof i!="object"?!1:Array.isArray(i)?nC(i,e):Object.entries(i).every(([t,s])=>t in e&&lm(s,e[t])),nC=(i,e)=>{const t=Array.isArray(i),s=Array.isArray(e);return t!==s?!1:t||s?i.length!==e.length?!1:i.every((r,n)=>lm(r,e[n])):!0},aC=Object.values(os);let Pd;const oC=XD().then(i=>(Pd=i,Pd)),lC=async(...i)=>{await Promise.all(i.filter(e=>e).map(async e=>{if(!("localName"in e&&e instanceof k.HTMLElement))return;const t=e.localName;if(!t.includes("-"))return;const s=k.customElements.get(t);s&&e instanceof s||(await k.customElements.whenDefined(t),k.customElements.upgrade(e))}))},dC=new k.DOMParser,uC=i=>i&&(dC.parseFromString(i,"text/html").body.textContent||i),ca={mediaError:{get(i,e){const{media:t}=i;if(e?.type!=="playing")return t?.error},mediaEvents:["emptied","error","playing"]},mediaErrorCode:{get(i,e){var t;const{media:s}=i;if(e?.type!=="playing")return(t=s?.error)==null?void 0:t.code},mediaEvents:["emptied","error","playing"]},mediaErrorMessage:{get(i,e){var t,s;const{media:r}=i;if(e?.type!=="playing")return(s=(t=r?.error)==null?void 0:t.message)!=null?s:""},mediaEvents:["emptied","error","playing"]},mediaWidth:{get(i){var e;const{media:t}=i;return(e=t?.videoWidth)!=null?e:0},mediaEvents:["resize"]},mediaHeight:{get(i){var e;const{media:t}=i;return(e=t?.videoHeight)!=null?e:0},mediaEvents:["resize"]},mediaPaused:{get(i){var e;const{media:t}=i;return(e=t?.paused)!=null?e:!0},set(i,e){var t;const{media:s}=e;s&&(i?s.pause():(t=s.play())==null||t.catch(()=>{}))},mediaEvents:["play","playing","pause","emptied"]},mediaHasPlayed:{get(i,e){const{media:t}=i;return t?e?e.type==="playing":!t.paused:!1},mediaEvents:["playing","emptied"]},mediaEnded:{get(i){var e;const{media:t}=i;return(e=t?.ended)!=null?e:!1},mediaEvents:["seeked","ended","emptied"]},mediaPlaybackRate:{get(i){var e;const{media:t}=i;return(e=t?.playbackRate)!=null?e:1},set(i,e){const{media:t}=e;t&&Number.isFinite(+i)&&(t.playbackRate=+i)},mediaEvents:["ratechange","loadstart"]},mediaMuted:{get(i){var e;const{media:t}=i;return(e=t?.muted)!=null?e:!1},set(i,e){const{media:t,options:{noMutedPref:s}={}}=e;if(t){t.muted=i;try{const r=k.localStorage.getItem("media-chrome-pref-muted")!==null,n=t.hasAttribute("muted");if(s){r&&k.localStorage.removeItem("media-chrome-pref-muted");return}if(n&&!r)return;k.localStorage.setItem("media-chrome-pref-muted",i?"true":"false")}catch(r){console.debug("Error setting muted pref",r)}}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(i,e)=>{const{options:{noMutedPref:t}}=e,{media:s}=e;if(!(!s||s.muted||t))try{const r=k.localStorage.getItem("media-chrome-pref-muted")==="true";ca.mediaMuted.set(r,e),i(r)}catch(r){console.debug("Error getting muted pref",r)}}]},mediaVolume:{get(i){var e;const{media:t}=i;return(e=t?.volume)!=null?e:1},set(i,e){const{media:t,options:{noVolumePref:s}={}}=e;if(t){try{i==null?k.localStorage.removeItem("media-chrome-pref-volume"):!t.hasAttribute("muted")&&!s&&k.localStorage.setItem("media-chrome-pref-volume",i.toString())}catch(r){console.debug("Error setting volume pref",r)}Number.isFinite(+i)&&(t.volume=+i)}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(i,e)=>{const{options:{noVolumePref:t}}=e;if(!t)try{const{media:s}=e;if(!s)return;const r=k.localStorage.getItem("media-chrome-pref-volume");if(r==null)return;ca.mediaVolume.set(+r,e),i(+r)}catch(s){console.debug("Error getting volume pref",s)}}]},mediaVolumeLevel:{get(i){const{media:e}=i;return typeof e?.volume>"u"?"high":e.muted||e.volume===0?"off":e.volume<.5?"low":e.volume<.75?"medium":"high"},mediaEvents:["volumechange"]},mediaCurrentTime:{get(i){var e;const{media:t}=i;return(e=t?.currentTime)!=null?e:0},set(i,e){const{media:t}=e;!t||!tm(i)||(t.currentTime=i)},mediaEvents:["timeupdate","loadedmetadata"]},mediaDuration:{get(i){const{media:e,options:{defaultDuration:t}={}}=i;return t&&(!e||!e.duration||Number.isNaN(e.duration)||!Number.isFinite(e.duration))?t:Number.isFinite(e?.duration)?e.duration:Number.NaN},mediaEvents:["durationchange","loadedmetadata","emptied"]},mediaLoading:{get(i){const{media:e}=i;return e?.readyState<3},mediaEvents:["waiting","playing","emptied"]},mediaSeekable:{get(i){var e;const{media:t}=i;if(!((e=t?.seekable)!=null&&e.length))return;const s=t.seekable.start(0),r=t.seekable.end(t.seekable.length-1);if(!(!s&&!r))return[Number(s.toFixed(3)),Number(r.toFixed(3))]},mediaEvents:["loadedmetadata","emptied","progress","seekablechange"]},mediaBuffered:{get(i){var e;const{media:t}=i,s=(e=t?.buffered)!=null?e:[];return Array.from(s).map((r,n)=>[Number(s.start(n).toFixed(3)),Number(s.end(n).toFixed(3))])},mediaEvents:["progress","emptied"]},mediaStreamType:{get(i){const{media:e,options:{defaultStreamType:t}={}}=i,s=[os.LIVE,os.ON_DEMAND].includes(t)?t:void 0;if(!e)return s;const{streamType:r}=e;if(aC.includes(r))return r===os.UNKNOWN?s:r;const n=e.duration;return n===1/0?os.LIVE:Number.isFinite(n)?os.ON_DEMAND:s},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange"]},mediaTargetLiveWindow:{get(i){const{media:e}=i;if(!e)return Number.NaN;const{targetLiveWindow:t}=e,s=ca.mediaStreamType.get(i);return(t==null||Number.isNaN(t))&&s===os.LIVE?0:t},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange","targetlivewindowchange"]},mediaTimeIsLive:{get(i){const{media:e,options:{liveEdgeOffset:t=10}={}}=i;if(!e)return!1;if(typeof e.liveEdgeStart=="number")return Number.isNaN(e.liveEdgeStart)?!1:e.currentTime>=e.liveEdgeStart;if(!(ca.mediaStreamType.get(i)===os.LIVE))return!1;const r=e.seekable;if(!r)return!0;if(!r.length)return!1;const n=r.end(r.length-1)-t;return e.currentTime>=n},mediaEvents:["playing","timeupdate","progress","waiting","emptied"]},mediaSubtitlesList:{get(i){return Md(i).map(({kind:e,label:t,language:s})=>({kind:e,label:t,language:s}))},mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack"]},mediaSubtitlesShowing:{get(i){return fT(i).map(({kind:e,label:t,language:s})=>({kind:e,label:t,language:s}))},mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(i,e)=>{var t,s;const{media:r,options:n}=e;if(!r)return;const a=o=>{var l;!n.defaultSubtitles||o&&![Yi.CAPTIONS,Yi.SUBTITLES].includes((l=o?.track)==null?void 0:l.kind)||mT(e,!0)};return r.addEventListener("loadstart",a),(t=r.textTracks)==null||t.addEventListener("addtrack",a),(s=r.textTracks)==null||s.addEventListener("removetrack",a),()=>{var o,l;r.removeEventListener("loadstart",a),(o=r.textTracks)==null||o.removeEventListener("addtrack",a),(l=r.textTracks)==null||l.removeEventListener("removetrack",a)}}]},mediaChaptersCues:{get(i){var e;const{media:t}=i;if(!t)return[];const[s]=gu(t,{kind:Yi.CHAPTERS});return Array.from((e=s?.cues)!=null?e:[]).map(({text:r,startTime:n,endTime:a})=>({text:uC(r),startTime:n,endTime:a}))},mediaEvents:["loadstart","loadedmetadata"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(i,e)=>{var t;const{media:s}=e;if(!s)return;const r=s.querySelector('track[kind="chapters"][default][src]'),n=(t=s.shadowRoot)==null?void 0:t.querySelector(':is(video,audio) > track[kind="chapters"][default][src]');return r?.addEventListener("load",i),n?.addEventListener("load",i),()=>{r?.removeEventListener("load",i),n?.removeEventListener("load",i)}}]},mediaIsPip:{get(i){var e,t;const{media:s,documentElement:r}=i;if(!s||!r||!r.pictureInPictureElement)return!1;if(r.pictureInPictureElement===s)return!0;if(r.pictureInPictureElement instanceof HTMLMediaElement)return(e=s.localName)!=null&&e.includes("-")?ps(s,r.pictureInPictureElement):!1;if(r.pictureInPictureElement.localName.includes("-")){let n=r.pictureInPictureElement.shadowRoot;for(;n?.pictureInPictureElement;){if(n.pictureInPictureElement===s)return!0;n=(t=n.pictureInPictureElement)==null?void 0:t.shadowRoot}}return!1},set(i,e){const{media:t}=e;if(t)if(i){if(!ut.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!t.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}const s=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};t.requestPictureInPicture().catch(r=>{if(r.code===11){if(!t.src){console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a src set.");return}if(t.readyState===0&&t.preload==="none"){const n=()=>{t.removeEventListener("loadedmetadata",a),t.preload="none"},a=()=>{t.requestPictureInPicture().catch(s),n()};t.addEventListener("loadedmetadata",a),t.preload="metadata",setTimeout(()=>{t.readyState===0&&s(),n()},1e3)}else throw r}else throw r})}else ut.pictureInPictureElement&&ut.exitPictureInPicture()},mediaEvents:["enterpictureinpicture","leavepictureinpicture"]},mediaRenditionList:{get(i){var e;const{media:t}=i;return[...(e=t?.videoRenditions)!=null?e:[]].map(s=>({...s}))},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaRenditionSelected:{get(i){var e,t,s;const{media:r}=i;return(s=(t=r?.videoRenditions)==null?void 0:t[(e=r.videoRenditions)==null?void 0:e.selectedIndex])==null?void 0:s.id},set(i,e){const{media:t}=e;if(!t?.videoRenditions){console.warn("MediaController: Rendition selection not supported by this media.");return}const s=i,r=Array.prototype.findIndex.call(t.videoRenditions,n=>n.id==s);t.videoRenditions.selectedIndex!=r&&(t.videoRenditions.selectedIndex=r)},mediaEvents:["emptied"],videoRenditionsEvents:["addrendition","removerendition","change"]},mediaAudioTrackList:{get(i){var e;const{media:t}=i;return[...(e=t?.audioTracks)!=null?e:[]]},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},mediaAudioTrackEnabled:{get(i){var e,t;const{media:s}=i;return(t=[...(e=s?.audioTracks)!=null?e:[]].find(r=>r.enabled))==null?void 0:t.id},set(i,e){const{media:t}=e;if(!t?.audioTracks){console.warn("MediaChrome: Audio track selection not supported by this media.");return}const s=i;for(const r of t.audioTracks)r.enabled=s==r.id},mediaEvents:["emptied"],audioTracksEvents:["addtrack","removetrack","change"]},mediaIsFullscreen:{get(i){return jD(i)},set(i,e,t){var s;i?(WD(e),t.detail&&((s=e.media)==null||s.focus())):qD(e)},rootEvents:["fullscreenchange","webkitfullscreenchange"],mediaEvents:["webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"]},mediaIsCasting:{get(i){var e;const{media:t}=i;return!t?.remote||((e=t.remote)==null?void 0:e.state)==="disconnected"?!1:!!t.remote.state},set(i,e){var t,s;const{media:r}=e;if(r&&!(i&&((t=r.remote)==null?void 0:t.state)!=="disconnected")&&!(!i&&((s=r.remote)==null?void 0:s.state)!=="connected")){if(typeof r.remote.prompt!="function"){console.warn("MediaChrome: Casting is not supported in this environment");return}r.remote.prompt().catch(()=>{})}},remoteEvents:["connect","connecting","disconnect"]},mediaIsAirplaying:{get(){return!1},set(i,e){const{media:t}=e;if(t){if(!(t.webkitShowPlaybackTargetPicker&&k.WebKitPlaybackTargetAvailabilityEvent)){console.error("MediaChrome: received a request to select AirPlay but AirPlay is not supported in this environment");return}t.webkitShowPlaybackTargetPicker()}},mediaEvents:["webkitcurrentplaybacktargetiswirelesschanged"]},mediaFullscreenUnavailable:{get(i){const{media:e}=i;if(!tC||!hT(e))return Nt.UNSUPPORTED}},mediaPipUnavailable:{get(i){const{media:e}=i;if(!iC||!cT(e))return Nt.UNSUPPORTED;if(e?.disablePictureInPicture)return Nt.UNAVAILABLE}},mediaVolumeUnavailable:{get(i){const{media:e}=i;if(Pd===!1||e?.volume==null)return Nt.UNSUPPORTED},stateOwnersUpdateHandlers:[i=>{Pd==null&&oC.then(e=>i(e?void 0:Nt.UNSUPPORTED))}]},mediaCastUnavailable:{get(i,{availability:e="not-available"}={}){var t;const{media:s}=i;if(!rC||!((t=s?.remote)!=null&&t.state))return Nt.UNSUPPORTED;if(!(e==null||e==="available"))return Nt.UNAVAILABLE},stateOwnersUpdateHandlers:[(i,e)=>{var t;const{media:s}=e;return s?(s.disableRemotePlayback||s.hasAttribute("disableremoteplayback")||(t=s?.remote)==null||t.watchAvailability(n=>{i({availability:n?"available":"not-available"})}).catch(n=>{n.name==="NotSupportedError"?i({availability:null}):i({availability:"not-available"})}),()=>{var n;(n=s?.remote)==null||n.cancelWatchAvailability().catch(()=>{})}):void 0}]},mediaAirplayUnavailable:{get(i,e){if(!sC)return Nt.UNSUPPORTED;if(e?.availability==="not-available")return Nt.UNAVAILABLE},mediaEvents:["webkitplaybacktargetavailabilitychanged"],stateOwnersUpdateHandlers:[(i,e)=>{var t;const{media:s}=e;return s?(s.disableRemotePlayback||s.hasAttribute("disableremoteplayback")||(t=s?.remote)==null||t.watchAvailability(n=>{i({availability:n?"available":"not-available"})}).catch(n=>{n.name==="NotSupportedError"?i({availability:null}):i({availability:"not-available"})}),()=>{var n;(n=s?.remote)==null||n.cancelWatchAvailability().catch(()=>{})}):void 0}]},mediaRenditionUnavailable:{get(i){var e;const{media:t}=i;if(!t?.videoRenditions)return Nt.UNSUPPORTED;if(!((e=t.videoRenditions)!=null&&e.length))return Nt.UNAVAILABLE},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaAudioTrackUnavailable:{get(i){var e,t;const{media:s}=i;if(!s?.audioTracks)return Nt.UNSUPPORTED;if(((t=(e=s.audioTracks)==null?void 0:e.length)!=null?t:0)<=1)return Nt.UNAVAILABLE},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},mediaLang:{get(i){const{options:{mediaLang:e}={}}=i;return e??"en"}}},cC={[X.MEDIA_PREVIEW_REQUEST](i,e,{detail:t}){var s,r,n;const{media:a}=e,o=t??void 0;let l,d;if(a&&o!=null){const[f]=gu(a,{kind:Yi.METADATA,label:"thumbnails"}),m=Array.prototype.find.call((s=f?.cues)!=null?s:[],(g,p,E)=>p===0?g.endTime>o:p===E.length-1?g.startTime<=o:g.startTime<=o&&g.endTime>o);if(m){const g=/'^(?:[a-z]+:)?\/\//i.test(m.text)||(r=a?.querySelector('track[label="thumbnails"]'))==null?void 0:r.src,p=new URL(m.text,g);d=new URLSearchParams(p.hash).get("#xywh").split(",").map(T=>+T),l=p.href}}const u=i.mediaDuration.get(e);let h=(n=i.mediaChaptersCues.get(e).find((f,m,g)=>m===g.length-1&&u===f.endTime?f.startTime<=o&&f.endTime>=o:f.startTime<=o&&f.endTime>o))==null?void 0:n.text;return t!=null&&h==null&&(h=""),{mediaPreviewTime:o,mediaPreviewImage:l,mediaPreviewCoords:d,mediaPreviewChapter:h}},[X.MEDIA_PAUSE_REQUEST](i,e){i["mediaPaused"].set(!0,e)},[X.MEDIA_PLAY_REQUEST](i,e){var t,s,r,n;const a="mediaPaused",l=i.mediaStreamType.get(e)===os.LIVE,d=!((t=e.options)!=null&&t.noAutoSeekToLive),u=i.mediaTargetLiveWindow.get(e)>0;if(l&&d&&!u){const c=(s=i.mediaSeekable.get(e))==null?void 0:s[1];if(c){const h=(n=(r=e.options)==null?void 0:r.seekToLiveOffset)!=null?n:0,f=c-h;i.mediaCurrentTime.set(f,e)}}i[a].set(!1,e)},[X.MEDIA_PLAYBACK_RATE_REQUEST](i,e,{detail:t}){const s="mediaPlaybackRate",r=t;i[s].set(r,e)},[X.MEDIA_MUTE_REQUEST](i,e){i["mediaMuted"].set(!0,e)},[X.MEDIA_UNMUTE_REQUEST](i,e){const t="mediaMuted";i.mediaVolume.get(e)||i.mediaVolume.set(.25,e),i[t].set(!1,e)},[X.MEDIA_VOLUME_REQUEST](i,e,{detail:t}){const s="mediaVolume",r=t;r&&i.mediaMuted.get(e)&&i.mediaMuted.set(!1,e),i[s].set(r,e)},[X.MEDIA_SEEK_REQUEST](i,e,{detail:t}){const s="mediaCurrentTime",r=t;i[s].set(r,e)},[X.MEDIA_SEEK_TO_LIVE_REQUEST](i,e){var t,s,r;const n="mediaCurrentTime",a=(t=i.mediaSeekable.get(e))==null?void 0:t[1];if(Number.isNaN(Number(a)))return;const o=(r=(s=e.options)==null?void 0:s.seekToLiveOffset)!=null?r:0,l=a-o;i[n].set(l,e)},[X.MEDIA_SHOW_SUBTITLES_REQUEST](i,e,{detail:t}){var s;const{options:r}=e,n=Md(e),a=lT(t),o=(s=a[0])==null?void 0:s.language;o&&!r.noSubtitlesLangPref&&k.localStorage.setItem("media-chrome-pref-subtitles-lang",o),Ca(bn.SHOWING,n,a)},[X.MEDIA_DISABLE_SUBTITLES_REQUEST](i,e,{detail:t}){const s=Md(e),r=t??[];Ca(bn.DISABLED,s,r)},[X.MEDIA_TOGGLE_SUBTITLES_REQUEST](i,e,{detail:t}){mT(e,t)},[X.MEDIA_RENDITION_REQUEST](i,e,{detail:t}){const s="mediaRenditionSelected",r=t;i[s].set(r,e)},[X.MEDIA_AUDIO_TRACK_REQUEST](i,e,{detail:t}){const s="mediaAudioTrackEnabled",r=t;i[s].set(r,e)},[X.MEDIA_ENTER_PIP_REQUEST](i,e){const t="mediaIsPip";i.mediaIsFullscreen.get(e)&&i.mediaIsFullscreen.set(!1,e),i[t].set(!0,e)},[X.MEDIA_EXIT_PIP_REQUEST](i,e){i["mediaIsPip"].set(!1,e)},[X.MEDIA_ENTER_FULLSCREEN_REQUEST](i,e,t){const s="mediaIsFullscreen";i.mediaIsPip.get(e)&&i.mediaIsPip.set(!1,e),i[s].set(!0,e,t)},[X.MEDIA_EXIT_FULLSCREEN_REQUEST](i,e){i["mediaIsFullscreen"].set(!1,e)},[X.MEDIA_ENTER_CAST_REQUEST](i,e){const t="mediaIsCasting";i.mediaIsFullscreen.get(e)&&i.mediaIsFullscreen.set(!1,e),i[t].set(!0,e)},[X.MEDIA_EXIT_CAST_REQUEST](i,e){i["mediaIsCasting"].set(!1,e)},[X.MEDIA_AIRPLAY_REQUEST](i,e){i["mediaIsAirplaying"].set(!0,e)}},hC=({media:i,fullscreenElement:e,documentElement:t,stateMediator:s=ca,requestMap:r=cC,options:n={},monitorStateOwnersOnlyWithSubscriptions:a=!0})=>{const o=[],l={options:{...n}};let d=Object.freeze({mediaPreviewTime:void 0,mediaPreviewImage:void 0,mediaPreviewCoords:void 0,mediaPreviewChapter:void 0});const u=g=>{g!=null&&(lm(g,d)||(d=Object.freeze({...d,...g}),o.forEach(p=>p(d))))},c=()=>{const g=Object.entries(s).reduce((p,[E,{get:T}])=>(p[E]=T(l),p),{});u(g)},h={};let f;const m=async(g,p)=>{var E,T,y,b,A,L,S,R,x,I,M,$,V,q,H,N;const W=!!f;if(f={...l,...f??{},...g},W)return;await lC(...Object.values(g));const B=o.length>0&&p===0&&a,Y=l.media!==f.media,ee=((E=l.media)==null?void 0:E.textTracks)!==((T=f.media)==null?void 0:T.textTracks),U=((y=l.media)==null?void 0:y.videoRenditions)!==((b=f.media)==null?void 0:b.videoRenditions),F=((A=l.media)==null?void 0:A.audioTracks)!==((L=f.media)==null?void 0:L.audioTracks),ne=((S=l.media)==null?void 0:S.remote)!==((R=f.media)==null?void 0:R.remote),pe=l.documentElement!==f.documentElement,de=!!l.media&&(Y||B),fe=!!((x=l.media)!=null&&x.textTracks)&&(ee||B),rt=!!((I=l.media)!=null&&I.videoRenditions)&&(U||B),ze=!!((M=l.media)!=null&&M.audioTracks)&&(F||B),At=!!(($=l.media)!=null&&$.remote)&&(ne||B),Mt=!!l.documentElement&&(pe||B),yi=de||fe||rt||ze||At||Mt,gs=o.length===0&&p===1&&a,xr=!!f.media&&(Y||gs),kr=!!((V=f.media)!=null&&V.textTracks)&&(ee||gs),Lu=!!((q=f.media)!=null&&q.videoRenditions)&&(U||gs),ve=!!((H=f.media)!=null&&H.audioTracks)&&(F||gs),nt=!!((N=f.media)!=null&&N.remote)&&(ne||gs),St=!!f.documentElement&&(pe||gs),Ti=xr||kr||Lu||ve||nt||St;if(!(yi||Ti)){Object.entries(f).forEach(([Te,Pt])=>{l[Te]=Pt}),c(),f=void 0;return}Object.entries(s).forEach(([Te,{get:Pt,mediaEvents:ho=[],textTracksEvents:Dr=[],videoRenditionsEvents:fo=[],audioTracksEvents:Ws=[],remoteEvents:mo=[],rootEvents:Ru=[],stateOwnersUpdateHandlers:po=[]}])=>{h[Te]||(h[Te]={});const Tt=Ye=>{const Ot=Pt(l,Ye);u({[Te]:Ot})};let Fe;Fe=h[Te].mediaEvents,ho.forEach(Ye=>{Fe&&de&&(l.media.removeEventListener(Ye,Fe),h[Te].mediaEvents=void 0),xr&&(f.media.addEventListener(Ye,Tt),h[Te].mediaEvents=Tt)}),Fe=h[Te].textTracksEvents,Dr.forEach(Ye=>{var Ot,ni;Fe&&fe&&((Ot=l.media.textTracks)==null||Ot.removeEventListener(Ye,Fe),h[Te].textTracksEvents=void 0),kr&&((ni=f.media.textTracks)==null||ni.addEventListener(Ye,Tt),h[Te].textTracksEvents=Tt)}),Fe=h[Te].videoRenditionsEvents,fo.forEach(Ye=>{var Ot,ni;Fe&&rt&&((Ot=l.media.videoRenditions)==null||Ot.removeEventListener(Ye,Fe),h[Te].videoRenditionsEvents=void 0),Lu&&((ni=f.media.videoRenditions)==null||ni.addEventListener(Ye,Tt),h[Te].videoRenditionsEvents=Tt)}),Fe=h[Te].audioTracksEvents,Ws.forEach(Ye=>{var Ot,ni;Fe&&ze&&((Ot=l.media.audioTracks)==null||Ot.removeEventListener(Ye,Fe),h[Te].audioTracksEvents=void 0),ve&&((ni=f.media.audioTracks)==null||ni.addEventListener(Ye,Tt),h[Te].audioTracksEvents=Tt)}),Fe=h[Te].remoteEvents,mo.forEach(Ye=>{var Ot,ni;Fe&&At&&((Ot=l.media.remote)==null||Ot.removeEventListener(Ye,Fe),h[Te].remoteEvents=void 0),nt&&((ni=f.media.remote)==null||ni.addEventListener(Ye,Tt),h[Te].remoteEvents=Tt)}),Fe=h[Te].rootEvents,Ru.forEach(Ye=>{Fe&&Mt&&(l.documentElement.removeEventListener(Ye,Fe),h[Te].rootEvents=void 0),St&&(f.documentElement.addEventListener(Ye,Tt),h[Te].rootEvents=Tt)});const ap=h[Te].stateOwnersUpdateHandlers;po.forEach(Ye=>{ap&&yi&&ap(),Ti&&(h[Te].stateOwnersUpdateHandlers=Ye(Tt,f))})}),Object.entries(f).forEach(([Te,Pt])=>{l[Te]=Pt}),c(),f=void 0};return m({media:i,fullscreenElement:e,documentElement:t,options:n}),{dispatch(g){const{type:p,detail:E}=g;if(r[p]&&d.mediaErrorCode==null){u(r[p](s,l,g));return}p==="mediaelementchangerequest"?m({media:E}):p==="fullscreenelementchangerequest"?m({fullscreenElement:E}):p==="documentelementchangerequest"?m({documentElement:E}):p==="optionschangerequest"&&(Object.entries(E??{}).forEach(([T,y])=>{l.options[T]=y}),c())},getState(){return d},subscribe(g){return m({},o.length+1),o.push(g),g(d),()=>{const p=o.indexOf(g);p>=0&&(m({},o.length-1),o.splice(p,1))}}}};var dm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ue=(i,e,t)=>(dm(i,e,"read from private field"),t?t.call(i):e.get(i)),es=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},bs=(i,e,t,s)=>(dm(i,e,"write to private field"),e.set(i,t),t),Os=(i,e,t)=>(dm(i,e,"access private method"),t),hr,ha,Ae,fa,xi,El,yl,ph,Pn,Ja,Tl,gh;const pT=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," ","f","m","k","c"],r0=10,n0=.025,G={DEFAULT_SUBTITLES:"defaultsubtitles",DEFAULT_STREAM_TYPE:"defaultstreamtype",DEFAULT_DURATION:"defaultduration",FULLSCREEN_ELEMENT:"fullscreenelement",HOTKEYS:"hotkeys",KEYS_USED:"keysused",LIVE_EDGE_OFFSET:"liveedgeoffset",SEEK_TO_LIVE_OFFSET:"seektoliveoffset",NO_AUTO_SEEK_TO_LIVE:"noautoseektolive",NO_HOTKEYS:"nohotkeys",NO_VOLUME_PREF:"novolumepref",NO_MUTED_PREF:"nomutedpref",NO_SUBTITLES_LANG_PREF:"nosubtitleslangpref",NO_DEFAULT_STORE:"nodefaultstore",KEYBOARD_FORWARD_SEEK_OFFSET:"keyboardforwardseekoffset",KEYBOARD_BACKWARD_SEEK_OFFSET:"keyboardbackwardseekoffset",KEYBOARD_UP_VOLUME_STEP:"keyboardupvolumestep",KEYBOARD_DOWN_VOLUME_STEP:"keyboarddownvolumestep",LANG:"lang"};class gT extends mu{constructor(){super(),es(this,yl),es(this,Pn),es(this,Tl),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,es(this,hr,new am(this,G.HOTKEYS)),es(this,ha,void 0),es(this,Ae,void 0),es(this,fa,void 0),es(this,xi,void 0),es(this,El,t=>{var s;(s=ue(this,Ae))==null||s.dispatch(t)}),this.associateElement(this);let e={};bs(this,fa,t=>{Object.entries(t).forEach(([s,r])=>{if(s in e&&e[s]===r)return;this.propagateMediaState(s,r);const n=s.toLowerCase(),a=new k.CustomEvent(pD[n],{composed:!0,detail:r});this.dispatchEvent(a)}),e=t}),this.hasAttribute(G.NO_HOTKEYS)?this.disableHotkeys():this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat(G.NO_HOTKEYS,G.HOTKEYS,G.DEFAULT_STREAM_TYPE,G.DEFAULT_SUBTITLES,G.DEFAULT_DURATION,G.NO_MUTED_PREF,G.NO_VOLUME_PREF,G.LANG)}get mediaStore(){return ue(this,Ae)}set mediaStore(e){var t,s;if(ue(this,Ae)&&((t=ue(this,xi))==null||t.call(this),bs(this,xi,void 0)),bs(this,Ae,e),!ue(this,Ae)&&!this.hasAttribute(G.NO_DEFAULT_STORE)){Os(this,yl,ph).call(this);return}bs(this,xi,(s=ue(this,Ae))==null?void 0:s.subscribe(ue(this,fa)))}get fullscreenElement(){var e;return(e=ue(this,ha))!=null?e:this}set fullscreenElement(e){var t;this.hasAttribute(G.FULLSCREEN_ELEMENT)&&this.removeAttribute(G.FULLSCREEN_ELEMENT),bs(this,ha,e),(t=ue(this,Ae))==null||t.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}get defaultSubtitles(){return Ee(this,G.DEFAULT_SUBTITLES)}set defaultSubtitles(e){ye(this,G.DEFAULT_SUBTITLES,e)}get defaultStreamType(){return Ne(this,G.DEFAULT_STREAM_TYPE)}set defaultStreamType(e){Ue(this,G.DEFAULT_STREAM_TYPE,e)}get defaultDuration(){return Oe(this,G.DEFAULT_DURATION)}set defaultDuration(e){qe(this,G.DEFAULT_DURATION,e)}get noHotkeys(){return Ee(this,G.NO_HOTKEYS)}set noHotkeys(e){ye(this,G.NO_HOTKEYS,e)}get keysUsed(){return Ne(this,G.KEYS_USED)}set keysUsed(e){Ue(this,G.KEYS_USED,e)}get liveEdgeOffset(){return Oe(this,G.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){qe(this,G.LIVE_EDGE_OFFSET,e)}get noAutoSeekToLive(){return Ee(this,G.NO_AUTO_SEEK_TO_LIVE)}set noAutoSeekToLive(e){ye(this,G.NO_AUTO_SEEK_TO_LIVE,e)}get noVolumePref(){return Ee(this,G.NO_VOLUME_PREF)}set noVolumePref(e){ye(this,G.NO_VOLUME_PREF,e)}get noMutedPref(){return Ee(this,G.NO_MUTED_PREF)}set noMutedPref(e){ye(this,G.NO_MUTED_PREF,e)}get noSubtitlesLangPref(){return Ee(this,G.NO_SUBTITLES_LANG_PREF)}set noSubtitlesLangPref(e){ye(this,G.NO_SUBTITLES_LANG_PREF,e)}get noDefaultStore(){return Ee(this,G.NO_DEFAULT_STORE)}set noDefaultStore(e){ye(this,G.NO_DEFAULT_STORE,e)}attributeChangedCallback(e,t,s){var r,n,a,o,l,d,u,c,h,f,m;if(super.attributeChangedCallback(e,t,s),e===G.NO_HOTKEYS)s!==t&&s===""?(this.hasAttribute(G.HOTKEYS)&&console.warn("Media Chrome: Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):s!==t&&s===null&&this.enableHotkeys();else if(e===G.HOTKEYS)ue(this,hr).value=s;else if(e===G.DEFAULT_SUBTITLES&&s!==t)(r=ue(this,Ae))==null||r.dispatch({type:"optionschangerequest",detail:{defaultSubtitles:this.hasAttribute(G.DEFAULT_SUBTITLES)}});else if(e===G.DEFAULT_STREAM_TYPE)(a=ue(this,Ae))==null||a.dispatch({type:"optionschangerequest",detail:{defaultStreamType:(n=this.getAttribute(G.DEFAULT_STREAM_TYPE))!=null?n:void 0}});else if(e===G.LIVE_EDGE_OFFSET)(o=ue(this,Ae))==null||o.dispatch({type:"optionschangerequest",detail:{liveEdgeOffset:this.hasAttribute(G.LIVE_EDGE_OFFSET)?+this.getAttribute(G.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(G.SEEK_TO_LIVE_OFFSET)?void 0:+this.getAttribute(G.LIVE_EDGE_OFFSET)}});else if(e===G.SEEK_TO_LIVE_OFFSET)(l=ue(this,Ae))==null||l.dispatch({type:"optionschangerequest",detail:{seekToLiveOffset:this.hasAttribute(G.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(G.SEEK_TO_LIVE_OFFSET):void 0}});else if(e===G.NO_AUTO_SEEK_TO_LIVE)(d=ue(this,Ae))==null||d.dispatch({type:"optionschangerequest",detail:{noAutoSeekToLive:this.hasAttribute(G.NO_AUTO_SEEK_TO_LIVE)}});else if(e===G.FULLSCREEN_ELEMENT){const g=s?(u=this.getRootNode())==null?void 0:u.getElementById(s):void 0;bs(this,ha,g),(c=ue(this,Ae))==null||c.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}else e===G.LANG&&s!==t?(xD(s),(h=ue(this,Ae))==null||h.dispatch({type:"optionschangerequest",detail:{mediaLang:s}})):e===G.NO_VOLUME_PREF&&s!==t?(f=ue(this,Ae))==null||f.dispatch({type:"optionschangerequest",detail:{noVolumePref:this.hasAttribute(G.NO_VOLUME_PREF)}}):e===G.NO_MUTED_PREF&&s!==t&&((m=ue(this,Ae))==null||m.dispatch({type:"optionschangerequest",detail:{noMutedPref:this.hasAttribute(G.NO_MUTED_PREF)}}))}connectedCallback(){var e,t;!ue(this,Ae)&&!this.hasAttribute(G.NO_DEFAULT_STORE)&&Os(this,yl,ph).call(this),(e=ue(this,Ae))==null||e.dispatch({type:"documentelementchangerequest",detail:ut}),super.connectedCallback(),ue(this,Ae)&&!ue(this,xi)&&bs(this,xi,(t=ue(this,Ae))==null?void 0:t.subscribe(ue(this,fa))),this.hasAttribute(G.NO_HOTKEYS)?this.disableHotkeys():this.enableHotkeys()}disconnectedCallback(){var e,t,s,r;(e=super.disconnectedCallback)==null||e.call(this),ue(this,Ae)&&((t=ue(this,Ae))==null||t.dispatch({type:"documentelementchangerequest",detail:void 0}),(s=ue(this,Ae))==null||s.dispatch({type:X.MEDIA_TOGGLE_SUBTITLES_REQUEST,detail:!1})),ue(this,xi)&&((r=ue(this,xi))==null||r.call(this),bs(this,xi,void 0))}mediaSetCallback(e){var t;super.mediaSetCallback(e),(t=ue(this,Ae))==null||t.dispatch({type:"mediaelementchangerequest",detail:e}),e.hasAttribute("tabindex")||(e.tabIndex=-1)}mediaUnsetCallback(e){var t;super.mediaUnsetCallback(e),(t=ue(this,Ae))==null||t.dispatch({type:"mediaelementchangerequest",detail:void 0})}propagateMediaState(e,t){l0(this.mediaStateReceivers,e,t)}associateElement(e){if(!e)return;const{associatedElementSubscriptions:t}=this;if(t.has(e))return;const s=this.registerMediaStateReceiver.bind(this),r=this.unregisterMediaStateReceiver.bind(this),n=EC(e,s,r);Object.values(X).forEach(a=>{e.addEventListener(a,ue(this,El))}),t.set(e,n)}unassociateElement(e){if(!e)return;const{associatedElementSubscriptions:t}=this;if(!t.has(e))return;t.get(e)(),t.delete(e),Object.values(X).forEach(r=>{e.removeEventListener(r,ue(this,El))})}registerMediaStateReceiver(e){if(!e)return;const t=this.mediaStateReceivers;t.indexOf(e)>-1||(t.push(e),ue(this,Ae)&&Object.entries(ue(this,Ae).getState()).forEach(([r,n])=>{l0([e],r,n)}))}unregisterMediaStateReceiver(e){const t=this.mediaStateReceivers,s=t.indexOf(e);s<0||t.splice(s,1)}enableHotkeys(){this.addEventListener("keydown",Os(this,Tl,gh))}disableHotkeys(){this.removeEventListener("keydown",Os(this,Tl,gh)),this.removeEventListener("keyup",Os(this,Pn,Ja))}get hotkeys(){return Ne(this,G.HOTKEYS)}set hotkeys(e){Ue(this,G.HOTKEYS,e)}keyboardShortcutHandler(e){var t,s,r,n,a,o,l;const d=e.target;if(((r=(s=(t=d.getAttribute(G.KEYS_USED))==null?void 0:t.split(" "))!=null?s:d?.keysUsed)!=null?r:[]).map(m=>m==="Space"?" ":m).filter(Boolean).includes(e.key))return;let c,h,f;if(!ue(this,hr).contains(`no${e.key.toLowerCase()}`)&&!(e.key===" "&&ue(this,hr).contains("nospace")))switch(e.key){case" ":case"k":c=ue(this,Ae).getState().mediaPaused?X.MEDIA_PLAY_REQUEST:X.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new k.CustomEvent(c,{composed:!0,bubbles:!0}));break;case"m":c=this.mediaStore.getState().mediaVolumeLevel==="off"?X.MEDIA_UNMUTE_REQUEST:X.MEDIA_MUTE_REQUEST,this.dispatchEvent(new k.CustomEvent(c,{composed:!0,bubbles:!0}));break;case"f":c=this.mediaStore.getState().mediaIsFullscreen?X.MEDIA_EXIT_FULLSCREEN_REQUEST:X.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new k.CustomEvent(c,{composed:!0,bubbles:!0}));break;case"c":this.dispatchEvent(new k.CustomEvent(X.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}));break;case"ArrowLeft":{const m=this.hasAttribute(G.KEYBOARD_BACKWARD_SEEK_OFFSET)?+this.getAttribute(G.KEYBOARD_BACKWARD_SEEK_OFFSET):r0;h=Math.max(((n=this.mediaStore.getState().mediaCurrentTime)!=null?n:0)-m,0),f=new k.CustomEvent(X.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:h}),this.dispatchEvent(f);break}case"ArrowRight":{const m=this.hasAttribute(G.KEYBOARD_FORWARD_SEEK_OFFSET)?+this.getAttribute(G.KEYBOARD_FORWARD_SEEK_OFFSET):r0;h=Math.max(((a=this.mediaStore.getState().mediaCurrentTime)!=null?a:0)+m,0),f=new k.CustomEvent(X.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:h}),this.dispatchEvent(f);break}case"ArrowUp":{const m=this.hasAttribute(G.KEYBOARD_UP_VOLUME_STEP)?+this.getAttribute(G.KEYBOARD_UP_VOLUME_STEP):n0;h=Math.min(((o=this.mediaStore.getState().mediaVolume)!=null?o:1)+m,1),f=new k.CustomEvent(X.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:h}),this.dispatchEvent(f);break}case"ArrowDown":{const m=this.hasAttribute(G.KEYBOARD_DOWN_VOLUME_STEP)?+this.getAttribute(G.KEYBOARD_DOWN_VOLUME_STEP):n0;h=Math.max(((l=this.mediaStore.getState().mediaVolume)!=null?l:1)-m,0),f=new k.CustomEvent(X.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:h}),this.dispatchEvent(f);break}}}}hr=new WeakMap;ha=new WeakMap;Ae=new WeakMap;fa=new WeakMap;xi=new WeakMap;El=new WeakMap;yl=new WeakSet;ph=function(){var i;this.mediaStore=hC({media:this.media,fullscreenElement:this.fullscreenElement,options:{defaultSubtitles:this.hasAttribute(G.DEFAULT_SUBTITLES),defaultDuration:this.hasAttribute(G.DEFAULT_DURATION)?+this.getAttribute(G.DEFAULT_DURATION):void 0,defaultStreamType:(i=this.getAttribute(G.DEFAULT_STREAM_TYPE))!=null?i:void 0,liveEdgeOffset:this.hasAttribute(G.LIVE_EDGE_OFFSET)?+this.getAttribute(G.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(G.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(G.SEEK_TO_LIVE_OFFSET):this.hasAttribute(G.LIVE_EDGE_OFFSET)?+this.getAttribute(G.LIVE_EDGE_OFFSET):void 0,noAutoSeekToLive:this.hasAttribute(G.NO_AUTO_SEEK_TO_LIVE),noVolumePref:this.hasAttribute(G.NO_VOLUME_PREF),noMutedPref:this.hasAttribute(G.NO_MUTED_PREF),noSubtitlesLangPref:this.hasAttribute(G.NO_SUBTITLES_LANG_PREF)}})};Pn=new WeakSet;Ja=function(i){const{key:e}=i;if(!pT.includes(e)){this.removeEventListener("keyup",Os(this,Pn,Ja));return}this.keyboardShortcutHandler(i)};Tl=new WeakSet;gh=function(i){const{metaKey:e,altKey:t,key:s}=i;if(e||t||!pT.includes(s)){this.removeEventListener("keyup",Os(this,Pn,Ja));return}const r=i.target,n=r instanceof HTMLElement&&(r.tagName.toLowerCase()==="media-volume-range"||r.tagName.toLowerCase()==="media-time-range");[" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(s)&&!(ue(this,hr).contains(`no${s.toLowerCase()}`)||s===" "&&ue(this,hr).contains("nospace"))&&!n&&i.preventDefault(),this.addEventListener("keyup",Os(this,Pn,Ja),{once:!0})};const fC=Object.values(_),mC=Object.values(Hy),vT=i=>{var e,t,s,r;let{observedAttributes:n}=i.constructor;!n&&((e=i.nodeName)!=null&&e.includes("-"))&&(k.customElements.upgrade(i),{observedAttributes:n}=i.constructor);const a=(r=(s=(t=i?.getAttribute)==null?void 0:t.call(i,_e.MEDIA_CHROME_ATTRIBUTES))==null?void 0:s.split)==null?void 0:r.call(s,/\s+/);return Array.isArray(n||a)?(n||a).filter(o=>fC.includes(o)):[]},pC=i=>{var e,t;return(e=i.nodeName)!=null&&e.includes("-")&&k.customElements.get((t=i.nodeName)==null?void 0:t.toLowerCase())&&!(i instanceof k.customElements.get(i.nodeName.toLowerCase()))&&k.customElements.upgrade(i),mC.some(s=>s in i)},vh=i=>pC(i)||!!vT(i).length,a0=i=>{var e;return(e=i?.join)==null?void 0:e.call(i,":")},o0={[_.MEDIA_SUBTITLES_LIST]:Za,[_.MEDIA_SUBTITLES_SHOWING]:Za,[_.MEDIA_SEEKABLE]:a0,[_.MEDIA_BUFFERED]:i=>i?.map(a0).join(" "),[_.MEDIA_PREVIEW_COORDS]:i=>i?.join(" "),[_.MEDIA_RENDITION_LIST]:vD,[_.MEDIA_AUDIO_TRACK_LIST]:bD},gC=async(i,e,t)=>{var s,r;if(i.isConnected||await Vy(0),typeof t=="boolean"||t==null)return ye(i,e,t);if(typeof t=="number")return qe(i,e,t);if(typeof t=="string")return Ue(i,e,t);if(Array.isArray(t)&&!t.length)return i.removeAttribute(e);const n=(r=(s=o0[e])==null?void 0:s.call(o0,t))!=null?r:t;return i.setAttribute(e,n)},vC=i=>{var e;return!!((e=i.closest)!=null&&e.call(i,'*[slot="media"]'))},er=(i,e)=>{if(vC(i))return;const t=(r,n)=>{var a,o;vh(r)&&n(r);const{children:l=[]}=r??{},d=(o=(a=r?.shadowRoot)==null?void 0:a.children)!=null?o:[];[...l,...d].forEach(c=>er(c,n))},s=i?.nodeName.toLowerCase();if(s.includes("-")&&!vh(i)){k.customElements.whenDefined(s).then(()=>{t(i,e)});return}t(i,e)},l0=(i,e,t)=>{i.forEach(s=>{if(e in s){s[e]=t;return}const r=vT(s),n=e.toLowerCase();r.includes(n)&&gC(s,n,t)})},EC=(i,e,t)=>{er(i,e);const s=u=>{var c;const h=(c=u?.composedPath()[0])!=null?c:u.target;e(h)},r=u=>{var c;const h=(c=u?.composedPath()[0])!=null?c:u.target;t(h)};i.addEventListener(X.REGISTER_MEDIA_STATE_RECEIVER,s),i.addEventListener(X.UNREGISTER_MEDIA_STATE_RECEIVER,r);const n=u=>{u.forEach(c=>{const{addedNodes:h=[],removedNodes:f=[],type:m,target:g,attributeName:p}=c;m==="childList"?(Array.prototype.forEach.call(h,E=>er(E,e)),Array.prototype.forEach.call(f,E=>er(E,t))):m==="attributes"&&p===_e.MEDIA_CHROME_ATTRIBUTES&&(vh(g)?e(g):t(g))})};let a=[];const o=u=>{const c=u.target;c.name!=="media"&&(a.forEach(h=>er(h,t)),a=[...c.assignedElements({flatten:!0})],a.forEach(h=>er(h,e)))};i.addEventListener("slotchange",o);const l=new MutationObserver(n);return l.observe(i,{childList:!0,attributes:!0,subtree:!0}),()=>{er(i,t),i.removeEventListener("slotchange",o),l.disconnect(),i.removeEventListener(X.REGISTER_MEDIA_STATE_RECEIVER,s),i.removeEventListener(X.UNREGISTER_MEDIA_STATE_RECEIVER,r)}};k.customElements.get("media-controller")||k.customElements.define("media-controller",gT);var yC=gT;const Or={PLACEMENT:"placement",BOUNDS:"bounds"};function TC(i){return`
    <style>
      :host {
        --_tooltip-background-color: var(--media-tooltip-background-color, var(--media-secondary-color, rgba(20, 20, 30, .7)));
        --_tooltip-background: var(--media-tooltip-background, var(--_tooltip-background-color));
        --_tooltip-arrow-half-width: calc(var(--media-tooltip-arrow-width, 12px) / 2);
        --_tooltip-arrow-height: var(--media-tooltip-arrow-height, 5px);
        --_tooltip-arrow-background: var(--media-tooltip-arrow-color, var(--_tooltip-background-color));
        position: relative;
        pointer-events: none;
        display: var(--media-tooltip-display, inline-flex);
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        z-index: var(--media-tooltip-z-index, 1);
        background: var(--_tooltip-background);
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        font: var(--media-font,
          var(--media-font-weight, 400)
          var(--media-font-size, 13px) /
          var(--media-text-content-height, var(--media-control-height, 18px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        padding: var(--media-tooltip-padding, .35em .7em);
        border: var(--media-tooltip-border, none);
        border-radius: var(--media-tooltip-border-radius, 5px);
        filter: var(--media-tooltip-filter, drop-shadow(0 0 4px rgba(0, 0, 0, .2)));
        white-space: var(--media-tooltip-white-space, nowrap);
      }

      :host([hidden]) {
        display: none;
      }

      img, svg {
        display: inline-block;
      }

      #arrow {
        position: absolute;
        width: 0px;
        height: 0px;
        border-style: solid;
        display: var(--media-tooltip-arrow-display, block);
      }

      :host(:not([placement])),
      :host([placement="top"]) {
        position: absolute;
        bottom: calc(100% + var(--media-tooltip-distance, 12px));
        left: 50%;
        transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);
      }
      :host(:not([placement])) #arrow,
      :host([placement="top"]) #arrow {
        top: 100%;
        left: 50%;
        border-width: var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width);
        border-color: var(--_tooltip-arrow-background) transparent transparent transparent;
        transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);
      }

      :host([placement="right"]) {
        position: absolute;
        left: calc(100% + var(--media-tooltip-distance, 12px));
        top: 50%;
        transform: translate(0, -50%);
      }
      :host([placement="right"]) #arrow {
        top: 50%;
        right: 100%;
        border-width: var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0;
        border-color: transparent var(--_tooltip-arrow-background) transparent transparent;
        transform: translate(0, -50%);
      }

      :host([placement="bottom"]) {
        position: absolute;
        top: calc(100% + var(--media-tooltip-distance, 12px));
        left: 50%;
        transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);
      }
      :host([placement="bottom"]) #arrow {
        bottom: 100%;
        left: 50%;
        border-width: 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width);
        border-color: transparent transparent var(--_tooltip-arrow-background) transparent;
        transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);
      }

      :host([placement="left"]) {
        position: absolute;
        right: calc(100% + var(--media-tooltip-distance, 12px));
        top: 50%;
        transform: translate(0, -50%);
      }
      :host([placement="left"]) #arrow {
        top: 50%;
        left: 100%;
        border-width: var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height);
        border-color: transparent transparent transparent var(--_tooltip-arrow-background);
        transform: translate(0, -50%);
      }
      
      :host([placement="none"]) #arrow {
        display: none;
      }
    </style>
    <slot></slot>
    <div id="arrow"></div>
  `}class vu extends k.HTMLElement{constructor(){if(super(),this.updateXOffset=()=>{var e;if(!Jy(this,{checkOpacity:!1,checkVisibilityCSS:!1}))return;const t=this.placement;if(t==="left"||t==="right"){this.style.removeProperty("--media-tooltip-offset-x");return}const s=getComputedStyle(this),r=(e=$n(this,"#"+this.bounds))!=null?e:Ct(this);if(!r)return;const{x:n,width:a}=r.getBoundingClientRect(),{x:o,width:l}=this.getBoundingClientRect(),d=o+l,u=n+a,c=s.getPropertyValue("--media-tooltip-offset-x"),h=c?parseFloat(c.replace("px","")):0,f=s.getPropertyValue("--media-tooltip-container-margin"),m=f?parseFloat(f.replace("px","")):0,g=o-n+h-m,p=d-u+h+m;if(g<0){this.style.setProperty("--media-tooltip-offset-x",`${g}px`);return}if(p>0){this.style.setProperty("--media-tooltip-offset-x",`${p}px`);return}this.style.removeProperty("--media-tooltip-offset-x")},!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}if(this.arrowEl=this.shadowRoot.querySelector("#arrow"),Object.prototype.hasOwnProperty.call(this,"placement")){const e=this.placement;delete this.placement,this.placement=e}}static get observedAttributes(){return[Or.PLACEMENT,Or.BOUNDS]}get placement(){return Ne(this,Or.PLACEMENT)}set placement(e){Ue(this,Or.PLACEMENT,e)}get bounds(){return Ne(this,Or.BOUNDS)}set bounds(e){Ue(this,Or.BOUNDS,e)}}vu.shadowRootOptions={mode:"open"};vu.getTemplateHTML=TC;k.customElements.get("media-tooltip")||k.customElements.define("media-tooltip",vu);var d0=vu,um=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Xe=(i,e,t)=>(um(i,e,"read from private field"),t?t.call(i):e.get(i)),Nr=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Uo=(i,e,t,s)=>(um(i,e,"write to private field"),e.set(i,t),t),bC=(i,e,t)=>(um(i,e,"access private method"),t),ki,hn,Ns,jr,bl,Eh,ET;const _s={TOOLTIP_PLACEMENT:"tooltipplacement",DISABLED:"disabled",NO_TOOLTIP:"notooltip"};function _C(i,e={}){return`
    <style>
      :host {
        position: relative;
        font: var(--media-font,
          var(--media-font-weight, bold)
          var(--media-font-size, 14px) /
          var(--media-text-content-height, var(--media-control-height, 24px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
        padding: var(--media-button-padding, var(--media-control-padding, 10px));
        justify-content: var(--media-button-justify-content, center);
        display: inline-flex;
        align-items: center;
        vertical-align: middle;
        box-sizing: border-box;
        transition: background .15s linear;
        pointer-events: auto;
        cursor: var(--media-cursor, pointer);
        -webkit-tap-highlight-color: transparent;
      }

      
      :host(:focus-visible) {
        box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
        outline: 0;
      }
      
      :host(:where(:focus)) {
        box-shadow: none;
        outline: 0;
      }

      :host(:hover) {
        background: var(--media-control-hover-background, rgba(50 50 70 / .7));
      }

      svg, img, ::slotted(svg), ::slotted(img) {
        width: var(--media-button-icon-width);
        height: var(--media-button-icon-height, var(--media-control-height, 24px));
        transform: var(--media-button-icon-transform);
        transition: var(--media-button-icon-transition);
        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
        vertical-align: middle;
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
      }

      media-tooltip {
        
        max-width: 0;
        overflow-x: clip;
        opacity: 0;
        transition: opacity .3s, max-width 0s 9s;
      }

      :host(:hover) media-tooltip,
      :host(:focus-visible) media-tooltip {
        max-width: 100vw;
        opacity: 1;
        transition: opacity .3s;
      }

      :host([notooltip]) slot[name="tooltip"] {
        display: none;
      }
    </style>

    ${this.getSlotTemplateHTML(i,e)}

    <slot name="tooltip">
      <media-tooltip part="tooltip" aria-hidden="true">
        <template shadowrootmode="${d0.shadowRootOptions.mode}">
          ${d0.getTemplateHTML({})}
        </template>
        <slot name="tooltip-content">
          ${this.getTooltipContentHTML(i)}
        </slot>
      </media-tooltip>
    </slot>
  `}function AC(i,e){return`
    <slot></slot>
  `}function SC(){return""}class yt extends k.HTMLElement{constructor(){if(super(),Nr(this,Eh),Nr(this,ki,void 0),this.preventClick=!1,this.tooltipEl=null,Nr(this,hn,e=>{this.preventClick||this.handleClick(e),setTimeout(Xe(this,Ns),0)}),Nr(this,Ns,()=>{var e,t;(t=(e=this.tooltipEl)==null?void 0:e.updateXOffset)==null||t.call(e)}),Nr(this,jr,e=>{const{key:t}=e;if(!this.keysUsed.includes(t)){this.removeEventListener("keyup",Xe(this,jr));return}this.preventClick||this.handleClick(e)}),Nr(this,bl,e=>{const{metaKey:t,altKey:s,key:r}=e;if(t||s||!this.keysUsed.includes(r)){this.removeEventListener("keyup",Xe(this,jr));return}this.addEventListener("keyup",Xe(this,jr),{once:!0})}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes),t=this.constructor.getTemplateHTML(e);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(t):this.shadowRoot.innerHTML=t}this.tooltipEl=this.shadowRoot.querySelector("media-tooltip")}static get observedAttributes(){return["disabled",_s.TOOLTIP_PLACEMENT,_e.MEDIA_CONTROLLER,_.MEDIA_LANG]}enable(){this.addEventListener("click",Xe(this,hn)),this.addEventListener("keydown",Xe(this,bl)),this.tabIndex=0}disable(){this.removeEventListener("click",Xe(this,hn)),this.removeEventListener("keydown",Xe(this,bl)),this.removeEventListener("keyup",Xe(this,jr)),this.tabIndex=-1}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===_e.MEDIA_CONTROLLER?(t&&((n=(r=Xe(this,ki))==null?void 0:r.unassociateElement)==null||n.call(r,this),Uo(this,ki,null)),s&&this.isConnected&&(Uo(this,ki,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Xe(this,ki))==null?void 0:o.associateElement)==null||l.call(o,this))):e==="disabled"&&s!==t?s==null?this.enable():this.disable():e===_s.TOOLTIP_PLACEMENT&&this.tooltipEl&&s!==t?this.tooltipEl.placement=s:e===_.MEDIA_LANG&&(this.shadowRoot.querySelector('slot[name="tooltip-content"]').innerHTML=this.constructor.getTooltipContentHTML()),Xe(this,Ns).call(this)}connectedCallback(){var e,t,s;const{style:r}=et(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`),this.hasAttribute("disabled")?this.disable():this.enable(),this.setAttribute("role","button");const n=this.getAttribute(_e.MEDIA_CONTROLLER);n&&(Uo(this,ki,(e=this.getRootNode())==null?void 0:e.getElementById(n)),(s=(t=Xe(this,ki))==null?void 0:t.associateElement)==null||s.call(t,this)),k.customElements.whenDefined("media-tooltip").then(()=>bC(this,Eh,ET).call(this))}disconnectedCallback(){var e,t;this.disable(),(t=(e=Xe(this,ki))==null?void 0:e.unassociateElement)==null||t.call(e,this),Uo(this,ki,null),this.removeEventListener("mouseenter",Xe(this,Ns)),this.removeEventListener("focus",Xe(this,Ns)),this.removeEventListener("click",Xe(this,hn))}get keysUsed(){return["Enter"," "]}get tooltipPlacement(){return Ne(this,_s.TOOLTIP_PLACEMENT)}set tooltipPlacement(e){Ue(this,_s.TOOLTIP_PLACEMENT,e)}get mediaController(){return Ne(this,_e.MEDIA_CONTROLLER)}set mediaController(e){Ue(this,_e.MEDIA_CONTROLLER,e)}get disabled(){return Ee(this,_s.DISABLED)}set disabled(e){ye(this,_s.DISABLED,e)}get noTooltip(){return Ee(this,_s.NO_TOOLTIP)}set noTooltip(e){ye(this,_s.NO_TOOLTIP,e)}handleClick(e){}}ki=new WeakMap;hn=new WeakMap;Ns=new WeakMap;jr=new WeakMap;bl=new WeakMap;Eh=new WeakSet;ET=function(){this.addEventListener("mouseenter",Xe(this,Ns)),this.addEventListener("focus",Xe(this,Ns)),this.addEventListener("click",Xe(this,hn));const i=this.tooltipPlacement;i&&this.tooltipEl&&(this.tooltipEl.placement=i)};yt.shadowRootOptions={mode:"open"};yt.getTemplateHTML=_C;yt.getSlotTemplateHTML=AC;yt.getTooltipContentHTML=SC;k.customElements.get("media-chrome-button")||k.customElements.define("media-chrome-button",yt);const u0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`;function IC(i){return`
    <style>
      :host([${_.MEDIA_IS_AIRPLAYING}]) slot[name=icon] slot:not([name=exit]) {
        display: none !important;
      }

      
      :host(:not([${_.MEDIA_IS_AIRPLAYING}])) slot[name=icon] slot:not([name=enter]) {
        display: none !important;
      }

      :host([${_.MEDIA_IS_AIRPLAYING}]) slot[name=tooltip-enter],
      :host(:not([${_.MEDIA_IS_AIRPLAYING}])) slot[name=tooltip-exit] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="enter">${u0}</slot>
      <slot name="exit">${u0}</slot>
    </slot>
  `}function LC(){return`
    <slot name="tooltip-enter">${J("start airplay")}</slot>
    <slot name="tooltip-exit">${J("stop airplay")}</slot>
  `}const c0=i=>{const e=i.mediaIsAirplaying?J("stop airplay"):J("start airplay");i.setAttribute("aria-label",e)};class cm extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_IS_AIRPLAYING,_.MEDIA_AIRPLAY_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),c0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_IS_AIRPLAYING&&c0(this)}get mediaIsAirplaying(){return Ee(this,_.MEDIA_IS_AIRPLAYING)}set mediaIsAirplaying(e){ye(this,_.MEDIA_IS_AIRPLAYING,e)}get mediaAirplayUnavailable(){return Ne(this,_.MEDIA_AIRPLAY_UNAVAILABLE)}set mediaAirplayUnavailable(e){Ue(this,_.MEDIA_AIRPLAY_UNAVAILABLE,e)}handleClick(){const e=new k.CustomEvent(X.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}}cm.getSlotTemplateHTML=IC;cm.getTooltipContentHTML=LC;k.customElements.get("media-airplay-button")||k.customElements.define("media-airplay-button",cm);const RC=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,xC=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`;function kC(i){return`
    <style>
      :host([aria-checked="true"]) slot[name=off] {
        display: none !important;
      }

      
      :host(:not([aria-checked="true"])) slot[name=on] {
        display: none !important;
      }

      :host([aria-checked="true"]) slot[name=tooltip-enable],
      :host(:not([aria-checked="true"])) slot[name=tooltip-disable] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="on">${RC}</slot>
      <slot name="off">${xC}</slot>
    </slot>
  `}function DC(){return`
    <slot name="tooltip-enable">${J("Enable captions")}</slot>
    <slot name="tooltip-disable">${J("Disable captions")}</slot>
  `}const h0=i=>{i.setAttribute("aria-checked",uT(i).toString())};class hm extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_SUBTITLES_LIST,_.MEDIA_SUBTITLES_SHOWING]}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",J("closed captions")),h0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_SUBTITLES_SHOWING&&h0(this)}get mediaSubtitlesList(){return f0(this,_.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){m0(this,_.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return f0(this,_.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){m0(this,_.MEDIA_SUBTITLES_SHOWING,e)}handleClick(){this.dispatchEvent(new k.CustomEvent(X.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}))}}hm.getSlotTemplateHTML=kC;hm.getTooltipContentHTML=DC;const f0=(i,e)=>{const t=i.getAttribute(e);return t?pu(t):[]},m0=(i,e,t)=>{if(!t?.length){i.removeAttribute(e);return}const s=Za(t);i.getAttribute(e)!==s&&i.setAttribute(e,s)};k.customElements.get("media-captions-button")||k.customElements.define("media-captions-button",hm);const CC='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>',wC='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>';function MC(i){return`
    <style>
      :host([${_.MEDIA_IS_CASTING}]) slot[name=icon] slot:not([name=exit]) {
        display: none !important;
      }

      
      :host(:not([${_.MEDIA_IS_CASTING}])) slot[name=icon] slot:not([name=enter]) {
        display: none !important;
      }

      :host([${_.MEDIA_IS_CASTING}]) slot[name=tooltip-enter],
      :host(:not([${_.MEDIA_IS_CASTING}])) slot[name=tooltip-exit] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="enter">${CC}</slot>
      <slot name="exit">${wC}</slot>
    </slot>
  `}function PC(){return`
    <slot name="tooltip-enter">${J("Start casting")}</slot>
    <slot name="tooltip-exit">${J("Stop casting")}</slot>
  `}const p0=i=>{const e=i.mediaIsCasting?J("stop casting"):J("start casting");i.setAttribute("aria-label",e)};class fm extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_IS_CASTING,_.MEDIA_CAST_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),p0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_IS_CASTING&&p0(this)}get mediaIsCasting(){return Ee(this,_.MEDIA_IS_CASTING)}set mediaIsCasting(e){ye(this,_.MEDIA_IS_CASTING,e)}get mediaCastUnavailable(){return Ne(this,_.MEDIA_CAST_UNAVAILABLE)}set mediaCastUnavailable(e){Ue(this,_.MEDIA_CAST_UNAVAILABLE,e)}handleClick(){const e=this.mediaIsCasting?X.MEDIA_EXIT_CAST_REQUEST:X.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new k.CustomEvent(e,{composed:!0,bubbles:!0}))}}fm.getSlotTemplateHTML=MC;fm.getTooltipContentHTML=PC;k.customElements.get("media-cast-button")||k.customElements.define("media-cast-button",fm);var mm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},yr=(i,e,t)=>(mm(i,e,"read from private field"),e.get(i)),ts=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},pm=(i,e,t,s)=>(mm(i,e,"write to private field"),e.set(i,t),t),zs=(i,e,t)=>(mm(i,e,"access private method"),t),Od,eo,Ir,_l,yh,Th,yT,bh,TT,_h,bT,Ah,_T,Sh,AT;function OC(i){return`
    <style>
      :host {
        font: var(--media-font,
          var(--media-font-weight, normal)
          var(--media-font-size, 14px) /
          var(--media-text-content-height, var(--media-control-height, 24px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        display: var(--media-dialog-display, inline-flex);
        justify-content: center;
        align-items: center;
        
        transition-behavior: allow-discrete;
        visibility: hidden;
        opacity: 0;
        transform: translateY(2px) scale(.99);
        pointer-events: none;
      }

      :host([open]) {
        transition: display .2s, visibility 0s, opacity .2s ease-out, transform .15s ease-out;
        visibility: visible;
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }

      #content {
        display: flex;
        position: relative;
        box-sizing: border-box;
        width: min(320px, 100%);
        word-wrap: break-word;
        max-height: 100%;
        overflow: auto;
        text-align: center;
        line-height: 1.4;
      }
    </style>
    ${this.getSlotTemplateHTML(i)}
  `}function NC(i){return`
    <slot id="content"></slot>
  `}const qn={OPEN:"open",ANCHOR:"anchor"};class co extends k.HTMLElement{constructor(){super(),ts(this,_l),ts(this,Th),ts(this,bh),ts(this,_h),ts(this,Ah),ts(this,Sh),ts(this,Od,!1),ts(this,eo,null),ts(this,Ir,null),this.addEventListener("invoke",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this)}static get observedAttributes(){return[qn.OPEN,qn.ANCHOR]}get open(){return Ee(this,qn.OPEN)}set open(e){ye(this,qn.OPEN,e)}handleEvent(e){switch(e.type){case"invoke":zs(this,_h,bT).call(this,e);break;case"focusout":zs(this,Ah,_T).call(this,e);break;case"keydown":zs(this,Sh,AT).call(this,e);break}}connectedCallback(){zs(this,_l,yh).call(this),this.role||(this.role="dialog")}attributeChangedCallback(e,t,s){zs(this,_l,yh).call(this),e===qn.OPEN&&s!==t&&(this.open?zs(this,Th,yT).call(this):zs(this,bh,TT).call(this))}focus(){pm(this,eo,sm());const e=!this.dispatchEvent(new Event("focus",{composed:!0,cancelable:!0})),t=!this.dispatchEvent(new Event("focusin",{composed:!0,bubbles:!0,cancelable:!0}));if(e||t)return;const s=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');s?.focus()}get keysUsed(){return["Escape","Tab"]}}Od=new WeakMap;eo=new WeakMap;Ir=new WeakMap;_l=new WeakSet;yh=function(){if(!yr(this,Od)&&(pm(this,Od,!0),!this.shadowRoot)){this.attachShadow(this.constructor.shadowRootOptions);const i=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(i),queueMicrotask(()=>{const{style:e}=et(this.shadowRoot,":host");e.setProperty("transition","display .15s, visibility .15s, opacity .15s ease-in, transform .15s ease-in")})}};Th=new WeakSet;yT=function(){var i;(i=yr(this,Ir))==null||i.setAttribute("aria-expanded","true"),this.dispatchEvent(new Event("open",{composed:!0,bubbles:!0})),this.addEventListener("transitionend",()=>this.focus(),{once:!0})};bh=new WeakSet;TT=function(){var i;(i=yr(this,Ir))==null||i.setAttribute("aria-expanded","false"),this.dispatchEvent(new Event("close",{composed:!0,bubbles:!0}))};_h=new WeakSet;bT=function(i){pm(this,Ir,i.relatedTarget),ps(this,i.relatedTarget)||(this.open=!this.open)};Ah=new WeakSet;_T=function(i){var e;ps(this,i.relatedTarget)||((e=yr(this,eo))==null||e.focus(),yr(this,Ir)&&yr(this,Ir)!==i.relatedTarget&&this.open&&(this.open=!1))};Sh=new WeakSet;AT=function(i){var e,t,s,r,n;const{key:a,ctrlKey:o,altKey:l,metaKey:d}=i;o||l||d||this.keysUsed.includes(a)&&(i.preventDefault(),i.stopPropagation(),a==="Tab"?(i.shiftKey?(t=(e=this.previousElementSibling)==null?void 0:e.focus)==null||t.call(e):(r=(s=this.nextElementSibling)==null?void 0:s.focus)==null||r.call(s),this.blur()):a==="Escape"&&((n=yr(this,eo))==null||n.focus(),this.open=!1))};co.shadowRootOptions={mode:"open"};co.getTemplateHTML=OC;co.getSlotTemplateHTML=NC;k.customElements.get("media-chrome-dialog")||k.customElements.define("media-chrome-dialog",co);var gm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Be=(i,e,t)=>(gm(i,e,"read from private field"),t?t.call(i):e.get(i)),pt=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Is=(i,e,t,s)=>(gm(i,e,"write to private field"),e.set(i,t),t),hi=(i,e,t)=>(gm(i,e,"access private method"),t),Di,Eu,Al,Sl,fi,Nd,Il,Ll,Rl,vm,ST,xl,Ih,kl,Lh,Ud,Em,Rh,IT,xh,LT,kh,RT,Dh,xT;function UC(i){return`
    <style>
      :host {
        --_focus-box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
        --_media-range-padding: var(--media-range-padding, var(--media-control-padding, 10px));

        box-shadow: var(--_focus-visible-box-shadow, none);
        background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
        height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
        display: inline-flex;
        align-items: center;
        
        vertical-align: middle;
        box-sizing: border-box;
        position: relative;
        width: 100px;
        transition: background .15s linear;
        cursor: var(--media-cursor, pointer);
        pointer-events: auto;
        touch-action: none; 
      }

      
      input[type=range]:focus {
        outline: 0;
      }
      input[type=range]:focus::-webkit-slider-runnable-track {
        outline: 0;
      }

      :host(:hover) {
        background: var(--media-control-hover-background, rgb(50 50 70 / .7));
      }

      #leftgap {
        padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      }

      #rightgap {
        padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      }

      #startpoint,
      #endpoint {
        position: absolute;
      }

      #endpoint {
        right: 0;
      }

      #container {
        
        width: var(--media-range-track-width, 100%);
        transform: translate(var(--media-range-track-translate-x, 0px), var(--media-range-track-translate-y, 0px));
        position: relative;
        height: 100%;
        display: flex;
        align-items: center;
        min-width: 40px;
      }

      #range {
        
        display: var(--media-time-range-hover-display, block);
        bottom: var(--media-time-range-hover-bottom, -7px);
        height: var(--media-time-range-hover-height, max(100% + 7px, 25px));
        width: 100%;
        position: absolute;
        cursor: var(--media-cursor, pointer);

        -webkit-appearance: none; 
        -webkit-tap-highlight-color: transparent;
        background: transparent; 
        margin: 0;
        z-index: 1;
      }

      @media (hover: hover) {
        #range {
          bottom: var(--media-time-range-hover-bottom, -5px);
          height: var(--media-time-range-hover-height, max(100% + 5px, 20px));
        }
      }

      
      
      #range::-webkit-slider-thumb {
        -webkit-appearance: none;
        background: transparent;
        width: .1px;
        height: .1px;
      }

      
      #range::-moz-range-thumb {
        background: transparent;
        border: transparent;
        width: .1px;
        height: .1px;
      }

      #appearance {
        height: var(--media-range-track-height, 4px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 100%;
        position: absolute;
        
        will-change: transform;
      }

      #track {
        background: var(--media-range-track-background, rgb(255 255 255 / .2));
        border-radius: var(--media-range-track-border-radius, 1px);
        border: var(--media-range-track-border, none);
        outline: var(--media-range-track-outline);
        outline-offset: var(--media-range-track-outline-offset);
        backdrop-filter: var(--media-range-track-backdrop-filter);
        -webkit-backdrop-filter: var(--media-range-track-backdrop-filter);
        box-shadow: var(--media-range-track-box-shadow, none);
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #progress,
      #pointer {
        position: absolute;
        height: 100%;
        will-change: width;
      }

      #progress {
        background: var(--media-range-bar-color, var(--media-primary-color, rgb(238 238 238)));
        transition: var(--media-range-track-transition);
      }

      #pointer {
        background: var(--media-range-track-pointer-background);
        border-right: var(--media-range-track-pointer-border-right);
        transition: visibility .25s, opacity .25s;
        visibility: hidden;
        opacity: 0;
      }

      @media (hover: hover) {
        :host(:hover) #pointer {
          transition: visibility .5s, opacity .5s;
          visibility: visible;
          opacity: 1;
        }
      }

      #thumb,
      ::slotted([slot=thumb]) {
        width: var(--media-range-thumb-width, 10px);
        height: var(--media-range-thumb-height, 10px);
        transition: var(--media-range-thumb-transition);
        transform: var(--media-range-thumb-transform, none);
        opacity: var(--media-range-thumb-opacity, 1);
        translate: -50%;
        position: absolute;
        left: 0;
        cursor: var(--media-cursor, pointer);
      }

      #thumb {
        border-radius: var(--media-range-thumb-border-radius, 10px);
        background: var(--media-range-thumb-background, var(--media-primary-color, rgb(238 238 238)));
        box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
        border: var(--media-range-thumb-border, none);
      }

      :host([disabled]) #thumb {
        background-color: #777;
      }

      .segments #appearance {
        height: var(--media-range-segment-hover-height, 7px);
      }

      #track {
        clip-path: url(#segments-clipping);
      }

      #segments {
        --segments-gap: var(--media-range-segments-gap, 2px);
        position: absolute;
        width: 100%;
        height: 100%;
      }

      #segments-clipping {
        transform: translateX(calc(var(--segments-gap) / 2));
      }

      #segments-clipping:empty {
        display: none;
      }

      #segments-clipping rect {
        height: var(--media-range-track-height, 4px);
        y: calc((var(--media-range-segment-hover-height, 7px) - var(--media-range-track-height, 4px)) / 2);
        transition: var(--media-range-segment-transition, transform .1s ease-in-out);
        transform: var(--media-range-segment-transform, scaleY(1));
        transform-origin: center;
      }
    </style>
    <div id="leftgap"></div>
    <div id="container">
      <div id="startpoint"></div>
      <div id="endpoint"></div>
      <div id="appearance">
        <div id="track" part="track">
          <div id="pointer"></div>
          <div id="progress" part="progress"></div>
        </div>
        <slot name="thumb">
          <div id="thumb" part="thumb"></div>
        </slot>
        <svg id="segments"><clipPath id="segments-clipping"></clipPath></svg>
      </div>
      <input id="range" type="range" min="0" max="1" step="any" value="0">
    </div>
    <div id="rightgap"></div>
  `}class Fn extends k.HTMLElement{constructor(){if(super(),pt(this,vm),pt(this,xl),pt(this,kl),pt(this,Ud),pt(this,Rh),pt(this,xh),pt(this,kh),pt(this,Dh),pt(this,Di,void 0),pt(this,Eu,void 0),pt(this,Al,void 0),pt(this,Sl,void 0),pt(this,fi,{}),pt(this,Nd,[]),pt(this,Il,()=>{if(this.range.matches(":focus-visible")){const{style:e}=et(this.shadowRoot,":host");e.setProperty("--_focus-visible-box-shadow","var(--_focus-box-shadow)")}}),pt(this,Ll,()=>{const{style:e}=et(this.shadowRoot,":host");e.removeProperty("--_focus-visible-box-shadow")}),pt(this,Rl,()=>{const e=this.shadowRoot.querySelector("#segments-clipping");e&&e.parentNode.append(e)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes),t=this.constructor.getTemplateHTML(e);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(t):this.shadowRoot.innerHTML=t}this.container=this.shadowRoot.querySelector("#container"),Is(this,Al,this.shadowRoot.querySelector("#startpoint")),Is(this,Sl,this.shadowRoot.querySelector("#endpoint")),this.range=this.shadowRoot.querySelector("#range"),this.appearance=this.shadowRoot.querySelector("#appearance")}static get observedAttributes(){return["disabled","aria-disabled",_e.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===_e.MEDIA_CONTROLLER?(t&&((n=(r=Be(this,Di))==null?void 0:r.unassociateElement)==null||n.call(r,this),Is(this,Di,null)),s&&this.isConnected&&(Is(this,Di,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Be(this,Di))==null?void 0:o.associateElement)==null||l.call(o,this))):(e==="disabled"||e==="aria-disabled"&&t!==s)&&(s==null?(this.range.removeAttribute(e),hi(this,xl,Ih).call(this)):(this.range.setAttribute(e,s),hi(this,kl,Lh).call(this)))}connectedCallback(){var e,t,s;const{style:r}=et(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`),Be(this,fi).pointer=et(this.shadowRoot,"#pointer"),Be(this,fi).progress=et(this.shadowRoot,"#progress"),Be(this,fi).thumb=et(this.shadowRoot,'#thumb, ::slotted([slot="thumb"])'),Be(this,fi).activeSegment=et(this.shadowRoot,"#segments-clipping rect:nth-child(0)");const n=this.getAttribute(_e.MEDIA_CONTROLLER);n&&(Is(this,Di,(e=this.getRootNode())==null?void 0:e.getElementById(n)),(s=(t=Be(this,Di))==null?void 0:t.associateElement)==null||s.call(t,this)),this.updateBar(),this.shadowRoot.addEventListener("focusin",Be(this,Il)),this.shadowRoot.addEventListener("focusout",Be(this,Ll)),hi(this,xl,Ih).call(this),Cn(this.container,Be(this,Rl))}disconnectedCallback(){var e,t;hi(this,kl,Lh).call(this),(t=(e=Be(this,Di))==null?void 0:e.unassociateElement)==null||t.call(e,this),Is(this,Di,null),this.shadowRoot.removeEventListener("focusin",Be(this,Il)),this.shadowRoot.removeEventListener("focusout",Be(this,Ll)),wn(this.container,Be(this,Rl))}updatePointerBar(e){var t;(t=Be(this,fi).pointer)==null||t.style.setProperty("width",`${this.getPointerRatio(e)*100}%`)}updateBar(){var e,t;const s=this.range.valueAsNumber*100;(e=Be(this,fi).progress)==null||e.style.setProperty("width",`${s}%`),(t=Be(this,fi).thumb)==null||t.style.setProperty("left",`${s}%`)}updateSegments(e){const t=this.shadowRoot.querySelector("#segments-clipping");if(t.textContent="",this.container.classList.toggle("segments",!!e?.length),!e?.length)return;const s=[...new Set([+this.range.min,...e.flatMap(n=>[n.start,n.end]),+this.range.max])];Is(this,Nd,[...s]);const r=s.pop();for(const[n,a]of s.entries()){const[o,l]=[n===0,n===s.length-1],d=o?"calc(var(--segments-gap) / -1)":`${a*100}%`,c=`calc(${((l?r:s[n+1])-a)*100}%${o||l?"":" - var(--segments-gap)"})`,h=ut.createElementNS("http://www.w3.org/2000/svg","rect"),f=et(this.shadowRoot,`#segments-clipping rect:nth-child(${n+1})`);f.style.setProperty("x",d),f.style.setProperty("width",c),t.append(h)}}getPointerRatio(e){return wD(e.clientX,e.clientY,Be(this,Al).getBoundingClientRect(),Be(this,Sl).getBoundingClientRect())}get dragging(){return this.hasAttribute("dragging")}handleEvent(e){switch(e.type){case"pointermove":hi(this,Dh,xT).call(this,e);break;case"input":this.updateBar();break;case"pointerenter":hi(this,Rh,IT).call(this,e);break;case"pointerdown":hi(this,Ud,Em).call(this,e);break;case"pointerup":hi(this,xh,LT).call(this);break;case"pointerleave":hi(this,kh,RT).call(this);break}}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}Di=new WeakMap;Eu=new WeakMap;Al=new WeakMap;Sl=new WeakMap;fi=new WeakMap;Nd=new WeakMap;Il=new WeakMap;Ll=new WeakMap;Rl=new WeakMap;vm=new WeakSet;ST=function(i){const e=Be(this,fi).activeSegment;if(!e)return;const t=this.getPointerRatio(i),r=`#segments-clipping rect:nth-child(${Be(this,Nd).findIndex((n,a,o)=>{const l=o[a+1];return l!=null&&t>=n&&t<=l})+1})`;(e.selectorText!=r||!e.style.transform)&&(e.selectorText=r,e.style.setProperty("transform","var(--media-range-segment-hover-transform, scaleY(2))"))};xl=new WeakSet;Ih=function(){this.hasAttribute("disabled")||(this.addEventListener("input",this),this.addEventListener("pointerdown",this),this.addEventListener("pointerenter",this))};kl=new WeakSet;Lh=function(){var i,e;this.removeEventListener("input",this),this.removeEventListener("pointerdown",this),this.removeEventListener("pointerenter",this),(i=k.window)==null||i.removeEventListener("pointerup",this),(e=k.window)==null||e.removeEventListener("pointermove",this)};Ud=new WeakSet;Em=function(i){var e;Is(this,Eu,i.composedPath().includes(this.range)),(e=k.window)==null||e.addEventListener("pointerup",this)};Rh=new WeakSet;IT=function(i){var e;i.pointerType!=="mouse"&&hi(this,Ud,Em).call(this,i),this.addEventListener("pointerleave",this),(e=k.window)==null||e.addEventListener("pointermove",this)};xh=new WeakSet;LT=function(){var i;(i=k.window)==null||i.removeEventListener("pointerup",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled")};kh=new WeakSet;RT=function(){var i,e;this.removeEventListener("pointerleave",this),(i=k.window)==null||i.removeEventListener("pointermove",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled"),(e=Be(this,fi).activeSegment)==null||e.style.removeProperty("transform")};Dh=new WeakSet;xT=function(i){i.pointerType==="pen"&&i.buttons===0||(this.toggleAttribute("dragging",i.buttons===1||i.pointerType!=="mouse"),this.updatePointerBar(i),hi(this,vm,ST).call(this,i),this.dragging&&(i.pointerType!=="mouse"||!Be(this,Eu))&&(this.range.disabled=!0,this.range.valueAsNumber=this.getPointerRatio(i),this.range.dispatchEvent(new Event("input",{bubbles:!0,composed:!0}))))};Fn.shadowRootOptions={mode:"open"};Fn.getTemplateHTML=UC;k.customElements.get("media-chrome-range")||k.customElements.define("media-chrome-range",Fn);var kT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},$o=(i,e,t)=>(kT(i,e,"read from private field"),t?t.call(i):e.get(i)),$C=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Fo=(i,e,t,s)=>(kT(i,e,"write to private field"),e.set(i,t),t),Ci;function FC(i){return`
    <style>
      :host {
        
        box-sizing: border-box;
        display: var(--media-control-display, var(--media-control-bar-display, inline-flex));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        --media-loading-indicator-icon-height: 44px;
      }

      ::slotted(media-time-range),
      ::slotted(media-volume-range) {
        min-height: 100%;
      }

      ::slotted(media-time-range),
      ::slotted(media-clip-selector) {
        flex-grow: 1;
      }

      ::slotted([role="menu"]) {
        position: absolute;
      }
    </style>

    <slot></slot>
  `}class ym extends k.HTMLElement{constructor(){if(super(),$C(this,Ci,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}static get observedAttributes(){return[_e.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===_e.MEDIA_CONTROLLER&&(t&&((n=(r=$o(this,Ci))==null?void 0:r.unassociateElement)==null||n.call(r,this),Fo(this,Ci,null)),s&&this.isConnected&&(Fo(this,Ci,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=$o(this,Ci))==null?void 0:o.associateElement)==null||l.call(o,this)))}connectedCallback(){var e,t,s;const r=this.getAttribute(_e.MEDIA_CONTROLLER);r&&(Fo(this,Ci,(e=this.getRootNode())==null?void 0:e.getElementById(r)),(s=(t=$o(this,Ci))==null?void 0:t.associateElement)==null||s.call(t,this))}disconnectedCallback(){var e,t;(t=(e=$o(this,Ci))==null?void 0:e.unassociateElement)==null||t.call(e,this),Fo(this,Ci,null)}}Ci=new WeakMap;ym.shadowRootOptions={mode:"open"};ym.getTemplateHTML=FC;k.customElements.get("media-control-bar")||k.customElements.define("media-control-bar",ym);var DT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Bo=(i,e,t)=>(DT(i,e,"read from private field"),t?t.call(i):e.get(i)),BC=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Ho=(i,e,t,s)=>(DT(i,e,"write to private field"),e.set(i,t),t),wi;function HC(i,e={}){return`
    <style>
      :host {
        font: var(--media-font,
          var(--media-font-weight, normal)
          var(--media-font-size, 14px) /
          var(--media-text-content-height, var(--media-control-height, 24px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        background: var(--media-text-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7))));
        padding: var(--media-control-padding, 10px);
        display: inline-flex;
        justify-content: center;
        align-items: center;
        vertical-align: middle;
        box-sizing: border-box;
        text-align: center;
        pointer-events: auto;
      }

      
      :host(:focus-visible) {
        box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);
        outline: 0;
      }

      
      :host(:where(:focus)) {
        box-shadow: none;
        outline: 0;
      }
    </style>

    ${this.getSlotTemplateHTML(i,e)}
  `}function GC(i,e){return`
    <slot></slot>
  `}class Ks extends k.HTMLElement{constructor(){if(super(),BC(this,wi,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}static get observedAttributes(){return[_e.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===_e.MEDIA_CONTROLLER&&(t&&((n=(r=Bo(this,wi))==null?void 0:r.unassociateElement)==null||n.call(r,this),Ho(this,wi,null)),s&&this.isConnected&&(Ho(this,wi,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Bo(this,wi))==null?void 0:o.associateElement)==null||l.call(o,this)))}connectedCallback(){var e,t,s;const{style:r}=et(this.shadowRoot,":host");r.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`);const n=this.getAttribute(_e.MEDIA_CONTROLLER);n&&(Ho(this,wi,(e=this.getRootNode())==null?void 0:e.getElementById(n)),(s=(t=Bo(this,wi))==null?void 0:t.associateElement)==null||s.call(t,this))}disconnectedCallback(){var e,t;(t=(e=Bo(this,wi))==null?void 0:e.unassociateElement)==null||t.call(e,this),Ho(this,wi,null)}}wi=new WeakMap;Ks.shadowRootOptions={mode:"open"};Ks.getTemplateHTML=HC;Ks.getSlotTemplateHTML=GC;k.customElements.get("media-text-display")||k.customElements.define("media-text-display",Ks);var CT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},g0=(i,e,t)=>(CT(i,e,"read from private field"),t?t.call(i):e.get(i)),KC=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},VC=(i,e,t,s)=>(CT(i,e,"write to private field"),e.set(i,t),t),ma;function WC(i,e){return`
    <slot>${Fs(e.mediaDuration)}</slot>
  `}class wT extends Ks{constructor(){var e;super(),KC(this,ma,void 0),VC(this,ma,this.shadowRoot.querySelector("slot")),g0(this,ma).textContent=Fs((e=this.mediaDuration)!=null?e:0)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_DURATION]}attributeChangedCallback(e,t,s){e===_.MEDIA_DURATION&&(g0(this,ma).textContent=Fs(+s)),super.attributeChangedCallback(e,t,s)}get mediaDuration(){return Oe(this,_.MEDIA_DURATION)}set mediaDuration(e){qe(this,_.MEDIA_DURATION,e)}}ma=new WeakMap;wT.getSlotTemplateHTML=WC;k.customElements.get("media-duration-display")||k.customElements.define("media-duration-display",wT);const qC={2:J("Network Error"),3:J("Decode Error"),4:J("Source Not Supported"),5:J("Encryption Error")},YC={2:J("A network error caused the media download to fail."),3:J("A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format."),4:J("An unsupported error occurred. The server or network failed, or your browser does not support this format."),5:J("The media is encrypted and there are no keys to decrypt it.")},MT=i=>{var e,t;return i.code===1?null:{title:(e=qC[i.code])!=null?e:`Error ${i.code}`,message:(t=YC[i.code])!=null?t:i.message}};var PT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},jC=(i,e,t)=>(PT(i,e,"read from private field"),t?t.call(i):e.get(i)),zC=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},QC=(i,e,t,s)=>(PT(i,e,"write to private field"),e.set(i,t),t),Dl;function XC(i){return`
    <style>
      :host {
        background: rgb(20 20 30 / .8);
      }

      #content {
        display: block;
        padding: 1.2em 1.5em;
      }

      h3,
      p {
        margin-block: 0 .3em;
      }
    </style>
    <slot name="error-${i.mediaerrorcode}" id="content">
      ${OT({code:+i.mediaerrorcode,message:i.mediaerrormessage})}
    </slot>
  `}function ZC(i){return i.code&&MT(i)!==null}function OT(i){var e;const{title:t,message:s}=(e=MT(i))!=null?e:{};let r="";return t&&(r+=`<slot name="error-${i.code}-title"><h3>${t}</h3></slot>`),s&&(r+=`<slot name="error-${i.code}-message"><p>${s}</p></slot>`),r}const v0=[_.MEDIA_ERROR_CODE,_.MEDIA_ERROR_MESSAGE];class yu extends co{constructor(){super(...arguments),zC(this,Dl,null)}static get observedAttributes(){return[...super.observedAttributes,...v0]}formatErrorMessage(e){return this.constructor.formatErrorMessage(e)}attributeChangedCallback(e,t,s){var r;if(super.attributeChangedCallback(e,t,s),!v0.includes(e))return;const n=(r=this.mediaError)!=null?r:{code:this.mediaErrorCode,message:this.mediaErrorMessage};this.open=ZC(n),this.open&&(this.shadowRoot.querySelector("slot").name=`error-${this.mediaErrorCode}`,this.shadowRoot.querySelector("#content").innerHTML=this.formatErrorMessage(n))}get mediaError(){return jC(this,Dl)}set mediaError(e){QC(this,Dl,e)}get mediaErrorCode(){return Oe(this,"mediaerrorcode")}set mediaErrorCode(e){qe(this,"mediaerrorcode",e)}get mediaErrorMessage(){return Ne(this,"mediaerrormessage")}set mediaErrorMessage(e){Ue(this,"mediaerrormessage",e)}}Dl=new WeakMap;yu.getSlotTemplateHTML=XC;yu.formatErrorMessage=OT;k.customElements.get("media-error-dialog")||k.customElements.define("media-error-dialog",yu);var NT=yu,UT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},JC=(i,e,t)=>(UT(i,e,"read from private field"),e.get(i)),ew=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},tw=(i,e,t,s)=>(UT(i,e,"write to private field"),e.set(i,t),t),Cl;const iw=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,sw=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`;function rw(i){return`
    <style>
      :host([${_.MEDIA_IS_FULLSCREEN}]) slot[name=icon] slot:not([name=exit]) {
        display: none !important;
      }

      
      :host(:not([${_.MEDIA_IS_FULLSCREEN}])) slot[name=icon] slot:not([name=enter]) {
        display: none !important;
      }

      :host([${_.MEDIA_IS_FULLSCREEN}]) slot[name=tooltip-enter],
      :host(:not([${_.MEDIA_IS_FULLSCREEN}])) slot[name=tooltip-exit] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="enter">${iw}</slot>
      <slot name="exit">${sw}</slot>
    </slot>
  `}function nw(){return`
    <slot name="tooltip-enter">${J("Enter fullscreen mode")}</slot>
    <slot name="tooltip-exit">${J("Exit fullscreen mode")}</slot>
  `}const E0=i=>{const e=i.mediaIsFullscreen?J("exit fullscreen mode"):J("enter fullscreen mode");i.setAttribute("aria-label",e)};class Tm extends yt{constructor(){super(...arguments),ew(this,Cl,null)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_IS_FULLSCREEN,_.MEDIA_FULLSCREEN_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),E0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_IS_FULLSCREEN&&E0(this)}get mediaFullscreenUnavailable(){return Ne(this,_.MEDIA_FULLSCREEN_UNAVAILABLE)}set mediaFullscreenUnavailable(e){Ue(this,_.MEDIA_FULLSCREEN_UNAVAILABLE,e)}get mediaIsFullscreen(){return Ee(this,_.MEDIA_IS_FULLSCREEN)}set mediaIsFullscreen(e){ye(this,_.MEDIA_IS_FULLSCREEN,e)}handleClick(e){tw(this,Cl,e);const t=JC(this,Cl)instanceof PointerEvent,s=this.mediaIsFullscreen?new k.CustomEvent(X.MEDIA_EXIT_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0}):new k.CustomEvent(X.MEDIA_ENTER_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0,detail:t});this.dispatchEvent(s)}}Cl=new WeakMap;Tm.getSlotTemplateHTML=rw;Tm.getTooltipContentHTML=nw;k.customElements.get("media-fullscreen-button")||k.customElements.define("media-fullscreen-button",Tm);const{MEDIA_TIME_IS_LIVE:wl,MEDIA_PAUSED:wa}=_,{MEDIA_SEEK_TO_LIVE_REQUEST:aw,MEDIA_PLAY_REQUEST:ow}=X,lw='<svg viewBox="0 0 6 12"><circle cx="3" cy="6" r="2"></circle></svg>';function dw(i){return`
    <style>
      :host { --media-tooltip-display: none; }
      
      slot[name=indicator] > *,
      :host ::slotted([slot=indicator]) {
        
        min-width: auto;
        fill: var(--media-live-button-icon-color, rgb(140, 140, 140));
        color: var(--media-live-button-icon-color, rgb(140, 140, 140));
      }

      :host([${wl}]:not([${wa}])) slot[name=indicator] > *,
      :host([${wl}]:not([${wa}])) ::slotted([slot=indicator]) {
        fill: var(--media-live-button-indicator-color, rgb(255, 0, 0));
        color: var(--media-live-button-indicator-color, rgb(255, 0, 0));
      }

      :host([${wl}]:not([${wa}])) {
        cursor: var(--media-cursor, not-allowed);
      }

      slot[name=text]{
        text-transform: uppercase;
      }

    </style>

    <slot name="indicator">${lw}</slot>
    
    <slot name="spacer">&nbsp;</slot><slot name="text">${J("live")}</slot>
  `}const y0=i=>{var e;const t=i.mediaPaused||!i.mediaTimeIsLive,s=J(t?"seek to live":"playing live");i.setAttribute("aria-label",s);const r=(e=i.shadowRoot)==null?void 0:e.querySelector('slot[name="text"]');r&&(r.textContent=J("live")),t?i.removeAttribute("aria-disabled"):i.setAttribute("aria-disabled","true")};class $T extends yt{static get observedAttributes(){return[...super.observedAttributes,wl,wa]}connectedCallback(){super.connectedCallback(),y0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),y0(this)}get mediaPaused(){return Ee(this,_.MEDIA_PAUSED)}set mediaPaused(e){ye(this,_.MEDIA_PAUSED,e)}get mediaTimeIsLive(){return Ee(this,_.MEDIA_TIME_IS_LIVE)}set mediaTimeIsLive(e){ye(this,_.MEDIA_TIME_IS_LIVE,e)}handleClick(){!this.mediaPaused&&this.mediaTimeIsLive||(this.dispatchEvent(new k.CustomEvent(aw,{composed:!0,bubbles:!0})),this.hasAttribute(wa)&&this.dispatchEvent(new k.CustomEvent(ow,{composed:!0,bubbles:!0})))}}$T.getSlotTemplateHTML=dw;k.customElements.get("media-live-button")||k.customElements.define("media-live-button",$T);var FT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Yn=(i,e,t)=>(FT(i,e,"read from private field"),t?t.call(i):e.get(i)),T0=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},jn=(i,e,t,s)=>(FT(i,e,"write to private field"),e.set(i,t),t),Mi,Ml;const Go={LOADING_DELAY:"loadingdelay",NO_AUTOHIDE:"noautohide"},BT=500,uw=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;function cw(i){return`
    <style>
      :host {
        display: var(--media-control-display, var(--media-loading-indicator-display, inline-block));
        vertical-align: middle;
        box-sizing: border-box;
        --_loading-indicator-delay: var(--media-loading-indicator-transition-delay, ${BT}ms);
      }

      #status {
        color: rgba(0,0,0,0);
        width: 0px;
        height: 0px;
      }

      :host slot[name=icon] > *,
      :host ::slotted([slot=icon]) {
        opacity: var(--media-loading-indicator-opacity, 0);
        transition: opacity 0.15s;
      }

      :host([${_.MEDIA_LOADING}]:not([${_.MEDIA_PAUSED}])) slot[name=icon] > *,
      :host([${_.MEDIA_LOADING}]:not([${_.MEDIA_PAUSED}])) ::slotted([slot=icon]) {
        opacity: var(--media-loading-indicator-opacity, 1);
        transition: opacity 0.15s var(--_loading-indicator-delay);
      }

      :host #status {
        visibility: var(--media-loading-indicator-opacity, hidden);
        transition: visibility 0.15s;
      }

      :host([${_.MEDIA_LOADING}]:not([${_.MEDIA_PAUSED}])) #status {
        visibility: var(--media-loading-indicator-opacity, visible);
        transition: visibility 0.15s var(--_loading-indicator-delay);
      }

      svg, img, ::slotted(svg), ::slotted(img) {
        width: var(--media-loading-indicator-icon-width);
        height: var(--media-loading-indicator-icon-height, 100px);
        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
        vertical-align: middle;
      }
    </style>

    <slot name="icon">${uw}</slot>
    <div id="status" role="status" aria-live="polite">${J("media loading")}</div>
  `}class bm extends k.HTMLElement{constructor(){if(super(),T0(this,Mi,void 0),T0(this,Ml,BT),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}static get observedAttributes(){return[_e.MEDIA_CONTROLLER,_.MEDIA_PAUSED,_.MEDIA_LOADING,Go.LOADING_DELAY]}attributeChangedCallback(e,t,s){var r,n,a,o,l;e===Go.LOADING_DELAY&&t!==s?this.loadingDelay=Number(s):e===_e.MEDIA_CONTROLLER&&(t&&((n=(r=Yn(this,Mi))==null?void 0:r.unassociateElement)==null||n.call(r,this),jn(this,Mi,null)),s&&this.isConnected&&(jn(this,Mi,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Yn(this,Mi))==null?void 0:o.associateElement)==null||l.call(o,this)))}connectedCallback(){var e,t,s;const r=this.getAttribute(_e.MEDIA_CONTROLLER);r&&(jn(this,Mi,(e=this.getRootNode())==null?void 0:e.getElementById(r)),(s=(t=Yn(this,Mi))==null?void 0:t.associateElement)==null||s.call(t,this))}disconnectedCallback(){var e,t;(t=(e=Yn(this,Mi))==null?void 0:e.unassociateElement)==null||t.call(e,this),jn(this,Mi,null)}get loadingDelay(){return Yn(this,Ml)}set loadingDelay(e){jn(this,Ml,e);const{style:t}=et(this.shadowRoot,":host");t.setProperty("--_loading-indicator-delay",`var(--media-loading-indicator-transition-delay, ${e}ms)`)}get mediaPaused(){return Ee(this,_.MEDIA_PAUSED)}set mediaPaused(e){ye(this,_.MEDIA_PAUSED,e)}get mediaLoading(){return Ee(this,_.MEDIA_LOADING)}set mediaLoading(e){ye(this,_.MEDIA_LOADING,e)}get mediaController(){return Ne(this,_e.MEDIA_CONTROLLER)}set mediaController(e){Ue(this,_e.MEDIA_CONTROLLER,e)}get noAutohide(){return Ee(this,Go.NO_AUTOHIDE)}set noAutohide(e){ye(this,Go.NO_AUTOHIDE,e)}}Mi=new WeakMap;Ml=new WeakMap;bm.shadowRootOptions={mode:"open"};bm.getTemplateHTML=cw;k.customElements.get("media-loading-indicator")||k.customElements.define("media-loading-indicator",bm);const hw=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,b0=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,fw=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`;function mw(i){return`
    <style>
      :host(:not([${_.MEDIA_VOLUME_LEVEL}])) slot[name=icon] slot:not([name=high]),
      :host([${_.MEDIA_VOLUME_LEVEL}=high]) slot[name=icon] slot:not([name=high]) {
        display: none !important;
      }

      :host([${_.MEDIA_VOLUME_LEVEL}=off]) slot[name=icon] slot:not([name=off]) {
        display: none !important;
      }

      :host([${_.MEDIA_VOLUME_LEVEL}=low]) slot[name=icon] slot:not([name=low]) {
        display: none !important;
      }

      :host([${_.MEDIA_VOLUME_LEVEL}=medium]) slot[name=icon] slot:not([name=medium]) {
        display: none !important;
      }

      :host(:not([${_.MEDIA_VOLUME_LEVEL}=off])) slot[name=tooltip-unmute],
      :host([${_.MEDIA_VOLUME_LEVEL}=off]) slot[name=tooltip-mute] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="off">${hw}</slot>
      <slot name="low">${b0}</slot>
      <slot name="medium">${b0}</slot>
      <slot name="high">${fw}</slot>
    </slot>
  `}function pw(){return`
    <slot name="tooltip-mute">${J("Mute")}</slot>
    <slot name="tooltip-unmute">${J("Unmute")}</slot>
  `}const _0=i=>{const e=i.mediaVolumeLevel==="off",t=J(e?"unmute":"mute");i.setAttribute("aria-label",t)};class _m extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_VOLUME_LEVEL]}connectedCallback(){super.connectedCallback(),_0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_VOLUME_LEVEL&&_0(this)}get mediaVolumeLevel(){return Ne(this,_.MEDIA_VOLUME_LEVEL)}set mediaVolumeLevel(e){Ue(this,_.MEDIA_VOLUME_LEVEL,e)}handleClick(){const e=this.mediaVolumeLevel==="off"?X.MEDIA_UNMUTE_REQUEST:X.MEDIA_MUTE_REQUEST;this.dispatchEvent(new k.CustomEvent(e,{composed:!0,bubbles:!0}))}}_m.getSlotTemplateHTML=mw;_m.getTooltipContentHTML=pw;k.customElements.get("media-mute-button")||k.customElements.define("media-mute-button",_m);const A0=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`;function gw(i){return`
    <style>
      :host([${_.MEDIA_IS_PIP}]) slot[name=icon] slot:not([name=exit]) {
        display: none !important;
      }

      :host(:not([${_.MEDIA_IS_PIP}])) slot[name=icon] slot:not([name=enter]) {
        display: none !important;
      }

      :host([${_.MEDIA_IS_PIP}]) slot[name=tooltip-enter],
      :host(:not([${_.MEDIA_IS_PIP}])) slot[name=tooltip-exit] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="enter">${A0}</slot>
      <slot name="exit">${A0}</slot>
    </slot>
  `}function vw(){return`
    <slot name="tooltip-enter">${J("Enter picture in picture mode")}</slot>
    <slot name="tooltip-exit">${J("Exit picture in picture mode")}</slot>
  `}const S0=i=>{const e=i.mediaIsPip?J("exit picture in picture mode"):J("enter picture in picture mode");i.setAttribute("aria-label",e)};class Am extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_IS_PIP,_.MEDIA_PIP_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),S0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_IS_PIP&&S0(this)}get mediaPipUnavailable(){return Ne(this,_.MEDIA_PIP_UNAVAILABLE)}set mediaPipUnavailable(e){Ue(this,_.MEDIA_PIP_UNAVAILABLE,e)}get mediaIsPip(){return Ee(this,_.MEDIA_IS_PIP)}set mediaIsPip(e){ye(this,_.MEDIA_IS_PIP,e)}handleClick(){const e=this.mediaIsPip?X.MEDIA_EXIT_PIP_REQUEST:X.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new k.CustomEvent(e,{composed:!0,bubbles:!0}))}}Am.getSlotTemplateHTML=gw;Am.getTooltipContentHTML=vw;k.customElements.get("media-pip-button")||k.customElements.define("media-pip-button",Am);var Ew=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ur=(i,e,t)=>(Ew(i,e,"read from private field"),t?t.call(i):e.get(i)),yw=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Ls;const uc={RATES:"rates"},HT=[1,1.2,1.5,1.7,2],fn=1;function Tw(i){return`
    <style>
      :host {
        min-width: 5ch;
        padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));
      }
    </style>
    <slot name="icon">${i.mediaplaybackrate||fn}x</slot>
  `}function bw(){return J("Playback rate")}class Sm extends yt{constructor(){var e;super(),yw(this,Ls,new am(this,uc.RATES,{defaultValue:HT})),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML=`${(e=this.mediaPlaybackRate)!=null?e:fn}x`}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PLAYBACK_RATE,uc.RATES]}attributeChangedCallback(e,t,s){if(super.attributeChangedCallback(e,t,s),e===uc.RATES&&(Ur(this,Ls).value=s),e===_.MEDIA_PLAYBACK_RATE){const r=s?+s:Number.NaN,n=Number.isNaN(r)?fn:r;this.container.innerHTML=`${n}x`,this.setAttribute("aria-label",J("Playback rate {playbackRate}",{playbackRate:n}))}}get rates(){return Ur(this,Ls)}set rates(e){e?Array.isArray(e)?Ur(this,Ls).value=e.join(" "):typeof e=="string"&&(Ur(this,Ls).value=e):Ur(this,Ls).value=""}get mediaPlaybackRate(){return Oe(this,_.MEDIA_PLAYBACK_RATE,fn)}set mediaPlaybackRate(e){qe(this,_.MEDIA_PLAYBACK_RATE,e)}handleClick(){var e,t;const s=Array.from(Ur(this,Ls).values(),a=>+a).sort((a,o)=>a-o),r=(t=(e=s.find(a=>a>this.mediaPlaybackRate))!=null?e:s[0])!=null?t:fn,n=new k.CustomEvent(X.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(n)}}Ls=new WeakMap;Sm.getSlotTemplateHTML=Tw;Sm.getTooltipContentHTML=bw;k.customElements.get("media-playback-rate-button")||k.customElements.define("media-playback-rate-button",Sm);const _w=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,Aw=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`;function Sw(i){return`
    <style>
      :host([${_.MEDIA_PAUSED}]) slot[name=pause],
      :host(:not([${_.MEDIA_PAUSED}])) slot[name=play] {
        display: none !important;
      }

      :host([${_.MEDIA_PAUSED}]) slot[name=tooltip-pause],
      :host(:not([${_.MEDIA_PAUSED}])) slot[name=tooltip-play] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="play">${_w}</slot>
      <slot name="pause">${Aw}</slot>
    </slot>
  `}function Iw(){return`
    <slot name="tooltip-play">${J("Play")}</slot>
    <slot name="tooltip-pause">${J("Pause")}</slot>
  `}const I0=i=>{const e=i.mediaPaused?J("play"):J("pause");i.setAttribute("aria-label",e)};class Im extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PAUSED,_.MEDIA_ENDED]}connectedCallback(){super.connectedCallback(),I0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),(e===_.MEDIA_PAUSED||e===_.MEDIA_LANG)&&I0(this)}get mediaPaused(){return Ee(this,_.MEDIA_PAUSED)}set mediaPaused(e){ye(this,_.MEDIA_PAUSED,e)}handleClick(){const e=this.mediaPaused?X.MEDIA_PLAY_REQUEST:X.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new k.CustomEvent(e,{composed:!0,bubbles:!0}))}}Im.getSlotTemplateHTML=Sw;Im.getTooltipContentHTML=Iw;k.customElements.get("media-play-button")||k.customElements.define("media-play-button",Im);const Ai={PLACEHOLDER_SRC:"placeholdersrc",SRC:"src"};function Lw(i){return`
    <style>
      :host {
        pointer-events: none;
        display: var(--media-poster-image-display, inline-block);
        box-sizing: border-box;
      }

      img {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        background-repeat: no-repeat;
        background-position: var(--media-poster-image-background-position, var(--media-object-position, center));
        background-size: var(--media-poster-image-background-size, var(--media-object-fit, contain));
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, center);
      }
    </style>

    <img part="poster img" aria-hidden="true" id="image"/>
  `}const Rw=i=>{i.style.removeProperty("background-image")},xw=(i,e)=>{i.style["background-image"]=`url('${e}')`};class Lm extends k.HTMLElement{static get observedAttributes(){return[Ai.PLACEHOLDER_SRC,Ai.SRC]}constructor(){if(super(),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(e,t,s){e===Ai.SRC&&(s==null?this.image.removeAttribute(Ai.SRC):this.image.setAttribute(Ai.SRC,s)),e===Ai.PLACEHOLDER_SRC&&(s==null?Rw(this.image):xw(this.image,s))}get placeholderSrc(){return Ne(this,Ai.PLACEHOLDER_SRC)}set placeholderSrc(e){Ue(this,Ai.SRC,e)}get src(){return Ne(this,Ai.SRC)}set src(e){Ue(this,Ai.SRC,e)}}Lm.shadowRootOptions={mode:"open"};Lm.getTemplateHTML=Lw;k.customElements.get("media-poster-image")||k.customElements.define("media-poster-image",Lm);var GT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},kw=(i,e,t)=>(GT(i,e,"read from private field"),t?t.call(i):e.get(i)),Dw=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Cw=(i,e,t,s)=>(GT(i,e,"write to private field"),e.set(i,t),t),Pl;class ww extends Ks{constructor(){super(),Dw(this,Pl,void 0),Cw(this,Pl,this.shadowRoot.querySelector("slot"))}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PREVIEW_CHAPTER,_.MEDIA_LANG]}attributeChangedCallback(e,t,s){if(super.attributeChangedCallback(e,t,s),(e===_.MEDIA_PREVIEW_CHAPTER||e===_.MEDIA_LANG)&&s!==t&&s!=null)if(kw(this,Pl).textContent=s,s!==""){const r=J("chapter: {chapterName}",{chapterName:s});this.setAttribute("aria-valuetext",r)}else this.removeAttribute("aria-valuetext")}get mediaPreviewChapter(){return Ne(this,_.MEDIA_PREVIEW_CHAPTER)}set mediaPreviewChapter(e){Ue(this,_.MEDIA_PREVIEW_CHAPTER,e)}}Pl=new WeakMap;k.customElements.get("media-preview-chapter-display")||k.customElements.define("media-preview-chapter-display",ww);var KT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ko=(i,e,t)=>(KT(i,e,"read from private field"),t?t.call(i):e.get(i)),Mw=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Vo=(i,e,t,s)=>(KT(i,e,"write to private field"),e.set(i,t),t),Pi;function Pw(i){return`
    <style>
      :host {
        box-sizing: border-box;
        display: var(--media-control-display, var(--media-preview-thumbnail-display, inline-block));
        overflow: hidden;
      }

      img {
        display: none;
        position: relative;
      }
    </style>
    <img crossorigin loading="eager" decoding="async">
  `}class Tu extends k.HTMLElement{constructor(){if(super(),Mw(this,Pi,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}static get observedAttributes(){return[_e.MEDIA_CONTROLLER,_.MEDIA_PREVIEW_IMAGE,_.MEDIA_PREVIEW_COORDS]}connectedCallback(){var e,t,s;const r=this.getAttribute(_e.MEDIA_CONTROLLER);r&&(Vo(this,Pi,(e=this.getRootNode())==null?void 0:e.getElementById(r)),(s=(t=Ko(this,Pi))==null?void 0:t.associateElement)==null||s.call(t,this))}disconnectedCallback(){var e,t;(t=(e=Ko(this,Pi))==null?void 0:e.unassociateElement)==null||t.call(e,this),Vo(this,Pi,null)}attributeChangedCallback(e,t,s){var r,n,a,o,l;[_.MEDIA_PREVIEW_IMAGE,_.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===_e.MEDIA_CONTROLLER&&(t&&((n=(r=Ko(this,Pi))==null?void 0:r.unassociateElement)==null||n.call(r,this),Vo(this,Pi,null)),s&&this.isConnected&&(Vo(this,Pi,(a=this.getRootNode())==null?void 0:a.getElementById(s)),(l=(o=Ko(this,Pi))==null?void 0:o.associateElement)==null||l.call(o,this)))}get mediaPreviewImage(){return Ne(this,_.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){Ue(this,_.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewCoords(){const e=this.getAttribute(_.MEDIA_PREVIEW_COORDS);if(e)return e.split(/\s+/).map(t=>+t)}set mediaPreviewCoords(e){if(!e){this.removeAttribute(_.MEDIA_PREVIEW_COORDS);return}this.setAttribute(_.MEDIA_PREVIEW_COORDS,e.join(" "))}update(){const e=this.mediaPreviewCoords,t=this.mediaPreviewImage;if(!(e&&t))return;const[s,r,n,a]=e,o=t.split("#")[0],l=getComputedStyle(this),{maxWidth:d,maxHeight:u,minWidth:c,minHeight:h}=l,f=Math.min(parseInt(d)/n,parseInt(u)/a),m=Math.max(parseInt(c)/n,parseInt(h)/a),g=f<1,p=g?f:m>1?m:1,{style:E}=et(this.shadowRoot,":host"),T=et(this.shadowRoot,"img").style,y=this.shadowRoot.querySelector("img"),b=g?"min":"max";E.setProperty(`${b}-width`,"initial","important"),E.setProperty(`${b}-height`,"initial","important"),E.width=`${n*p}px`,E.height=`${a*p}px`;const A=()=>{T.width=`${this.imgWidth*p}px`,T.height=`${this.imgHeight*p}px`,T.display="block"};y.src!==o&&(y.onload=()=>{this.imgWidth=y.naturalWidth,this.imgHeight=y.naturalHeight,A()},y.src=o,A()),A(),T.transform=`translate(-${s*p}px, -${r*p}px)`}}Pi=new WeakMap;Tu.shadowRootOptions={mode:"open"};Tu.getTemplateHTML=Pw;k.customElements.get("media-preview-thumbnail")||k.customElements.define("media-preview-thumbnail",Tu);var L0=Tu,VT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},R0=(i,e,t)=>(VT(i,e,"read from private field"),t?t.call(i):e.get(i)),Ow=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Nw=(i,e,t,s)=>(VT(i,e,"write to private field"),e.set(i,t),t),pa;class Uw extends Ks{constructor(){super(),Ow(this,pa,void 0),Nw(this,pa,this.shadowRoot.querySelector("slot")),R0(this,pa).textContent=Fs(0)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_PREVIEW_TIME&&s!=null&&(R0(this,pa).textContent=Fs(parseFloat(s)))}get mediaPreviewTime(){return Oe(this,_.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){qe(this,_.MEDIA_PREVIEW_TIME,e)}}pa=new WeakMap;k.customElements.get("media-preview-time-display")||k.customElements.define("media-preview-time-display",Uw);const $r={SEEK_OFFSET:"seekoffset"},cc=30,$w=i=>`
  <svg aria-hidden="true" viewBox="0 0 20 24">
    <defs>
      <style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style>
    </defs>
    <text class="text value" transform="translate(2.18 19.87)">${i}</text>
    <path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/>
  </svg>`;function Fw(i,e){return`
    <slot name="icon">${$w(e.seekOffset)}</slot>
  `}function Bw(){return J("Seek backward")}const Hw=0;class Rm extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_CURRENT_TIME,$r.SEEK_OFFSET]}connectedCallback(){super.connectedCallback(),this.seekOffset=Oe(this,$r.SEEK_OFFSET,cc)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===$r.SEEK_OFFSET&&(this.seekOffset=Oe(this,$r.SEEK_OFFSET,cc))}get seekOffset(){return Oe(this,$r.SEEK_OFFSET,cc)}set seekOffset(e){qe(this,$r.SEEK_OFFSET,e),this.setAttribute("aria-label",J("seek back {seekOffset} seconds",{seekOffset:this.seekOffset})),Xy(Zy(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return Oe(this,_.MEDIA_CURRENT_TIME,Hw)}set mediaCurrentTime(e){qe(this,_.MEDIA_CURRENT_TIME,e)}handleClick(){const e=Math.max(this.mediaCurrentTime-this.seekOffset,0),t=new k.CustomEvent(X.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}}Rm.getSlotTemplateHTML=Fw;Rm.getTooltipContentHTML=Bw;k.customElements.get("media-seek-backward-button")||k.customElements.define("media-seek-backward-button",Rm);const Fr={SEEK_OFFSET:"seekoffset"},hc=30,Gw=i=>`
  <svg aria-hidden="true" viewBox="0 0 20 24">
    <defs>
      <style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style>
    </defs>
    <text class="text value" transform="translate(8.9 19.87)">${i}</text>
    <path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/>
  </svg>`;function Kw(i,e){return`
    <slot name="icon">${Gw(e.seekOffset)}</slot>
  `}function Vw(){return J("Seek forward")}const Ww=0;class xm extends yt{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_CURRENT_TIME,Fr.SEEK_OFFSET]}connectedCallback(){super.connectedCallback(),this.seekOffset=Oe(this,Fr.SEEK_OFFSET,hc)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===Fr.SEEK_OFFSET&&(this.seekOffset=Oe(this,Fr.SEEK_OFFSET,hc))}get seekOffset(){return Oe(this,Fr.SEEK_OFFSET,hc)}set seekOffset(e){qe(this,Fr.SEEK_OFFSET,e),this.setAttribute("aria-label",J("seek forward {seekOffset} seconds",{seekOffset:this.seekOffset})),Xy(Zy(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return Oe(this,_.MEDIA_CURRENT_TIME,Ww)}set mediaCurrentTime(e){qe(this,_.MEDIA_CURRENT_TIME,e)}handleClick(){const e=this.mediaCurrentTime+this.seekOffset,t=new k.CustomEvent(X.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}}xm.getSlotTemplateHTML=Kw;xm.getTooltipContentHTML=Vw;k.customElements.get("media-seek-forward-button")||k.customElements.define("media-seek-forward-button",xm);var WT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},fc=(i,e,t)=>(WT(i,e,"read from private field"),t?t.call(i):e.get(i)),qw=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Yw=(i,e,t,s)=>(WT(i,e,"write to private field"),e.set(i,t),t),zr;const tr={REMAINING:"remaining",SHOW_DURATION:"showduration",NO_TOGGLE:"notoggle"},x0=[...Object.values(tr),_.MEDIA_CURRENT_TIME,_.MEDIA_DURATION,_.MEDIA_SEEKABLE],k0=["Enter"," "],jw="&nbsp;/&nbsp;",Ch=(i,{timesSep:e=jw}={})=>{var t,s;const r=(t=i.mediaCurrentTime)!=null?t:0,[,n]=(s=i.mediaSeekable)!=null?s:[];let a=0;Number.isFinite(i.mediaDuration)?a=i.mediaDuration:Number.isFinite(n)&&(a=n);const o=i.remaining?Fs(0-(a-r)):Fs(r);return i.showDuration?`${o}${e}${Fs(a)}`:o},zw="video not loaded, unknown time.",Qw=i=>{var e;const t=i.mediaCurrentTime,[,s]=(e=i.mediaSeekable)!=null?e:[];let r=null;if(Number.isFinite(i.mediaDuration)?r=i.mediaDuration:Number.isFinite(s)&&(r=s),t==null||r===null){i.setAttribute("aria-valuetext",zw);return}const n=i.remaining?Da(0-(r-t)):Da(t);if(!i.showDuration){i.setAttribute("aria-valuetext",n);return}const a=Da(r),o=`${n} of ${a}`;i.setAttribute("aria-valuetext",o)};function Xw(i,e){return`
    <slot>${Ch(e)}</slot>
  `}class qT extends Ks{constructor(){super(),qw(this,zr,void 0),Yw(this,zr,this.shadowRoot.querySelector("slot")),fc(this,zr).innerHTML=`${Ch(this)}`}static get observedAttributes(){return[...super.observedAttributes,...x0,"disabled"]}connectedCallback(){const{style:e}=et(this.shadowRoot,":host(:hover:not([notoggle]))");e.setProperty("cursor","var(--media-cursor, pointer)"),e.setProperty("background","var(--media-control-hover-background, rgba(50 50 70 / .7))"),this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",J("playback time"));const t=s=>{const{key:r}=s;if(!k0.includes(r)){this.removeEventListener("keyup",t);return}this.toggleTimeDisplay()};this.addEventListener("keydown",s=>{const{metaKey:r,altKey:n,key:a}=s;if(r||n||!k0.includes(a)){this.removeEventListener("keyup",t);return}this.addEventListener("keyup",t)}),this.addEventListener("click",this.toggleTimeDisplay),super.connectedCallback()}toggleTimeDisplay(){this.noToggle||(this.hasAttribute("remaining")?this.removeAttribute("remaining"):this.setAttribute("remaining",""))}disconnectedCallback(){this.disable(),super.disconnectedCallback()}attributeChangedCallback(e,t,s){x0.includes(e)?this.update():e==="disabled"&&s!==t&&(s==null?this.enable():this.disable()),super.attributeChangedCallback(e,t,s)}enable(){this.tabIndex=0}disable(){this.tabIndex=-1}get remaining(){return Ee(this,tr.REMAINING)}set remaining(e){ye(this,tr.REMAINING,e)}get showDuration(){return Ee(this,tr.SHOW_DURATION)}set showDuration(e){ye(this,tr.SHOW_DURATION,e)}get noToggle(){return Ee(this,tr.NO_TOGGLE)}set noToggle(e){ye(this,tr.NO_TOGGLE,e)}get mediaDuration(){return Oe(this,_.MEDIA_DURATION)}set mediaDuration(e){qe(this,_.MEDIA_DURATION,e)}get mediaCurrentTime(){return Oe(this,_.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){qe(this,_.MEDIA_CURRENT_TIME,e)}get mediaSeekable(){const e=this.getAttribute(_.MEDIA_SEEKABLE);if(e)return e.split(":").map(t=>+t)}set mediaSeekable(e){if(e==null){this.removeAttribute(_.MEDIA_SEEKABLE);return}this.setAttribute(_.MEDIA_SEEKABLE,e.join(":"))}update(){const e=Ch(this);Qw(this),e!==fc(this,zr).innerHTML&&(fc(this,zr).innerHTML=e)}}zr=new WeakMap;qT.getSlotTemplateHTML=Xw;k.customElements.get("media-time-display")||k.customElements.define("media-time-display",qT);var YT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ht=(i,e,t)=>(YT(i,e,"read from private field"),e.get(i)),Si=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Ft=(i,e,t,s)=>(YT(i,e,"write to private field"),e.set(i,t),t),Zw=(i,e,t,s)=>({set _(r){Ft(i,e,r)},get _(){return ht(i,e)}}),Qr,Ol,Xr,ga,Nl,Ul,$l,Zr,ir,Fl;class Jw{constructor(e,t,s){Si(this,Qr,void 0),Si(this,Ol,void 0),Si(this,Xr,void 0),Si(this,ga,void 0),Si(this,Nl,void 0),Si(this,Ul,void 0),Si(this,$l,void 0),Si(this,Zr,void 0),Si(this,ir,0),Si(this,Fl,(r=performance.now())=>{Ft(this,ir,requestAnimationFrame(ht(this,Fl))),Ft(this,ga,performance.now()-ht(this,Xr));const n=1e3/this.fps;if(ht(this,ga)>n){Ft(this,Xr,r-ht(this,ga)%n);const a=1e3/((r-ht(this,Ol))/++Zw(this,Nl)._),o=(r-ht(this,Ul))/1e3/this.duration;let l=ht(this,$l)+o*this.playbackRate;l-ht(this,Qr).valueAsNumber>0?Ft(this,Zr,this.playbackRate/this.duration/a):(Ft(this,Zr,.995*ht(this,Zr)),l=ht(this,Qr).valueAsNumber+ht(this,Zr)),this.callback(l)}}),Ft(this,Qr,e),this.callback=t,this.fps=s}start(){ht(this,ir)===0&&(Ft(this,Xr,performance.now()),Ft(this,Ol,ht(this,Xr)),Ft(this,Nl,0),ht(this,Fl).call(this))}stop(){ht(this,ir)!==0&&(cancelAnimationFrame(ht(this,ir)),Ft(this,ir,0))}update({start:e,duration:t,playbackRate:s}){const r=e-ht(this,Qr).valueAsNumber,n=Math.abs(t-this.duration);(r>0||r<-.03||n>=.5)&&this.callback(e),Ft(this,$l,e),Ft(this,Ul,performance.now()),this.duration=t,this.playbackRate=s}}Qr=new WeakMap;Ol=new WeakMap;Xr=new WeakMap;ga=new WeakMap;Nl=new WeakMap;Ul=new WeakMap;$l=new WeakMap;Zr=new WeakMap;ir=new WeakMap;Fl=new WeakMap;var km=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},je=(i,e,t)=>(km(i,e,"read from private field"),t?t.call(i):e.get(i)),at=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Qt=(i,e,t,s)=>(km(i,e,"write to private field"),e.set(i,t),t),_t=(i,e,t)=>(km(i,e,"access private method"),t),Jr,Tr,$d,Ma,Fd,Bl,to,io,en,tn,sn,va,Dm,jT,wh,Bd,Cm,Hd,wm,Gd,Mm,Mh,zT,so,Kd,Ph,QT;const eM="video not loaded, unknown time.",tM=i=>{const e=i.range,t=Da(+XT(i)),s=Da(+i.mediaSeekableEnd),r=t&&s?`${t} of ${s}`:eM;e.setAttribute("aria-valuetext",r)};function iM(i){return`
    ${Fn.getTemplateHTML(i)}
    <style>
      :host {
        --media-box-border-radius: 4px;
        --media-box-padding-left: 10px;
        --media-box-padding-right: 10px;
        --media-preview-border-radius: var(--media-box-border-radius);
        --media-box-arrow-offset: var(--media-box-border-radius);
        --_control-background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));
        --_preview-background: var(--media-preview-background, var(--_control-background));

        
        contain: layout;
      }

      #buffered {
        background: var(--media-time-range-buffered-color, rgb(255 255 255 / .4));
        position: absolute;
        height: 100%;
        will-change: width;
      }

      #preview-rail,
      #current-rail {
        width: 100%;
        position: absolute;
        left: 0;
        bottom: 100%;
        pointer-events: none;
        will-change: transform;
      }

      [part~="box"] {
        width: min-content;
        
        position: absolute;
        bottom: 100%;
        flex-direction: column;
        align-items: center;
        transform: translateX(-50%);
      }

      [part~="current-box"] {
        display: var(--media-current-box-display, var(--media-box-display, flex));
        margin: var(--media-current-box-margin, var(--media-box-margin, 0 0 5px));
        visibility: hidden;
      }

      [part~="preview-box"] {
        display: var(--media-preview-box-display, var(--media-box-display, flex));
        margin: var(--media-preview-box-margin, var(--media-box-margin, 0 0 5px));
        transition-property: var(--media-preview-transition-property, visibility, opacity);
        transition-duration: var(--media-preview-transition-duration-out, .25s);
        transition-delay: var(--media-preview-transition-delay-out, 0s);
        visibility: hidden;
        opacity: 0;
      }

      :host(:is([${_.MEDIA_PREVIEW_IMAGE}], [${_.MEDIA_PREVIEW_TIME}])[dragging]) [part~="preview-box"] {
        transition-duration: var(--media-preview-transition-duration-in, .5s);
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        visibility: visible;
        opacity: 1;
      }

      @media (hover: hover) {
        :host(:is([${_.MEDIA_PREVIEW_IMAGE}], [${_.MEDIA_PREVIEW_TIME}]):hover) [part~="preview-box"] {
          transition-duration: var(--media-preview-transition-duration-in, .5s);
          transition-delay: var(--media-preview-transition-delay-in, .25s);
          visibility: visible;
          opacity: 1;
        }
      }

      media-preview-thumbnail,
      ::slotted(media-preview-thumbnail) {
        visibility: hidden;
        
        transition: visibility 0s .25s;
        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
        background: var(--media-preview-thumbnail-background, var(--_preview-background));
        box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgb(0 0 0 / .2));
        max-width: var(--media-preview-thumbnail-max-width, 180px);
        max-height: var(--media-preview-thumbnail-max-height, 160px);
        min-width: var(--media-preview-thumbnail-min-width, 120px);
        min-height: var(--media-preview-thumbnail-min-height, 80px);
        border: var(--media-preview-thumbnail-border);
        border-radius: var(--media-preview-thumbnail-border-radius,
          var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
      }

      :host([${_.MEDIA_PREVIEW_IMAGE}][dragging]) media-preview-thumbnail,
      :host([${_.MEDIA_PREVIEW_IMAGE}][dragging]) ::slotted(media-preview-thumbnail) {
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        visibility: visible;
      }

      @media (hover: hover) {
        :host([${_.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
        :host([${_.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
          transition-delay: var(--media-preview-transition-delay-in, .25s);
          visibility: visible;
        }

        :host([${_.MEDIA_PREVIEW_TIME}]:hover) {
          --media-time-range-hover-display: block;
        }
      }

      media-preview-chapter-display,
      ::slotted(media-preview-chapter-display) {
        font-size: var(--media-font-size, 13px);
        line-height: 17px;
        min-width: 0;
        visibility: hidden;
        
        transition: min-width 0s, border-radius 0s, margin 0s, padding 0s, visibility 0s;
        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
        background: var(--media-preview-chapter-background, var(--_preview-background));
        border-radius: var(--media-preview-chapter-border-radius,
          var(--media-preview-border-radius) var(--media-preview-border-radius)
          var(--media-preview-border-radius) var(--media-preview-border-radius));
        padding: var(--media-preview-chapter-padding, 3.5px 9px);
        margin: var(--media-preview-chapter-margin, 0 0 5px);
        text-shadow: var(--media-preview-chapter-text-shadow, 0 0 4px rgb(0 0 0 / .75));
      }

      :host([${_.MEDIA_PREVIEW_IMAGE}]) media-preview-chapter-display,
      :host([${_.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-chapter-display) {
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        border-radius: var(--media-preview-chapter-border-radius, 0);
        padding: var(--media-preview-chapter-padding, 3.5px 9px 0);
        margin: var(--media-preview-chapter-margin, 0);
        min-width: 100%;
      }

      media-preview-chapter-display[${_.MEDIA_PREVIEW_CHAPTER}],
      ::slotted(media-preview-chapter-display[${_.MEDIA_PREVIEW_CHAPTER}]) {
        visibility: visible;
      }

      media-preview-chapter-display:not([aria-valuetext]),
      ::slotted(media-preview-chapter-display:not([aria-valuetext])) {
        display: none;
      }

      media-preview-time-display,
      ::slotted(media-preview-time-display),
      media-time-display,
      ::slotted(media-time-display) {
        font-size: var(--media-font-size, 13px);
        line-height: 17px;
        min-width: 0;
        
        transition: min-width 0s, border-radius 0s;
        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
        background: var(--media-preview-time-background, var(--_preview-background));
        border-radius: var(--media-preview-time-border-radius,
          var(--media-preview-border-radius) var(--media-preview-border-radius)
          var(--media-preview-border-radius) var(--media-preview-border-radius));
        padding: var(--media-preview-time-padding, 3.5px 9px);
        margin: var(--media-preview-time-margin, 0);
        text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgb(0 0 0 / .75));
        transform: translateX(min(
          max(calc(50% - var(--_box-width) / 2),
          calc(var(--_box-shift, 0))),
          calc(var(--_box-width) / 2 - 50%)
        ));
      }

      :host([${_.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
      :host([${_.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
        transition-delay: var(--media-preview-transition-delay-in, .25s);
        border-radius: var(--media-preview-time-border-radius,
          0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
        min-width: 100%;
      }

      :host([${_.MEDIA_PREVIEW_TIME}]:hover) {
        --media-time-range-hover-display: block;
      }

      [part~="arrow"],
      ::slotted([part~="arrow"]) {
        display: var(--media-box-arrow-display, inline-block);
        transform: translateX(min(
          max(calc(50% - var(--_box-width) / 2 + var(--media-box-arrow-offset)),
          calc(var(--_box-shift, 0))),
          calc(var(--_box-width) / 2 - 50% - var(--media-box-arrow-offset))
        ));
        
        border-color: transparent;
        border-top-color: var(--media-box-arrow-background, var(--_control-background));
        border-width: var(--media-box-arrow-border-width,
          var(--media-box-arrow-height, 5px) var(--media-box-arrow-width, 6px) 0);
        border-style: solid;
        justify-content: center;
        height: 0;
      }
    </style>
    <div id="preview-rail">
      <slot name="preview" part="box preview-box">
        <media-preview-thumbnail>
          <template shadowrootmode="${L0.shadowRootOptions.mode}">
            ${L0.getTemplateHTML({})}
          </template>
        </media-preview-thumbnail>
        <media-preview-chapter-display></media-preview-chapter-display>
        <media-preview-time-display></media-preview-time-display>
        <slot name="preview-arrow"><div part="arrow"></div></slot>
      </slot>
    </div>
    <div id="current-rail">
      <slot name="current" part="box current-box">
        
      </slot>
    </div>
  `}const Wo=(i,e=i.mediaCurrentTime)=>{const t=Number.isFinite(i.mediaSeekableStart)?i.mediaSeekableStart:0,s=Number.isFinite(i.mediaDuration)?i.mediaDuration:i.mediaSeekableEnd;if(Number.isNaN(s))return 0;const r=(e-t)/(s-t);return Math.max(0,Math.min(r,1))},XT=(i,e=i.range.valueAsNumber)=>{const t=Number.isFinite(i.mediaSeekableStart)?i.mediaSeekableStart:0,s=Number.isFinite(i.mediaDuration)?i.mediaDuration:i.mediaSeekableEnd;return Number.isNaN(s)?0:e*(s-t)+t};class Pm extends Fn{constructor(){super(),at(this,sn),at(this,Dm),at(this,Bd),at(this,Hd),at(this,Gd),at(this,Mh),at(this,so),at(this,Ph),at(this,Jr,void 0),at(this,Tr,void 0),at(this,$d,void 0),at(this,Ma,void 0),at(this,Fd,void 0),at(this,Bl,void 0),at(this,to,void 0),at(this,io,void 0),at(this,en,void 0),at(this,tn,void 0),at(this,wh,s=>{this.dragging||(tm(s)&&(this.range.valueAsNumber=s),je(this,tn)||this.updateBar())}),this.shadowRoot.querySelector("#track").insertAdjacentHTML("afterbegin",'<div id="buffered" part="buffered"></div>'),Qt(this,$d,this.shadowRoot.querySelectorAll('[part~="box"]')),Qt(this,Fd,this.shadowRoot.querySelector('[part~="preview-box"]')),Qt(this,Bl,this.shadowRoot.querySelector('[part~="current-box"]'));const t=getComputedStyle(this);Qt(this,to,parseInt(t.getPropertyValue("--media-box-padding-left"))),Qt(this,io,parseInt(t.getPropertyValue("--media-box-padding-right"))),Qt(this,Tr,new Jw(this.range,je(this,wh),60))}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PAUSED,_.MEDIA_DURATION,_.MEDIA_SEEKABLE,_.MEDIA_CURRENT_TIME,_.MEDIA_PREVIEW_IMAGE,_.MEDIA_PREVIEW_TIME,_.MEDIA_PREVIEW_CHAPTER,_.MEDIA_BUFFERED,_.MEDIA_PLAYBACK_RATE,_.MEDIA_LOADING,_.MEDIA_ENDED]}connectedCallback(){var e;super.connectedCallback(),this.range.setAttribute("aria-label",J("seek")),_t(this,sn,va).call(this),Qt(this,Jr,this.getRootNode()),(e=je(this,Jr))==null||e.addEventListener("transitionstart",this)}disconnectedCallback(){var e;super.disconnectedCallback(),_t(this,sn,va).call(this),(e=je(this,Jr))==null||e.removeEventListener("transitionstart",this),Qt(this,Jr,null)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),t!=s&&(e===_.MEDIA_CURRENT_TIME||e===_.MEDIA_PAUSED||e===_.MEDIA_ENDED||e===_.MEDIA_LOADING||e===_.MEDIA_DURATION||e===_.MEDIA_SEEKABLE?(je(this,Tr).update({start:Wo(this),duration:this.mediaSeekableEnd-this.mediaSeekableStart,playbackRate:this.mediaPlaybackRate}),_t(this,sn,va).call(this),tM(this)):e===_.MEDIA_BUFFERED&&this.updateBufferedBar(),(e===_.MEDIA_DURATION||e===_.MEDIA_SEEKABLE)&&(this.mediaChaptersCues=je(this,en),this.updateBar()))}get mediaChaptersCues(){return je(this,en)}set mediaChaptersCues(e){var t;Qt(this,en,e),this.updateSegments((t=je(this,en))==null?void 0:t.map(s=>({start:Wo(this,s.startTime),end:Wo(this,s.endTime)})))}get mediaPaused(){return Ee(this,_.MEDIA_PAUSED)}set mediaPaused(e){ye(this,_.MEDIA_PAUSED,e)}get mediaLoading(){return Ee(this,_.MEDIA_LOADING)}set mediaLoading(e){ye(this,_.MEDIA_LOADING,e)}get mediaDuration(){return Oe(this,_.MEDIA_DURATION)}set mediaDuration(e){qe(this,_.MEDIA_DURATION,e)}get mediaCurrentTime(){return Oe(this,_.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){qe(this,_.MEDIA_CURRENT_TIME,e)}get mediaPlaybackRate(){return Oe(this,_.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){qe(this,_.MEDIA_PLAYBACK_RATE,e)}get mediaBuffered(){const e=this.getAttribute(_.MEDIA_BUFFERED);return e?e.split(" ").map(t=>t.split(":").map(s=>+s)):[]}set mediaBuffered(e){if(!e){this.removeAttribute(_.MEDIA_BUFFERED);return}const t=e.map(s=>s.join(":")).join(" ");this.setAttribute(_.MEDIA_BUFFERED,t)}get mediaSeekable(){const e=this.getAttribute(_.MEDIA_SEEKABLE);if(e)return e.split(":").map(t=>+t)}set mediaSeekable(e){if(e==null){this.removeAttribute(_.MEDIA_SEEKABLE);return}this.setAttribute(_.MEDIA_SEEKABLE,e.join(":"))}get mediaSeekableEnd(){var e;const[,t=this.mediaDuration]=(e=this.mediaSeekable)!=null?e:[];return t}get mediaSeekableStart(){var e;const[t=0]=(e=this.mediaSeekable)!=null?e:[];return t}get mediaPreviewImage(){return Ne(this,_.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){Ue(this,_.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewTime(){return Oe(this,_.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){qe(this,_.MEDIA_PREVIEW_TIME,e)}get mediaEnded(){return Ee(this,_.MEDIA_ENDED)}set mediaEnded(e){ye(this,_.MEDIA_ENDED,e)}updateBar(){super.updateBar(),this.updateBufferedBar(),this.updateCurrentBox()}updateBufferedBar(){var e;const t=this.mediaBuffered;if(!t.length)return;let s;if(this.mediaEnded)s=1;else{const n=this.mediaCurrentTime,[,a=this.mediaSeekableStart]=(e=t.find(([o,l])=>o<=n&&n<=l))!=null?e:[];s=Wo(this,a)}const{style:r}=et(this.shadowRoot,"#buffered");r.setProperty("width",`${s*100}%`)}updateCurrentBox(){if(!this.shadowRoot.querySelector('slot[name="current"]').assignedElements().length)return;const t=et(this.shadowRoot,"#current-rail"),s=et(this.shadowRoot,'[part~="current-box"]'),r=_t(this,Bd,Cm).call(this,je(this,Bl)),n=_t(this,Hd,wm).call(this,r,this.range.valueAsNumber),a=_t(this,Gd,Mm).call(this,r,this.range.valueAsNumber);t.style.transform=`translateX(${n})`,t.style.setProperty("--_range-width",`${r.range.width}`),s.style.setProperty("--_box-shift",`${a}`),s.style.setProperty("--_box-width",`${r.box.width}px`),s.style.setProperty("visibility","initial")}handleEvent(e){switch(super.handleEvent(e),e.type){case"input":_t(this,Ph,QT).call(this);break;case"pointermove":_t(this,Mh,zT).call(this,e);break;case"pointerup":je(this,tn)&&Qt(this,tn,!1);break;case"pointerdown":Qt(this,tn,!0);break;case"pointerleave":_t(this,so,Kd).call(this,null);break;case"transitionstart":ps(e.target,this)&&setTimeout(()=>_t(this,sn,va).call(this),0);break}}}Jr=new WeakMap;Tr=new WeakMap;$d=new WeakMap;Ma=new WeakMap;Fd=new WeakMap;Bl=new WeakMap;to=new WeakMap;io=new WeakMap;en=new WeakMap;tn=new WeakMap;sn=new WeakSet;va=function(){_t(this,Dm,jT).call(this)?je(this,Tr).start():je(this,Tr).stop()};Dm=new WeakSet;jT=function(){return this.isConnected&&!this.mediaPaused&&!this.mediaLoading&&!this.mediaEnded&&this.mediaSeekableEnd>0&&Jy(this)};wh=new WeakMap;Bd=new WeakSet;Cm=function(i){var e;const s=((e=this.getAttribute("bounds")?$n(this,`#${this.getAttribute("bounds")}`):this.parentElement)!=null?e:this).getBoundingClientRect(),r=this.range.getBoundingClientRect(),n=i.offsetWidth,a=-(r.left-s.left-n/2),o=s.right-r.left-n/2;return{box:{width:n,min:a,max:o},bounds:s,range:r}};Hd=new WeakSet;wm=function(i,e){let t=`${e*100}%`;const{width:s,min:r,max:n}=i.box;if(!s)return t;if(Number.isNaN(r)||(t=`max(${`calc(1 / var(--_range-width) * 100 * ${r}% + var(--media-box-padding-left))`}, ${t})`),!Number.isNaN(n)){const o=`calc(1 / var(--_range-width) * 100 * ${n}% - var(--media-box-padding-right))`;t=`min(${t}, ${o})`}return t};Gd=new WeakSet;Mm=function(i,e){const{width:t,min:s,max:r}=i.box,n=e*i.range.width;if(n<s+je(this,to)){const a=i.range.left-i.bounds.left-je(this,to);return`${n-t/2+a}px`}if(n>r-je(this,io)){const a=i.bounds.right-i.range.right-je(this,io);return`${n+t/2-a-i.range.width}px`}return 0};Mh=new WeakSet;zT=function(i){const e=[...je(this,$d)].some(u=>i.composedPath().includes(u));if(!this.dragging&&(e||!i.composedPath().includes(this))){_t(this,so,Kd).call(this,null);return}const t=this.mediaSeekableEnd;if(!t)return;const s=et(this.shadowRoot,"#preview-rail"),r=et(this.shadowRoot,'[part~="preview-box"]'),n=_t(this,Bd,Cm).call(this,je(this,Fd));let a=(i.clientX-n.range.left)/n.range.width;a=Math.max(0,Math.min(1,a));const o=_t(this,Hd,wm).call(this,n,a),l=_t(this,Gd,Mm).call(this,n,a);s.style.transform=`translateX(${o})`,s.style.setProperty("--_range-width",`${n.range.width}`),r.style.setProperty("--_box-shift",`${l}`),r.style.setProperty("--_box-width",`${n.box.width}px`);const d=Math.round(je(this,Ma))-Math.round(a*t);Math.abs(d)<1&&a>.01&&a<.99||(Qt(this,Ma,a*t),_t(this,so,Kd).call(this,je(this,Ma)))};so=new WeakSet;Kd=function(i){this.dispatchEvent(new k.CustomEvent(X.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:i}))};Ph=new WeakSet;QT=function(){je(this,Tr).stop();const i=XT(this);this.dispatchEvent(new k.CustomEvent(X.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:i}))};Pm.shadowRootOptions={mode:"open"};Pm.getTemplateHTML=iM;k.customElements.get("media-time-range")||k.customElements.define("media-time-range",Pm);const sM=1,rM=i=>i.mediaMuted?0:i.mediaVolume,nM=i=>`${Math.round(i*100)}%`;class aM extends Fn{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_VOLUME,_.MEDIA_MUTED,_.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.addEventListener("input",()=>{const e=this.range.value,t=new k.CustomEvent(X.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)})}connectedCallback(){super.connectedCallback(),this.range.setAttribute("aria-label",J("volume"))}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),(e===_.MEDIA_VOLUME||e===_.MEDIA_MUTED)&&(this.range.valueAsNumber=rM(this),this.range.setAttribute("aria-valuetext",nM(this.range.valueAsNumber)),this.updateBar())}get mediaVolume(){return Oe(this,_.MEDIA_VOLUME,sM)}set mediaVolume(e){qe(this,_.MEDIA_VOLUME,e)}get mediaMuted(){return Ee(this,_.MEDIA_MUTED)}set mediaMuted(e){ye(this,_.MEDIA_MUTED,e)}get mediaVolumeUnavailable(){return Ne(this,_.MEDIA_VOLUME_UNAVAILABLE)}set mediaVolumeUnavailable(e){Ue(this,_.MEDIA_VOLUME_UNAVAILABLE,e)}}k.customElements.get("media-volume-range")||k.customElements.define("media-volume-range",aM);var ZT=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ce=(i,e,t)=>(ZT(i,e,"read from private field"),t?t.call(i):e.get(i)),Bi=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},ds=(i,e,t,s)=>(ZT(i,e,"write to private field"),e.set(i,t),t),rn,Hl,sr,Ea,Rs,xs,ks,rr,nn,Gl,ui;const D0=1,C0=0,oM=1,lM={processCallback(i,e,t){if(t){for(const[s,r]of e)if(s in t){const n=t[s];typeof n=="boolean"&&r instanceof vi&&typeof r.element[r.attributeName]=="boolean"?r.booleanValue=n:typeof n=="function"&&r instanceof vi?r.element[r.attributeName]=n:r.value=n}}}};class bu extends k.DocumentFragment{constructor(e,t,s=lM){var r;super(),Bi(this,rn,void 0),Bi(this,Hl,void 0),this.append(e.content.cloneNode(!0)),ds(this,rn,JT(this)),ds(this,Hl,s),(r=s.createCallback)==null||r.call(s,this,ce(this,rn),t),s.processCallback(this,ce(this,rn),t)}update(e){ce(this,Hl).processCallback(this,ce(this,rn),e)}}rn=new WeakMap;Hl=new WeakMap;const JT=(i,e=[])=>{let t,s;for(const r of i.attributes||[])if(r.value.includes("{{")){const n=new uM;for([t,s]of M0(r.value))if(!t)n.append(s);else{const a=new vi(i,r.name,r.namespaceURI);n.append(a),e.push([s,a])}r.value=n.toString()}for(const r of i.childNodes)if(r.nodeType===D0&&!(r instanceof HTMLTemplateElement))JT(r,e);else{const n=r.data;if(r.nodeType===D0||n.includes("{{")){const a=[];if(n)for([t,s]of M0(n))if(!t)a.push(new Text(s));else{const o=new Bn(i);a.push(o),e.push([s,o])}else if(r instanceof HTMLTemplateElement){const o=new ib(i,r);a.push(o),e.push([o.expression,o])}r.replaceWith(...a.flatMap(o=>o.replacementNodes||[o]))}}return e},w0={},M0=i=>{let e="",t=0,s=w0[i],r=0,n;if(s)return s;for(s=[];n=i[r];r++)n==="{"&&i[r+1]==="{"&&i[r-1]!=="\\"&&i[r+2]&&++t==1?(e&&s.push([C0,e]),e="",r++):n==="}"&&i[r+1]==="}"&&i[r-1]!=="\\"&&!--t?(s.push([oM,e.trim()]),e="",r++):e+=n||"";return e&&s.push([C0,(t>0?"{{":"")+e]),w0[i]=s},dM=11;class eb{get value(){return""}set value(e){}toString(){return this.value}}const tb=new WeakMap;class uM{constructor(){Bi(this,sr,[])}[Symbol.iterator](){return ce(this,sr).values()}get length(){return ce(this,sr).length}item(e){return ce(this,sr)[e]}append(...e){for(const t of e)t instanceof vi&&tb.set(t,this),ce(this,sr).push(t)}toString(){return ce(this,sr).join("")}}sr=new WeakMap;class vi extends eb{constructor(e,t,s){super(),Bi(this,rr),Bi(this,Ea,""),Bi(this,Rs,void 0),Bi(this,xs,void 0),Bi(this,ks,void 0),ds(this,Rs,e),ds(this,xs,t),ds(this,ks,s)}get attributeName(){return ce(this,xs)}get attributeNamespace(){return ce(this,ks)}get element(){return ce(this,Rs)}get value(){return ce(this,Ea)}set value(e){ce(this,Ea)!==e&&(ds(this,Ea,e),!ce(this,rr,nn)||ce(this,rr,nn).length===1?e==null?ce(this,Rs).removeAttributeNS(ce(this,ks),ce(this,xs)):ce(this,Rs).setAttributeNS(ce(this,ks),ce(this,xs),e):ce(this,Rs).setAttributeNS(ce(this,ks),ce(this,xs),ce(this,rr,nn).toString()))}get booleanValue(){return ce(this,Rs).hasAttributeNS(ce(this,ks),ce(this,xs))}set booleanValue(e){if(!ce(this,rr,nn)||ce(this,rr,nn).length===1)this.value=e?"":null;else throw new DOMException("Value is not fully templatized")}}Ea=new WeakMap;Rs=new WeakMap;xs=new WeakMap;ks=new WeakMap;rr=new WeakSet;nn=function(){return tb.get(this)};class Bn extends eb{constructor(e,t){super(),Bi(this,Gl,void 0),Bi(this,ui,void 0),ds(this,Gl,e),ds(this,ui,t?[...t]:[new Text])}get replacementNodes(){return ce(this,ui)}get parentNode(){return ce(this,Gl)}get nextSibling(){return ce(this,ui)[ce(this,ui).length-1].nextSibling}get previousSibling(){return ce(this,ui)[0].previousSibling}get value(){return ce(this,ui).map(e=>e.textContent).join("")}set value(e){this.replace(e)}replace(...e){const t=e.flat().flatMap(s=>s==null?[new Text]:s.forEach?[...s]:s.nodeType===dM?[...s.childNodes]:s.nodeType?[s]:[new Text(s)]);t.length||t.push(new Text),ds(this,ui,cM(ce(this,ui)[0].parentNode,ce(this,ui),t,this.nextSibling))}}Gl=new WeakMap;ui=new WeakMap;class ib extends Bn{constructor(e,t){const s=t.getAttribute("directive")||t.getAttribute("type");let r=t.getAttribute("expression")||t.getAttribute(s)||"";r.startsWith("{{")&&(r=r.trim().slice(2,-2).trim()),super(e),this.expression=r,this.template=t,this.directive=s}}function cM(i,e,t,s=null){let r=0,n,a,o,l=t.length,d=e.length;for(;r<l&&r<d&&e[r]==t[r];)r++;for(;r<l&&r<d&&t[l-1]==e[d-1];)s=t[--d,--l];if(r==d)for(;r<l;)i.insertBefore(t[r++],s);if(r==l)for(;r<d;)i.removeChild(e[r++]);else{for(n=e[r];r<l;)o=t[r++],a=n?n.nextSibling:s,n==o?n=a:r<l&&t[r]==a?(i.replaceChild(o,n),n=a):i.insertBefore(o,n);for(;n!=s;)a=n.nextSibling,i.removeChild(n),n=a}return t}const P0={string:i=>String(i)};class sb{constructor(e){this.template=e,this.state=void 0}}const fr=new WeakMap,mr=new WeakMap,Oh={partial:(i,e)=>{e[i.expression]=new sb(i.template)},if:(i,e)=>{var t;if(rb(i.expression,e))if(fr.get(i)!==i.template){fr.set(i,i.template);const s=new bu(i.template,e,Om);i.replace(s),mr.set(i,s)}else(t=mr.get(i))==null||t.update(e);else i.replace(""),fr.delete(i),mr.delete(i)}},hM=Object.keys(Oh),Om={processCallback(i,e,t){var s,r;if(t)for(const[n,a]of e){if(a instanceof ib){if(!a.directive){const l=hM.find(d=>a.template.hasAttribute(d));l&&(a.directive=l,a.expression=a.template.getAttribute(l))}(s=Oh[a.directive])==null||s.call(Oh,a,t);continue}let o=rb(n,t);if(o instanceof sb){fr.get(a)!==o.template?(fr.set(a,o.template),o=new bu(o.template,o.state,Om),a.value=o,mr.set(a,o)):(r=mr.get(a))==null||r.update(o.state);continue}o?(a instanceof vi&&a.attributeName.startsWith("aria-")&&(o=String(o)),a instanceof vi?typeof o=="boolean"?a.booleanValue=o:typeof o=="function"?a.element[a.attributeName]=o:a.value=o:(a.value=o,fr.delete(a),mr.delete(a))):a instanceof vi?a.value=void 0:(a.value=void 0,fr.delete(a),mr.delete(a))}}},O0={"!":i=>!i,"!!":i=>!!i,"==":(i,e)=>i==e,"!=":(i,e)=>i!=e,">":(i,e)=>i>e,">=":(i,e)=>i>=e,"<":(i,e)=>i<e,"<=":(i,e)=>i<=e,"??":(i,e)=>i??e,"|":(i,e)=>{var t;return(t=P0[e])==null?void 0:t.call(P0,i)}};function fM(i){return mM(i,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=><][=!]?|\?\?|\|/,ws:/\s+/,param:/[$a-z_][$\w]*/i}).filter(({type:e})=>e!=="ws")}function rb(i,e={}){var t,s,r,n,a,o,l;const d=fM(i);if(d.length===0||d.some(({type:u})=>!u))return zn(i);if(((t=d[0])==null?void 0:t.token)===">"){const u=e[(s=d[1])==null?void 0:s.token];if(!u)return zn(i);const c={...e};u.state=c;const h=d.slice(2);for(let f=0;f<h.length;f+=3){const m=(r=h[f])==null?void 0:r.token,g=(n=h[f+1])==null?void 0:n.token,p=(a=h[f+2])==null?void 0:a.token;m&&g==="="&&(c[m]=Qn(p,e))}return u}if(d.length===1)return qo(d[0])?Qn(d[0].token,e):zn(i);if(d.length===2){const u=(o=d[0])==null?void 0:o.token,c=O0[u];if(!c||!qo(d[1]))return zn(i);const h=Qn(d[1].token,e);return c(h)}if(d.length===3){const u=(l=d[1])==null?void 0:l.token,c=O0[u];if(!c||!qo(d[0])||!qo(d[2]))return zn(i);const h=Qn(d[0].token,e);if(u==="|")return c(h,d[2].token);const f=Qn(d[2].token,e);return c(h,f)}}function zn(i){return console.warn(`Warning: invalid expression \`${i}\``),!1}function qo({type:i}){return["number","boolean","string","param"].includes(i)}function Qn(i,e){const t=i[0],s=i.slice(-1);return i==="true"||i==="false"?i==="true":t===s&&["'",'"'].includes(t)?i.slice(1,-1):Ky(i)?parseFloat(i):e[i]}function mM(i,e){let t,s,r;const n=[];for(;i;){r=null,t=i.length;for(const a in e)s=e[a].exec(i),s&&s.index<t&&(r={token:s[0],type:a,matches:s.slice(1)},t=s.index);t&&n.push({token:i.substr(0,t),type:void 0}),r&&n.push(r),i=i.substr(t+(r?r.token.length:0))}return n}var Nm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Nh=(i,e,t)=>(Nm(i,e,"read from private field"),t?t.call(i):e.get(i)),Xn=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},pr=(i,e,t,s)=>(Nm(i,e,"write to private field"),e.set(i,t),t),mc=(i,e,t)=>(Nm(i,e,"access private method"),t),_n,Kl,An,Uh,nb,Vl,$h;const pc={mediatargetlivewindow:"targetlivewindow",mediastreamtype:"streamtype"},ab=ut.createElement("template");ab.innerHTML=`
  <style>
    :host {
      display: inline-block;
      line-height: 0;
    }

    media-controller {
      width: 100%;
      height: 100%;
    }

    media-captions-button:not([mediasubtitleslist]),
    media-captions-menu:not([mediasubtitleslist]),
    media-captions-menu-button:not([mediasubtitleslist]),
    media-audio-track-menu[mediaaudiotrackunavailable],
    media-audio-track-menu-button[mediaaudiotrackunavailable],
    media-rendition-menu[mediarenditionunavailable],
    media-rendition-menu-button[mediarenditionunavailable],
    media-volume-range[mediavolumeunavailable],
    media-airplay-button[mediaairplayunavailable],
    media-fullscreen-button[mediafullscreenunavailable],
    media-cast-button[mediacastunavailable],
    media-pip-button[mediapipunavailable] {
      display: none;
    }
  </style>
`;class _u extends k.HTMLElement{constructor(){super(),Xn(this,Uh),Xn(this,Vl),Xn(this,_n,void 0),Xn(this,Kl,void 0),Xn(this,An,void 0),this.shadowRoot?this.renderRoot=this.shadowRoot:(this.renderRoot=this.attachShadow({mode:"open"}),this.createRenderer());const e=new MutationObserver(t=>{var s;this.mediaController&&!((s=this.mediaController)!=null&&s.breakpointsComputed)||t.some(r=>{const n=r.target;return n===this?!0:n.localName!=="media-controller"?!1:!!(pc[r.attributeName]||r.attributeName.startsWith("breakpoint"))})&&this.render()});e.observe(this,{attributes:!0}),e.observe(this.renderRoot,{attributes:!0,subtree:!0}),this.addEventListener(fs.BREAKPOINTS_COMPUTED,this.render),mc(this,Uh,nb).call(this,"template")}get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var e;return(e=Nh(this,_n))!=null?e:this.constructor.template}set template(e){if(e===null){this.removeAttribute("template");return}typeof e=="string"?this.setAttribute("template",e):e instanceof HTMLTemplateElement&&(pr(this,_n,e),pr(this,An,null),this.createRenderer())}get props(){var e,t,s;const r=[...Array.from((t=(e=this.mediaController)==null?void 0:e.attributes)!=null?t:[]).filter(({name:a})=>pc[a]||a.startsWith("breakpoint")),...Array.from(this.attributes)],n={};for(const a of r){const o=(s=pc[a.name])!=null?s:ID(a.name);let{value:l}=a;l!=null?(Ky(l)&&(l=parseFloat(l)),n[o]=l===""?!0:l):n[o]=!1}return n}attributeChangedCallback(e,t,s){e==="template"&&t!=s&&mc(this,Vl,$h).call(this)}connectedCallback(){mc(this,Vl,$h).call(this)}createRenderer(){this.template instanceof HTMLTemplateElement&&this.template!==Nh(this,Kl)&&(pr(this,Kl,this.template),this.renderer=new bu(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(ab.content.cloneNode(!0),this.renderer))}render(){var e;(e=this.renderer)==null||e.update(this.props)}}_n=new WeakMap;Kl=new WeakMap;An=new WeakMap;Uh=new WeakSet;nb=function(i){if(Object.prototype.hasOwnProperty.call(this,i)){const e=this[i];delete this[i],this[i]=e}};Vl=new WeakSet;$h=function(){var i;const e=this.getAttribute("template");if(!e||e===Nh(this,An))return;const t=this.getRootNode(),s=(i=t?.getElementById)==null?void 0:i.call(t,e);if(s){pr(this,An,e),pr(this,_n,s),this.createRenderer();return}pM(e)&&(pr(this,An,e),gM(e).then(r=>{const n=ut.createElement("template");n.innerHTML=r,pr(this,_n,n),this.createRenderer()}).catch(console.error))};_u.observedAttributes=["template"];_u.processor=Om;function pM(i){if(!/^(\/|\.\/|https?:\/\/)/.test(i))return!1;const e=/^https?:\/\//.test(i)?void 0:location.origin;try{new URL(i,e)}catch{return!1}return!0}async function gM(i){const e=await fetch(i);if(e.status!==200)throw new Error(`Failed to load resource: the server responded with a status of ${e.status}`);return e.text()}k.customElements.get("media-theme")||k.customElements.define("media-theme",_u);function vM({anchor:i,floating:e,placement:t}){const s=EM({anchor:i,floating:e}),{x:r,y:n}=TM(s,t);return{x:r,y:n}}function EM({anchor:i,floating:e}){return{anchor:yM(i,e.offsetParent),floating:{x:0,y:0,width:e.offsetWidth,height:e.offsetHeight}}}function yM(i,e){var t;const s=i.getBoundingClientRect(),r=(t=e?.getBoundingClientRect())!=null?t:{x:0,y:0};return{x:s.x-r.x,y:s.y-r.y,width:s.width,height:s.height}}function TM({anchor:i,floating:e},t){const s=bM(t)==="x"?"y":"x",r=s==="y"?"height":"width",n=ob(t),a=i.x+i.width/2-e.width/2,o=i.y+i.height/2-e.height/2,l=i[r]/2-e[r]/2;let d;switch(n){case"top":d={x:a,y:i.y-e.height};break;case"bottom":d={x:a,y:i.y+i.height};break;case"right":d={x:i.x+i.width,y:o};break;case"left":d={x:i.x-e.width,y:o};break;default:d={x:i.x,y:i.y}}switch(t.split("-")[1]){case"start":d[s]-=l;break;case"end":d[s]+=l;break}return d}function ob(i){return i.split("-")[0]}function bM(i){return["top","bottom"].includes(ob(i))?"y":"x"}class Um extends Event{constructor({action:e="auto",relatedTarget:t,...s}){super("invoke",s),this.action=e,this.relatedTarget=t}}class _M extends Event{constructor({newState:e,oldState:t,...s}){super("toggle",s),this.newState=e,this.oldState=t}}var $m=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},be=(i,e,t)=>($m(i,e,"read from private field"),t?t.call(i):e.get(i)),xe=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Oi=(i,e,t,s)=>($m(i,e,"write to private field"),e.set(i,t),t),ke=(i,e,t)=>($m(i,e,"access private method"),t),Ni,br,Gs,Wl,ql,_r,ro,Fh,lb,Vd,Fm,Wd,Yl,Bh,Hh,db,Gh,ub,Kh,cb,Sn,In,Ln,no,qd,Bm,Vh,hb,Hm,fb,Wh,mb,Gm,pb,qh,gb,Yh,vb,Pa,Yd,jh,Eb,Oa,jd,jl,zh;function On({type:i,text:e,value:t,checked:s}){const r=ut.createElement("media-chrome-menu-item");r.type=i,r.part.add("menu-item"),r.part.add(i),r.value=t,r.checked=s;const n=ut.createElement("span");return n.textContent=e,r.append(n),r}function Ar(i,e){let t=i.querySelector(`:scope > [slot="${e}"]`);if(t?.nodeName=="SLOT"&&(t=t.assignedElements({flatten:!0})[0]),t)return t=t.cloneNode(!0),t;const s=i.shadowRoot.querySelector(`[name="${e}"] > svg`);return s?s.cloneNode(!0):""}function AM(i){return`
    <style>
      :host {
        font: var(--media-font,
          var(--media-font-weight, normal)
          var(--media-font-size, 14px) /
          var(--media-text-content-height, var(--media-control-height, 24px))
          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));
        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));
        --_menu-bg: rgb(20 20 30 / .8);
        background: var(--media-menu-background, var(--media-control-background, var(--media-secondary-color, var(--_menu-bg))));
        border-radius: var(--media-menu-border-radius);
        border: var(--media-menu-border, none);
        display: var(--media-menu-display, inline-flex) !important;
        
        transition: var(--media-menu-transition-in,
          visibility 0s,
          opacity .2s ease-out,
          transform .15s ease-out,
          left .2s ease-in-out,
          min-width .2s ease-in-out,
          min-height .2s ease-in-out
        ) !important;
        
        visibility: var(--media-menu-visibility, visible);
        opacity: var(--media-menu-opacity, 1);
        max-height: var(--media-menu-max-height, var(--_menu-max-height, 300px));
        transform: var(--media-menu-transform-in, translateY(0) scale(1));
        flex-direction: column;
        
        min-height: 0;
        position: relative;
        bottom: var(--_menu-bottom);
        box-sizing: border-box;
      } 

      @-moz-document url-prefix() {
        :host{
          --_menu-bg: rgb(20 20 30);
        }
      }

      :host([hidden]) {
        transition: var(--media-menu-transition-out,
          visibility .15s ease-in,
          opacity .15s ease-in,
          transform .15s ease-in
        ) !important;
        visibility: var(--media-menu-hidden-visibility, hidden);
        opacity: var(--media-menu-hidden-opacity, 0);
        max-height: var(--media-menu-hidden-max-height,
          var(--media-menu-max-height, var(--_menu-max-height, 300px)));
        transform: var(--media-menu-transform-out, translateY(2px) scale(.99));
        pointer-events: none;
      }

      :host([slot="submenu"]) {
        background: none;
        width: 100%;
        min-height: 100%;
        position: absolute;
        bottom: 0;
        right: -100%;
      }

      #container {
        display: flex;
        flex-direction: column;
        min-height: 0;
        transition: transform .2s ease-out;
        transform: translate(0, 0);
      }

      #container.has-expanded {
        transition: transform .2s ease-in;
        transform: translate(-100%, 0);
      }

      button {
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        font: inherit;
        outline: inherit;
        display: inline-flex;
        align-items: center;
      }

      slot[name="header"][hidden] {
        display: none;
      }

      slot[name="header"] > *,
      slot[name="header"]::slotted(*) {
        padding: .4em .7em;
        border-bottom: 1px solid rgb(255 255 255 / .25);
        cursor: var(--media-cursor, default);
      }

      slot[name="header"] > button[part~="back"],
      slot[name="header"]::slotted(button[part~="back"]) {
        cursor: var(--media-cursor, pointer);
      }

      svg[part~="back"] {
        height: var(--media-menu-icon-height, var(--media-control-height, 24px));
        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
        display: block;
        margin-right: .5ch;
      }

      slot:not([name]) {
        gap: var(--media-menu-gap);
        flex-direction: var(--media-menu-flex-direction, column);
        overflow: var(--media-menu-overflow, hidden auto);
        display: flex;
        min-height: 0;
      }

      :host([role="menu"]) slot:not([name]) {
        padding-block: .4em;
      }

      slot:not([name])::slotted([role="menu"]) {
        background: none;
      }

      media-chrome-menu-item > span {
        margin-right: .5ch;
        max-width: var(--media-menu-item-max-width);
        text-overflow: ellipsis;
        overflow: hidden;
      }
    </style>
    <style id="layout-row" media="width:0">

      slot[name="header"] > *,
      slot[name="header"]::slotted(*) {
        padding: .4em .5em;
      }

      slot:not([name]) {
        gap: var(--media-menu-gap, .25em);
        flex-direction: var(--media-menu-flex-direction, row);
        padding-inline: .5em;
      }

      media-chrome-menu-item {
        padding: .3em .5em;
      }

      media-chrome-menu-item[aria-checked="true"] {
        background: var(--media-menu-item-checked-background, rgb(255 255 255 / .2));
      }

      
      media-chrome-menu-item::part(checked-indicator) {
        display: var(--media-menu-item-checked-indicator-display, none);
      }
    </style>
    <div id="container" part="container">
      <slot name="header" hidden>
        <button part="back button" aria-label="Back to previous menu">
          <slot name="back-icon">
            <svg aria-hidden="true" viewBox="0 0 20 24" part="back indicator">
              <path d="m11.88 17.585.742-.669-4.2-4.665 4.2-4.666-.743-.669-4.803 5.335 4.803 5.334Z"/>
            </svg>
          </slot>
          <slot name="title"></slot>
        </button>
      </slot>
      <slot></slot>
    </div>
    <slot name="checked-indicator" hidden></slot>
  `}const Qs={STYLE:"style",HIDDEN:"hidden",DISABLED:"disabled",ANCHOR:"anchor"};class ri extends k.HTMLElement{constructor(){if(super(),xe(this,Fh),xe(this,Vd),xe(this,Yl),xe(this,Hh),xe(this,Gh),xe(this,Kh),xe(this,Ln),xe(this,qd),xe(this,Vh),xe(this,Hm),xe(this,Wh),xe(this,Gm),xe(this,qh),xe(this,Yh),xe(this,Pa),xe(this,jh),xe(this,Oa),xe(this,jl),xe(this,Ni,null),xe(this,br,null),xe(this,Gs,null),xe(this,Wl,new Set),xe(this,ql,void 0),xe(this,_r,!1),xe(this,ro,null),xe(this,Wd,()=>{const e=be(this,Wl),t=new Set(this.items);for(const s of e)t.has(s)||this.dispatchEvent(new CustomEvent("removemenuitem",{detail:s}));for(const s of t)e.has(s)||this.dispatchEvent(new CustomEvent("addmenuitem",{detail:s}));Oi(this,Wl,t)}),xe(this,Sn,()=>{ke(this,Ln,no).call(this),ke(this,qd,Bm).call(this,!1)}),xe(this,In,()=>{ke(this,Ln,no).call(this)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.container=this.shadowRoot.querySelector("#container"),this.defaultSlot=this.shadowRoot.querySelector("slot:not([name])"),this.shadowRoot.addEventListener("slotchange",this),Oi(this,ql,new MutationObserver(be(this,Wd))),be(this,ql).observe(this.defaultSlot,{childList:!0})}static get observedAttributes(){return[Qs.DISABLED,Qs.HIDDEN,Qs.STYLE,Qs.ANCHOR,_e.MEDIA_CONTROLLER]}static formatMenuItemText(e,t){return e}enable(){this.addEventListener("click",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this),this.addEventListener("invoke",this),this.addEventListener("toggle",this)}disable(){this.removeEventListener("click",this),this.removeEventListener("focusout",this),this.removeEventListener("keyup",this),this.removeEventListener("invoke",this),this.removeEventListener("toggle",this)}handleEvent(e){switch(e.type){case"slotchange":ke(this,Fh,lb).call(this,e);break;case"invoke":ke(this,Hh,db).call(this,e);break;case"click":ke(this,Vh,hb).call(this,e);break;case"toggle":ke(this,Wh,mb).call(this,e);break;case"focusout":ke(this,qh,gb).call(this,e);break;case"keydown":ke(this,Yh,vb).call(this,e);break}}connectedCallback(){var e,t;Oi(this,ro,eT(this.shadowRoot,":host")),ke(this,Yl,Bh).call(this),this.hasAttribute("disabled")||this.enable(),this.role||(this.role="menu"),Oi(this,Ni,uh(this)),(t=(e=be(this,Ni))==null?void 0:e.associateElement)==null||t.call(e,this),this.hidden||(Cn(ao(this),be(this,Sn)),Cn(this,be(this,In))),ke(this,Vd,Fm).call(this)}disconnectedCallback(){var e,t;wn(ao(this),be(this,Sn)),wn(this,be(this,In)),this.disable(),(t=(e=be(this,Ni))==null?void 0:e.unassociateElement)==null||t.call(e,this),Oi(this,Ni,null)}attributeChangedCallback(e,t,s){var r,n,a,o;e===Qs.HIDDEN&&s!==t?(be(this,_r)||Oi(this,_r,!0),this.hidden?ke(this,Kh,cb).call(this):ke(this,Gh,ub).call(this),this.dispatchEvent(new _M({oldState:this.hidden?"open":"closed",newState:this.hidden?"closed":"open",bubbles:!0}))):e===_e.MEDIA_CONTROLLER?(t&&((n=(r=be(this,Ni))==null?void 0:r.unassociateElement)==null||n.call(r,this),Oi(this,Ni,null)),s&&this.isConnected&&(Oi(this,Ni,uh(this)),(o=(a=be(this,Ni))==null?void 0:a.associateElement)==null||o.call(a,this))):e===Qs.DISABLED&&s!==t?s==null?this.enable():this.disable():e===Qs.STYLE&&s!==t&&ke(this,Yl,Bh).call(this)}formatMenuItemText(e,t){return this.constructor.formatMenuItemText(e,t)}get anchor(){return this.getAttribute("anchor")}set anchor(e){this.setAttribute("anchor",`${e}`)}get anchorElement(){var e;return this.anchor?(e=uu(this))==null?void 0:e.querySelector(`#${this.anchor}`):null}get items(){return this.defaultSlot.assignedElements({flatten:!0}).filter(SM)}get radioGroupItems(){return this.items.filter(e=>e.role==="menuitemradio")}get checkedItems(){return this.items.filter(e=>e.checked)}get value(){var e,t;return(t=(e=this.checkedItems[0])==null?void 0:e.value)!=null?t:""}set value(e){const t=this.items.find(s=>s.value===e);t&&ke(this,jl,zh).call(this,t)}focus(){if(Oi(this,br,sm()),this.items.length){ke(this,Oa,jd).call(this,this.items[0]),this.items[0].focus();return}const e=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');e?.focus()}handleSelect(e){var t;const s=ke(this,Pa,Yd).call(this,e);s&&(ke(this,jl,zh).call(this,s,s.type==="checkbox"),be(this,Gs)&&!this.hidden&&((t=be(this,br))==null||t.focus(),this.hidden=!0))}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","Home","End"]}handleMove(e){var t,s;const{key:r}=e,n=this.items,a=(s=(t=ke(this,Pa,Yd).call(this,e))!=null?t:ke(this,jh,Eb).call(this))!=null?s:n[0],o=n.indexOf(a);let l=Math.max(0,o);r==="ArrowDown"?l++:r==="ArrowUp"?l--:e.key==="Home"?l=0:e.key==="End"&&(l=n.length-1),l<0&&(l=n.length-1),l>n.length-1&&(l=0),ke(this,Oa,jd).call(this,n[l]),n[l].focus()}}Ni=new WeakMap;br=new WeakMap;Gs=new WeakMap;Wl=new WeakMap;ql=new WeakMap;_r=new WeakMap;ro=new WeakMap;Fh=new WeakSet;lb=function(i){const e=i.target;for(const t of e.assignedNodes({flatten:!0}))t.nodeType===3&&t.textContent.trim()===""&&t.remove();["header","title"].includes(e.name)&&ke(this,Vd,Fm).call(this),e.name||be(this,Wd).call(this)};Vd=new WeakSet;Fm=function(){const i=this.shadowRoot.querySelector('slot[name="header"]'),e=this.shadowRoot.querySelector('slot[name="title"]');i.hidden=e.assignedNodes().length===0&&i.assignedNodes().length===0};Wd=new WeakMap;Yl=new WeakSet;Bh=function(){var i;const e=this.shadowRoot.querySelector("#layout-row"),t=(i=getComputedStyle(this).getPropertyValue("--media-menu-layout"))==null?void 0:i.trim();e.setAttribute("media",t==="row"?"":"width:0")};Hh=new WeakSet;db=function(i){Oi(this,Gs,i.relatedTarget),ps(this,i.relatedTarget)||(this.hidden=!this.hidden)};Gh=new WeakSet;ub=function(){var i;(i=be(this,Gs))==null||i.setAttribute("aria-expanded","true"),this.addEventListener("transitionend",()=>this.focus(),{once:!0}),Cn(ao(this),be(this,Sn)),Cn(this,be(this,In))};Kh=new WeakSet;cb=function(){var i;(i=be(this,Gs))==null||i.setAttribute("aria-expanded","false"),wn(ao(this),be(this,Sn)),wn(this,be(this,In))};Sn=new WeakMap;In=new WeakMap;Ln=new WeakSet;no=function(i){if(this.hasAttribute("mediacontroller")&&!this.anchor||this.hidden||!this.anchorElement)return;const{x:e,y:t}=vM({anchor:this.anchorElement,floating:this,placement:"top-start"});i??(i=this.offsetWidth);const r=ao(this).getBoundingClientRect(),n=r.width-e-i,a=r.height-t-this.offsetHeight,{style:o}=be(this,ro);o.setProperty("position","absolute"),o.setProperty("right",`${Math.max(0,n)}px`),o.setProperty("--_menu-bottom",`${a}px`);const l=getComputedStyle(this),u=o.getPropertyValue("--_menu-bottom")===l.bottom?a:parseFloat(l.bottom),c=r.height-u-parseFloat(l.marginBottom);this.style.setProperty("--_menu-max-height",`${c}px`)};qd=new WeakSet;Bm=function(i){const e=this.querySelector('[role="menuitem"][aria-haspopup][aria-expanded="true"]'),t=e?.querySelector('[role="menu"]'),{style:s}=be(this,ro);if(i||s.setProperty("--media-menu-transition-in","none"),t){const r=t.offsetHeight,n=Math.max(t.offsetWidth,e.offsetWidth);this.style.setProperty("min-width",`${n}px`),this.style.setProperty("min-height",`${r}px`),ke(this,Ln,no).call(this,n)}else this.style.removeProperty("min-width"),this.style.removeProperty("min-height"),ke(this,Ln,no).call(this);s.removeProperty("--media-menu-transition-in")};Vh=new WeakSet;hb=function(i){var e;if(i.stopPropagation(),i.composedPath().includes(be(this,Hm,fb))){(e=be(this,br))==null||e.focus(),this.hidden=!0;return}const t=ke(this,Pa,Yd).call(this,i);!t||t.hasAttribute("disabled")||(ke(this,Oa,jd).call(this,t),this.handleSelect(i))};Hm=new WeakSet;fb=function(){var i;return(i=this.shadowRoot.querySelector('slot[name="header"]').assignedElements({flatten:!0}))==null?void 0:i.find(t=>t.matches('button[part~="back"]'))};Wh=new WeakSet;mb=function(i){if(i.target===this)return;ke(this,Gm,pb).call(this);const e=Array.from(this.querySelectorAll('[role="menuitem"][aria-haspopup]'));for(const t of e)t.invokeTargetElement!=i.target&&i.newState=="open"&&t.getAttribute("aria-expanded")=="true"&&!t.invokeTargetElement.hidden&&t.invokeTargetElement.dispatchEvent(new Um({relatedTarget:t}));for(const t of e)t.setAttribute("aria-expanded",`${!t.submenuElement.hidden}`);ke(this,qd,Bm).call(this,!0)};Gm=new WeakSet;pb=function(){const e=this.querySelector('[role="menuitem"] > [role="menu"]:not([hidden])');this.container.classList.toggle("has-expanded",!!e)};qh=new WeakSet;gb=function(i){var e;ps(this,i.relatedTarget)||(be(this,_r)&&((e=be(this,br))==null||e.focus()),be(this,Gs)&&be(this,Gs)!==i.relatedTarget&&!this.hidden&&(this.hidden=!0))};Yh=new WeakSet;vb=function(i){var e,t,s,r,n;const{key:a,ctrlKey:o,altKey:l,metaKey:d}=i;if(!(o||l||d)&&this.keysUsed.includes(a))if(i.preventDefault(),i.stopPropagation(),a==="Tab"){if(be(this,_r)){this.hidden=!0;return}i.shiftKey?(t=(e=this.previousElementSibling)==null?void 0:e.focus)==null||t.call(e):(r=(s=this.nextElementSibling)==null?void 0:s.focus)==null||r.call(s),this.blur()}else a==="Escape"?((n=be(this,br))==null||n.focus(),be(this,_r)&&(this.hidden=!0)):a==="Enter"||a===" "?this.handleSelect(i):this.handleMove(i)};Pa=new WeakSet;Yd=function(i){return i.composedPath().find(e=>["menuitemradio","menuitemcheckbox"].includes(e.role))};jh=new WeakSet;Eb=function(){return this.items.find(i=>i.tabIndex===0)};Oa=new WeakSet;jd=function(i){for(const e of this.items)e.tabIndex=e===i?0:-1};jl=new WeakSet;zh=function(i,e){const t=[...this.checkedItems];i.type==="radio"&&this.radioGroupItems.forEach(s=>s.checked=!1),e?i.checked=!i.checked:i.checked=!0,this.checkedItems.some((s,r)=>s!=t[r])&&this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))};ri.shadowRootOptions={mode:"open"};ri.getTemplateHTML=AM;function SM(i){return["menuitem","menuitemradio","menuitemcheckbox"].includes(i?.role)}function ao(i){var e;return(e=i.getAttribute("bounds")?$n(i,`#${i.getAttribute("bounds")}`):Ct(i)||i.parentElement)!=null?e:i}k.customElements.get("media-chrome-menu")||k.customElements.define("media-chrome-menu",ri);var Km=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Wi=(i,e,t)=>(Km(i,e,"read from private field"),t?t.call(i):e.get(i)),is=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},gc=(i,e,t,s)=>(Km(i,e,"write to private field"),e.set(i,t),t),gi=(i,e,t)=>(Km(i,e,"access private method"),t),zl,Na,Qh,yb,zd,Vm,Wm,Tb,qi,Nn,oo,Xh,bb,Ql,Zh;function IM(i){return`
    <style>
      :host {
        transition: var(--media-menu-item-transition,
          background .15s linear,
          opacity .2s ease-in-out
        );
        outline: var(--media-menu-item-outline, 0);
        outline-offset: var(--media-menu-item-outline-offset, -1px);
        cursor: var(--media-cursor, pointer);
        display: flex;
        align-items: center;
        align-self: stretch;
        justify-self: stretch;
        white-space: nowrap;
        white-space-collapse: collapse;
        text-wrap: nowrap;
        padding: .4em .8em .4em 1em;
      }

      :host(:focus-visible) {
        box-shadow: var(--media-menu-item-focus-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));
        outline: var(--media-menu-item-hover-outline, 0);
        outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));
      }

      :host(:hover) {
        cursor: var(--media-cursor, pointer);
        background: var(--media-menu-item-hover-background, rgb(92 92 102 / .5));
        outline: var(--media-menu-item-hover-outline);
        outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));
      }

      :host([aria-checked="true"]) {
        background: var(--media-menu-item-checked-background);
      }

      :host([hidden]) {
        display: none;
      }

      :host([disabled]) {
        pointer-events: none;
        color: rgba(255, 255, 255, .3);
      }

      slot:not([name]) {
        width: 100%;
      }

      slot:not([name="submenu"]) {
        display: inline-flex;
        align-items: center;
        transition: inherit;
        opacity: var(--media-menu-item-opacity, 1);
      }

      slot[name="description"] {
        justify-content: end;
      }

      slot[name="description"] > span {
        display: inline-block;
        margin-inline: 1em .2em;
        max-width: var(--media-menu-item-description-max-width, 100px);
        text-overflow: ellipsis;
        overflow: hidden;
        font-size: .8em;
        font-weight: 400;
        text-align: right;
        position: relative;
        top: .04em;
      }

      slot[name="checked-indicator"] {
        display: none;
      }

      :host(:is([role="menuitemradio"],[role="menuitemcheckbox"])) slot[name="checked-indicator"] {
        display: var(--media-menu-item-checked-indicator-display, inline-block);
      }

      
      svg, img, ::slotted(svg), ::slotted(img) {
        height: var(--media-menu-item-icon-height, var(--media-control-height, 24px));
        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));
        display: block;
      }

      
      [part~="indicator"],
      ::slotted([part~="indicator"]) {
        fill: var(--media-menu-item-indicator-fill,
          var(--media-icon-color, var(--media-primary-color, rgb(238 238 238))));
        height: var(--media-menu-item-indicator-height, 1.25em);
        margin-right: .5ch;
      }

      [part~="checked-indicator"] {
        visibility: hidden;
      }

      :host([aria-checked="true"]) [part~="checked-indicator"] {
        visibility: visible;
      }
    </style>
    <slot name="checked-indicator">
      <svg aria-hidden="true" viewBox="0 1 24 24" part="checked-indicator indicator">
        <path d="m10 15.17 9.193-9.191 1.414 1.414-10.606 10.606-6.364-6.364 1.414-1.414 4.95 4.95Z"/>
      </svg>
    </slot>
    <slot name="prefix"></slot>
    <slot></slot>
    <slot name="description"></slot>
    <slot name="suffix">
      ${this.getSuffixSlotInnerHTML(i)}
    </slot>
    <slot name="submenu"></slot>
  `}function LM(i){return""}const zt={TYPE:"type",VALUE:"value",CHECKED:"checked",DISABLED:"disabled"};class Vs extends k.HTMLElement{constructor(){if(super(),is(this,Qh),is(this,zd),is(this,Wm),is(this,Nn),is(this,Xh),is(this,Ql),is(this,zl,!1),is(this,Na,void 0),is(this,qi,()=>{var e,t;this.submenuElement.items&&this.setAttribute("submenusize",`${this.submenuElement.items.length}`);const s=this.shadowRoot.querySelector('slot[name="description"]'),r=(e=this.submenuElement.checkedItems)==null?void 0:e[0],n=(t=r?.dataset.description)!=null?t:r?.text,a=ut.createElement("span");a.textContent=n??"",s.replaceChildren(a)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);const e=Yt(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.shadowRoot.addEventListener("slotchange",this)}static get observedAttributes(){return[zt.TYPE,zt.DISABLED,zt.CHECKED,zt.VALUE]}enable(){this.hasAttribute("tabindex")||this.setAttribute("tabindex","-1"),Zn(this)&&!this.hasAttribute("aria-checked")&&this.setAttribute("aria-checked","false"),this.addEventListener("click",this),this.addEventListener("keydown",this)}disable(){this.removeAttribute("tabindex"),this.removeEventListener("click",this),this.removeEventListener("keydown",this),this.removeEventListener("keyup",this)}handleEvent(e){switch(e.type){case"slotchange":gi(this,Qh,yb).call(this,e);break;case"click":this.handleClick(e);break;case"keydown":gi(this,Xh,bb).call(this,e);break;case"keyup":gi(this,Nn,oo).call(this,e);break}}attributeChangedCallback(e,t,s){e===zt.CHECKED&&Zn(this)&&!Wi(this,zl)?this.setAttribute("aria-checked",s!=null?"true":"false"):e===zt.TYPE&&s!==t?this.role="menuitem"+s:e===zt.DISABLED&&s!==t&&(s==null?this.enable():this.disable())}connectedCallback(){this.hasAttribute(zt.DISABLED)||this.enable(),this.role="menuitem"+this.type,gc(this,Na,Jh(this,this.parentNode)),gi(this,Ql,Zh).call(this),this.submenuElement&&gi(this,zd,Vm).call(this)}disconnectedCallback(){this.disable(),gi(this,Ql,Zh).call(this),gc(this,Na,null)}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget",`${e}`)}get invokeTargetElement(){var e;return this.invokeTarget?(e=uu(this))==null?void 0:e.querySelector(`#${this.invokeTarget}`):this.submenuElement}get submenuElement(){return this.shadowRoot.querySelector('slot[name="submenu"]').assignedElements({flatten:!0})[0]}get type(){var e;return(e=this.getAttribute(zt.TYPE))!=null?e:""}set type(e){this.setAttribute(zt.TYPE,`${e}`)}get value(){var e;return(e=this.getAttribute(zt.VALUE))!=null?e:this.text}set value(e){this.setAttribute(zt.VALUE,e)}get text(){var e;return((e=this.textContent)!=null?e:"").trim()}get checked(){if(Zn(this))return this.getAttribute("aria-checked")==="true"}set checked(e){Zn(this)&&(gc(this,zl,!0),this.setAttribute("aria-checked",e?"true":"false"),e?this.part.add("checked"):this.part.remove("checked"))}handleClick(e){Zn(this)||this.invokeTargetElement&&ps(this,e.target)&&this.invokeTargetElement.dispatchEvent(new Um({relatedTarget:this}))}get keysUsed(){return["Enter"," "]}}zl=new WeakMap;Na=new WeakMap;Qh=new WeakSet;yb=function(i){const e=i.target;if(!e?.name)for(const s of e.assignedNodes({flatten:!0}))s instanceof Text&&s.textContent.trim()===""&&s.remove();e.name==="submenu"&&(this.submenuElement?gi(this,zd,Vm).call(this):gi(this,Wm,Tb).call(this))};zd=new WeakSet;Vm=async function(){this.setAttribute("aria-haspopup","menu"),this.setAttribute("aria-expanded",`${!this.submenuElement.hidden}`),this.submenuElement.addEventListener("change",Wi(this,qi)),this.submenuElement.addEventListener("addmenuitem",Wi(this,qi)),this.submenuElement.addEventListener("removemenuitem",Wi(this,qi)),Wi(this,qi).call(this)};Wm=new WeakSet;Tb=function(){this.removeAttribute("aria-haspopup"),this.removeAttribute("aria-expanded"),this.submenuElement.removeEventListener("change",Wi(this,qi)),this.submenuElement.removeEventListener("addmenuitem",Wi(this,qi)),this.submenuElement.removeEventListener("removemenuitem",Wi(this,qi)),Wi(this,qi).call(this)};qi=new WeakMap;Nn=new WeakSet;oo=function(i){const{key:e}=i;if(!this.keysUsed.includes(e)){this.removeEventListener("keyup",gi(this,Nn,oo));return}this.handleClick(i)};Xh=new WeakSet;bb=function(i){const{metaKey:e,altKey:t,key:s}=i;if(e||t||!this.keysUsed.includes(s)){this.removeEventListener("keyup",gi(this,Nn,oo));return}this.addEventListener("keyup",gi(this,Nn,oo),{once:!0})};Ql=new WeakSet;Zh=function(){var i;const e=(i=Wi(this,Na))==null?void 0:i.radioGroupItems;if(!e)return;let t=e.filter(s=>s.getAttribute("aria-checked")==="true").pop();t||(t=e[0]);for(const s of e)s.setAttribute("aria-checked","false");t?.setAttribute("aria-checked","true")};Vs.shadowRootOptions={mode:"open"};Vs.getTemplateHTML=IM;Vs.getSuffixSlotInnerHTML=LM;function Zn(i){return i.type==="radio"||i.type==="checkbox"}function Jh(i,e){if(!i)return null;const{host:t}=i.getRootNode();return!e&&t?Jh(i,t):e?.items?e:Jh(e,e?.parentNode)}k.customElements.get("media-chrome-menu-item")||k.customElements.define("media-chrome-menu-item",Vs);function RM(i){return`
    ${ri.getTemplateHTML(i)}
    <style>
      :host {
        --_menu-bg: rgb(20 20 30 / .8);
        background: var(--media-settings-menu-background,
            var(--media-menu-background,
              var(--media-control-background,
                var(--media-secondary-color, var(--_menu-bg)))));
        min-width: var(--media-settings-menu-min-width, 170px);
        border-radius: 2px 2px 0 0;
        overflow: hidden;
      }

      @-moz-document url-prefix() {
        :host{
          --_menu-bg: rgb(20 20 30);
        }
      }

      :host([role="menu"]) {
        
        justify-content: end;
      }

      slot:not([name]) {
        justify-content: var(--media-settings-menu-justify-content);
        flex-direction: var(--media-settings-menu-flex-direction, column);
        overflow: visible;
      }

      #container.has-expanded {
        --media-settings-menu-item-opacity: 0;
      }
    </style>
  `}class _b extends ri{get anchorElement(){return this.anchor!=="auto"?super.anchorElement:Ct(this).querySelector("media-settings-menu-button")}}_b.getTemplateHTML=RM;k.customElements.get("media-settings-menu")||k.customElements.define("media-settings-menu",_b);function xM(i){return`
    ${Vs.getTemplateHTML.call(this,i)}
    <style>
      slot:not([name="submenu"]) {
        opacity: var(--media-settings-menu-item-opacity, var(--media-menu-item-opacity));
      }

      :host([aria-expanded="true"]:hover) {
        background: transparent;
      }
    </style>
  `}function kM(i){return`
    <svg aria-hidden="true" viewBox="0 0 20 24">
      <path d="m8.12 17.585-.742-.669 4.2-4.665-4.2-4.666.743-.669 4.803 5.335-4.803 5.334Z"/>
    </svg>
  `}class Au extends Vs{}Au.shadowRootOptions={mode:"open"};Au.getTemplateHTML=xM;Au.getSuffixSlotInnerHTML=kM;k.customElements.get("media-settings-menu-item")||k.customElements.define("media-settings-menu-item",Au);class Hn extends yt{connectedCallback(){super.connectedCallback(),this.invokeTargetElement&&this.setAttribute("aria-haspopup","menu")}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget",`${e}`)}get invokeTargetElement(){var e;return this.invokeTarget?(e=uu(this))==null?void 0:e.querySelector(`#${this.invokeTarget}`):null}handleClick(){var e;(e=this.invokeTargetElement)==null||e.dispatchEvent(new Um({relatedTarget:this}))}}k.customElements.get("media-chrome-menu-button")||k.customElements.define("media-chrome-menu-button",Hn);function DM(){return`
    <style>
      :host([aria-expanded="true"]) slot[name=tooltip] {
        display: none;
      }
    </style>
    <slot name="icon">
      <svg aria-hidden="true" viewBox="0 0 24 24">
        <path d="M4.5 14.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
      </svg>
    </slot>
  `}function CM(){return J("Settings")}class qm extends Hn{static get observedAttributes(){return[...super.observedAttributes,"target"]}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",J("settings"))}get invokeTargetElement(){return this.invokeTarget!=null?super.invokeTargetElement:Ct(this).querySelector("media-settings-menu")}}qm.getSlotTemplateHTML=DM;qm.getTooltipContentHTML=CM;k.customElements.get("media-settings-menu-button")||k.customElements.define("media-settings-menu-button",qm);var Ym=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ab=(i,e,t)=>(Ym(i,e,"read from private field"),t?t.call(i):e.get(i)),Yo=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},ef=(i,e,t,s)=>(Ym(i,e,"write to private field"),e.set(i,t),t),jo=(i,e,t)=>(Ym(i,e,"access private method"),t),ya,Qd,Xl,tf,Zl,sf;class wM extends ri{constructor(){super(...arguments),Yo(this,Xl),Yo(this,Zl),Yo(this,ya,[]),Yo(this,Qd,void 0)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_AUDIO_TRACK_LIST,_.MEDIA_AUDIO_TRACK_ENABLED,_.MEDIA_AUDIO_TRACK_UNAVAILABLE]}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_AUDIO_TRACK_ENABLED&&t!==s?this.value=s:e===_.MEDIA_AUDIO_TRACK_LIST&&t!==s&&(ef(this,ya,_D(s??"")),jo(this,Xl,tf).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",jo(this,Zl,sf))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",jo(this,Zl,sf))}get anchorElement(){var e;return this.anchor!=="auto"?super.anchorElement:(e=Ct(this))==null?void 0:e.querySelector("media-audio-track-menu-button")}get mediaAudioTrackList(){return Ab(this,ya)}set mediaAudioTrackList(e){ef(this,ya,e),jo(this,Xl,tf).call(this)}get mediaAudioTrackEnabled(){var e;return(e=Ne(this,_.MEDIA_AUDIO_TRACK_ENABLED))!=null?e:""}set mediaAudioTrackEnabled(e){Ue(this,_.MEDIA_AUDIO_TRACK_ENABLED,e)}}ya=new WeakMap;Qd=new WeakMap;Xl=new WeakSet;tf=function(){if(Ab(this,Qd)===JSON.stringify(this.mediaAudioTrackList))return;ef(this,Qd,JSON.stringify(this.mediaAudioTrackList));const i=this.mediaAudioTrackList;this.defaultSlot.textContent="",i.sort((e,t)=>e.id.localeCompare(t.id,void 0,{numeric:!0}));for(const e of i){const t=this.formatMenuItemText(e.label,e),s=On({type:"radio",text:t,value:`${e.id}`,checked:e.enabled});s.prepend(Ar(this,"checked-indicator")),this.defaultSlot.append(s)}};Zl=new WeakSet;sf=function(){if(this.value==null)return;const i=new k.CustomEvent(X.MEDIA_AUDIO_TRACK_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(i)};k.customElements.get("media-audio-track-menu")||k.customElements.define("media-audio-track-menu",wM);const MM=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M11 17H9.5V7H11v10Zm-3-3H6.5v-4H8v4Zm6-5h-1.5v6H14V9Zm3 7h-1.5V8H17v8Z"/>
  <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"/>
</svg>`;function PM(){return`
    <style>
      :host([aria-expanded="true"]) slot[name=tooltip] {
        display: none;
      }
    </style>
    <slot name="icon">${MM}</slot>
  `}function OM(){return J("Audio")}const N0=i=>{const e=J("Audio");i.setAttribute("aria-label",e)};class jm extends Hn{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_AUDIO_TRACK_ENABLED,_.MEDIA_AUDIO_TRACK_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),N0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_LANG&&N0(this)}get invokeTargetElement(){var e;return this.invokeTarget!=null?super.invokeTargetElement:(e=Ct(this))==null?void 0:e.querySelector("media-audio-track-menu")}get mediaAudioTrackEnabled(){var e;return(e=Ne(this,_.MEDIA_AUDIO_TRACK_ENABLED))!=null?e:""}set mediaAudioTrackEnabled(e){Ue(this,_.MEDIA_AUDIO_TRACK_ENABLED,e)}}jm.getSlotTemplateHTML=PM;jm.getTooltipContentHTML=OM;k.customElements.get("media-audio-track-menu-button")||k.customElements.define("media-audio-track-menu-button",jm);var zm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},NM=(i,e,t)=>(zm(i,e,"read from private field"),e.get(i)),vc=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},UM=(i,e,t,s)=>(zm(i,e,"write to private field"),e.set(i,t),t),Ec=(i,e,t)=>(zm(i,e,"access private method"),t),Xd,rf,Sb,Jl,nf;const $M=`
  <svg aria-hidden="true" viewBox="0 0 26 24" part="captions-indicator indicator">
    <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
  </svg>`;function FM(i){return`
    ${ri.getTemplateHTML(i)}
    <slot name="captions-indicator" hidden>${$M}</slot>
  `}class Ib extends ri{constructor(){super(...arguments),vc(this,rf),vc(this,Jl),vc(this,Xd,void 0)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_SUBTITLES_LIST,_.MEDIA_SUBTITLES_SHOWING]}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_SUBTITLES_LIST&&t!==s?Ec(this,rf,Sb).call(this):e===_.MEDIA_SUBTITLES_SHOWING&&t!==s&&(this.value=s)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",Ec(this,Jl,nf))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",Ec(this,Jl,nf))}get anchorElement(){return this.anchor!=="auto"?super.anchorElement:Ct(this).querySelector("media-captions-menu-button")}get mediaSubtitlesList(){return U0(this,_.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){$0(this,_.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return U0(this,_.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){$0(this,_.MEDIA_SUBTITLES_SHOWING,e)}}Xd=new WeakMap;rf=new WeakSet;Sb=function(){var i;if(NM(this,Xd)===JSON.stringify(this.mediaSubtitlesList))return;UM(this,Xd,JSON.stringify(this.mediaSubtitlesList)),this.defaultSlot.textContent="";const e=!this.value,t=On({type:"radio",text:this.formatMenuItemText(J("Off")),value:"off",checked:e});t.prepend(Ar(this,"checked-indicator")),this.defaultSlot.append(t);const s=this.mediaSubtitlesList;for(const r of s){const n=On({type:"radio",text:this.formatMenuItemText(r.label,r),value:mh(r),checked:this.value==mh(r)});n.prepend(Ar(this,"checked-indicator")),((i=r.kind)!=null?i:"subs")==="captions"&&n.append(Ar(this,"captions-indicator")),this.defaultSlot.append(n)}};Jl=new WeakSet;nf=function(){const i=this.mediaSubtitlesShowing,e=this.getAttribute(_.MEDIA_SUBTITLES_SHOWING),t=this.value!==e;if(i?.length&&t&&this.dispatchEvent(new k.CustomEvent(X.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:i})),!this.value||!t)return;const s=new k.CustomEvent(X.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(s)};Ib.getTemplateHTML=FM;const U0=(i,e)=>{const t=i.getAttribute(e);return t?pu(t):[]},$0=(i,e,t)=>{if(!t?.length){i.removeAttribute(e);return}const s=Za(t);i.getAttribute(e)!==s&&i.setAttribute(e,s)};k.customElements.get("media-captions-menu")||k.customElements.define("media-captions-menu",Ib);const BM=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,HM=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`;function GM(){return`
    <style>
      :host([data-captions-enabled="true"]) slot[name=off] {
        display: none !important;
      }

      
      :host(:not([data-captions-enabled="true"])) slot[name=on] {
        display: none !important;
      }

      :host([aria-expanded="true"]) slot[name=tooltip] {
        display: none;
      }
    </style>

    <slot name="icon">
      <slot name="on">${BM}</slot>
      <slot name="off">${HM}</slot>
    </slot>
  `}function KM(){return J("Captions")}const F0=i=>{i.setAttribute("data-captions-enabled",uT(i).toString())},B0=i=>{i.setAttribute("aria-label",J("closed captions"))};class Qm extends Hn{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_SUBTITLES_LIST,_.MEDIA_SUBTITLES_SHOWING,_.MEDIA_LANG]}connectedCallback(){super.connectedCallback(),B0(this),F0(this)}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_SUBTITLES_SHOWING?F0(this):e===_.MEDIA_LANG&&B0(this)}get invokeTargetElement(){var e;return this.invokeTarget!=null?super.invokeTargetElement:(e=Ct(this))==null?void 0:e.querySelector("media-captions-menu")}get mediaSubtitlesList(){return H0(this,_.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){G0(this,_.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return H0(this,_.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){G0(this,_.MEDIA_SUBTITLES_SHOWING,e)}}Qm.getSlotTemplateHTML=GM;Qm.getTooltipContentHTML=KM;const H0=(i,e)=>{const t=i.getAttribute(e);return t?pu(t):[]},G0=(i,e,t)=>{if(!t?.length){i.removeAttribute(e);return}const s=Za(t);i.getAttribute(e)!==s&&i.setAttribute(e,s)};k.customElements.get("media-captions-menu-button")||k.customElements.define("media-captions-menu-button",Qm);var Lb=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},an=(i,e,t)=>(Lb(i,e,"read from private field"),t?t.call(i):e.get(i)),yc=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Jn=(i,e,t)=>(Lb(i,e,"access private method"),t),Ms,Ta,ed,td,af;const Tc={RATES:"rates"};class VM extends ri{constructor(){super(),yc(this,Ta),yc(this,td),yc(this,Ms,new am(this,Tc.RATES,{defaultValue:HT})),Jn(this,Ta,ed).call(this)}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PLAYBACK_RATE,Tc.RATES]}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_PLAYBACK_RATE&&t!=s?this.value=s:e===Tc.RATES&&t!=s&&(an(this,Ms).value=s,Jn(this,Ta,ed).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",Jn(this,td,af))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",Jn(this,td,af))}get anchorElement(){return this.anchor!=="auto"?super.anchorElement:Ct(this).querySelector("media-playback-rate-menu-button")}get rates(){return an(this,Ms)}set rates(e){e?Array.isArray(e)?an(this,Ms).value=e.join(" "):typeof e=="string"&&(an(this,Ms).value=e):an(this,Ms).value="",Jn(this,Ta,ed).call(this)}get mediaPlaybackRate(){return Oe(this,_.MEDIA_PLAYBACK_RATE,fn)}set mediaPlaybackRate(e){qe(this,_.MEDIA_PLAYBACK_RATE,e)}}Ms=new WeakMap;Ta=new WeakSet;ed=function(){this.defaultSlot.textContent="";for(const i of an(this,Ms)){const e=On({type:"radio",text:this.formatMenuItemText(`${i}x`,i),value:i,checked:this.mediaPlaybackRate===Number(i)});e.prepend(Ar(this,"checked-indicator")),this.defaultSlot.append(e)}};td=new WeakSet;af=function(){if(!this.value)return;const i=new k.CustomEvent(X.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(i)};k.customElements.get("media-playback-rate-menu")||k.customElements.define("media-playback-rate-menu",VM);const id=1;function WM(i){return`
    <style>
      :host {
        min-width: 5ch;
        padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));
      }
      
      :host([aria-expanded="true"]) slot[name=tooltip] {
        display: none;
      }
    </style>
    <slot name="icon">${i.mediaplaybackrate||id}x</slot>
  `}function qM(){return J("Playback rate")}class Xm extends Hn{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_PLAYBACK_RATE]}constructor(){var e;super(),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML=`${(e=this.mediaPlaybackRate)!=null?e:id}x`}attributeChangedCallback(e,t,s){if(super.attributeChangedCallback(e,t,s),e===_.MEDIA_PLAYBACK_RATE){const r=s?+s:Number.NaN,n=Number.isNaN(r)?id:r;this.container.innerHTML=`${n}x`,this.setAttribute("aria-label",J("Playback rate {playbackRate}",{playbackRate:n}))}}get invokeTargetElement(){return this.invokeTarget!=null?super.invokeTargetElement:Ct(this).querySelector("media-playback-rate-menu")}get mediaPlaybackRate(){return Oe(this,_.MEDIA_PLAYBACK_RATE,id)}set mediaPlaybackRate(e){qe(this,_.MEDIA_PLAYBACK_RATE,e)}}Xm.getSlotTemplateHTML=WM;Xm.getTooltipContentHTML=qM;k.customElements.get("media-playback-rate-menu-button")||k.customElements.define("media-playback-rate-menu-button",Xm);var Zm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ba=(i,e,t)=>(Zm(i,e,"read from private field"),t?t.call(i):e.get(i)),zo=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},K0=(i,e,t,s)=>(Zm(i,e,"write to private field"),e.set(i,t),t),Br=(i,e,t)=>(Zm(i,e,"access private method"),t),_a,mn,on,Aa,sd,of;class YM extends ri{constructor(){super(...arguments),zo(this,on),zo(this,sd),zo(this,_a,[]),zo(this,mn,{})}static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_RENDITION_LIST,_.MEDIA_RENDITION_SELECTED,_.MEDIA_RENDITION_UNAVAILABLE,_.MEDIA_HEIGHT]}static formatMenuItemText(e,t){return super.formatMenuItemText(e,t)}static formatRendition(e,{showBitrate:t=!1}={}){const s=`${Math.min(e.width,e.height)}p`;if(t&&e.bitrate){const r=e.bitrate/1e6,n=`${r.toFixed(r<1?1:0)} Mbps`;return`${s} (${n})`}return this.formatMenuItemText(s,e)}static compareRendition(e,t){var s,r;return t.height===e.height?((s=t.bitrate)!=null?s:0)-((r=e.bitrate)!=null?r:0):t.height-e.height}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e===_.MEDIA_RENDITION_SELECTED&&t!==s?(this.value=s??"auto",Br(this,on,Aa).call(this)):e===_.MEDIA_RENDITION_LIST&&t!==s?(K0(this,_a,ED(s)),Br(this,on,Aa).call(this)):e===_.MEDIA_HEIGHT&&t!==s&&Br(this,on,Aa).call(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",Br(this,sd,of))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",Br(this,sd,of))}get anchorElement(){return this.anchor!=="auto"?super.anchorElement:Ct(this).querySelector("media-rendition-menu-button")}get mediaRenditionList(){return ba(this,_a)}set mediaRenditionList(e){K0(this,_a,e),Br(this,on,Aa).call(this)}get mediaRenditionSelected(){return Ne(this,_.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){Ue(this,_.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return Oe(this,_.MEDIA_HEIGHT)}set mediaHeight(e){qe(this,_.MEDIA_HEIGHT,e)}compareRendition(e,t){return this.constructor.compareRendition(e,t)}formatMenuItemText(e,t){return this.constructor.formatMenuItemText(e,t)}formatRendition(e,t){return this.constructor.formatRendition(e,t)}showRenditionBitrate(e){return this.mediaRenditionList.some(t=>t!==e&&t.height===e.height&&t.bitrate!==e.bitrate)}}_a=new WeakMap;mn=new WeakMap;on=new WeakSet;Aa=function(){if(ba(this,mn).mediaRenditionList===JSON.stringify(this.mediaRenditionList)&&ba(this,mn).mediaHeight===this.mediaHeight)return;ba(this,mn).mediaRenditionList=JSON.stringify(this.mediaRenditionList),ba(this,mn).mediaHeight=this.mediaHeight;const i=this.mediaRenditionList.sort(this.compareRendition.bind(this)),e=i.find(a=>a.id===this.mediaRenditionSelected);for(const a of i)a.selected=a===e;this.defaultSlot.textContent="";const t=!this.mediaRenditionSelected;for(const a of i){const o=this.formatRendition(a,{showBitrate:this.showRenditionBitrate(a)}),l=On({type:"radio",text:o,value:`${a.id}`,checked:a.selected&&!t});l.prepend(Ar(this,"checked-indicator")),this.defaultSlot.append(l)}const s=e&&this.showRenditionBitrate(e),r=t?e?this.formatMenuItemText(`${J("Auto")} • ${this.formatRendition(e,{showBitrate:s})}`,e):this.formatMenuItemText(`${J("Auto")} (${this.mediaHeight}p)`):this.formatMenuItemText(J("Auto")),n=On({type:"radio",text:r,value:"auto",checked:t});n.dataset.description=r,n.prepend(Ar(this,"checked-indicator")),this.defaultSlot.append(n)};sd=new WeakSet;of=function(){if(this.value==null)return;const i=new k.CustomEvent(X.MEDIA_RENDITION_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(i)};k.customElements.get("media-rendition-menu")||k.customElements.define("media-rendition-menu",YM);const jM=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M13.5 2.5h2v6h-2v-2h-11v-2h11v-2Zm4 2h4v2h-4v-2Zm-12 4h2v6h-2v-2h-3v-2h3v-2Zm4 2h12v2h-12v-2Zm1 4h2v6h-2v-2h-8v-2h8v-2Zm4 2h7v2h-7v-2Z" />
</svg>`;function zM(){return`
    <style>
      :host([aria-expanded="true"]) slot[name=tooltip] {
        display: none;
      }
    </style>
    <slot name="icon">${jM}</slot>
  `}function QM(){return J("Quality")}class Jm extends Hn{static get observedAttributes(){return[...super.observedAttributes,_.MEDIA_RENDITION_SELECTED,_.MEDIA_RENDITION_UNAVAILABLE,_.MEDIA_HEIGHT]}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",J("quality"))}get invokeTargetElement(){return this.invokeTarget!=null?super.invokeTargetElement:Ct(this).querySelector("media-rendition-menu")}get mediaRenditionSelected(){return Ne(this,_.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){Ue(this,_.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return Oe(this,_.MEDIA_HEIGHT)}set mediaHeight(e){qe(this,_.MEDIA_HEIGHT,e)}}Jm.getSlotTemplateHTML=zM;Jm.getTooltipContentHTML=QM;k.customElements.get("media-rendition-menu-button")||k.customElements.define("media-rendition-menu-button",Jm);var ep=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},$i=(i,e,t)=>(ep(i,e,"read from private field"),t?t.call(i):e.get(i)),Ii=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Rb=(i,e,t,s)=>(ep(i,e,"write to private field"),e.set(i,t),t),Zt=(i,e,t)=>(ep(i,e,"access private method"),t),Un,lo,Su,dr,pn,tp,xb,rd,lf,nd,df,kb,Zd,Jd,ad;function XM(i){return`
      ${ri.getTemplateHTML(i)}
      <style>
        :host {
          --_menu-bg: rgb(20 20 30 / .8);
          background: var(--media-settings-menu-background,
            var(--media-menu-background,
              var(--media-control-background,
                var(--media-secondary-color, var(--_menu-bg)))));
          min-width: var(--media-settings-menu-min-width, 170px);
          border-radius: 2px;
          overflow: hidden;
        }
      </style>
    `}class Db extends ri{constructor(){super(),Ii(this,lo),Ii(this,dr),Ii(this,tp),Ii(this,rd),Ii(this,df),Ii(this,Un,!1),Ii(this,nd,e=>{const t=e.target,s=t?.nodeName==="VIDEO",r=Zt(this,rd,lf).call(this,t);(s||r)&&($i(this,Un)?Zt(this,dr,pn).call(this):Zt(this,df,kb).call(this,e))}),Ii(this,Zd,e=>{const t=e.target,s=this.contains(t),r=e.button===2,n=t?.nodeName==="VIDEO",a=Zt(this,rd,lf).call(this,t);s||r&&(n||a)||Zt(this,dr,pn).call(this)}),Ii(this,Jd,e=>{e.key==="Escape"&&Zt(this,dr,pn).call(this)}),Ii(this,ad,e=>{var t,s;const r=e.target;if((t=r.matches)!=null&&t.call(r,'button[invoke="copy"]')){const n=(s=r.closest("media-context-menu-item"))==null?void 0:s.querySelector('input[slot="copy"]');n&&navigator.clipboard.writeText(n.value)}Zt(this,dr,pn).call(this)}),this.setAttribute("noautohide",""),Zt(this,lo,Su).call(this)}connectedCallback(){super.connectedCallback(),Ct(this).addEventListener("contextmenu",$i(this,nd)),this.addEventListener("click",$i(this,ad))}disconnectedCallback(){super.disconnectedCallback(),Ct(this).removeEventListener("contextmenu",$i(this,nd)),this.removeEventListener("click",$i(this,ad)),document.removeEventListener("mousedown",$i(this,Zd)),document.removeEventListener("keydown",$i(this,Jd))}}Un=new WeakMap;lo=new WeakSet;Su=function(){this.hidden=!$i(this,Un)};dr=new WeakSet;pn=function(){Rb(this,Un,!1),Zt(this,lo,Su).call(this)};tp=new WeakSet;xb=function(){document.querySelectorAll("media-context-menu").forEach(e=>{var t;e!==this&&Zt(t=e,dr,pn).call(t)})};rd=new WeakSet;lf=function(i){return i?i.hasAttribute("slot")&&i.getAttribute("slot")==="media"?!0:i.nodeName.includes("-")&&i.tagName.includes("-")?i.hasAttribute("src")||i.hasAttribute("poster")||i.hasAttribute("preload")||i.hasAttribute("playsinline"):!1:!1};nd=new WeakMap;df=new WeakSet;kb=function(i){i.preventDefault(),Zt(this,tp,xb).call(this),Rb(this,Un,!0),this.style.position="fixed",this.style.left=`${i.clientX}px`,this.style.top=`${i.clientY}px`,Zt(this,lo,Su).call(this),document.addEventListener("mousedown",$i(this,Zd),{once:!0}),document.addEventListener("keydown",$i(this,Jd),{once:!0})};Zd=new WeakMap;Jd=new WeakMap;ad=new WeakMap;Db.getTemplateHTML=XM;k.customElements.get("media-context-menu")||k.customElements.define("media-context-menu",Db);function ZM(i){return`
    ${Vs.getTemplateHTML.call(this,i)}
    <style>
        ::slotted(*) {
            color: var(--media-text-color, white);
            text-decoration: none;
            border: none;
            background: none;
            cursor: pointer;
            padding: 0;
            min-height: var(--media-control-height, 24px);
        }
    </style>
  `}class ip extends Vs{}ip.shadowRootOptions={mode:"open"};ip.getTemplateHTML=ZM;k.customElements.get("media-context-menu-item")||k.customElements.define("media-context-menu-item",ip);var Cb=i=>{throw TypeError(i)},sp=(i,e,t)=>e.has(i)||Cb("Cannot "+t),Ie=(i,e,t)=>(sp(i,e,"read from private field"),t?t.call(i):e.get(i)),mi=(i,e,t)=>e.has(i)?Cb("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),ji=(i,e,t,s)=>(sp(i,e,"write to private field"),e.set(i,t),t),Je=(i,e,t)=>(sp(i,e,"access private method"),t),Iu=class{addEventListener(){}removeEventListener(){}dispatchEvent(i){return!0}};if(typeof DocumentFragment>"u"){class i extends Iu{}globalThis.DocumentFragment=i}var rp=class extends Iu{},JM=class extends Iu{},eP={get(i){},define(i,e,t){},getName(i){return null},upgrade(i){},whenDefined(i){return Promise.resolve(rp)}},od,tP=class{constructor(e,t={}){mi(this,od),ji(this,od,t?.detail)}get detail(){return Ie(this,od)}initCustomEvent(){}};od=new WeakMap;function iP(i,e){return new rp}var wb={document:{createElement:iP},DocumentFragment,customElements:eP,CustomEvent:tP,EventTarget:Iu,HTMLElement:rp,HTMLVideoElement:JM},Mb=typeof window>"u"||typeof globalThis.customElements>"u",Hi=Mb?wb:globalThis,eu=Mb?wb.document:globalThis.document;function sP(i){let e="";return Object.entries(i).forEach(([t,s])=>{s!=null&&(e+=`${uf(t)}: ${s}; `)}),e?e.trim():void 0}function uf(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Pb(i){return i.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase())}function Ht(i){if(i==null)return;let e=+i;return Number.isNaN(e)?void 0:e}function Ob(i){let e=rP(i).toString();return e?"?"+e:""}function rP(i){let e={};for(let t in i)i[t]!=null&&(e[t]=i[t]);return new URLSearchParams(e)}var Nb=(i,e)=>!i||!e?!1:i.contains(e)?!0:Nb(i,e.getRootNode().host),Ub="mux.com",nP=()=>{try{return"3.8.0"}catch{}return"UNKNOWN"},aP=nP(),$b=()=>aP,oP=(i,{token:e,customDomain:t=Ub,thumbnailTime:s,programTime:r}={})=>{var n;let a=e==null?s:void 0,{aud:o}=(n=Tn(e))!=null?n:{};if(!(e&&o!=="t"))return`https://image.${t}/${i}/thumbnail.webp${Ob({token:e,time:a,program_time:r})}`},lP=(i,{token:e,customDomain:t=Ub,programStartTime:s,programEndTime:r}={})=>{var n;let{aud:a}=(n=Tn(e))!=null?n:{};if(!(e&&a!=="s"))return`https://image.${t}/${i}/storyboard.vtt${Ob({token:e,format:"webp",program_start_time:s,program_end_time:r})}`},np=i=>{if(i){if([Se.LIVE,Se.ON_DEMAND].includes(i))return i;if(i!=null&&i.includes("live"))return Se.LIVE}},dP={crossorigin:"crossOrigin",playsinline:"playsInline"};function uP(i){var e;return(e=dP[i])!=null?e:Pb(i)}var ln,dn,kt,cP=class{constructor(e,t){mi(this,ln),mi(this,dn),mi(this,kt,[]),ji(this,ln,e),ji(this,dn,t)}[Symbol.iterator](){return Ie(this,kt).values()}get length(){return Ie(this,kt).length}get value(){var e;return(e=Ie(this,kt).join(" "))!=null?e:""}set value(e){var t;e!==this.value&&(ji(this,kt,[]),this.add(...(t=e?.split(" "))!=null?t:[]))}toString(){return this.value}item(e){return Ie(this,kt)[e]}values(){return Ie(this,kt).values()}keys(){return Ie(this,kt).keys()}forEach(e){Ie(this,kt).forEach(e)}add(...e){var t,s;e.forEach(r=>{this.contains(r)||Ie(this,kt).push(r)}),!(this.value===""&&!((t=Ie(this,ln))!=null&&t.hasAttribute(`${Ie(this,dn)}`)))&&((s=Ie(this,ln))==null||s.setAttribute(`${Ie(this,dn)}`,`${this.value}`))}remove(...e){var t;e.forEach(s=>{Ie(this,kt).splice(Ie(this,kt).indexOf(s),1)}),(t=Ie(this,ln))==null||t.setAttribute(`${Ie(this,dn)}`,`${this.value}`)}contains(e){return Ie(this,kt).includes(e)}toggle(e,t){return typeof t<"u"?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){this.remove(e),this.add(t)}};ln=new WeakMap,dn=new WeakMap,kt=new WeakMap;var Fb=`[mux-player ${$b()}]`;function ls(...i){console.warn(Fb,...i)}function Jt(...i){console.error(Fb,...i)}function Bb(i){var e;let t=(e=i.message)!=null?e:"";i.context&&(t+=` ${i.context}`),i.file&&(t+=` ${ie("Read more: ")}
https://github.com/muxinc/elements/blob/main/errors/${i.file}`),ls(t)}var bt={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},nr={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},V0=Object.freeze({length:0,start(i){let e=i>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(i){let e=i>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0}}),hP=Object.values(bt).filter(i=>bt.PLAYSINLINE!==i),fP=Object.values(nr),mP=[...hP,...fP],pP=class extends Hi.HTMLElement{static get observedAttributes(){return mP}constructor(){super()}attributeChangedCallback(i,e,t){var s,r;switch(i){case nr.MUTED:{this.media&&(this.media.muted=t!=null,this.media.defaultMuted=t!=null);return}case nr.VOLUME:{let n=(s=Ht(t))!=null?s:1;this.media&&(this.media.volume=n);return}case nr.PLAYBACKRATE:{let n=(r=Ht(t))!=null?r:1;this.media&&(this.media.playbackRate=n,this.media.defaultPlaybackRate=n);return}}}play(){var i,e;return(e=(i=this.media)==null?void 0:i.play())!=null?e:Promise.reject()}pause(){var i;(i=this.media)==null||i.pause()}load(){var i;(i=this.media)==null||i.load()}get media(){var i;return(i=this.shadowRoot)==null?void 0:i.querySelector("mux-video")}get audioTracks(){return this.media.audioTracks}get videoTracks(){return this.media.videoTracks}get audioRenditions(){return this.media.audioRenditions}get videoRenditions(){return this.media.videoRenditions}get paused(){var i,e;return(e=(i=this.media)==null?void 0:i.paused)!=null?e:!0}get duration(){var i,e;return(e=(i=this.media)==null?void 0:i.duration)!=null?e:NaN}get ended(){var i,e;return(e=(i=this.media)==null?void 0:i.ended)!=null?e:!1}get buffered(){var i,e;return(e=(i=this.media)==null?void 0:i.buffered)!=null?e:V0}get seekable(){var i,e;return(e=(i=this.media)==null?void 0:i.seekable)!=null?e:V0}get readyState(){var i,e;return(e=(i=this.media)==null?void 0:i.readyState)!=null?e:0}get videoWidth(){var i,e;return(e=(i=this.media)==null?void 0:i.videoWidth)!=null?e:0}get videoHeight(){var i,e;return(e=(i=this.media)==null?void 0:i.videoHeight)!=null?e:0}get currentSrc(){var i,e;return(e=(i=this.media)==null?void 0:i.currentSrc)!=null?e:""}get currentTime(){var i,e;return(e=(i=this.media)==null?void 0:i.currentTime)!=null?e:0}set currentTime(i){this.media&&(this.media.currentTime=Number(i))}get volume(){var i,e;return(e=(i=this.media)==null?void 0:i.volume)!=null?e:1}set volume(i){this.media&&(this.media.volume=Number(i))}get playbackRate(){var i,e;return(e=(i=this.media)==null?void 0:i.playbackRate)!=null?e:1}set playbackRate(i){this.media&&(this.media.playbackRate=Number(i))}get defaultPlaybackRate(){var i;return(i=Ht(this.getAttribute(nr.PLAYBACKRATE)))!=null?i:1}set defaultPlaybackRate(i){i!=null?this.setAttribute(nr.PLAYBACKRATE,`${i}`):this.removeAttribute(nr.PLAYBACKRATE)}get crossOrigin(){return ea(this,bt.CROSSORIGIN)}set crossOrigin(i){this.setAttribute(bt.CROSSORIGIN,`${i}`)}get autoplay(){return ea(this,bt.AUTOPLAY)!=null}set autoplay(i){i?this.setAttribute(bt.AUTOPLAY,typeof i=="string"?i:""):this.removeAttribute(bt.AUTOPLAY)}get loop(){return ea(this,bt.LOOP)!=null}set loop(i){i?this.setAttribute(bt.LOOP,""):this.removeAttribute(bt.LOOP)}get muted(){var i,e;return(e=(i=this.media)==null?void 0:i.muted)!=null?e:!1}set muted(i){this.media&&(this.media.muted=!!i)}get defaultMuted(){return ea(this,bt.MUTED)!=null}set defaultMuted(i){i?this.setAttribute(bt.MUTED,""):this.removeAttribute(bt.MUTED)}get playsInline(){return ea(this,bt.PLAYSINLINE)!=null}set playsInline(i){Jt("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(i){["","none","metadata","auto"].includes(i)?this.setAttribute(bt.PRELOAD,i):this.removeAttribute(bt.PRELOAD)}};function ea(i,e){return i.media?i.media.getAttribute(e):i.getAttribute(e)}var W0=pP,gP=`:host {
  --media-control-display: var(--controls);
  --media-loading-indicator-display: var(--loading-indicator);
  --media-dialog-display: var(--dialog);
  --media-play-button-display: var(--play-button);
  --media-live-button-display: var(--live-button);
  --media-seek-backward-button-display: var(--seek-backward-button);
  --media-seek-forward-button-display: var(--seek-forward-button);
  --media-mute-button-display: var(--mute-button);
  --media-captions-button-display: var(--captions-button);
  --media-captions-menu-button-display: var(--captions-menu-button, var(--media-captions-button-display));
  --media-rendition-menu-button-display: var(--rendition-menu-button);
  --media-audio-track-menu-button-display: var(--audio-track-menu-button);
  --media-airplay-button-display: var(--airplay-button);
  --media-pip-button-display: var(--pip-button);
  --media-fullscreen-button-display: var(--fullscreen-button);
  --media-cast-button-display: var(--cast-button, var(--_cast-button-drm-display));
  --media-playback-rate-button-display: var(--playback-rate-button);
  --media-playback-rate-menu-button-display: var(--playback-rate-menu-button);
  --media-volume-range-display: var(--volume-range);
  --media-time-range-display: var(--time-range);
  --media-time-display-display: var(--time-display);
  --media-duration-display-display: var(--duration-display);
  --media-title-display-display: var(--title-display);

  display: inline-block;
  line-height: 0;
  width: 100%;
}

a {
  color: #fff;
  font-size: 0.9em;
  text-decoration: underline;
}

media-theme {
  display: inline-block;
  line-height: 0;
  width: 100%;
  height: 100%;
  direction: ltr;
}

media-poster-image {
  display: inline-block;
  line-height: 0;
  width: 100%;
  height: 100%;
}

media-poster-image:not([src]):not([placeholdersrc]) {
  display: none;
}

::part(top),
[part~='top'] {
  --media-control-display: var(--controls, var(--top-controls));
  --media-play-button-display: var(--play-button, var(--top-play-button));
  --media-live-button-display: var(--live-button, var(--top-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--top-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--top-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--top-mute-button));
  --media-captions-button-display: var(--captions-button, var(--top-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--top-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--top-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--top-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--top-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--top-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--top-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--top-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--top-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --captions-menu-button,
    var(--media-playback-rate-button-display, var(--top-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--top-volume-range));
  --media-time-range-display: var(--time-range, var(--top-time-range));
  --media-time-display-display: var(--time-display, var(--top-time-display));
  --media-duration-display-display: var(--duration-display, var(--top-duration-display));
  --media-title-display-display: var(--title-display, var(--top-title-display));
}

::part(center),
[part~='center'] {
  --media-control-display: var(--controls, var(--center-controls));
  --media-play-button-display: var(--play-button, var(--center-play-button));
  --media-live-button-display: var(--live-button, var(--center-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--center-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--center-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--center-mute-button));
  --media-captions-button-display: var(--captions-button, var(--center-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--center-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--center-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--center-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--center-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--center-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--center-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--center-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--center-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --playback-rate-menu-button,
    var(--media-playback-rate-button-display, var(--center-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--center-volume-range));
  --media-time-range-display: var(--time-range, var(--center-time-range));
  --media-time-display-display: var(--time-display, var(--center-time-display));
  --media-duration-display-display: var(--duration-display, var(--center-duration-display));
}

::part(bottom),
[part~='bottom'] {
  --media-control-display: var(--controls, var(--bottom-controls));
  --media-play-button-display: var(--play-button, var(--bottom-play-button));
  --media-live-button-display: var(--live-button, var(--bottom-live-button));
  --media-seek-backward-button-display: var(--seek-backward-button, var(--bottom-seek-backward-button));
  --media-seek-forward-button-display: var(--seek-forward-button, var(--bottom-seek-forward-button));
  --media-mute-button-display: var(--mute-button, var(--bottom-mute-button));
  --media-captions-button-display: var(--captions-button, var(--bottom-captions-button));
  --media-captions-menu-button-display: var(
    --captions-menu-button,
    var(--media-captions-button-display, var(--bottom-captions-menu-button))
  );
  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--bottom-rendition-menu-button));
  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--bottom-audio-track-menu-button));
  --media-airplay-button-display: var(--airplay-button, var(--bottom-airplay-button));
  --media-pip-button-display: var(--pip-button, var(--bottom-pip-button));
  --media-fullscreen-button-display: var(--fullscreen-button, var(--bottom-fullscreen-button));
  --media-cast-button-display: var(--cast-button, var(--bottom-cast-button, var(--_cast-button-drm-display)));
  --media-playback-rate-button-display: var(--playback-rate-button, var(--bottom-playback-rate-button));
  --media-playback-rate-menu-button-display: var(
    --playback-rate-menu-button,
    var(--media-playback-rate-button-display, var(--bottom-playback-rate-menu-button))
  );
  --media-volume-range-display: var(--volume-range, var(--bottom-volume-range));
  --media-time-range-display: var(--time-range, var(--bottom-time-range));
  --media-time-display-display: var(--time-display, var(--bottom-time-display));
  --media-duration-display-display: var(--duration-display, var(--bottom-duration-display));
  --media-title-display-display: var(--title-display, var(--bottom-title-display));
}

:host([no-tooltips]) {
  --media-tooltip-display: none;
}
`,ta=new WeakMap,vP=class Hb{constructor(e,t){this.element=e,this.type=t,this.element.addEventListener(this.type,this);let s=ta.get(this.element);s&&s.set(this.type,this)}set(e){if(typeof e=="function")this.handleEvent=e.bind(this.element);else if(typeof e=="object"&&typeof e.handleEvent=="function")this.handleEvent=e.handleEvent.bind(e);else{this.element.removeEventListener(this.type,this);let t=ta.get(this.element);t&&t.delete(this.type)}}static for(e){ta.has(e.element)||ta.set(e.element,new Map);let t=e.attributeName.slice(2),s=ta.get(e.element);return s&&s.has(t)?s.get(t):new Hb(e.element,t)}};function EP(i,e){return i instanceof vi&&i.attributeName.startsWith("on")?(vP.for(i).set(e),i.element.removeAttributeNS(i.attributeNamespace,i.attributeName),!0):!1}function yP(i,e){return e instanceof Gb&&i instanceof Bn?(e.renderInto(i),!0):!1}function TP(i,e){return e instanceof DocumentFragment&&i instanceof Bn?(e.childNodes.length&&i.replace(...e.childNodes),!0):!1}function bP(i,e){if(i instanceof vi){let t=i.attributeNamespace,s=i.element.getAttributeNS(t,i.attributeName);return String(e)!==s&&(i.value=String(e)),!0}return i.value=String(e),!0}function _P(i,e){if(i instanceof vi&&e instanceof Element){let t=i.element;return t[i.attributeName]!==e&&(i.element.removeAttributeNS(i.attributeNamespace,i.attributeName),t[i.attributeName]=e),!0}return!1}function AP(i,e){if(typeof e=="boolean"&&i instanceof vi){let t=i.attributeNamespace,s=i.element.hasAttributeNS(t,i.attributeName);return e!==s&&(i.booleanValue=e),!0}return!1}function SP(i,e){return e===!1&&i instanceof Bn?(i.replace(""),!0):!1}function IP(i,e){_P(i,e)||AP(i,e)||EP(i,e)||SP(i,e)||yP(i,e)||TP(i,e)||bP(i,e)}var bc=new Map,q0=new WeakMap,Y0=new WeakMap,Gb=class{constructor(e,t,s){this.strings=e,this.values=t,this.processor=s,this.stringsKey=this.strings.join("")}get template(){if(bc.has(this.stringsKey))return bc.get(this.stringsKey);{let e=eu.createElement("template"),t=this.strings.length-1;return e.innerHTML=this.strings.reduce((s,r,n)=>s+r+(n<t?`{{ ${n} }}`:""),""),bc.set(this.stringsKey,e),e}}renderInto(e){var t;let s=this.template;if(q0.get(e)!==s){q0.set(e,s);let n=new bu(s,this.values,this.processor);Y0.set(e,n),e instanceof Bn?e.replace(...n.children):e.appendChild(n);return}let r=Y0.get(e);(t=r?.update)==null||t.call(r,this.values)}},LP={processCallback(i,e,t){var s;if(t){for(let[r,n]of e)if(r in t){let a=(s=t[r])!=null?s:"";IP(n,a)}}}};function ld(i,...e){return new Gb(i,e,LP)}function RP(i,e){i.renderInto(e)}var xP=i=>{let{tokens:e}=i;return e.drm?":host(:not([cast-receiver])) { --_cast-button-drm-display: none; }":""},kP=i=>ld`
  <style>
    ${xP(i)}
    ${gP}
  </style>
  ${MP(i)}
`,DP=i=>{let e=i.hotKeys?`${i.hotKeys}`:"";return np(i.streamType)==="live"&&(e+=" noarrowleft noarrowright"),e},CP={TOP:"top",CENTER:"center",BOTTOM:"bottom",LAYER:"layer",MEDIA_LAYER:"media-layer",POSTER_LAYER:"poster-layer",VERTICAL_LAYER:"vertical-layer",CENTERED_LAYER:"centered-layer",GESTURE_LAYER:"gesture-layer",CONTROLLER_LAYER:"controller",BUTTON:"button",RANGE:"range",DISPLAY:"display",CONTROL_BAR:"control-bar",MENU_BUTTON:"menu-button",MENU:"menu",OPTION:"option",POSTER:"poster",LIVE:"live",PLAY:"play",PRE_PLAY:"pre-play",SEEK_BACKWARD:"seek-backward",SEEK_FORWARD:"seek-forward",MUTE:"mute",CAPTIONS:"captions",AIRPLAY:"airplay",PIP:"pip",FULLSCREEN:"fullscreen",CAST:"cast",PLAYBACK_RATE:"playback-rate",VOLUME:"volume",TIME:"time",TITLE:"title",AUDIO_TRACK:"audio-track",RENDITION:"rendition"},wP=Object.values(CP).join(", "),MP=i=>{var e,t,s,r,n,a,o,l,d,u,c,h,f,m,g,p,E,T,y,b,A,L,S,R,x,I,M,$,V,q,H,N,W,B,Y,ee,U;return ld`
  <media-theme
    template="${i.themeTemplate||!1}"
    defaultstreamtype="${(e=i.defaultStreamType)!=null?e:!1}"
    hotkeys="${DP(i)||!1}"
    nohotkeys="${i.noHotKeys||!i.hasSrc||!1}"
    noautoseektolive="${!!((t=i.streamType)!=null&&t.includes(Se.LIVE))&&i.targetLiveWindow!==0}"
    novolumepref="${i.novolumepref||!1}"
    nomutedpref="${i.nomutedpref||!1}"
    disabled="${!i.hasSrc||i.isDialogOpen}"
    audio="${(s=i.audio)!=null?s:!1}"
    style="${(r=sP({"--media-primary-color":i.primaryColor,"--media-secondary-color":i.secondaryColor,"--media-accent-color":i.accentColor}))!=null?r:!1}"
    defaultsubtitles="${!i.defaultHiddenCaptions}"
    forwardseekoffset="${(n=i.forwardSeekOffset)!=null?n:!1}"
    backwardseekoffset="${(a=i.backwardSeekOffset)!=null?a:!1}"
    playbackrates="${(o=i.playbackRates)!=null?o:!1}"
    defaultshowremainingtime="${(l=i.defaultShowRemainingTime)!=null?l:!1}"
    defaultduration="${(d=i.defaultDuration)!=null?d:!1}"
    hideduration="${(u=i.hideDuration)!=null?u:!1}"
    title="${(c=i.title)!=null?c:!1}"
    videotitle="${(h=i.videoTitle)!=null?h:!1}"
    proudlydisplaymuxbadge="${(f=i.proudlyDisplayMuxBadge)!=null?f:!1}"
    exportparts="${wP}"
    onclose="${i.onCloseErrorDialog}"
    onfocusin="${i.onFocusInErrorDialog}"
  >
    <mux-video
      slot="media"
      inert="${(m=i.noHotKeys)!=null?m:!1}"
      target-live-window="${(g=i.targetLiveWindow)!=null?g:!1}"
      stream-type="${(p=np(i.streamType))!=null?p:!1}"
      crossorigin="${(E=i.crossOrigin)!=null?E:""}"
      playsinline
      autoplay="${(T=i.autoplay)!=null?T:!1}"
      muted="${(y=i.muted)!=null?y:!1}"
      loop="${(b=i.loop)!=null?b:!1}"
      preload="${(A=i.preload)!=null?A:!1}"
      debug="${(L=i.debug)!=null?L:!1}"
      prefer-cmcd="${(S=i.preferCmcd)!=null?S:!1}"
      disable-tracking="${(R=i.disableTracking)!=null?R:!1}"
      disable-cookies="${(x=i.disableCookies)!=null?x:!1}"
      prefer-playback="${(I=i.preferPlayback)!=null?I:!1}"
      start-time="${i.startTime!=null?i.startTime:!1}"
      beacon-collection-domain="${(M=i.beaconCollectionDomain)!=null?M:!1}"
      player-init-time="${($=i.playerInitTime)!=null?$:!1}"
      player-software-name="${(V=i.playerSoftwareName)!=null?V:!1}"
      player-software-version="${(q=i.playerSoftwareVersion)!=null?q:!1}"
      env-key="${(H=i.envKey)!=null?H:!1}"
      custom-domain="${(N=i.customDomain)!=null?N:!1}"
      src="${i.src?i.src:i.playbackId?Qc(i):!1}"
      cast-src="${i.src?i.src:i.playbackId?Qc(i):!1}"
      cast-receiver="${(W=i.castReceiver)!=null?W:!1}"
      drm-token="${(Y=(B=i.tokens)==null?void 0:B.drm)!=null?Y:!1}"
      exportparts="video"
      disable-pseudo-ended="${(ee=i.disablePseudoEnded)!=null?ee:!1}"
    >
      ${i.storyboard?ld`<track label="thumbnails" default kind="metadata" src="${i.storyboard}" />`:ld``}
      <slot></slot>
    </mux-video>
    <slot name="poster" slot="poster">
      <media-poster-image
        part="poster"
        exportparts="poster, img"
        src="${i.poster?i.poster:!1}"
        placeholdersrc="${(U=i.placeholder)!=null?U:!1}"
      ></media-poster-image>
    </slot>
  </media-theme>
`},Kb=i=>i.charAt(0).toUpperCase()+i.slice(1),PP=(i,e=!1)=>{var t,s;if(i.muxCode){let r=Kb((t=i.errorCategory)!=null?t:"video"),n=nu((s=i.errorCategory)!=null?s:Pe.VIDEO);if(i.muxCode===re.NETWORK_OFFLINE)return ie("Your device appears to be offline",e);if(i.muxCode===re.NETWORK_TOKEN_EXPIRED)return ie("{category} URL has expired",e).format({category:r});if([re.NETWORK_TOKEN_SUB_MISMATCH,re.NETWORK_TOKEN_AUD_MISMATCH,re.NETWORK_TOKEN_AUD_MISSING,re.NETWORK_TOKEN_MALFORMED].includes(i.muxCode))return ie("{category} URL is formatted incorrectly",e).format({category:r});if(i.muxCode===re.NETWORK_TOKEN_MISSING)return ie("Invalid {categoryName} URL",e).format({categoryName:n});if(i.muxCode===re.NETWORK_NOT_FOUND)return ie("{category} does not exist",e).format({category:r});if(i.muxCode===re.NETWORK_NOT_READY){let a=i.streamType==="live"?"Live stream":"Video";return ie("{mediaType} is not currently available",e).format({mediaType:a})}}if(i.code){if(i.code===z.MEDIA_ERR_NETWORK)return ie("Network Error",e);if(i.code===z.MEDIA_ERR_DECODE)return ie("Media Error",e);if(i.code===z.MEDIA_ERR_SRC_NOT_SUPPORTED)return ie("Source Not Supported",e)}return ie("Error",e)},OP=(i,e=!1)=>{var t,s;if(i.muxCode){let r=Kb((t=i.errorCategory)!=null?t:"video"),n=nu((s=i.errorCategory)!=null?s:Pe.VIDEO);return i.muxCode===re.NETWORK_OFFLINE?ie("Check your internet connection and try reloading this video.",e):i.muxCode===re.NETWORK_TOKEN_EXPIRED?ie("The video’s secured {tokenNamePrefix}-token has expired.",e).format({tokenNamePrefix:n}):i.muxCode===re.NETWORK_TOKEN_SUB_MISMATCH?ie("The video’s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",e).format({tokenNamePrefix:n}):i.muxCode===re.NETWORK_TOKEN_MALFORMED?ie("{category} URL is formatted incorrectly",e).format({category:r}):[re.NETWORK_TOKEN_AUD_MISMATCH,re.NETWORK_TOKEN_AUD_MISSING].includes(i.muxCode)?ie("The {tokenNamePrefix}-token is formatted with incorrect information.",e).format({tokenNamePrefix:n}):[re.NETWORK_TOKEN_MISSING,re.NETWORK_INVALID_URL].includes(i.muxCode)?ie("The video URL or {tokenNamePrefix}-token are formatted with incorrect or incomplete information.",e).format({tokenNamePrefix:n}):i.muxCode===re.NETWORK_NOT_FOUND?"":i.message}return i.code&&(i.code===z.MEDIA_ERR_NETWORK||i.code===z.MEDIA_ERR_DECODE||(i.code,z.MEDIA_ERR_SRC_NOT_SUPPORTED)),i.message},NP=(i,e=!1)=>{let t=PP(i,e).toString(),s=OP(i,e).toString();return{title:t,message:s}},UP=i=>{if(i.muxCode){if(i.muxCode===re.NETWORK_TOKEN_EXPIRED)return"403-expired-token.md";if(i.muxCode===re.NETWORK_TOKEN_MALFORMED)return"403-malformatted-token.md";if([re.NETWORK_TOKEN_AUD_MISMATCH,re.NETWORK_TOKEN_AUD_MISSING].includes(i.muxCode))return"403-incorrect-aud-value.md";if(i.muxCode===re.NETWORK_TOKEN_SUB_MISMATCH)return"403-playback-id-mismatch.md";if(i.muxCode===re.NETWORK_TOKEN_MISSING)return"missing-signed-tokens.md";if(i.muxCode===re.NETWORK_NOT_FOUND)return"404-not-found.md";if(i.muxCode===re.NETWORK_NOT_READY)return"412-not-playable.md"}if(i.code){if(i.code===z.MEDIA_ERR_NETWORK)return"";if(i.code===z.MEDIA_ERR_DECODE)return"media-decode-error.md";if(i.code===z.MEDIA_ERR_SRC_NOT_SUPPORTED)return"media-src-not-supported.md"}return""},j0=(i,e)=>{let t=UP(i);return{message:i.message,context:i.context,file:t}},$P=`<template id="media-theme-gerwig">
  <style>
    @keyframes pre-play-hide {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      30% {
        transform: scale(0.7);
      }

      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    :host {
      --_primary-color: var(--media-primary-color, #fff);
      --_secondary-color: var(--media-secondary-color, transparent);
      --_accent-color: var(--media-accent-color, #fa50b5);
      --_text-color: var(--media-text-color, #000);

      --media-icon-color: var(--_primary-color);
      --media-control-background: var(--_secondary-color);
      --media-control-hover-background: var(--_accent-color);
      --media-time-buffered-color: rgba(255, 255, 255, 0.4);
      --media-preview-time-text-shadow: none;
      --media-control-height: 14px;
      --media-control-padding: 6px;
      --media-tooltip-container-margin: 6px;
      --media-tooltip-distance: 18px;

      color: var(--_primary-color);
      display: inline-block;
      width: 100%;
      height: 100%;
    }

    :host([audio]) {
      --_secondary-color: var(--media-secondary-color, black);
      --media-preview-time-text-shadow: none;
    }

    :host([audio]) ::slotted([slot='media']) {
      height: 0px;
    }

    :host([audio]) media-loading-indicator {
      display: none;
    }

    :host([audio]) media-controller {
      background: transparent;
    }

    :host([audio]) media-controller::part(vertical-layer) {
      background: transparent;
    }

    :host([audio]) media-control-bar {
      width: 100%;
      background-color: var(--media-control-background);
    }

    /*
     * 0.433s is the transition duration for VTT Regions.
     * Borrowed here, so the captions don't move too fast.
     */
    media-controller {
      --media-webkit-text-track-transform: translateY(0) scale(0.98);
      --media-webkit-text-track-transition: transform 0.433s ease-out 0.3s;
    }
    media-controller:is([mediapaused], :not([userinactive])) {
      --media-webkit-text-track-transform: translateY(-50px) scale(0.98);
      --media-webkit-text-track-transition: transform 0.15s ease;
    }

    /*
     * CSS specific to iOS devices.
     * See: https://stackoverflow.com/questions/30102792/css-media-query-to-target-only-ios-devices/60220757#60220757
     */
    @supports (-webkit-touch-callout: none) {
      /* Disable subtitle adjusting for iOS Safari */
      media-controller[mediaisfullscreen] {
        --media-webkit-text-track-transform: unset;
        --media-webkit-text-track-transition: unset;
      }
    }

    media-time-range {
      --media-box-padding-left: 6px;
      --media-box-padding-right: 6px;
      --media-range-bar-color: var(--_accent-color);
      --media-time-range-buffered-color: var(--_primary-color);
      --media-range-track-color: transparent;
      --media-range-track-background: rgba(255, 255, 255, 0.4);
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_accent-color) 25%,
        var(--_accent-color)
      );
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
      --media-range-thumb-transform: scale(0);
      --media-range-thumb-transition: transform 0.3s;
      --media-range-thumb-opacity: 1;
      --media-preview-background: var(--_primary-color);
      --media-box-arrow-background: var(--_primary-color);
      --media-preview-thumbnail-border: 5px solid var(--_primary-color);
      --media-preview-border-radius: 5px;
      --media-text-color: var(--_text-color);
      --media-control-hover-background: transparent;
      --media-preview-chapter-text-shadow: none;
      color: var(--_accent-color);
      padding: 0 6px;
    }

    :host([audio]) media-time-range {
      --media-preview-time-padding: 1.5px 6px;
      --media-preview-box-margin: 0 0 -5px;
    }

    media-time-range:hover {
      --media-range-thumb-transform: scale(1);
    }

    media-preview-thumbnail {
      border-bottom-width: 0;
    }

    [part~='menu'] {
      border-radius: 2px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      bottom: 50px;
      padding: 2.5px 10px;
    }

    [part~='menu']::part(indicator) {
      fill: var(--_accent-color);
    }

    [part~='menu']::part(menu-item) {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      padding: 6px 10px;
      min-height: 34px;
    }

    [part~='menu']::part(checked) {
      font-weight: 700;
    }

    media-captions-menu,
    media-rendition-menu,
    media-audio-track-menu,
    media-playback-rate-menu {
      position: absolute; /* ensure they don't take up space in DOM on load */
      --media-menu-background: var(--_primary-color);
      --media-menu-item-checked-background: transparent;
      --media-text-color: var(--_text-color);
      --media-menu-item-hover-background: transparent;
      --media-menu-item-hover-outline: var(--_accent-color) solid 1px;
    }

    media-rendition-menu {
      min-width: 140px;
    }

    /* The icon is a circle so make it 16px high instead of 14px for more balance. */
    media-audio-track-menu-button {
      --media-control-padding: 5px;
      --media-control-height: 16px;
    }

    media-playback-rate-menu-button {
      --media-control-padding: 6px 3px;
      min-width: 4.4ch;
    }

    media-playback-rate-menu {
      --media-menu-flex-direction: row;
      --media-menu-item-checked-background: var(--_accent-color);
      --media-menu-item-checked-indicator-display: none;
      margin-right: 6px;
      padding: 0;
      --media-menu-gap: 0.25em;
    }

    media-playback-rate-menu[part~='menu']::part(menu-item) {
      padding: 6px 6px 6px 8px;
    }

    media-playback-rate-menu[part~='menu']::part(checked) {
      color: #fff;
    }

    :host(:not([audio])) media-time-range {
      /* Adding px is required here for calc() */
      --media-range-padding: 0px;
      background: transparent;
      z-index: 10;
      height: 10px;
      bottom: -3px;
      width: 100%;
    }

    media-control-bar :is([role='button'], [role='switch'], button) {
      line-height: 0;
    }

    media-control-bar :is([part*='button'], [part*='range'], [part*='display']) {
      border-radius: 3px;
    }

    .spacer {
      flex-grow: 1;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    media-control-bar[slot~='top-chrome'] {
      min-height: 42px;
      pointer-events: none;
    }

    media-control-bar {
      --gradient-steps:
        hsl(0 0% 0% / 0) 0%, hsl(0 0% 0% / 0.013) 8.1%, hsl(0 0% 0% / 0.049) 15.5%, hsl(0 0% 0% / 0.104) 22.5%,
        hsl(0 0% 0% / 0.175) 29%, hsl(0 0% 0% / 0.259) 35.3%, hsl(0 0% 0% / 0.352) 41.2%, hsl(0 0% 0% / 0.45) 47.1%,
        hsl(0 0% 0% / 0.55) 52.9%, hsl(0 0% 0% / 0.648) 58.8%, hsl(0 0% 0% / 0.741) 64.7%, hsl(0 0% 0% / 0.825) 71%,
        hsl(0 0% 0% / 0.896) 77.5%, hsl(0 0% 0% / 0.951) 84.5%, hsl(0 0% 0% / 0.987) 91.9%, hsl(0 0% 0%) 100%;
    }

    :host([title]) media-control-bar[slot='top-chrome']::before,
    :host([videotitle]) media-control-bar[slot='top-chrome']::before {
      content: '';
      position: absolute;
      width: 100%;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(to top, var(--gradient-steps));
      opacity: 0.8;
      pointer-events: none;
    }

    :host(:not([audio])) media-control-bar[part~='bottom']::before {
      content: '';
      position: absolute;
      width: 100%;
      bottom: 0;
      left: 0;
      padding-bottom: min(100px, 25%);
      background: linear-gradient(to bottom, var(--gradient-steps));
      opacity: 0.8;
      z-index: 1;
      pointer-events: none;
    }

    media-control-bar[part~='bottom'] > * {
      z-index: 20;
    }

    media-control-bar[part~='bottom'] {
      padding: 6px 6px;
    }

    media-control-bar[slot~='top-chrome'] > * {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      position: relative;
    }

    media-controller::part(vertical-layer) {
      transition: background-color 1s;
    }

    media-controller:is([mediapaused], :not([userinactive]))::part(vertical-layer) {
      background-color: var(--controls-backdrop-color, var(--controls, transparent));
      transition: background-color 0.25s;
    }

    .center-controls {
      --media-button-icon-width: 100%;
      --media-button-icon-height: auto;
      --media-tooltip-display: none;
      pointer-events: none;
      width: 100%;
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
      paint-order: stroke;
      stroke: rgba(102, 102, 102, 1);
      stroke-width: 0.3px;
      text-shadow:
        0 0 2px rgb(0 0 0 / 0.25),
        0 0 6px rgb(0 0 0 / 0.25);
    }

    .center-controls media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      --media-control-padding: 0;
      width: 40px;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
    }

    [breakpointsm] .center-controls media-play-button {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      transition: background 0.4s;
      padding: 24px;
      --media-control-background: #000;
      --media-control-hover-background: var(--_accent-color);
    }

    .center-controls media-seek-backward-button,
    .center-controls media-seek-forward-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      margin: 0 20px;
      width: max(33px, min(8%, 40px));
      text-shadow:
        0 0 2px rgb(0 0 0 / 0.25),
        0 0 6px rgb(0 0 0 / 0.25);
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback {
      display: grid;
      align-items: initial;
      justify-content: initial;
      height: 100%;
      overflow: hidden;
    }

    [breakpointsm]:not([audio]) .center-controls.pre-playback media-play-button {
      place-self: var(--_pre-playback-place, center);
      grid-area: 1 / 1;
      margin: 16px;
    }

    /* Show and hide controls or pre-playback state */

    [breakpointsm]:is([mediahasplayed], :not([mediapaused])):not([audio])
      .center-controls.pre-playback
      media-play-button {
      /* Using \`forwards\` would lead to a laggy UI after the animation got in the end state */
      animation: 0.3s linear pre-play-hide;
      opacity: 0;
      pointer-events: none;
    }

    .autoplay-unmute {
      --media-control-hover-background: transparent;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
    }

    .autoplay-unmute-btn {
      --media-control-height: 16px;
      border-radius: 8px;
      background: #000;
      color: var(--_primary-color);
      display: flex;
      align-items: center;
      padding: 8px 16px;
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
    }

    .autoplay-unmute-btn:hover {
      background: var(--_accent-color);
    }

    [breakpointsm] .autoplay-unmute-btn {
      --media-control-height: 30px;
      padding: 14px 24px;
      font-size: 26px;
    }

    .autoplay-unmute-btn svg {
      margin: 0 6px 0 0;
    }

    [breakpointsm] .autoplay-unmute-btn svg {
      margin: 0 10px 0 0;
    }

    media-controller:not([audio]):not([mediahasplayed]) *:is(media-control-bar, media-time-range) {
      display: none;
    }

    media-error-dialog:not([mediaerrorcode]) {
      opacity: 0;
    }

    media-loading-indicator {
      --media-loading-icon-width: 100%;
      --media-button-icon-height: auto;
      display: var(--media-control-display, var(--media-loading-indicator-display, flex));
      pointer-events: none;
      position: absolute;
      width: min(15%, 150px);
      flex-flow: row;
      align-items: center;
      justify-content: center;
    }

    /* Intentionally don't target the div for transition but the children
     of the div. Prevents messing with media-chrome's autohide feature. */
    media-loading-indicator + div * {
      transition: opacity 0.15s;
      opacity: 1;
    }

    media-loading-indicator[medialoading]:not([mediapaused]) ~ div > * {
      opacity: 0;
      transition-delay: 400ms;
    }

    media-volume-range {
      width: min(100%, 100px);
      --media-range-padding-left: 10px;
      --media-range-padding-right: 10px;
      --media-range-thumb-width: 12px;
      --media-range-thumb-height: 12px;
      --media-range-thumb-background: radial-gradient(
        circle,
        #000 0%,
        #000 25%,
        var(--_primary-color) 25%,
        var(--_primary-color)
      );
      --media-control-hover-background: none;
    }

    media-time-display {
      white-space: nowrap;
    }

    /* Generic style for explicitly disabled controls */
    media-control-bar[part~='bottom'] [disabled],
    media-control-bar[part~='bottom'] [aria-disabled='true'] {
      opacity: 60%;
      cursor: not-allowed;
    }

    media-text-display {
      --media-font-size: 16px;
      --media-control-padding: 14px;
      font-weight: 500;
    }

    media-play-button.animated *:is(g, path) {
      transition: all 0.3s;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt1 {
      opacity: 0;
    }

    media-play-button.animated[mediapaused] .pause-icon-pt2 {
      transform-origin: center center;
      transform: scaleY(0);
    }

    media-play-button.animated[mediapaused] .play-icon {
      clip-path: inset(0 0 0 0);
    }

    media-play-button.animated:not([mediapaused]) .play-icon {
      clip-path: inset(0 0 0 100%);
    }

    media-seek-forward-button,
    media-seek-backward-button {
      --media-font-weight: 400;
    }

    .mute-icon {
      display: inline-block;
    }

    .mute-icon :is(path, g) {
      transition: opacity 0.5s;
    }

    .muted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='low'] :is(.volume-medium, .volume-high),
    media-mute-button[mediavolumelevel='medium'] :is(.volume-high) {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .unmuted {
      opacity: 0;
    }

    media-mute-button[mediavolumelevel='off'] .muted {
      opacity: 1;
    }

    /**
     * Our defaults for these buttons are to hide them at small sizes
     * users can override this with CSS
     */
    media-controller:not([breakpointsm]):not([audio]) {
      --bottom-play-button: none;
      --bottom-seek-backward-button: none;
      --bottom-seek-forward-button: none;
      --bottom-time-display: none;
      --bottom-playback-rate-menu-button: none;
      --bottom-pip-button: none;
    }

    [part='mux-badge'] {
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 2;
      opacity: 0.6;
      transition:
        opacity 0.2s ease-in-out,
        bottom 0.2s ease-in-out;
    }

    [part='mux-badge']:hover {
      opacity: 1;
    }

    [part='mux-badge'] a {
      font-size: 14px;
      font-family: var(--_font-family);
      color: var(--_primary-color);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    [part='mux-badge'] .mux-badge-text {
      transition: opacity 0.5s ease-in-out;
      opacity: 0;
    }

    [part='mux-badge'] .mux-badge-logo {
      width: 40px;
      height: auto;
      display: inline-block;
    }

    [part='mux-badge'] .mux-badge-logo svg {
      width: 100%;
      height: 100%;
      fill: white;
    }

    media-controller:not([userinactive]):not([mediahasplayed]) [part='mux-badge'],
    media-controller:not([userinactive]) [part='mux-badge'],
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] {
      transition: bottom 0.1s ease-in-out;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] {
      transition: bottom 0.2s ease-in-out 0.62s;
    }

    media-controller:not([userinactive]) [part='mux-badge'] .mux-badge-text,
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] .mux-badge-text {
      opacity: 1;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] .mux-badge-text {
      opacity: 0;
    }

    media-controller[userinactive]:not([mediapaused]) [part='mux-badge'] {
      bottom: 10px;
    }

    media-controller:not([userinactive]):not([mediahasplayed]) [part='mux-badge'] {
      bottom: 10px;
    }

    media-controller:not([userinactive])[mediahasplayed] [part='mux-badge'],
    media-controller[mediahasplayed][mediapaused] [part='mux-badge'] {
      bottom: calc(28px + var(--media-control-height, 0px) + var(--media-control-padding, 0px) * 2);
    }
  </style>

  <template partial="TitleDisplay">
    <template if="videotitle">
      <template if="videotitle != true">
        <media-text-display part="top title display" class="title-display">{{videotitle}}</media-text-display>
      </template>
    </template>
    <template if="!videotitle">
      <template if="title">
        <media-text-display part="top title display" class="title-display">{{title}}</media-text-display>
      </template>
    </template>
  </template>

  <template partial="PlayButton">
    <media-play-button
      part="{{section ?? 'bottom'}} play button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      class="animated"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon">
        <g class="play-icon">
          <path
            d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
          />
        </g>
        <g class="pause-icon">
          <path
            class="pause-icon-pt1"
            d="M5.90709 0H2.96889C2.46857 0 2.06299 0.405585 2.06299 0.9059V13.0941C2.06299 13.5944 2.46857 14 2.96889 14H5.90709C6.4074 14 6.81299 13.5944 6.81299 13.0941V0.9059C6.81299 0.405585 6.4074 0 5.90709 0Z"
          />
          <path
            class="pause-icon-pt2"
            d="M15.1571 0H12.2189C11.7186 0 11.313 0.405585 11.313 0.9059V13.0941C11.313 13.5944 11.7186 14 12.2189 14H15.1571C15.6574 14 16.063 13.5944 16.063 13.0941V0.9059C16.063 0.405585 15.6574 0 15.1571 0Z"
          />
        </g>
      </svg>
    </media-play-button>
  </template>

  <template partial="PrePlayButton">
    <media-play-button
      part="{{section ?? 'center'}} play button pre-play"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon" style="transform: translate(3px, 0)">
        <path
          d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"
        />
      </svg>
    </media-play-button>
  </template>

  <template partial="SeekBackwardButton">
    <media-seek-backward-button
      seekoffset="{{backwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-backward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <path
          d="M3.65 2.07888L0.0864 6.7279C-0.0288 6.87812 -0.0288 7.12188 0.0864 7.2721L3.65 11.9211C3.7792 12.0896 4 11.9703 4 11.7321V2.26787C4 2.02968 3.7792 1.9104 3.65 2.07888Z"
        />
        <text transform="translate(6 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
          {{backwardseekoffset}}
        </text>
      </svg>
    </media-seek-backward-button>
  </template>

  <template partial="SeekForwardButton">
    <media-seek-forward-button
      seekoffset="{{forwardseekoffset}}"
      part="{{section ?? 'bottom'}} seek-forward button"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">
        <g>
          <text transform="translate(-1 12)" style="font-size: 14px; font-family: 'ArialMT', 'Arial'">
            {{forwardseekoffset}}
          </text>
          <path
            d="M18.35 11.9211L21.9136 7.2721C22.0288 7.12188 22.0288 6.87812 21.9136 6.7279L18.35 2.07888C18.2208 1.91041 18 2.02968 18 2.26787V11.7321C18 11.9703 18.2208 12.0896 18.35 11.9211Z"
          />
        </g>
      </svg>
    </media-seek-forward-button>
  </template>

  <template partial="MuteButton">
    <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" slot="icon" class="mute-icon" aria-hidden="true">
        <g class="unmuted">
          <path
            d="M6.76786 1.21233L3.98606 3.98924H1.19937C0.593146 3.98924 0.101743 4.51375 0.101743 5.1607V6.96412L0 6.99998L0.101743 7.03583V8.83926C0.101743 9.48633 0.593146 10.0108 1.19937 10.0108H3.98606L6.76773 12.7877C7.23561 13.2547 8 12.9007 8 12.2171V1.78301C8 1.09925 7.23574 0.745258 6.76786 1.21233Z"
          />
          <path
            class="volume-low"
            d="M10 3.54781C10.7452 4.55141 11.1393 5.74511 11.1393 6.99991C11.1393 8.25471 10.7453 9.44791 10 10.4515L10.7988 11.0496C11.6734 9.87201 12.1356 8.47161 12.1356 6.99991C12.1356 5.52821 11.6735 4.12731 10.7988 2.94971L10 3.54781Z"
          />
          <path
            class="volume-medium"
            d="M12.3778 2.40086C13.2709 3.76756 13.7428 5.35806 13.7428 7.00026C13.7428 8.64246 13.2709 10.233 12.3778 11.5992L13.2106 12.1484C14.2107 10.6185 14.739 8.83796 14.739 7.00016C14.739 5.16236 14.2107 3.38236 13.2106 1.85156L12.3778 2.40086Z"
          />
          <path
            class="volume-high"
            d="M15.5981 0.75L14.7478 1.2719C15.7937 2.9919 16.3468 4.9723 16.3468 7C16.3468 9.0277 15.7937 11.0082 14.7478 12.7281L15.5981 13.25C16.7398 11.3722 17.343 9.211 17.343 7C17.343 4.789 16.7398 2.6268 15.5981 0.75Z"
          />
        </g>
        <g class="muted">
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.39976 4.98924H1.19937C1.19429 4.98924 1.17777 4.98961 1.15296 5.01609C1.1271 5.04369 1.10174 5.09245 1.10174 5.1607V8.83926C1.10174 8.90761 1.12714 8.95641 1.15299 8.984C1.17779 9.01047 1.1943 9.01084 1.19937 9.01084H4.39977L7 11.6066V2.39357L4.39976 4.98924ZM7.47434 1.92006C7.4743 1.9201 7.47439 1.92002 7.47434 1.92006V1.92006ZM6.76773 12.7877L3.98606 10.0108H1.19937C0.593146 10.0108 0.101743 9.48633 0.101743 8.83926V7.03583L0 6.99998L0.101743 6.96412V5.1607C0.101743 4.51375 0.593146 3.98924 1.19937 3.98924H3.98606L6.76786 1.21233C7.23574 0.745258 8 1.09925 8 1.78301V12.2171C8 12.9007 7.23561 13.2547 6.76773 12.7877Z"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.2677 9.30323C15.463 9.49849 15.7796 9.49849 15.9749 9.30323C16.1701 9.10796 16.1701 8.79138 15.9749 8.59612L14.2071 6.82841L15.9749 5.06066C16.1702 4.8654 16.1702 4.54882 15.9749 4.35355C15.7796 4.15829 15.4631 4.15829 15.2678 4.35355L13.5 6.1213L11.7322 4.35348C11.537 4.15822 11.2204 4.15822 11.0251 4.35348C10.8298 4.54874 10.8298 4.86532 11.0251 5.06058L12.7929 6.82841L11.0251 8.59619C10.8299 8.79146 10.8299 9.10804 11.0251 9.3033C11.2204 9.49856 11.537 9.49856 11.7323 9.3033L13.5 7.53552L15.2677 9.30323Z"
          />
        </g>
      </svg>
    </media-mute-button>
  </template>

  <template partial="PipButton">
    <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M15.9891 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.989C0 13.0996 0.9004 14 2.011 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0ZM17 11.9891C17 12.5465 16.5465 13 15.9891 13H2.011C1.4536 13 1.0001 12.5465 1.0001 11.9891V2.0109C1.0001 1.4535 1.4536 0.9999 2.011 0.9999H15.9891C16.5465 0.9999 17 1.4535 17 2.0109V11.9891Z"
        />
        <path
          d="M15.356 5.67822H8.19523C8.03253 5.67822 7.90063 5.81012 7.90063 5.97282V11.3836C7.90063 11.5463 8.03253 11.6782 8.19523 11.6782H15.356C15.5187 11.6782 15.6506 11.5463 15.6506 11.3836V5.97282C15.6506 5.81012 15.5187 5.67822 15.356 5.67822Z"
        />
      </svg>
    </media-pip-button>
  </template>

  <template partial="CaptionsMenu">
    <media-captions-menu-button part="bottom captions button">
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="on">
        <path
          d="M15.989 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9004 14 2.011 14H15.989C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.989 0ZM4.2292 8.7639C4.5954 9.1902 5.0935 9.4031 5.7233 9.4031C6.1852 9.4031 6.5544 9.301 6.8302 9.0969C7.1061 8.8933 7.2863 8.614 7.3702 8.26H8.4322C8.3062 8.884 8.0093 9.3733 7.5411 9.7273C7.0733 10.0813 6.4703 10.2581 5.732 10.2581C5.108 10.2581 4.5699 10.1219 4.1168 9.8489C3.6637 9.5759 3.3141 9.1946 3.0685 8.7058C2.8224 8.2165 2.6994 7.6511 2.6994 7.009C2.6994 6.3611 2.8224 5.7927 3.0685 5.3034C3.3141 4.8146 3.6637 4.4323 4.1168 4.1559C4.5699 3.88 5.108 3.7418 5.732 3.7418C6.4703 3.7418 7.0733 3.922 7.5411 4.2818C8.0094 4.6422 8.3062 5.1461 8.4322 5.794H7.3702C7.2862 5.4283 7.106 5.1368 6.8302 4.921C6.5544 4.7052 6.1852 4.5968 5.7233 4.5968C5.0934 4.5968 4.5954 4.8116 4.2292 5.2404C3.8635 5.6696 3.6804 6.259 3.6804 7.009C3.6804 7.7531 3.8635 8.3381 4.2292 8.7639ZM11.0974 8.7639C11.4636 9.1902 11.9617 9.4031 12.5915 9.4031C13.0534 9.4031 13.4226 9.301 13.6984 9.0969C13.9743 8.8933 14.1545 8.614 14.2384 8.26H15.3004C15.1744 8.884 14.8775 9.3733 14.4093 9.7273C13.9415 10.0813 13.3385 10.2581 12.6002 10.2581C11.9762 10.2581 11.4381 10.1219 10.985 9.8489C10.5319 9.5759 10.1823 9.1946 9.9367 8.7058C9.6906 8.2165 9.5676 7.6511 9.5676 7.009C9.5676 6.3611 9.6906 5.7927 9.9367 5.3034C10.1823 4.8146 10.5319 4.4323 10.985 4.1559C11.4381 3.88 11.9762 3.7418 12.6002 3.7418C13.3385 3.7418 13.9415 3.922 14.4093 4.2818C14.8776 4.6422 15.1744 5.1461 15.3004 5.794H14.2384C14.1544 5.4283 13.9742 5.1368 13.6984 4.921C13.4226 4.7052 13.0534 4.5968 12.5915 4.5968C11.9616 4.5968 11.4636 4.8116 11.0974 5.2404C10.7317 5.6696 10.5486 6.259 10.5486 7.009C10.5486 7.7531 10.7317 8.3381 11.0974 8.7639Z"
        />
      </svg>
      <svg aria-hidden="true" viewBox="0 0 18 14" slot="off">
        <path
          d="M5.73219 10.258C5.10819 10.258 4.57009 10.1218 4.11699 9.8488C3.66389 9.5758 3.31429 9.1945 3.06869 8.7057C2.82259 8.2164 2.69958 7.651 2.69958 7.0089C2.69958 6.361 2.82259 5.7926 3.06869 5.3033C3.31429 4.8145 3.66389 4.4322 4.11699 4.1558C4.57009 3.8799 5.10819 3.7417 5.73219 3.7417C6.47049 3.7417 7.07348 3.9219 7.54128 4.2817C8.00958 4.6421 8.30638 5.146 8.43238 5.7939H7.37039C7.28639 5.4282 7.10618 5.1367 6.83039 4.9209C6.55459 4.7051 6.18538 4.5967 5.72348 4.5967C5.09358 4.5967 4.59559 4.8115 4.22939 5.2403C3.86369 5.6695 3.68058 6.2589 3.68058 7.0089C3.68058 7.753 3.86369 8.338 4.22939 8.7638C4.59559 9.1901 5.09368 9.403 5.72348 9.403C6.18538 9.403 6.55459 9.3009 6.83039 9.0968C7.10629 8.8932 7.28649 8.6139 7.37039 8.2599H8.43238C8.30638 8.8839 8.00948 9.3732 7.54128 9.7272C7.07348 10.0812 6.47049 10.258 5.73219 10.258Z"
        />
        <path
          d="M12.6003 10.258C11.9763 10.258 11.4382 10.1218 10.9851 9.8488C10.532 9.5758 10.1824 9.1945 9.93685 8.7057C9.69075 8.2164 9.56775 7.651 9.56775 7.0089C9.56775 6.361 9.69075 5.7926 9.93685 5.3033C10.1824 4.8145 10.532 4.4322 10.9851 4.1558C11.4382 3.8799 11.9763 3.7417 12.6003 3.7417C13.3386 3.7417 13.9416 3.9219 14.4094 4.2817C14.8777 4.6421 15.1745 5.146 15.3005 5.7939H14.2385C14.1545 5.4282 13.9743 5.1367 13.6985 4.9209C13.4227 4.7051 13.0535 4.5967 12.5916 4.5967C11.9617 4.5967 11.4637 4.8115 11.0975 5.2403C10.7318 5.6695 10.5487 6.2589 10.5487 7.0089C10.5487 7.753 10.7318 8.338 11.0975 8.7638C11.4637 9.1901 11.9618 9.403 12.5916 9.403C13.0535 9.403 13.4227 9.3009 13.6985 9.0968C13.9744 8.8932 14.1546 8.6139 14.2385 8.2599H15.3005C15.1745 8.8839 14.8776 9.3732 14.4094 9.7272C13.9416 10.0812 13.3386 10.258 12.6003 10.258Z"
        />
        <path
          d="M15.9891 1C16.5465 1 17 1.4535 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H2.0109C1.4535 13 1 12.5465 1 11.9891V2.0109C1 1.4535 1.4535 0.9999 2.0109 0.9999L15.9891 1ZM15.9891 0H2.0109C0.9003 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9003 14 2.0109 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0Z"
        />
      </svg>
    </media-captions-menu-button>
    <media-captions-menu
      hidden
      anchor="auto"
      part="bottom captions menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      exportparts="menu-item"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            display: none;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg></div
    ></media-captions-menu>
  </template>

  <template partial="AirplayButton">
    <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">
        <path
          d="M16.1383 0H1.8618C0.8335 0 0 0.8335 0 1.8617V10.1382C0 11.1664 0.8335 12 1.8618 12H3.076C3.1204 11.9433 3.1503 11.8785 3.2012 11.826L4.004 11H1.8618C1.3866 11 1 10.6134 1 10.1382V1.8617C1 1.3865 1.3866 0.9999 1.8618 0.9999H16.1383C16.6135 0.9999 17.0001 1.3865 17.0001 1.8617V10.1382C17.0001 10.6134 16.6135 11 16.1383 11H13.9961L14.7989 11.826C14.8499 11.8785 14.8798 11.9432 14.9241 12H16.1383C17.1665 12 18.0001 11.1664 18.0001 10.1382V1.8617C18 0.8335 17.1665 0 16.1383 0Z"
        />
        <path
          d="M9.55061 8.21903C9.39981 8.06383 9.20001 7.98633 9.00011 7.98633C8.80021 7.98633 8.60031 8.06383 8.44951 8.21903L4.09771 12.697C3.62471 13.1838 3.96961 13.9998 4.64831 13.9998H13.3518C14.0304 13.9998 14.3754 13.1838 13.9023 12.697L9.55061 8.21903Z"
        />
      </svg>
    </media-airplay-button>
  </template>

  <template partial="FullscreenButton">
    <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M1.00745 4.39539L1.01445 1.98789C1.01605 1.43049 1.47085 0.978289 2.02835 0.979989L6.39375 0.992589L6.39665 -0.007411L2.03125 -0.020011C0.920646 -0.023211 0.0176463 0.874489 0.0144463 1.98509L0.00744629 4.39539H1.00745Z"
        />
        <path
          d="M17.0144 2.03431L17.0076 4.39541H18.0076L18.0144 2.03721C18.0176 0.926712 17.1199 0.0237125 16.0093 0.0205125L11.6439 0.0078125L11.641 1.00781L16.0064 1.02041C16.5638 1.02201 17.016 1.47681 17.0144 2.03431Z"
        />
        <path
          d="M16.9925 9.60498L16.9855 12.0124C16.9839 12.5698 16.5291 13.022 15.9717 13.0204L11.6063 13.0078L11.6034 14.0078L15.9688 14.0204C17.0794 14.0236 17.9823 13.1259 17.9855 12.0153L17.9925 9.60498H16.9925Z"
        />
        <path
          d="M0.985626 11.9661L0.992426 9.60498H-0.0074737L-0.0142737 11.9632C-0.0174737 13.0738 0.880226 13.9767 1.99083 13.98L6.35623 13.9926L6.35913 12.9926L1.99373 12.98C1.43633 12.9784 0.983926 12.5236 0.985626 11.9661Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">
        <path
          d="M5.39655 -0.0200195L5.38955 2.38748C5.38795 2.94488 4.93315 3.39708 4.37565 3.39538L0.0103463 3.38278L0.00744629 4.38278L4.37285 4.39538C5.48345 4.39858 6.38635 3.50088 6.38965 2.39028L6.39665 -0.0200195H5.39655Z"
        />
        <path
          d="M12.6411 2.36891L12.6479 0.0078125H11.6479L11.6411 2.36601C11.6379 3.47651 12.5356 4.37951 13.6462 4.38271L18.0116 4.39531L18.0145 3.39531L13.6491 3.38271C13.0917 3.38111 12.6395 2.92641 12.6411 2.36891Z"
        />
        <path
          d="M12.6034 14.0204L12.6104 11.613C12.612 11.0556 13.0668 10.6034 13.6242 10.605L17.9896 10.6176L17.9925 9.61759L13.6271 9.60499C12.5165 9.60179 11.6136 10.4995 11.6104 11.6101L11.6034 14.0204H12.6034Z"
        />
        <path
          d="M5.359 11.6315L5.3522 13.9926H6.3522L6.359 11.6344C6.3622 10.5238 5.4645 9.62088 4.3539 9.61758L-0.0115043 9.60498L-0.0144043 10.605L4.351 10.6176C4.9084 10.6192 5.3607 11.074 5.359 11.6315Z"
        />
      </svg>
    </media-fullscreen-button>
  </template>

  <template partial="CastButton">
    <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">
        <path
          d="M16.0072 0H2.0291C0.9185 0 0.0181 0.9003 0.0181 2.011V5.5009C0.357 5.5016 0.6895 5.5275 1.0181 5.5669V2.011C1.0181 1.4536 1.4716 1 2.029 1H16.0072C16.5646 1 17.0181 1.4536 17.0181 2.011V11.9891C17.0181 12.5465 16.5646 13 16.0072 13H8.4358C8.4746 13.3286 8.4999 13.6611 8.4999 13.9999H16.0071C17.1177 13.9999 18.018 13.0996 18.018 11.989V2.011C18.0181 0.9003 17.1178 0 16.0072 0ZM0 6.4999V7.4999C3.584 7.4999 6.5 10.4159 6.5 13.9999H7.5C7.5 9.8642 4.1357 6.4999 0 6.4999ZM0 8.7499V9.7499C2.3433 9.7499 4.25 11.6566 4.25 13.9999H5.25C5.25 11.1049 2.895 8.7499 0 8.7499ZM0.0181 11V14H3.0181C3.0181 12.3431 1.675 11 0.0181 11Z"
        />
      </svg>
      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">
        <path
          d="M15.9891 0H2.01103C0.900434 0 3.35947e-05 0.9003 3.35947e-05 2.011V5.5009C0.338934 5.5016 0.671434 5.5275 1.00003 5.5669V2.011C1.00003 1.4536 1.45353 1 2.01093 1H15.9891C16.5465 1 17 1.4536 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H8.41773C8.45653 13.3286 8.48183 13.6611 8.48183 13.9999H15.989C17.0996 13.9999 17.9999 13.0996 17.9999 11.989V2.011C18 0.9003 17.0997 0 15.9891 0ZM-0.0180664 6.4999V7.4999C3.56593 7.4999 6.48193 10.4159 6.48193 13.9999H7.48193C7.48193 9.8642 4.11763 6.4999 -0.0180664 6.4999ZM-0.0180664 8.7499V9.7499C2.32523 9.7499 4.23193 11.6566 4.23193 13.9999H5.23193C5.23193 11.1049 2.87693 8.7499 -0.0180664 8.7499ZM3.35947e-05 11V14H3.00003C3.00003 12.3431 1.65693 11 3.35947e-05 11Z"
        />
        <path d="M2.15002 5.634C5.18352 6.4207 7.57252 8.8151 8.35282 11.8499H15.8501V2.1499H2.15002V5.634Z" />
      </svg>
    </media-cast-button>
  </template>

  <template partial="LiveButton">
    <media-live-button part="{{section ?? 'top'}} live button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <span slot="text">Live</span>
    </media-live-button>
  </template>

  <template partial="PlaybackRateMenu">
    <media-playback-rate-menu-button part="bottom playback-rate button"></media-playback-rate-menu-button>
    <media-playback-rate-menu
      hidden
      anchor="auto"
      rates="{{playbackrates}}"
      exportparts="menu-item"
      part="bottom playback-rate menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-playback-rate-menu>
  </template>

  <template partial="VolumeRange">
    <media-volume-range
      part="bottom volume range"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-volume-range>
  </template>

  <template partial="TimeDisplay">
    <media-time-display
      remaining="{{defaultshowremainingtime}}"
      showduration="{{!hideduration}}"
      part="bottom time display"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    ></media-time-display>
  </template>

  <template partial="TimeRange">
    <media-time-range part="bottom time range" disabled="{{disabled}}" aria-disabled="{{disabled}}">
      <media-preview-thumbnail slot="preview"></media-preview-thumbnail>
      <media-preview-chapter-display slot="preview"></media-preview-chapter-display>
      <media-preview-time-display slot="preview"></media-preview-time-display>
      <div slot="preview" part="arrow"></div>
    </media-time-range>
  </template>

  <template partial="AudioTrackMenu">
    <media-audio-track-menu-button part="bottom audio-track button">
      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 16">
        <path d="M9 15A7 7 0 1 1 9 1a7 7 0 0 1 0 14Zm0 1A8 8 0 1 0 9 0a8 8 0 0 0 0 16Z" />
        <path
          d="M5.2 6.3a.5.5 0 0 1 .5.5v2.4a.5.5 0 1 1-1 0V6.8a.5.5 0 0 1 .5-.5Zm2.4-2.4a.5.5 0 0 1 .5.5v7.2a.5.5 0 0 1-1 0V4.4a.5.5 0 0 1 .5-.5ZM10 5.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.4-.8a.5.5 0 0 1 .5.5v5.6a.5.5 0 0 1-1 0V5.2a.5.5 0 0 1 .5-.5Z"
        />
      </svg>
    </media-audio-track-menu-button>
    <media-audio-track-menu
      hidden
      anchor="auto"
      part="bottom audio-track menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
      exportparts="menu-item"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            display: none;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg>
      </div>
    </media-audio-track-menu>
  </template>

  <template partial="RenditionMenu">
    <media-rendition-menu-button part="bottom rendition button">
      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 14">
        <path
          d="M2.25 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM9 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm6.75 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"
        />
      </svg>
    </media-rendition-menu-button>
    <media-rendition-menu
      hidden
      anchor="auto"
      part="bottom rendition menu"
      disabled="{{disabled}}"
      aria-disabled="{{disabled}}"
    >
      <div slot="checked-indicator">
        <style>
          .indicator {
            position: relative;
            top: 1px;
            width: 0.9em;
            height: auto;
            fill: var(--_accent-color);
            margin-right: 5px;
          }

          [aria-checked='false'] .indicator {
            opacity: 0;
          }
        </style>
        <svg viewBox="0 0 14 18" class="indicator">
          <path
            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"
            fill-rule="evenodd"
          />
        </svg>
      </div>
    </media-rendition-menu>
  </template>

  <template partial="MuxBadge">
    <div part="mux-badge">
      <a href="https://www.mux.com/player" target="_blank">
        <span class="mux-badge-text">Powered by</span>
        <div class="mux-badge-logo">
          <svg
            viewBox="0 0 1600 500"
            style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2"
          >
            <g>
              <path
                d="M994.287,93.486c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m0,-93.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,68.943 -56.09,125.033 -125.032,125.033c-68.942,-0 -125.03,-56.09 -125.03,-125.033l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,137.853 112.149,250.003 249.999,250.003c137.851,-0 250.001,-112.15 250.001,-250.003l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486"
                style="fill-rule: nonzero"
              ></path>
              <path
                d="M1537.51,468.511c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m-275.883,-218.509l-143.33,143.329c-24.402,24.402 -24.402,63.966 0,88.368c24.402,24.402 63.967,24.402 88.369,-0l143.33,-143.329l143.328,143.329c24.402,24.4 63.967,24.402 88.369,-0c24.403,-24.402 24.403,-63.966 0.001,-88.368l-143.33,-143.329l0.001,-0.004l143.329,-143.329c24.402,-24.402 24.402,-63.965 0,-88.367c-24.402,-24.402 -63.967,-24.402 -88.369,-0l-143.329,143.328l-143.329,-143.328c-24.402,-24.401 -63.967,-24.402 -88.369,-0c-24.402,24.402 -24.402,63.965 0,88.367l143.329,143.329l0,0.004Z"
                style="fill-rule: nonzero"
              ></path>
              <path
                d="M437.511,468.521c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m23.915,-463.762c-23.348,-9.672 -50.226,-4.327 -68.096,13.544l-143.331,143.329l-143.33,-143.329c-17.871,-17.871 -44.747,-23.216 -68.096,-13.544c-23.349,9.671 -38.574,32.455 -38.574,57.729l0,375.026c0,34.51 27.977,62.486 62.487,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-224.173l80.843,80.844c24.404,24.402 63.965,24.402 88.369,-0l80.843,-80.844l0,224.173c0,34.51 27.976,62.486 62.486,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-375.026c0,-25.274 -15.224,-48.058 -38.573,-57.729"
                style="fill-rule: nonzero"
              ></path>
            </g>
          </svg>
        </div>
      </a>
    </div>
  </template>

  <media-controller
    part="controller"
    defaultstreamtype="{{defaultstreamtype ?? 'on-demand'}}"
    breakpoints="sm:470"
    gesturesdisabled="{{disabled}}"
    hotkeys="{{hotkeys}}"
    nohotkeys="{{nohotkeys}}"
    novolumepref="{{novolumepref}}"
    audio="{{audio}}"
    noautoseektolive="{{noautoseektolive}}"
    defaultsubtitles="{{defaultsubtitles}}"
    defaultduration="{{defaultduration ?? false}}"
    keyboardforwardseekoffset="{{forwardseekoffset}}"
    keyboardbackwardseekoffset="{{backwardseekoffset}}"
    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"
    style="--_pre-playback-place:{{preplaybackplace ?? 'center'}}"
  >
    <slot name="media" slot="media"></slot>
    <slot name="poster" slot="poster"></slot>

    <media-loading-indicator slot="centered-chrome" noautohide></media-loading-indicator>

    <template if="!audio">
      <media-error-dialog slot="dialog" noautohide></media-error-dialog>
      <!-- Pre-playback UI -->
      <!-- same for both on-demand and live -->
      <div slot="centered-chrome" class="center-controls pre-playback">
        <template if="!breakpointsm">{{>PlayButton section="center"}}</template>
        <template if="breakpointsm">{{>PrePlayButton section="center"}}</template>
      </div>

      <!-- Mux Badge -->
      <template if="proudlydisplaymuxbadge"> {{>MuxBadge}} </template>

      <!-- Autoplay centered unmute button -->
      <!--
        todo: figure out how show this with available state variables
        needs to show when:
        - autoplay is enabled
        - playback has been successful
        - audio is muted
        - in place / instead of the pre-plaback play button
        - not to show again after user has interacted with this button
          - OR user has interacted with the mute button in the control bar
      -->
      <!--
        There should be a >MuteButton to the left of the "Unmute" text, but a templating bug
        makes it appear even if commented out in the markup, add it back when code is un-commented
      -->
      <!-- <div slot="centered-chrome" class="autoplay-unmute">
        <div role="button" class="autoplay-unmute-btn">Unmute</div>
      </div> -->

      <template if="streamtype == 'on-demand'">
        <template if="breakpointsm">
          <media-control-bar part="control-bar top" slot="top-chrome">{{>TitleDisplay}} </media-control-bar>
        </template>
        {{>TimeRange}}
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>MuteButton}}
          {{>VolumeRange}}
          <div class="spacer"></div>
          {{>RenditionMenu}} {{>PlaybackRateMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}}
          {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <media-control-bar part="control-bar top" slot="top-chrome">
          {{>LiveButton}}
          <template if="breakpointsm"> {{>TitleDisplay}} </template>
        </media-control-bar>
        <template if="targetlivewindow > 0">{{>TimeRange}}</template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}}
          <template if="targetlivewindow > 0">{{>SeekBackwardButton}} {{>SeekForwardButton}}</template>
          {{>MuteButton}} {{>VolumeRange}}
          <div class="spacer"></div>
          {{>RenditionMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
          {{>FullscreenButton}}
        </media-control-bar>
      </template>
    </template>

    <template if="audio">
      <template if="streamtype == 'on-demand'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}}
          <template if="breakpointsm"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          {{>MuteButton}}
          <template if="breakpointsm">{{>VolumeRange}}</template>
          {{>TimeDisplay}} {{>TimeRange}}
          <template if="breakpointsm">{{>PlaybackRateMenu}}</template>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>

      <template if="streamtype == 'live'">
        <template if="title">
          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>
        </template>
        <media-control-bar part="control-bar bottom">
          {{>PlayButton}} {{>LiveButton section="bottom"}} {{>MuteButton}}
          <template if="breakpointsm">
            {{>VolumeRange}}
            <template if="targetlivewindow > 0"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>
          </template>
          <template if="targetlivewindow > 0"> {{>TimeDisplay}} {{>TimeRange}} </template>
          <template if="!targetlivewindow"><div class="spacer"></div></template>
          {{>AirplayButton}} {{>CastButton}}
        </media-control-bar>
      </template>
    </template>

    <slot></slot>
  </media-controller>
</template>
`,cf=eu.createElement("template");"innerHTML"in cf&&(cf.innerHTML=$P);var z0,Q0,Vb=class extends _u{};Vb.template=(Q0=(z0=cf.content)==null?void 0:z0.children)==null?void 0:Q0[0];Hi.customElements.get("media-theme-gerwig")||Hi.customElements.define("media-theme-gerwig",Vb);var FP="gerwig",rs={SRC:"src",POSTER:"poster"},O={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",ACCENT_COLOR:"accent-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",FULLSCREEN_ELEMENT:"fullscreen-element",DRM_TOKEN:"drm-token",STORYBOARD_SRC:"storyboard-src",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",DEFAULT_DURATION:"default-duration",TITLE:"title",VIDEO_TITLE:"video-title",PLACEHOLDER:"placeholder",THEME:"theme",DEFAULT_STREAM_TYPE:"default-stream-type",TARGET_LIVE_WINDOW:"target-live-window",EXTRA_SOURCE_PARAMS:"extra-source-params",NO_VOLUME_PREF:"no-volume-pref",NO_MUTED_PREF:"no-muted-pref",CAST_RECEIVER:"cast-receiver",NO_TOOLTIPS:"no-tooltips",PROUDLY_DISPLAY_MUX_BADGE:"proudly-display-mux-badge",DISABLE_PSEUDO_ENDED:"disable-pseudo-ended"},hf=["audio","backwardseekoffset","defaultduration","defaultshowremainingtime","defaultsubtitles","noautoseektolive","disabled","exportparts","forwardseekoffset","hideduration","hotkeys","nohotkeys","playbackrates","defaultstreamtype","streamtype","style","targetlivewindow","template","title","videotitle","novolumepref","nomutedpref","proudlydisplaymuxbadge"];function BP(i,e){var t,s;return{src:!i.playbackId&&i.src,playbackId:i.playbackId,hasSrc:!!i.playbackId||!!i.src||!!i.currentSrc,poster:i.poster,storyboard:i.storyboard,storyboardSrc:i.getAttribute(O.STORYBOARD_SRC),fullscreenElement:i.getAttribute(O.FULLSCREEN_ELEMENT),placeholder:i.getAttribute("placeholder"),themeTemplate:GP(i),thumbnailTime:!i.tokens.thumbnail&&i.thumbnailTime,autoplay:i.autoplay,crossOrigin:i.crossOrigin,loop:i.loop,noHotKeys:i.hasAttribute(O.NOHOTKEYS),hotKeys:i.getAttribute(O.HOTKEYS),muted:i.muted,paused:i.paused,preload:i.preload,envKey:i.envKey,preferCmcd:i.preferCmcd,debug:i.debug,disableTracking:i.disableTracking,disableCookies:i.disableCookies,tokens:i.tokens,beaconCollectionDomain:i.beaconCollectionDomain,maxResolution:i.maxResolution,minResolution:i.minResolution,programStartTime:i.programStartTime,programEndTime:i.programEndTime,assetStartTime:i.assetStartTime,assetEndTime:i.assetEndTime,renditionOrder:i.renditionOrder,metadata:i.metadata,playerInitTime:i.playerInitTime,playerSoftwareName:i.playerSoftwareName,playerSoftwareVersion:i.playerSoftwareVersion,startTime:i.startTime,preferPlayback:i.preferPlayback,audio:i.audio,defaultStreamType:i.defaultStreamType,targetLiveWindow:i.getAttribute(w.TARGET_LIVE_WINDOW),streamType:np(i.getAttribute(w.STREAM_TYPE)),primaryColor:i.getAttribute(O.PRIMARY_COLOR),secondaryColor:i.getAttribute(O.SECONDARY_COLOR),accentColor:i.getAttribute(O.ACCENT_COLOR),forwardSeekOffset:i.forwardSeekOffset,backwardSeekOffset:i.backwardSeekOffset,defaultHiddenCaptions:i.defaultHiddenCaptions,defaultDuration:i.defaultDuration,defaultShowRemainingTime:i.defaultShowRemainingTime,hideDuration:KP(i),playbackRates:i.getAttribute(O.PLAYBACK_RATES),customDomain:(t=i.getAttribute(w.CUSTOM_DOMAIN))!=null?t:void 0,title:i.getAttribute(O.TITLE),videoTitle:(s=i.getAttribute(O.VIDEO_TITLE))!=null?s:i.getAttribute(O.TITLE),novolumepref:i.hasAttribute(O.NO_VOLUME_PREF),nomutedpref:i.hasAttribute(O.NO_MUTED_PREF),proudlyDisplayMuxBadge:i.hasAttribute(O.PROUDLY_DISPLAY_MUX_BADGE),castReceiver:i.castReceiver,disablePseudoEnded:i.hasAttribute(O.DISABLE_PSEUDO_ENDED),...e,extraSourceParams:i.extraSourceParams}}var HP=NT.formatErrorMessage;NT.formatErrorMessage=i=>{var e,t;if(i instanceof z){let s=NP(i,!1);return`
      ${s!=null&&s.title?`<h3>${s.title}</h3>`:""}
      ${s!=null&&s.message||s!=null&&s.linkUrl?`<p>
        ${s?.message}
        ${s!=null&&s.linkUrl?`<a
              href="${s.linkUrl}"
              target="_blank"
              rel="external noopener"
              aria-label="${(e=s.linkText)!=null?e:""} ${ie("(opens in a new window)")}"
              >${(t=s.linkText)!=null?t:s.linkUrl}</a
            >`:""}
      </p>`:""}
    `}return HP(i)};function GP(i){var e,t;let s=i.theme;if(s){let r=(t=(e=i.getRootNode())==null?void 0:e.getElementById)==null?void 0:t.call(e,s);if(r&&r instanceof HTMLTemplateElement)return r;s.startsWith("media-theme-")||(s=`media-theme-${s}`);let n=Hi.customElements.get(s);if(n!=null&&n.template)return n.template}}function KP(i){var e;let t=(e=i.mediaController)==null?void 0:e.querySelector("media-time-display");return t&&getComputedStyle(t).getPropertyValue("--media-duration-display-display").trim()==="none"}function X0(i){let e=i.videoTitle?{video_title:i.videoTitle}:{};return i.getAttributeNames().filter(t=>t.startsWith("metadata-")).reduce((t,s)=>{let r=i.getAttribute(s);return r!==null&&(t[s.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},e)}var VP=Object.values(w),WP=Object.values(rs),qP=Object.values(O),Z0=$b(),J0="mux-player",ev={isDialogOpen:!1},YP={redundant_streams:!0},dd,ud,cd,ar,hd,Rn,Ve,Ds,Wb,ff,or,tv,iv,sv,rv,jP=class extends W0{constructor(){super(),mi(this,Ve),mi(this,dd),mi(this,ud,!1),mi(this,cd,{}),mi(this,ar,!0),mi(this,hd,new cP(this,"hotkeys")),mi(this,Rn,{...ev,onCloseErrorDialog:i=>{var e;((e=i.composedPath()[0])==null?void 0:e.localName)==="media-error-dialog"&&Je(this,Ve,ff).call(this,{isDialogOpen:!1})},onFocusInErrorDialog:i=>{var e;((e=i.composedPath()[0])==null?void 0:e.localName)==="media-error-dialog"&&(Nb(this,eu.activeElement)||i.preventDefault())}}),ji(this,dd,jf()),this.attachShadow({mode:"open"}),Je(this,Ve,Wb).call(this),this.isConnected&&Je(this,Ve,Ds).call(this)}static get NAME(){return J0}static get VERSION(){return Z0}static get observedAttributes(){var i;return[...(i=W0.observedAttributes)!=null?i:[],...WP,...VP,...qP]}get mediaTheme(){var i;return(i=this.shadowRoot)==null?void 0:i.querySelector("media-theme")}get mediaController(){var i,e;return(e=(i=this.mediaTheme)==null?void 0:i.shadowRoot)==null?void 0:e.querySelector("media-controller")}connectedCallback(){let i=this.media;i&&(i.metadata=X0(this))}attributeChangedCallback(i,e,t){switch(Je(this,Ve,Ds).call(this),super.attributeChangedCallback(i,e,t),i){case O.HOTKEYS:Ie(this,hd).value=t;break;case O.THUMBNAIL_TIME:{t!=null&&this.tokens.thumbnail&&ls(ie("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").toString());break}case O.THUMBNAIL_TOKEN:{if(t){let s=Tn(t);if(s){let{aud:r}=s,n=ka.THUMBNAIL;r!==n&&ls(ie("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:r,expectedAud:n,tokenNamePrefix:"thumbnail"}))}}break}case O.STORYBOARD_TOKEN:{if(t){let s=Tn(t);if(s){let{aud:r}=s,n=ka.STORYBOARD;r!==n&&ls(ie("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:r,expectedAud:n,tokenNamePrefix:"storyboard"}))}}break}case O.DRM_TOKEN:{if(t){let s=Tn(t);if(s){let{aud:r}=s,n=ka.DRM;r!==n&&ls(ie("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:r,expectedAud:n,tokenNamePrefix:"drm"}))}}break}case w.PLAYBACK_ID:{t!=null&&t.includes("?token")&&Jt(ie("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:t}));break}case w.STREAM_TYPE:{t&&![Se.LIVE,Se.ON_DEMAND,Se.UNKNOWN].includes(t)?["ll-live","live:dvr","ll-live:dvr"].includes(this.streamType)?this.targetLiveWindow=t.includes("dvr")?Number.POSITIVE_INFINITY:0:Bb({file:"invalid-stream-type.md",message:ie("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand` or `live`").format({streamType:this.streamType})}):t===Se.LIVE?this.getAttribute(O.TARGET_LIVE_WINDOW)==null&&(this.targetLiveWindow=0):this.targetLiveWindow=Number.NaN;break}case O.FULLSCREEN_ELEMENT:{if(t!=null||t!==e){let s=eu.getElementById(t),r=s?.querySelector("mux-player");this.mediaController&&s&&r&&(this.mediaController.fullscreenElement=s)}break}}[w.PLAYBACK_ID,rs.SRC,O.PLAYBACK_TOKEN].includes(i)&&e!==t&&ji(this,Rn,{...Ie(this,Rn),...ev}),Je(this,Ve,or).call(this,{[uP(i)]:t})}async requestFullscreen(i){var e;if(!(!this.mediaController||this.mediaController.hasAttribute(_.MEDIA_IS_FULLSCREEN)))return(e=this.mediaController)==null||e.dispatchEvent(new Hi.CustomEvent(X.MEDIA_ENTER_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((t,s)=>{var r;(r=this.mediaController)==null||r.addEventListener(fs.MEDIA_IS_FULLSCREEN,()=>t(),{once:!0})})}async exitFullscreen(){var i;if(!(!this.mediaController||!this.mediaController.hasAttribute(_.MEDIA_IS_FULLSCREEN)))return(i=this.mediaController)==null||i.dispatchEvent(new Hi.CustomEvent(X.MEDIA_EXIT_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((e,t)=>{var s;(s=this.mediaController)==null||s.addEventListener(fs.MEDIA_IS_FULLSCREEN,()=>e(),{once:!0})})}get preferCmcd(){var i;return(i=this.getAttribute(w.PREFER_CMCD))!=null?i:void 0}set preferCmcd(i){i!==this.preferCmcd&&(i?xd.includes(i)?this.setAttribute(w.PREFER_CMCD,i):ls(`Invalid value for preferCmcd. Must be one of ${xd.join()}`):this.removeAttribute(w.PREFER_CMCD))}get hasPlayed(){var i,e;return(e=(i=this.mediaController)==null?void 0:i.hasAttribute(_.MEDIA_HAS_PLAYED))!=null?e:!1}get inLiveWindow(){var i;return(i=this.mediaController)==null?void 0:i.hasAttribute(_.MEDIA_TIME_IS_LIVE)}get _hls(){var i;return(i=this.media)==null?void 0:i._hls}get mux(){var i;return(i=this.media)==null?void 0:i.mux}get theme(){var i;return(i=this.getAttribute(O.THEME))!=null?i:FP}set theme(i){this.setAttribute(O.THEME,`${i}`)}get themeProps(){let i=this.mediaTheme;if(!i)return;let e={};for(let t of i.getAttributeNames()){if(hf.includes(t))continue;let s=i.getAttribute(t);e[Pb(t)]=s===""?!0:s}return e}set themeProps(i){var e,t;Je(this,Ve,Ds).call(this);let s={...this.themeProps,...i};for(let r in s){if(hf.includes(r))continue;let n=i?.[r];typeof n=="boolean"||n==null?(e=this.mediaTheme)==null||e.toggleAttribute(uf(r),!!n):(t=this.mediaTheme)==null||t.setAttribute(uf(r),n)}}get playbackId(){var i;return(i=this.getAttribute(w.PLAYBACK_ID))!=null?i:void 0}set playbackId(i){i?this.setAttribute(w.PLAYBACK_ID,i):this.removeAttribute(w.PLAYBACK_ID)}get src(){var i,e;return this.playbackId?(i=Xs(this,rs.SRC))!=null?i:void 0:(e=this.getAttribute(rs.SRC))!=null?e:void 0}set src(i){i?this.setAttribute(rs.SRC,i):this.removeAttribute(rs.SRC)}get poster(){var i;let e=this.getAttribute(rs.POSTER);if(e!=null)return e;let{tokens:t}=this;if(t.playback&&!t.thumbnail){ls("Missing expected thumbnail token. No poster image will be shown");return}if(this.playbackId&&!this.audio)return oP(this.playbackId,{customDomain:this.customDomain,thumbnailTime:(i=this.thumbnailTime)!=null?i:this.startTime,programTime:this.programStartTime,token:t.thumbnail})}set poster(i){i||i===""?this.setAttribute(rs.POSTER,i):this.removeAttribute(rs.POSTER)}get storyboardSrc(){var i;return(i=this.getAttribute(O.STORYBOARD_SRC))!=null?i:void 0}set storyboardSrc(i){i?this.setAttribute(O.STORYBOARD_SRC,i):this.removeAttribute(O.STORYBOARD_SRC)}get storyboard(){let{tokens:i}=this;if(this.storyboardSrc&&!i.storyboard)return this.storyboardSrc;if(!(this.audio||!this.playbackId||!this.streamType||[Se.LIVE,Se.UNKNOWN].includes(this.streamType)||i.playback&&!i.storyboard))return lP(this.playbackId,{customDomain:this.customDomain,token:i.storyboard,programStartTime:this.programStartTime,programEndTime:this.programEndTime})}get audio(){return this.hasAttribute(O.AUDIO)}set audio(i){if(!i){this.removeAttribute(O.AUDIO);return}this.setAttribute(O.AUDIO,"")}get hotkeys(){return Ie(this,hd)}get nohotkeys(){return this.hasAttribute(O.NOHOTKEYS)}set nohotkeys(i){if(!i){this.removeAttribute(O.NOHOTKEYS);return}this.setAttribute(O.NOHOTKEYS,"")}get thumbnailTime(){return Ht(this.getAttribute(O.THUMBNAIL_TIME))}set thumbnailTime(i){this.setAttribute(O.THUMBNAIL_TIME,`${i}`)}get videoTitle(){var i,e;return(e=(i=this.getAttribute(O.VIDEO_TITLE))!=null?i:this.getAttribute(O.TITLE))!=null?e:""}set videoTitle(i){i!==this.videoTitle&&(i?this.setAttribute(O.VIDEO_TITLE,i):this.removeAttribute(O.VIDEO_TITLE))}get placeholder(){var i;return(i=Xs(this,O.PLACEHOLDER))!=null?i:""}set placeholder(i){this.setAttribute(O.PLACEHOLDER,`${i}`)}get primaryColor(){var i,e;let t=this.getAttribute(O.PRIMARY_COLOR);if(t!=null||this.mediaTheme&&(t=(e=(i=Hi.getComputedStyle(this.mediaTheme))==null?void 0:i.getPropertyValue("--_primary-color"))==null?void 0:e.trim(),t))return t}set primaryColor(i){this.setAttribute(O.PRIMARY_COLOR,`${i}`)}get secondaryColor(){var i,e;let t=this.getAttribute(O.SECONDARY_COLOR);if(t!=null||this.mediaTheme&&(t=(e=(i=Hi.getComputedStyle(this.mediaTheme))==null?void 0:i.getPropertyValue("--_secondary-color"))==null?void 0:e.trim(),t))return t}set secondaryColor(i){this.setAttribute(O.SECONDARY_COLOR,`${i}`)}get accentColor(){var i,e;let t=this.getAttribute(O.ACCENT_COLOR);if(t!=null||this.mediaTheme&&(t=(e=(i=Hi.getComputedStyle(this.mediaTheme))==null?void 0:i.getPropertyValue("--_accent-color"))==null?void 0:e.trim(),t))return t}set accentColor(i){this.setAttribute(O.ACCENT_COLOR,`${i}`)}get defaultShowRemainingTime(){return this.hasAttribute(O.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(i){i?this.setAttribute(O.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(O.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(this.hasAttribute(O.PLAYBACK_RATES))return this.getAttribute(O.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(i=>Number(i)).filter(i=>!Number.isNaN(i)).sort((i,e)=>i-e)}set playbackRates(i){if(!i){this.removeAttribute(O.PLAYBACK_RATES);return}this.setAttribute(O.PLAYBACK_RATES,i.join(" "))}get forwardSeekOffset(){var i;return(i=Ht(this.getAttribute(O.FORWARD_SEEK_OFFSET)))!=null?i:10}set forwardSeekOffset(i){this.setAttribute(O.FORWARD_SEEK_OFFSET,`${i}`)}get backwardSeekOffset(){var i;return(i=Ht(this.getAttribute(O.BACKWARD_SEEK_OFFSET)))!=null?i:10}set backwardSeekOffset(i){this.setAttribute(O.BACKWARD_SEEK_OFFSET,`${i}`)}get defaultHiddenCaptions(){return this.hasAttribute(O.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(i){i?this.setAttribute(O.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(O.DEFAULT_HIDDEN_CAPTIONS)}get defaultDuration(){return Ht(this.getAttribute(O.DEFAULT_DURATION))}set defaultDuration(i){i==null?this.removeAttribute(O.DEFAULT_DURATION):this.setAttribute(O.DEFAULT_DURATION,`${i}`)}get playerInitTime(){return this.hasAttribute(w.PLAYER_INIT_TIME)?Ht(this.getAttribute(w.PLAYER_INIT_TIME)):Ie(this,dd)}set playerInitTime(i){i!=this.playerInitTime&&(i==null?this.removeAttribute(w.PLAYER_INIT_TIME):this.setAttribute(w.PLAYER_INIT_TIME,`${+i}`))}get playerSoftwareName(){var i;return(i=this.getAttribute(w.PLAYER_SOFTWARE_NAME))!=null?i:J0}get playerSoftwareVersion(){var i;return(i=this.getAttribute(w.PLAYER_SOFTWARE_VERSION))!=null?i:Z0}get beaconCollectionDomain(){var i;return(i=this.getAttribute(w.BEACON_COLLECTION_DOMAIN))!=null?i:void 0}set beaconCollectionDomain(i){i!==this.beaconCollectionDomain&&(i?this.setAttribute(w.BEACON_COLLECTION_DOMAIN,i):this.removeAttribute(w.BEACON_COLLECTION_DOMAIN))}get maxResolution(){var i;return(i=this.getAttribute(w.MAX_RESOLUTION))!=null?i:void 0}set maxResolution(i){i!==this.maxResolution&&(i?this.setAttribute(w.MAX_RESOLUTION,i):this.removeAttribute(w.MAX_RESOLUTION))}get minResolution(){var i;return(i=this.getAttribute(w.MIN_RESOLUTION))!=null?i:void 0}set minResolution(i){i!==this.minResolution&&(i?this.setAttribute(w.MIN_RESOLUTION,i):this.removeAttribute(w.MIN_RESOLUTION))}get renditionOrder(){var i;return(i=this.getAttribute(w.RENDITION_ORDER))!=null?i:void 0}set renditionOrder(i){i!==this.renditionOrder&&(i?this.setAttribute(w.RENDITION_ORDER,i):this.removeAttribute(w.RENDITION_ORDER))}get programStartTime(){return Ht(this.getAttribute(w.PROGRAM_START_TIME))}set programStartTime(i){i==null?this.removeAttribute(w.PROGRAM_START_TIME):this.setAttribute(w.PROGRAM_START_TIME,`${i}`)}get programEndTime(){return Ht(this.getAttribute(w.PROGRAM_END_TIME))}set programEndTime(i){i==null?this.removeAttribute(w.PROGRAM_END_TIME):this.setAttribute(w.PROGRAM_END_TIME,`${i}`)}get assetStartTime(){return Ht(this.getAttribute(w.ASSET_START_TIME))}set assetStartTime(i){i==null?this.removeAttribute(w.ASSET_START_TIME):this.setAttribute(w.ASSET_START_TIME,`${i}`)}get assetEndTime(){return Ht(this.getAttribute(w.ASSET_END_TIME))}set assetEndTime(i){i==null?this.removeAttribute(w.ASSET_END_TIME):this.setAttribute(w.ASSET_END_TIME,`${i}`)}get extraSourceParams(){return this.hasAttribute(O.EXTRA_SOURCE_PARAMS)?[...new URLSearchParams(this.getAttribute(O.EXTRA_SOURCE_PARAMS)).entries()].reduce((i,[e,t])=>(i[e]=t,i),{}):YP}set extraSourceParams(i){i==null?this.removeAttribute(O.EXTRA_SOURCE_PARAMS):this.setAttribute(O.EXTRA_SOURCE_PARAMS,new URLSearchParams(i).toString())}get customDomain(){var i;return(i=this.getAttribute(w.CUSTOM_DOMAIN))!=null?i:void 0}set customDomain(i){i!==this.customDomain&&(i?this.setAttribute(w.CUSTOM_DOMAIN,i):this.removeAttribute(w.CUSTOM_DOMAIN))}get envKey(){var i;return(i=Xs(this,w.ENV_KEY))!=null?i:void 0}set envKey(i){this.setAttribute(w.ENV_KEY,`${i}`)}get noVolumePref(){return this.hasAttribute(O.NO_VOLUME_PREF)}set noVolumePref(i){i?this.setAttribute(O.NO_VOLUME_PREF,""):this.removeAttribute(O.NO_VOLUME_PREF)}get noMutedPref(){return this.hasAttribute(O.NO_MUTED_PREF)}set noMutedPref(i){i?this.setAttribute(O.NO_MUTED_PREF,""):this.removeAttribute(O.NO_MUTED_PREF)}get debug(){return Xs(this,w.DEBUG)!=null}set debug(i){i?this.setAttribute(w.DEBUG,""):this.removeAttribute(w.DEBUG)}get disableTracking(){return Xs(this,w.DISABLE_TRACKING)!=null}set disableTracking(i){this.toggleAttribute(w.DISABLE_TRACKING,!!i)}get disableCookies(){return Xs(this,w.DISABLE_COOKIES)!=null}set disableCookies(i){i?this.setAttribute(w.DISABLE_COOKIES,""):this.removeAttribute(w.DISABLE_COOKIES)}get streamType(){var i,e,t;return(t=(e=this.getAttribute(w.STREAM_TYPE))!=null?e:(i=this.media)==null?void 0:i.streamType)!=null?t:Se.UNKNOWN}set streamType(i){this.setAttribute(w.STREAM_TYPE,`${i}`)}get defaultStreamType(){var i,e,t;return(t=(e=this.getAttribute(O.DEFAULT_STREAM_TYPE))!=null?e:(i=this.mediaController)==null?void 0:i.getAttribute(O.DEFAULT_STREAM_TYPE))!=null?t:Se.ON_DEMAND}set defaultStreamType(i){i?this.setAttribute(O.DEFAULT_STREAM_TYPE,i):this.removeAttribute(O.DEFAULT_STREAM_TYPE)}get targetLiveWindow(){var i,e;return this.hasAttribute(O.TARGET_LIVE_WINDOW)?+this.getAttribute(O.TARGET_LIVE_WINDOW):(e=(i=this.media)==null?void 0:i.targetLiveWindow)!=null?e:Number.NaN}set targetLiveWindow(i){i==this.targetLiveWindow||Number.isNaN(i)&&Number.isNaN(this.targetLiveWindow)||(i==null?this.removeAttribute(O.TARGET_LIVE_WINDOW):this.setAttribute(O.TARGET_LIVE_WINDOW,`${+i}`))}get liveEdgeStart(){var i;return(i=this.media)==null?void 0:i.liveEdgeStart}get startTime(){return Ht(Xs(this,w.START_TIME))}set startTime(i){this.setAttribute(w.START_TIME,`${i}`)}get preferPlayback(){let i=this.getAttribute(w.PREFER_PLAYBACK);if(i===Vi.MSE||i===Vi.NATIVE)return i}set preferPlayback(i){i!==this.preferPlayback&&(i===Vi.MSE||i===Vi.NATIVE?this.setAttribute(w.PREFER_PLAYBACK,i):this.removeAttribute(w.PREFER_PLAYBACK))}get metadata(){var i;return(i=this.media)==null?void 0:i.metadata}set metadata(i){if(Je(this,Ve,Ds).call(this),!this.media){Jt("underlying media element missing when trying to set metadata. metadata will not be set.");return}this.media.metadata={...X0(this),...i}}get _hlsConfig(){var i;return(i=this.media)==null?void 0:i._hlsConfig}set _hlsConfig(i){if(Je(this,Ve,Ds).call(this),!this.media){Jt("underlying media element missing when trying to set _hlsConfig. _hlsConfig will not be set.");return}this.media._hlsConfig=i}async addCuePoints(i){var e;if(Je(this,Ve,Ds).call(this),!this.media){Jt("underlying media element missing when trying to addCuePoints. cuePoints will not be added.");return}return(e=this.media)==null?void 0:e.addCuePoints(i)}get activeCuePoint(){var i;return(i=this.media)==null?void 0:i.activeCuePoint}get cuePoints(){var i,e;return(e=(i=this.media)==null?void 0:i.cuePoints)!=null?e:[]}addChapters(i){var e;if(Je(this,Ve,Ds).call(this),!this.media){Jt("underlying media element missing when trying to addChapters. chapters will not be added.");return}return(e=this.media)==null?void 0:e.addChapters(i)}get activeChapter(){var i;return(i=this.media)==null?void 0:i.activeChapter}get chapters(){var i,e;return(e=(i=this.media)==null?void 0:i.chapters)!=null?e:[]}getStartDate(){var i;return(i=this.media)==null?void 0:i.getStartDate()}get currentPdt(){var i;return(i=this.media)==null?void 0:i.currentPdt}get tokens(){let i=this.getAttribute(O.PLAYBACK_TOKEN),e=this.getAttribute(O.DRM_TOKEN),t=this.getAttribute(O.THUMBNAIL_TOKEN),s=this.getAttribute(O.STORYBOARD_TOKEN);return{...Ie(this,cd),...i!=null?{playback:i}:{},...e!=null?{drm:e}:{},...t!=null?{thumbnail:t}:{},...s!=null?{storyboard:s}:{}}}set tokens(i){ji(this,cd,i??{})}get playbackToken(){var i;return(i=this.getAttribute(O.PLAYBACK_TOKEN))!=null?i:void 0}set playbackToken(i){this.setAttribute(O.PLAYBACK_TOKEN,`${i}`)}get drmToken(){var i;return(i=this.getAttribute(O.DRM_TOKEN))!=null?i:void 0}set drmToken(i){this.setAttribute(O.DRM_TOKEN,`${i}`)}get thumbnailToken(){var i;return(i=this.getAttribute(O.THUMBNAIL_TOKEN))!=null?i:void 0}set thumbnailToken(i){this.setAttribute(O.THUMBNAIL_TOKEN,`${i}`)}get storyboardToken(){var i;return(i=this.getAttribute(O.STORYBOARD_TOKEN))!=null?i:void 0}set storyboardToken(i){this.setAttribute(O.STORYBOARD_TOKEN,`${i}`)}addTextTrack(i,e,t,s){var r;let n=(r=this.media)==null?void 0:r.nativeEl;if(n)return Vf(n,i,e,t,s)}removeTextTrack(i){var e;let t=(e=this.media)==null?void 0:e.nativeEl;if(t)return Cx(t,i)}get textTracks(){var i;return(i=this.media)==null?void 0:i.textTracks}get castReceiver(){var i;return(i=this.getAttribute(O.CAST_RECEIVER))!=null?i:void 0}set castReceiver(i){i!==this.castReceiver&&(i?this.setAttribute(O.CAST_RECEIVER,i):this.removeAttribute(O.CAST_RECEIVER))}get castCustomData(){var i;return(i=this.media)==null?void 0:i.castCustomData}set castCustomData(i){if(!this.media){Jt("underlying media element missing when trying to set castCustomData. castCustomData will not be set.");return}this.media.castCustomData=i}get noTooltips(){return this.hasAttribute(O.NO_TOOLTIPS)}set noTooltips(i){if(!i){this.removeAttribute(O.NO_TOOLTIPS);return}this.setAttribute(O.NO_TOOLTIPS,"")}get proudlyDisplayMuxBadge(){return this.hasAttribute(O.PROUDLY_DISPLAY_MUX_BADGE)}set proudlyDisplayMuxBadge(i){i?this.setAttribute(O.PROUDLY_DISPLAY_MUX_BADGE,""):this.removeAttribute(O.PROUDLY_DISPLAY_MUX_BADGE)}};dd=new WeakMap,ud=new WeakMap,cd=new WeakMap,ar=new WeakMap,hd=new WeakMap,Rn=new WeakMap,Ve=new WeakSet,Ds=function(){var i,e,t,s;if(!Ie(this,ud)){ji(this,ud,!0),Je(this,Ve,or).call(this);try{if(customElements.upgrade(this.mediaTheme),!(this.mediaTheme instanceof Hi.HTMLElement))throw""}catch{Jt("<media-theme> failed to upgrade!")}try{customElements.upgrade(this.media)}catch{Jt("underlying media element failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof yC))throw""}catch{Jt("<media-controller> failed to upgrade!")}Je(this,Ve,tv).call(this),Je(this,Ve,iv).call(this),Je(this,Ve,sv).call(this),ji(this,ar,(e=(i=this.mediaController)==null?void 0:i.hasAttribute(se.USER_INACTIVE))!=null?e:!0),Je(this,Ve,rv).call(this),(t=this.media)==null||t.addEventListener("streamtypechange",()=>Je(this,Ve,or).call(this)),(s=this.media)==null||s.addEventListener("loadstart",()=>Je(this,Ve,or).call(this))}},Wb=function(){var i,e;try{(i=window?.CSS)==null||i.registerProperty({name:"--media-primary-color",syntax:"<color>",inherits:!0}),(e=window?.CSS)==null||e.registerProperty({name:"--media-secondary-color",syntax:"<color>",inherits:!0})}catch{}},ff=function(i){Object.assign(Ie(this,Rn),i),Je(this,Ve,or).call(this)},or=function(i={}){RP(kP(BP(this,{...Ie(this,Rn),...i})),this.shadowRoot)},tv=function(){let i=e=>{var t,s;if(!(e!=null&&e.startsWith("theme-")))return;let r=e.replace(/^theme-/,"");if(hf.includes(r))return;let n=this.getAttribute(e);n!=null?(t=this.mediaTheme)==null||t.setAttribute(r,n):(s=this.mediaTheme)==null||s.removeAttribute(r)};new MutationObserver(e=>{for(let{attributeName:t}of e)i(t)}).observe(this,{attributes:!0}),this.getAttributeNames().forEach(i)},iv=function(){let i=e=>{var t;let s=(t=this.media)==null?void 0:t.error;if(!(s instanceof z)){let{message:n,code:a}=s??{};s=new z(n,a)}if(!(s!=null&&s.fatal)){ls(s),s.data&&ls(`${s.name} data:`,s.data);return}let r=j0(s);r.message&&Bb(r),Jt(s),s.data&&Jt(`${s.name} data:`,s.data),Je(this,Ve,ff).call(this,{isDialogOpen:!0})};this.addEventListener("error",i),this.media&&(this.media.errorTranslator=(e={})=>{var t,s,r;if(!(((t=this.media)==null?void 0:t.error)instanceof z))return e;let n=j0((s=this.media)==null?void 0:s.error);return{player_error_code:(r=this.media)==null?void 0:r.error.code,player_error_message:n.message?String(n.message):e.player_error_message,player_error_context:n.context?String(n.context):e.player_error_context}})},sv=function(){var i,e,t,s;let r=()=>Je(this,Ve,or).call(this);(e=(i=this.media)==null?void 0:i.textTracks)==null||e.addEventListener("addtrack",r),(s=(t=this.media)==null?void 0:t.textTracks)==null||s.addEventListener("removetrack",r)},rv=function(){var i,e;if(!/Firefox/i.test(navigator.userAgent))return;let t,s=new WeakMap,r=()=>this.streamType===Se.LIVE&&!this.secondaryColor&&this.offsetWidth>=800,n=(l,d,u=!1)=>{r()||Array.from(l&&l.activeCues||[]).forEach(c=>{if(!(!c.snapToLines||c.line<-5||c.line>=0&&c.line<10))if(!d||this.paused){let h=c.text.split(`
`).length,f=-3;this.streamType===Se.LIVE&&(f=-2);let m=f-h;if(c.line===m&&!u)return;s.has(c)||s.set(c,c.line),c.line=m}else setTimeout(()=>{c.line=s.get(c)||"auto"},500)})},a=()=>{var l,d;n(t,(d=(l=this.mediaController)==null?void 0:l.hasAttribute(se.USER_INACTIVE))!=null?d:!1)},o=()=>{var l,d;let u=Array.from(((d=(l=this.mediaController)==null?void 0:l.media)==null?void 0:d.textTracks)||[]).filter(c=>["subtitles","captions"].includes(c.kind)&&c.mode==="showing")[0];u!==t&&t?.removeEventListener("cuechange",a),t=u,t?.addEventListener("cuechange",a),n(t,Ie(this,ar))};o(),(i=this.textTracks)==null||i.addEventListener("change",o),(e=this.textTracks)==null||e.addEventListener("addtrack",o),this.addEventListener("userinactivechange",()=>{var l,d;let u=(d=(l=this.mediaController)==null?void 0:l.hasAttribute(se.USER_INACTIVE))!=null?d:!0;Ie(this,ar)!==u&&(ji(this,ar,u),n(t,Ie(this,ar)))})};function Xs(i,e){return i.media?i.media.getAttribute(e):i.getAttribute(e)}var nv=jP,qb=class{addEventListener(){}removeEventListener(){}dispatchEvent(i){return!0}};if(typeof DocumentFragment>"u"){class i extends qb{}globalThis.DocumentFragment=i}var zP=class extends qb{},QP={get(i){},define(i,e,t){},getName(i){return null},upgrade(i){},whenDefined(i){return Promise.resolve(zP)}},XP={customElements:QP},ZP=typeof window>"u"||typeof globalThis.customElements>"u",_c=ZP?XP:globalThis;_c.customElements.get("mux-player")||(_c.customElements.define("mux-player",nv),_c.MuxPlayerElement=nv);var Yb=parseInt(Ua.version)>=19,av={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox",playsInline:"playsinline",autoPlay:"autoplay",playbackRate:"playbackrate"},JP=i=>i==null,eO=(i,e)=>JP(e)?!1:i in e,tO=i=>i.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),iO=(i,e)=>{if(!(!Yb&&typeof e=="boolean"&&!e)){if(eO(i,av))return av[i];if(typeof e<"u")return/[A-Z]/.test(i)?tO(i):i}},sO=(i,e)=>!Yb&&typeof i=="boolean"?"":i,rO=(i={})=>{let{ref:e,...t}=i;return Object.entries(t).reduce((s,[r,n])=>{let a=iO(r,n);if(!a)return s;let o=sO(n);return s[a]=o,s},{})};function ov(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function nO(...i){return e=>{let t=!1,s=i.map(r=>{let n=ov(r,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let r=0;r<s.length;r++){let n=s[r];typeof n=="function"?n():ov(i[r],null)}}}}function aO(...i){return $a.useCallback(nO(...i),i)}var oO=Object.prototype.hasOwnProperty,lO=(i,e)=>{if(Object.is(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;if(Array.isArray(i))return!Array.isArray(e)||i.length!==e.length?!1:i.some((r,n)=>e[n]===r);let t=Object.keys(i),s=Object.keys(e);if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(!oO.call(e,t[r])||!Object.is(i[t[r]],e[t[r]]))return!1;return!0},jb=(i,e,t)=>!lO(e,i[t]),dO=(i,e,t)=>{i[t]=e},uO=(i,e,t,s=dO,r=jb)=>$a.useEffect(()=>{let n=t?.current;n&&r(n,e,i)&&s(n,e,i)},[t?.current,e]),Li=uO,cO=()=>{try{return"3.8.0"}catch{}return"UNKNOWN"},hO=cO(),fO=()=>hO,$e=(i,e,t)=>$a.useEffect(()=>{let s=e?.current;if(!s||!t)return;let r=i,n=t;return s.addEventListener(r,n),()=>{s.removeEventListener(r,n)}},[e?.current,t,i]),mO=Ua.forwardRef(({children:i,...e},t)=>Ua.createElement("mux-player",{suppressHydrationWarning:!0,...rO(e),ref:t},i)),pO=(i,e)=>{let{onAbort:t,onCanPlay:s,onCanPlayThrough:r,onEmptied:n,onLoadStart:a,onLoadedData:o,onLoadedMetadata:l,onProgress:d,onDurationChange:u,onVolumeChange:c,onRateChange:h,onResize:f,onWaiting:m,onPlay:g,onPlaying:p,onTimeUpdate:E,onPause:T,onSeeking:y,onSeeked:b,onStalled:A,onSuspend:L,onEnded:S,onError:R,onCuePointChange:x,onChapterChange:I,metadata:M,tokens:$,paused:V,playbackId:q,playbackRates:H,currentTime:N,themeProps:W,extraSourceParams:B,castCustomData:Y,_hlsConfig:ee,...U}=e;return Li("tokens",$,i),Li("playbackId",q,i),Li("playbackRates",H,i),Li("metadata",M,i),Li("extraSourceParams",B,i),Li("_hlsConfig",ee,i),Li("themeProps",W,i),Li("castCustomData",Y,i),Li("paused",V,i,(F,ne)=>{ne!=null&&(ne?F.pause():F.play())},(F,ne,pe)=>F.hasAttribute("autoplay")&&!F.hasPlayed?!1:jb(F,ne,pe)),Li("currentTime",N,i,(F,ne)=>{ne!=null&&(F.currentTime=ne)}),$e("abort",i,t),$e("canplay",i,s),$e("canplaythrough",i,r),$e("emptied",i,n),$e("loadstart",i,a),$e("loadeddata",i,o),$e("loadedmetadata",i,l),$e("progress",i,d),$e("durationchange",i,u),$e("volumechange",i,c),$e("ratechange",i,h),$e("resize",i,f),$e("waiting",i,m),$e("play",i,g),$e("playing",i,p),$e("timeupdate",i,E),$e("pause",i,T),$e("seeking",i,y),$e("seeked",i,b),$e("stalled",i,A),$e("suspend",i,L),$e("ended",i,S),$e("error",i,R),$e("cuepointchange",i,x),$e("chapterchange",i,I),[U]},gO=fO(),vO="mux-player-react",EO=Ua.forwardRef((i,e)=>{var t;let s=$a.useRef(null),r=aO(s,e),[n]=pO(s,i),[a]=$a.useState((t=i.playerInitTime)!=null?t:jf());return Ua.createElement(mO,{ref:r,defaultHiddenCaptions:i.defaultHiddenCaptions,playerSoftwareName:vO,playerSoftwareVersion:gO,playerInitTime:a,...n})}),yO=EO;function $O(i){const e=zb.c(5),{customDomain:t,playbackId:s,tokens:r}=i;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={position:"absolute",inset:0},e[0]=n):n=e[0];let a;return e[1]!==t||e[2]!==s||e[3]!==r?(a=Qb.jsx(yO,{customDomain:t,theme:"sutro",playbackId:s,tokens:r,autoPlay:!1,loop:!1,style:n}),e[1]=t,e[2]=s,e[3]=r,e[4]=a):a=e[4],a}export{$O as VideoPlayer};
</file>

<file path="betternotes/dist/static/ViteDevServerStopped-fNCvrPMG.js">
import{d as a,j as o,C as d,b as m,S as l,T as h,r as p,H as u}from"./sanity-z2y04qld.js";const S="Dev server stopped",f="The development server has stopped. You may need to restart it to continue working.";class x extends Error{constructor(){super(S),this.name="ViteDevServerStoppedError",this.ViteDevServerStoppedError=!0}}const _=e=>!1,E=()=>{const e=a.c(5),[r,s]=p.useState(!1);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=()=>s(!0),e[0]=t):t=e[0];const v=t;let n,c;e[1]===Symbol.for("react.memo_cache_sentinel")?(n=()=>{},c=[v],e[1]=n,e[2]=c):(n=e[1],c=e[2]),p.useEffect(n,c);let i;return e[3]!==r?(i={devServerStopped:r},e[3]=r,e[4]=i):i=e[4],i},D=()=>{const{devServerStopped:e}=E();if(e)throw new x;return null},b=()=>{const e=a.c(1);let r;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=_()?o.jsx(D,{}):null,e[0]=r):r=e[0],r},R=()=>{const e=a.c(3);let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=[4,5,6,7],e[0]=r):r=e[0];let s;e[1]===Symbol.for("react.memo_cache_sentinel")?(s=o.jsx(u,{children:S}),e[1]=s):s=e[1];let t;return e[2]===Symbol.for("react.memo_cache_sentinel")?(t=o.jsx(d,{height:"fill",overflow:"auto",paddingY:r,paddingX:4,sizing:"border",tone:"critical",children:o.jsx(m,{width:3,children:o.jsxs(l,{space:4,children:[s,o.jsx(d,{border:!0,radius:2,overflow:"auto",padding:4,tone:"inherit",children:o.jsx(l,{space:4,children:o.jsx(h,{size:2,children:f})})})]})})}),e[2]=t):t=e[2],t};export{b as DetectViteDevServerStopped,R as DevServerStoppedErrorScreen,x as ViteDevServerStoppedError};
</file>

<file path="betternotes/dist/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="betternotes/dist/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="betternotes/dist/index.html">
<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/><meta name="robots" content="noindex"/><meta name="referrer" content="same-origin"/><link rel="icon" href="/static/favicon.ico" sizes="any"/><link rel="icon" href="/static/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/static/apple-touch-icon.png"/><link rel="manifest" href="/static/manifest.webmanifest"/><title>Sanity Studio</title><script>
;(function () {
  // The error channel is provided so that error handling can be delegated to a view component.
  // If there is a subscriber to the error channel at the time the error happens, the error will be pushed to the subscriber instead of handled here.
  var errorChannel = (function () {
    var subscribers = Object.create(null)
    var nextId = 0
    function subscribe(subscriber) {
      var id = nextId++
      subscribers[id] = subscriber
      return function unsubscribe() {
        delete subscribers[id]
      }
    }

    function publish(event) {
      for (var id in subscribers) {
        if (Object.hasOwn(subscribers, id)) {
          subscribers[id](event)
        }
      }
    }
    return {
      subscribers,
      publish,
      subscribe
    }
  })()

  // NOTE: Store the error channel instance in the global scope so that the Studio application can
  // access it and subscribe to errors.
  window.__sanityErrorChannel = {
    subscribe: errorChannel.subscribe
  }

  function _handleError(event) {
    // If there are error channel subscribers, then we assume they will own error rendering,
    // and we defer to them (no console error).
    if (Object.keys(errorChannel.subscribers).length > 0) {
      errorChannel.publish(event)
    } else {
      _renderErrorOverlay(event)
    }
  }

  var ERROR_BOX_STYLE = [
    'background: #fff',
    'border-radius: 6px',
    'box-sizing: border-box',
    'color: #121923',
    'flex: 1',
    "font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','Liberation Sans',Helvetica,Arial,system-ui,sans-serif",
    'font-size: 16px',
    'line-height: 21px',
    'margin: 0 auto',
    'max-width: 960px',
    'max-height: 90dvh',
    'overflow: auto',
    'padding: 20px',
    'width: 100%',
  ].join(';')

  var ERROR_CODE_STYLE = [
    'color: #972E2A',
    "font-family: -apple-system-ui-monospace, 'SF Mono', Menlo, Monaco, Consolas, monospace",
    'font-size: 13px',
    'line-height: 17px',
    'margin: 0',
  ].join(';')

  function _renderErrorOverlay(event) {
    var errorElement = document.querySelector('#__sanityError') || document.createElement('div')
    var error = event.error
    var colno = event.colno
    var lineno = event.lineno
    var filename = event.filename

    errorElement.id = '__sanityError'
    errorElement.innerHTML = [
      '<div style="' + ERROR_BOX_STYLE + '">',
      '<div style="font-weight: 700;">Uncaught error: ' + error.message + '</div>',
      '<div style="color: #515E72; font-size: 13px; line-height: 17px; margin: 10px 0;">' +
        filename +
        ':' +
        lineno +
        ':' +
        colno +
        '</div>',
      '<pre style="' + ERROR_CODE_STYLE + '">' + error.stack + '</pre>',
      '</div>',
    ].join('')

    errorElement.style.position = 'fixed'
    errorElement.style.zIndex = 1000000
    errorElement.style.top = 0
    errorElement.style.left = 0
    errorElement.style.right = 0
    errorElement.style.bottom = 0
    errorElement.style.padding = '20px'
    errorElement.style.background = 'rgba(16,17,18,0.66)'
    errorElement.style.display = 'flex'
    errorElement.style.alignItems = 'center'
    errorElement.style.justifyContent = 'center'

    document.body.appendChild(errorElement)
  }

  // Error listener
  window.addEventListener('error', (event) => {
    _handleError({
      type: 'error',
      error: event.error,
      lineno: event.lineno,
      colno: event.colno,
      filename: event.filename
    })
  })

  // Error listener
  window.addEventListener('unhandledrejection', (event) => {
    _handleError({
      type: 'rejection',
      error: event.reason
    })
  })
})()
</script><style>
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Regular.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 400;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Italic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 500;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Medium.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 500;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-MediumItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 600;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-SemiBold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 600;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-SemiBoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 700;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Bold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 700;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-BoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 800;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-ExtraBold.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 800;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-ExtraBoldItalic.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: normal;
    font-weight: 900;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-Black.woff2") format("woff2");
  }
  @font-face {
    font-family: Inter;
    font-style: italic;
    font-weight: 900;
    font-display: swap;
    src: url("https://studio-static.sanity.io/Inter-BlackItalic.woff2") format("woff2");
  }
  html {
    @media (prefers-color-scheme: dark) {
      background-color: #13141b;
    }
    @media (prefers-color-scheme: light) {
      background-color: #ffffff;
    }
  }
  html,
  body,
  #sanity {
    height: 100%;
  }
  body {
    margin: 0;
    -webkit-font-smoothing: antialiased;
  }
</style><script src="https://core.sanity-cdn.com/bridge.js" async type="module" data-sanity-core></script>
</head><body><div id="sanity"></div><script type="module" src="/static/sanity-z2y04qld.js"></script><noscript><div class="sanity-app-no-js__root"><div class="sanity-app-no-js__content"><style type="text/css">
.sanity-app-no-js__root {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  background: #fff;
}

.sanity-app-no-js__content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  font-family: helvetica, arial, sans-serif;
}
</style><h1>JavaScript disabled</h1><p>Please <a href="https://www.enable-javascript.com/">enable JavaScript</a> in your browser and reload the page to proceed.</p></div></div></noscript></body></html>
</file>

<file path="betternotes/dist/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="betternotes/dist/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="betternotes/dist/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="betternotes/lib/sanity/api.ts">
import { client } from './client';
import { Note, DiscountCode, NoteFilters } from '@/types';

// Get all notes with optional filtering
export async function getNotes(filters?: NoteFilters): Promise<Note[]> {
  let query = `*[_type == "note"`;
  
  if (filters) {
    const conditions = [];
    
    if (filters.academicYear) {
      conditions.push(`academicYear == "${filters.academicYear}"`);
    }
    
    if (filters.subject) {
      conditions.push(`subject == "${filters.subject}"`);
    }
    
    if (filters.priceRange) {
      conditions.push(`price >= ${filters.priceRange.min} && price <= ${filters.priceRange.max}`);
    }
    
    if (filters.search) {
      conditions.push(`title match "${filters.search}*" || description match "${filters.search}*"`);
    }
    
    if (conditions.length > 0) {
      query += ` && ${conditions.join(' && ')}`;
    }
  }
  
  query += `] | order(createdAt desc) {
    _id,
    title,
    "slug": slug.current,
    description,
    price,
    originalPrice,
    coverImage,
    images[]{
      _key,
      _type,
      asset->{
        _id,
        _type,
        url,
        metadata
      }
    },
    academicYear,
    subject,
    tags,
    featured,
    createdAt,
    updatedAt
  }`;
  
  return await client.fetch(query);
}

// Get featured notes
export async function getFeaturedNotes(): Promise<Note[]> {
  const query = `*[_type == "note" && featured == true] | order(createdAt desc) {
    _id,
    title,
    "slug": slug.current,
    description,
    price,
    originalPrice,
    coverImage,
    images[]{
      _key,
      _type,
      asset->{
        _id,
        _type,
        url,
        metadata
      }
    },
    academicYear,
    subject,
    tags,
    featured,
    createdAt,
    updatedAt
  }[0...6]`;
  
  return await client.fetch(query);
}

// Get a single note by slug
export async function getNoteBySlug(slug: string): Promise<Note | null> {
  const query = `*[_type == "note" && slug.current == "${slug}"][0] {
    _id,
    title,
    "slug": slug.current,
    description,
    price,
    originalPrice,
    coverImage,
    images[]{
      _key,
      _type,
      asset->{
        _id,
        _type,
        url,
        metadata
      }
    },
    academicYear,
    subject,
    tags,
    featured,
    createdAt,
    updatedAt
  }`;
  
  return await client.fetch(query);
}

// Get all discount codes
export async function getDiscountCodes(): Promise<DiscountCode[]> {
  const query = `*[_type == "discountCode" && isActive == true && validFrom <= now() && validUntil >= now()] | order(validUntil desc) {
    _id,
    code,
    discountPercentage,
    validFrom,
    validUntil,
    isActive,
    usageLimit,
    usedCount
  }`;
  
  return await client.fetch(query);
}

// Validate a discount code
export async function validateDiscountCode(code: string): Promise<DiscountCode | null> {
  const query = `*[_type == "discountCode" && code == "${code}" && isActive == true && validFrom <= now() && validUntil >= now() && (usageLimit == null || usedCount < usageLimit)][0] {
    _id,
    code,
    discountPercentage,
    validFrom,
    validUntil,
    isActive,
    usageLimit,
    usedCount
  }`;
  
  return await client.fetch(query);
}

// Get all unique academic years
export async function getAcademicYears(): Promise<string[]> {
  const query = `*[_type == "note"] | distinct(academicYear)`;
  return await client.fetch(query);
}

// Get all unique subjects
export async function getSubjects(): Promise<string[]> {
  const query = `*[_type == "note"] | distinct(subject)`;
  return await client.fetch(query);
}
</file>

<file path="betternotes/lib/sanity/client.ts">
import { createClient } from 'next-sanity';
import imageUrlBuilder from '@sanity/image-url';

export const client = createClient({
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || '',
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',
  apiVersion: '2024-01-01',
  useCdn: true,
  stega: {
    enabled: process.env.NEXT_PUBLIC_VERCEL_ENV === 'preview',
    studioUrl: '/studio',
  },
});

// Helper function for image URLs
const builder = imageUrlBuilder(client);

export const urlFor = (source: any) => {
  return builder.image(source);
};
</file>

<file path="betternotes/lib/sanity/schema.ts">
// Note schema for Sanity CMS
export const noteSchema = {
  name: 'note',
  title: 'Note',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'Title',
      type: 'string',
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'slug',
      title: 'Slug',
      type: 'slug',
      options: {
        source: 'title',
        maxLength: 96,
      },
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'description',
      title: 'Description',
      type: 'text',
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'price',
      title: 'Price',
      type: 'number',
      validation: (Rule: any) => Rule.required().min(0),
    },
    {
      name: 'originalPrice',
      title: 'Original Price',
      type: 'number',
    },
    {
      name: 'images',
      title: 'Images',
      type: 'array',
      of: [
        {
          type: 'image',
          options: {
            hotspot: true,
          },
          fields: [
            {
              name: 'alt',
              title: 'Alt Text',
              type: 'string',
            },
          ],
        },
      ],
      validation: (Rule: any) => Rule.required().min(1),
    },
    {
      name: 'academicYear',
      title: 'Academic Year',
      type: 'string',
      options: {
        list: [
          { title: 'First Year', value: 'first-year' },
          { title: 'Second Year', value: 'second-year' },
          { title: 'Third Year', value: 'third-year' },
          { title: 'Fourth Year', value: 'fourth-year' },
          { title: 'Fifth Year', value: 'fifth-year' },
        ],
      },
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'subject',
      title: 'Subject',
      type: 'string',
      options: {
        list: [
          { title: 'Anatomy', value: 'anatomy' },
          { title: 'Physiology', value: 'physiology' },
          { title: 'Biochemistry', value: 'biochemistry' },
          { title: 'Pathology', value: 'pathology' },
          { title: 'Pharmacology', value: 'pharmacology' },
          { title: 'Microbiology', value: 'microbiology' },
          { title: 'Forensic Medicine', value: 'forensic-medicine' },
          { title: 'Community Medicine', value: 'community-medicine' },
          { title: 'ENT', value: 'ent' },
          { title: 'Ophthalmology', value: 'ophthalmology' },
          { title: 'Medicine', value: 'medicine' },
          { title: 'Surgery', value: 'surgery' },
          { title: 'Obstetrics & Gynecology', value: 'obgyn' },
          { title: 'Pediatrics', value: 'pediatrics' },
          { title: 'Orthopedics', value: 'orthopedics' },
          { title: 'Dermatology', value: 'dermatology' },
          { title: 'Psychiatry', value: 'psychiatry' },
          { title: 'Radiology', value: 'radiology' },
          { title: 'Anesthesiology', value: 'anesthesiology' },
        ],
      },
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'coverImage',
      title: 'Cover Image',
      type: 'image',
      options: {
        hotspot: true,
      },
      fields: [
        {
          name: 'alt',
          title: 'Alt Text',
          type: 'string',
        },
      ],
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'tags',
      title: 'Tags',
      type: 'array',
      of: [{ type: 'string' }],
    },
    {
      name: 'featured',
      title: 'Featured',
      type: 'boolean',
      initialValue: false,
    },
  ],
  preview: {
    select: {
      title: 'title',
      subtitle: 'subject',
      media: 'coverImage',
    },
  },
};

// Discount code schema for Sanity CMS
export const discountCodeSchema = {
  name: 'discountCode',
  title: 'Discount Code',
  type: 'document',
  fields: [
    {
      name: 'code',
      title: 'Code',
      type: 'string',
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'discountPercentage',
      title: 'Discount Percentage',
      type: 'number',
      validation: (Rule: any) => Rule.required().min(1).max(100),
    },
    {
      name: 'validFrom',
      title: 'Valid From',
      type: 'datetime',
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'validUntil',
      title: 'Valid Until',
      type: 'datetime',
      validation: (Rule: any) => Rule.required(),
    },
    {
      name: 'isActive',
      title: 'Is Active',
      type: 'boolean',
      initialValue: true,
    },
    {
      name: 'usageLimit',
      title: 'Usage Limit',
      type: 'number',
    },
    {
      name: 'usedCount',
      title: 'Used Count',
      type: 'number',
      initialValue: 0,
    },
  ],
  preview: {
    select: {
      title: 'code',
      subtitle: 'discountPercentage',
    },
  },
};
</file>

<file path="betternotes/lib/cart-context.tsx">
'use client';

import React, { createContext, useContext, useReducer, useEffect } from 'react';
import { Cart, CartItem, Note } from '@/types';

interface CartContextType {
  cart: Cart;
  addToCart: (note: Note, quantity?: number) => void;
  removeFromCart: (noteId: string) => void;
  updateQuantity: (noteId: string, quantity: number) => void;
  clearCart: () => void;
  applyDiscountCode: (code: string, discountPercentage: number) => void;
  removeDiscountCode: () => void;
  itemCount: number;
}

const CartContext = createContext<CartContextType | undefined>(undefined);

type CartAction =
  | { type: 'ADD_TO_CART'; payload: { note: Note; quantity: number } }
  | { type: 'REMOVE_FROM_CART'; payload: string }
  | { type: 'UPDATE_QUANTITY'; payload: { noteId: string; quantity: number } }
  | { type: 'CLEAR_CART' }
  | { type: 'APPLY_DISCOUNT_CODE'; payload: { code: string; discountPercentage: number } }
  | { type: 'REMOVE_DISCOUNT_CODE' }
  | { type: 'LOAD_CART'; payload: Cart };

const cartReducer = (state: Cart, action: CartAction): Cart => {
  switch (action.type) {
    case 'ADD_TO_CART': {
      const { note, quantity } = action.payload;
      const existingItemIndex = state.items.findIndex(item => item.note._id === note._id);
      
      let newItems;
      if (existingItemIndex >= 0) {
        newItems = [...state.items];
        newItems[existingItemIndex].quantity += quantity;
      } else {
        newItems = [...state.items, { note, quantity }];
      }
      
      const total = newItems.reduce((sum, item) => sum + (item.note.price * item.quantity), 0);
      const discountAmount = state.discountCode ? (total * (state.discountAmount! / 100)) : 0;
      const finalTotal = total - discountAmount;
      
      return {
        ...state,
        items: newItems,
        total,
        discountAmount,
        finalTotal,
      };
    }
    
    case 'REMOVE_FROM_CART': {
      const newItems = state.items.filter(item => item.note._id !== action.payload);
      const total = newItems.reduce((sum, item) => sum + (item.note.price * item.quantity), 0);
      const discountAmount = state.discountCode ? (total * (state.discountAmount! / 100)) : 0;
      const finalTotal = total - discountAmount;
      
      return {
        ...state,
        items: newItems,
        total,
        discountAmount,
        finalTotal,
      };
    }
    
    case 'UPDATE_QUANTITY': {
      const { noteId, quantity } = action.payload;
      if (quantity <= 0) {
        return cartReducer(state, { type: 'REMOVE_FROM_CART', payload: noteId });
      }
      
      const newItems = state.items.map(item =>
        item.note._id === noteId ? { ...item, quantity } : item
      );
      
      const total = newItems.reduce((sum, item) => sum + (item.note.price * item.quantity), 0);
      const discountAmount = state.discountCode ? (total * (state.discountAmount! / 100)) : 0;
      const finalTotal = total - discountAmount;
      
      return {
        ...state,
        items: newItems,
        total,
        discountAmount,
        finalTotal,
      };
    }
    
    case 'CLEAR_CART':
      return {
        items: [],
        total: 0,
        finalTotal: 0,
      };
    
    case 'APPLY_DISCOUNT_CODE': {
      const { code, discountPercentage } = action.payload;
      const discountAmount = state.total * (discountPercentage / 100);
      const finalTotal = state.total - discountAmount;
      
      return {
        ...state,
        discountCode: code,
        discountAmount,
        finalTotal,
      };
    }
    
    case 'REMOVE_DISCOUNT_CODE': {
      return {
        ...state,
        discountCode: undefined,
        discountAmount: undefined,
        finalTotal: state.total,
      };
    }
    
    case 'LOAD_CART':
      return action.payload;
    
    default:
      return state;
  }
};

const initialState: Cart = {
  items: [],
  total: 0,
  finalTotal: 0,
};

export const CartProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [cart, dispatch] = useReducer(cartReducer, initialState);
  
  // Load cart from localStorage on mount
  useEffect(() => {
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
      try {
        const parsedCart = JSON.parse(savedCart);
        dispatch({ type: 'LOAD_CART', payload: parsedCart });
      } catch (error) {
        console.error('Failed to load cart from localStorage:', error);
      }
    }
  }, []);
  
  // Save cart to localStorage whenever it changes
  useEffect(() => {
    localStorage.setItem('cart', JSON.stringify(cart));
  }, [cart]);
  
  const addToCart = (note: Note, quantity = 1) => {
    dispatch({ type: 'ADD_TO_CART', payload: { note, quantity } });
  };
  
  const removeFromCart = (noteId: string) => {
    dispatch({ type: 'REMOVE_FROM_CART', payload: noteId });
  };
  
  const updateQuantity = (noteId: string, quantity: number) => {
    dispatch({ type: 'UPDATE_QUANTITY', payload: { noteId, quantity } });
  };
  
  const clearCart = () => {
    dispatch({ type: 'CLEAR_CART' });
  };
  
  const applyDiscountCode = (code: string, discountPercentage: number) => {
    dispatch({ type: 'APPLY_DISCOUNT_CODE', payload: { code, discountPercentage } });
  };
  
  const removeDiscountCode = () => {
    dispatch({ type: 'REMOVE_DISCOUNT_CODE' });
  };
  
  const itemCount = cart.items.reduce((sum, item) => sum + item.quantity, 0);
  
  return (
    <CartContext.Provider
      value={{
        cart,
        addToCart,
        removeFromCart,
        updateQuantity,
        clearCart,
        applyDiscountCode,
        removeDiscountCode,
        itemCount,
      }}
    >
      {children}
    </CartContext.Provider>
  );
};

export const useCart = () => {
  const context = useContext(CartContext);
  if (context === undefined) {
    throw new Error('useCart must be used within a CartProvider');
  }
  return context;
};
</file>

<file path="betternotes/public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="betternotes/public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="betternotes/public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="betternotes/public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="betternotes/public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="betternotes/types/index.ts">
// Note types
export interface Note {
  _id: string;
  title: string;
  slug: string;
  description: string;
  price: number;
  originalPrice?: number;
  coverImage: {
    asset: {
      _ref: string;
      _type: string;
    };
  };
  images: {
    _key?: string;
    _type: string;
    asset?: {
      _id: string;
      _type: string;
      url?: string;
      metadata?: any;
    };
  }[];
  academicYear: string;
  subject: string;
  tags: string[];
  featured: boolean;
  createdAt: string;
  updatedAt: string;
}

// Discount code types
export interface DiscountCode {
  _id: string;
  code: string;
  discountPercentage: number;
  validFrom: string;
  validUntil: string;
  isActive: boolean;
  usageLimit?: number;
  usedCount: number;
}

// Cart types
export interface CartItem {
  note: Note;
  quantity: number;
}

export interface Cart {
  items: CartItem[];
  total: number;
  discountCode?: string;
  discountAmount?: number;
  finalTotal: number;
}

// API response types
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
}

// Filter types
export interface NoteFilters {
  academicYear?: string;
  subject?: string;
  priceRange?: {
    min: number;
    max: number;
  };
  search?: string;
}

// Contact information
export interface ContactInfo {
  telegram: string;
  email?: string;
  phone?: string;
}

// Site configuration
export interface SiteConfig {
  name: string;
  description: string;
  url: string;
  ogImage: string;
  links: {
    telegram: string;
    email?: string;
  };
}
</file>

<file path="betternotes/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="betternotes/eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="betternotes/fix-studio.sh">
#!/bin/bash

# Fix Sanity Studio Issues Script
echo "🔧 Fixing Sanity Studio Issues..."
echo "================================"

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "❌ Error: Please run this script from the betternotes directory"
    exit 1
fi

echo "🧹 Cleaning up..."

# Clear Next.js cache
rm -rf .next

echo "📝 Checking environment variables..."

# Check if .env.local exists
if [ ! -f ".env.local" ]; then
    echo "❌ .env.local file not found. Creating from example..."
    cp .env.local.example .env.local
    echo ""
    echo "⚠️  IMPORTANT: You need to edit .env.local and add your actual Sanity tokens!"
    echo "   Visit: https://www.sanity.io/manage/personal/project/t1y8nndf/api/tokens"
    echo ""
    read -p "Press Enter after you've updated .env.local with real tokens..."
fi

# Check if tokens are still placeholders
if grep -q "your_read_token_here" .env.local; then
    echo ""
    echo "❌ ISSUE FOUND: You still have placeholder tokens in .env.local"
    echo ""
    echo "To fix this:"
    echo "1. Go to: https://www.sanity.io/manage/personal/project/t1y8nndf/api/tokens"
    echo "2. Create or copy your API tokens"
    echo "3. Edit .env.local and replace:"
    echo "   SANITY_API_READ_TOKEN=your_read_token_here"
    echo "   SANITY_API_WRITE_TOKEN=your_write_token_here"
    echo "   With your actual tokens"
    echo ""
    echo "4. Then run this script again"
    echo ""
    read -p "Press Enter after you've added real tokens..."
fi

echo ""
echo "🚀 Starting development server..."
echo "   Next.js App: http://localhost:3000"
echo "   Sanity Studio: http://localhost:3000/studio"
echo ""
echo "If Studio still doesn't work, check TROUBLESHOOTING_SANITY_STUDIO.md"
echo ""

npm run dev
</file>

<file path="betternotes/next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'cdn.sanity.io',
        port: '',
        pathname: '/**',
      },
    ],
    unoptimized: false,
  },
  experimental: {
    optimizePackageImports: ['lucide-react'],
    // Disable Turbopack for Sanity compatibility
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
  },
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
  poweredByHeader: false,
  compress: true,
  generateEtags: true,
  httpAgentOptions: {
    keepAlive: true,
  },
  // Enhanced logging for debugging
  logging: {
    fetches: {
      fullUrl: true,
    },
  },
  // Webpack fallback for better Sanity compatibility
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
      };
    }
    return config;
  },
};

module.exports = nextConfig;
</file>

<file path="betternotes/next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'cdn.sanity.io',
        port: '',
        pathname: '/**',
      },
    ],
  },
};

export default nextConfig;
</file>

<file path="betternotes/package.json">
{
  "name": "better-notes-v2",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "setup": "./setup-dev.sh",
    "fix-studio": "./fix-studio.sh",
    "dev": "next dev",
    "dev:turbo": "next dev --turbo",
    "dev:webpack": "NODE_OPTIONS='--no-experimental-fetch' next dev",
    "studio": "sanity dev --port 3333",
    "studio:cloud": "open studio.html",
    "build": "next build",
    "build:webpack": "NODE_OPTIONS='--no-experimental-fetch' next build",
    "build:turbo": "next build --turbo",
    "start": "next start",
    "lint": "eslint",
    "typegen": "sanity schema extract --path=lib/sanity/extract.json && sanity typegen generate"
  },
  "dependencies": {
    "@sanity/cli": "^4.13.0",
    "@sanity/icons": "^3.7.4",
    "@sanity/image-url": "^1.2.0",
    "@sanity/structure": "^2.36.2",
    "@sanity/vision": "^4.13.0",
    "date-fns": "^4.1.0",
    "lucide-react": "^0.552.0",
    "next": "16.0.1",
    "next-sanity": "^11.6.5",
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "react-zoom-pan-pinch": "^3.7.0",
    "rxjs": "^7.8.2",
    "sanity": "^4.13.0",
    "styled-components": "^6.1.19"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.0.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="betternotes/postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="betternotes/README.md">
# Better Notes - A Modern Note-Taking Application

A Next.js application powered by Sanity CMS for content management.

## 🚀 Quick Start

### Prerequisites
- Node.js 18+ installed
- Sanity CLI installed (`npm install -g @sanity/cli`)

### 1. Clone and Install
```bash
git clone <repository-url>
cd betternotes
npm install
```

### 2. Configure Environment
Create a `.env.local` file:
```env
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id_here
NEXT_PUBLIC_SANITY_DATASET=production
```

### 3. Run Development Servers

**Option A: Easy Start (macOS)**
```bash
./run-dev.sh
```

**Option B: Manual Start**
Open two terminals:

Terminal 1 (Next.js app):
```bash
npm run dev
```
Opens at: http://localhost:3000

Terminal 2 (Sanity Studio):
```bash
npm run studio
```
Opens at: http://localhost:3333

## 📁 Project Structure

```
betternotes/
├── app/                    # Next.js App Router pages
│   ├── notes/             # Notes listing and detail pages
│   ├── checkout/          # Checkout page
│   └── layout.tsx         # Root layout
├── components/            # React components
│   ├── layout/           # Header, Footer components
│   └── ui/               # Reusable UI components
├── lib/                  # Utility libraries
│   └── sanity/           # Sanity client and schema
├── types/                # TypeScript type definitions
├── sanity.config.ts      # Sanity Studio configuration
├── run-dev.sh           # Development runner script
└── DEVELOPMENT_GUIDE.md # Detailed setup instructions
```

## 🛠️ Technology Stack

- **Frontend**: Next.js 16 with App Router
- **UI**: React 19 with Tailwind CSS
- **CMS**: Sanity.io for content management
- **Language**: TypeScript

## 📚 Key Features

- **Content Management**: Full-featured CMS with Sanity Studio
- **Note System**: Create, edit, and organize notes
- **E-commerce Integration**: Purchase notes with discount codes
- **Responsive Design**: Works on all devices
- **Type Safety**: Full TypeScript implementation

## 🔧 Development

### Adding New Content Types
1. Edit `lib/sanity/schema.ts` to add new schemas
2. Restart Sanity Studio (`npm run studio`)
3. New types will appear in the Studio

### Fetching Data
```typescript
import { client } from '@/lib/sanity/client'

const notes = await client.fetch('*[_type == "note"]')
```

### Building for Production
```bash
npm run build
npm start
```

## 📖 Documentation

- [Development Guide](./DEVELOPMENT_GUIDE.md) - Detailed setup and development instructions
- [Troubleshooting Guide](./TROUBLESHOOTING_SANITY_STUDIO.md) - Common issues and solutions
- [Content Management Guide](./CONTENT_MANAGEMENT_GUIDE.md) - Using Sanity Studio
- [Deployment Instructions](./DEPLOYMENT_INSTRUCTIONS.md) - Deploying to production

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## 📄 License

This project is licensed under the MIT License.
</file>

<file path="betternotes/run-dev.sh">
#!/bin/bash

# Development runner for Better Notes
# This script helps you run both Next.js and Sanity Studio

echo "🚀 Starting Better Notes Development Environment..."
echo ""

# Check if .env.local exists
if [ ! -f ".env.local" ]; then
    echo "⚠️  Warning: .env.local file not found!"
    echo "   Please create it with your Sanity credentials:"
    echo "   NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id"
    echo "   NEXT_PUBLIC_SANITY_DATASET=production"
    echo ""
    read -p "Press Enter to continue anyway..."
fi

# Function to check if a port is in use
check_port() {
    if lsof -Pi :$1 -sTCP:LISTEN -t >/dev/null 2>&1; then
        return 0
    else
        return 1
    fi
}

# Check if ports are available
if check_port 3000; then
    echo "⚠️  Port 3000 is already in use. Please stop the other process."
    exit 1
fi

if check_port 3333; then
    echo "⚠️  Port 3333 is already in use. Please stop the other process."
    exit 1
fi

echo "✅ Ports 3000 and 3333 are available"
echo ""

# Create a new terminal for Next.js (macOS)
if [[ "$OSTYPE" == "darwin"* ]]; then
    osascript -e 'tell app "Terminal" to do script "cd '"$(pwd)"' && npm run dev"'
    echo "✅ Started Next.js in new terminal (http://localhost:3000)"
    
    # Wait a moment for Next.js to start
    sleep 3
    
    # Start Sanity Studio in current terminal
    echo "🎯 Starting Sanity Studio in this terminal..."
    npm run studio
else
    # For Linux/Windows, provide manual instructions
    echo "Please open two terminals and run:"
    echo ""
    echo "Terminal 1: npm run dev"
    echo "Terminal 2: npm run studio"
    echo ""
    echo "Starting Sanity Studio in this terminal..."
    npm run studio
fi
</file>

<file path="betternotes/sanity.cli.ts">
import { defineCliConfig } from 'sanity/cli'

const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 't1y8nndf'
const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'

export default defineCliConfig({ api: { projectId, dataset } })
</file>

<file path="betternotes/sanity.config.ts">
import { defineConfig } from 'sanity'
import { structureTool } from 'sanity/structure'
import { visionTool } from '@sanity/vision'
import { noteSchema, discountCodeSchema } from './lib/sanity/schema'

const config = defineConfig({
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 't1y8nndf',
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',
  plugins: [
    structureTool({
      structure: (S: any) =>
        S.list()
          .title('Content')
          .items([
            S.listItem()
              .title('Notes')
              .schemaType('note')
              .child(S.documentTypeList('note').title('Notes')),
            S.listItem()
              .title('Discount Codes')
              .schemaType('discountCode')
              .child(S.documentTypeList('discountCode').title('Discount Codes')),
          ]),
    }),
    visionTool(),
  ],
  schema: {
    types: [noteSchema, discountCodeSchema],
  },
})

export default config
</file>

<file path="betternotes/setup-dev.sh">
#!/bin/bash

# Better Notes V2 - Quick Development Setup Script
# This script sets up your development environment automatically

echo "🚀 Setting up Better Notes V2 Development Environment..."
echo "=================================================="

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "❌ Error: Please run this script from the betternotes directory"
    exit 1
fi

# Install dependencies
echo "📦 Installing dependencies..."
npm install

# Check if .env.local exists
if [ ! -f ".env.local" ]; then
    echo "📝 Creating environment file..."
    cp .env.local.example .env.local
    echo ""
    echo "⚠️  IMPORTANT: Please edit .env.local and add your Sanity project details:"
    echo "   - NEXT_PUBLIC_SANITY_PROJECT_ID=t1y8nndf"
    echo "   - NEXT_PUBLIC_SANITY_DATASET=production"
    echo ""
    read -p "Press Enter after you've updated .env.local..."
else
    echo "✅ Environment file already exists"
fi

# Start the development server
echo ""
echo "🎉 Starting development server..."
echo "   Next.js App: http://localhost:3000"
echo "   Sanity Studio: http://localhost:3000/studio"
echo ""
echo "Press Ctrl+C to stop the server"
echo ""

npm run dev
</file>

<file path="betternotes/studio.html">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanity Studio - Better Notes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #f03e2e;
            margin-bottom: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        .step {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        a {
            color: #1976d2;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 Sanity Studio Setup Required</h1>
        
        <div class="warning">
            <strong>Node.js Version Issue:</strong> You're using Node.js v25.1.0, which is too new for the current Sanity CLI. 
            Please use Node.js 18 or 20 for the best compatibility.
        </div>

        <div class="info">
            <strong>Quick Solution:</strong> Use Sanity's cloud studio instead of running locally.
        </div>

        <h2>📋 Steps to Access Your Sanity Studio:</h2>
        
        <div class="step">
            <strong>Step 1:</strong> Go to <a href="https://www.sanity.io/manage" target="_blank">https://www.sanity.io/manage</a>
        </div>
        
        <div class="step">
            <strong>Step 2:</strong> Select your project (ID: <code>t1y8nndf</code>)
        </div>
        
        <div class="step">
            <strong>Step 3:</strong> Click "Open Studio" or navigate to: 
            <br><a href="https://t1y8nndf.sanity.studio" target="_blank">https://t1y8nndf.sanity.studio</a>
        </div>
        
        <div class="step">
            <strong>Step 4:</strong> Log in with your Sanity account
        </div>

        <h2>🛠️ Alternative: Fix Local Development</h2>
        
        <p>To run the Studio locally, you need to:</p>
        
        <div class="step">
            <strong>Option A: Use Node.js 18/20</strong>
            <br>Install and switch to Node.js 18 or 20 using nvm:
            <br><code>nvm install 20</code>
            <br><code>nvm use 20</code>
            <br>Then run: <code>npm run studio</code>
        </div>
        
        <div class="step">
            <strong>Option B: Use Docker</strong>
            <br>Run Sanity Studio in a Docker container with Node.js 18
        </div>

        <h2>📝 Your Content Schema</h2>
        <p>Your project is configured with:</p>
        <ul>
            <li><strong>Notes:</strong> Main content type for your notes</li>
            <li><strong>Discount Codes:</strong> For managing promotional codes</li>
        </ul>

        <h2>🔗 Useful Links</h2>
        <ul>
            <li><a href="https://www.sanity.io/docs" target="_blank">Sanity Documentation</a></li>
            <li><a href="https://www.sanity.io/manage/personal/project/t1y8nndf/api" target="_blank">API Settings</a></li>
            <li><a href="https://www.sanity.io/manage/personal/project/t1y8nndf/cors" target="_blank">CORS Settings</a></li>
        </ul>

        <p><em>This page is a temporary guide. For the full Studio experience, please use the cloud Studio or fix your Node.js version.</em></p>
    </div>
</body>
</html>
</file>

<file path="betternotes/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="betternotes/vercel.json">
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["sin1"]
}
</file>

<file path="architecture-diagram.md">
# @Better Notes V2 - Architecture Diagram

## System Architecture Overview

```mermaid
graph TB
    subgraph "Client Side"
        A[Mobile Browser] --> B[Next.js App]
        B --> C[React Components]
        C --> D[UI Components]
        C --> E[Cart Context]
    end
    
    subgraph "Content Management"
        F[Sanity Studio] --> G[Sanity CMS]
        G --> H[Notes Content]
        G --> I[Discount Codes]
    end
    
    subgraph "Hosting & Deployment"
        J[Vercel Platform] --> K[Global CDN]
        J --> L[Edge Functions]
    end
    
    subgraph "External Services"
        M[Telegram] --> N[Order Completion]
    end
    
    B -.->|API Calls| G
    B -.->|Static Generation| J
    E -->|Order Details| M
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style G fill:#e8f5e8
    style J fill:#fff3e0
    style M fill:#fce4ec
```

## Component Architecture

```mermaid
graph LR
    subgraph "Pages"
        A[Homepage] --> B[Notes Catalog]
        B --> C[Individual Note]
        C --> D[Shopping Cart]
        D --> E[Checkout]
    end
    
    subgraph "Shared Components"
        F[Header] --> G[Footer]
        H[Cart Icon] --> I[Navigation]
    end
    
    subgraph "Feature Components"
        J[Image Gallery] --> K[Zoom/Pinch]
        L[Note Card] --> M[Filter Controls]
        N[Cart Item] --> O[Discount Form]
    end
    
    A --> F
    B --> F
    C --> F
    D --> F
    E --> F
    
    B --> M
    C --> J
    D --> N
    E --> O
    
    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style C fill:#e3f2fd
    style D fill:#e3f2fd
    style E fill:#e3f2fd
    style F fill:#f1f8e9
    style J fill:#fff8e1
```

## Data Flow Architecture

```mermaid
sequenceDiagram
    participant User
    participant NextJS
    participant Sanity
    participant Cart
    participant Telegram
    
    User->>NextJS: Browse Notes
    NextJS->>Sanity: Fetch Notes Data
    Sanity-->>NextJS: Return Notes
    NextJS-->>User: Display Notes
    
    User->>NextJS: Add to Cart
    NextJS->>Cart: Update Cart State
    Cart-->>NextJS: Cart Updated
    NextJS-->>User: Show Cart Feedback
    
    User->>NextJS: Proceed to Checkout
    NextJS->>Cart: Get Cart Items
    Cart-->>NextJS: Return Cart Data
    NextJS-->>User: Display Checkout
    
    User->>Telegram: Contact for Order
    Telegram-->>User: Order Confirmation
```

## Mobile-First Design Strategy

```mermaid
graph TD
    A[Mobile First Design] --> B[Base Styles 320px+]
    B --> C[Tablet Enhancement 768px+]
    C --> D[Desktop Enhancement 1024px+]
    
    A --> E[Touch Optimization]
    E --> F[44px Minimum Tap Targets]
    E --> G[Gesture Support]
    E --> H[Thumb-Friendly Navigation]
    
    A --> I[Performance Priority]
    I --> J[Optimized Images]
    I --> K[Minimal JavaScript]
    I --> L[Critical CSS]
    
    style A fill:#e8f5e8
    style E fill:#fff3e0
    style I fill:#e3f2fd
```

## Technology Stack Integration

```mermaid
graph TB
    subgraph "Frontend Framework"
        A[Next.js 15] --> B[App Router]
        A --> C[Static Site Generation]
        A --> D[Image Optimization]
    end
    
    subgraph "Styling"
        E[Tailwind CSS] --> F[Mobile-First Breakpoints]
        E --> G[Utility Classes]
        E --> H[Custom Theme]
    end
    
    subgraph "Content Management"
        I[Sanity.io] --> J[Headless CMS]
        I --> K[Real-time Updates]
        I --> L[Custom Schemas]
    end
    
    subgraph "State Management"
        M[React Context] --> N[Shopping Cart]
        M --> O[Global State]
    end
    
    subgraph "Image Handling"
        P[react-zoom-pan-pinch] --> Q[Touch Gestures]
        P --> R[Zoom Functionality]
    end
    
    subgraph "Deployment"
        S[Vercel] --> T[Global CDN]
        S --> U[Automatic Deployments]
    end
    
    A --> E
    A --> I
    A --> M
    A --> P
    A --> S
    
    style A fill:#e3f2fd
    style E fill:#f1f8e9
    style I fill:#fff8e1
    style M fill:#fce4ec
    style P fill:#f3e5f5
    style S fill:#e8f5e8
```

## Implementation Phases

```mermaid
gantt
    title @Better Notes V2 Implementation Timeline
    dateFormat  YYYY-MM-DD
    section Phase 1: Foundation
    Project Setup           :done, setup, 2025-11-05, 2d
    Sanity Configuration     :done, sanity, after setup, 2d
    Basic Structure         :done, structure, after sanity, 2d
    
    section Phase 2: Core Pages
    Header/Footer           :active, header, after structure, 2d
    Homepage               :homepage, after header, 3d
    Notes Catalog          :catalog, after homepage, 3d
    
    section Phase 3: Features
    Individual Notes       :notes, after catalog, 3d
    Image Gallery         :gallery, after notes, 2d
    Shopping Cart         :cart, after gallery, 3d
    
    section Phase 4: Integration
    Checkout & Telegram   :checkout, after cart, 2d
    Mobile Optimization   :mobile, after checkout, 3d
    Performance Tuning    :performance, after mobile, 2d
    
    section Phase 5: Launch
    Testing               :testing, after performance, 2d
    Deployment           :deploy, after testing, 1d
</file>

<file path="implementation-plan.md">
# @Better Notes V2 - Detailed Implementation Plan

## Architecture Analysis

### Technology Stack Assessment

The proposed technology stack (Next.js + Sanity.io + Vercel) is **excellent** for this project:

✅ **Next.js**:
- Perfect for static-first e-commerce sites
- Built-in image optimization
- Mobile-first responsive design support
- App Router for modern React patterns
- Excellent performance on mobile networks

✅ **Sanity.io**:
- Flexible content management for notes and discount codes
- Real-time content updates
- Excellent developer experience
- Scalable for future growth

✅ **Vercel**:
- Native Next.js hosting
- Global CDN for fast mobile delivery
- Automatic deployments
- Built-in analytics

### Architecture Decision

**No architecture refactor needed** - the current tech stack is optimal for this use case. The requirements align perfectly with Next.js's strengths in static site generation and mobile-first development.

## Implementation Phases

### Phase 1: Project Setup & Foundation

#### 1.1 Initialize Next.js Project
```bash
npx create-next-app@latest better-notes-v2 --typescript --tailwind --app
cd better-notes-v2
```

#### 1.2 Install Dependencies
```bash
# Core dependencies
npm install next-sanity @sanity/image-url
npm install react-zoom-pan-pinch  # For image gallery with zoom
npm install lucide-react  # Icons

# Development dependencies
npm install -D @types/node
```

#### 1.3 Configure Tailwind CSS for Mobile-First
```javascript
// tailwind.config.js
module.exports = {
  content: ['./src/**/*.{js,ts,jsx,tsx,mdx}'],
  theme: {
    extend: {
      colors: {
        primary: '#000000',    // Black
        accent: '#FFD700',     // Yellow/Gold
        secondary: '#FF0000',   // Red
      }
    },
  },
  plugins: [],
}
```

### Phase 2: Sanity.io Configuration

#### 2.1 Initialize Sanity Project
```bash
npx @sanity/cli init
```

#### 2.2 Define Schemas

**Note Schema** (`schemas/note.ts`):
```typescript
export default {
  name: 'note',
  title: 'Note',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'Title',
      type: 'string',
      validation: Rule => Rule.required()
    },
    {
      name: 'slug',
      title: 'Slug',
      type: 'slug',
      options: { source: 'title' },
      validation: Rule => Rule.required()
    },
    {
      name: 'price',
      title: 'Price',
      type: 'number',
      validation: Rule => Rule.required().min(0)
    },
    {
      name: 'academicYear',
      title: 'Academic Year',
      type: 'string',
      options: {
        list: [
          { title: '3rd Year', value: '3rd-year' },
          { title: '4th Year', value: '4th-year' },
          { title: '5th Year', value: '5th-year' }
        ]
      }
    },
    {
      name: 'subject',
      title: 'Subject',
      type: 'string',
      options: {
        list: [
          { title: 'Pharmacology', value: 'pharmacology' },
          { title: 'Forensic Medicine', value: 'forensic-medicine' },
          { title: 'Pathology', value: 'pathology' },
          { title: 'Microbiology', value: 'microbiology' }
        ]
      }
    },
    {
      name: 'description',
      title: 'Description',
      type: 'blockContent'
    },
    {
      name: 'sampleImages',
      title: 'Sample Images',
      type: 'array',
      of: [{ type: 'image' }]
    },
    {
      name: 'inventory',
      title: 'Inventory',
      type: 'number'
    }
  ]
}
```

**Discount Code Schema** (`schemas/discountCode.ts`):
```typescript
export default {
  name: 'discountCode',
  title: 'Discount Code',
  type: 'document',
  fields: [
    {
      name: 'code',
      title: 'Code',
      type: 'string',
      validation: Rule => Rule.required()
    },
    {
      name: 'discountValue',
      title: 'Discount Value',
      type: 'number',
      validation: Rule => Rule.required().min(0)
    },
    {
      name: 'isOneTimeUse',
      title: 'One Time Use',
      type: 'boolean',
      initialValue: true
    },
    {
      name: 'isUsed',
      title: 'Is Used',
      type: 'boolean',
      initialValue: false
    }
  ]
}
```

### Phase 3: Project Structure

```
src/
├── app/
│   ├── (pages)/
│   │   ├── page.tsx              # Homepage
│   │   ├── notes/
│   │   │   ├── page.tsx          # Notes catalog
│   │   │   └── [slug]/
│   │   │       └── page.tsx      # Individual note
│   │   ├── cart/
│   │   │   └── page.tsx          # Shopping cart
│   │   └── checkout/
│   │       └── page.tsx          # Checkout page
│   ├── globals.css
│   ├── layout.tsx
│   └── studio/
│       └── [[...tool]]/
│           └── page.tsx          # Sanity Studio
├── components/
│   ├── ui/
│   │   ├── Button.tsx
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── CartIcon.tsx
│   ├── ImageGallery.tsx           # Image gallery with zoom
│   ├── NoteCard.tsx
│   └── CartProvider.tsx          # Shopping cart context
├── lib/
│   ├── sanity.ts                 # Sanity client
│   ├── queries.ts                # GROQ queries
│   └── types.ts                  # TypeScript types
└── styles/
    └── globals.css
```

### Phase 4: Core Components Implementation

#### 4.1 Header Component
```typescript
// components/ui/Header.tsx
import Link from 'next/link'
import CartIcon from './CartIcon'
import { useCart } from '../CartProvider'

export default function Header() {
  const { itemCount } = useCart()
  
  return (
    <header className="bg-black text-white sticky top-0 z-50">
      <div className="container mx-auto px-4 py-4 flex justify-between items-center">
        <Link href="/" className="text-xl font-bold">
          @Better Notes
        </Link>
        <nav className="hidden md:flex space-x-6">
          <Link href="/">Home</Link>
          <Link href="/notes">All Notes</Link>
          <Link href="/about">About</Link>
        </nav>
        <Link href="/cart" className="relative">
          <CartIcon />
          {itemCount > 0 && (
            <span className="absolute -top-2 -right-2 bg-yellow-500 text-black text-xs rounded-full w-5 h-5 flex items-center justify-center">
              {itemCount}
            </span>
          )}
        </Link>
      </div>
    </header>
  )
}
```

#### 4.2 Shopping Cart Context
```typescript
// components/CartProvider.tsx
'use client'
import { createContext, useContext, useState, ReactNode } from 'react'

interface CartItem {
  id: string
  title: string
  price: number
  slug: string
  quantity: number
}

interface CartContextType {
  items: CartItem[]
  addItem: (item: Omit<CartItem, 'quantity'>) => void
  removeItem: (id: string) => void
  updateQuantity: (id: string, quantity: number) => void
  clearCart: () => void
  itemCount: number
  subtotal: number
}

const CartContext = createContext<CartContextType | undefined>(undefined)

export function CartProvider({ children }: { children: ReactNode }) {
  const [items, setItems] = useState<CartItem[]>([])

  const addItem = (item: Omit<CartItem, 'quantity'>) => {
    setItems(prev => {
      const existing = prev.find(i => i.id === item.id)
      if (existing) {
        return prev.map(i => 
          i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i
        )
      }
      return [...prev, { ...item, quantity: 1 }]
    })
  }

  const removeItem = (id: string) => {
    setItems(prev => prev.filter(item => item.id !== id))
  }

  const updateQuantity = (id: string, quantity: number) => {
    if (quantity <= 0) {
      removeItem(id)
      return
    }
    setItems(prev => 
      prev.map(item => 
        item.id === id ? { ...item, quantity } : item
      )
    )
  }

  const clearCart = () => setItems([])

  const itemCount = items.reduce((sum, item) => sum + item.quantity, 0)
  const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0)

  return (
    <CartContext.Provider value={{
      items,
      addItem,
      removeItem,
      updateQuantity,
      clearCart,
      itemCount,
      subtotal
    }}>
      {children}
    </CartContext.Provider>
  )
}

export const useCart = () => {
  const context = useContext(CartContext)
  if (!context) throw new Error('useCart must be used within CartProvider')
  return context
}
```

#### 4.3 Image Gallery with Zoom
```typescript
// components/ImageGallery.tsx
'use client'
import { useState } from 'react'
import { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch'
import Image from 'next/image'

interface ImageGalleryProps {
  images: {
    asset: {
      _ref: string
      _type: string
    }
    alt?: string
  }[]
}

export default function ImageGallery({ images }: ImageGalleryProps) {
  const [currentIndex, setCurrentIndex] = useState(0)

  const nextImage = () => {
    setCurrentIndex((prev) => (prev + 1) % images.length)
  }

  const prevImage = () => {
    setCurrentIndex((prev) => (prev - 1 + images.length) % images.length)
  }

  if (!images.length) return null

  return (
    <div className="relative w-full h-96 bg-black rounded-lg overflow-hidden">
      <TransformWrapper>
        <TransformComponent>
          <div className="relative w-full h-full flex items-center justify-center">
            <Image
              src={urlFor(images[currentIndex]).url()}
              alt={images[currentIndex].alt || 'Note sample'}
              fill
              className="object-contain"
              sizes="(max-width: 768px) 100vw, 80vw"
            />
          </div>
        </TransformComponent>
      </TransformWrapper>
      
      {/* Navigation buttons */}
      {images.length > 1 && (
        <>
          <button
            onClick={prevImage}
            className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full"
          >
            ←
          </button>
          <button
            onClick={nextImage}
            className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full"
          >
            →
          </button>
        </>
      )}
      
      {/* Image indicators */}
      {images.length > 1 && (
        <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
          {images.map((_, index) => (
            <button
              key={index}
              onClick={() => setCurrentIndex(index)}
              className={`w-2 h-2 rounded-full ${
                index === currentIndex ? 'bg-yellow-500' : 'bg-white/50'
              }`}
            />
          ))}
        </div>
      )}
    </div>
  )
}
```

### Phase 5: Page Implementations

#### 5.1 Homepage (`app/(pages)/page.tsx`)
```typescript
import { client } from '@/lib/sanity'
import { NOTES_QUERY } from '@/lib/queries'
import Link from 'next/link'
import Image from 'next/image'

export default async function HomePage() {
  const featuredNotes = await client.fetch(NOTES_QUERY, { limit: 4 })

  return (
    <div className="min-h-screen bg-white">
      {/* Hero Section */}
      <section className="bg-black text-white py-20 px-4">
        <div className="container mx-auto text-center">
          <h1 className="text-4xl md:text-6xl font-bold mb-6">
            Make Your Exams Easier
          </h1>
          <p className="text-xl md:text-2xl mb-8 text-gray-300">
            High-quality medical notes designed for exam success
          </p>
          <Link 
            href="/notes"
            className="bg-yellow-500 text-black px-8 py-4 rounded-lg font-bold text-lg hover:bg-yellow-400 transition-colors"
          >
            Browse All Notes
          </Link>
        </div>
      </section>

      {/* Author Introduction */}
      <section className="py-16 px-4">
        <div className="container mx-auto">
          <div className="flex flex-col md:flex-row items-center gap-8">
            <div className="w-32 h-32 bg-gray-300 rounded-full"></div>
            <div>
              <h2 className="text-2xl font-bold mb-2">Prayas Raj Ojha</h2>
              <p className="text-gray-600">
                Medical professional creating comprehensive study materials to help students excel in their exams.
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* Featured Products */}
      <section className="py-16 px-4 bg-gray-50">
        <div className="container mx-auto">
          <h2 className="text-3xl font-bold mb-8 text-center">Featured Notes</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {featuredNotes.map((note) => (
              <div key={note._id} className="bg-white rounded-lg shadow-md overflow-hidden">
                <Link href={`/notes/${note.slug.current}`}>
                  <div className="aspect-square bg-gray-200"></div>
                  <div className="p-4">
                    <h3 className="font-bold mb-2">{note.title}</h3>
                    <p className="text-yellow-600 font-bold">${note.price}</p>
                  </div>
                </Link>
              </div>
            ))}
          </div>
        </div>
      </section>
    </div>
  )
}
```

#### 5.2 Notes Catalog (`app/(pages)/notes/page.tsx`)
```typescript
'use client'
import { useState, useEffect } from 'react'
import { client } from '@/lib/sanity'
import { NOTES_QUERY } from '@/lib/queries'
import NoteCard from '@/components/NoteCard'

export default function NotesPage() {
  const [notes, setNotes] = useState([])
  const [filteredNotes, setFilteredNotes] = useState([])
  const [selectedYear, setSelectedYear] = useState('')
  const [selectedSubject, setSelectedSubject] = useState('')

  useEffect(() => {
    const fetchNotes = async () => {
      const data = await client.fetch(NOTES_QUERY)
      setNotes(data)
      setFilteredNotes(data)
    }
    fetchNotes()
  }, [])

  useEffect(() => {
    let filtered = notes
    
    if (selectedYear) {
      filtered = filtered.filter(note => note.academicYear === selectedYear)
    }
    
    if (selectedSubject) {
      filtered = filtered.filter(note => note.subject === selectedSubject)
    }
    
    setFilteredNotes(filtered)
  }, [selectedYear, selectedSubject, notes])

  return (
    <div className="min-h-screen bg-white py-8 px-4">
      <div className="container mx-auto">
        <h1 className="text-3xl font-bold mb-8">All Notes</h1>
        
        {/* Filters */}
        <div className="mb-8 flex flex-col md:flex-row gap-4">
          <select
            value={selectedYear}
            onChange={(e) => setSelectedYear(e.target.value)}
            className="px-4 py-2 border border-gray-300 rounded-lg"
          >
            <option value="">All Years</option>
            <option value="3rd-year">3rd Year</option>
            <option value="4th-year">4th Year</option>
            <option value="5th-year">5th Year</option>
          </select>
          
          <select
            value={selectedSubject}
            onChange={(e) => setSelectedSubject(e.target.value)}
            className="px-4 py-2 border border-gray-300 rounded-lg"
          >
            <option value="">All Subjects</option>
            <option value="pharmacology">Pharmacology</option>
            <option value="forensic-medicine">Forensic Medicine</option>
            <option value="pathology">Pathology</option>
            <option value="microbiology">Microbiology</option>
          </select>
        </div>
        
        {/* Notes Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredNotes.map((note) => (
            <NoteCard key={note._id} note={note} />
          ))}
        </div>
      </div>
    </div>
  )
}
```

#### 5.3 Checkout Page with Telegram Integration
```typescript
'use client'
import { useCart } from '@/components/CartProvider'
import { useState } from 'react'
import Link from 'next/link'

export default function CheckoutPage() {
  const { items, subtotal } = useCart()
  const [discountCode, setDiscountCode] = useState('')
  const [discount, setDiscount] = useState(0)
  const [telegramId] = useState('@betternotes_admin') // This would come from Sanity CMS

  const finalTotal = Math.max(0, subtotal - discount)

  return (
    <div className="min-h-screen bg-white py-8 px-4">
      <div className="container mx-auto max-w-2xl">
        <h1 className="text-3xl font-bold mb-8">Checkout</h1>
        
        {/* Order Summary */}
        <div className="bg-gray-50 p-6 rounded-lg mb-6">
          <h2 className="text-xl font-bold mb-4">Order Summary</h2>
          {items.map((item) => (
            <div key={item.id} className="flex justify-between mb-2">
              <span>{item.title} x {item.quantity}</span>
              <span>${(item.price * item.quantity).toFixed(2)}</span>
            </div>
          ))}
          
          <div className="border-t pt-4 mt-4">
            <div className="flex justify-between mb-2">
              <span>Subtotal</span>
              <span>${subtotal.toFixed(2)}</span>
            </div>
            {discount > 0 && (
              <div className="flex justify-between mb-2 text-green-600">
                <span>Discount</span>
                <span>-${discount.toFixed(2)}</span>
              </div>
            )}
            <div className="flex justify-between font-bold text-lg">
              <span>Total</span>
              <span>${finalTotal.toFixed(2)}</span>
            </div>
          </div>
        </div>
        
        {/* Payment Instructions */}
        <div className="bg-yellow-50 border border-yellow-200 p-6 rounded-lg mb-6">
          <h2 className="text-xl font-bold mb-4">Payment Instructions</h2>
          <p className="mb-4">
            To complete your order, please contact us on Telegram with your order details:
          </p>
          
          <div className="bg-black text-white p-4 rounded-lg text-center mb-4">
            <p className="text-sm mb-2">Telegram ID:</p>
            <p className="text-xl font-bold">{telegramId}</p>
          </div>
          
          <div className="bg-gray-100 p-4 rounded-lg">
            <p className="text-sm font-bold mb-2">Message to send:</p>
            <p className="text-sm bg-white p-3 rounded border">
              Hello, I'd like to purchase the following notes from @Better Notes:
              <br /><br />
              {items.map(item => `${item.title} - $${item.price} x ${item.quantity}`).join('\n')}
              <br /><br />
              Total Price: ${finalTotal.toFixed(2)}
              <br /><br />
              Please let me know the payment details. Thank you!
            </p>
          </div>
        </div>
        
        <Link 
          href={`https://t.me/${telegramId.replace('@', '')}`}
          target="_blank"
          className="block w-full bg-black text-white text-center py-4 rounded-lg font-bold hover:bg-gray-800 transition-colors"
        >
          Open Telegram to Complete Order
        </Link>
      </div>
    </div>
  )
}
```

### Phase 6: Mobile-First Design Implementation

#### 6.1 Responsive Design Strategy
- Use Tailwind's mobile-first breakpoint system
- Design for mobile screens first (320px and up)
- Enhance for tablet (768px and up) and desktop (1024px and up)
- Touch-friendly button sizes (minimum 44px)
- Thumb-friendly navigation placement

#### 6.2 Performance Optimization
- Next.js Image component for automatic optimization
- Lazy loading for images
- Minimal JavaScript bundle
- Static generation where possible
- Critical CSS inlining

### Phase 7: Deployment Configuration

#### 7.1 Vercel Setup
```json
// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "installCommand": "npm install",
  "framework": "nextjs"
}
```

#### 7.2 Environment Variables
```
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NEXT_PUBLIC_SANITY_DATASET=production
SANITY_API_READ_TOKEN=your_read_token
```

## Implementation Timeline

| Week | Tasks |
|-------|-------|
| Week 1 | Project setup, Sanity configuration, basic structure |
| Week 2 | Header/Footer, Homepage, Notes catalog |
| Week 3 | Individual note pages, Image gallery implementation |
| Week 4 | Shopping cart functionality, Checkout with Telegram |
| Week 5 | Mobile optimization, Performance tuning |
| Week 6 | Testing, Bug fixes, Deployment |

## Key Considerations

### Mobile-First Design
1. **Navigation**: Bottom navigation for mobile, top for desktop
2. **Images**: Optimize for mobile loading speeds
3. **Touch**: Large tap targets, gesture support
4. **Performance**: Minimize JavaScript, optimize images

### Image Gallery Requirements
- Use `react-zoom-pan-pinch` for zoom functionality
- Support touch gestures (swipe, pinch)
- Mobile-optimized UI controls
- Lazy loading for performance

### Telegram Integration
- Simple display of contact information
- Pre-formatted message template
- Direct link to Telegram chat
- No complex API integration needed

### Performance Optimization
- Static Site Generation where possible
- Image optimization with Next.js Image component
- Minimal bundle size
- Critical CSS inlining

## Conclusion

The proposed architecture and implementation plan is well-suited for the @Better Notes V2 requirements. The tech stack provides excellent mobile performance, the implementation plan covers all specified features, and the simplified Telegram integration reduces complexity while maintaining functionality.

The project is technically feasible with the chosen stack and doesn't require any architecture changes. The implementation should proceed as planned with focus on mobile-first design and performance optimization.
</file>

<file path="PRD.md">
---

## **Product Requirements Document (PRD): @Better Notes V2**

*   **Version:** 1.0
*   **Date:** November 5, 2025
*   **Author:** Gemini (for Prayas Raj Ojha)
*   **Status:** Draft

### **1. Introduction & Vision**

This document outlines the requirements for the version 2 website of `@Better Notes`. The current website is a single, long-form page that serves as a basic catalog. The vision for V2 is to create a professional, mobile-first e-commerce platform that enhances the user experience, streamlines the purchasing process, and establishes a scalable foundation for the `@Better Notes` brand.

The new website will be a static-first site built with **Next.js**, managed via a headless CMS (**Sanity.io**), and hosted on **Vercel**.

This will be MOBILE first website - primariy deisgned for mboile user (for mobile phone screens) - NO desktop website veiw is required for now. 
 
### **2. Goals & Objectives**

*   **Business Goal:** To increase the conversion rate of visitors to paying customers by providing a more intuitive and credible shopping experience.
*   **User Goal:** To allow medical students to easily browse, sample, and select medical notes for purchase on their mobile devices.
*   **Technical Goal:** To build a high-performance, maintainable, and scalable website with a decoupled front-end and back-end (CMS).

### **3. Target Audience**

The primary users are medical students in various years of their studies (3rd, 4th, 5th, etc.).

*   **Demographics:** Tech-savvy individuals, primarily in their early-to-mid 20s.
*   **Behavior:** They are heavy mobile users, value-conscious, and need quick access to high-quality, exam-focused study materials. They appreciate peer-to-peer recommendations and trust creators who are in their field.

### **4. User Stories & Journeys**

*   **As a new visitor,** I want to quickly understand what the website offers and who the author is, so I can decide if the notes are credible.
*   **As a prospective customer,** I want to be able to filter notes by my academic year and subject, so I can find relevant material quickly.
*   **As a careful buyer,** I want to see high-quality samples of the notes before I decide to purchase, so I can assess their quality and style.
*   **As a shopper,** I want to add multiple notes to a shopping cart from different sections of the website, so I can purchase them all in one go.
*   **As a savvy student,** I want to be able to apply a discount code during checkout to get a better price.
*   **As a customer ready to buy,** I want a simple way to confirm my order and contact the seller to arrange payment.

### **5. Detailed Feature Requirements**

#### **5.1. Global Elements**

These elements should be present on most pages.

*   **Header:**
    *   Logo (`@Better Notes`) that links to the Homepage.
    *   Navigation links: "Home," "All Notes," "About."
    *   A Shopping Cart icon that displays the number of items currently in the cart.
*   **Footer:**
    *   Logo and copyright information (`@Better Notes © 2025`).
    *   Links to social media or contact information.

#### **5.2. Page: Homepage (`/`)**

*   **Purpose:** To introduce the brand, build credibility, and guide users to the products.
*   **Requirements:**
    1.  **Hero Section:** A prominent heading ("Make Your Exams Easier") and a short, engaging tagline.
    2.  **Author Introduction:** A dedicated section featuring Prayas Raj Ojha's photo, name, and credentials to build trust.
    3.  **Value Propositions:** A section highlighting key benefits (e.g., "Exam Focused," "Quick Review," "Easy Explanations").
    4.  **Featured Products Section:** A curated grid of 3-4 popular notes or bundles to drive users directly to high-value items. Each item must link to its Individual Note Page.
    5.  **Call to Action (CTA):** A visually distinct button prompting users to "Browse All Notes," linking to the `/notes` page.

#### **5.3. Page: Notes & Store (`/notes`)**

*   **Purpose:** The main product catalog for all notes.
*   **Requirements:**
    1.  **Filtering Controls:**
        *   Filter by **Academic Year** (e.g., 3rd Year, 4th Year).
        *   Filter by **Subject** (e.g., Pharmacology, Forensic Medicine).
        *   Applying a filter should dynamically update the displayed products without a full page reload.
    2.  **Product Grid:**
        *   Notes displayed in a responsive grid format.
        *   Each "product card" in the grid must display the note's title, price, and a thumbnail image.
        *   Each card must link to its unique Individual Note Page.

#### **5.4. Page: Individual Note (`/notes/[slug]`)**

*   **Purpose:** A detailed view of a single product to convince the user to buy.
*   **Requirements:**
    1.  **Product Information:** The note's full `Title` and `Price` must be clearly displayed.
    2.  **Image Gallery:**
        *   A gallery displaying the `sampleImages` for the note.
        *   **Must be mobile-friendly and support touch gestures (swipe left/right).**
        *   **Must support a zoom-in/pinch-to-zoom feature** for detailed inspection of the notes.
    3.  **Description:** A section for a detailed description of the note's contents.
    4.  **Add to Cart Button:** A prominent button to add the current item to the shopping cart. The button should provide visual feedback (e.g., changes to "Added!" or updates the cart icon) upon being clicked.

#### **5.5. Feature: Shopping Cart (`/cart`)**

*   **Purpose:** To allow users to review their selections and begin the checkout process.
*   **Requirements:**
    1.  **Order Summary:** Display all items added to the cart in a list. Each item should show its title, price, and a "Remove" button.
    2.  **Dynamic Calculation:** The page must display a subtotal that automatically updates if an item is removed.
    3.  **Discount Code Field:**
        *   An input text box for users to enter a discount code.
        *   An "Apply" button that validates the code against the list of codes in Sanity.
        *   If the code is valid and not yet used, the final total should be recalculated and displayed.
        *   If invalid, an error message should be shown.
    4.  **Total Price:** A clear display of the final calculated price.
    5.  **Checkout Button:** A button that reads "Proceed to Checkout" and links to the `/checkout` page.

#### **5.6. Page: Checkout (`/checkout`)**

*   **Purpose:** To finalize the order and hand it off to the manual payment process.
*   **Requirements:**
    1.  **Final Order Review:** A non-editable summary of the cart items, discount applied, and the final total.
    2.  **Instructions:** A clear, simple text explaining the next step.
    3.  **WhatsApp Redirect Button:**
        *   A prominent button labeled "Confirm & Order on WhatsApp."
        *   Clicking this button **must** generate and open a `whatsapp://` link.
        *   The link must pre-populate a message to your specified phone number with the following format:
            `Hello, I'd like to purchase the following notes from @Better Notes: \n\n[Item 1 Title] - [Price]\n[Item 2 Title] - [Price]\n\nDiscount Applied: [Code]\nTotal Price: [Final Price]\n\nPlease let me know the payment details. Thank you!`

### **6. Content Management (Sanity.io Schemas)**

The following content models (schemas) need to be created in Sanity Studio.

*   **`note` Document:**
    *   `title`: Text (String)
    *   `slug`: Slug (unique, generated from title)
    *   `price`: Number
    *   `academicYear`: Text (String), with a pre-defined list of options (e.g., "3rd Year," "4th Year").
    *   `subject`: Text (String), with a pre-defined list of options.
    *   `description`: Rich Text (Block Content)
    *   `sampleImages`: Array of Images
    *   `inventory`: Number (for tracking stock, if needed in the future)
*   **`discountCode` Document:**
    *   `code`: Text (String) - The actual code to be entered.
    *   `discountValue`: Number - The amount to be deducted.
    *   `isOneTimeUse`: Boolean - Set to `true`.
    *   `isUsed`: Boolean - Default to `false`. *(This will be manually toggled to `true` in Sanity Studio after a purchase is confirmed)*.

### **7. Non-Functional Requirements**

*   **Design:** The website must be **mobile-first**. The UI should be modern, clean, and sleek, taking inspiration from the color scheme (black, yellow, red accents) of the existing site but implemented in a more structured and minimalist way.
*   **Performance:** Pages should load quickly, with optimized images to ensure a smooth experience on mobile networks.
*   **Hosting:** The final application will be deployed on Vercel.

### **8. Out of Scope for V1.0**

*   **Online Payment Integration:** All payments will be handled manually and externally (off-site).
*   **User Accounts:** There will be no customer login, registration, or order history functionality.
*   **Automated Discount Code Management:** The "isUsed" status of discount codes will be updated manually in Sanity after a successful sale.
*   **Automated Inventory Management:** Inventory will be manually tracked.
</file>

</files>
